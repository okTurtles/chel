var p=Symbol("tag"),b=Symbol("serialize"),S=Symbol("deserialize"),i=(o,e)=>(o.add(e),e),m=o=>{let e=new WeakSet,s=[],f=new Set,t=new Set;return{data:JSON.parse(JSON.stringify(o,(h,r)=>{if(r&&typeof r=="object"&&e.has(r))return r;if(r===void 0)return i(e,["_","_"]);if(!r)return r;if(Array.isArray(r)&&r[0]==="_")return i(e,["_","_",...r]);if(r instanceof Map)return i(e,["_","Map",Array.from(r.entries())]);if(r instanceof Set)return i(e,["_","Set",Array.from(r.values())]);if(r instanceof Blob||r instanceof File){let n=s.length;return s[s.length]=r,i(e,["_","_ref",n])}if(r instanceof Error){let n=s.length;return s[s.length]=r,r.cause&&(r.cause=m(r.cause).data),i(e,["_","_err",i(e,["_","_ref",n]),r.name])}if(r instanceof MessagePort||r instanceof ReadableStream||r instanceof WritableStream||r instanceof ArrayBuffer){let n=s.length;return s[s.length]=r,f.add(r),i(e,["_","_ref",n])}if(ArrayBuffer.isView(r)){let n=s.length;return s[s.length]=r,f.add(r.buffer),i(e,["_","_ref",n])}if(typeof r=="function"){let n=new MessageChannel;return n.port1.onmessage=async _=>{try{try{let c=await r(...d(_.data[1])),{data:a,transferables:w}=m(c);_.data[0].postMessage([!0,a],w)}catch(c){let{data:a,transferables:w}=m(c);_.data[0].postMessage([!1,a],w)}}catch(c){console.error("Async error on onmessage handler",c)}},f.add(n.port2),t.add(n.port1),i(e,["_","_fn",n.port2])}let y=Object.getPrototypeOf(r);return y?.constructor?.[p]&&y.constructor[b]?i(e,["_","_custom",y.constructor[p],y.constructor[b](r)]):r}),(h,r)=>Array.isArray(r)&&r[0]==="_"&&r[1]==="_ref"?s[r[2]]:r),transferables:Array.from(f),revokables:Array.from(t)}},A=Object.create(null),d=o=>{let e=new WeakSet,s=[];return JSON.parse(JSON.stringify(o,(f,t)=>{if(t&&typeof t=="object"&&!e.has(t)&&!Array.isArray(t)&&Object.getPrototypeOf(t)!==Object.prototype){let g=s.length;return s[s.length]=t,i(e,["_","_ref",g])}return t}),(f,t)=>{if(Array.isArray(t)&&t[0]==="_")switch(t[1]){case"_":return t.length>=3?t.slice(2):void 0;case"Map":return new Map(t[2]);case"Set":return new Set(t[2]);case"_custom":if(A[t[2]])return A[t[2]](t[3]);throw new Error("Invalid or unknown tag: "+t[2]);case"_ref":return s[t[2]];case"_err":return t[2].name!==t[3]&&(t[2].name=t[3]),t[2].cause&&(t[2].cause=d(t[2].cause)),t[2];case"_fn":{let g=t[2];return(...h)=>new Promise((r,y)=>{let n=new MessageChannel,{data:_,transferables:c}=m(h);n.port1.onmessage=a=>{a.data[0]?r(d(a.data[1])):y(d(a.data[1]))},g.postMessage([n.port2,_],[n.port2,...c])})}}return t})};d.register=o=>{typeof o=="function"&&typeof o[p]=="string"&&typeof o[S]=="function"&&(A[o[p]]=o[S].bind(o))};var M=new WeakMap,O=class{static[S](e){return new this(e)}static[b](e){return M.get(e)}static get[p](){return"__chelonia_Secret"}constructor(e){M.set(this,e)}valueOf(){return M.get(this)}};export{p as a,b,S as c,m as d,d as e,O as f};
//# sourceMappingURL=chunk-4XLIKA67-cached.js.map
