import{a as A}from"./chunk-J5QX3UQO-cached.js";import{a as N}from"./chunk-576KSFW4-cached.js";import{e as v}from"./chunk-T3OOLHAR-cached.js";import{a as S}from"./chunk-IFUUWYFC-cached.js";import{a as T}from"./chunk-3NAXAUG3-cached.js";import"./chunk-KRTYB7RO-cached.js";import{a as D}from"./chunk-P7FSS7WT-cached.js";import"./chunk-TMYX4GL6-cached.js";import{a as w}from"./chunk-3IOIYPZC-cached.js";import"./chunk-Z73GTKES-cached.js";import"./chunk-4XLIKA67-cached.js";import{a as R}from"./chunk-WMVHT3GJ-cached.js";import{j as y}from"./chunk-VUYUNB2W-cached.js";import{R as f,b as M}from"./chunk-SZPI64OI-cached.js";import"./chunk-3VFZYJBQ-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import{x as C}from"./chunk-TEH4GFTX-cached.js";import{a as b,b as m}from"./chunk-QVCKPSEU-cached.js";import{a as p}from"./chunk-OMOH7TRL-cached.js";import{b as I,d as x}from"./chunk-WBBXU2FL-cached.js";import"./chunk-XMZXE55N-cached.js";var k={name:"ChatMembersAllModal",mixins:[T],components:{ModalBaseTemplate:w,Search:A,AvatarUser:D,GroupMembersTooltipPending:N,ProfileCard:S,ButtonSubmit:R},data(){return{searchText:"",addedMembers:[],canAddMembers:[]}},computed:{...x(["currentChatRoomState","groupGeneralChatRoomId","groupMembersSorted","groupChatRooms","chatRoomMembers","chatRoomMembersInSort","globalProfile","isJoinedChatRoom","ourIdentityContractId","ourContactsById","ourContactProfilesById"]),...I(["currentGroupId"]),filteredRecents(){return v(this.addedMembers,this.searchText,["username","displayName"])},filteredOthers(){return v(this.canAddMembers,this.searchText,["username","displayName"])},searchCount(){return Object.keys(this.filteredOthers).length+Object.keys(this.filteredRecents).length},resultsCopy(){let e={searchCount:`<strong>${this.searchCount}</strong>`,searchTerm:`<strong>${this.searchText}</strong>`,...b("strong")};return this.searchCount===1?m('Showing {strong_}1 result{_strong} for "{searchTerm}"',e):m('Showing {searchCount} {strong_}results{_strong} for "{searchTerm}"',e)},attributes(){let{name:e,description:a,privacyLevel:t}=this.chatRoomAttribute,s=e;this.isGroupDirectMessage(this.currentChatRoomId)&&(s=this.ourGroupDirectMessages[this.currentChatRoomId].title);let r={[f.PRIVATE]:m("Private channel"),[f.GROUP]:m("Group members only"),[f.PUBLIC]:m("Public channel")}[t];return{name:s,description:a,privacy:r}},isJoined(){return this.isJoinedChatRoom(this.currentChatRoomId)},chatRoomAttribute(){return this.isJoined?this.currentChatRoomState.attributes:this.groupChatRooms[this.currentChatRoomId]},chatRoomMembersInOrder(){return this.isJoined?this.chatRoomMembersInSort:this.groupMembersSorted.filter(e=>this.groupChatRooms[this.currentChatRoomId].members[e.contractID]?.status===M.ACTIVE).map(e=>({contractID:e.contractID,username:e.username,displayName:e.displayName}))}},mounted(){this.initializeMembers()},methods:{initializeMembers(){this.isGroupDirectMessage()?(this.addedMembers=Object.keys(this.chatRoomMembers).map(e=>{let a=e===this.ourIdentityContractId?this.globalProfile(e):this.ourContactProfilesById[e];return{displayName:a.displayName,username:a.username,contractID:e,departedDate:null}}),this.canAddMembers=this.ourContactsById.filter(e=>!this.addedMembers.find(a=>a.contractID===e)).map(e=>{let a=this.ourContactProfilesById[e]||{};return{contractID:e,username:a.username,displayName:a.displayName,joinedDate:null}})):(this.addedMembers=this.chatRoomMembersInOrder.map(e=>({...e,departedDate:null})),this.canAddMembers=this.groupMembersSorted.filter(e=>!this.addedMembers.find(a=>a.contractID===e.contractID)&&!e.invitedBy).map(e=>({username:e.username,displayName:e.displayName,contractID:e.contractID,joinedDate:null})))},localizedName(e,a,t){let s=t||`@${a||e}`;return e===this.ourIdentityContractId?m("{name} (you)",{name:s}):s},closeModal(){this.$refs.modal.close()},removable(e){if(!this.isJoined)return!1;let{creatorID:a}=this.chatRoomAttribute;return this.groupGeneralChatRoomId===this.currentChatRoomId?!1:this.ourIdentityContractId===a?!0:this.ourIdentityContractId===e},async removeMember(e,a=!1){if(!this.isJoinedChatRoom(this.currentChatRoomId,e)){console.log(`${e} is not part of this chatroom`);return}if(e===this.ourIdentityContractId&&!a)return p("okTurtles.events/emit",C,"LeaveChannelModal");try{await p("gi.actions/group/leaveChatRoom",{contractID:this.currentGroupId,data:{chatRoomID:this.currentChatRoomId,memberID:e}}),a?this.canAddMembers=this.canAddMembers.map(t=>t.contractID===e?{...t,joinedDate:null}:t):this.addedMembers=this.addedMembers.map(t=>t.contractID===e?{...t,departedDate:new Date().toISOString()}:t)}catch(t){console.error("ChatMembersAllModal.vue removeMember() error:",t)}},async addToChannel(e,a=!1){if(this.isGroupDirectMessage()){let t=this.ourGroupDirectMessages[this.currentChatRoomId].partners.map(o=>o.contractID),s=y(t.concat(e)),r=this.ourGroupDirectMessageFromUserIds(s);r?this.redirect(r):this.createDirectMessage(s),this.closeModal();return}if(this.isJoinedChatRoom(this.currentChatRoomId,e)){console.log(`${e} is already joined this chatroom`);return}try{await p("gi.actions/group/joinChatRoom",{contractID:this.currentGroupId,data:{memberID:e,chatRoomID:this.currentChatRoomId}}),a?this.addedMembers=this.addedMembers.map(t=>t.contractID===e?{...t,departedDate:null}:t):this.canAddMembers=this.canAddMembers.map(t=>t.contractID===e?{...t,joinedDate:new Date().toISOString()}:t)}catch(t){console.error("ChatMembersAllModal.vue addToChannel() error:",t)}}}},O=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("modal-base-template",{ref:"modal",staticClass:"has-background",attrs:{fullscreen:!0,a11yTitle:e.L("Channel members"),autofocus:!1}},[t("div",{staticClass:"c-container"},[t("div",{staticClass:"c-header"},[t("div",[t("i18n",{staticClass:"is-title-2 c-title",attrs:{tag:"h2"}},[e._v("Members")]),t("div",{staticClass:"c-description"},[e._v(e._s(e.attributes.name)+" \u2219 "+e._s(e.attributes.privacy))])],1)]),t("div",{staticClass:"card c-card"},[t("search",{attrs:{placeholder:e.L("Search..."),label:e.L("Search"),autofocus:!0},model:{value:e.searchText,callback:function(s){e.searchText=s},expression:"searchText"}}),e.searchText&&e.searchCount>0?t("div",{directives:[{name:"safe-html",rawName:"v-safe-html",value:e.resultsCopy,expression:"resultsCopy"}],staticClass:"c-member-count has-text-1",attrs:{"data-test":"memberSearchCount"}}):e._e(),e.searchText&&e.searchCount===0?t("i18n",{staticClass:"c-member-count has-text-1",attrs:{tag:"div",args:{searchTerm:"<strong>"+e.searchText+"</strong>"}}},[e._v(`Sorry, we couldn't find anyone called "{searchTerm}"`)]):e._e(),t("div",{staticClass:"c-list-to-add"},[t("div",{staticClass:"is-subtitle"},[t("i18n",{attrs:{tag:"h3",args:{nbMembers:e.filteredRecents.length}}},[e._v("Channel members ({nbMembers})")])],1),t("transition-group",{attrs:{name:"slide-list",tag:"ul","data-test":"joinedChannelMembersList"}},e._l(e.filteredRecents,function(s){var r=s.contractID,o=s.username,n=s.displayName,c=s.departedDate;return t("li",{key:r,staticClass:"c-search-member"},[t("profile-card",{attrs:{contractID:r,direction:"top-left"}},[t("div",{staticClass:"c-identity"},[t("avatar-user",{attrs:{contractID:r,size:"sm"}}),t("div",{staticClass:"c-name",attrs:{"data-test":"username"}},[t("span",[t("strong",[e._v(e._s(e.localizedName(r,o,n)))]),n?t("div",{staticClass:"c-display-name",attrs:{"data-test":"profileName"}},[e._v("@"+e._s(o))]):e._e()])])],1),!e.isGroupDirectMessage()&&e.isJoined&&e.removable(r)?t("div",{staticClass:"c-actions"},[c?t("div",{staticClass:"has-text-success"},[t("i",{staticClass:"icon-check"}),t("i18n",[e._v("Removed.")]),t("button",{staticClass:"is-unstyled c-action-undo",on:{click:function(d){return d.stopPropagation(),e.addToChannel(r,!0)}}},[e._v(e._s(e.L("Undo")))])],1):t("button",{staticClass:"is-icon",attrs:{"data-test":"removeMember-"+o},on:{click:function(d){return d.stopPropagation(),e.removeMember(r)}}},[t("i",{staticClass:"icon-times"})])]):e._e()])],1)}),0),e.isJoined?[t("div",{staticClass:"is-subtitle c-second-section"},[t("i18n",{attrs:{tag:"h3",args:{nbMembers:e.filteredOthers.length}}},[e._v("Others ({nbMembers})")])],1),t("transition-group",{attrs:{name:"slide-list",tag:"ul","data-test":"unjoinedChannelMembersList"}},e._l(e.filteredOthers,function(s){var r=s.contractID,o=s.username,n=s.displayName,c=s.joinedDate;return t("li",{key:r,staticClass:"c-search-member"},[t("profile-card",{attrs:{contractID:r,direction:"top-left"}},[t("div",{staticClass:"c-identity"},[t("avatar-user",{attrs:{contractID:r,size:"sm"}}),t("div",{staticClass:"c-name",attrs:{"data-test":"username"}},[t("span",[t("strong",[e._v(e._s(e.localizedName(r,o,n)))]),n?t("div",{staticClass:"c-display-name",attrs:{"data-test":"profileName"}},[e._v("@"+e._s(o))]):e._e()])])],1),t("div",{staticClass:"c-actions"},[c?t("div",{staticClass:"has-text-success"},[t("i",{staticClass:"icon-check"}),t("i18n",[e._v("Added.")]),e.isGroupDirectMessage()?e._e():t("button-submit",{staticClass:"is-unstyled c-action-undo",on:{click:function(d){return d.stopPropagation(),e.removeMember(r,!0)}}},[t("i18n",[e._v("Undo")])],1)],1):t("button-submit",{staticClass:"button is-outlined is-small",attrs:{type:"button","data-test":"addToChannel-"+o},on:{click:function(d){return d.stopPropagation(),e.addToChannel(r)}}},[t("i18n",{attrs:{args:e.LTags("span")}},[e._v("Add {span_}to channel{_span}")])],1)],1)])],1)}),0)]:e._e()],2)],1)])])},L=[],P=function(e){e&&e("data-v-d7e7461c_0",{source:'.c-container[data-v-d7e7461c]{height:100%;width:100%;background-color:var(--general_2)}@media screen and (min-width:769px),print{.c-container[data-v-d7e7461c],.c-header[data-v-d7e7461c]{width:50rem;max-width:100%}}.c-header[data-v-d7e7461c]{display:flex;height:4.75rem;justify-content:center;align-items:center;padding-top:0;background-color:var(--background_0);margin:0 -1rem}@media screen and (max-width:768px){.c-header[data-v-d7e7461c]{justify-content:left;padding-left:1rem}}@media screen and (min-width:769px),print{.c-header[data-v-d7e7461c]{padding-top:2rem;justify-content:flex-start;background-color:transparent;margin:0}}.c-description[data-v-d7e7461c]{color:var(--text_1)}@media screen and (max-width:768px){.c-description[data-v-d7e7461c]{position:absolute;top:5.5rem}}.c-card[data-v-d7e7461c]{margin-top:1.5rem}@media screen and (max-width:768px){.c-card[data-v-d7e7461c]{margin-top:3rem}}.c-member-count[data-v-d7e7461c]{margin-top:.5rem;margin-bottom:1.5rem}.c-identity[data-v-d7e7461c]{display:flex;align-items:center;flex-grow:1}.c-name[data-v-d7e7461c]{margin:0 .5rem 0 1.5rem;width:100%;display:flex;align-items:center;justify-content:space-between}.c-display-name[data-v-d7e7461c]{color:var(--text_1)}.c-search-member .c-twrapper[data-v-d7e7461c]{display:flex;height:4.5rem;padding:0 .5rem;justify-content:space-between;align-items:center;border-bottom:1px solid var(--general_0);transition:opacity ease-in .25s,height ease-in .25s}.c-search-member .c-twrapper[data-v-d7e7461c]:last-child{border-bottom:0}.c-search-member .c-twrapper[data-v-d7e7461c]:hover{background-color:var(--general_1);cursor:pointer}.slide-list-enter[data-v-d7e7461c],.slide-list-leave-to[data-v-d7e7461c]{height:0;opacity:0}.slide-list-leave-active[data-v-d7e7461c]{overflow:hidden;border-bottom:0}@media screen and (max-width:768px){[data-v-d7e7461c] .c-actions span{display:none}}[data-v-d7e7461c] .c-actions i+span{margin-left:.3rem}[data-v-d7e7461c] .c-actions .c-action-undo{margin-left:.5rem;color:var(--text_1)}[data-v-d7e7461c] .c-actions .c-action-undo:focus,[data-v-d7e7461c] .c-actions .c-action-undo:hover{cursor:pointer;border-bottom:1px solid var(--text_1)}@media screen and (min-width:769px),print{.c-action-menu[data-v-d7e7461c]{display:none}}.is-subtitle[data-v-d7e7461c]{display:flex;margin-top:1.875rem;margin-bottom:.5rem}.c-second-section[data-v-d7e7461c]::before{content:"";position:absolute;background-color:var(--general_2);height:1px;width:calc(100% + 6rem);top:0;left:-3rem}',map:void 0,media:void 0})},G="data-v-d7e7461c",E=void 0,B=!1;function $(e,a,t,s,r,o,n,c,d,u){let i=(typeof t=="function"?t.options:t)||{};i.__file=`style>
`,i.render||(i.render=e.render,i.staticRenderFns=e.staticRenderFns,i._compiled=!0,r&&(i.functional=!0)),i._scopeId=s;{let h;if(a&&(h=n?function(l){a.call(this,u(l,this.$root.$options.shadowRoot))}:function(l){a.call(this,c(l))}),h!==void 0)if(i.functional){let l=i.render;i.render=function(j,g){return h.call(g),l(j,g)}}else{let l=i.beforeCreate;i.beforeCreate=l?[].concat(l,h):[h]}}return i}function _(){let e=_.styles||(_.styles={}),a=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(s,r){if(document.querySelector('style[data-vue-ssr-id~="'+s+'"]'))return;let o=a?r.media||"default":s,n=e[o]||(e[o]={ids:[],parts:[],element:void 0});if(!n.ids.includes(s)){let c=r.source,d=n.ids.length;if(n.ids.push(s),r.map&&(c+=`
/*# sourceURL=`+r.map.sources[0]+" */",c+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(r.map))))+" */"),a&&(n.element=n.element||document.querySelector("style[data-group="+o+"]")),!n.element){let u=document.head||document.getElementsByTagName("head")[0],i=n.element=document.createElement("style");i.type="text/css",r.media&&i.setAttribute("media",r.media),a&&(i.setAttribute("data-group",o),i.setAttribute("data-next-index","0")),u.appendChild(i)}if(a&&(d=parseInt(n.element.getAttribute("data-next-index")),n.element.setAttribute("data-next-index",d+1)),n.element.styleSheet)n.parts.push(c),n.element.styleSheet.cssText=n.parts.filter(Boolean).join(`
`);else{let u=document.createTextNode(c),i=n.element.childNodes;i[d]&&n.element.removeChild(i[d]),i.length?n.element.insertBefore(u,i[d]):n.element.appendChild(u)}}}}var U=$({render:O,staticRenderFns:L},P,k,G,B,E,!1,_,void 0,void 0),re=U;export{re as default};
//# sourceMappingURL=ChatMembersAllModal-3A5YCI7P-cached.js.map
