import{a as d}from"./chunk-NAVF63QR-cached.js";import{o as l}from"./chunk-VUYUNB2W-cached.js";import{a}from"./chunk-OMOH7TRL-cached.js";import{e as m}from"./chunk-XMZXE55N-cached.js";var p=m(d());var s=l(t=>{let e=t==="granted"||t==="prompt"&&Notification.permission==="granted",{notificationEnabled:i}=a("state/vuex/state").settings;console.info(`Browser notifications have been: ${e?"enabled":"disabled"}, notificationEnabled=${i}`),(!e||i)&&a("service-worker/setup-push-subscription").catch(r=>{console.error("[handler] Error calling service-worker/setup-push-subscription",r)})},250),u=()=>{if(!Notification.permission)return;let t=Notification.permission;s(t),setInterval(()=>{let e=Notification.permission;t!==e&&s(t=e)},1e3)},g=()=>{if(typeof navigator!="object"||typeof Notification!="function"||typeof PushManager!="function"||typeof ServiceWorker!="function"||typeof navigator.serviceWorker!="object"){console.warn("Notifications aren't available in this browser!");return}!(typeof navigator=="object"&&navigator.vendor==="Apple Computer, Inc.")&&typeof navigator.permissions=="object"&&typeof navigator.permissions.query=="function"?Promise.all([navigator.permissions.query({name:"notifications"}),navigator.permissions.query({name:"push",userVisibleOnly:!0})]).then(e=>{s(e[0].state),e[0].addEventListener("change",()=>{s(e[0].state)},!1),e[1].addEventListener("change",()=>{s(e[1].state)},!1)}).catch(e=>{console.error("Error querying notifications permission",e),u()}):u()};async function b({enableIfGranted:t}={enableIfGranted:!1}){if(typeof Notification!="function")return null;try{let e=await Notification.requestPermission();return t&&e==="granted"&&a("state/vuex/commit","setNotificationEnabled",!0),e}catch(e){return console.error("requestNotificationPermission:",e.message),null}}async function y({title:t,body:e,icon:i,path:r,groupID:c,sbpInvocation:f}){if(typeof Notification=="function"){if(typeof i=="object"&&i.manifestCid){let o=await a("gi.db/filesCache/load",i.manifestCid).catch(n=>{console.error("[Avatar.vue] Error loading file from cache",n)});o&&(i="data:;base64,"+encodeURIComponent(p.Buffer.from(o).toString("base64")))}if(typeof WorkerGlobalScope!="function")try{if(navigator.vendor==="Apple Computer, Inc.")throw new Error("Safari requires a service worker for the notification to be displayed");let o=new Notification(t,{body:e,icon:i});r&&(o.onclick=n=>{a("controller/router").push({path:r}).catch(console.warn)})}catch{return navigator.serviceWorker?.ready.then(n=>n.showNotification(t,{body:e,icon:i,data:{groupID:c,path:r,sbpInvocation:f}})).catch(console.warn)}else return self.clients.matchAll({type:"window"}).then(o=>{if(!o.some(n=>n.focused))return self.registration.showNotification(t,{body:e,icon:i,data:{groupID:c,path:r,sbpInvocation:f}}).catch(console.warn)})}}export{g as a,b,y as c};
//# sourceMappingURL=chunk-6XMQ6J6P-cached.js.map
