import{m as f}from"./chunk-WWKTCH3O-cached.js";import{j as y}from"./chunk-VUYUNB2W-cached.js";import{a as x}from"./chunk-GA3LN23N-cached.js";import"./chunk-3VFZYJBQ-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import"./chunk-TEH4GFTX-cached.js";import{b as r}from"./chunk-QVCKPSEU-cached.js";import"./chunk-OMOH7TRL-cached.js";import{d as v}from"./chunk-WBBXU2FL-cached.js";import"./chunk-XMZXE55N-cached.js";var g={name:"ExportPaymentsModal",components:{ModalTemplate:x},data(){return{form:{period:"choose"},ephemeral:{periodOpts:[],downloadUrl:"",downloadName:""}}},props:{data:Array},computed:{...v(["userDisplayNameFromID","withGroupCurrency"]),paymentType(){return this.$route.query.type},modalTitle(){return this.paymentType==="sent"?r("Export sent payments"):r("Export received payments")},exportInstructions(){return this.paymentType==="sent"?r("Export your sent payment history to .csv"):r("Export your received payment history to .csv")}},methods:{displayPeriod(e){return f(e,{month:"short",day:"numeric",year:"numeric"})},close(){this.$refs.modal.close()},exportToCSV(){let e=this.form.period==="all"?this.data:this.data.filter(t=>t.period===this.form.period),l=[this.paymentType==="sent"?r("Sent to"):r("Sent by"),r("Amount"),r("Payment method"),r("Date & Time"),r("Period"),r("Mincome at the time")],n=e.map(t=>[this.paymentType==="sent"?this.userDisplayNameFromID(t.data.toMemberID):this.userDisplayNameFromID(t.data.fromMemberID),this.withGroupCurrency(t.data.amount),r("Manual"),f(t.meta.createdDate,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).replaceAll(",",""),f(t.period,{month:"long",year:"numeric",day:"numeric"}).replaceAll(",",""),this.withGroupCurrency(t.data.groupMincome)]),i=l.join(",")+`\r
`;for(let t of n)i+=t.join(",")+`\r
`;let a=new Blob([i],{type:"text/csv;charset=utf-8,"}),s=URL.createObjectURL(a);this.ephemeral.downloadName=`${this.paymentType==="sent"?r("Sent"):r("Received")} payments.csv`,this.$refs.downloadHelper.setAttribute("href",s),this.$nextTick(()=>{this.$refs.downloadHelper.click()})}},mounted(){this.data?.length?this.ephemeral.periodOpts=y(this.data.map(e=>e.period)):this.close()}},C=function(){var e=this,l=e.$createElement,n=e._self._c||l;return n("modal-template",{ref:"modal",attrs:{a11yTitle:e.modalTitle}},[n("template",{slot:"title"},[n("span",[e._v(e._s(e.modalTitle))])]),n("div",{staticClass:"c-sub-title has-text-1"},[e._v(e._s(e.exportInstructions))]),n("label",{staticClass:"field"},[n("div",{staticClass:"label"},[n("i18n",[e._v("Payment period")])],1),n("div",{staticClass:"selectbox"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.form.period,expression:"form.period"}],staticClass:"select c-period-select",class:{"is-empty":e.form.period==="choose"},attrs:{name:"period",required:""},on:{change:function(i){var a=Array.prototype.filter.call(i.target.options,function(s){return s.selected}).map(function(s){var t="_value"in s?s._value:s.value;return t});e.$set(e.form,"period",i.target.multiple?a:a[0])}}},[n("option",{attrs:{value:"choose",disabled:!0}},[n("i18n",[e._v("Select payment period")])],1),n("option",{attrs:{value:"all"}},[n("i18n",[e._v("Export all periods")])],1),e._l(e.ephemeral.periodOpts,function(i){return n("option",{key:i,domProps:{value:i}},[e._v(e._s(e.displayPeriod(i)))])})],2)])]),n("div",{staticClass:"buttons c-btns-container"},[n("i18n",{staticClass:"is-outlined",attrs:{tag:"button",type:"button"},on:{click:e.close}},[e._v("Cancel")]),n("i18n",{attrs:{tag:"button",disabled:e.form.period==="choose"},on:{click:e.exportToCSV}},[e._v("Export payments")]),n("a",{ref:"downloadHelper",staticClass:"c-invisible-download-helper",attrs:{download:e.ephemeral.downloadName}})],1)],2)},w=[],T=function(e){e&&e("data-v-f061f888_0",{source:".c-sub-title[data-v-f061f888]{position:relative;width:100%;text-align:left;margin-bottom:1.5rem}.c-btns-container[data-v-f061f888]{position:relative;margin-top:2rem;width:100%;justify-content:space-between}.c-invisible-download-helper[data-v-f061f888]{position:absolute;opacity:0;pointer-events:none}",map:void 0,media:void 0})},S="data-v-f061f888",R=void 0,E=!1;function I(e,l,n,i,a,s,t,c,p,m){let o=(typeof n=="function"?n.options:n)||{};o.__file=`style>
`,o.render||(o.render=e.render,o.staticRenderFns=e.staticRenderFns,o._compiled=!0,a&&(o.functional=!0)),o._scopeId=i;{let u;if(l&&(u=t?function(d){l.call(this,m(d,this.$root.$options.shadowRoot))}:function(d){l.call(this,c(d))}),u!==void 0)if(o.functional){let d=o.render;o.render=function(b,h){return u.call(h),d(b,h)}}else{let d=o.beforeCreate;o.beforeCreate=d?[].concat(d,u):[u]}}return o}function _(){let e=_.styles||(_.styles={}),l=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(i,a){if(document.querySelector('style[data-vue-ssr-id~="'+i+'"]'))return;let s=l?a.media||"default":i,t=e[s]||(e[s]={ids:[],parts:[],element:void 0});if(!t.ids.includes(i)){let c=a.source,p=t.ids.length;if(t.ids.push(i),a.map&&(c+=`
/*# sourceURL=`+a.map.sources[0]+" */",c+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),l&&(t.element=t.element||document.querySelector("style[data-group="+s+"]")),!t.element){let m=document.head||document.getElementsByTagName("head")[0],o=t.element=document.createElement("style");o.type="text/css",a.media&&o.setAttribute("media",a.media),l&&(o.setAttribute("data-group",s),o.setAttribute("data-next-index","0")),m.appendChild(o)}if(l&&(p=parseInt(t.element.getAttribute("data-next-index")),t.element.setAttribute("data-next-index",p+1)),t.element.styleSheet)t.parts.push(c),t.element.styleSheet.cssText=t.parts.filter(Boolean).join(`
`);else{let m=document.createTextNode(c),o=t.element.childNodes;o[p]&&t.element.removeChild(o[p]),o.length?t.element.insertBefore(m,o[p]):t.element.appendChild(m)}}}}var $=I({render:C,staticRenderFns:w},T,g,S,E,R,!1,_,void 0,void 0),M=$;export{M as default};
//# sourceMappingURL=ExportPaymentsModal-RO2KTBXD-cached.js.map
