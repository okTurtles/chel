import{c as h,d as _,f as k,g as E}from"./chunk-GB4D3I4D-cached.js";import{a as R}from"./chunk-Q5WT7Z5S-cached.js";import{a as S}from"./chunk-LIW6QCF4-cached.js";import{a as C}from"./chunk-WMVHT3GJ-cached.js";import{t as x}from"./chunk-SZPI64OI-cached.js";import{a as y}from"./chunk-GA3LN23N-cached.js";import{a as d,b as i}from"./chunk-QVCKPSEU-cached.js";import{d as v}from"./chunk-WBBXU2FL-cached.js";var P={name:"ModalForm",components:{ModalTemplate:y,SvgProposal:R,ButtonSubmit:C,CharLengthIndicator:S},props:{title:{type:String,required:!0},disabled:Boolean,currentStep:Number,maxSteps:{type:Number,required:!0},variant:{validator(e){return["addMember","addMemberImmediate","removeMember"].indexOf(e)>-1}},shouldImmediateChange:Boolean},data(){return{form:{reason:""},config:{reasonMaxChar:x}}},computed:{...v(["currentGroupOwnerID","ourIdentityContractId","groupMembersCount","groupShouldPropose","groupProposalSettings"]),shouldPropose(){return this.groupShouldPropose&&!this.shouldImmediateChange},proposalSettings(){return this.groupProposalSettings()},isGroupCreator(){return this.ourIdentityContractId===this.currentGroupOwnerID},hasNextStep(){return this.currentStep<=this.maxSteps-1},isReasonStep(){return this.currentStep===this.maxSteps},isConfirmation(){return this.currentStep===this.maxSteps+1},threshold(){let e=this.proposalSettings.ruleSettings[this.proposalSettings.rule].threshold;return k(this.proposalSettings.rule,e,this.groupMembersCount)},footerVotingExplanation(){return{[_]:()=>this.threshold===1?i("Your proposal will pass if {b_}no one{_b} disagrees.",d("b")):i("Your proposal will pass if {b_}fewer than {n} members{_b} disagree.",{n:this.threshold,...d("b")}),[h]:()=>i("Your proposal will pass if {b_}{value} out of {total} members{_b} agree.",{value:this.fixedCount(),total:this.groupMembersCount,...d("b")})}[this.proposalSettings.rule]()},confirmationVotingExplanation(){return{[_]:()=>this.threshold===1?i("Your proposal will pass if {b_}no one{_b} disagrees.",d("b")):i("Your proposal will pass if {b_}less than {n} members{_b} disagree.",{n:this.threshold,...d("b")}),[h]:()=>i("You need {b_}{n} yes votes{_b} for your proposal to be accepted.",{n:this.fixedCount(),...d("b")})}[this.proposalSettings.rule]()},submitStyleNonProposal(){return this.variant==="removeMember"?"is-danger":"is-success"},submitTextNonProposal(){let e={addMember:i("Send invitation"),addMemberImmediate:i("Create invitation"),removeMember:i("Remove Member"),default:i("Change")};return e[this.variant]||e.default}},methods:{close(){this.$refs.modal.unload()},next(){this.$emit("update:currentStep",this.currentStep+1)},prev(){this.currentStep>0?this.$emit("update:currentStep",this.currentStep-1):this.close()},fixedCount(){let e=E(this.groupMembersCount,this.threshold);return this.variant==="removeMember"&&e===this.groupMembersCount&&(e-=1),e},async submit(){let e=this.shouldPropose?{reason:this.$refs.reason.value}:null;await this.$listeners.submit(e)},onEnterPressed(){this.hasNextStep&&this.shouldPropose&&!this.disabled&&this.next()}},watch:{isReasonStep(e,r){e&&this.$nextTick(()=>{this.$refs.reason.focus()})}}},M=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("modal-template",{ref:"modal",staticClass:"is-centered",class:{"has-background":!e.isConfirmation},attrs:{"data-test":"modalProposal",a11yTitle:e.title}},[t("template",{slot:"subtitle"},[e.shouldPropose?t("i18n",[e._v("New proposal")]):e._e()],1),t("template",{slot:"title"},[e.isConfirmation?t("i18n",{key:"title1"},[e._v("Your proposal was created")]):t("span",[e._v(e._s(e.title))])],1),t("form",{staticClass:"c-form",on:{submit:function(o){o.preventDefault()},keyup:function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"enter",13,o.key,"Enter")?null:e.onEnterPressed(o)}}},[e._t("default"),e.isReasonStep?t("label",{key:"reason",staticClass:"field"},[t("div",{staticClass:"c-reason-label-container"},[t("i18n",{staticClass:"label"},[e._v("Why are you proposing this change?")]),e.form.reason?t("char-length-indicator",{attrs:{"current-length":e.form.reason.length||0,max:e.config.reasonMaxChar}}):e._e()],1),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.reason,expression:"form.reason"}],ref:"reason",staticClass:"textarea",attrs:{maxlength:e.config.reasonMaxChar,"data-test":"reason"},domProps:{value:e.form.reason},on:{input:function(o){o.target.composing||e.$set(e.form,"reason",o.target.value)}}}),t("i18n",{staticClass:"helper"},[e._v("This is optional.")])],1):e._e(),e.isConfirmation?t("div",{key:"confirmation",staticClass:"c-confirmation"},[t("svg-proposal",{staticClass:"c-svg"}),t("i18n",[e._v("Members of your group will now be asked to vote.")]),t("span",{directives:[{name:"safe-html",rawName:"v-safe-html",value:e.confirmationVotingExplanation,expression:"confirmationVotingExplanation"}]})],1):e._e(),t("div",{staticClass:"buttons",class:{"is-centered":e.isConfirmation}},[e.isConfirmation?e._e():t("button",{key:"back",staticClass:"is-outlined",attrs:{type:"button","data-test":"prevBtn"},on:{click:function(o){return o.preventDefault(),e.prev(o)}}},[e._v(e._s(e.currentStep===0?e.L("Cancel"):e.L("Back")))]),!e.isConfirmation&&!e.shouldPropose?t("button-submit",{key:"change",class:e.submitStyleNonProposal,attrs:{disabled:e.disabled||!e.isGroupCreator,"data-test":"submitBtn"},on:{click:e.submit}},[e._v(e._s(e.submitTextNonProposal))]):e._e(),e.shouldPropose&&e.hasNextStep?t("button",{key:"next",attrs:{type:"button",disabled:e.disabled,"data-test":"nextBtn"},on:{click:function(o){return o.preventDefault(),e.next(o)}}},[t("i18n",[e._v("Next")]),t("i",{staticClass:"icon-arrow-right is-suffix"})],1):e._e(),e.isReasonStep?t("button-submit",{key:"create",staticClass:"is-success",attrs:{disabled:e.disabled,"data-test":"submitBtn"},on:{click:e.submit}},[e._v("Create Proposal")]):e._e(),e.isConfirmation?t("i18n",{key:"awesome",ref:"close",staticClass:"is-outlined",attrs:{tag:"button",type:"button","data-test":"finishBtn"},on:{click:function(o){return o.preventDefault(),e.close(o)}}},[e._v("Awesome")]):e._e()],1)],2),e.isConfirmation?e._e():t("template",{slot:"footer"},[t("div",{staticClass:"c-footer"},[t("i",{staticClass:"icon-vote-yea"}),e.shouldPropose?t("span",{directives:[{name:"safe-html",rawName:"v-safe-html",value:e.footerVotingExplanation,expression:"footerVotingExplanation"}]}):e.shouldImmediateChange?e._t("shouldImmediateChangeFooter"):e.groupShouldPropose?e._e():t("i18n",{attrs:{args:e.LTags("strong")}},[e._v("Your group has less than 3 members, so {strong_}this change will be immediate{_strong} (no voting required).")])],2)])],2)},N=[],I=function(e){e&&e("data-v-04ed5269_0",{source:".c-sprite[data-v-04ed5269]{display:none}.c-reason-label-container[data-v-04ed5269]{display:flex;align-items:flex-end;justify-content:space-between;column-gap:.5rem}.c-confirmation[data-v-04ed5269]{display:flex;flex-direction:column;align-items:center;text-align:center;margin-bottom:1rem}.c-svg[data-v-04ed5269]{height:7rem;margin-bottom:2rem}.c-form[data-v-04ed5269]{position:relative}.c-footer[data-v-04ed5269]{display:flex}.c-footer .icon-vote-yea[data-v-04ed5269]{color:var(--primary_0);margin-right:.5rem}@media screen and (max-width:768px){.c-footer .icon-vote-yea[data-v-04ed5269]{display:none}}",map:void 0,media:void 0})},T="data-v-04ed5269",A=void 0,O=!1;function B(e,r,t,o,a,p,s,u,c,m){let n=(typeof t=="function"?t.options:t)||{};n.__file=`style>
`,n.render||(n.render=e.render,n.staticRenderFns=e.staticRenderFns,n._compiled=!0,a&&(n.functional=!0)),n._scopeId=o;{let f;if(r&&(f=s?function(l){r.call(this,m(l,this.$root.$options.shadowRoot))}:function(l){r.call(this,u(l))}),f!==void 0)if(n.functional){let l=n.render;n.render=function(w,b){return f.call(b),l(w,b)}}else{let l=n.beforeCreate;n.beforeCreate=l?[].concat(l,f):[f]}}return n}function g(){let e=g.styles||(g.styles={}),r=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(o,a){if(document.querySelector('style[data-vue-ssr-id~="'+o+'"]'))return;let p=r?a.media||"default":o,s=e[p]||(e[p]={ids:[],parts:[],element:void 0});if(!s.ids.includes(o)){let u=a.source,c=s.ids.length;if(s.ids.push(o),a.map&&(u+=`
/*# sourceURL=`+a.map.sources[0]+" */",u+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),r&&(s.element=s.element||document.querySelector("style[data-group="+p+"]")),!s.element){let m=document.head||document.getElementsByTagName("head")[0],n=s.element=document.createElement("style");n.type="text/css",a.media&&n.setAttribute("media",a.media),r&&(n.setAttribute("data-group",p),n.setAttribute("data-next-index","0")),m.appendChild(n)}if(r&&(c=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",c+1)),s.element.styleSheet)s.parts.push(u),s.element.styleSheet.cssText=s.parts.filter(Boolean).join(`
`);else{let m=document.createTextNode(u),n=s.element.childNodes;n[c]&&s.element.removeChild(n[c]),n.length?s.element.insertBefore(m,n[c]):s.element.appendChild(m)}}}}var L=B({render:M,staticRenderFns:N},I,P,T,O,A,!1,g,void 0,void 0),X=L;export{X as a};
//# sourceMappingURL=chunk-5CRMMCPK-cached.js.map
