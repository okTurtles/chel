import{b as x}from"./chunk-6XMQ6J6P-cached.js";import{a as y}from"./chunk-GKXQDYNU-cached.js";import{a as S}from"./chunk-VJZRITMK-cached.js";import{f as w}from"./chunk-4XLIKA67-cached.js";import{a as b}from"./chunk-WMVHT3GJ-cached.js";import{a as A}from"./chunk-XHZPFS4B-cached.js";import{c as C}from"./chunk-6P74MMKF-cached.js";import{b as O}from"./chunk-B4L7IMS4-cached.js";import{a as M}from"./chunk-FTWBMR5D-cached.js";import{b as o}from"./chunk-QVCKPSEU-cached.js";import{a as _}from"./chunk-OMOH7TRL-cached.js";import{e as v}from"./chunk-XMZXE55N-cached.js";var u=v(O()),E=v(M());var $=e=>/^[\w-]*$/.test(e);var T=e=>!e.includes("--")&&!e.includes("__"),R=e=>!e.startsWith("-")&&!e.endsWith("-"),U=e=>!e.startsWith("_")&&!e.endsWith("_");var L=e=>e.toLowerCase()===e,k=e=>/^\S+$/.test(e);var P={[o("A username is required.")]:u.required,[o("A username cannot contain whitespace.")]:k,[o("A username can only contain letters, digits, hyphens or underscores.")]:$,[o("A username cannot exceed {maxChars} characters.",{maxChars:80})]:(0,u.maxLength)(80),[o("A username cannot contain uppercase letters.")]:L,[o("A username cannot start or end with a hyphen.")]:R,[o("A username cannot start or end with an underscore.")]:U,[o("A username cannot contain two consecutive hyphens or underscores.")]:T},V={name:"SignupForm",mixins:[E.validationMixin,A],props:{postSubmit:{type:Function,default:()=>{}}},components:{PasswordForm:S,BannerScoped:C,ButtonSubmit:b},mounted(){this.$nextTick(()=>{this.$refs.username.focus()})},data(){return{form:{username:"",password:"",passwordConfirm:"",terms:!1,pictureBase64:""},linkToTerms:y.TERMS_PAGE,usernameAsyncValidation:{timer:null,resolveFn:null}}},methods:{async signup(){if(this.$v.form.$invalid){this.$refs.formMsg.danger(o("The form is invalid."));return}try{this.$emit("signup-status","submitting"),await _("gi.app/identity/signupAndLogin",{username:this.form.username,password:new w(this.form.password)}),await this.postSubmit(),this.$emit("signup-status","success"),x({enableIfGranted:!0})}catch(e){console.error("Signup.vue submit() error:",e),this.$refs.formMsg?.danger(e.message),this.$emit("signup-status","error")}}},validations(){return{form:{username:{...P,[o("This username is already being used.")]:e=>e?(this.usernameAsyncValidation.timer&&clearTimeout(this.usernameAsyncValidation.timer),this.usernameAsyncValidation.resolveFn&&(this.usernameAsyncValidation.resolveFn(!0),this.usernameAsyncValidation.resolveFn=null),new Promise(i=>{this.usernameAsyncValidation.resolveFn=i,this.usernameAsyncValidation.timer=setTimeout(async()=>{try{i(!await _("namespace/lookup",e,{skipCache:!0}))}catch(r){console.warn("unexpected exception in SignupForm validation:",r),i(!0)}},1e3)})):!0},password:{[o("A password is required.")]:u.required,[o("Your password must be at least {minChars} characters long.",{minChars:7})]:(0,u.minLength)(7)},passwordConfirm:{[o("Passwords do not match.")]:(0,u.sameAs)("password")},terms:{[o("You need to agree to the terms and conditions.")]:e=>!!e}}}}},W=function(){var e=this,i=e.$createElement,r=e._self._c||i;return r("form",{attrs:{"data-test":"signup"},on:{submit:function(s){s.preventDefault()}}},[r("label",{staticClass:"field"},[r("i18n",{staticClass:"label"},[e._v("Username")]),r("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.username,expression:"form.username",modifiers:{trim:!0}},{name:"error",rawName:"v-error:username",value:{attrs:{"data-test":"badUsername"}},expression:'{ attrs: { "data-test": "badUsername" } }',arg:"username"}],ref:"username",staticClass:"input",class:{error:e.$v.form.username.$error},attrs:{autocapitalize:"off",name:"username","data-test":"signName"},domProps:{value:e.form.username},on:{input:[function(s){s.target.composing||e.$set(e.form,"username",s.target.value.trim())},function(s){return e.debounceField("username")}],blur:[function(s){return e.updateField("username")},function(s){return e.$forceUpdate()}]}})],1),r("div",{staticClass:"c-password-fields-container"},[r("password-form",{attrs:{label:e.L("Password"),name:"password",$v:e.$v}}),r("password-form",{attrs:{label:e.L("Confirm Password"),name:"passwordConfirm",$v:e.$v}})],1),r("label",{staticClass:"checkbox"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.form.terms,expression:"form.terms"}],staticClass:"input",attrs:{type:"checkbox",name:"terms","data-test":"signTerms"},domProps:{checked:Array.isArray(e.form.terms)?e._i(e.form.terms,null)>-1:e.form.terms},on:{click:function(s){s.stopPropagation()},change:function(s){var a=e.form.terms,l=s.target,n=!!l.checked;if(Array.isArray(a)){var c=null,m=e._i(a,c);l.checked?m<0&&e.$set(e.form,"terms",a.concat([c])):m>-1&&e.$set(e.form,"terms",a.slice(0,m).concat(a.slice(m+1)))}else e.$set(e.form,"terms",n)}}}),r("i18n",{attrs:{args:{a_:'<a class="link" target="_blank" href="'+e.linkToTerms+'">',_a:"</a>"}}},[e._v("I agree to the {a_}terms and conditions{_a}")])],1),r("banner-scoped",{ref:"formMsg",attrs:{"allow-a":"allow-a"}}),r("div",{staticClass:"buttons is-centered"},[r("button-submit",{attrs:{"data-test":"signSubmit",disabled:e.$v.form.$invalid},on:{click:e.signup}},[e._v(e._s(e.L("Create an account")))])],1)],1)},B=[],j=function(e){e&&e("data-v-951a0aac_0",{source:".c-password-fields-container[data-v-951a0aac]{display:flex;flex-direction:column;align-items:stretch;margin-top:1.5rem}@media screen and (min-width:769px),print{.c-password-fields-container[data-v-951a0aac]{flex-direction:row;align-items:flex-start;gap:1.5rem}}@media screen and (max-width:768px){.c-password-fields-container[data-v-951a0aac]{margin-bottom:1.5rem}}",map:void 0,media:void 0})},q="data-v-951a0aac",D=void 0,H=!1;function Y(e,i,r,s,a,l,n,c,m,p){let t=(typeof r=="function"?r.options:r)||{};t.__file=`style>
`,t.render||(t.render=e.render,t.staticRenderFns=e.staticRenderFns,t._compiled=!0,a&&(t.functional=!0)),t._scopeId=s;{let f;if(i&&(f=n?function(d){i.call(this,p(d,this.$root.$options.shadowRoot))}:function(d){i.call(this,c(d))}),f!==void 0)if(t.functional){let d=t.render;t.render=function(F,g){return f.call(g),d(F,g)}}else{let d=t.beforeCreate;t.beforeCreate=d?[].concat(d,f):[f]}}return t}function h(){let e=h.styles||(h.styles={}),i=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(s,a){if(document.querySelector('style[data-vue-ssr-id~="'+s+'"]'))return;let l=i?a.media||"default":s,n=e[l]||(e[l]={ids:[],parts:[],element:void 0});if(!n.ids.includes(s)){let c=a.source,m=n.ids.length;if(n.ids.push(s),a.map&&(c+=`
/*# sourceURL=`+a.map.sources[0]+" */",c+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),i&&(n.element=n.element||document.querySelector("style[data-group="+l+"]")),!n.element){let p=document.head||document.getElementsByTagName("head")[0],t=n.element=document.createElement("style");t.type="text/css",a.media&&t.setAttribute("media",a.media),i&&(t.setAttribute("data-group",l),t.setAttribute("data-next-index","0")),p.appendChild(t)}if(i&&(m=parseInt(n.element.getAttribute("data-next-index")),n.element.setAttribute("data-next-index",m+1)),n.element.styleSheet)n.parts.push(c),n.element.styleSheet.cssText=n.parts.filter(Boolean).join(`
`);else{let p=document.createTextNode(c),t=n.element.childNodes;t[m]&&n.element.removeChild(t[m]),t.length?n.element.insertBefore(p,t[m]):n.element.appendChild(p)}}}}var z=Y({render:W,staticRenderFns:B},j,V,q,H,D,!1,h,void 0,void 0),ie=z;export{P as a,ie as b};
//# sourceMappingURL=chunk-VNKQZXVF-cached.js.map
