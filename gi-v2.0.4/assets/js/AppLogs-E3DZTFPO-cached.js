import{a as C}from"./chunk-KWY464KV-cached.js";import{d as v}from"./chunk-WP4ONFFS-cached.js";import"./chunk-GKXQDYNU-cached.js";import"./chunk-AZT5ZK4I-cached.js";import{a as x}from"./chunk-WMVHT3GJ-cached.js";import{c as L}from"./chunk-6P74MMKF-cached.js";import{a as y}from"./chunk-VUYUNB2W-cached.js";import{E as g}from"./chunk-TEH4GFTX-cached.js";import{b as m,c as p}from"./chunk-QVCKPSEU-cached.js";import{a as f}from"./chunk-OMOH7TRL-cached.js";import{c as w}from"./chunk-WBBXU2FL-cached.js";import"./chunk-XMZXE55N-cached.js";var S={name:"AppLogs",components:{BannerScoped:L,ButtonSubmit:x},data(){return{form:{filter:this.$store.state.settings.appLogsFilter,source:"combined"},ephemeral:{ready:!1,logs:[],useWebShare:!1,versionInfos:{loading:!0,app_version:"",contracts_version:"",service_worker_version:""}}}},created(){f("okTurtles.events/on",g,this.addLog),this.getLogs(),this.loadVersionInfo()},mounted(){window.addEventListener("resize",this.checkWebShareAvailable),this.checkWebShareAvailable()},beforeDestroy(){f("okTurtles.events/off",g,this.addLog),window.removeEventListener("resize",this.checkWebShareAvailable)},watch:{"form.filter"(e){this.setAppLogsFilter(e)},"form.source"(e,a){e!==a&&this.getLogs()},prettyLogs(){this.$nextTick(()=>{this.$refs.textarea&&(this.$refs.textarea.scrollTop=this.$refs.textarea.scrollHeight)})}},computed:{errorMsg(){return this.$route.query.errorMsg},prettyLogs(){return this.ephemeral.logs.filter(({type:e})=>this.form.filter.includes(e)).map(({type:e,source:a,msg:t,timestamp:s})=>`${s} (${a}) [${e}] ${t.map(r=>JSON.stringify(r)).join(" ")}`).join(`
`)},issuePageTag(){return C("ISSUE_PAGE")}},methods:{...w(["setAppLogsFilter"]),async loadVersionInfo(){let e="";try{e=(await f("sw/version")).GI_GIT_VERSION.slice(1)}catch(a){console.error("AppLogs.vue caught:",a)}finally{this.ephemeral.versionInfos={loading:!1,app_version:"2.0.4".split("@")[0],contracts_version:"2.0.3",service_worker_version:e}}},addLog(e){if(e){if(this.form.source==="browser"&&e.source!=="browser"||this.form.source==="serviceworker"&&e.source!=="sw")return;this.ephemeral.logs.push(e);let a=this.form.source==="combined"?2*v:v;this.ephemeral.logs.length>=a+100&&this.ephemeral.logs.splice(0,100)}},openTroubleshooting(){this.$router.push({query:{...this.$route.query,tab:"troubleshooting"}})},downloadOrShareLogs(){let e=this.ephemeral.useWebShare?"share":"download",a=e==="download";try{let t=this.$refs.linkDownload,s="gi_logs.json.txt",r="text/plain",i=new Blob([JSON.stringify({_instructions:"GROUP INCOME - Application Logs - Attach this file when reporting an issue: https://github.com/okTurtles/group-income/issues",ua:navigator.userAgent,version_info:y(this.ephemeral.versionInfos,["loading"]),logs:this.ephemeral.logs},void 0,2)],{type:r});if(a){if(!t)return;let o=URL.createObjectURL(i);t.href=o,t.download=s,t.click(),setTimeout(()=>{t.href="#",URL.revokeObjectURL(o)},0)}else return navigator.share({files:[new File([i],s,{type:i.type})],title:m("Application Logs")})}catch(t){let s=a?m("Failed to download the app logs. {reportError}",p(t)):m("Failed to share the app logs. {reportError}",p(t));console.error(`AppLogs.vue downloadOrShareLogs() '${e}' action error:`,t),this.$refs.errBanner.danger(s)}},checkWebShareAvailable(){this.ephemeral.useWebShare=!!navigator.share&&window.matchMedia("(hover: none) and (pointer: coarse)").matches&&window.matchMedia("screen and (max-width: 1199px)").matches},getLogs(){switch(this.form.source){case"combined":{this.ephemeral.ready=!1;let e=[];this.ephemeral.logs=e,f("swLogs/get").then(a=>{if(this.ephemeral.logs!==e)return;let s=[...f("appLogs/get"),...a].sort();this.ephemeral.logs=s,this.ephemeral.ready=!0}).catch(a=>{let t=m("Error obtaining logs. {reportError}",p(a));console.error("AppLogs.vue getLogs() error:",a),this.$refs.errBanner.danger(t)});break}case"browser":{this.ephemeral.logs=f("appLogs/get"),this.ephemeral.ready=!0;break}case"serviceworker":{this.ephemeral.ready=!1;let e=[];this.ephemeral.logs=e,f("swLogs/get").then(a=>{this.ephemeral.logs===e&&(this.ephemeral.logs=a,this.ephemeral.ready=!0)}).catch(a=>{let t=m("Error obtaining logs. {reportError}",p(a));console.error("AppLogs.vue getLogs() error:",a),this.$refs.errBanner.danger(t)});break}}}}},A=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"settings-container"},[t("section",{staticClass:"card"},[e.ephemeral.versionInfos.loading?t("div",{staticClass:"c-loader-container"},[t("div",{staticClass:"loading-box"}),t("div",{staticClass:"loading-box"}),t("div",{staticClass:"loading-box"}),t("div",{staticClass:"loading-box"})]):[t("div",{staticClass:"c-header"},[t("p",{staticClass:"c-instructions"},[e.errorMsg?t("i18n",{attrs:{args:{a_:e.issuePageTag,_a:"</a>",errorMsg:e.errorMsg}}},[e._v('Recent error: "{errorMsg}". Please download the logs and {a_}send them to us{_a}, so we can help troubleshoot.')]):t("i18n",{attrs:{args:{a_:e.issuePageTag,_a:"</a>"}}},[e._v("If you encounter problems, please download the logs and {a_}send them to us{_a}.")])],1),t("fieldset",{staticClass:"c-filters"},[t("div",{staticClass:"c-filters-inner"},[t("legend",{staticClass:"c-filters-legend"},[e._v("Optional logs:")]),t("label",{staticClass:"checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.filter,expression:"form.filter"}],staticClass:"input",attrs:{type:"checkbox",name:"filter",value:"debug"},domProps:{checked:Array.isArray(e.form.filter)?e._i(e.form.filter,"debug")>-1:e.form.filter},on:{change:function(s){var r=e.form.filter,i=s.target,o=!!i.checked;if(Array.isArray(r)){var c="debug",l=e._i(r,c);i.checked?l<0&&e.$set(e.form,"filter",r.concat([c])):l>-1&&e.$set(e.form,"filter",r.slice(0,l).concat(r.slice(l+1)))}else e.$set(e.form,"filter",o)}}}),t("i18n",[e._v("Debug")])],1),t("label",{staticClass:"checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.filter,expression:"form.filter"}],staticClass:"input",attrs:{type:"checkbox",name:"filter",value:"info"},domProps:{checked:Array.isArray(e.form.filter)?e._i(e.form.filter,"info")>-1:e.form.filter},on:{change:function(s){var r=e.form.filter,i=s.target,o=!!i.checked;if(Array.isArray(r)){var c="info",l=e._i(r,c);i.checked?l<0&&e.$set(e.form,"filter",r.concat([c])):l>-1&&e.$set(e.form,"filter",r.slice(0,l).concat(r.slice(l+1)))}else e.$set(e.form,"filter",o)}}}),t("i18n",[e._v("Info")])],1),t("label",{staticClass:"checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.filter,expression:"form.filter"}],staticClass:"input",attrs:{type:"checkbox",name:"filter",value:"log"},domProps:{checked:Array.isArray(e.form.filter)?e._i(e.form.filter,"log")>-1:e.form.filter},on:{change:function(s){var r=e.form.filter,i=s.target,o=!!i.checked;if(Array.isArray(r)){var c="log",l=e._i(r,c);i.checked?l<0&&e.$set(e.form,"filter",r.concat([c])):l>-1&&e.$set(e.form,"filter",r.slice(0,l).concat(r.slice(l+1)))}else e.$set(e.form,"filter",o)}}}),t("i18n",[e._v("Log")])],1)])]),t("fieldset",{staticClass:"c-source",attrs:{"aria-label":e.L("Source:")}},[t("div",{staticClass:"c-source-inner"},[t("label",{staticClass:"c-label"},[t("i18n",{staticClass:"c-source-legend"},[e._v("Log source:")]),t("div",{staticClass:"selectbox"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.form.source,expression:"form.source"}],staticClass:"select",on:{change:function(s){var r=Array.prototype.filter.call(s.target.options,function(i){return i.selected}).map(function(i){var o="_value"in i?i._value:i.value;return o});e.$set(e.form,"source",s.target.multiple?r:r[0])}}},[t("option",{attrs:{value:"combined"}},[t("i18n",[e._v("Combined")])],1),t("option",{attrs:{value:"browser"}},[t("i18n",[e._v("Browser")])],1),t("option",{attrs:{value:"serviceworker"}},[t("i18n",[e._v("Service worker")])],1)])])],1)])]),t("button-submit",{staticClass:"is-small c-download",on:{click:e.downloadOrShareLogs}},[e.ephemeral.useWebShare?[t("i",{staticClass:"icon-share-alt is-prefix"}),t("i18n",[e._v("Share")])]:[t("i",{staticClass:"icon-download is-prefix"}),t("i18n",[e._v("Download")])]],2),t("a",{ref:"linkDownload",attrs:{hidden:"hidden"}})],1),t("banner-scoped",{ref:"errBanner",staticClass:"c-err-banner"}),e.ephemeral.ready?t("textarea",{ref:"textarea",staticClass:"textarea c-logs",attrs:{rows:"12",readonly:"readonly"}},[e._v(e._s(e.prettyLogs))]):t("div",[t("i18n",[e._v("Loading")])],1),t("i18n",{staticClass:"link",attrs:{tag:"button"},on:{click:e.openTroubleshooting}},[e._v("Troubleshooting")])]],2)])},$=[],T=function(e){e&&e("data-v-bf2a5a72_0",{source:'@charset "UTF-8";.settings-container[data-v-bf2a5a72]{width:100%}@media screen and (min-width:1200px){.settings-container[data-v-bf2a5a72]{padding-top:1.5rem}}.c-header[data-v-bf2a5a72]{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between}.c-instructions[data-v-bf2a5a72]{margin-bottom:1.5rem;width:100%}.c-filters[data-v-bf2a5a72],.c-source[data-v-bf2a5a72]{width:100%;flex-grow:99}.c-filters-inner[data-v-bf2a5a72],.c-source-inner[data-v-bf2a5a72]{display:flex}.c-filters-legend[data-v-bf2a5a72]::after,.c-source-legend[data-v-bf2a5a72]::after{content:"\u2003"}.c-filters .checkbox[data-v-bf2a5a72]:last-child::after,.c-source .checkbox[data-v-bf2a5a72]:last-child::after{content:"\u2002"}.c-source .c-label[data-v-bf2a5a72]{display:flex;align-items:center;justify-content:space-between}.c-download[data-v-bf2a5a72]{flex-grow:1}.c-download[data-v-bf2a5a72],.c-filters[data-v-bf2a5a72],.c-logs[data-v-bf2a5a72],.c-source[data-v-bf2a5a72]{margin-bottom:1rem}.c-logs[data-v-bf2a5a72]{font-family:Monaco,Menlo,Courier,monospace;font-size:.75rem;white-space:pre}.c-err-banner[data-v-bf2a5a72]{margin-bottom:1.5rem}.c-err-banner[data-v-bf2a5a72]  .c-banner{margin-top:0}.c-loader-container[data-v-bf2a5a72]{position:relative;width:100%}.c-loader-container .loading-box[data-v-bf2a5a72]{display:block;width:100%;min-height:unset}.c-loader-container .loading-box[data-v-bf2a5a72]:first-child{height:1.25rem;max-width:20rem}.c-loader-container .loading-box[data-v-bf2a5a72]:nth-child(2),.c-loader-container .loading-box[data-v-bf2a5a72]:nth-child(3){height:1.25rem}.c-loader-container .loading-box[data-v-bf2a5a72]:nth-child(2){max-width:31.25rem}.c-loader-container .loading-box[data-v-bf2a5a72]:last-child{height:16.25rem}',map:void 0,media:void 0})},E="data-v-bf2a5a72",I=void 0,R=!1;function O(e,a,t,s,r,i,o,c,l,h){let n=(typeof t=="function"?t.options:t)||{};n.__file=`style>
`,n.render||(n.render=e.render,n.staticRenderFns=e.staticRenderFns,n._compiled=!0,r&&(n.functional=!0)),n._scopeId=s;{let u;if(a&&(u=o?function(d){a.call(this,h(d,this.$root.$options.shadowRoot))}:function(d){a.call(this,c(d))}),u!==void 0)if(n.functional){let d=n.render;n.render=function(k,b){return u.call(b),d(k,b)}}else{let d=n.beforeCreate;n.beforeCreate=d?[].concat(d,u):[u]}}return n}function _(){let e=_.styles||(_.styles={}),a=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(s,r){if(document.querySelector('style[data-vue-ssr-id~="'+s+'"]'))return;let i=a?r.media||"default":s,o=e[i]||(e[i]={ids:[],parts:[],element:void 0});if(!o.ids.includes(s)){let c=r.source,l=o.ids.length;if(o.ids.push(s),r.map&&(c+=`
/*# sourceURL=`+r.map.sources[0]+" */",c+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(r.map))))+" */"),a&&(o.element=o.element||document.querySelector("style[data-group="+i+"]")),!o.element){let h=document.head||document.getElementsByTagName("head")[0],n=o.element=document.createElement("style");n.type="text/css",r.media&&n.setAttribute("media",r.media),a&&(n.setAttribute("data-group",i),n.setAttribute("data-next-index","0")),h.appendChild(n)}if(a&&(l=parseInt(o.element.getAttribute("data-next-index")),o.element.setAttribute("data-next-index",l+1)),o.element.styleSheet)o.parts.push(c),o.element.styleSheet.cssText=o.parts.filter(Boolean).join(`
`);else{let h=document.createTextNode(c),n=o.element.childNodes;n[l]&&o.element.removeChild(n[l]),n.length?o.element.insertBefore(h,n[l]):o.element.appendChild(h)}}}}var N=O({render:A,staticRenderFns:$},T,S,E,R,I,!1,_,void 0,void 0),q=N;export{q as default};
//# sourceMappingURL=AppLogs-E3DZTFPO-cached.js.map
