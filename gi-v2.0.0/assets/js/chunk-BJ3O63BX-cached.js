import{a as v,b as g,c as P,d as k,h as A}from"./chunk-GB4D3I4D-cached.js";import{a as X}from"./chunk-NUXCLDQR-cached.js";import{a as B}from"./chunk-EDZL4VNV-cached.js";import{a as N}from"./chunk-YN7ARXYA-cached.js";import{d as O}from"./chunk-OYX4NVDU-cached.js";import{m as _}from"./chunk-3V7YD6RE-cached.js";import{a as H}from"./chunk-KRTYB7RO-cached.js";import{a as F}from"./chunk-WYFJ56Q7-cached.js";import{a as $}from"./chunk-GWRDICTQ-cached.js";import{a as U}from"./chunk-WMVHT3GJ-cached.js";import{c as j}from"./chunk-6P74MMKF-cached.js";import{j as T,k as h,l as V,m as w,n as L,u as x,v as f,w as b,y as R,z as E}from"./chunk-SZPI64OI-cached.js";import{b as r}from"./chunk-33M5GGRR-cached.js";import{a as S}from"./chunk-OMOH7TRL-cached.js";import{b as C,d as I}from"./chunk-WBBXU2FL-cached.js";var q={name:"Vote",props:{proposalHash:String},components:{ButtonSubmit:U},data(){return{ephemeral:{changingVote:!1}}},computed:{...C(["currentGroupId"]),...I(["ourIdentityContractId","currentGroupState","groupSettings","currentIdentityState"]),proposal(){return this.currentGroupState.proposals[this.proposalHash]},voteStatus(){return{[g]:r("yes"),[v]:r("no")}[this.proposal.votes[this.ourIdentityContractId]]},meta(){return this.proposal.meta},type(){return this.proposal.data.proposalType},data(){return this.proposal.data.proposalData},isToRemoveMe(){return this.type===h&&this.data.memberID===this.ourIdentityContractId},hadVoted(){return this.proposal.votes[this.ourIdentityContractId]},ownProposal(){return this.ourIdentityContractId===this.proposal.creatorID},refVoteMsg(){return this.$parent.$refs.voteMsg}},methods:{startChangingVote(){this.ephemeral.changingVote=!0},async voteFor(){if(!confirm(r("Are you sure you want to vote yes?"))||this.proposal.votes[this.ourIdentityContractId]===g)return null;this.ephemeral.changingVote=!1;try{this.refVoteMsg.clean();let t=this.proposalHash;await S("gi.actions/group/proposalVote",{contractID:this.currentGroupId,data:{vote:g,proposalHash:t}})}catch(t){console.error("ProposalVoteOptions voteFor failed:",t),this.refVoteMsg.danger(t.message)}},async voteAgainst(){if(!confirm(r("Are you sure you want to vote no?"))||this.proposal.votes[this.ourIdentityContractId]===v)return null;this.ephemeral.changingVote=!1;try{this.refVoteMsg.clean(),await S("gi.actions/group/proposalVote",{contractID:this.currentGroupId,data:{vote:v,proposalHash:this.proposalHash}})}catch(t){console.error("ProposalVoteOptions voteAgainst failed:",t),this.refVoteMsg.danger(t.message)}},async cancelProposal(){if(!confirm(r("Are you sure you want to cancel this proposal?")))return null;try{this.refVoteMsg.clean(),await S("gi.actions/group/proposalCancel",{contractID:this.currentGroupId,data:{proposalHash:this.proposalHash}})}catch(t){console.error("ProposalVoteOptions cancelProposal failed:",t),this.refVoteMsg.danger(t.message)}}}},W=function(){var t=this,o=t.$createElement,e=t._self._c||o;return t.isToRemoveMe?t._e():e("div",{staticClass:"c-ctas"},[!t.hadVoted||t.ephemeral.changingVote?e("div",{staticClass:"buttons c-options"},[e("button-submit",{staticClass:"is-outlined is-small is-success",attrs:{"data-test":"voteFor"},on:{click:t.voteFor}},[t._v(t._s(t.L("Vote yes")))]),e("button-submit",{staticClass:"is-outlined is-small is-danger",attrs:{"data-test":"voteAgainst"},on:{click:t.voteAgainst}},[t._v(t._s(t.L("Vote no")))])],1):e("div",{staticClass:"buttons"},[t.ownProposal?e("button-submit",{staticClass:"is-outlined is-small",attrs:{"data-test":"cancelProposal"},on:{click:t.cancelProposal}},[t._v(t._s(t.L("Cancel proposal")))]):e("p",{staticClass:"has-text-1",attrs:{"data-test":"voted"}},[t._v(t._s(t.L("You voted {voteStatus}",{voteStatus:t.voteStatus}))+`.
\xA0`),e("i18n",{staticClass:"link",attrs:{tag:"button"},on:{click:t.startChangingVote}},[t._v("Change vote.")])],1)],1)])},Y=[],J=function(t){t&&t("data-v-3ab60db8_0",{source:".c-ctas[data-v-3ab60db8]{grid-area:actions}@media screen and (max-width:768px){.c-ctas[data-v-3ab60db8]{flex:auto;margin:1rem 1rem 1rem 0}.c-ctas .buttons[data-v-3ab60db8]{justify-content:flex-end;gap:1rem}.c-ctas button[data-v-3ab60db8]{flex-grow:1;margin-right:0}}.buttons[data-v-3ab60db8]{margin-top:0}@media screen and (min-width:769px),print{.c-options[data-v-3ab60db8]{flex-wrap:nowrap}}.c-error[data-v-3ab60db8]{margin-top:.25rem;text-align:right}",map:void 0,media:void 0})},Q="data-v-3ab60db8",Z=void 0,tt=!1;function et(t,o,e,d,n,i,s,p,l,u){let a=(typeof e=="function"?e.options:e)||{};a.__file=`style>
`,a.render||(a.render=t.render,a.staticRenderFns=t.staticRenderFns,a._compiled=!0,n&&(a.functional=!0)),a._scopeId=d;{let m;if(o&&(m=s?function(c){o.call(this,u(c,this.$root.$options.shadowRoot))}:function(c){o.call(this,p(c))}),m!==void 0)if(a.functional){let c=a.render;a.render=function(D,y){return m.call(y),c(D,y)}}else{let c=a.beforeCreate;a.beforeCreate=c?[].concat(c,m):[m]}}return a}function G(){let t=G.styles||(G.styles={}),o=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(d,n){if(document.querySelector('style[data-vue-ssr-id~="'+d+'"]'))return;let i=o?n.media||"default":d,s=t[i]||(t[i]={ids:[],parts:[],element:void 0});if(!s.ids.includes(d)){let p=n.source,l=s.ids.length;if(s.ids.push(d),n.map&&(p+=`
/*# sourceURL=`+n.map.sources[0]+" */",p+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),o&&(s.element=s.element||document.querySelector("style[data-group="+i+"]")),!s.element){let u=document.head||document.getElementsByTagName("head")[0],a=s.element=document.createElement("style");a.type="text/css",n.media&&a.setAttribute("media",n.media),o&&(a.setAttribute("data-group",i),a.setAttribute("data-next-index","0")),u.appendChild(a)}if(o&&(l=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",l+1)),s.element.styleSheet)s.parts.push(p),s.element.styleSheet.cssText=s.parts.filter(Boolean).join(`
`);else{let u=document.createTextNode(p),a=s.element.childNodes;a[l]&&s.element.removeChild(a[l]),a.length?s.element.insertBefore(u,a[l]):s.element.appendChild(u)}}}}var at=et({render:W,staticRenderFns:Y},J,q,Q,tt,Z,!1,G,void 0,void 0),K=at;var st={name:"ProposalItem",props:{proposalHash:String,proposalObject:Object},data(){return{config:{reasonMaxLength:window.innerWidth<769?50:170},ephemeral:{isReasonHidden:!0}}},components:{BannerScoped:j,ProposalVoteOptions:K,AvatarUser:F,Avatar:$,LinkToCopy:B,Tooltip:H},computed:{...I(["currentGroupState","groupMembersCount","userDisplayNameFromID","ourIdentityContractId","ourUserDisplayName"]),...C(["currentGroupId"]),statuses(){return{STATUS_OPEN:x,STATUS_PASSED:f,STATUS_FAILED:b,STATUS_EXPIRED:R,STATUS_CANCELLED:E}},proposal(){return this.proposalObject||this.currentGroupState.proposals[this.proposalHash]},subtitle(){let t=this.proposal.creatorID,o=this.userDisplayNameFromID(t),e=t===this.ourIdentityContractId;return this.proposal.data.proposalData.automated?r("Group Income system is proposing"):this.proposal.status===x?e?r("You are proposing"):r("{username} is proposing",{username:o}):e?r("You proposed"):r("{username} proposed",{username:o})},proposalType(){return this.proposal.data.proposalType},isOurProposal(){return this.proposal.creatorID===this.ourIdentityContractId},isToRemoveMe(){return this.proposalType===h&&this.proposal.data.proposalData.memberID===this.ourIdentityContractId},typeDescription(){return{[T]:()=>r("Add {user} to group.",{user:this.proposal.data.proposalData.memberName}),[h]:()=>{let t=this.userDisplayNameFromID(this.proposal.data.proposalData.memberID),o=this.proposal.data.proposalData.automated?`[${r("Automated")}] `:"";return this.isToRemoveMe?r("{automated}Remove {user} (you) from the group.",{user:t,automated:o}):r("{automated}Remove {user} from the group.",{user:t,automated:o})},[V]:()=>{let{setting:t}=this.proposal.data.proposalData,o={mincomeAmount:()=>{let{mincomeCurrency:e,currentValue:d,proposedValue:n}=this.proposal.data.proposalData;return{setting:r("mincome"),currentValue:O[e].displayWithCurrency(d),proposedValue:O[e].displayWithCurrency(n)}},distributionDate:()=>{let{currentValue:e,proposedValue:d}=this.proposal.data.proposalData;return{setting:r("distribution date"),currentValue:_(e,{month:"long",year:"numeric",day:"numeric"}),proposedValue:_(d,{month:"long",year:"numeric",day:"numeric"})}}}[t]();return r("Change {setting} from {currentValue} to {proposedValue}",o)},[w]:()=>{let{current:t,ruleName:o,ruleThreshold:e}=this.proposal.data.proposalData;return t.ruleName===o?{[k]:()=>r("Change disagreement number from {X} to {N}.",{X:t.ruleThreshold,N:e}),[P]:()=>r("Change percentage based from {X} to {N}.",{X:A(t.ruleThreshold)+"%",N:A(e)+"%"})}[o]():{[k]:()=>r("Change from a percentage based voting system to a disagreement based one, with a maximum of {N} \u201Cno\u201D votes.",{N:e}),[P]:()=>r("Change from a disagreement based voting system to a percentage based one, with minimum agreement of {percent}.",{percent:A(e)+"%"})}[o]()},[L]:()=>this.proposal.data.proposalData.name}[this.proposalType]()},statusDescription(){let t=Object.values(this.proposal.votes),o={year:"numeric",month:"long",day:"numeric"},e=t.filter(i=>i===g).length,d=t.filter(i=>i===v).length,n=e+d;switch(this.proposal.status){case x:{let i=this.proposalType===h?1:0,s=_(this.proposal.data.expires_date_ms,o);return r("{count} out of {total} members voted. Expires on {date}.",{count:t.length,total:this.groupMembersCount-i,date:s})}case b:{let i=_(this.proposal.dateClosed,o);return r("Proposal rejected on {date} with {nay} against out of {total} total votes.",{nay:d,total:n,date:i})}case E:return r("Proposal cancelled.");case f:{let i=_(this.proposal.dateClosed,o);return r("Proposal accepted on {date} with {yay} in favor out of {total} total votes.",{yay:e,total:n,date:i})}case R:{let i=_(this.proposal.data.expires_date_ms,o);return r("Expired on {date}",{date:i})}default:return`status: ${this.proposal.status}`}},iconClass(){let t={[T]:"icon-user-plus",[h]:"icon-user-minus",[V]:"icon-coins",[w]:"icon-vote-yea",[L]:"icon-envelope-open-text"},o={[x]:"has-background-primary has-text-primary",[f]:"icon-check has-background-success has-text-success",[b]:"icon-times has-background-danger has-text-danger",[E]:"has-background-general has-text-1",[R]:"has-background-general has-text-1"};return[f,b].includes(this.proposal.status)?`${o[this.proposal.status]} icon-round`:`${t[this.proposalType]} ${o[this.proposal.status]} icon-round`},shouldTruncateReason(){return this.proposal.data.proposalData.reason.length>this.config.reasonMaxLength+40},humanReason(){let t=this.proposal.data.proposalData.reason,o=this.config.reasonMaxLength;if(this.ephemeral.isReasonHidden&&this.shouldTruncateReason){let e=t.charAt(o-1)===" "?o-1:o;return`"${t.substr(0,e)}..."`}return t?`"${t}"`:""},invitationLink(){if(this.proposalType===T&&this.proposal.status===f&&this.isOurProposal){let t=this.proposal.payload.inviteKeyId;if(this.currentGroupState._vm.invites?.[t]?.status===N.VALID&&this.currentGroupState._vm.authorizedKeys?.[t]&&this.currentGroupState._vm.authorizedKeys[t]._notAfterHeight==null&&this.currentGroupState._vm.invites[t].inviteSecret)return X(this.currentGroupId,this.currentGroupState.settings?.groupName,this.currentGroupState._vm.invites[t].inviteSecret,this.ourIdentityContractId)}return!1},isExpiredInvitationLink(){let t=this.proposal.payload.inviteKeyId;return this.currentGroupState._vm.invites[t]?.status!==N.VALID||!this.currentGroupState._vm?.authorizedKeys?.[t]||this.currentGroupState._vm.authorizedKeys[t]._notAfterHeight!==void 0||this.currentGroupState._vm.invites[t].expires<Date.now()}},methods:{toggleReason(t){t.target.blur(),this.ephemeral.isReasonHidden=!this.ephemeral.isReasonHidden}}},rt=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("li",{staticClass:"c-item-wrapper",attrs:{"data-test":"proposalItem","data-proposal-hash":t.proposalHash}},[e("div",{staticClass:"c-item"},[e("div",{staticClass:"c-main"},[e("div",{staticClass:"c-icons"},[e("i",{class:t.iconClass}),this.proposal.data.proposalData.automated?e("avatar",{staticClass:"c-avatar",attrs:{src:t.currentGroupState.settings.groupPicture}}):e("avatar-user",{staticClass:"c-avatar",attrs:{contractID:t.proposal.creatorID,size:"xs"}})],1),e("div",{staticClass:"c-main-content"},[e("p",{staticClass:"has-text-bold",attrs:{"data-test":"typeDescription"}},[t._v(t._s(t.typeDescription)),t.isToRemoveMe&&t.proposal.status===t.statuses.STATUS_OPEN?e("tooltip",{staticClass:"c-tip",attrs:{direction:"top",text:t.L("You cannot vote.")}},[e("div",{staticClass:"button is-icon-smaller is-primary"},[e("i",{staticClass:"icon-question"})])]):t._e()],1),e("p",{directives:[{name:"safe-html",rawName:"v-safe-html",value:t.subtitle,expression:"subtitle"}],staticClass:"c-content-title",attrs:{"data-test":"title"}}),e("p",{staticClass:"has-text-1",class:{"has-text-danger":t.proposal.status===t.statuses.STATUS_FAILED,"has-text-success":t.proposal.status===t.statuses.STATUS_PASSED},attrs:{"data-test":"statusDescription"}},[t._v(t._s(t.statusDescription))]),t.humanReason?e("div",{staticClass:"c-reason"},[t.humanReason?e("p",{staticClass:"has-text-1 c-reason-text"},[t._v(t._s(t.humanReason))]):t._e(),t._v("\xA0"),t.shouldTruncateReason?e("button",{staticClass:"link",attrs:{type:"button"},on:{click:t.toggleReason}},[t._v(t._s(t.ephemeral.isReasonHidden?t.L("Read more"):t.L("Hide")))]):t._e()]):t._e(),e("banner-scoped",{ref:"voteMsg",attrs:{"data-test":"voteMsg"}}),t.invitationLink?e("p",{staticClass:"c-sendLink",attrs:{"data-test":"sendLink"}},[e("i18n",{attrs:{args:{user:t.proposal.data.proposalData.memberName}}},[t._v("Please send the following link to {user} so they can join the group:")]),e("link-to-copy",{staticClass:"c-invite-link",attrs:{link:t.invitationLink,tag:"p"}}),t.isExpiredInvitationLink?e("i18n",{staticClass:"has-text-danger"},[t._v("Expired")]):t._e()],1):t._e()],1),t.proposal.status===t.statuses.STATUS_OPEN?e("proposal-vote-options",{attrs:{proposalHash:t.proposalHash}}):t._e()],1)])])},nt=[],it=function(t){t&&t("data-v-1a5d1a48_0",{source:'.c-item-wrapper[data-v-1a5d1a48]{margin-top:2rem}.c-item-wrapper[data-v-1a5d1a48]:not(:last-child){padding-bottom:2rem;border-bottom:1px solid var(--general_1)}.c-item[data-v-1a5d1a48]{display:flex;align-items:flex-start}@media screen and (max-width:768px){.c-item[data-v-1a5d1a48]{flex-wrap:wrap}}.c-main[data-v-1a5d1a48]{grid-template-columns:auto 1fr auto;display:grid;grid-template-areas:"icons content actions";width:100%}@media screen and (max-width:768px){.c-main[data-v-1a5d1a48]{grid-template-areas:"icons content content" "icons actions actions"}}.c-main-content[data-v-1a5d1a48]{flex-grow:1}.c-main .c-content-title[data-v-1a5d1a48]{word-break:break-word}.c-tip[data-v-1a5d1a48]{margin-left:.25rem}.c-sendLink[data-v-1a5d1a48]{border-radius:.25rem;background-color:var(--general_2);padding:1.1875rem 1rem;margin-top:1rem;display:grid}@media screen and (min-width:769px),print{.c-sendLink[data-v-1a5d1a48]{padding:1rem}}.c-sendLink .c-invite-link[data-v-1a5d1a48]  .c-copy-button{background:var(--background_0)}@media screen and (max-width:768px){.icon-round[data-v-1a5d1a48]{margin-left:.5rem}}.c-icons[data-v-1a5d1a48]{position:relative;align-self:flex-start;grid-area:icons}.c-icons .icon-round[data-v-1a5d1a48]{width:3.75rem;height:3.75rem;display:grid;align-items:center}@media screen and (max-width:768px){.c-icons .icon-round[data-v-1a5d1a48]{width:2.75rem;height:2.75rem}}.c-icons .c-avatar[data-v-1a5d1a48]{position:absolute;bottom:-.2rem;right:1rem}@media screen and (max-width:768px){.c-icons .c-avatar[data-v-1a5d1a48]{display:none}}.c-reason[data-v-1a5d1a48]{position:relative;margin-top:1rem}.c-reason-text[data-v-1a5d1a48]{display:inline}',map:void 0,media:void 0})},dt="data-v-1a5d1a48",ct=void 0,pt=!1;function lt(t,o,e,d,n,i,s,p,l,u){let a=(typeof e=="function"?e.options:e)||{};a.__file=`style>
`,a.render||(a.render=t.render,a.staticRenderFns=t.staticRenderFns,a._compiled=!0,n&&(a.functional=!0)),a._scopeId=d;{let m;if(o&&(m=s?function(c){o.call(this,u(c,this.$root.$options.shadowRoot))}:function(c){o.call(this,p(c))}),m!==void 0)if(a.functional){let c=a.render;a.render=function(D,y){return m.call(y),c(D,y)}}else{let c=a.beforeCreate;a.beforeCreate=c?[].concat(c,m):[m]}}return a}function M(){let t=M.styles||(M.styles={}),o=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(d,n){if(document.querySelector('style[data-vue-ssr-id~="'+d+'"]'))return;let i=o?n.media||"default":d,s=t[i]||(t[i]={ids:[],parts:[],element:void 0});if(!s.ids.includes(d)){let p=n.source,l=s.ids.length;if(s.ids.push(d),n.map&&(p+=`
/*# sourceURL=`+n.map.sources[0]+" */",p+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),o&&(s.element=s.element||document.querySelector("style[data-group="+i+"]")),!s.element){let u=document.head||document.getElementsByTagName("head")[0],a=s.element=document.createElement("style");a.type="text/css",n.media&&a.setAttribute("media",n.media),o&&(a.setAttribute("data-group",i),a.setAttribute("data-next-index","0")),u.appendChild(a)}if(o&&(l=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",l+1)),s.element.styleSheet)s.parts.push(p),s.element.styleSheet.cssText=s.parts.filter(Boolean).join(`
`);else{let u=document.createTextNode(p),a=s.element.childNodes;a[l]&&s.element.removeChild(a[l]),a.length?s.element.insertBefore(u,a[l]):s.element.appendChild(u)}}}}var ut=lt({render:rt,staticRenderFns:nt},it,st,dt,pt,ct,!1,M,void 0,void 0),Pt=ut;export{Pt as a};
//# sourceMappingURL=chunk-BJ3O63BX-cached.js.map
