import{a as $}from"./chunk-VJZRITMK-cached.js";import{f as w}from"./chunk-QD6O46IB-cached.js";import{a as x}from"./chunk-WMVHT3GJ-cached.js";import{a as S}from"./chunk-XHZPFS4B-cached.js";import{a as C,c as R}from"./chunk-6P74MMKF-cached.js";import{f as v}from"./chunk-VUYUNB2W-cached.js";import{b as N}from"./chunk-B4L7IMS4-cached.js";import"./chunk-R4DRX7L2-cached.js";import{a as A}from"./chunk-FTWBMR5D-cached.js";import{a as I}from"./chunk-BZWIYGWR-cached.js";import"./chunk-SVSS5DEP-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import"./chunk-M3EDVPDK-cached.js";import{b as c}from"./chunk-33M5GGRR-cached.js";import{a as p}from"./chunk-OMOH7TRL-cached.js";import{d as y}from"./chunk-WBBXU2FL-cached.js";import{e as b}from"./chunk-XMZXE55N-cached.js";var T=b(A()),_=b(N());var F={name:"AccountRemovalModal",mixins:[T.validationMixin,S],components:{ModalTemplate:I,BannerSimple:C,BannerScoped:R,ButtonSubmit:x,PasswordForm:$},beforeMount(){p("chelonia/out/ownResources",this.ourIdentityContractId).then(e=>{let s=p("state/vuex/state");this.ownResources=e.filter(t=>s.contracts[t]?.type==="gi.contracts/group").map(t=>p("state/vuex/getters").groupSettingsForGroup(s[t]).groupName)}).catch(e=>{this.ownResources=new Error(e?.message),console.error("Error fetching own resources",{contractID:this.ourIdentityContractId},e)})},data(){return{form:{username:null,confirmation:null,password:null},ownResources:null}},computed:{...y(["groupSettings","ourUsername","ourIdentityContractId"]),code(){return c("DELETE ACCOUNT")}},methods:{close(){this.$refs.modal.close()},async submit(){if(!this.$v.form.$invalid)try{await p("gi.app/identity/delete",this.ourIdentityContractId,new w(this.form.password)),this.close()}catch(e){console.error("AccountRemovalModal submit() error:",e),this.$refs.formMsg.danger(e.message)}}},validations:{form:{username:{[c("This field is required")]:_.required,[c("Your username is different")]:function(e){return e===this.ourUsername}},confirmation:{[c("This field is required")]:_.required,[c("Does not match")]:function(e){return v(e)===v(this.code)}},password:{[c("Your current password is required.")]:_.required}}}},L=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("modal-template",{ref:"modal",attrs:{a11yTitle:e.L("Delete account")}},[t("template",{slot:"title"},[t("i18n",[e._v("Delete account")])],1),t("form",{attrs:{novalidate:"novalidate","data-test":"deleteAccount"},on:{submit:function(n){n.preventDefault()}}},[t("i18n",{attrs:{tag:"p"}},[e._v("Deleting your account will erase all your data, and remove you from the groups you belong to.")]),t("banner-simple",{staticClass:"c-banner",attrs:{severity:"danger"}},[t("i18n",{attrs:{args:e.LTags("strong")}},[e._v("This action {strong_}cannot be undone{_strong}.")])],1),e.ownResources?Array.isArray(e.ownResources)&&e.ownResources.length?t("banner-simple",{staticClass:"c-banner",attrs:{severity:"warning"}},[t("i18n",{attrs:{tag:"p"}},[e._v("This action will also delete the following groups:")]),t("ul",{staticClass:"c-list"},e._l(e.ownResources,function(n){return t("li",{staticClass:"c-item"},[e._v(e._s(n))])}),0)],1):e.ownResources.message?t("banner-simple",{staticClass:"c-banner",attrs:{severity:"danger"}},[t("i18n",{attrs:{tag:"p"}},[e._v("This action will also delete any groups you've created.")]),t("i18n",{attrs:{tag:"p",args:{message:e.ownResources.message}}},[e._v("An error occurred that prevents us from showing a list of these groups. The error was: {message}")])],1):e._e():t("banner-simple",{staticClass:"c-banner",attrs:{severity:"general"}},[t("i18n",[e._v("Loading")])],1),t("label",{staticClass:"field"},[t("i18n",{staticClass:"label"},[e._v("Username")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.username,expression:"form.username"},{name:"error",rawName:"v-error:username",value:{attrs:{"data-test":"usernameError"}},expression:'{ attrs: { "data-test": "usernameError" } }',arg:"username"}],staticClass:"input",class:{error:e.$v.form.username.$error},attrs:{type:"text","data-test":"username"},domProps:{value:e.form.username},on:{input:[function(n){n.target.composing||e.$set(e.form,"username",n.target.value)},function(n){return e.debounceField("username")}],blur:function(n){return e.updateField("username")}}})],1),t("password-form",{attrs:{name:"password",label:e.L("Password"),value:e.form,$v:e.$v,hasIconRight:!0,showPlaceholder:!1,showPassword:!1,size:"is-large"}}),t("label",{staticClass:"field"},[t("i18n",{staticClass:"label",attrs:{args:{code:e.code}}},[e._v('Type "{code}" below')]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.confirmation,expression:"form.confirmation"},{name:"error",rawName:"v-error:confirmation",value:{attrs:{"data-test":"confirmationError"}},expression:'{ attrs: { "data-test": "confirmationError" } }',arg:"confirmation"}],staticClass:"input",class:{error:e.$v.form.confirmation.$error},attrs:{type:"text","data-test":"confirmation"},domProps:{value:e.form.confirmation},on:{input:[function(n){n.target.composing||e.$set(e.form,"confirmation",n.target.value)},function(n){return e.debounceField("confirmation")}],blur:function(n){return e.updateField("confirmation")}}})],1),t("banner-scoped",{ref:"formMsg"}),t("div",{staticClass:"buttons"},[t("i18n",{staticClass:"is-outlined",attrs:{tag:"button",type:"button"},on:{click:e.close}},[e._v("Cancel")]),t("button-submit",{staticClass:"is-danger",attrs:{disabled:e.$v.form.$invalid||!this.ownResources,"data-test":"btnSubmit"},on:{click:e.submit}},[e._v(e._s(e.L("Delete account")))])],1)],1)],2)},D=[],M=function(e){e&&e("data-v-2de0526d_0",{source:".c-banner[data-v-2de0526d]{margin:1.5rem 0}",map:void 0,media:void 0})},U="data-v-2de0526d",j=void 0,q=!1;function B(e,s,t,n,a,m,o,u,l,d){let r=(typeof t=="function"?t.options:t)||{};r.__file=`style>
`,r.render||(r.render=e.render,r.staticRenderFns=e.staticRenderFns,r._compiled=!0,a&&(r.functional=!0)),r._scopeId=n;{let f;if(s&&(f=o?function(i){s.call(this,d(i,this.$root.$options.shadowRoot))}:function(i){s.call(this,u(i))}),f!==void 0)if(r.functional){let i=r.render;r.render=function(E,h){return f.call(h),i(E,h)}}else{let i=r.beforeCreate;r.beforeCreate=i?[].concat(i,f):[f]}}return r}function g(){let e=g.styles||(g.styles={}),s=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,a){if(document.querySelector('style[data-vue-ssr-id~="'+n+'"]'))return;let m=s?a.media||"default":n,o=e[m]||(e[m]={ids:[],parts:[],element:void 0});if(!o.ids.includes(n)){let u=a.source,l=o.ids.length;if(o.ids.push(n),a.map&&(u+=`
/*# sourceURL=`+a.map.sources[0]+" */",u+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(a.map))))+" */"),s&&(o.element=o.element||document.querySelector("style[data-group="+m+"]")),!o.element){let d=document.head||document.getElementsByTagName("head")[0],r=o.element=document.createElement("style");r.type="text/css",a.media&&r.setAttribute("media",a.media),s&&(r.setAttribute("data-group",m),r.setAttribute("data-next-index","0")),d.appendChild(r)}if(s&&(l=parseInt(o.element.getAttribute("data-next-index")),o.element.setAttribute("data-next-index",l+1)),o.element.styleSheet)o.parts.push(u),o.element.styleSheet.cssText=o.parts.filter(Boolean).join(`
`);else{let d=document.createTextNode(u),r=o.element.childNodes;r[l]&&o.element.removeChild(r[l]),r.length?o.element.insertBefore(d,r[l]):o.element.appendChild(d)}}}}var P=B({render:L,staticRenderFns:D},M,F,U,q,j,!1,g,void 0,void 0),Z=P;export{Z as default};
//# sourceMappingURL=AccountRemovalModal-DXHPS7NI-cached.js.map
