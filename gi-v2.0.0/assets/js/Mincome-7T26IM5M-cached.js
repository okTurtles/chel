import{a as h}from"./chunk-NGBII4BC-cached.js";import"./chunk-GB4D3I4D-cached.js";import"./chunk-Q5WT7Z5S-cached.js";import{b as a,c as d,d as f}from"./chunk-OYX4NVDU-cached.js";import"./chunk-MMWHE4QG-cached.js";import"./chunk-LIW6QCF4-cached.js";import"./chunk-WMVHT3GJ-cached.js";import{c as _}from"./chunk-6P74MMKF-cached.js";import{b as $}from"./chunk-B4L7IMS4-cached.js";import{l as m}from"./chunk-SZPI64OI-cached.js";import"./chunk-R4DRX7L2-cached.js";import{a as x}from"./chunk-FTWBMR5D-cached.js";import"./chunk-BZWIYGWR-cached.js";import"./chunk-SVSS5DEP-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import"./chunk-M3EDVPDK-cached.js";import{b as i}from"./chunk-33M5GGRR-cached.js";import{a as c}from"./chunk-OMOH7TRL-cached.js";import{b as p,d as l}from"./chunk-WBBXU2FL-cached.js";import{e as u}from"./chunk-XMZXE55N-cached.js";var g=u(x()),v=u($());var y={name:"MincomeProposal",components:{ProposalTemplate:h,BannerScoped:_},mixins:[g.validationMixin],data(){return{form:{mincomeAmount:null},ephemeral:{errorMsg:null,currentStep:0},config:{steps:["GroupMincome"]}}},watch:{"ephemeral.currentStep":function(e){e===1&&this.groupShouldPropose&&this.validateMincome()}},validations:{form:{mincomeAmount:{[i("This field is required")]:v.required,[i("The amount must be a number. (E.g. 100.75)")]:function(e){return f[this.groupSettings.mincomeCurrency].validate(e)},[i("Mincome must be greater than 0")]:d}},steps:{GroupMincome:["form.mincomeAmount"]}},computed:{...p(["currentGroupId"]),...l(["groupShouldPropose","groupSettings","groupMembersCount","groupMincomeFormatted","groupMincomeSymbolWithCode"])},mounted(){this.$refs.mincomeAmount.focus()},methods:{validateMincome(){return a(this.form.mincomeAmount)===this.groupSettings.mincomeAmount?(this.$refs.formMsg.danger(i("The new mincome should be different than the current one.")),this.ephemeral.currentStep=0,!1):(this.$refs.formMsg.clean(),!0)},async submit(e){if(!this.validateMincome())return;let r=a(this.form.mincomeAmount);if(this.groupShouldPropose){try{await c("gi.actions/group/proposal",{contractID:this.currentGroupId,data:{proposalType:m,proposalData:{setting:"mincomeAmount",proposedValue:r,currentValue:this.groupSettings.mincomeAmount,mincomeCurrency:this.groupSettings.mincomeCurrency,reason:e.reason},votingRule:this.groupSettings.proposals[m].rule,expires_date_ms:Date.now()+this.groupSettings.proposals[m].expires_ms}}),this.ephemeral.currentStep+=1}catch(t){this.$refs.formMsg.danger(t.message),this.ephemeral.currentStep=0}return}try{await c("gi.actions/group/updateSettings",{contractID:this.currentGroupId,data:{mincomeAmount:r}}),this.$refs.proposal.close()}catch(t){console.error("Mincome.vue submit() error:",t),this.$refs.formMsg.danger(t.message)}}}},C=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("proposal-template",{ref:"proposal",attrs:{title:e.L("Change minimum income"),disabled:e.$v.form.$invalid,maxSteps:e.config.steps.length,currentStep:e.ephemeral.currentStep},on:{"update:currentStep":function(o){return e.$set(e.ephemeral,"currentStep",o)},"update:current-step":function(o){return e.$set(e.ephemeral,"currentStep",o)},submit:e.submit}},[e.ephemeral.currentStep===0?t("label",{key:"0",staticClass:"field"},[t("i18n",{staticClass:"label"},[e._v("New minimum income")]),t("div",{directives:[{name:"error",rawName:"v-error:mincomeAmount",arg:"mincomeAmount"}],staticClass:"inputgroup",class:{error:e.$v.form.mincomeAmount.$error}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.$v.form.mincomeAmount.$model,expression:"$v.form.mincomeAmount.$model"}],ref:"mincomeAmount",staticClass:"input",attrs:{name:"mincomeAmount",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.$v.form.mincomeAmount.$model},on:{input:function(o){o.target.composing||e.$set(e.$v.form.mincomeAmount,"$model",o.target.value)}}}),t("div",{staticClass:"suffix"},[e._v(e._s(e.groupMincomeSymbolWithCode))])]),t("i18n",{staticClass:"helper",attrs:{args:{groupMincomeFormatted:e.groupMincomeFormatted}}},[e._v("Currently {groupMincomeFormatted} monthly.")])],1):e._e(),t("banner-scoped",{ref:"formMsg",attrs:{"data-test":"proposalError"}})],1)},M=[],A=void 0,b="data-v-6c57176a",I=void 0,R=!1;function w(e,r,t,o,S,P,k,E,G,j){let n=(typeof t=="function"?t.options:t)||{};return n.__file=`style>
`,n.render||(n.render=e.render,n.staticRenderFns=e.staticRenderFns,n._compiled=!0,S&&(n.functional=!0)),n._scopeId=o,n}var T=w({render:C,staticRenderFns:M},A,y,b,R,I,!1,void 0,void 0,void 0),B=T;export{B as default};
//# sourceMappingURL=Mincome-7T26IM5M-cached.js.map
