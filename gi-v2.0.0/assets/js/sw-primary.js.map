{
  "version": 3,
  "sources": ["../../../node_modules/blakejs/util.js", "../../../node_modules/blakejs/blake2b.js", "../../../node_modules/blakejs/blake2s.js", "../../../node_modules/blakejs/index.js", "../../../node_modules/base64-js/index.js", "../../../node_modules/ieee754/index.js", "../../../node_modules/buffer/index.js", "../../../node_modules/scrypt-async/scrypt-async.js", "../../../node_modules/tweetnacl/nacl-fast.js", "../../../node_modules/@chelonia/serdes/dist/esm/index.js", "../../../frontend/model/contracts/shared/constants.js", "../../../frontend/common/common.js", "../../../node_modules/@sbp/sbp/dist/esm/index.js", "../../../frontend/common/stringTemplate.js", "../../../frontend/common/translations.js", "../../../frontend/common/errors.js", "../../../shared/domains/chelonia/errors.js", "../../../frontend/model/contracts/shared/time.js", "../../../frontend/model/contracts/misc/flowTyper.js", "../../../frontend/model/notifications/periodicNotifications.js", "../../../frontend/model/notifications/storageConstants.js", "../../../node_modules/@chelonia/multiformats/dist/esm/bytes.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/base-x.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/bases/base.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/bases/base58.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/blake2b.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/vendor/varint.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/varint.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/hashes/digest.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/hasher.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/blake2bstream.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/bases/base32.mjs", "../../../node_modules/@chelonia/multiformats/dist/esm/cid.mjs", "../../../shared/functions.js", "../../../node_modules/turtledash/dist/esm/index.js", "../../../frontend/model/notifications/utils.js", "../../../frontend/model/notifications/mainPeriodicNotificationEntries.js", "../../../frontend/model/notifications/nativeNotification.js", "../../../frontend/utils/events.js", "../../../frontend/utils/constants.js", "../../../shared/CircularList.js", "../../../frontend/model/logger.js", "../../../node_modules/@sbp/okturtles.data/dist/module.mjs", "../../../node_modules/@sbp/okturtles.events/dist/esm/index.js", "../../../frontend/model/logServer.js", "../../../frontend/model/swCaptureLogs.js", "../../../node_modules/@sbp/okturtles.eventqueue/dist/esm/index.js", "../../../node_modules/@chelonia/crypto/dist/esm/index.mjs", "../../../shared/domains/chelonia/signedData.js", "../../../shared/domains/chelonia/encryptedData.js", "../../../shared/domains/chelonia/SPMessage.js", "../../../shared/domains/chelonia/Secret.js", "../../../shared/domains/chelonia/constants.js", "../../../shared/domains/chelonia/events.js", "../../../shared/domains/chelonia/utils.js", "../../../frontend/controller/actions/utils.js", "../../../frontend/model/contracts/shared/functions.js", "../../../frontend/model/chatroom/utils.js", "../../../frontend/model/notifications/messageReceivePostEffect.js", "../../../frontend/controller/actions/chatroom.js", "../../../frontend/model/contracts/shared/voting/rules.js", "../../../frontend/model/contracts/shared/voting/proposals.js", "../../../frontend/utils/image.js", "../../../frontend/controller/actions/group.js", "../../../frontend/controller/actions/group-kv.js", "../../../frontend/model/database.js", "../../../frontend/controller/utils/misc.js", "../../../frontend/controller/actions/identity.js", "../../../frontend/controller/actions/identity-kv.js", "../../../frontend/controller/actions/index.js", "../../../frontend/model/chatroom/getters.js", "../../../frontend/model/contracts/shared/currencies.js", "../../../frontend/model/contracts/shared/distribution/mincome-proportional.js", "../../../frontend/model/contracts/shared/distribution/payments-minimizer.js", "../../../frontend/model/contracts/shared/distribution/distribution.js", "../../../frontend/model/contracts/shared/payments/index.js", "../../../frontend/model/contracts/shared/getters/chatroom.js", "../../../frontend/model/contracts/shared/getters/group.js", "../../../frontend/model/contracts/shared/getters/identity.js", "../../../frontend/model/getters.js", "../../../frontend/model/notifications/getters.js", "../../../frontend/model/notifications/templates.js", "../../../frontend/model/notifications/selectors.js", "../../../shared/pubsub.js", "../../../shared/domains/chelonia/chelonia-utils.js", "../../../node_modules/@exact-realty/multipart-parser/dist/encodeMultipartMessage.mjs", "../../../node_modules/@apeleghq/rfc8188/dist/decrypt.mjs", "../../../node_modules/@apeleghq/rfc8188/dist/encodings.mjs", "../../../node_modules/@apeleghq/rfc8188/dist/encrypt.mjs", "../../../shared/domains/chelonia/files.js", "../../../shared/domains/chelonia/db.js", "../../../shared/domains/chelonia/internals.js", "../../../shared/domains/chelonia/time-sync.js", "../../../shared/domains/chelonia/chelonia.js", "../../../frontend/controller/instance-keys.js", "../../../frontend/model/contracts/manifests.json", "../../../frontend/setupChelonia.js", "../../../frontend/controller/serviceworkers/push.js", "../../../frontend/controller/serviceworkers/sw-namespace.js", "../../../frontend/controller/serviceworkers/sw-primary.js"],
  "sourcesContent": ["const ERROR_MSG_INPUT = 'Input must be an string, Buffer or Uint8Array'\n\n// For convenience, let people hash a string, not just a Uint8Array\nfunction normalizeInput (input) {\n  let ret\n  if (input instanceof Uint8Array) {\n    ret = input\n  } else if (typeof input === 'string') {\n    const encoder = new TextEncoder()\n    ret = encoder.encode(input)\n  } else {\n    throw new Error(ERROR_MSG_INPUT)\n  }\n  return ret\n}\n\n// Converts a Uint8Array to a hexadecimal string\n// For example, toHex([255, 0, 255]) returns \"ff00ff\"\nfunction toHex (bytes) {\n  return Array.prototype.map\n    .call(bytes, function (n) {\n      return (n < 16 ? '0' : '') + n.toString(16)\n    })\n    .join('')\n}\n\n// Converts any value in [0...2^32-1] to an 8-character hex string\nfunction uint32ToHex (val) {\n  return (0x100000000 + val).toString(16).substring(1)\n}\n\n// For debugging: prints out hash state in the same format as the RFC\n// sample computation exactly, so that you can diff\nfunction debugPrint (label, arr, size) {\n  let msg = '\\n' + label + ' = '\n  for (let i = 0; i < arr.length; i += 2) {\n    if (size === 32) {\n      msg += uint32ToHex(arr[i]).toUpperCase()\n      msg += ' '\n      msg += uint32ToHex(arr[i + 1]).toUpperCase()\n    } else if (size === 64) {\n      msg += uint32ToHex(arr[i + 1]).toUpperCase()\n      msg += uint32ToHex(arr[i]).toUpperCase()\n    } else throw new Error('Invalid size ' + size)\n    if (i % 6 === 4) {\n      msg += '\\n' + new Array(label.length + 4).join(' ')\n    } else if (i < arr.length - 2) {\n      msg += ' '\n    }\n  }\n  console.log(msg)\n}\n\n// For performance testing: generates N bytes of input, hashes M times\n// Measures and prints MB/second hash performance each time\nfunction testSpeed (hashFn, N, M) {\n  let startMs = new Date().getTime()\n\n  const input = new Uint8Array(N)\n  for (let i = 0; i < N; i++) {\n    input[i] = i % 256\n  }\n  const genMs = new Date().getTime()\n  console.log('Generated random input in ' + (genMs - startMs) + 'ms')\n  startMs = genMs\n\n  for (let i = 0; i < M; i++) {\n    const hashHex = hashFn(input)\n    const hashMs = new Date().getTime()\n    const ms = hashMs - startMs\n    startMs = hashMs\n    console.log('Hashed in ' + ms + 'ms: ' + hashHex.substring(0, 20) + '...')\n    console.log(\n      Math.round((N / (1 << 20) / (ms / 1000)) * 100) / 100 + ' MB PER SECOND'\n    )\n  }\n}\n\nmodule.exports = {\n  normalizeInput: normalizeInput,\n  toHex: toHex,\n  debugPrint: debugPrint,\n  testSpeed: testSpeed\n}\n", "// Blake2B in pure Javascript\n// Adapted from the reference implementation in RFC7693\n// Ported to Javascript by DC - https://github.com/dcposch\n\nconst util = require('./util')\n\n// 64-bit unsigned addition\n// Sets v[a,a+1] += v[b,b+1]\n// v should be a Uint32Array\nfunction ADD64AA (v, a, b) {\n  const o0 = v[a] + v[b]\n  let o1 = v[a + 1] + v[b + 1]\n  if (o0 >= 0x100000000) {\n    o1++\n  }\n  v[a] = o0\n  v[a + 1] = o1\n}\n\n// 64-bit unsigned addition\n// Sets v[a,a+1] += b\n// b0 is the low 32 bits of b, b1 represents the high 32 bits\nfunction ADD64AC (v, a, b0, b1) {\n  let o0 = v[a] + b0\n  if (b0 < 0) {\n    o0 += 0x100000000\n  }\n  let o1 = v[a + 1] + b1\n  if (o0 >= 0x100000000) {\n    o1++\n  }\n  v[a] = o0\n  v[a + 1] = o1\n}\n\n// Little-endian byte access\nfunction B2B_GET32 (arr, i) {\n  return arr[i] ^ (arr[i + 1] << 8) ^ (arr[i + 2] << 16) ^ (arr[i + 3] << 24)\n}\n\n// G Mixing function\n// The ROTRs are inlined for speed\nfunction B2B_G (a, b, c, d, ix, iy) {\n  const x0 = m[ix]\n  const x1 = m[ix + 1]\n  const y0 = m[iy]\n  const y1 = m[iy + 1]\n\n  ADD64AA(v, a, b) // v[a,a+1] += v[b,b+1] ... in JS we must store a uint64 as two uint32s\n  ADD64AC(v, a, x0, x1) // v[a, a+1] += x ... x0 is the low 32 bits of x, x1 is the high 32 bits\n\n  // v[d,d+1] = (v[d,d+1] xor v[a,a+1]) rotated to the right by 32 bits\n  let xor0 = v[d] ^ v[a]\n  let xor1 = v[d + 1] ^ v[a + 1]\n  v[d] = xor1\n  v[d + 1] = xor0\n\n  ADD64AA(v, c, d)\n\n  // v[b,b+1] = (v[b,b+1] xor v[c,c+1]) rotated right by 24 bits\n  xor0 = v[b] ^ v[c]\n  xor1 = v[b + 1] ^ v[c + 1]\n  v[b] = (xor0 >>> 24) ^ (xor1 << 8)\n  v[b + 1] = (xor1 >>> 24) ^ (xor0 << 8)\n\n  ADD64AA(v, a, b)\n  ADD64AC(v, a, y0, y1)\n\n  // v[d,d+1] = (v[d,d+1] xor v[a,a+1]) rotated right by 16 bits\n  xor0 = v[d] ^ v[a]\n  xor1 = v[d + 1] ^ v[a + 1]\n  v[d] = (xor0 >>> 16) ^ (xor1 << 16)\n  v[d + 1] = (xor1 >>> 16) ^ (xor0 << 16)\n\n  ADD64AA(v, c, d)\n\n  // v[b,b+1] = (v[b,b+1] xor v[c,c+1]) rotated right by 63 bits\n  xor0 = v[b] ^ v[c]\n  xor1 = v[b + 1] ^ v[c + 1]\n  v[b] = (xor1 >>> 31) ^ (xor0 << 1)\n  v[b + 1] = (xor0 >>> 31) ^ (xor1 << 1)\n}\n\n// Initialization Vector\nconst BLAKE2B_IV32 = new Uint32Array([\n  0xf3bcc908, 0x6a09e667, 0x84caa73b, 0xbb67ae85, 0xfe94f82b, 0x3c6ef372,\n  0x5f1d36f1, 0xa54ff53a, 0xade682d1, 0x510e527f, 0x2b3e6c1f, 0x9b05688c,\n  0xfb41bd6b, 0x1f83d9ab, 0x137e2179, 0x5be0cd19\n])\n\nconst SIGMA8 = [\n  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 14, 10, 4, 8, 9, 15, 13,\n  6, 1, 12, 0, 2, 11, 7, 5, 3, 11, 8, 12, 0, 5, 2, 15, 13, 10, 14, 3, 6, 7, 1,\n  9, 4, 7, 9, 3, 1, 13, 12, 11, 14, 2, 6, 5, 10, 4, 0, 15, 8, 9, 0, 5, 7, 2, 4,\n  10, 15, 14, 1, 11, 12, 6, 8, 3, 13, 2, 12, 6, 10, 0, 11, 8, 3, 4, 13, 7, 5,\n  15, 14, 1, 9, 12, 5, 1, 15, 14, 13, 4, 10, 0, 7, 6, 3, 9, 2, 8, 11, 13, 11, 7,\n  14, 12, 1, 3, 9, 5, 0, 15, 4, 8, 6, 2, 10, 6, 15, 14, 9, 11, 3, 0, 8, 12, 2,\n  13, 7, 1, 4, 10, 5, 10, 2, 8, 4, 7, 6, 1, 5, 15, 11, 9, 14, 3, 12, 13, 0, 0,\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 14, 10, 4, 8, 9, 15, 13, 6,\n  1, 12, 0, 2, 11, 7, 5, 3\n]\n\n// These are offsets into a uint64 buffer.\n// Multiply them all by 2 to make them offsets into a uint32 buffer,\n// because this is Javascript and we don't have uint64s\nconst SIGMA82 = new Uint8Array(\n  SIGMA8.map(function (x) {\n    return x * 2\n  })\n)\n\n// Compression function. 'last' flag indicates last block.\n// Note we're representing 16 uint64s as 32 uint32s\nconst v = new Uint32Array(32)\nconst m = new Uint32Array(32)\nfunction blake2bCompress (ctx, last) {\n  let i = 0\n\n  // init work variables\n  for (i = 0; i < 16; i++) {\n    v[i] = ctx.h[i]\n    v[i + 16] = BLAKE2B_IV32[i]\n  }\n\n  // low 64 bits of offset\n  v[24] = v[24] ^ ctx.t\n  v[25] = v[25] ^ (ctx.t / 0x100000000)\n  // high 64 bits not supported, offset may not be higher than 2**53-1\n\n  // last block flag set ?\n  if (last) {\n    v[28] = ~v[28]\n    v[29] = ~v[29]\n  }\n\n  // get little-endian words\n  for (i = 0; i < 32; i++) {\n    m[i] = B2B_GET32(ctx.b, 4 * i)\n  }\n\n  // twelve rounds of mixing\n  // uncomment the DebugPrint calls to log the computation\n  // and match the RFC sample documentation\n  // util.debugPrint('          m[16]', m, 64)\n  for (i = 0; i < 12; i++) {\n    // util.debugPrint('   (i=' + (i < 10 ? ' ' : '') + i + ') v[16]', v, 64)\n    B2B_G(0, 8, 16, 24, SIGMA82[i * 16 + 0], SIGMA82[i * 16 + 1])\n    B2B_G(2, 10, 18, 26, SIGMA82[i * 16 + 2], SIGMA82[i * 16 + 3])\n    B2B_G(4, 12, 20, 28, SIGMA82[i * 16 + 4], SIGMA82[i * 16 + 5])\n    B2B_G(6, 14, 22, 30, SIGMA82[i * 16 + 6], SIGMA82[i * 16 + 7])\n    B2B_G(0, 10, 20, 30, SIGMA82[i * 16 + 8], SIGMA82[i * 16 + 9])\n    B2B_G(2, 12, 22, 24, SIGMA82[i * 16 + 10], SIGMA82[i * 16 + 11])\n    B2B_G(4, 14, 16, 26, SIGMA82[i * 16 + 12], SIGMA82[i * 16 + 13])\n    B2B_G(6, 8, 18, 28, SIGMA82[i * 16 + 14], SIGMA82[i * 16 + 15])\n  }\n  // util.debugPrint('   (i=12) v[16]', v, 64)\n\n  for (i = 0; i < 16; i++) {\n    ctx.h[i] = ctx.h[i] ^ v[i] ^ v[i + 16]\n  }\n  // util.debugPrint('h[8]', ctx.h, 64)\n}\n\n// reusable parameterBlock\nconst parameterBlock = new Uint8Array([\n  0,\n  0,\n  0,\n  0, //  0: outlen, keylen, fanout, depth\n  0,\n  0,\n  0,\n  0, //  4: leaf length, sequential mode\n  0,\n  0,\n  0,\n  0, //  8: node offset\n  0,\n  0,\n  0,\n  0, // 12: node offset\n  0,\n  0,\n  0,\n  0, // 16: node depth, inner length, rfu\n  0,\n  0,\n  0,\n  0, // 20: rfu\n  0,\n  0,\n  0,\n  0, // 24: rfu\n  0,\n  0,\n  0,\n  0, // 28: rfu\n  0,\n  0,\n  0,\n  0, // 32: salt\n  0,\n  0,\n  0,\n  0, // 36: salt\n  0,\n  0,\n  0,\n  0, // 40: salt\n  0,\n  0,\n  0,\n  0, // 44: salt\n  0,\n  0,\n  0,\n  0, // 48: personal\n  0,\n  0,\n  0,\n  0, // 52: personal\n  0,\n  0,\n  0,\n  0, // 56: personal\n  0,\n  0,\n  0,\n  0 // 60: personal\n])\n\n// Creates a BLAKE2b hashing context\n// Requires an output length between 1 and 64 bytes\n// Takes an optional Uint8Array key\n// Takes an optinal Uint8Array salt\n// Takes an optinal Uint8Array personal\nfunction blake2bInit (outlen, key, salt, personal) {\n  if (outlen === 0 || outlen > 64) {\n    throw new Error('Illegal output length, expected 0 < length <= 64')\n  }\n  if (key && key.length > 64) {\n    throw new Error('Illegal key, expected Uint8Array with 0 < length <= 64')\n  }\n  if (salt && salt.length !== 16) {\n    throw new Error('Illegal salt, expected Uint8Array with length is 16')\n  }\n  if (personal && personal.length !== 16) {\n    throw new Error('Illegal personal, expected Uint8Array with length is 16')\n  }\n\n  // state, 'param block'\n  const ctx = {\n    b: new Uint8Array(128),\n    h: new Uint32Array(16),\n    t: 0, // input count\n    c: 0, // pointer within buffer\n    outlen: outlen // output length in bytes\n  }\n\n  // initialize parameterBlock before usage\n  parameterBlock.fill(0)\n  parameterBlock[0] = outlen\n  if (key) parameterBlock[1] = key.length\n  parameterBlock[2] = 1 // fanout\n  parameterBlock[3] = 1 // depth\n  if (salt) parameterBlock.set(salt, 32)\n  if (personal) parameterBlock.set(personal, 48)\n\n  // initialize hash state\n  for (let i = 0; i < 16; i++) {\n    ctx.h[i] = BLAKE2B_IV32[i] ^ B2B_GET32(parameterBlock, i * 4)\n  }\n\n  // key the hash, if applicable\n  if (key) {\n    blake2bUpdate(ctx, key)\n    // at the end\n    ctx.c = 128\n  }\n\n  return ctx\n}\n\n// Updates a BLAKE2b streaming hash\n// Requires hash context and Uint8Array (byte array)\nfunction blake2bUpdate (ctx, input) {\n  for (let i = 0; i < input.length; i++) {\n    if (ctx.c === 128) {\n      // buffer full ?\n      ctx.t += ctx.c // add counters\n      blake2bCompress(ctx, false) // compress (not last)\n      ctx.c = 0 // counter to zero\n    }\n    ctx.b[ctx.c++] = input[i]\n  }\n}\n\n// Completes a BLAKE2b streaming hash\n// Returns a Uint8Array containing the message digest\nfunction blake2bFinal (ctx) {\n  ctx.t += ctx.c // mark last block offset\n\n  while (ctx.c < 128) {\n    // fill up with zeros\n    ctx.b[ctx.c++] = 0\n  }\n  blake2bCompress(ctx, true) // final block flag = 1\n\n  // little endian convert and store\n  const out = new Uint8Array(ctx.outlen)\n  for (let i = 0; i < ctx.outlen; i++) {\n    out[i] = ctx.h[i >> 2] >> (8 * (i & 3))\n  }\n  return out\n}\n\n// Computes the BLAKE2B hash of a string or byte array, and returns a Uint8Array\n//\n// Returns a n-byte Uint8Array\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer or Uint8Array\n// - key - optional key Uint8Array, up to 64 bytes\n// - outlen - optional output length in bytes, default 64\n// - salt - optional salt bytes, string, Buffer or Uint8Array\n// - personal - optional personal bytes, string, Buffer or Uint8Array\nfunction blake2b (input, key, outlen, salt, personal) {\n  // preprocess inputs\n  outlen = outlen || 64\n  input = util.normalizeInput(input)\n  if (salt) {\n    salt = util.normalizeInput(salt)\n  }\n  if (personal) {\n    personal = util.normalizeInput(personal)\n  }\n\n  // do the math\n  const ctx = blake2bInit(outlen, key, salt, personal)\n  blake2bUpdate(ctx, input)\n  return blake2bFinal(ctx)\n}\n\n// Computes the BLAKE2B hash of a string or byte array\n//\n// Returns an n-byte hash in hex, all lowercase\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer, or Uint8Array\n// - key - optional key Uint8Array, up to 64 bytes\n// - outlen - optional output length in bytes, default 64\n// - salt - optional salt bytes, string, Buffer or Uint8Array\n// - personal - optional personal bytes, string, Buffer or Uint8Array\nfunction blake2bHex (input, key, outlen, salt, personal) {\n  const output = blake2b(input, key, outlen, salt, personal)\n  return util.toHex(output)\n}\n\nmodule.exports = {\n  blake2b: blake2b,\n  blake2bHex: blake2bHex,\n  blake2bInit: blake2bInit,\n  blake2bUpdate: blake2bUpdate,\n  blake2bFinal: blake2bFinal\n}\n", "// BLAKE2s hash function in pure Javascript\n// Adapted from the reference implementation in RFC7693\n// Ported to Javascript by DC - https://github.com/dcposch\n\nconst util = require('./util')\n\n// Little-endian byte access.\n// Expects a Uint8Array and an index\n// Returns the little-endian uint32 at v[i..i+3]\nfunction B2S_GET32 (v, i) {\n  return v[i] ^ (v[i + 1] << 8) ^ (v[i + 2] << 16) ^ (v[i + 3] << 24)\n}\n\n// Mixing function G.\nfunction B2S_G (a, b, c, d, x, y) {\n  v[a] = v[a] + v[b] + x\n  v[d] = ROTR32(v[d] ^ v[a], 16)\n  v[c] = v[c] + v[d]\n  v[b] = ROTR32(v[b] ^ v[c], 12)\n  v[a] = v[a] + v[b] + y\n  v[d] = ROTR32(v[d] ^ v[a], 8)\n  v[c] = v[c] + v[d]\n  v[b] = ROTR32(v[b] ^ v[c], 7)\n}\n\n// 32-bit right rotation\n// x should be a uint32\n// y must be between 1 and 31, inclusive\nfunction ROTR32 (x, y) {\n  return (x >>> y) ^ (x << (32 - y))\n}\n\n// Initialization Vector.\nconst BLAKE2S_IV = new Uint32Array([\n  0x6a09e667,\n  0xbb67ae85,\n  0x3c6ef372,\n  0xa54ff53a,\n  0x510e527f,\n  0x9b05688c,\n  0x1f83d9ab,\n  0x5be0cd19\n])\n\nconst SIGMA = new Uint8Array([\n  0,\n  1,\n  2,\n  3,\n  4,\n  5,\n  6,\n  7,\n  8,\n  9,\n  10,\n  11,\n  12,\n  13,\n  14,\n  15,\n  14,\n  10,\n  4,\n  8,\n  9,\n  15,\n  13,\n  6,\n  1,\n  12,\n  0,\n  2,\n  11,\n  7,\n  5,\n  3,\n  11,\n  8,\n  12,\n  0,\n  5,\n  2,\n  15,\n  13,\n  10,\n  14,\n  3,\n  6,\n  7,\n  1,\n  9,\n  4,\n  7,\n  9,\n  3,\n  1,\n  13,\n  12,\n  11,\n  14,\n  2,\n  6,\n  5,\n  10,\n  4,\n  0,\n  15,\n  8,\n  9,\n  0,\n  5,\n  7,\n  2,\n  4,\n  10,\n  15,\n  14,\n  1,\n  11,\n  12,\n  6,\n  8,\n  3,\n  13,\n  2,\n  12,\n  6,\n  10,\n  0,\n  11,\n  8,\n  3,\n  4,\n  13,\n  7,\n  5,\n  15,\n  14,\n  1,\n  9,\n  12,\n  5,\n  1,\n  15,\n  14,\n  13,\n  4,\n  10,\n  0,\n  7,\n  6,\n  3,\n  9,\n  2,\n  8,\n  11,\n  13,\n  11,\n  7,\n  14,\n  12,\n  1,\n  3,\n  9,\n  5,\n  0,\n  15,\n  4,\n  8,\n  6,\n  2,\n  10,\n  6,\n  15,\n  14,\n  9,\n  11,\n  3,\n  0,\n  8,\n  12,\n  2,\n  13,\n  7,\n  1,\n  4,\n  10,\n  5,\n  10,\n  2,\n  8,\n  4,\n  7,\n  6,\n  1,\n  5,\n  15,\n  11,\n  9,\n  14,\n  3,\n  12,\n  13,\n  0\n])\n\n// Compression function. \"last\" flag indicates last block\nconst v = new Uint32Array(16)\nconst m = new Uint32Array(16)\nfunction blake2sCompress (ctx, last) {\n  let i = 0\n  for (i = 0; i < 8; i++) {\n    // init work variables\n    v[i] = ctx.h[i]\n    v[i + 8] = BLAKE2S_IV[i]\n  }\n\n  v[12] ^= ctx.t // low 32 bits of offset\n  v[13] ^= ctx.t / 0x100000000 // high 32 bits\n  if (last) {\n    // last block flag set ?\n    v[14] = ~v[14]\n  }\n\n  for (i = 0; i < 16; i++) {\n    // get little-endian words\n    m[i] = B2S_GET32(ctx.b, 4 * i)\n  }\n\n  // ten rounds of mixing\n  // uncomment the DebugPrint calls to log the computation\n  // and match the RFC sample documentation\n  // util.debugPrint('          m[16]', m, 32)\n  for (i = 0; i < 10; i++) {\n    // util.debugPrint('   (i=' + i + ')  v[16]', v, 32)\n    B2S_G(0, 4, 8, 12, m[SIGMA[i * 16 + 0]], m[SIGMA[i * 16 + 1]])\n    B2S_G(1, 5, 9, 13, m[SIGMA[i * 16 + 2]], m[SIGMA[i * 16 + 3]])\n    B2S_G(2, 6, 10, 14, m[SIGMA[i * 16 + 4]], m[SIGMA[i * 16 + 5]])\n    B2S_G(3, 7, 11, 15, m[SIGMA[i * 16 + 6]], m[SIGMA[i * 16 + 7]])\n    B2S_G(0, 5, 10, 15, m[SIGMA[i * 16 + 8]], m[SIGMA[i * 16 + 9]])\n    B2S_G(1, 6, 11, 12, m[SIGMA[i * 16 + 10]], m[SIGMA[i * 16 + 11]])\n    B2S_G(2, 7, 8, 13, m[SIGMA[i * 16 + 12]], m[SIGMA[i * 16 + 13]])\n    B2S_G(3, 4, 9, 14, m[SIGMA[i * 16 + 14]], m[SIGMA[i * 16 + 15]])\n  }\n  // util.debugPrint('   (i=10) v[16]', v, 32)\n\n  for (i = 0; i < 8; i++) {\n    ctx.h[i] ^= v[i] ^ v[i + 8]\n  }\n  // util.debugPrint('h[8]', ctx.h, 32)\n}\n\n// Creates a BLAKE2s hashing context\n// Requires an output length between 1 and 32 bytes\n// Takes an optional Uint8Array key\nfunction blake2sInit (outlen, key) {\n  if (!(outlen > 0 && outlen <= 32)) {\n    throw new Error('Incorrect output length, should be in [1, 32]')\n  }\n  const keylen = key ? key.length : 0\n  if (key && !(keylen > 0 && keylen <= 32)) {\n    throw new Error('Incorrect key length, should be in [1, 32]')\n  }\n\n  const ctx = {\n    h: new Uint32Array(BLAKE2S_IV), // hash state\n    b: new Uint8Array(64), // input block\n    c: 0, // pointer within block\n    t: 0, // input count\n    outlen: outlen // output length in bytes\n  }\n  ctx.h[0] ^= 0x01010000 ^ (keylen << 8) ^ outlen\n\n  if (keylen > 0) {\n    blake2sUpdate(ctx, key)\n    ctx.c = 64 // at the end\n  }\n\n  return ctx\n}\n\n// Updates a BLAKE2s streaming hash\n// Requires hash context and Uint8Array (byte array)\nfunction blake2sUpdate (ctx, input) {\n  for (let i = 0; i < input.length; i++) {\n    if (ctx.c === 64) {\n      // buffer full ?\n      ctx.t += ctx.c // add counters\n      blake2sCompress(ctx, false) // compress (not last)\n      ctx.c = 0 // counter to zero\n    }\n    ctx.b[ctx.c++] = input[i]\n  }\n}\n\n// Completes a BLAKE2s streaming hash\n// Returns a Uint8Array containing the message digest\nfunction blake2sFinal (ctx) {\n  ctx.t += ctx.c // mark last block offset\n  while (ctx.c < 64) {\n    // fill up with zeros\n    ctx.b[ctx.c++] = 0\n  }\n  blake2sCompress(ctx, true) // final block flag = 1\n\n  // little endian convert and store\n  const out = new Uint8Array(ctx.outlen)\n  for (let i = 0; i < ctx.outlen; i++) {\n    out[i] = (ctx.h[i >> 2] >> (8 * (i & 3))) & 0xff\n  }\n  return out\n}\n\n// Computes the BLAKE2S hash of a string or byte array, and returns a Uint8Array\n//\n// Returns a n-byte Uint8Array\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer, or Uint8Array\n// - key - optional key Uint8Array, up to 32 bytes\n// - outlen - optional output length in bytes, default 64\nfunction blake2s (input, key, outlen) {\n  // preprocess inputs\n  outlen = outlen || 32\n  input = util.normalizeInput(input)\n\n  // do the math\n  const ctx = blake2sInit(outlen, key)\n  blake2sUpdate(ctx, input)\n  return blake2sFinal(ctx)\n}\n\n// Computes the BLAKE2S hash of a string or byte array\n//\n// Returns an n-byte hash in hex, all lowercase\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer, or Uint8Array\n// - key - optional key Uint8Array, up to 32 bytes\n// - outlen - optional output length in bytes, default 64\nfunction blake2sHex (input, key, outlen) {\n  const output = blake2s(input, key, outlen)\n  return util.toHex(output)\n}\n\nmodule.exports = {\n  blake2s: blake2s,\n  blake2sHex: blake2sHex,\n  blake2sInit: blake2sInit,\n  blake2sUpdate: blake2sUpdate,\n  blake2sFinal: blake2sFinal\n}\n", "const b2b = require('./blake2b')\nconst b2s = require('./blake2s')\n\nmodule.exports = {\n  blake2b: b2b.blake2b,\n  blake2bHex: b2b.blake2bHex,\n  blake2bInit: b2b.blake2bInit,\n  blake2bUpdate: b2b.blake2bUpdate,\n  blake2bFinal: b2b.blake2bFinal,\n  blake2s: b2s.blake2s,\n  blake2sHex: b2s.blake2sHex,\n  blake2sInit: b2s.blake2sInit,\n  blake2sUpdate: b2s.blake2sUpdate,\n  blake2sFinal: b2s.blake2sFinal\n}\n", "'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n", "/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n", "/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nconst base64 = require('base64-js')\nconst ieee754 = require('ieee754')\nconst customInspectSymbol =\n  (typeof Symbol === 'function' && typeof Symbol['for'] === 'function') // eslint-disable-line dot-notation\n    ? Symbol['for']('nodejs.util.inspect.custom') // eslint-disable-line dot-notation\n    : null\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\nconst K_MAX_LENGTH = 0x7fffffff\nexports.kMaxLength = K_MAX_LENGTH\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Print warning and recommend using `buffer` v4.x which has an Object\n *               implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * We report that the browser does not support typed arrays if the are not subclassable\n * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`\n * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support\n * for __proto__ and has a buggy typed array implementation.\n */\nBuffer.TYPED_ARRAY_SUPPORT = typedArraySupport()\n\nif (!Buffer.TYPED_ARRAY_SUPPORT && typeof console !== 'undefined' &&\n    typeof console.error === 'function') {\n  console.error(\n    'This browser lacks typed array (Uint8Array) support which is required by ' +\n    '`buffer` v5.x. Use `buffer` v4.x if you require old browser support.'\n  )\n}\n\nfunction typedArraySupport () {\n  // Can typed array instances can be augmented?\n  try {\n    const arr = new Uint8Array(1)\n    const proto = { foo: function () { return 42 } }\n    Object.setPrototypeOf(proto, Uint8Array.prototype)\n    Object.setPrototypeOf(arr, proto)\n    return arr.foo() === 42\n  } catch (e) {\n    return false\n  }\n}\n\nObject.defineProperty(Buffer.prototype, 'parent', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.buffer\n  }\n})\n\nObject.defineProperty(Buffer.prototype, 'offset', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.byteOffset\n  }\n})\n\nfunction createBuffer (length) {\n  if (length > K_MAX_LENGTH) {\n    throw new RangeError('The value \"' + length + '\" is invalid for option \"size\"')\n  }\n  // Return an augmented `Uint8Array` instance\n  const buf = new Uint8Array(length)\n  Object.setPrototypeOf(buf, Buffer.prototype)\n  return buf\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new TypeError(\n        'The \"string\" argument must be of type string. Received type number'\n      )\n    }\n    return allocUnsafe(arg)\n  }\n  return from(arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\nfunction from (value, encodingOrOffset, length) {\n  if (typeof value === 'string') {\n    return fromString(value, encodingOrOffset)\n  }\n\n  if (ArrayBuffer.isView(value)) {\n    return fromArrayView(value)\n  }\n\n  if (value == null) {\n    throw new TypeError(\n      'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n      'or Array-like Object. Received type ' + (typeof value)\n    )\n  }\n\n  if (isInstance(value, ArrayBuffer) ||\n      (value && isInstance(value.buffer, ArrayBuffer))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof SharedArrayBuffer !== 'undefined' &&\n      (isInstance(value, SharedArrayBuffer) ||\n      (value && isInstance(value.buffer, SharedArrayBuffer)))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'number') {\n    throw new TypeError(\n      'The \"value\" argument must not be of type number. Received type number'\n    )\n  }\n\n  const valueOf = value.valueOf && value.valueOf()\n  if (valueOf != null && valueOf !== value) {\n    return Buffer.from(valueOf, encodingOrOffset, length)\n  }\n\n  const b = fromObject(value)\n  if (b) return b\n\n  if (typeof Symbol !== 'undefined' && Symbol.toPrimitive != null &&\n      typeof value[Symbol.toPrimitive] === 'function') {\n    return Buffer.from(value[Symbol.toPrimitive]('string'), encodingOrOffset, length)\n  }\n\n  throw new TypeError(\n    'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n    'or Array-like Object. Received type ' + (typeof value)\n  )\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(value, encodingOrOffset, length)\n}\n\n// Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:\n// https://github.com/feross/buffer/pull/148\nObject.setPrototypeOf(Buffer.prototype, Uint8Array.prototype)\nObject.setPrototypeOf(Buffer, Uint8Array)\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be of type number')\n  } else if (size < 0) {\n    throw new RangeError('The value \"' + size + '\" is invalid for option \"size\"')\n  }\n}\n\nfunction alloc (size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpreted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(size).fill(fill, encoding)\n      : createBuffer(size).fill(fill)\n  }\n  return createBuffer(size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(size, fill, encoding)\n}\n\nfunction allocUnsafe (size) {\n  assertSize(size)\n  return createBuffer(size < 0 ? 0 : checked(size) | 0)\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(size)\n}\n\nfunction fromString (string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('Unknown encoding: ' + encoding)\n  }\n\n  const length = byteLength(string, encoding) | 0\n  let buf = createBuffer(length)\n\n  const actual = buf.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    buf = buf.slice(0, actual)\n  }\n\n  return buf\n}\n\nfunction fromArrayLike (array) {\n  const length = array.length < 0 ? 0 : checked(array.length) | 0\n  const buf = createBuffer(length)\n  for (let i = 0; i < length; i += 1) {\n    buf[i] = array[i] & 255\n  }\n  return buf\n}\n\nfunction fromArrayView (arrayView) {\n  if (isInstance(arrayView, Uint8Array)) {\n    const copy = new Uint8Array(arrayView)\n    return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength)\n  }\n  return fromArrayLike(arrayView)\n}\n\nfunction fromArrayBuffer (array, byteOffset, length) {\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\"offset\" is outside of buffer bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\"length\" is outside of buffer bounds')\n  }\n\n  let buf\n  if (byteOffset === undefined && length === undefined) {\n    buf = new Uint8Array(array)\n  } else if (length === undefined) {\n    buf = new Uint8Array(array, byteOffset)\n  } else {\n    buf = new Uint8Array(array, byteOffset, length)\n  }\n\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(buf, Buffer.prototype)\n\n  return buf\n}\n\nfunction fromObject (obj) {\n  if (Buffer.isBuffer(obj)) {\n    const len = checked(obj.length) | 0\n    const buf = createBuffer(len)\n\n    if (buf.length === 0) {\n      return buf\n    }\n\n    obj.copy(buf, 0, 0, len)\n    return buf\n  }\n\n  if (obj.length !== undefined) {\n    if (typeof obj.length !== 'number' || numberIsNaN(obj.length)) {\n      return createBuffer(0)\n    }\n    return fromArrayLike(obj)\n  }\n\n  if (obj.type === 'Buffer' && Array.isArray(obj.data)) {\n    return fromArrayLike(obj.data)\n  }\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < K_MAX_LENGTH` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= K_MAX_LENGTH) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + K_MAX_LENGTH.toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return b != null && b._isBuffer === true &&\n    b !== Buffer.prototype // so Buffer.isBuffer(Buffer.prototype) will be false\n}\n\nBuffer.compare = function compare (a, b) {\n  if (isInstance(a, Uint8Array)) a = Buffer.from(a, a.offset, a.byteLength)\n  if (isInstance(b, Uint8Array)) b = Buffer.from(b, b.offset, b.byteLength)\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError(\n      'The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array'\n    )\n  }\n\n  if (a === b) return 0\n\n  let x = a.length\n  let y = b.length\n\n  for (let i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!Array.isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  let i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  const buffer = Buffer.allocUnsafe(length)\n  let pos = 0\n  for (i = 0; i < list.length; ++i) {\n    let buf = list[i]\n    if (isInstance(buf, Uint8Array)) {\n      if (pos + buf.length > buffer.length) {\n        if (!Buffer.isBuffer(buf)) buf = Buffer.from(buf)\n        buf.copy(buffer, pos)\n      } else {\n        Uint8Array.prototype.set.call(\n          buffer,\n          buf,\n          pos\n        )\n      }\n    } else if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    } else {\n      buf.copy(buffer, pos)\n    }\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (ArrayBuffer.isView(string) || isInstance(string, ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    throw new TypeError(\n      'The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. ' +\n      'Received type ' + typeof string\n    )\n  }\n\n  const len = string.length\n  const mustMatch = (arguments.length > 2 && arguments[2] === true)\n  if (!mustMatch && len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  let loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) {\n          return mustMatch ? -1 : utf8ToBytes(string).length // assume utf8\n        }\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  let loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coercion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)\n// to detect a Buffer instance. It's not possible to use `instanceof Buffer`\n// reliably in a browserify context because there could be multiple different\n// copies of the 'buffer' package in use. This method works even for Buffer\n// instances that were created from another copy of the `buffer` package.\n// See: https://github.com/feross/buffer/issues/154\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  const i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  const len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (let i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  const len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (let i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  const len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (let i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  const length = this.length\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.toLocaleString = Buffer.prototype.toString\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  let str = ''\n  const max = exports.INSPECT_MAX_BYTES\n  str = this.toString('hex', 0, max).replace(/(.{2})/g, '$1 ').trim()\n  if (this.length > max) str += ' ... '\n  return '<Buffer ' + str + '>'\n}\nif (customInspectSymbol) {\n  Buffer.prototype[customInspectSymbol] = Buffer.prototype.inspect\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (isInstance(target, Uint8Array)) {\n    target = Buffer.from(target, target.offset, target.byteLength)\n  }\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError(\n      'The \"target\" argument must be one of type Buffer or Uint8Array. ' +\n      'Received type ' + (typeof target)\n    )\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  let x = thisEnd - thisStart\n  let y = end - start\n  const len = Math.min(x, y)\n\n  const thisCopy = this.slice(thisStart, thisEnd)\n  const targetCopy = target.slice(start, end)\n\n  for (let i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset // Coerce to Number.\n  if (numberIsNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [val], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  let indexSize = 1\n  let arrLength = arr.length\n  let valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  let i\n  if (dir) {\n    let foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      let found = true\n      for (let j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  const remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  const strLen = string.length\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  let i\n  for (i = 0; i < length; ++i) {\n    const parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (numberIsNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset >>> 0\n    if (isFinite(length)) {\n      length = length >>> 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  const remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  let loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return asciiWrite(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  const res = []\n\n  let i = start\n  while (i < end) {\n    const firstByte = buf[i]\n    let codePoint = null\n    let bytesPerSequence = (firstByte > 0xEF)\n      ? 4\n      : (firstByte > 0xDF)\n          ? 3\n          : (firstByte > 0xBF)\n              ? 2\n              : 1\n\n    if (i + bytesPerSequence <= end) {\n      let secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nconst MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  const len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  let res = ''\n  let i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  let ret = ''\n  end = Math.min(buf.length, end)\n\n  for (let i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  let ret = ''\n  end = Math.min(buf.length, end)\n\n  for (let i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  const len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  let out = ''\n  for (let i = start; i < end; ++i) {\n    out += hexSliceLookupTable[buf[i]]\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  const bytes = buf.slice(start, end)\n  let res = ''\n  // If bytes.length is odd, the last 8 bits must be ignored (same as node.js)\n  for (let i = 0; i < bytes.length - 1; i += 2) {\n    res += String.fromCharCode(bytes[i] + (bytes[i + 1] * 256))\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  const len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  const newBuf = this.subarray(start, end)\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(newBuf, Buffer.prototype)\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUintLE =\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let val = this[offset]\n  let mul = 1\n  let i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUintBE =\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  let val = this[offset + --byteLength]\n  let mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUint8 =\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUint16LE =\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUint16BE =\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUint32LE =\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUint32BE =\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readBigUInt64LE = defineBigIntMethod(function readBigUInt64LE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const lo = first +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 24\n\n  const hi = this[++offset] +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    last * 2 ** 24\n\n  return BigInt(lo) + (BigInt(hi) << BigInt(32))\n})\n\nBuffer.prototype.readBigUInt64BE = defineBigIntMethod(function readBigUInt64BE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const hi = first * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    this[++offset]\n\n  const lo = this[++offset] * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    last\n\n  return (BigInt(hi) << BigInt(32)) + BigInt(lo)\n})\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let val = this[offset]\n  let mul = 1\n  let i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let i = byteLength\n  let mul = 1\n  let val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  const val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  const val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readBigInt64LE = defineBigIntMethod(function readBigInt64LE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const val = this[offset + 4] +\n    this[offset + 5] * 2 ** 8 +\n    this[offset + 6] * 2 ** 16 +\n    (last << 24) // Overflow\n\n  return (BigInt(val) << BigInt(32)) +\n    BigInt(first +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 24)\n})\n\nBuffer.prototype.readBigInt64BE = defineBigIntMethod(function readBigInt64BE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const val = (first << 24) + // Overflow\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    this[++offset]\n\n  return (BigInt(val) << BigInt(32)) +\n    BigInt(this[++offset] * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    last)\n})\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUintLE =\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    const maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  let mul = 1\n  let i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUintBE =\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    const maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  let i = byteLength - 1\n  let mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUint8 =\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeUint16LE =\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint16BE =\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint32LE =\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset + 3] = (value >>> 24)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 1] = (value >>> 8)\n  this[offset] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeUint32BE =\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nfunction wrtBigUInt64LE (buf, value, offset, min, max) {\n  checkIntBI(value, min, max, buf, offset, 7)\n\n  let lo = Number(value & BigInt(0xffffffff))\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  let hi = Number(value >> BigInt(32) & BigInt(0xffffffff))\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  return offset\n}\n\nfunction wrtBigUInt64BE (buf, value, offset, min, max) {\n  checkIntBI(value, min, max, buf, offset, 7)\n\n  let lo = Number(value & BigInt(0xffffffff))\n  buf[offset + 7] = lo\n  lo = lo >> 8\n  buf[offset + 6] = lo\n  lo = lo >> 8\n  buf[offset + 5] = lo\n  lo = lo >> 8\n  buf[offset + 4] = lo\n  let hi = Number(value >> BigInt(32) & BigInt(0xffffffff))\n  buf[offset + 3] = hi\n  hi = hi >> 8\n  buf[offset + 2] = hi\n  hi = hi >> 8\n  buf[offset + 1] = hi\n  hi = hi >> 8\n  buf[offset] = hi\n  return offset + 8\n}\n\nBuffer.prototype.writeBigUInt64LE = defineBigIntMethod(function writeBigUInt64LE (value, offset = 0) {\n  return wrtBigUInt64LE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'))\n})\n\nBuffer.prototype.writeBigUInt64BE = defineBigIntMethod(function writeBigUInt64BE (value, offset = 0) {\n  return wrtBigUInt64BE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'))\n})\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    const limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  let i = 0\n  let mul = 1\n  let sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    const limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  let i = byteLength - 1\n  let mul = 1\n  let sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 3] = (value >>> 24)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeBigInt64LE = defineBigIntMethod(function writeBigInt64LE (value, offset = 0) {\n  return wrtBigUInt64LE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'))\n})\n\nBuffer.prototype.writeBigInt64BE = defineBigIntMethod(function writeBigInt64BE (value, offset = 0) {\n  return wrtBigUInt64BE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'))\n})\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!Buffer.isBuffer(target)) throw new TypeError('argument should be a Buffer')\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('Index out of range')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  const len = end - start\n\n  if (this === target && typeof Uint8Array.prototype.copyWithin === 'function') {\n    // Use built-in when available, missing from IE11\n    this.copyWithin(targetStart, start, end)\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, end),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n    if (val.length === 1) {\n      const code = val.charCodeAt(0)\n      if ((encoding === 'utf8' && code < 128) ||\n          encoding === 'latin1') {\n        // Fast path: If `val` fits into a single byte, use that numeric value.\n        val = code\n      }\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  } else if (typeof val === 'boolean') {\n    val = Number(val)\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  let i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    const bytes = Buffer.isBuffer(val)\n      ? val\n      : Buffer.from(val, encoding)\n    const len = bytes.length\n    if (len === 0) {\n      throw new TypeError('The value \"' + val +\n        '\" is invalid for argument \"value\"')\n    }\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// CUSTOM ERRORS\n// =============\n\n// Simplified versions from Node, changed for Buffer-only usage\nconst errors = {}\nfunction E (sym, getMessage, Base) {\n  errors[sym] = class NodeError extends Base {\n    constructor () {\n      super()\n\n      Object.defineProperty(this, 'message', {\n        value: getMessage.apply(this, arguments),\n        writable: true,\n        configurable: true\n      })\n\n      // Add the error code to the name to include it in the stack trace.\n      this.name = `${this.name} [${sym}]`\n      // Access the stack to generate the error message including the error code\n      // from the name.\n      this.stack // eslint-disable-line no-unused-expressions\n      // Reset the name to the actual name.\n      delete this.name\n    }\n\n    get code () {\n      return sym\n    }\n\n    set code (value) {\n      Object.defineProperty(this, 'code', {\n        configurable: true,\n        enumerable: true,\n        value,\n        writable: true\n      })\n    }\n\n    toString () {\n      return `${this.name} [${sym}]: ${this.message}`\n    }\n  }\n}\n\nE('ERR_BUFFER_OUT_OF_BOUNDS',\n  function (name) {\n    if (name) {\n      return `${name} is outside of buffer bounds`\n    }\n\n    return 'Attempt to access memory outside buffer bounds'\n  }, RangeError)\nE('ERR_INVALID_ARG_TYPE',\n  function (name, actual) {\n    return `The \"${name}\" argument must be of type number. Received type ${typeof actual}`\n  }, TypeError)\nE('ERR_OUT_OF_RANGE',\n  function (str, range, input) {\n    let msg = `The value of \"${str}\" is out of range.`\n    let received = input\n    if (Number.isInteger(input) && Math.abs(input) > 2 ** 32) {\n      received = addNumericalSeparator(String(input))\n    } else if (typeof input === 'bigint') {\n      received = String(input)\n      if (input > BigInt(2) ** BigInt(32) || input < -(BigInt(2) ** BigInt(32))) {\n        received = addNumericalSeparator(received)\n      }\n      received += 'n'\n    }\n    msg += ` It must be ${range}. Received ${received}`\n    return msg\n  }, RangeError)\n\nfunction addNumericalSeparator (val) {\n  let res = ''\n  let i = val.length\n  const start = val[0] === '-' ? 1 : 0\n  for (; i >= start + 4; i -= 3) {\n    res = `_${val.slice(i - 3, i)}${res}`\n  }\n  return `${val.slice(0, i)}${res}`\n}\n\n// CHECK FUNCTIONS\n// ===============\n\nfunction checkBounds (buf, offset, byteLength) {\n  validateNumber(offset, 'offset')\n  if (buf[offset] === undefined || buf[offset + byteLength] === undefined) {\n    boundsError(offset, buf.length - (byteLength + 1))\n  }\n}\n\nfunction checkIntBI (value, min, max, buf, offset, byteLength) {\n  if (value > max || value < min) {\n    const n = typeof min === 'bigint' ? 'n' : ''\n    let range\n    if (byteLength > 3) {\n      if (min === 0 || min === BigInt(0)) {\n        range = `>= 0${n} and < 2${n} ** ${(byteLength + 1) * 8}${n}`\n      } else {\n        range = `>= -(2${n} ** ${(byteLength + 1) * 8 - 1}${n}) and < 2 ** ` +\n                `${(byteLength + 1) * 8 - 1}${n}`\n      }\n    } else {\n      range = `>= ${min}${n} and <= ${max}${n}`\n    }\n    throw new errors.ERR_OUT_OF_RANGE('value', range, value)\n  }\n  checkBounds(buf, offset, byteLength)\n}\n\nfunction validateNumber (value, name) {\n  if (typeof value !== 'number') {\n    throw new errors.ERR_INVALID_ARG_TYPE(name, 'number', value)\n  }\n}\n\nfunction boundsError (value, length, type) {\n  if (Math.floor(value) !== value) {\n    validateNumber(value, type)\n    throw new errors.ERR_OUT_OF_RANGE(type || 'offset', 'an integer', value)\n  }\n\n  if (length < 0) {\n    throw new errors.ERR_BUFFER_OUT_OF_BOUNDS()\n  }\n\n  throw new errors.ERR_OUT_OF_RANGE(type || 'offset',\n                                    `>= ${type ? 1 : 0} and <= ${length}`,\n                                    value)\n}\n\n// HELPER FUNCTIONS\n// ================\n\nconst INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node takes equal signs as end of the Base64 encoding\n  str = str.split('=')[0]\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = str.trim().replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  let codePoint\n  const length = string.length\n  let leadSurrogate = null\n  const bytes = []\n\n  for (let i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  const byteArray = []\n  for (let i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  let c, hi, lo\n  const byteArray = []\n  for (let i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  let i\n  for (i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\n// ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass\n// the `instanceof` check but they should be treated as of that type.\n// See: https://github.com/feross/buffer/issues/166\nfunction isInstance (obj, type) {\n  return obj instanceof type ||\n    (obj != null && obj.constructor != null && obj.constructor.name != null &&\n      obj.constructor.name === type.name)\n}\nfunction numberIsNaN (obj) {\n  // For IE11 support\n  return obj !== obj // eslint-disable-line no-self-compare\n}\n\n// Create lookup table for `toString('hex')`\n// See: https://github.com/feross/buffer/issues/219\nconst hexSliceLookupTable = (function () {\n  const alphabet = '0123456789abcdef'\n  const table = new Array(256)\n  for (let i = 0; i < 16; ++i) {\n    const i16 = i * 16\n    for (let j = 0; j < 16; ++j) {\n      table[i16 + j] = alphabet[i] + alphabet[j]\n    }\n  }\n  return table\n})()\n\n// Return not function with Error if BigInt not supported\nfunction defineBigIntMethod (fn) {\n  return typeof BigInt === 'undefined' ? BufferBigIntNotDefined : fn\n}\n\nfunction BufferBigIntNotDefined () {\n  throw new Error('BigInt not supported')\n}\n", "/*!\n * Fast \"async\" scrypt implementation in JavaScript.\n * Copyright (c) 2013-2016 Dmitry Chestnykh | BSD License\n * https://github.com/dchest/scrypt-async-js\n */\n\n/**\n * scrypt(password, salt, options, callback)\n *\n * where\n *\n * password and salt are strings or arrays of bytes (Array of Uint8Array)\n * options is\n *\n * {\n *    N:      // CPU/memory cost parameter, must be power of two\n *            // (alternatively, you can specify logN)\n *    r:      // block size\n *    p:      // parallelization parameter\n *    dkLen:  // length of derived key, default = 32\n *    encoding: // optional encoding:\n *                    \"base64\" - standard Base64 encoding\n *                    \"hex\" \u2014 hex encoding,\n *                    \"binary\" \u2014 Uint8Array,\n *                    undefined/null - Array of bytes\n *    interruptStep: // optional, steps to split calculations (default is 0)\n * }\n *\n * Derives a key from password and salt and calls callback\n * with derived key as the only argument.\n *\n * Calculations are interrupted with setImmediate (or zero setTimeout) at the\n * given interruptSteps to avoid freezing the browser. If it's undefined or zero,\n * the callback is called immediately after the calculation, avoiding setImmediate.\n *\n * Legacy way (only supports p = 1) to call this function is:\n *\n * scrypt(password, salt, logN, r, dkLen, [interruptStep], callback, [encoding])\n *\n * In legacy API, if interruptStep is not given, it defaults to 1000.\n * Pass 0 to have callback called immediately.\n *\n */\nfunction scrypt(password, salt, logN, r, dkLen, interruptStep, callback, encoding) {\n  'use strict';\n\n  function SHA256(m) {\n    /** @const */ var K = [\n      0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b,\n      0x59f111f1, 0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01,\n      0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7,\n      0xc19bf174, 0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc,\n      0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da, 0x983e5152,\n      0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147,\n      0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc,\n      0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n      0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819,\n      0xd6990624, 0xf40e3585, 0x106aa070, 0x19a4c116, 0x1e376c08,\n      0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f,\n      0x682e6ff3, 0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208,\n      0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n    ];\n\n    var h0 = 0x6a09e667, h1 = 0xbb67ae85, h2 = 0x3c6ef372, h3 = 0xa54ff53a,\n        h4 = 0x510e527f, h5 = 0x9b05688c, h6 = 0x1f83d9ab, h7 = 0x5be0cd19,\n        w = new Array(64);\n\n    function blocks(p) {\n      var off = 0, len = p.length;\n      while (len >= 64) {\n        var a = h0, b = h1, c = h2, d = h3, e = h4, f = h5, g = h6, h = h7,\n            u, i, j, t1, t2;\n\n        for (i = 0; i < 16; i++) {\n          j = off + i*4;\n          w[i] = ((p[j] & 0xff)<<24) | ((p[j+1] & 0xff)<<16) |\n                 ((p[j+2] & 0xff)<<8) | (p[j+3] & 0xff);\n        }\n\n        for (i = 16; i < 64; i++) {\n          u = w[i-2];\n          t1 = ((u>>>17) | (u<<(32-17))) ^ ((u>>>19) | (u<<(32-19))) ^ (u>>>10);\n\n          u = w[i-15];\n          t2 = ((u>>>7) | (u<<(32-7))) ^ ((u>>>18) | (u<<(32-18))) ^ (u>>>3);\n\n          w[i] = (((t1 + w[i-7]) | 0) + ((t2 + w[i-16]) | 0)) | 0;\n        }\n\n        for (i = 0; i < 64; i++) {\n          t1 = ((((((e>>>6) | (e<<(32-6))) ^ ((e>>>11) | (e<<(32-11))) ^\n               ((e>>>25) | (e<<(32-25)))) + ((e & f) ^ (~e & g))) | 0) +\n               ((h + ((K[i] + w[i]) | 0)) | 0)) | 0;\n\n          t2 = ((((a>>>2) | (a<<(32-2))) ^ ((a>>>13) | (a<<(32-13))) ^\n               ((a>>>22) | (a<<(32-22)))) + ((a & b) ^ (a & c) ^ (b & c))) | 0;\n\n          h = g;\n          g = f;\n          f = e;\n          e = (d + t1) | 0;\n          d = c;\n          c = b;\n          b = a;\n          a = (t1 + t2) | 0;\n        }\n\n        h0 = (h0 + a) | 0;\n        h1 = (h1 + b) | 0;\n        h2 = (h2 + c) | 0;\n        h3 = (h3 + d) | 0;\n        h4 = (h4 + e) | 0;\n        h5 = (h5 + f) | 0;\n        h6 = (h6 + g) | 0;\n        h7 = (h7 + h) | 0;\n\n        off += 64;\n        len -= 64;\n      }\n    }\n\n    blocks(m);\n\n    var i, bytesLeft = m.length % 64,\n        bitLenHi = (m.length / 0x20000000) | 0,\n        bitLenLo = m.length << 3,\n        numZeros = (bytesLeft < 56) ? 56 : 120,\n        p = m.slice(m.length - bytesLeft, m.length);\n\n    p.push(0x80);\n    for (i = bytesLeft + 1; i < numZeros; i++) p.push(0);\n    p.push((bitLenHi>>>24) & 0xff);\n    p.push((bitLenHi>>>16) & 0xff);\n    p.push((bitLenHi>>>8)  & 0xff);\n    p.push((bitLenHi>>>0)  & 0xff);\n    p.push((bitLenLo>>>24) & 0xff);\n    p.push((bitLenLo>>>16) & 0xff);\n    p.push((bitLenLo>>>8)  & 0xff);\n    p.push((bitLenLo>>>0)  & 0xff);\n\n    blocks(p);\n\n    return [\n      (h0>>>24) & 0xff, (h0>>>16) & 0xff, (h0>>>8) & 0xff, (h0>>>0) & 0xff,\n      (h1>>>24) & 0xff, (h1>>>16) & 0xff, (h1>>>8) & 0xff, (h1>>>0) & 0xff,\n      (h2>>>24) & 0xff, (h2>>>16) & 0xff, (h2>>>8) & 0xff, (h2>>>0) & 0xff,\n      (h3>>>24) & 0xff, (h3>>>16) & 0xff, (h3>>>8) & 0xff, (h3>>>0) & 0xff,\n      (h4>>>24) & 0xff, (h4>>>16) & 0xff, (h4>>>8) & 0xff, (h4>>>0) & 0xff,\n      (h5>>>24) & 0xff, (h5>>>16) & 0xff, (h5>>>8) & 0xff, (h5>>>0) & 0xff,\n      (h6>>>24) & 0xff, (h6>>>16) & 0xff, (h6>>>8) & 0xff, (h6>>>0) & 0xff,\n      (h7>>>24) & 0xff, (h7>>>16) & 0xff, (h7>>>8) & 0xff, (h7>>>0) & 0xff\n    ];\n  }\n\n  function PBKDF2_HMAC_SHA256_OneIter(password, salt, dkLen) {\n    // compress password if it's longer than hash block length\n    if(password.length > 64) {\n      // SHA256 expects password to be an Array. If it's not\n      // (i.e. it doesn't have .push method), convert it to one.\n      password = SHA256(password.push ? password : Array.prototype.slice.call(password, 0));\n    }\n\n    var i, innerLen = 64 + salt.length + 4,\n        inner = new Array(innerLen),\n        outerKey = new Array(64),\n        dk = [];\n\n    // inner = (password ^ ipad) || salt || counter\n    for (i = 0; i < 64; i++) inner[i] = 0x36;\n    for (i = 0; i < password.length; i++) inner[i] ^= password[i];\n    for (i = 0; i < salt.length; i++) inner[64+i] = salt[i];\n    for (i = innerLen - 4; i < innerLen; i++) inner[i] = 0;\n\n    // outerKey = password ^ opad\n    for (i = 0; i < 64; i++) outerKey[i] = 0x5c;\n    for (i = 0; i < password.length; i++) outerKey[i] ^= password[i];\n\n    // increments counter inside inner\n    function incrementCounter() {\n      for (var i = innerLen-1; i >= innerLen-4; i--) {\n        inner[i]++;\n        if (inner[i] <= 0xff) return;\n        inner[i] = 0;\n      }\n    }\n\n    // output blocks = SHA256(outerKey || SHA256(inner)) ...\n    while (dkLen >= 32) {\n      incrementCounter();\n      dk = dk.concat(SHA256(outerKey.concat(SHA256(inner))));\n      dkLen -= 32;\n    }\n    if (dkLen > 0) {\n      incrementCounter();\n      dk = dk.concat(SHA256(outerKey.concat(SHA256(inner))).slice(0, dkLen));\n    }\n    return dk;\n  }\n\n  function salsaXOR(tmp, B, bin, bout) {\n    var j0  = tmp[0]  ^ B[bin++],\n        j1  = tmp[1]  ^ B[bin++],\n        j2  = tmp[2]  ^ B[bin++],\n        j3  = tmp[3]  ^ B[bin++],\n        j4  = tmp[4]  ^ B[bin++],\n        j5  = tmp[5]  ^ B[bin++],\n        j6  = tmp[6]  ^ B[bin++],\n        j7  = tmp[7]  ^ B[bin++],\n        j8  = tmp[8]  ^ B[bin++],\n        j9  = tmp[9]  ^ B[bin++],\n        j10 = tmp[10] ^ B[bin++],\n        j11 = tmp[11] ^ B[bin++],\n        j12 = tmp[12] ^ B[bin++],\n        j13 = tmp[13] ^ B[bin++],\n        j14 = tmp[14] ^ B[bin++],\n        j15 = tmp[15] ^ B[bin++],\n        u, i;\n\n    var x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,\n        x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,\n        x15 = j15;\n\n    for (i = 0; i < 8; i += 2) {\n      u =  x0 + x12;   x4 ^= u<<7  | u>>>(32-7);\n      u =  x4 +  x0;   x8 ^= u<<9  | u>>>(32-9);\n      u =  x8 +  x4;  x12 ^= u<<13 | u>>>(32-13);\n      u = x12 +  x8;   x0 ^= u<<18 | u>>>(32-18);\n\n      u =  x5 +  x1;   x9 ^= u<<7  | u>>>(32-7);\n      u =  x9 +  x5;  x13 ^= u<<9  | u>>>(32-9);\n      u = x13 +  x9;   x1 ^= u<<13 | u>>>(32-13);\n      u =  x1 + x13;   x5 ^= u<<18 | u>>>(32-18);\n\n      u = x10 +  x6;  x14 ^= u<<7  | u>>>(32-7);\n      u = x14 + x10;   x2 ^= u<<9  | u>>>(32-9);\n      u =  x2 + x14;   x6 ^= u<<13 | u>>>(32-13);\n      u =  x6 +  x2;  x10 ^= u<<18 | u>>>(32-18);\n\n      u = x15 + x11;   x3 ^= u<<7  | u>>>(32-7);\n      u =  x3 + x15;   x7 ^= u<<9  | u>>>(32-9);\n      u =  x7 +  x3;  x11 ^= u<<13 | u>>>(32-13);\n      u = x11 +  x7;  x15 ^= u<<18 | u>>>(32-18);\n\n      u =  x0 +  x3;   x1 ^= u<<7  | u>>>(32-7);\n      u =  x1 +  x0;   x2 ^= u<<9  | u>>>(32-9);\n      u =  x2 +  x1;   x3 ^= u<<13 | u>>>(32-13);\n      u =  x3 +  x2;   x0 ^= u<<18 | u>>>(32-18);\n\n      u =  x5 +  x4;   x6 ^= u<<7  | u>>>(32-7);\n      u =  x6 +  x5;   x7 ^= u<<9  | u>>>(32-9);\n      u =  x7 +  x6;   x4 ^= u<<13 | u>>>(32-13);\n      u =  x4 +  x7;   x5 ^= u<<18 | u>>>(32-18);\n\n      u = x10 +  x9;  x11 ^= u<<7  | u>>>(32-7);\n      u = x11 + x10;   x8 ^= u<<9  | u>>>(32-9);\n      u =  x8 + x11;   x9 ^= u<<13 | u>>>(32-13);\n      u =  x9 +  x8;  x10 ^= u<<18 | u>>>(32-18);\n\n      u = x15 + x14;  x12 ^= u<<7  | u>>>(32-7);\n      u = x12 + x15;  x13 ^= u<<9  | u>>>(32-9);\n      u = x13 + x12;  x14 ^= u<<13 | u>>>(32-13);\n      u = x14 + x13;  x15 ^= u<<18 | u>>>(32-18);\n    }\n\n    B[bout++] = tmp[0]  = (x0  + j0)  | 0;\n    B[bout++] = tmp[1]  = (x1  + j1)  | 0;\n    B[bout++] = tmp[2]  = (x2  + j2)  | 0;\n    B[bout++] = tmp[3]  = (x3  + j3)  | 0;\n    B[bout++] = tmp[4]  = (x4  + j4)  | 0;\n    B[bout++] = tmp[5]  = (x5  + j5)  | 0;\n    B[bout++] = tmp[6]  = (x6  + j6)  | 0;\n    B[bout++] = tmp[7]  = (x7  + j7)  | 0;\n    B[bout++] = tmp[8]  = (x8  + j8)  | 0;\n    B[bout++] = tmp[9]  = (x9  + j9)  | 0;\n    B[bout++] = tmp[10] = (x10 + j10) | 0;\n    B[bout++] = tmp[11] = (x11 + j11) | 0;\n    B[bout++] = tmp[12] = (x12 + j12) | 0;\n    B[bout++] = tmp[13] = (x13 + j13) | 0;\n    B[bout++] = tmp[14] = (x14 + j14) | 0;\n    B[bout++] = tmp[15] = (x15 + j15) | 0;\n  }\n\n  function blockCopy(dst, di, src, si, len) {\n    while (len--) dst[di++] = src[si++];\n  }\n\n  function blockXOR(dst, di, src, si, len) {\n    while (len--) dst[di++] ^= src[si++];\n  }\n\n  function blockMix(tmp, B, bin, bout, r) {\n    blockCopy(tmp, 0, B, bin + (2*r-1)*16, 16);\n    for (var i = 0; i < 2*r; i += 2) {\n      salsaXOR(tmp, B, bin + i*16,      bout + i*8);\n      salsaXOR(tmp, B, bin + i*16 + 16, bout + i*8 + r*16);\n    }\n  }\n\n  function integerify(B, bi, r) {\n    return B[bi+(2*r-1)*16];\n  }\n\n  function stringToUTF8Bytes(s) {\n    var arr = [];\n    for (var i = 0; i < s.length; i++) {\n      var c = s.charCodeAt(i);\n      if (c < 0x80) {\n        arr.push(c);\n      } else if (c < 0x800) {\n        arr.push(0xc0 | c >> 6);\n        arr.push(0x80 | c & 0x3f);\n      } else if (c < 0xd800) {\n        arr.push(0xe0 | c >> 12);\n        arr.push(0x80 | (c >> 6) & 0x3f);\n        arr.push(0x80 | c & 0x3f);\n      } else {\n        if (i >= s.length - 1) {\n          throw new Error('invalid string');\n        }\n        i++; // get one more character\n        c = (c & 0x3ff) << 10;\n        c |= s.charCodeAt(i) & 0x3ff;\n        c += 0x10000;\n\n        arr.push(0xf0 | c >> 18);\n        arr.push(0x80 | (c >> 12) & 0x3f);\n        arr.push(0x80 | (c >> 6) & 0x3f);\n        arr.push(0x80 | c & 0x3f);\n      }\n    }\n    return arr;\n  }\n\n  function bytesToHex(p) {\n    /** @const */\n    var enc = '0123456789abcdef'.split('');\n\n    var len = p.length,\n        arr = [],\n        i = 0;\n\n    for (; i < len; i++) {\n        arr.push(enc[(p[i]>>>4) & 15]);\n        arr.push(enc[(p[i]>>>0) & 15]);\n    }\n    return arr.join('');\n  }\n\n  function bytesToBase64(p) {\n    /** @const */\n    var enc = ('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz' +\n              '0123456789+/').split('');\n\n    var len = p.length,\n        arr = [],\n        i = 0,\n        a, b, c, t;\n\n    while (i < len) {\n      a = i < len ? p[i++] : 0;\n      b = i < len ? p[i++] : 0;\n      c = i < len ? p[i++] : 0;\n      t = (a << 16) + (b << 8) + c;\n      arr.push(enc[(t >>> 3 * 6) & 63]);\n      arr.push(enc[(t >>> 2 * 6) & 63]);\n      arr.push(enc[(t >>> 1 * 6) & 63]);\n      arr.push(enc[(t >>> 0 * 6) & 63]);\n    }\n    if (len % 3 > 0) {\n      arr[arr.length-1] = '=';\n      if (len % 3 === 1) arr[arr.length-2] = '=';\n    }\n    return arr.join('');\n  }\n\n\n  // Generate key.\n\n  var MAX_UINT = (-1)>>>0,\n      p = 1;\n\n  if (typeof logN === \"object\") {\n    // Called as: scrypt(password, salt, opts, callback)\n    if (arguments.length > 4) {\n      throw new Error('scrypt: incorrect number of arguments');\n    }\n\n    var opts = logN;\n\n    callback = r;\n    logN = opts.logN;\n    if (typeof logN === 'undefined') {\n      if (typeof opts.N !== 'undefined') {\n        if (opts.N < 2 || opts.N > MAX_UINT)\n          throw new Error('scrypt: N is out of range');\n\n        if ((opts.N & (opts.N - 1)) !== 0)\n          throw new Error('scrypt: N is not a power of 2');\n\n        logN = Math.log(opts.N) / Math.LN2;\n      } else {\n        throw new Error('scrypt: missing N parameter');\n      }\n    }\n\n    // XXX: If opts.p or opts.dkLen is 0, it will be set to the default value\n    // instead of throwing due to incorrect value. To avoid breaking\n    // compatibility, this will only be changed in the next major version.\n    p = opts.p || 1;\n    r = opts.r;\n    dkLen = opts.dkLen || 32;\n    interruptStep = opts.interruptStep || 0;\n    encoding = opts.encoding;\n  }\n\n  if (p < 1)\n    throw new Error('scrypt: invalid p');\n\n  if (r <= 0)\n    throw new Error('scrypt: invalid r');\n\n  if (logN < 1 || logN > 31)\n    throw new Error('scrypt: logN must be between 1 and 31');\n\n\n  var N = (1<<logN)>>>0,\n      XY, V, B, tmp;\n\n  if (r*p >= 1<<30 || r > MAX_UINT/128/p || r > MAX_UINT/256 || N > MAX_UINT/128/r)\n    throw new Error('scrypt: parameters are too large');\n\n  // Decode strings.\n  if (typeof password === 'string')\n    password = stringToUTF8Bytes(password);\n  if (typeof salt === 'string')\n    salt = stringToUTF8Bytes(salt);\n\n  if (typeof Int32Array !== 'undefined') {\n    //XXX We can use Uint32Array, but Int32Array is faster in Safari.\n    XY = new Int32Array(64*r);\n    V = new Int32Array(32*N*r);\n    tmp = new Int32Array(16);\n  } else {\n    XY = [];\n    V = [];\n    tmp = new Array(16);\n  }\n  B = PBKDF2_HMAC_SHA256_OneIter(password, salt, p*128*r);\n\n  var xi = 0, yi = 32 * r;\n\n  function smixStart(pos) {\n    for (var i = 0; i < 32*r; i++) {\n      var j = pos + i*4;\n      XY[xi+i] = ((B[j+3] & 0xff)<<24) | ((B[j+2] & 0xff)<<16) |\n                 ((B[j+1] & 0xff)<<8)  | ((B[j+0] & 0xff)<<0);\n    }\n  }\n\n  function smixStep1(start, end) {\n    for (var i = start; i < end; i += 2) {\n      blockCopy(V, i*(32*r), XY, xi, 32*r);\n      blockMix(tmp, XY, xi, yi, r);\n\n      blockCopy(V, (i+1)*(32*r), XY, yi, 32*r);\n      blockMix(tmp, XY, yi, xi, r);\n    }\n  }\n\n  function smixStep2(start, end) {\n    for (var i = start; i < end; i += 2) {\n      var j = integerify(XY, xi, r) & (N-1);\n      blockXOR(XY, xi, V, j*(32*r), 32*r);\n      blockMix(tmp, XY, xi, yi, r);\n\n      j = integerify(XY, yi, r) & (N-1);\n      blockXOR(XY, yi, V, j*(32*r), 32*r);\n      blockMix(tmp, XY, yi, xi, r);\n    }\n  }\n\n  function smixFinish(pos) {\n    for (var i = 0; i < 32*r; i++) {\n      var j = XY[xi+i];\n      B[pos + i*4 + 0] = (j>>>0)  & 0xff;\n      B[pos + i*4 + 1] = (j>>>8)  & 0xff;\n      B[pos + i*4 + 2] = (j>>>16) & 0xff;\n      B[pos + i*4 + 3] = (j>>>24) & 0xff;\n    }\n  }\n\n  var nextTick = (typeof setImmediate !== 'undefined') ? setImmediate : setTimeout;\n\n  function interruptedFor(start, end, step, fn, donefn) {\n    (function performStep() {\n      nextTick(function() {\n        fn(start, start + step < end ? start + step : end);\n        start += step;\n        if (start < end)\n          performStep();\n        else\n          donefn();\n        });\n    })();\n  }\n\n  function getResult(enc) {\n      var result = PBKDF2_HMAC_SHA256_OneIter(password, B, dkLen);\n      if (enc === 'base64')\n        return bytesToBase64(result);\n      else if (enc === 'hex')\n        return bytesToHex(result);\n      else if (enc === 'binary')\n        return new Uint8Array(result);\n      else\n        return result;\n  }\n\n  // Blocking variant.\n  function calculateSync() {\n    for (var i = 0; i < p; i++) {\n      smixStart(i*128*r);\n      smixStep1(0, N);\n      smixStep2(0, N);\n      smixFinish(i*128*r);\n    }\n    callback(getResult(encoding));\n  }\n\n  // Async variant.\n  function calculateAsync(i) {\n      smixStart(i*128*r);\n      interruptedFor(0, N, interruptStep*2, smixStep1, function() {\n        interruptedFor(0, N, interruptStep*2, smixStep2, function () {\n          smixFinish(i*128*r);\n          if (i + 1 < p) {\n            nextTick(function() { calculateAsync(i + 1); });\n          } else {\n            callback(getResult(encoding));\n          }\n        });\n      });\n  }\n\n  if (typeof interruptStep === 'function') {\n    // Called as: scrypt(...,      callback, [encoding])\n    //  shifting: scrypt(..., interruptStep,  callback, [encoding])\n    encoding = callback;\n    callback = interruptStep;\n    interruptStep = 1000;\n  }\n\n  if (interruptStep <= 0) {\n    calculateSync();\n  } else {\n    calculateAsync(0);\n  }\n}\n\nif (typeof module !== 'undefined') module.exports = scrypt;\n", "(function(nacl) {\n'use strict';\n\n// Ported in 2014 by Dmitry Chestnykh and Devi Mandiri.\n// Public domain.\n//\n// Implementation derived from TweetNaCl version 20140427.\n// See for details: http://tweetnacl.cr.yp.to/\n\nvar gf = function(init) {\n  var i, r = new Float64Array(16);\n  if (init) for (i = 0; i < init.length; i++) r[i] = init[i];\n  return r;\n};\n\n//  Pluggable, initialized in high-level API below.\nvar randombytes = function(/* x, n */) { throw new Error('no PRNG'); };\n\nvar _0 = new Uint8Array(16);\nvar _9 = new Uint8Array(32); _9[0] = 9;\n\nvar gf0 = gf(),\n    gf1 = gf([1]),\n    _121665 = gf([0xdb41, 1]),\n    D = gf([0x78a3, 0x1359, 0x4dca, 0x75eb, 0xd8ab, 0x4141, 0x0a4d, 0x0070, 0xe898, 0x7779, 0x4079, 0x8cc7, 0xfe73, 0x2b6f, 0x6cee, 0x5203]),\n    D2 = gf([0xf159, 0x26b2, 0x9b94, 0xebd6, 0xb156, 0x8283, 0x149a, 0x00e0, 0xd130, 0xeef3, 0x80f2, 0x198e, 0xfce7, 0x56df, 0xd9dc, 0x2406]),\n    X = gf([0xd51a, 0x8f25, 0x2d60, 0xc956, 0xa7b2, 0x9525, 0xc760, 0x692c, 0xdc5c, 0xfdd6, 0xe231, 0xc0a4, 0x53fe, 0xcd6e, 0x36d3, 0x2169]),\n    Y = gf([0x6658, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666, 0x6666]),\n    I = gf([0xa0b0, 0x4a0e, 0x1b27, 0xc4ee, 0xe478, 0xad2f, 0x1806, 0x2f43, 0xd7a7, 0x3dfb, 0x0099, 0x2b4d, 0xdf0b, 0x4fc1, 0x2480, 0x2b83]);\n\nfunction ts64(x, i, h, l) {\n  x[i]   = (h >> 24) & 0xff;\n  x[i+1] = (h >> 16) & 0xff;\n  x[i+2] = (h >>  8) & 0xff;\n  x[i+3] = h & 0xff;\n  x[i+4] = (l >> 24)  & 0xff;\n  x[i+5] = (l >> 16)  & 0xff;\n  x[i+6] = (l >>  8)  & 0xff;\n  x[i+7] = l & 0xff;\n}\n\nfunction vn(x, xi, y, yi, n) {\n  var i,d = 0;\n  for (i = 0; i < n; i++) d |= x[xi+i]^y[yi+i];\n  return (1 & ((d - 1) >>> 8)) - 1;\n}\n\nfunction crypto_verify_16(x, xi, y, yi) {\n  return vn(x,xi,y,yi,16);\n}\n\nfunction crypto_verify_32(x, xi, y, yi) {\n  return vn(x,xi,y,yi,32);\n}\n\nfunction core_salsa20(o, p, k, c) {\n  var j0  = c[ 0] & 0xff | (c[ 1] & 0xff)<<8 | (c[ 2] & 0xff)<<16 | (c[ 3] & 0xff)<<24,\n      j1  = k[ 0] & 0xff | (k[ 1] & 0xff)<<8 | (k[ 2] & 0xff)<<16 | (k[ 3] & 0xff)<<24,\n      j2  = k[ 4] & 0xff | (k[ 5] & 0xff)<<8 | (k[ 6] & 0xff)<<16 | (k[ 7] & 0xff)<<24,\n      j3  = k[ 8] & 0xff | (k[ 9] & 0xff)<<8 | (k[10] & 0xff)<<16 | (k[11] & 0xff)<<24,\n      j4  = k[12] & 0xff | (k[13] & 0xff)<<8 | (k[14] & 0xff)<<16 | (k[15] & 0xff)<<24,\n      j5  = c[ 4] & 0xff | (c[ 5] & 0xff)<<8 | (c[ 6] & 0xff)<<16 | (c[ 7] & 0xff)<<24,\n      j6  = p[ 0] & 0xff | (p[ 1] & 0xff)<<8 | (p[ 2] & 0xff)<<16 | (p[ 3] & 0xff)<<24,\n      j7  = p[ 4] & 0xff | (p[ 5] & 0xff)<<8 | (p[ 6] & 0xff)<<16 | (p[ 7] & 0xff)<<24,\n      j8  = p[ 8] & 0xff | (p[ 9] & 0xff)<<8 | (p[10] & 0xff)<<16 | (p[11] & 0xff)<<24,\n      j9  = p[12] & 0xff | (p[13] & 0xff)<<8 | (p[14] & 0xff)<<16 | (p[15] & 0xff)<<24,\n      j10 = c[ 8] & 0xff | (c[ 9] & 0xff)<<8 | (c[10] & 0xff)<<16 | (c[11] & 0xff)<<24,\n      j11 = k[16] & 0xff | (k[17] & 0xff)<<8 | (k[18] & 0xff)<<16 | (k[19] & 0xff)<<24,\n      j12 = k[20] & 0xff | (k[21] & 0xff)<<8 | (k[22] & 0xff)<<16 | (k[23] & 0xff)<<24,\n      j13 = k[24] & 0xff | (k[25] & 0xff)<<8 | (k[26] & 0xff)<<16 | (k[27] & 0xff)<<24,\n      j14 = k[28] & 0xff | (k[29] & 0xff)<<8 | (k[30] & 0xff)<<16 | (k[31] & 0xff)<<24,\n      j15 = c[12] & 0xff | (c[13] & 0xff)<<8 | (c[14] & 0xff)<<16 | (c[15] & 0xff)<<24;\n\n  var x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,\n      x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,\n      x15 = j15, u;\n\n  for (var i = 0; i < 20; i += 2) {\n    u = x0 + x12 | 0;\n    x4 ^= u<<7 | u>>>(32-7);\n    u = x4 + x0 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x4 | 0;\n    x12 ^= u<<13 | u>>>(32-13);\n    u = x12 + x8 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x1 | 0;\n    x9 ^= u<<7 | u>>>(32-7);\n    u = x9 + x5 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x9 | 0;\n    x1 ^= u<<13 | u>>>(32-13);\n    u = x1 + x13 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x6 | 0;\n    x14 ^= u<<7 | u>>>(32-7);\n    u = x14 + x10 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x14 | 0;\n    x6 ^= u<<13 | u>>>(32-13);\n    u = x6 + x2 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x11 | 0;\n    x3 ^= u<<7 | u>>>(32-7);\n    u = x3 + x15 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x3 | 0;\n    x11 ^= u<<13 | u>>>(32-13);\n    u = x11 + x7 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n\n    u = x0 + x3 | 0;\n    x1 ^= u<<7 | u>>>(32-7);\n    u = x1 + x0 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x1 | 0;\n    x3 ^= u<<13 | u>>>(32-13);\n    u = x3 + x2 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x4 | 0;\n    x6 ^= u<<7 | u>>>(32-7);\n    u = x6 + x5 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x6 | 0;\n    x4 ^= u<<13 | u>>>(32-13);\n    u = x4 + x7 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x9 | 0;\n    x11 ^= u<<7 | u>>>(32-7);\n    u = x11 + x10 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x11 | 0;\n    x9 ^= u<<13 | u>>>(32-13);\n    u = x9 + x8 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x14 | 0;\n    x12 ^= u<<7 | u>>>(32-7);\n    u = x12 + x15 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x12 | 0;\n    x14 ^= u<<13 | u>>>(32-13);\n    u = x14 + x13 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n  }\n   x0 =  x0 +  j0 | 0;\n   x1 =  x1 +  j1 | 0;\n   x2 =  x2 +  j2 | 0;\n   x3 =  x3 +  j3 | 0;\n   x4 =  x4 +  j4 | 0;\n   x5 =  x5 +  j5 | 0;\n   x6 =  x6 +  j6 | 0;\n   x7 =  x7 +  j7 | 0;\n   x8 =  x8 +  j8 | 0;\n   x9 =  x9 +  j9 | 0;\n  x10 = x10 + j10 | 0;\n  x11 = x11 + j11 | 0;\n  x12 = x12 + j12 | 0;\n  x13 = x13 + j13 | 0;\n  x14 = x14 + j14 | 0;\n  x15 = x15 + j15 | 0;\n\n  o[ 0] = x0 >>>  0 & 0xff;\n  o[ 1] = x0 >>>  8 & 0xff;\n  o[ 2] = x0 >>> 16 & 0xff;\n  o[ 3] = x0 >>> 24 & 0xff;\n\n  o[ 4] = x1 >>>  0 & 0xff;\n  o[ 5] = x1 >>>  8 & 0xff;\n  o[ 6] = x1 >>> 16 & 0xff;\n  o[ 7] = x1 >>> 24 & 0xff;\n\n  o[ 8] = x2 >>>  0 & 0xff;\n  o[ 9] = x2 >>>  8 & 0xff;\n  o[10] = x2 >>> 16 & 0xff;\n  o[11] = x2 >>> 24 & 0xff;\n\n  o[12] = x3 >>>  0 & 0xff;\n  o[13] = x3 >>>  8 & 0xff;\n  o[14] = x3 >>> 16 & 0xff;\n  o[15] = x3 >>> 24 & 0xff;\n\n  o[16] = x4 >>>  0 & 0xff;\n  o[17] = x4 >>>  8 & 0xff;\n  o[18] = x4 >>> 16 & 0xff;\n  o[19] = x4 >>> 24 & 0xff;\n\n  o[20] = x5 >>>  0 & 0xff;\n  o[21] = x5 >>>  8 & 0xff;\n  o[22] = x5 >>> 16 & 0xff;\n  o[23] = x5 >>> 24 & 0xff;\n\n  o[24] = x6 >>>  0 & 0xff;\n  o[25] = x6 >>>  8 & 0xff;\n  o[26] = x6 >>> 16 & 0xff;\n  o[27] = x6 >>> 24 & 0xff;\n\n  o[28] = x7 >>>  0 & 0xff;\n  o[29] = x7 >>>  8 & 0xff;\n  o[30] = x7 >>> 16 & 0xff;\n  o[31] = x7 >>> 24 & 0xff;\n\n  o[32] = x8 >>>  0 & 0xff;\n  o[33] = x8 >>>  8 & 0xff;\n  o[34] = x8 >>> 16 & 0xff;\n  o[35] = x8 >>> 24 & 0xff;\n\n  o[36] = x9 >>>  0 & 0xff;\n  o[37] = x9 >>>  8 & 0xff;\n  o[38] = x9 >>> 16 & 0xff;\n  o[39] = x9 >>> 24 & 0xff;\n\n  o[40] = x10 >>>  0 & 0xff;\n  o[41] = x10 >>>  8 & 0xff;\n  o[42] = x10 >>> 16 & 0xff;\n  o[43] = x10 >>> 24 & 0xff;\n\n  o[44] = x11 >>>  0 & 0xff;\n  o[45] = x11 >>>  8 & 0xff;\n  o[46] = x11 >>> 16 & 0xff;\n  o[47] = x11 >>> 24 & 0xff;\n\n  o[48] = x12 >>>  0 & 0xff;\n  o[49] = x12 >>>  8 & 0xff;\n  o[50] = x12 >>> 16 & 0xff;\n  o[51] = x12 >>> 24 & 0xff;\n\n  o[52] = x13 >>>  0 & 0xff;\n  o[53] = x13 >>>  8 & 0xff;\n  o[54] = x13 >>> 16 & 0xff;\n  o[55] = x13 >>> 24 & 0xff;\n\n  o[56] = x14 >>>  0 & 0xff;\n  o[57] = x14 >>>  8 & 0xff;\n  o[58] = x14 >>> 16 & 0xff;\n  o[59] = x14 >>> 24 & 0xff;\n\n  o[60] = x15 >>>  0 & 0xff;\n  o[61] = x15 >>>  8 & 0xff;\n  o[62] = x15 >>> 16 & 0xff;\n  o[63] = x15 >>> 24 & 0xff;\n}\n\nfunction core_hsalsa20(o,p,k,c) {\n  var j0  = c[ 0] & 0xff | (c[ 1] & 0xff)<<8 | (c[ 2] & 0xff)<<16 | (c[ 3] & 0xff)<<24,\n      j1  = k[ 0] & 0xff | (k[ 1] & 0xff)<<8 | (k[ 2] & 0xff)<<16 | (k[ 3] & 0xff)<<24,\n      j2  = k[ 4] & 0xff | (k[ 5] & 0xff)<<8 | (k[ 6] & 0xff)<<16 | (k[ 7] & 0xff)<<24,\n      j3  = k[ 8] & 0xff | (k[ 9] & 0xff)<<8 | (k[10] & 0xff)<<16 | (k[11] & 0xff)<<24,\n      j4  = k[12] & 0xff | (k[13] & 0xff)<<8 | (k[14] & 0xff)<<16 | (k[15] & 0xff)<<24,\n      j5  = c[ 4] & 0xff | (c[ 5] & 0xff)<<8 | (c[ 6] & 0xff)<<16 | (c[ 7] & 0xff)<<24,\n      j6  = p[ 0] & 0xff | (p[ 1] & 0xff)<<8 | (p[ 2] & 0xff)<<16 | (p[ 3] & 0xff)<<24,\n      j7  = p[ 4] & 0xff | (p[ 5] & 0xff)<<8 | (p[ 6] & 0xff)<<16 | (p[ 7] & 0xff)<<24,\n      j8  = p[ 8] & 0xff | (p[ 9] & 0xff)<<8 | (p[10] & 0xff)<<16 | (p[11] & 0xff)<<24,\n      j9  = p[12] & 0xff | (p[13] & 0xff)<<8 | (p[14] & 0xff)<<16 | (p[15] & 0xff)<<24,\n      j10 = c[ 8] & 0xff | (c[ 9] & 0xff)<<8 | (c[10] & 0xff)<<16 | (c[11] & 0xff)<<24,\n      j11 = k[16] & 0xff | (k[17] & 0xff)<<8 | (k[18] & 0xff)<<16 | (k[19] & 0xff)<<24,\n      j12 = k[20] & 0xff | (k[21] & 0xff)<<8 | (k[22] & 0xff)<<16 | (k[23] & 0xff)<<24,\n      j13 = k[24] & 0xff | (k[25] & 0xff)<<8 | (k[26] & 0xff)<<16 | (k[27] & 0xff)<<24,\n      j14 = k[28] & 0xff | (k[29] & 0xff)<<8 | (k[30] & 0xff)<<16 | (k[31] & 0xff)<<24,\n      j15 = c[12] & 0xff | (c[13] & 0xff)<<8 | (c[14] & 0xff)<<16 | (c[15] & 0xff)<<24;\n\n  var x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,\n      x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,\n      x15 = j15, u;\n\n  for (var i = 0; i < 20; i += 2) {\n    u = x0 + x12 | 0;\n    x4 ^= u<<7 | u>>>(32-7);\n    u = x4 + x0 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x4 | 0;\n    x12 ^= u<<13 | u>>>(32-13);\n    u = x12 + x8 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x1 | 0;\n    x9 ^= u<<7 | u>>>(32-7);\n    u = x9 + x5 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x9 | 0;\n    x1 ^= u<<13 | u>>>(32-13);\n    u = x1 + x13 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x6 | 0;\n    x14 ^= u<<7 | u>>>(32-7);\n    u = x14 + x10 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x14 | 0;\n    x6 ^= u<<13 | u>>>(32-13);\n    u = x6 + x2 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x11 | 0;\n    x3 ^= u<<7 | u>>>(32-7);\n    u = x3 + x15 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x3 | 0;\n    x11 ^= u<<13 | u>>>(32-13);\n    u = x11 + x7 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n\n    u = x0 + x3 | 0;\n    x1 ^= u<<7 | u>>>(32-7);\n    u = x1 + x0 | 0;\n    x2 ^= u<<9 | u>>>(32-9);\n    u = x2 + x1 | 0;\n    x3 ^= u<<13 | u>>>(32-13);\n    u = x3 + x2 | 0;\n    x0 ^= u<<18 | u>>>(32-18);\n\n    u = x5 + x4 | 0;\n    x6 ^= u<<7 | u>>>(32-7);\n    u = x6 + x5 | 0;\n    x7 ^= u<<9 | u>>>(32-9);\n    u = x7 + x6 | 0;\n    x4 ^= u<<13 | u>>>(32-13);\n    u = x4 + x7 | 0;\n    x5 ^= u<<18 | u>>>(32-18);\n\n    u = x10 + x9 | 0;\n    x11 ^= u<<7 | u>>>(32-7);\n    u = x11 + x10 | 0;\n    x8 ^= u<<9 | u>>>(32-9);\n    u = x8 + x11 | 0;\n    x9 ^= u<<13 | u>>>(32-13);\n    u = x9 + x8 | 0;\n    x10 ^= u<<18 | u>>>(32-18);\n\n    u = x15 + x14 | 0;\n    x12 ^= u<<7 | u>>>(32-7);\n    u = x12 + x15 | 0;\n    x13 ^= u<<9 | u>>>(32-9);\n    u = x13 + x12 | 0;\n    x14 ^= u<<13 | u>>>(32-13);\n    u = x14 + x13 | 0;\n    x15 ^= u<<18 | u>>>(32-18);\n  }\n\n  o[ 0] = x0 >>>  0 & 0xff;\n  o[ 1] = x0 >>>  8 & 0xff;\n  o[ 2] = x0 >>> 16 & 0xff;\n  o[ 3] = x0 >>> 24 & 0xff;\n\n  o[ 4] = x5 >>>  0 & 0xff;\n  o[ 5] = x5 >>>  8 & 0xff;\n  o[ 6] = x5 >>> 16 & 0xff;\n  o[ 7] = x5 >>> 24 & 0xff;\n\n  o[ 8] = x10 >>>  0 & 0xff;\n  o[ 9] = x10 >>>  8 & 0xff;\n  o[10] = x10 >>> 16 & 0xff;\n  o[11] = x10 >>> 24 & 0xff;\n\n  o[12] = x15 >>>  0 & 0xff;\n  o[13] = x15 >>>  8 & 0xff;\n  o[14] = x15 >>> 16 & 0xff;\n  o[15] = x15 >>> 24 & 0xff;\n\n  o[16] = x6 >>>  0 & 0xff;\n  o[17] = x6 >>>  8 & 0xff;\n  o[18] = x6 >>> 16 & 0xff;\n  o[19] = x6 >>> 24 & 0xff;\n\n  o[20] = x7 >>>  0 & 0xff;\n  o[21] = x7 >>>  8 & 0xff;\n  o[22] = x7 >>> 16 & 0xff;\n  o[23] = x7 >>> 24 & 0xff;\n\n  o[24] = x8 >>>  0 & 0xff;\n  o[25] = x8 >>>  8 & 0xff;\n  o[26] = x8 >>> 16 & 0xff;\n  o[27] = x8 >>> 24 & 0xff;\n\n  o[28] = x9 >>>  0 & 0xff;\n  o[29] = x9 >>>  8 & 0xff;\n  o[30] = x9 >>> 16 & 0xff;\n  o[31] = x9 >>> 24 & 0xff;\n}\n\nfunction crypto_core_salsa20(out,inp,k,c) {\n  core_salsa20(out,inp,k,c);\n}\n\nfunction crypto_core_hsalsa20(out,inp,k,c) {\n  core_hsalsa20(out,inp,k,c);\n}\n\nvar sigma = new Uint8Array([101, 120, 112, 97, 110, 100, 32, 51, 50, 45, 98, 121, 116, 101, 32, 107]);\n            // \"expand 32-byte k\"\n\nfunction crypto_stream_salsa20_xor(c,cpos,m,mpos,b,n,k) {\n  var z = new Uint8Array(16), x = new Uint8Array(64);\n  var u, i;\n  for (i = 0; i < 16; i++) z[i] = 0;\n  for (i = 0; i < 8; i++) z[i] = n[i];\n  while (b >= 64) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < 64; i++) c[cpos+i] = m[mpos+i] ^ x[i];\n    u = 1;\n    for (i = 8; i < 16; i++) {\n      u = u + (z[i] & 0xff) | 0;\n      z[i] = u & 0xff;\n      u >>>= 8;\n    }\n    b -= 64;\n    cpos += 64;\n    mpos += 64;\n  }\n  if (b > 0) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < b; i++) c[cpos+i] = m[mpos+i] ^ x[i];\n  }\n  return 0;\n}\n\nfunction crypto_stream_salsa20(c,cpos,b,n,k) {\n  var z = new Uint8Array(16), x = new Uint8Array(64);\n  var u, i;\n  for (i = 0; i < 16; i++) z[i] = 0;\n  for (i = 0; i < 8; i++) z[i] = n[i];\n  while (b >= 64) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < 64; i++) c[cpos+i] = x[i];\n    u = 1;\n    for (i = 8; i < 16; i++) {\n      u = u + (z[i] & 0xff) | 0;\n      z[i] = u & 0xff;\n      u >>>= 8;\n    }\n    b -= 64;\n    cpos += 64;\n  }\n  if (b > 0) {\n    crypto_core_salsa20(x,z,k,sigma);\n    for (i = 0; i < b; i++) c[cpos+i] = x[i];\n  }\n  return 0;\n}\n\nfunction crypto_stream(c,cpos,d,n,k) {\n  var s = new Uint8Array(32);\n  crypto_core_hsalsa20(s,n,k,sigma);\n  var sn = new Uint8Array(8);\n  for (var i = 0; i < 8; i++) sn[i] = n[i+16];\n  return crypto_stream_salsa20(c,cpos,d,sn,s);\n}\n\nfunction crypto_stream_xor(c,cpos,m,mpos,d,n,k) {\n  var s = new Uint8Array(32);\n  crypto_core_hsalsa20(s,n,k,sigma);\n  var sn = new Uint8Array(8);\n  for (var i = 0; i < 8; i++) sn[i] = n[i+16];\n  return crypto_stream_salsa20_xor(c,cpos,m,mpos,d,sn,s);\n}\n\n/*\n* Port of Andrew Moon's Poly1305-donna-16. Public domain.\n* https://github.com/floodyberry/poly1305-donna\n*/\n\nvar poly1305 = function(key) {\n  this.buffer = new Uint8Array(16);\n  this.r = new Uint16Array(10);\n  this.h = new Uint16Array(10);\n  this.pad = new Uint16Array(8);\n  this.leftover = 0;\n  this.fin = 0;\n\n  var t0, t1, t2, t3, t4, t5, t6, t7;\n\n  t0 = key[ 0] & 0xff | (key[ 1] & 0xff) << 8; this.r[0] = ( t0                     ) & 0x1fff;\n  t1 = key[ 2] & 0xff | (key[ 3] & 0xff) << 8; this.r[1] = ((t0 >>> 13) | (t1 <<  3)) & 0x1fff;\n  t2 = key[ 4] & 0xff | (key[ 5] & 0xff) << 8; this.r[2] = ((t1 >>> 10) | (t2 <<  6)) & 0x1f03;\n  t3 = key[ 6] & 0xff | (key[ 7] & 0xff) << 8; this.r[3] = ((t2 >>>  7) | (t3 <<  9)) & 0x1fff;\n  t4 = key[ 8] & 0xff | (key[ 9] & 0xff) << 8; this.r[4] = ((t3 >>>  4) | (t4 << 12)) & 0x00ff;\n  this.r[5] = ((t4 >>>  1)) & 0x1ffe;\n  t5 = key[10] & 0xff | (key[11] & 0xff) << 8; this.r[6] = ((t4 >>> 14) | (t5 <<  2)) & 0x1fff;\n  t6 = key[12] & 0xff | (key[13] & 0xff) << 8; this.r[7] = ((t5 >>> 11) | (t6 <<  5)) & 0x1f81;\n  t7 = key[14] & 0xff | (key[15] & 0xff) << 8; this.r[8] = ((t6 >>>  8) | (t7 <<  8)) & 0x1fff;\n  this.r[9] = ((t7 >>>  5)) & 0x007f;\n\n  this.pad[0] = key[16] & 0xff | (key[17] & 0xff) << 8;\n  this.pad[1] = key[18] & 0xff | (key[19] & 0xff) << 8;\n  this.pad[2] = key[20] & 0xff | (key[21] & 0xff) << 8;\n  this.pad[3] = key[22] & 0xff | (key[23] & 0xff) << 8;\n  this.pad[4] = key[24] & 0xff | (key[25] & 0xff) << 8;\n  this.pad[5] = key[26] & 0xff | (key[27] & 0xff) << 8;\n  this.pad[6] = key[28] & 0xff | (key[29] & 0xff) << 8;\n  this.pad[7] = key[30] & 0xff | (key[31] & 0xff) << 8;\n};\n\npoly1305.prototype.blocks = function(m, mpos, bytes) {\n  var hibit = this.fin ? 0 : (1 << 11);\n  var t0, t1, t2, t3, t4, t5, t6, t7, c;\n  var d0, d1, d2, d3, d4, d5, d6, d7, d8, d9;\n\n  var h0 = this.h[0],\n      h1 = this.h[1],\n      h2 = this.h[2],\n      h3 = this.h[3],\n      h4 = this.h[4],\n      h5 = this.h[5],\n      h6 = this.h[6],\n      h7 = this.h[7],\n      h8 = this.h[8],\n      h9 = this.h[9];\n\n  var r0 = this.r[0],\n      r1 = this.r[1],\n      r2 = this.r[2],\n      r3 = this.r[3],\n      r4 = this.r[4],\n      r5 = this.r[5],\n      r6 = this.r[6],\n      r7 = this.r[7],\n      r8 = this.r[8],\n      r9 = this.r[9];\n\n  while (bytes >= 16) {\n    t0 = m[mpos+ 0] & 0xff | (m[mpos+ 1] & 0xff) << 8; h0 += ( t0                     ) & 0x1fff;\n    t1 = m[mpos+ 2] & 0xff | (m[mpos+ 3] & 0xff) << 8; h1 += ((t0 >>> 13) | (t1 <<  3)) & 0x1fff;\n    t2 = m[mpos+ 4] & 0xff | (m[mpos+ 5] & 0xff) << 8; h2 += ((t1 >>> 10) | (t2 <<  6)) & 0x1fff;\n    t3 = m[mpos+ 6] & 0xff | (m[mpos+ 7] & 0xff) << 8; h3 += ((t2 >>>  7) | (t3 <<  9)) & 0x1fff;\n    t4 = m[mpos+ 8] & 0xff | (m[mpos+ 9] & 0xff) << 8; h4 += ((t3 >>>  4) | (t4 << 12)) & 0x1fff;\n    h5 += ((t4 >>>  1)) & 0x1fff;\n    t5 = m[mpos+10] & 0xff | (m[mpos+11] & 0xff) << 8; h6 += ((t4 >>> 14) | (t5 <<  2)) & 0x1fff;\n    t6 = m[mpos+12] & 0xff | (m[mpos+13] & 0xff) << 8; h7 += ((t5 >>> 11) | (t6 <<  5)) & 0x1fff;\n    t7 = m[mpos+14] & 0xff | (m[mpos+15] & 0xff) << 8; h8 += ((t6 >>>  8) | (t7 <<  8)) & 0x1fff;\n    h9 += ((t7 >>> 5)) | hibit;\n\n    c = 0;\n\n    d0 = c;\n    d0 += h0 * r0;\n    d0 += h1 * (5 * r9);\n    d0 += h2 * (5 * r8);\n    d0 += h3 * (5 * r7);\n    d0 += h4 * (5 * r6);\n    c = (d0 >>> 13); d0 &= 0x1fff;\n    d0 += h5 * (5 * r5);\n    d0 += h6 * (5 * r4);\n    d0 += h7 * (5 * r3);\n    d0 += h8 * (5 * r2);\n    d0 += h9 * (5 * r1);\n    c += (d0 >>> 13); d0 &= 0x1fff;\n\n    d1 = c;\n    d1 += h0 * r1;\n    d1 += h1 * r0;\n    d1 += h2 * (5 * r9);\n    d1 += h3 * (5 * r8);\n    d1 += h4 * (5 * r7);\n    c = (d1 >>> 13); d1 &= 0x1fff;\n    d1 += h5 * (5 * r6);\n    d1 += h6 * (5 * r5);\n    d1 += h7 * (5 * r4);\n    d1 += h8 * (5 * r3);\n    d1 += h9 * (5 * r2);\n    c += (d1 >>> 13); d1 &= 0x1fff;\n\n    d2 = c;\n    d2 += h0 * r2;\n    d2 += h1 * r1;\n    d2 += h2 * r0;\n    d2 += h3 * (5 * r9);\n    d2 += h4 * (5 * r8);\n    c = (d2 >>> 13); d2 &= 0x1fff;\n    d2 += h5 * (5 * r7);\n    d2 += h6 * (5 * r6);\n    d2 += h7 * (5 * r5);\n    d2 += h8 * (5 * r4);\n    d2 += h9 * (5 * r3);\n    c += (d2 >>> 13); d2 &= 0x1fff;\n\n    d3 = c;\n    d3 += h0 * r3;\n    d3 += h1 * r2;\n    d3 += h2 * r1;\n    d3 += h3 * r0;\n    d3 += h4 * (5 * r9);\n    c = (d3 >>> 13); d3 &= 0x1fff;\n    d3 += h5 * (5 * r8);\n    d3 += h6 * (5 * r7);\n    d3 += h7 * (5 * r6);\n    d3 += h8 * (5 * r5);\n    d3 += h9 * (5 * r4);\n    c += (d3 >>> 13); d3 &= 0x1fff;\n\n    d4 = c;\n    d4 += h0 * r4;\n    d4 += h1 * r3;\n    d4 += h2 * r2;\n    d4 += h3 * r1;\n    d4 += h4 * r0;\n    c = (d4 >>> 13); d4 &= 0x1fff;\n    d4 += h5 * (5 * r9);\n    d4 += h6 * (5 * r8);\n    d4 += h7 * (5 * r7);\n    d4 += h8 * (5 * r6);\n    d4 += h9 * (5 * r5);\n    c += (d4 >>> 13); d4 &= 0x1fff;\n\n    d5 = c;\n    d5 += h0 * r5;\n    d5 += h1 * r4;\n    d5 += h2 * r3;\n    d5 += h3 * r2;\n    d5 += h4 * r1;\n    c = (d5 >>> 13); d5 &= 0x1fff;\n    d5 += h5 * r0;\n    d5 += h6 * (5 * r9);\n    d5 += h7 * (5 * r8);\n    d5 += h8 * (5 * r7);\n    d5 += h9 * (5 * r6);\n    c += (d5 >>> 13); d5 &= 0x1fff;\n\n    d6 = c;\n    d6 += h0 * r6;\n    d6 += h1 * r5;\n    d6 += h2 * r4;\n    d6 += h3 * r3;\n    d6 += h4 * r2;\n    c = (d6 >>> 13); d6 &= 0x1fff;\n    d6 += h5 * r1;\n    d6 += h6 * r0;\n    d6 += h7 * (5 * r9);\n    d6 += h8 * (5 * r8);\n    d6 += h9 * (5 * r7);\n    c += (d6 >>> 13); d6 &= 0x1fff;\n\n    d7 = c;\n    d7 += h0 * r7;\n    d7 += h1 * r6;\n    d7 += h2 * r5;\n    d7 += h3 * r4;\n    d7 += h4 * r3;\n    c = (d7 >>> 13); d7 &= 0x1fff;\n    d7 += h5 * r2;\n    d7 += h6 * r1;\n    d7 += h7 * r0;\n    d7 += h8 * (5 * r9);\n    d7 += h9 * (5 * r8);\n    c += (d7 >>> 13); d7 &= 0x1fff;\n\n    d8 = c;\n    d8 += h0 * r8;\n    d8 += h1 * r7;\n    d8 += h2 * r6;\n    d8 += h3 * r5;\n    d8 += h4 * r4;\n    c = (d8 >>> 13); d8 &= 0x1fff;\n    d8 += h5 * r3;\n    d8 += h6 * r2;\n    d8 += h7 * r1;\n    d8 += h8 * r0;\n    d8 += h9 * (5 * r9);\n    c += (d8 >>> 13); d8 &= 0x1fff;\n\n    d9 = c;\n    d9 += h0 * r9;\n    d9 += h1 * r8;\n    d9 += h2 * r7;\n    d9 += h3 * r6;\n    d9 += h4 * r5;\n    c = (d9 >>> 13); d9 &= 0x1fff;\n    d9 += h5 * r4;\n    d9 += h6 * r3;\n    d9 += h7 * r2;\n    d9 += h8 * r1;\n    d9 += h9 * r0;\n    c += (d9 >>> 13); d9 &= 0x1fff;\n\n    c = (((c << 2) + c)) | 0;\n    c = (c + d0) | 0;\n    d0 = c & 0x1fff;\n    c = (c >>> 13);\n    d1 += c;\n\n    h0 = d0;\n    h1 = d1;\n    h2 = d2;\n    h3 = d3;\n    h4 = d4;\n    h5 = d5;\n    h6 = d6;\n    h7 = d7;\n    h8 = d8;\n    h9 = d9;\n\n    mpos += 16;\n    bytes -= 16;\n  }\n  this.h[0] = h0;\n  this.h[1] = h1;\n  this.h[2] = h2;\n  this.h[3] = h3;\n  this.h[4] = h4;\n  this.h[5] = h5;\n  this.h[6] = h6;\n  this.h[7] = h7;\n  this.h[8] = h8;\n  this.h[9] = h9;\n};\n\npoly1305.prototype.finish = function(mac, macpos) {\n  var g = new Uint16Array(10);\n  var c, mask, f, i;\n\n  if (this.leftover) {\n    i = this.leftover;\n    this.buffer[i++] = 1;\n    for (; i < 16; i++) this.buffer[i] = 0;\n    this.fin = 1;\n    this.blocks(this.buffer, 0, 16);\n  }\n\n  c = this.h[1] >>> 13;\n  this.h[1] &= 0x1fff;\n  for (i = 2; i < 10; i++) {\n    this.h[i] += c;\n    c = this.h[i] >>> 13;\n    this.h[i] &= 0x1fff;\n  }\n  this.h[0] += (c * 5);\n  c = this.h[0] >>> 13;\n  this.h[0] &= 0x1fff;\n  this.h[1] += c;\n  c = this.h[1] >>> 13;\n  this.h[1] &= 0x1fff;\n  this.h[2] += c;\n\n  g[0] = this.h[0] + 5;\n  c = g[0] >>> 13;\n  g[0] &= 0x1fff;\n  for (i = 1; i < 10; i++) {\n    g[i] = this.h[i] + c;\n    c = g[i] >>> 13;\n    g[i] &= 0x1fff;\n  }\n  g[9] -= (1 << 13);\n\n  mask = (c ^ 1) - 1;\n  for (i = 0; i < 10; i++) g[i] &= mask;\n  mask = ~mask;\n  for (i = 0; i < 10; i++) this.h[i] = (this.h[i] & mask) | g[i];\n\n  this.h[0] = ((this.h[0]       ) | (this.h[1] << 13)                    ) & 0xffff;\n  this.h[1] = ((this.h[1] >>>  3) | (this.h[2] << 10)                    ) & 0xffff;\n  this.h[2] = ((this.h[2] >>>  6) | (this.h[3] <<  7)                    ) & 0xffff;\n  this.h[3] = ((this.h[3] >>>  9) | (this.h[4] <<  4)                    ) & 0xffff;\n  this.h[4] = ((this.h[4] >>> 12) | (this.h[5] <<  1) | (this.h[6] << 14)) & 0xffff;\n  this.h[5] = ((this.h[6] >>>  2) | (this.h[7] << 11)                    ) & 0xffff;\n  this.h[6] = ((this.h[7] >>>  5) | (this.h[8] <<  8)                    ) & 0xffff;\n  this.h[7] = ((this.h[8] >>>  8) | (this.h[9] <<  5)                    ) & 0xffff;\n\n  f = this.h[0] + this.pad[0];\n  this.h[0] = f & 0xffff;\n  for (i = 1; i < 8; i++) {\n    f = (((this.h[i] + this.pad[i]) | 0) + (f >>> 16)) | 0;\n    this.h[i] = f & 0xffff;\n  }\n\n  mac[macpos+ 0] = (this.h[0] >>> 0) & 0xff;\n  mac[macpos+ 1] = (this.h[0] >>> 8) & 0xff;\n  mac[macpos+ 2] = (this.h[1] >>> 0) & 0xff;\n  mac[macpos+ 3] = (this.h[1] >>> 8) & 0xff;\n  mac[macpos+ 4] = (this.h[2] >>> 0) & 0xff;\n  mac[macpos+ 5] = (this.h[2] >>> 8) & 0xff;\n  mac[macpos+ 6] = (this.h[3] >>> 0) & 0xff;\n  mac[macpos+ 7] = (this.h[3] >>> 8) & 0xff;\n  mac[macpos+ 8] = (this.h[4] >>> 0) & 0xff;\n  mac[macpos+ 9] = (this.h[4] >>> 8) & 0xff;\n  mac[macpos+10] = (this.h[5] >>> 0) & 0xff;\n  mac[macpos+11] = (this.h[5] >>> 8) & 0xff;\n  mac[macpos+12] = (this.h[6] >>> 0) & 0xff;\n  mac[macpos+13] = (this.h[6] >>> 8) & 0xff;\n  mac[macpos+14] = (this.h[7] >>> 0) & 0xff;\n  mac[macpos+15] = (this.h[7] >>> 8) & 0xff;\n};\n\npoly1305.prototype.update = function(m, mpos, bytes) {\n  var i, want;\n\n  if (this.leftover) {\n    want = (16 - this.leftover);\n    if (want > bytes)\n      want = bytes;\n    for (i = 0; i < want; i++)\n      this.buffer[this.leftover + i] = m[mpos+i];\n    bytes -= want;\n    mpos += want;\n    this.leftover += want;\n    if (this.leftover < 16)\n      return;\n    this.blocks(this.buffer, 0, 16);\n    this.leftover = 0;\n  }\n\n  if (bytes >= 16) {\n    want = bytes - (bytes % 16);\n    this.blocks(m, mpos, want);\n    mpos += want;\n    bytes -= want;\n  }\n\n  if (bytes) {\n    for (i = 0; i < bytes; i++)\n      this.buffer[this.leftover + i] = m[mpos+i];\n    this.leftover += bytes;\n  }\n};\n\nfunction crypto_onetimeauth(out, outpos, m, mpos, n, k) {\n  var s = new poly1305(k);\n  s.update(m, mpos, n);\n  s.finish(out, outpos);\n  return 0;\n}\n\nfunction crypto_onetimeauth_verify(h, hpos, m, mpos, n, k) {\n  var x = new Uint8Array(16);\n  crypto_onetimeauth(x,0,m,mpos,n,k);\n  return crypto_verify_16(h,hpos,x,0);\n}\n\nfunction crypto_secretbox(c,m,d,n,k) {\n  var i;\n  if (d < 32) return -1;\n  crypto_stream_xor(c,0,m,0,d,n,k);\n  crypto_onetimeauth(c, 16, c, 32, d - 32, c);\n  for (i = 0; i < 16; i++) c[i] = 0;\n  return 0;\n}\n\nfunction crypto_secretbox_open(m,c,d,n,k) {\n  var i;\n  var x = new Uint8Array(32);\n  if (d < 32) return -1;\n  crypto_stream(x,0,32,n,k);\n  if (crypto_onetimeauth_verify(c, 16,c, 32,d - 32,x) !== 0) return -1;\n  crypto_stream_xor(m,0,c,0,d,n,k);\n  for (i = 0; i < 32; i++) m[i] = 0;\n  return 0;\n}\n\nfunction set25519(r, a) {\n  var i;\n  for (i = 0; i < 16; i++) r[i] = a[i]|0;\n}\n\nfunction car25519(o) {\n  var i, v, c = 1;\n  for (i = 0; i < 16; i++) {\n    v = o[i] + c + 65535;\n    c = Math.floor(v / 65536);\n    o[i] = v - c * 65536;\n  }\n  o[0] += c-1 + 37 * (c-1);\n}\n\nfunction sel25519(p, q, b) {\n  var t, c = ~(b-1);\n  for (var i = 0; i < 16; i++) {\n    t = c & (p[i] ^ q[i]);\n    p[i] ^= t;\n    q[i] ^= t;\n  }\n}\n\nfunction pack25519(o, n) {\n  var i, j, b;\n  var m = gf(), t = gf();\n  for (i = 0; i < 16; i++) t[i] = n[i];\n  car25519(t);\n  car25519(t);\n  car25519(t);\n  for (j = 0; j < 2; j++) {\n    m[0] = t[0] - 0xffed;\n    for (i = 1; i < 15; i++) {\n      m[i] = t[i] - 0xffff - ((m[i-1]>>16) & 1);\n      m[i-1] &= 0xffff;\n    }\n    m[15] = t[15] - 0x7fff - ((m[14]>>16) & 1);\n    b = (m[15]>>16) & 1;\n    m[14] &= 0xffff;\n    sel25519(t, m, 1-b);\n  }\n  for (i = 0; i < 16; i++) {\n    o[2*i] = t[i] & 0xff;\n    o[2*i+1] = t[i]>>8;\n  }\n}\n\nfunction neq25519(a, b) {\n  var c = new Uint8Array(32), d = new Uint8Array(32);\n  pack25519(c, a);\n  pack25519(d, b);\n  return crypto_verify_32(c, 0, d, 0);\n}\n\nfunction par25519(a) {\n  var d = new Uint8Array(32);\n  pack25519(d, a);\n  return d[0] & 1;\n}\n\nfunction unpack25519(o, n) {\n  var i;\n  for (i = 0; i < 16; i++) o[i] = n[2*i] + (n[2*i+1] << 8);\n  o[15] &= 0x7fff;\n}\n\nfunction A(o, a, b) {\n  for (var i = 0; i < 16; i++) o[i] = a[i] + b[i];\n}\n\nfunction Z(o, a, b) {\n  for (var i = 0; i < 16; i++) o[i] = a[i] - b[i];\n}\n\nfunction M(o, a, b) {\n  var v, c,\n     t0 = 0,  t1 = 0,  t2 = 0,  t3 = 0,  t4 = 0,  t5 = 0,  t6 = 0,  t7 = 0,\n     t8 = 0,  t9 = 0, t10 = 0, t11 = 0, t12 = 0, t13 = 0, t14 = 0, t15 = 0,\n    t16 = 0, t17 = 0, t18 = 0, t19 = 0, t20 = 0, t21 = 0, t22 = 0, t23 = 0,\n    t24 = 0, t25 = 0, t26 = 0, t27 = 0, t28 = 0, t29 = 0, t30 = 0,\n    b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3],\n    b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7],\n    b8 = b[8],\n    b9 = b[9],\n    b10 = b[10],\n    b11 = b[11],\n    b12 = b[12],\n    b13 = b[13],\n    b14 = b[14],\n    b15 = b[15];\n\n  v = a[0];\n  t0 += v * b0;\n  t1 += v * b1;\n  t2 += v * b2;\n  t3 += v * b3;\n  t4 += v * b4;\n  t5 += v * b5;\n  t6 += v * b6;\n  t7 += v * b7;\n  t8 += v * b8;\n  t9 += v * b9;\n  t10 += v * b10;\n  t11 += v * b11;\n  t12 += v * b12;\n  t13 += v * b13;\n  t14 += v * b14;\n  t15 += v * b15;\n  v = a[1];\n  t1 += v * b0;\n  t2 += v * b1;\n  t3 += v * b2;\n  t4 += v * b3;\n  t5 += v * b4;\n  t6 += v * b5;\n  t7 += v * b6;\n  t8 += v * b7;\n  t9 += v * b8;\n  t10 += v * b9;\n  t11 += v * b10;\n  t12 += v * b11;\n  t13 += v * b12;\n  t14 += v * b13;\n  t15 += v * b14;\n  t16 += v * b15;\n  v = a[2];\n  t2 += v * b0;\n  t3 += v * b1;\n  t4 += v * b2;\n  t5 += v * b3;\n  t6 += v * b4;\n  t7 += v * b5;\n  t8 += v * b6;\n  t9 += v * b7;\n  t10 += v * b8;\n  t11 += v * b9;\n  t12 += v * b10;\n  t13 += v * b11;\n  t14 += v * b12;\n  t15 += v * b13;\n  t16 += v * b14;\n  t17 += v * b15;\n  v = a[3];\n  t3 += v * b0;\n  t4 += v * b1;\n  t5 += v * b2;\n  t6 += v * b3;\n  t7 += v * b4;\n  t8 += v * b5;\n  t9 += v * b6;\n  t10 += v * b7;\n  t11 += v * b8;\n  t12 += v * b9;\n  t13 += v * b10;\n  t14 += v * b11;\n  t15 += v * b12;\n  t16 += v * b13;\n  t17 += v * b14;\n  t18 += v * b15;\n  v = a[4];\n  t4 += v * b0;\n  t5 += v * b1;\n  t6 += v * b2;\n  t7 += v * b3;\n  t8 += v * b4;\n  t9 += v * b5;\n  t10 += v * b6;\n  t11 += v * b7;\n  t12 += v * b8;\n  t13 += v * b9;\n  t14 += v * b10;\n  t15 += v * b11;\n  t16 += v * b12;\n  t17 += v * b13;\n  t18 += v * b14;\n  t19 += v * b15;\n  v = a[5];\n  t5 += v * b0;\n  t6 += v * b1;\n  t7 += v * b2;\n  t8 += v * b3;\n  t9 += v * b4;\n  t10 += v * b5;\n  t11 += v * b6;\n  t12 += v * b7;\n  t13 += v * b8;\n  t14 += v * b9;\n  t15 += v * b10;\n  t16 += v * b11;\n  t17 += v * b12;\n  t18 += v * b13;\n  t19 += v * b14;\n  t20 += v * b15;\n  v = a[6];\n  t6 += v * b0;\n  t7 += v * b1;\n  t8 += v * b2;\n  t9 += v * b3;\n  t10 += v * b4;\n  t11 += v * b5;\n  t12 += v * b6;\n  t13 += v * b7;\n  t14 += v * b8;\n  t15 += v * b9;\n  t16 += v * b10;\n  t17 += v * b11;\n  t18 += v * b12;\n  t19 += v * b13;\n  t20 += v * b14;\n  t21 += v * b15;\n  v = a[7];\n  t7 += v * b0;\n  t8 += v * b1;\n  t9 += v * b2;\n  t10 += v * b3;\n  t11 += v * b4;\n  t12 += v * b5;\n  t13 += v * b6;\n  t14 += v * b7;\n  t15 += v * b8;\n  t16 += v * b9;\n  t17 += v * b10;\n  t18 += v * b11;\n  t19 += v * b12;\n  t20 += v * b13;\n  t21 += v * b14;\n  t22 += v * b15;\n  v = a[8];\n  t8 += v * b0;\n  t9 += v * b1;\n  t10 += v * b2;\n  t11 += v * b3;\n  t12 += v * b4;\n  t13 += v * b5;\n  t14 += v * b6;\n  t15 += v * b7;\n  t16 += v * b8;\n  t17 += v * b9;\n  t18 += v * b10;\n  t19 += v * b11;\n  t20 += v * b12;\n  t21 += v * b13;\n  t22 += v * b14;\n  t23 += v * b15;\n  v = a[9];\n  t9 += v * b0;\n  t10 += v * b1;\n  t11 += v * b2;\n  t12 += v * b3;\n  t13 += v * b4;\n  t14 += v * b5;\n  t15 += v * b6;\n  t16 += v * b7;\n  t17 += v * b8;\n  t18 += v * b9;\n  t19 += v * b10;\n  t20 += v * b11;\n  t21 += v * b12;\n  t22 += v * b13;\n  t23 += v * b14;\n  t24 += v * b15;\n  v = a[10];\n  t10 += v * b0;\n  t11 += v * b1;\n  t12 += v * b2;\n  t13 += v * b3;\n  t14 += v * b4;\n  t15 += v * b5;\n  t16 += v * b6;\n  t17 += v * b7;\n  t18 += v * b8;\n  t19 += v * b9;\n  t20 += v * b10;\n  t21 += v * b11;\n  t22 += v * b12;\n  t23 += v * b13;\n  t24 += v * b14;\n  t25 += v * b15;\n  v = a[11];\n  t11 += v * b0;\n  t12 += v * b1;\n  t13 += v * b2;\n  t14 += v * b3;\n  t15 += v * b4;\n  t16 += v * b5;\n  t17 += v * b6;\n  t18 += v * b7;\n  t19 += v * b8;\n  t20 += v * b9;\n  t21 += v * b10;\n  t22 += v * b11;\n  t23 += v * b12;\n  t24 += v * b13;\n  t25 += v * b14;\n  t26 += v * b15;\n  v = a[12];\n  t12 += v * b0;\n  t13 += v * b1;\n  t14 += v * b2;\n  t15 += v * b3;\n  t16 += v * b4;\n  t17 += v * b5;\n  t18 += v * b6;\n  t19 += v * b7;\n  t20 += v * b8;\n  t21 += v * b9;\n  t22 += v * b10;\n  t23 += v * b11;\n  t24 += v * b12;\n  t25 += v * b13;\n  t26 += v * b14;\n  t27 += v * b15;\n  v = a[13];\n  t13 += v * b0;\n  t14 += v * b1;\n  t15 += v * b2;\n  t16 += v * b3;\n  t17 += v * b4;\n  t18 += v * b5;\n  t19 += v * b6;\n  t20 += v * b7;\n  t21 += v * b8;\n  t22 += v * b9;\n  t23 += v * b10;\n  t24 += v * b11;\n  t25 += v * b12;\n  t26 += v * b13;\n  t27 += v * b14;\n  t28 += v * b15;\n  v = a[14];\n  t14 += v * b0;\n  t15 += v * b1;\n  t16 += v * b2;\n  t17 += v * b3;\n  t18 += v * b4;\n  t19 += v * b5;\n  t20 += v * b6;\n  t21 += v * b7;\n  t22 += v * b8;\n  t23 += v * b9;\n  t24 += v * b10;\n  t25 += v * b11;\n  t26 += v * b12;\n  t27 += v * b13;\n  t28 += v * b14;\n  t29 += v * b15;\n  v = a[15];\n  t15 += v * b0;\n  t16 += v * b1;\n  t17 += v * b2;\n  t18 += v * b3;\n  t19 += v * b4;\n  t20 += v * b5;\n  t21 += v * b6;\n  t22 += v * b7;\n  t23 += v * b8;\n  t24 += v * b9;\n  t25 += v * b10;\n  t26 += v * b11;\n  t27 += v * b12;\n  t28 += v * b13;\n  t29 += v * b14;\n  t30 += v * b15;\n\n  t0  += 38 * t16;\n  t1  += 38 * t17;\n  t2  += 38 * t18;\n  t3  += 38 * t19;\n  t4  += 38 * t20;\n  t5  += 38 * t21;\n  t6  += 38 * t22;\n  t7  += 38 * t23;\n  t8  += 38 * t24;\n  t9  += 38 * t25;\n  t10 += 38 * t26;\n  t11 += 38 * t27;\n  t12 += 38 * t28;\n  t13 += 38 * t29;\n  t14 += 38 * t30;\n  // t15 left as is\n\n  // first car\n  c = 1;\n  v =  t0 + c + 65535; c = Math.floor(v / 65536);  t0 = v - c * 65536;\n  v =  t1 + c + 65535; c = Math.floor(v / 65536);  t1 = v - c * 65536;\n  v =  t2 + c + 65535; c = Math.floor(v / 65536);  t2 = v - c * 65536;\n  v =  t3 + c + 65535; c = Math.floor(v / 65536);  t3 = v - c * 65536;\n  v =  t4 + c + 65535; c = Math.floor(v / 65536);  t4 = v - c * 65536;\n  v =  t5 + c + 65535; c = Math.floor(v / 65536);  t5 = v - c * 65536;\n  v =  t6 + c + 65535; c = Math.floor(v / 65536);  t6 = v - c * 65536;\n  v =  t7 + c + 65535; c = Math.floor(v / 65536);  t7 = v - c * 65536;\n  v =  t8 + c + 65535; c = Math.floor(v / 65536);  t8 = v - c * 65536;\n  v =  t9 + c + 65535; c = Math.floor(v / 65536);  t9 = v - c * 65536;\n  v = t10 + c + 65535; c = Math.floor(v / 65536); t10 = v - c * 65536;\n  v = t11 + c + 65535; c = Math.floor(v / 65536); t11 = v - c * 65536;\n  v = t12 + c + 65535; c = Math.floor(v / 65536); t12 = v - c * 65536;\n  v = t13 + c + 65535; c = Math.floor(v / 65536); t13 = v - c * 65536;\n  v = t14 + c + 65535; c = Math.floor(v / 65536); t14 = v - c * 65536;\n  v = t15 + c + 65535; c = Math.floor(v / 65536); t15 = v - c * 65536;\n  t0 += c-1 + 37 * (c-1);\n\n  // second car\n  c = 1;\n  v =  t0 + c + 65535; c = Math.floor(v / 65536);  t0 = v - c * 65536;\n  v =  t1 + c + 65535; c = Math.floor(v / 65536);  t1 = v - c * 65536;\n  v =  t2 + c + 65535; c = Math.floor(v / 65536);  t2 = v - c * 65536;\n  v =  t3 + c + 65535; c = Math.floor(v / 65536);  t3 = v - c * 65536;\n  v =  t4 + c + 65535; c = Math.floor(v / 65536);  t4 = v - c * 65536;\n  v =  t5 + c + 65535; c = Math.floor(v / 65536);  t5 = v - c * 65536;\n  v =  t6 + c + 65535; c = Math.floor(v / 65536);  t6 = v - c * 65536;\n  v =  t7 + c + 65535; c = Math.floor(v / 65536);  t7 = v - c * 65536;\n  v =  t8 + c + 65535; c = Math.floor(v / 65536);  t8 = v - c * 65536;\n  v =  t9 + c + 65535; c = Math.floor(v / 65536);  t9 = v - c * 65536;\n  v = t10 + c + 65535; c = Math.floor(v / 65536); t10 = v - c * 65536;\n  v = t11 + c + 65535; c = Math.floor(v / 65536); t11 = v - c * 65536;\n  v = t12 + c + 65535; c = Math.floor(v / 65536); t12 = v - c * 65536;\n  v = t13 + c + 65535; c = Math.floor(v / 65536); t13 = v - c * 65536;\n  v = t14 + c + 65535; c = Math.floor(v / 65536); t14 = v - c * 65536;\n  v = t15 + c + 65535; c = Math.floor(v / 65536); t15 = v - c * 65536;\n  t0 += c-1 + 37 * (c-1);\n\n  o[ 0] = t0;\n  o[ 1] = t1;\n  o[ 2] = t2;\n  o[ 3] = t3;\n  o[ 4] = t4;\n  o[ 5] = t5;\n  o[ 6] = t6;\n  o[ 7] = t7;\n  o[ 8] = t8;\n  o[ 9] = t9;\n  o[10] = t10;\n  o[11] = t11;\n  o[12] = t12;\n  o[13] = t13;\n  o[14] = t14;\n  o[15] = t15;\n}\n\nfunction S(o, a) {\n  M(o, a, a);\n}\n\nfunction inv25519(o, i) {\n  var c = gf();\n  var a;\n  for (a = 0; a < 16; a++) c[a] = i[a];\n  for (a = 253; a >= 0; a--) {\n    S(c, c);\n    if(a !== 2 && a !== 4) M(c, c, i);\n  }\n  for (a = 0; a < 16; a++) o[a] = c[a];\n}\n\nfunction pow2523(o, i) {\n  var c = gf();\n  var a;\n  for (a = 0; a < 16; a++) c[a] = i[a];\n  for (a = 250; a >= 0; a--) {\n      S(c, c);\n      if(a !== 1) M(c, c, i);\n  }\n  for (a = 0; a < 16; a++) o[a] = c[a];\n}\n\nfunction crypto_scalarmult(q, n, p) {\n  var z = new Uint8Array(32);\n  var x = new Float64Array(80), r, i;\n  var a = gf(), b = gf(), c = gf(),\n      d = gf(), e = gf(), f = gf();\n  for (i = 0; i < 31; i++) z[i] = n[i];\n  z[31]=(n[31]&127)|64;\n  z[0]&=248;\n  unpack25519(x,p);\n  for (i = 0; i < 16; i++) {\n    b[i]=x[i];\n    d[i]=a[i]=c[i]=0;\n  }\n  a[0]=d[0]=1;\n  for (i=254; i>=0; --i) {\n    r=(z[i>>>3]>>>(i&7))&1;\n    sel25519(a,b,r);\n    sel25519(c,d,r);\n    A(e,a,c);\n    Z(a,a,c);\n    A(c,b,d);\n    Z(b,b,d);\n    S(d,e);\n    S(f,a);\n    M(a,c,a);\n    M(c,b,e);\n    A(e,a,c);\n    Z(a,a,c);\n    S(b,a);\n    Z(c,d,f);\n    M(a,c,_121665);\n    A(a,a,d);\n    M(c,c,a);\n    M(a,d,f);\n    M(d,b,x);\n    S(b,e);\n    sel25519(a,b,r);\n    sel25519(c,d,r);\n  }\n  for (i = 0; i < 16; i++) {\n    x[i+16]=a[i];\n    x[i+32]=c[i];\n    x[i+48]=b[i];\n    x[i+64]=d[i];\n  }\n  var x32 = x.subarray(32);\n  var x16 = x.subarray(16);\n  inv25519(x32,x32);\n  M(x16,x16,x32);\n  pack25519(q,x16);\n  return 0;\n}\n\nfunction crypto_scalarmult_base(q, n) {\n  return crypto_scalarmult(q, n, _9);\n}\n\nfunction crypto_box_keypair(y, x) {\n  randombytes(x, 32);\n  return crypto_scalarmult_base(y, x);\n}\n\nfunction crypto_box_beforenm(k, y, x) {\n  var s = new Uint8Array(32);\n  crypto_scalarmult(s, x, y);\n  return crypto_core_hsalsa20(k, _0, s, sigma);\n}\n\nvar crypto_box_afternm = crypto_secretbox;\nvar crypto_box_open_afternm = crypto_secretbox_open;\n\nfunction crypto_box(c, m, d, n, y, x) {\n  var k = new Uint8Array(32);\n  crypto_box_beforenm(k, y, x);\n  return crypto_box_afternm(c, m, d, n, k);\n}\n\nfunction crypto_box_open(m, c, d, n, y, x) {\n  var k = new Uint8Array(32);\n  crypto_box_beforenm(k, y, x);\n  return crypto_box_open_afternm(m, c, d, n, k);\n}\n\nvar K = [\n  0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,\n  0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,\n  0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,\n  0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,\n  0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,\n  0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,\n  0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,\n  0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,\n  0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,\n  0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,\n  0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,\n  0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,\n  0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,\n  0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,\n  0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,\n  0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,\n  0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,\n  0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,\n  0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,\n  0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,\n  0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,\n  0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,\n  0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,\n  0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,\n  0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,\n  0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,\n  0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,\n  0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,\n  0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,\n  0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,\n  0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,\n  0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,\n  0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,\n  0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,\n  0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,\n  0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,\n  0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,\n  0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,\n  0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,\n  0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817\n];\n\nfunction crypto_hashblocks_hl(hh, hl, m, n) {\n  var wh = new Int32Array(16), wl = new Int32Array(16),\n      bh0, bh1, bh2, bh3, bh4, bh5, bh6, bh7,\n      bl0, bl1, bl2, bl3, bl4, bl5, bl6, bl7,\n      th, tl, i, j, h, l, a, b, c, d;\n\n  var ah0 = hh[0],\n      ah1 = hh[1],\n      ah2 = hh[2],\n      ah3 = hh[3],\n      ah4 = hh[4],\n      ah5 = hh[5],\n      ah6 = hh[6],\n      ah7 = hh[7],\n\n      al0 = hl[0],\n      al1 = hl[1],\n      al2 = hl[2],\n      al3 = hl[3],\n      al4 = hl[4],\n      al5 = hl[5],\n      al6 = hl[6],\n      al7 = hl[7];\n\n  var pos = 0;\n  while (n >= 128) {\n    for (i = 0; i < 16; i++) {\n      j = 8 * i + pos;\n      wh[i] = (m[j+0] << 24) | (m[j+1] << 16) | (m[j+2] << 8) | m[j+3];\n      wl[i] = (m[j+4] << 24) | (m[j+5] << 16) | (m[j+6] << 8) | m[j+7];\n    }\n    for (i = 0; i < 80; i++) {\n      bh0 = ah0;\n      bh1 = ah1;\n      bh2 = ah2;\n      bh3 = ah3;\n      bh4 = ah4;\n      bh5 = ah5;\n      bh6 = ah6;\n      bh7 = ah7;\n\n      bl0 = al0;\n      bl1 = al1;\n      bl2 = al2;\n      bl3 = al3;\n      bl4 = al4;\n      bl5 = al5;\n      bl6 = al6;\n      bl7 = al7;\n\n      // add\n      h = ah7;\n      l = al7;\n\n      a = l & 0xffff; b = l >>> 16;\n      c = h & 0xffff; d = h >>> 16;\n\n      // Sigma1\n      h = ((ah4 >>> 14) | (al4 << (32-14))) ^ ((ah4 >>> 18) | (al4 << (32-18))) ^ ((al4 >>> (41-32)) | (ah4 << (32-(41-32))));\n      l = ((al4 >>> 14) | (ah4 << (32-14))) ^ ((al4 >>> 18) | (ah4 << (32-18))) ^ ((ah4 >>> (41-32)) | (al4 << (32-(41-32))));\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // Ch\n      h = (ah4 & ah5) ^ (~ah4 & ah6);\n      l = (al4 & al5) ^ (~al4 & al6);\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // K\n      h = K[i*2];\n      l = K[i*2+1];\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // w\n      h = wh[i%16];\n      l = wl[i%16];\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      b += a >>> 16;\n      c += b >>> 16;\n      d += c >>> 16;\n\n      th = c & 0xffff | d << 16;\n      tl = a & 0xffff | b << 16;\n\n      // add\n      h = th;\n      l = tl;\n\n      a = l & 0xffff; b = l >>> 16;\n      c = h & 0xffff; d = h >>> 16;\n\n      // Sigma0\n      h = ((ah0 >>> 28) | (al0 << (32-28))) ^ ((al0 >>> (34-32)) | (ah0 << (32-(34-32)))) ^ ((al0 >>> (39-32)) | (ah0 << (32-(39-32))));\n      l = ((al0 >>> 28) | (ah0 << (32-28))) ^ ((ah0 >>> (34-32)) | (al0 << (32-(34-32)))) ^ ((ah0 >>> (39-32)) | (al0 << (32-(39-32))));\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      // Maj\n      h = (ah0 & ah1) ^ (ah0 & ah2) ^ (ah1 & ah2);\n      l = (al0 & al1) ^ (al0 & al2) ^ (al1 & al2);\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      b += a >>> 16;\n      c += b >>> 16;\n      d += c >>> 16;\n\n      bh7 = (c & 0xffff) | (d << 16);\n      bl7 = (a & 0xffff) | (b << 16);\n\n      // add\n      h = bh3;\n      l = bl3;\n\n      a = l & 0xffff; b = l >>> 16;\n      c = h & 0xffff; d = h >>> 16;\n\n      h = th;\n      l = tl;\n\n      a += l & 0xffff; b += l >>> 16;\n      c += h & 0xffff; d += h >>> 16;\n\n      b += a >>> 16;\n      c += b >>> 16;\n      d += c >>> 16;\n\n      bh3 = (c & 0xffff) | (d << 16);\n      bl3 = (a & 0xffff) | (b << 16);\n\n      ah1 = bh0;\n      ah2 = bh1;\n      ah3 = bh2;\n      ah4 = bh3;\n      ah5 = bh4;\n      ah6 = bh5;\n      ah7 = bh6;\n      ah0 = bh7;\n\n      al1 = bl0;\n      al2 = bl1;\n      al3 = bl2;\n      al4 = bl3;\n      al5 = bl4;\n      al6 = bl5;\n      al7 = bl6;\n      al0 = bl7;\n\n      if (i%16 === 15) {\n        for (j = 0; j < 16; j++) {\n          // add\n          h = wh[j];\n          l = wl[j];\n\n          a = l & 0xffff; b = l >>> 16;\n          c = h & 0xffff; d = h >>> 16;\n\n          h = wh[(j+9)%16];\n          l = wl[(j+9)%16];\n\n          a += l & 0xffff; b += l >>> 16;\n          c += h & 0xffff; d += h >>> 16;\n\n          // sigma0\n          th = wh[(j+1)%16];\n          tl = wl[(j+1)%16];\n          h = ((th >>> 1) | (tl << (32-1))) ^ ((th >>> 8) | (tl << (32-8))) ^ (th >>> 7);\n          l = ((tl >>> 1) | (th << (32-1))) ^ ((tl >>> 8) | (th << (32-8))) ^ ((tl >>> 7) | (th << (32-7)));\n\n          a += l & 0xffff; b += l >>> 16;\n          c += h & 0xffff; d += h >>> 16;\n\n          // sigma1\n          th = wh[(j+14)%16];\n          tl = wl[(j+14)%16];\n          h = ((th >>> 19) | (tl << (32-19))) ^ ((tl >>> (61-32)) | (th << (32-(61-32)))) ^ (th >>> 6);\n          l = ((tl >>> 19) | (th << (32-19))) ^ ((th >>> (61-32)) | (tl << (32-(61-32)))) ^ ((tl >>> 6) | (th << (32-6)));\n\n          a += l & 0xffff; b += l >>> 16;\n          c += h & 0xffff; d += h >>> 16;\n\n          b += a >>> 16;\n          c += b >>> 16;\n          d += c >>> 16;\n\n          wh[j] = (c & 0xffff) | (d << 16);\n          wl[j] = (a & 0xffff) | (b << 16);\n        }\n      }\n    }\n\n    // add\n    h = ah0;\n    l = al0;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[0];\n    l = hl[0];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[0] = ah0 = (c & 0xffff) | (d << 16);\n    hl[0] = al0 = (a & 0xffff) | (b << 16);\n\n    h = ah1;\n    l = al1;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[1];\n    l = hl[1];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[1] = ah1 = (c & 0xffff) | (d << 16);\n    hl[1] = al1 = (a & 0xffff) | (b << 16);\n\n    h = ah2;\n    l = al2;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[2];\n    l = hl[2];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[2] = ah2 = (c & 0xffff) | (d << 16);\n    hl[2] = al2 = (a & 0xffff) | (b << 16);\n\n    h = ah3;\n    l = al3;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[3];\n    l = hl[3];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[3] = ah3 = (c & 0xffff) | (d << 16);\n    hl[3] = al3 = (a & 0xffff) | (b << 16);\n\n    h = ah4;\n    l = al4;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[4];\n    l = hl[4];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[4] = ah4 = (c & 0xffff) | (d << 16);\n    hl[4] = al4 = (a & 0xffff) | (b << 16);\n\n    h = ah5;\n    l = al5;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[5];\n    l = hl[5];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[5] = ah5 = (c & 0xffff) | (d << 16);\n    hl[5] = al5 = (a & 0xffff) | (b << 16);\n\n    h = ah6;\n    l = al6;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[6];\n    l = hl[6];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[6] = ah6 = (c & 0xffff) | (d << 16);\n    hl[6] = al6 = (a & 0xffff) | (b << 16);\n\n    h = ah7;\n    l = al7;\n\n    a = l & 0xffff; b = l >>> 16;\n    c = h & 0xffff; d = h >>> 16;\n\n    h = hh[7];\n    l = hl[7];\n\n    a += l & 0xffff; b += l >>> 16;\n    c += h & 0xffff; d += h >>> 16;\n\n    b += a >>> 16;\n    c += b >>> 16;\n    d += c >>> 16;\n\n    hh[7] = ah7 = (c & 0xffff) | (d << 16);\n    hl[7] = al7 = (a & 0xffff) | (b << 16);\n\n    pos += 128;\n    n -= 128;\n  }\n\n  return n;\n}\n\nfunction crypto_hash(out, m, n) {\n  var hh = new Int32Array(8),\n      hl = new Int32Array(8),\n      x = new Uint8Array(256),\n      i, b = n;\n\n  hh[0] = 0x6a09e667;\n  hh[1] = 0xbb67ae85;\n  hh[2] = 0x3c6ef372;\n  hh[3] = 0xa54ff53a;\n  hh[4] = 0x510e527f;\n  hh[5] = 0x9b05688c;\n  hh[6] = 0x1f83d9ab;\n  hh[7] = 0x5be0cd19;\n\n  hl[0] = 0xf3bcc908;\n  hl[1] = 0x84caa73b;\n  hl[2] = 0xfe94f82b;\n  hl[3] = 0x5f1d36f1;\n  hl[4] = 0xade682d1;\n  hl[5] = 0x2b3e6c1f;\n  hl[6] = 0xfb41bd6b;\n  hl[7] = 0x137e2179;\n\n  crypto_hashblocks_hl(hh, hl, m, n);\n  n %= 128;\n\n  for (i = 0; i < n; i++) x[i] = m[b-n+i];\n  x[n] = 128;\n\n  n = 256-128*(n<112?1:0);\n  x[n-9] = 0;\n  ts64(x, n-8,  (b / 0x20000000) | 0, b << 3);\n  crypto_hashblocks_hl(hh, hl, x, n);\n\n  for (i = 0; i < 8; i++) ts64(out, 8*i, hh[i], hl[i]);\n\n  return 0;\n}\n\nfunction add(p, q) {\n  var a = gf(), b = gf(), c = gf(),\n      d = gf(), e = gf(), f = gf(),\n      g = gf(), h = gf(), t = gf();\n\n  Z(a, p[1], p[0]);\n  Z(t, q[1], q[0]);\n  M(a, a, t);\n  A(b, p[0], p[1]);\n  A(t, q[0], q[1]);\n  M(b, b, t);\n  M(c, p[3], q[3]);\n  M(c, c, D2);\n  M(d, p[2], q[2]);\n  A(d, d, d);\n  Z(e, b, a);\n  Z(f, d, c);\n  A(g, d, c);\n  A(h, b, a);\n\n  M(p[0], e, f);\n  M(p[1], h, g);\n  M(p[2], g, f);\n  M(p[3], e, h);\n}\n\nfunction cswap(p, q, b) {\n  var i;\n  for (i = 0; i < 4; i++) {\n    sel25519(p[i], q[i], b);\n  }\n}\n\nfunction pack(r, p) {\n  var tx = gf(), ty = gf(), zi = gf();\n  inv25519(zi, p[2]);\n  M(tx, p[0], zi);\n  M(ty, p[1], zi);\n  pack25519(r, ty);\n  r[31] ^= par25519(tx) << 7;\n}\n\nfunction scalarmult(p, q, s) {\n  var b, i;\n  set25519(p[0], gf0);\n  set25519(p[1], gf1);\n  set25519(p[2], gf1);\n  set25519(p[3], gf0);\n  for (i = 255; i >= 0; --i) {\n    b = (s[(i/8)|0] >> (i&7)) & 1;\n    cswap(p, q, b);\n    add(q, p);\n    add(p, p);\n    cswap(p, q, b);\n  }\n}\n\nfunction scalarbase(p, s) {\n  var q = [gf(), gf(), gf(), gf()];\n  set25519(q[0], X);\n  set25519(q[1], Y);\n  set25519(q[2], gf1);\n  M(q[3], X, Y);\n  scalarmult(p, q, s);\n}\n\nfunction crypto_sign_keypair(pk, sk, seeded) {\n  var d = new Uint8Array(64);\n  var p = [gf(), gf(), gf(), gf()];\n  var i;\n\n  if (!seeded) randombytes(sk, 32);\n  crypto_hash(d, sk, 32);\n  d[0] &= 248;\n  d[31] &= 127;\n  d[31] |= 64;\n\n  scalarbase(p, d);\n  pack(pk, p);\n\n  for (i = 0; i < 32; i++) sk[i+32] = pk[i];\n  return 0;\n}\n\nvar L = new Float64Array([0xed, 0xd3, 0xf5, 0x5c, 0x1a, 0x63, 0x12, 0x58, 0xd6, 0x9c, 0xf7, 0xa2, 0xde, 0xf9, 0xde, 0x14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x10]);\n\nfunction modL(r, x) {\n  var carry, i, j, k;\n  for (i = 63; i >= 32; --i) {\n    carry = 0;\n    for (j = i - 32, k = i - 12; j < k; ++j) {\n      x[j] += carry - 16 * x[i] * L[j - (i - 32)];\n      carry = Math.floor((x[j] + 128) / 256);\n      x[j] -= carry * 256;\n    }\n    x[j] += carry;\n    x[i] = 0;\n  }\n  carry = 0;\n  for (j = 0; j < 32; j++) {\n    x[j] += carry - (x[31] >> 4) * L[j];\n    carry = x[j] >> 8;\n    x[j] &= 255;\n  }\n  for (j = 0; j < 32; j++) x[j] -= carry * L[j];\n  for (i = 0; i < 32; i++) {\n    x[i+1] += x[i] >> 8;\n    r[i] = x[i] & 255;\n  }\n}\n\nfunction reduce(r) {\n  var x = new Float64Array(64), i;\n  for (i = 0; i < 64; i++) x[i] = r[i];\n  for (i = 0; i < 64; i++) r[i] = 0;\n  modL(r, x);\n}\n\n// Note: difference from C - smlen returned, not passed as argument.\nfunction crypto_sign(sm, m, n, sk) {\n  var d = new Uint8Array(64), h = new Uint8Array(64), r = new Uint8Array(64);\n  var i, j, x = new Float64Array(64);\n  var p = [gf(), gf(), gf(), gf()];\n\n  crypto_hash(d, sk, 32);\n  d[0] &= 248;\n  d[31] &= 127;\n  d[31] |= 64;\n\n  var smlen = n + 64;\n  for (i = 0; i < n; i++) sm[64 + i] = m[i];\n  for (i = 0; i < 32; i++) sm[32 + i] = d[32 + i];\n\n  crypto_hash(r, sm.subarray(32), n+32);\n  reduce(r);\n  scalarbase(p, r);\n  pack(sm, p);\n\n  for (i = 32; i < 64; i++) sm[i] = sk[i];\n  crypto_hash(h, sm, n + 64);\n  reduce(h);\n\n  for (i = 0; i < 64; i++) x[i] = 0;\n  for (i = 0; i < 32; i++) x[i] = r[i];\n  for (i = 0; i < 32; i++) {\n    for (j = 0; j < 32; j++) {\n      x[i+j] += h[i] * d[j];\n    }\n  }\n\n  modL(sm.subarray(32), x);\n  return smlen;\n}\n\nfunction unpackneg(r, p) {\n  var t = gf(), chk = gf(), num = gf(),\n      den = gf(), den2 = gf(), den4 = gf(),\n      den6 = gf();\n\n  set25519(r[2], gf1);\n  unpack25519(r[1], p);\n  S(num, r[1]);\n  M(den, num, D);\n  Z(num, num, r[2]);\n  A(den, r[2], den);\n\n  S(den2, den);\n  S(den4, den2);\n  M(den6, den4, den2);\n  M(t, den6, num);\n  M(t, t, den);\n\n  pow2523(t, t);\n  M(t, t, num);\n  M(t, t, den);\n  M(t, t, den);\n  M(r[0], t, den);\n\n  S(chk, r[0]);\n  M(chk, chk, den);\n  if (neq25519(chk, num)) M(r[0], r[0], I);\n\n  S(chk, r[0]);\n  M(chk, chk, den);\n  if (neq25519(chk, num)) return -1;\n\n  if (par25519(r[0]) === (p[31]>>7)) Z(r[0], gf0, r[0]);\n\n  M(r[3], r[0], r[1]);\n  return 0;\n}\n\nfunction crypto_sign_open(m, sm, n, pk) {\n  var i;\n  var t = new Uint8Array(32), h = new Uint8Array(64);\n  var p = [gf(), gf(), gf(), gf()],\n      q = [gf(), gf(), gf(), gf()];\n\n  if (n < 64) return -1;\n\n  if (unpackneg(q, pk)) return -1;\n\n  for (i = 0; i < n; i++) m[i] = sm[i];\n  for (i = 0; i < 32; i++) m[i+32] = pk[i];\n  crypto_hash(h, m, n);\n  reduce(h);\n  scalarmult(p, q, h);\n\n  scalarbase(q, sm.subarray(32));\n  add(p, q);\n  pack(t, p);\n\n  n -= 64;\n  if (crypto_verify_32(sm, 0, t, 0)) {\n    for (i = 0; i < n; i++) m[i] = 0;\n    return -1;\n  }\n\n  for (i = 0; i < n; i++) m[i] = sm[i + 64];\n  return n;\n}\n\nvar crypto_secretbox_KEYBYTES = 32,\n    crypto_secretbox_NONCEBYTES = 24,\n    crypto_secretbox_ZEROBYTES = 32,\n    crypto_secretbox_BOXZEROBYTES = 16,\n    crypto_scalarmult_BYTES = 32,\n    crypto_scalarmult_SCALARBYTES = 32,\n    crypto_box_PUBLICKEYBYTES = 32,\n    crypto_box_SECRETKEYBYTES = 32,\n    crypto_box_BEFORENMBYTES = 32,\n    crypto_box_NONCEBYTES = crypto_secretbox_NONCEBYTES,\n    crypto_box_ZEROBYTES = crypto_secretbox_ZEROBYTES,\n    crypto_box_BOXZEROBYTES = crypto_secretbox_BOXZEROBYTES,\n    crypto_sign_BYTES = 64,\n    crypto_sign_PUBLICKEYBYTES = 32,\n    crypto_sign_SECRETKEYBYTES = 64,\n    crypto_sign_SEEDBYTES = 32,\n    crypto_hash_BYTES = 64;\n\nnacl.lowlevel = {\n  crypto_core_hsalsa20: crypto_core_hsalsa20,\n  crypto_stream_xor: crypto_stream_xor,\n  crypto_stream: crypto_stream,\n  crypto_stream_salsa20_xor: crypto_stream_salsa20_xor,\n  crypto_stream_salsa20: crypto_stream_salsa20,\n  crypto_onetimeauth: crypto_onetimeauth,\n  crypto_onetimeauth_verify: crypto_onetimeauth_verify,\n  crypto_verify_16: crypto_verify_16,\n  crypto_verify_32: crypto_verify_32,\n  crypto_secretbox: crypto_secretbox,\n  crypto_secretbox_open: crypto_secretbox_open,\n  crypto_scalarmult: crypto_scalarmult,\n  crypto_scalarmult_base: crypto_scalarmult_base,\n  crypto_box_beforenm: crypto_box_beforenm,\n  crypto_box_afternm: crypto_box_afternm,\n  crypto_box: crypto_box,\n  crypto_box_open: crypto_box_open,\n  crypto_box_keypair: crypto_box_keypair,\n  crypto_hash: crypto_hash,\n  crypto_sign: crypto_sign,\n  crypto_sign_keypair: crypto_sign_keypair,\n  crypto_sign_open: crypto_sign_open,\n\n  crypto_secretbox_KEYBYTES: crypto_secretbox_KEYBYTES,\n  crypto_secretbox_NONCEBYTES: crypto_secretbox_NONCEBYTES,\n  crypto_secretbox_ZEROBYTES: crypto_secretbox_ZEROBYTES,\n  crypto_secretbox_BOXZEROBYTES: crypto_secretbox_BOXZEROBYTES,\n  crypto_scalarmult_BYTES: crypto_scalarmult_BYTES,\n  crypto_scalarmult_SCALARBYTES: crypto_scalarmult_SCALARBYTES,\n  crypto_box_PUBLICKEYBYTES: crypto_box_PUBLICKEYBYTES,\n  crypto_box_SECRETKEYBYTES: crypto_box_SECRETKEYBYTES,\n  crypto_box_BEFORENMBYTES: crypto_box_BEFORENMBYTES,\n  crypto_box_NONCEBYTES: crypto_box_NONCEBYTES,\n  crypto_box_ZEROBYTES: crypto_box_ZEROBYTES,\n  crypto_box_BOXZEROBYTES: crypto_box_BOXZEROBYTES,\n  crypto_sign_BYTES: crypto_sign_BYTES,\n  crypto_sign_PUBLICKEYBYTES: crypto_sign_PUBLICKEYBYTES,\n  crypto_sign_SECRETKEYBYTES: crypto_sign_SECRETKEYBYTES,\n  crypto_sign_SEEDBYTES: crypto_sign_SEEDBYTES,\n  crypto_hash_BYTES: crypto_hash_BYTES,\n\n  gf: gf,\n  D: D,\n  L: L,\n  pack25519: pack25519,\n  unpack25519: unpack25519,\n  M: M,\n  A: A,\n  S: S,\n  Z: Z,\n  pow2523: pow2523,\n  add: add,\n  set25519: set25519,\n  modL: modL,\n  scalarmult: scalarmult,\n  scalarbase: scalarbase,\n};\n\n/* High-level API */\n\nfunction checkLengths(k, n) {\n  if (k.length !== crypto_secretbox_KEYBYTES) throw new Error('bad key size');\n  if (n.length !== crypto_secretbox_NONCEBYTES) throw new Error('bad nonce size');\n}\n\nfunction checkBoxLengths(pk, sk) {\n  if (pk.length !== crypto_box_PUBLICKEYBYTES) throw new Error('bad public key size');\n  if (sk.length !== crypto_box_SECRETKEYBYTES) throw new Error('bad secret key size');\n}\n\nfunction checkArrayTypes() {\n  for (var i = 0; i < arguments.length; i++) {\n    if (!(arguments[i] instanceof Uint8Array))\n      throw new TypeError('unexpected type, use Uint8Array');\n  }\n}\n\nfunction cleanup(arr) {\n  for (var i = 0; i < arr.length; i++) arr[i] = 0;\n}\n\nnacl.randomBytes = function(n) {\n  var b = new Uint8Array(n);\n  randombytes(b, n);\n  return b;\n};\n\nnacl.secretbox = function(msg, nonce, key) {\n  checkArrayTypes(msg, nonce, key);\n  checkLengths(key, nonce);\n  var m = new Uint8Array(crypto_secretbox_ZEROBYTES + msg.length);\n  var c = new Uint8Array(m.length);\n  for (var i = 0; i < msg.length; i++) m[i+crypto_secretbox_ZEROBYTES] = msg[i];\n  crypto_secretbox(c, m, m.length, nonce, key);\n  return c.subarray(crypto_secretbox_BOXZEROBYTES);\n};\n\nnacl.secretbox.open = function(box, nonce, key) {\n  checkArrayTypes(box, nonce, key);\n  checkLengths(key, nonce);\n  var c = new Uint8Array(crypto_secretbox_BOXZEROBYTES + box.length);\n  var m = new Uint8Array(c.length);\n  for (var i = 0; i < box.length; i++) c[i+crypto_secretbox_BOXZEROBYTES] = box[i];\n  if (c.length < 32) return null;\n  if (crypto_secretbox_open(m, c, c.length, nonce, key) !== 0) return null;\n  return m.subarray(crypto_secretbox_ZEROBYTES);\n};\n\nnacl.secretbox.keyLength = crypto_secretbox_KEYBYTES;\nnacl.secretbox.nonceLength = crypto_secretbox_NONCEBYTES;\nnacl.secretbox.overheadLength = crypto_secretbox_BOXZEROBYTES;\n\nnacl.scalarMult = function(n, p) {\n  checkArrayTypes(n, p);\n  if (n.length !== crypto_scalarmult_SCALARBYTES) throw new Error('bad n size');\n  if (p.length !== crypto_scalarmult_BYTES) throw new Error('bad p size');\n  var q = new Uint8Array(crypto_scalarmult_BYTES);\n  crypto_scalarmult(q, n, p);\n  return q;\n};\n\nnacl.scalarMult.base = function(n) {\n  checkArrayTypes(n);\n  if (n.length !== crypto_scalarmult_SCALARBYTES) throw new Error('bad n size');\n  var q = new Uint8Array(crypto_scalarmult_BYTES);\n  crypto_scalarmult_base(q, n);\n  return q;\n};\n\nnacl.scalarMult.scalarLength = crypto_scalarmult_SCALARBYTES;\nnacl.scalarMult.groupElementLength = crypto_scalarmult_BYTES;\n\nnacl.box = function(msg, nonce, publicKey, secretKey) {\n  var k = nacl.box.before(publicKey, secretKey);\n  return nacl.secretbox(msg, nonce, k);\n};\n\nnacl.box.before = function(publicKey, secretKey) {\n  checkArrayTypes(publicKey, secretKey);\n  checkBoxLengths(publicKey, secretKey);\n  var k = new Uint8Array(crypto_box_BEFORENMBYTES);\n  crypto_box_beforenm(k, publicKey, secretKey);\n  return k;\n};\n\nnacl.box.after = nacl.secretbox;\n\nnacl.box.open = function(msg, nonce, publicKey, secretKey) {\n  var k = nacl.box.before(publicKey, secretKey);\n  return nacl.secretbox.open(msg, nonce, k);\n};\n\nnacl.box.open.after = nacl.secretbox.open;\n\nnacl.box.keyPair = function() {\n  var pk = new Uint8Array(crypto_box_PUBLICKEYBYTES);\n  var sk = new Uint8Array(crypto_box_SECRETKEYBYTES);\n  crypto_box_keypair(pk, sk);\n  return {publicKey: pk, secretKey: sk};\n};\n\nnacl.box.keyPair.fromSecretKey = function(secretKey) {\n  checkArrayTypes(secretKey);\n  if (secretKey.length !== crypto_box_SECRETKEYBYTES)\n    throw new Error('bad secret key size');\n  var pk = new Uint8Array(crypto_box_PUBLICKEYBYTES);\n  crypto_scalarmult_base(pk, secretKey);\n  return {publicKey: pk, secretKey: new Uint8Array(secretKey)};\n};\n\nnacl.box.publicKeyLength = crypto_box_PUBLICKEYBYTES;\nnacl.box.secretKeyLength = crypto_box_SECRETKEYBYTES;\nnacl.box.sharedKeyLength = crypto_box_BEFORENMBYTES;\nnacl.box.nonceLength = crypto_box_NONCEBYTES;\nnacl.box.overheadLength = nacl.secretbox.overheadLength;\n\nnacl.sign = function(msg, secretKey) {\n  checkArrayTypes(msg, secretKey);\n  if (secretKey.length !== crypto_sign_SECRETKEYBYTES)\n    throw new Error('bad secret key size');\n  var signedMsg = new Uint8Array(crypto_sign_BYTES+msg.length);\n  crypto_sign(signedMsg, msg, msg.length, secretKey);\n  return signedMsg;\n};\n\nnacl.sign.open = function(signedMsg, publicKey) {\n  checkArrayTypes(signedMsg, publicKey);\n  if (publicKey.length !== crypto_sign_PUBLICKEYBYTES)\n    throw new Error('bad public key size');\n  var tmp = new Uint8Array(signedMsg.length);\n  var mlen = crypto_sign_open(tmp, signedMsg, signedMsg.length, publicKey);\n  if (mlen < 0) return null;\n  var m = new Uint8Array(mlen);\n  for (var i = 0; i < m.length; i++) m[i] = tmp[i];\n  return m;\n};\n\nnacl.sign.detached = function(msg, secretKey) {\n  var signedMsg = nacl.sign(msg, secretKey);\n  var sig = new Uint8Array(crypto_sign_BYTES);\n  for (var i = 0; i < sig.length; i++) sig[i] = signedMsg[i];\n  return sig;\n};\n\nnacl.sign.detached.verify = function(msg, sig, publicKey) {\n  checkArrayTypes(msg, sig, publicKey);\n  if (sig.length !== crypto_sign_BYTES)\n    throw new Error('bad signature size');\n  if (publicKey.length !== crypto_sign_PUBLICKEYBYTES)\n    throw new Error('bad public key size');\n  var sm = new Uint8Array(crypto_sign_BYTES + msg.length);\n  var m = new Uint8Array(crypto_sign_BYTES + msg.length);\n  var i;\n  for (i = 0; i < crypto_sign_BYTES; i++) sm[i] = sig[i];\n  for (i = 0; i < msg.length; i++) sm[i+crypto_sign_BYTES] = msg[i];\n  return (crypto_sign_open(m, sm, sm.length, publicKey) >= 0);\n};\n\nnacl.sign.keyPair = function() {\n  var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);\n  var sk = new Uint8Array(crypto_sign_SECRETKEYBYTES);\n  crypto_sign_keypair(pk, sk);\n  return {publicKey: pk, secretKey: sk};\n};\n\nnacl.sign.keyPair.fromSecretKey = function(secretKey) {\n  checkArrayTypes(secretKey);\n  if (secretKey.length !== crypto_sign_SECRETKEYBYTES)\n    throw new Error('bad secret key size');\n  var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);\n  for (var i = 0; i < pk.length; i++) pk[i] = secretKey[32+i];\n  return {publicKey: pk, secretKey: new Uint8Array(secretKey)};\n};\n\nnacl.sign.keyPair.fromSeed = function(seed) {\n  checkArrayTypes(seed);\n  if (seed.length !== crypto_sign_SEEDBYTES)\n    throw new Error('bad seed size');\n  var pk = new Uint8Array(crypto_sign_PUBLICKEYBYTES);\n  var sk = new Uint8Array(crypto_sign_SECRETKEYBYTES);\n  for (var i = 0; i < 32; i++) sk[i] = seed[i];\n  crypto_sign_keypair(pk, sk, true);\n  return {publicKey: pk, secretKey: sk};\n};\n\nnacl.sign.publicKeyLength = crypto_sign_PUBLICKEYBYTES;\nnacl.sign.secretKeyLength = crypto_sign_SECRETKEYBYTES;\nnacl.sign.seedLength = crypto_sign_SEEDBYTES;\nnacl.sign.signatureLength = crypto_sign_BYTES;\n\nnacl.hash = function(msg) {\n  checkArrayTypes(msg);\n  var h = new Uint8Array(crypto_hash_BYTES);\n  crypto_hash(h, msg, msg.length);\n  return h;\n};\n\nnacl.hash.hashLength = crypto_hash_BYTES;\n\nnacl.verify = function(x, y) {\n  checkArrayTypes(x, y);\n  // Zero length arguments are considered not equal.\n  if (x.length === 0 || y.length === 0) return false;\n  if (x.length !== y.length) return false;\n  return (vn(x, 0, y, 0, x.length) === 0) ? true : false;\n};\n\nnacl.setPRNG = function(fn) {\n  randombytes = fn;\n};\n\n(function() {\n  // Initialize PRNG if environment provides CSPRNG.\n  // If not, methods calling randombytes will throw.\n  var crypto = typeof self !== 'undefined' ? (self.crypto || self.msCrypto) : null;\n  if (crypto && crypto.getRandomValues) {\n    // Browsers.\n    var QUOTA = 65536;\n    nacl.setPRNG(function(x, n) {\n      var i, v = new Uint8Array(n);\n      for (i = 0; i < n; i += QUOTA) {\n        crypto.getRandomValues(v.subarray(i, i + Math.min(n - i, QUOTA)));\n      }\n      for (i = 0; i < n; i++) x[i] = v[i];\n      cleanup(v);\n    });\n  } else if (typeof require !== 'undefined') {\n    // Node.js.\n    crypto = require('crypto');\n    if (crypto && crypto.randomBytes) {\n      nacl.setPRNG(function(x, n) {\n        var i, v = crypto.randomBytes(n);\n        for (i = 0; i < n; i++) x[i] = v[i];\n        cleanup(v);\n      });\n    }\n  }\n})();\n\n})(typeof module !== 'undefined' && module.exports ? module.exports : (self.nacl = self.nacl || {}));\n", "export const serdesTagSymbol = Symbol('tag');\nexport const serdesSerializeSymbol = Symbol('serialize');\nexport const serdesDeserializeSymbol = Symbol('deserialize');\n// This file is at attempt at addressing the lack of support for\n// custom objects in `structuredClone`. See <https://github.com/whatwg/html/issues/7428>.\n// We need this so that certain custom objects can be shared using a\n// `MessagePort`. To use this functionality, the `serializer` function must be\n// called on the _sending_ side and the `deserializer` function must be called\n// on the _receiving_ side.\n// Note that it's paramount that the _receiving_ side call `deserializer.register`\n// with all of the possible types that are supported.\n// For how to implement `serialize` and `deserialize` support for custom types,\n// see the example below for a class `X`.\n// These functions are meant to provide, more or less, an augmented version of\n// `structuredClone`, thus allowing messages to contain complex JavaScript\n// objects, in ways that JSON simply cannot support. For this, JSON.parse and\n// JSON.stringify are used to deeply traverse objects, which, combined with\n// reviver and replacer callbacks, allows for reconstructing custom object\n// types that neither structuredClone nor JSON support on their own (e.g.,\n// functions, GIMessage, Secret, etc.).\n// Internal function to mark the result of 'serializer' as internal, so that it\n// doesn't get accidentally reprocessed.\nconst rawResult = (rawResultSet, obj) => {\n    rawResultSet.add(obj);\n    return obj;\n};\n// The `serializer` function prepares data before sending it as a message\nexport const serializer = (data) => {\n    const rawResultSet = new WeakSet();\n    const verbatim = [];\n    const transferables = new Set();\n    const revokables = new Set();\n    // JSON.parse and JSON.stringify are called for their ability to do a deep\n    // clone and calling a reviver / replacer.\n    const result = JSON.parse(JSON.stringify(data, (_key, value) => {\n        // Return already processed values without modifications\n        if (value && typeof value === 'object' && rawResultSet.has(value))\n            return value;\n        // Encode undefined as ['_', '_']\n        if (value === undefined)\n            return rawResult(rawResultSet, ['_', '_']);\n        // Encode falsy values as they are (JSON.stringify can handle these well,\n        // except undefined, which can't be represented in JSON)\n        if (!value)\n            return value;\n        // Arrays starting with '_' hold special (internal) meaning. If we receive\n        // such a value to encode, we prepend '_', '_' to ensure they are properly\n        // handled (this will be undone when deserializing)\n        if (Array.isArray(value) && value[0] === '_')\n            return rawResult(rawResultSet, ['_', '_', ...value]);\n        // If something is a Map, encode it as such. It needs to be broken down into\n        // an array so that elements they contain can also be processed, since JSON\n        // does not support Map\n        if (value instanceof Map) {\n            return rawResult(rawResultSet, ['_', 'Map', Array.from(value.entries())]);\n        }\n        // Same for Sets\n        if (value instanceof Set) {\n            return rawResult(rawResultSet, ['_', 'Set', Array.from(value.values())]);\n        }\n        // Error, Blob, File, etc. are supported by structuredClone but not by JSON\n        // We mark these as 'refs', so that the reviver can undo this transformation\n        if (value instanceof Blob || value instanceof File) {\n            const pos = verbatim.length;\n            verbatim[verbatim.length] = value;\n            return rawResult(rawResultSet, ['_', '_ref', pos]);\n        }\n        // However, Error cloning doesn't preserve `.name`\n        if (value instanceof Error) {\n            const pos = verbatim.length;\n            verbatim[verbatim.length] = value;\n            // We need to also serialize `Error.cause` recursively\n            if (value.cause) {\n                value.cause = serializer(value.cause).data;\n            }\n            return rawResult(rawResultSet, ['_', '_err', rawResult(rawResultSet, ['_', '_ref', pos]), value.name]);\n        }\n        // Same for other types supported by structuredClone but not JSON\n        if (value instanceof MessagePort || value instanceof ReadableStream || value instanceof WritableStream || value instanceof ArrayBuffer) {\n            const pos = verbatim.length;\n            verbatim[verbatim.length] = value;\n            transferables.add(value);\n            return rawResult(rawResultSet, ['_', '_ref', pos]);\n        }\n        if (ArrayBuffer.isView(value)) {\n            const pos = verbatim.length;\n            verbatim[verbatim.length] = value;\n            transferables.add(value.buffer);\n            return rawResult(rawResultSet, ['_', '_ref', pos]);\n        }\n        // Functions aren't supported neither by structuredClone nor JSON. However,\n        // we can convert functions into a MessagePort, which is supported\n        if (typeof value === 'function') {\n            const mc = new MessageChannel();\n            mc.port1.onmessage = async (ev) => {\n                try {\n                    try {\n                        const result = await value(...deserializer(ev.data[1]));\n                        const { data, transferables } = serializer(result);\n                        ev.data[0].postMessage([true, data], transferables);\n                    }\n                    catch (e) {\n                        const { data, transferables } = serializer(e);\n                        ev.data[0].postMessage([false, data], transferables);\n                    }\n                }\n                catch (e) {\n                    console.error('Async error on onmessage handler', e);\n                }\n            };\n            transferables.add(mc.port2);\n            revokables.add(mc.port1);\n            return rawResult(rawResultSet, ['_', '_fn', mc.port2]);\n        }\n        const proto = Object.getPrototypeOf(value);\n        // This allows encoding custom arbitrary objects (e.g., GIMessage)\n        if (proto?.constructor?.[serdesTagSymbol] && proto.constructor[serdesSerializeSymbol]) {\n            return rawResult(rawResultSet, ['_', '_custom', proto.constructor[serdesTagSymbol], proto.constructor[serdesSerializeSymbol](value)]);\n        }\n        return value;\n    }), (_key, value) => {\n        // Undo _ref transformations so that structuredClone can send the correct\n        // object\n        if (Array.isArray(value) && value[0] === '_' && value[1] === '_ref') {\n            return verbatim[value[2]];\n        }\n        return value;\n    });\n    return {\n        data: result,\n        transferables: Array.from(transferables),\n        revokables: Array.from(revokables)\n    };\n};\n// Internal lookup table for registered deserializers\nconst deserializerTable = Object.create(null);\n// The `deserializer` function reconstructs data on the receiving side\nexport const deserializer = (data) => {\n    const rawResultSet = new WeakSet();\n    const verbatim = [];\n    // JSON.parse and JSON.stringify are called for their ability to do a deep\n    // clone and calling a reviver / replacer.\n    return JSON.parse(JSON.stringify(data, (_key, value) => {\n        if (value && typeof value === 'object' && !rawResultSet.has(value) && !Array.isArray(value) && Object.getPrototypeOf(value) !== Object.prototype) {\n            const pos = verbatim.length;\n            verbatim[verbatim.length] = value;\n            return rawResult(rawResultSet, ['_', '_ref', pos]);\n        }\n        return value;\n    }), (_key, value) => {\n        if (Array.isArray(value) && value[0] === '_') {\n            switch (value[1]) {\n                case '_':\n                    if (value.length >= 3) {\n                        // This was an input that was an array starting with [_, _]\n                        return value.slice(2);\n                    }\n                    else {\n                        // This was 'undefined' ([_, _])\n                        return;\n                    }\n                // Map input (reconstruct Map)\n                case 'Map':\n                    return new Map(value[2]);\n                // Set input (reconstruct Set)\n                case 'Set':\n                    return new Set(value[2]);\n                // Custom object type (reconstruct if possible, otherwise throw an error)\n                case '_custom':\n                    if (deserializerTable[value[2]]) {\n                        return deserializerTable[value[2]](value[3]);\n                    }\n                    else {\n                        throw new Error('Invalid or unknown tag: ' + value[2]);\n                    }\n                // These are literal values, return them\n                case '_ref':\n                    return verbatim[value[2]];\n                case '_err': {\n                    if (value[2].name !== value[3]) {\n                        value[2].name = value[3];\n                    }\n                    if (value[2].cause) {\n                        value[2].cause = deserializer(value[2].cause);\n                    }\n                    return value[2];\n                }\n                // These were functions converted to a MessagePort. Convert them on this\n                // end back into functions using that port.\n                case '_fn': {\n                    const mp = value[2];\n                    return (...args) => {\n                        return new Promise((resolve, reject) => {\n                            const mc = new MessageChannel();\n                            const { data, transferables } = serializer(args);\n                            mc.port1.onmessage = (ev) => {\n                                if (ev.data[0]) {\n                                    resolve(deserializer(ev.data[1]));\n                                }\n                                else {\n                                    reject(deserializer(ev.data[1]));\n                                }\n                            };\n                            mp.postMessage([mc.port2, data], [mc.port2, ...transferables]);\n                        });\n                    };\n                }\n            }\n        }\n        return value;\n    });\n};\n// The proper types are closer to the following commented out code, but it's\n// not supported or difficult to support with Flow\ndeserializer.register = (ctor) => {\n    if (typeof ctor === 'function' && typeof ctor[serdesTagSymbol] === 'string' && typeof ctor[serdesDeserializeSymbol] === 'function') {\n        deserializerTable[ctor[serdesTagSymbol]] = ctor[serdesDeserializeSymbol].bind(ctor);\n    }\n};\n/*\n// Example\n\nclass X {\n  __x: '11';\n  constructor () {\n    this.__x = '11'\n  }\n  static [serdesDeserializeSymbol] () {\n    return new this()\n  }\n  static get [serdesTagSymbol] () {\n    return 'X'\n  }\n  static [serdesSerializeSymbol] (x: InstanceType<typeof this>) {\n    return undefined\n  }\n}\n\ndeserializer.register(X)\n\nconsole.log(\n  deserializer(\n    structuredClone(\n      serializer(\n        [\n          '_',\n          '_',\n          [\n            '_',\n            '_',\n            '_',\n            new Map([['a', new X()], ['b', new Error('my error')]])\n          ]\n        ]\n      )\n    )\n  )\n)\n*/\n", "'use strict'\n\nexport const MAX_HASH_LEN = 300\nexport const MAX_MEMO_LEN = 4096\nexport const MAX_URL_LEN = 2048\n\n// identity.js related\n\nexport const IDENTITY_PASSWORD_MIN_CHARS = 7\nexport const IDENTITY_USERNAME_MAX_CHARS = 80\nexport const IDENTITY_EMAIL_MAX_CHARS = 320\nexport const IDENTITY_BIO_MAX_CHARS = 500\n\n// group.js related\n\nexport const INVITE_INITIAL_CREATOR = 'invite-initial-creator'\nexport const PROFILE_STATUS = {\n  ACTIVE: 'active', // confirmed group join\n  PENDING: 'pending', // shortly after being approved to join the group\n  REMOVED: 'removed'\n}\nexport const GROUP_NAME_MAX_CHAR = 50 // https://github.com/okTurtles/group-income/issues/2196\nexport const GROUP_DESCRIPTION_MAX_CHAR = 500\nexport const GROUP_PAYMENT_METHOD_MAX_CHAR = 1024\nexport const GROUP_NON_MONETARY_CONTRIBUTION_MAX_CHAR = 150\nexport const GROUP_CURRENCY_MAX_CHAR = 10\nexport const GROUP_MAX_PLEDGE_AMOUNT = 1000000000\nexport const GROUP_MINCOME_MAX = 1000000000\nexport const GROUP_DISTRIBUTION_PERIOD_MAX_DAYS = 365\n\n// group-proposal related\n\nexport const PROPOSAL_RESULT = 'proposal-result'\nexport const PROPOSAL_INVITE_MEMBER = 'invite-member'\nexport const PROPOSAL_REMOVE_MEMBER = 'remove-member'\nexport const PROPOSAL_GROUP_SETTING_CHANGE = 'group-setting-change'\nexport const PROPOSAL_PROPOSAL_SETTING_CHANGE = 'proposal-setting-change'\nexport const PROPOSAL_GENERIC = 'generic'\n\nexport const PROPOSAL_ARCHIVED = 'proposal-archived'\nexport const MAX_ARCHIVED_PROPOSALS = 100\nexport const PAYMENTS_ARCHIVED = 'payments-archived'\nexport const MAX_ARCHIVED_PERIODS = 100\nexport const MAX_SAVED_PERIODS = 2\nexport const MAX_HISTORY_PERIODS = 6\nexport const MAX_GROUP_MEMBER_COUNT = 150 // Dunbar's number (https://en.wikipedia.org/wiki/Dunbar's_number)\nexport const PROPOSAL_NAME_MAX_CHAR = 100\nexport const PROPOSAL_REASON_MAX_CHAR = 300\n\nexport const STATUS_OPEN = 'open'\nexport const STATUS_PASSED = 'passed'\nexport const STATUS_FAILED = 'failed'\nexport const STATUS_EXPIRING = 'expiring' // Only useful to notify users that the proposals are expiring\nexport const STATUS_EXPIRED = 'expired'\nexport const STATUS_CANCELLED = 'cancelled'\n\n// group-streaks related\n\nexport const STREAK_ON_TIME_PAYMENTS = 1\nexport const STREAK_MISSED_PAYMENTS = 1\nexport const STREAK_MISSED_PROPSAL_VOTE = 2\nexport const STREAK_NOT_LOGGED_IN_DAYS = 14\n\n// group-permissions related\n\nexport const GROUP_ROLES = {\n  ADMIN: 'admin',\n  MODERATOR: 'moderator',\n  MODERATOR_DELEGATOR: 'moderator-delegator',\n  CUSTOM: 'custom'\n}\n\nexport const GROUP_PERMISSIONS = {\n  VIEW_PERMISSIONS: 'view-permissions',\n  ASSIGN_DELEGATOR: 'assign-delegator',\n  DELEGATE_PERMISSIONS: 'delegate-permissions', // add/edit/remove permissions\n  REMOVE_MEMBER: 'remove-member',\n  REVOKE_INVITE: 'revoke-invite',\n  DELETE_CHANNEL: 'delete-channel'\n}\nconst GP = GROUP_PERMISSIONS\n\nexport const GROUP_PERMISSIONS_PRESET = {\n  ADMIN: [\n    GP.VIEW_PERMISSIONS,\n    GP.ASSIGN_DELEGATOR,\n    GP.DELEGATE_PERMISSIONS,\n    GP.REMOVE_MEMBER,\n    GP.REVOKE_INVITE,\n    GP.DELETE_CHANNEL\n  ],\n  MODERATOR_DELEGATOR: [\n    GP.VIEW_PERMISSIONS,\n    GP.DELEGATE_PERMISSIONS,\n    GP.REMOVE_MEMBER,\n    GP.REVOKE_INVITE,\n    GP.DELETE_CHANNEL\n  ],\n  MODERATOR: [\n    GP.VIEW_PERMISSIONS,\n    GP.REMOVE_MEMBER,\n    GP.REVOKE_INVITE,\n    GP.DELETE_CHANNEL\n  ]\n}\n\n// chatroom.js related\n\nexport const CHATROOM_GENERAL_NAME = 'general' // Chatroom name must be lowercase-only.\nexport const CHATROOM_NAME_LIMITS_IN_CHARS = 50\nexport const CHATROOM_DESCRIPTION_LIMITS_IN_CHARS = 280\nexport const CHATROOM_REPLYING_MESSAGE_LIMITS_IN_CHARS = 180\nexport const CHATROOM_MAX_MESSAGE_LEN = 20000\nexport const CHATROOM_MAX_MESSAGES = 20\nexport const CHATROOM_ACTIONS_PER_PAGE = 40\n\nexport const CHATROOM_MEMBER_MENTION_SPECIAL_CHAR = '@'\nexport const CHATROOM_CHANNEL_MENTION_SPECIAL_CHAR = '#'\n\n// chatroom events\nexport const MESSAGE_RECEIVE_RAW = 'message-receive-raw'\nexport const MESSAGE_RECEIVE = 'message-receive'\nexport const MESSAGE_SEND = 'message-send'\n\nexport const CHATROOM_TYPES = {\n  DIRECT_MESSAGE: 'direct-message',\n  GROUP: 'group'\n}\n\nexport const CHATROOM_PRIVACY_LEVEL = {\n  GROUP: 'group',\n  PRIVATE: 'private',\n  PUBLIC: 'public'\n}\n\nexport const MESSAGE_TYPES = {\n  POLL: 'poll',\n  TEXT: 'text',\n  INTERACTIVE: 'interactive',\n  NOTIFICATION: 'notification'\n}\n\nexport const INVITE_EXPIRES_IN_DAYS = {\n  ON_BOARDING: null, // No expiration\n  PROPOSAL: 7\n}\n\nexport const MESSAGE_NOTIFICATIONS = {\n  ADD_MEMBER: 'add-member',\n  JOIN_MEMBER: 'join-member',\n  LEAVE_MEMBER: 'leave-member',\n  KICK_MEMBER: 'kick-member',\n  UPDATE_DESCRIPTION: 'update-description',\n  UPDATE_NAME: 'update-name'\n}\n\nexport const MESSAGE_VARIANTS = {\n  PENDING: 'pending',\n  SENT: 'sent',\n  RECEIVED: 'received',\n  FAILED: 'failed'\n}\n\nexport const MESSAGE_NOTIFY_SETTINGS = {\n  ALL_MESSAGES: 'all-messages',\n  DIRECT_MESSAGES: 'direct-messages',\n  NOTHING: 'nothing'\n}\n\nexport const POLL_TYPES = {\n  SINGLE_CHOICE: 'single-vote', // allows only 1 choice per member\n  MULTIPLE_CHOICES: 'multiple-votes' // allows multiple choices on the poll\n}\n\nexport const POLL_STATUS = {\n  ACTIVE: 'active',\n  CLOSED: 'closed'\n}\n\nexport const POLL_MAX_OPTIONS = 20\nexport const POLL_QUESTION_MAX_CHARS = 280\nexport const POLL_OPTION_MAX_CHARS = 280\n", "'use strict'\n\n// This file allows us to deduplicate some code between the main app bundle and\n// the slim'd down contract bundles.\n// Any large shared dependencies between the contracts - that are unlikely to ever\n// change - go into this file. For example, we are using Vue between the frontend\n// and the contracts (for the Vue.set/Vue.delete functions), and those are unlikely\n// to ever change in their behavior. Therefore it's a perfect candidate to go in\n// this file, resulting a smaller overall bundle for the contract slim builds.\n// All other in-project code that's shared between the contracts should be\n// placed under 'frontend/model/contracts/shared/' and imported directly\n// from both the app and the contracts. This will result in some duplicated code being\n// loaded by the contracts (even the slim'd versions) and the main app, however,\n// it will ensure the safe and consistent operation of contracts, minimizing the\n// likelihood that there will ever be a conflict between their state and what the UI\n// expects the behavior to be.\n\n// EVERYTHING EXPORTED BY THIS FILE MUST ALWAYS AND ONLY BE IMPORTED\n// VIA \"/assets/js/common.js\"!\n// DO NOT CHANGE THE BEHAVIOR OF ANYTHING IMPORTED BY THIS FILE THAT AFFECTS THE\n// BEHAVIOR OF CONTRACTS IN ANY MEANINGFUL WAY!\n// Doing otherwise defeats the purpose of this file and could lead to bugs and conflicts!\n// You may *add* behavior, but never modify or remove it.\n\nexport * from './translations.js'\nexport * from './errors.js'\nexport * as Errors from './errors.js'\n", "const selectors = Object.create(null);\nconst domains = Object.create(null);\nconst globalFilters = [];\nconst domainFilters = Object.create(null);\nconst selectorFilters = Object.create(null);\nconst unsafeSelectors = Object.create(null);\nconst DOMAIN_REGEX = /^[^/]+/;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction sbp(selector, ...data) {\n    const domain = domainFromSelector(selector);\n    const starSelector = `${domain}/*`;\n    const selExists = !!selectors[selector];\n    // Copy of the original selector\n    let sel = selector;\n    if (!selExists) {\n        // If the selector doesn't exist and the start selector is defined,\n        // use the star selector\n        if (selectors[starSelector]) {\n            sel = starSelector;\n        }\n        else {\n            throw new Error(`SBP: selector not registered: ${selector}`);\n        }\n    }\n    // Filters can perform additional functions, and by returning `false` they\n    // can prevent the execution of a selector. Check the most specific filters first.\n    for (const filters of [selectorFilters[selector], domainFilters[domain], globalFilters]) {\n        if (filters) {\n            for (const filter of filters) {\n                if (filter(domain, selector, data) === false)\n                    return;\n            }\n        }\n    }\n    if (!selExists) {\n        // When using the star selector, the first argument is the original selector\n        // used when calling `sbp`.\n        data.unshift(selector);\n    }\n    return selectors[sel].apply(domains[domain].state, data);\n}\nexport function domainFromSelector(selector) {\n    const domainLookup = DOMAIN_REGEX.exec(selector);\n    if (domainLookup === null) {\n        throw new Error(`SBP: selector missing domain: ${selector}`);\n    }\n    return domainLookup[0];\n}\nconst SBP_BASE_SELECTORS = {\n    'sbp/selectors/register': (sels) => {\n        const registered = [];\n        for (const selector in sels) {\n            const domainName = domainFromSelector(selector);\n            // ensure each domain has a domain state associated with it\n            const domain = domainName in domains ? domains[domainName] : (domains[domainName] = { state: Object.create(null), locked: false });\n            if (domain.locked) {\n                (console.warn || console.log)(`[SBP WARN]: not registering selector on locked domain: '${selector}'`);\n            }\n            else if (selectors[selector]) {\n                (console.warn || console.log)(`[SBP WARN]: not registering already registered selector: '${selector}'`);\n            }\n            else if (typeof sels[selector] === 'function') {\n                if (unsafeSelectors[selector]) {\n                    // important warning in case we loaded unknown malware beforehand and aren't expecting this\n                    (console.warn || console.log)(`[SBP WARN]: registering unsafe selector: '${selector}' (remember to lock after overwriting)`);\n                }\n                const fn = selectors[selector] = sels[selector];\n                registered.push(selector);\n                // call the special _init function immediately upon registering\n                if (selector === `${domainName}/_init`) {\n                    fn.call(domain.state);\n                }\n            }\n        }\n        return registered;\n    },\n    'sbp/selectors/unregister': (sels) => {\n        var _a;\n        for (const selector of sels) {\n            if (!unsafeSelectors[selector]) {\n                throw new Error(`SBP: can't unregister locked selector: ${selector}`);\n            }\n            if ((_a = domains[domainFromSelector(selector)]) === null || _a === void 0 ? void 0 : _a.locked) {\n                throw new Error(`SBP: can't unregister selector on a locked domain: '${selector}'`);\n            }\n            delete selectors[selector];\n        }\n    },\n    'sbp/selectors/overwrite': (sels) => {\n        sbp('sbp/selectors/unregister', Object.keys(sels));\n        return sbp('sbp/selectors/register', sels);\n    },\n    'sbp/selectors/unsafe': (sels) => {\n        for (const selector of sels) {\n            if (selectors[selector]) {\n                throw new Error('unsafe must be called before registering selector');\n            }\n            unsafeSelectors[selector] = true;\n        }\n    },\n    'sbp/selectors/lock': (sels) => {\n        for (const selector of sels) {\n            delete unsafeSelectors[selector];\n        }\n    },\n    'sbp/selectors/fn': (sel) => {\n        return selectors[sel];\n    },\n    'sbp/filters/global/add': (filter) => {\n        globalFilters.push(filter);\n    },\n    'sbp/filters/domain/add': (domain, filter) => {\n        if (!domainFilters[domain])\n            domainFilters[domain] = [];\n        domainFilters[domain].push(filter);\n    },\n    'sbp/filters/selector/add': (selector, filter) => {\n        if (!selectorFilters[selector])\n            selectorFilters[selector] = [];\n        selectorFilters[selector].push(filter);\n    },\n    'sbp/domains/lock': (domainNames) => {\n        // If no argument was given then locks every known domain.\n        if (!domainNames) {\n            for (const name in domains) {\n                domains[name].locked = true;\n            }\n        }\n        else {\n            for (const name of domainNames) {\n                if (!domains[name]) {\n                    throw new Error(`SBP: cannot lock non-existent domain: ${name}`);\n                }\n                domains[name].locked = true;\n            }\n        }\n    }\n};\nSBP_BASE_SELECTORS['sbp/selectors/register'](SBP_BASE_SELECTORS);\nexport default sbp;\n", "const nargs = /\\{([0-9a-zA-Z_]+)\\}/g\n\nexport default function template (string        , ...args       )         {\n  const firstArg = args[0]\n  // If the first rest argument is a plain object or array, use it as replacement table.\n  // Otherwise, use the whole rest array as replacement table.\n  const replacementsByKey = (\n    (typeof firstArg === 'object' && firstArg !== null)\n      ? firstArg\n      : args\n  )\n\n  return string.replace(nargs, function replaceArg (match, capture, index) {\n    // Avoid replacing the capture if it is escaped by double curly braces.\n    if (string[index - 1] === '{' && string[index + match.length] === '}') {\n      return capture\n    }\n\n    const maybeReplacement = (\n      // Avoid accessing inherited properties of the replacement table.\n      // $FlowFixMe\n      Object.prototype.hasOwnProperty.call(replacementsByKey, capture)\n        ? replacementsByKey[capture]\n        : undefined\n    )\n\n    if (maybeReplacement === null || maybeReplacement === undefined) {\n      return ''\n    }\n    return String(maybeReplacement)\n  })\n}\n", "'use strict'\n\n// since this file is loaded by common.js, we avoid circular imports and directly import\nimport sbp from '@sbp/sbp'\nimport template from './stringTemplate.js'\n\nconst defaultLanguage = 'en-US'\nconst defaultLanguageCode = 'en'\nconst defaultTranslationTable                       = {}\n\nlet currentLanguage = defaultLanguage\nlet currentLanguageCode = defaultLanguage.split('-')[0]\nlet currentTranslationTable = defaultTranslationTable\n\n/**\n * Loads the translation file corresponding to a given language.\n *\n * @param language - A BPC-47 language tag like the value\n * of `navigator.language`.\n *\n * Language tags must be compared in a case-insensitive way (\u00A72.1.1.).\n *\n * @see https://tools.ietf.org/rfc/bcp/bcp47.txt\n */\nexport default (sbp('sbp/selectors/register', {\n  'translations/init': async function init (language        )                {\n    // A language code is usually the first part of a language tag.\n    const [languageCode] = language.toLowerCase().split('-')\n\n    // No need to do anything if the requested language is already in use.\n    if (language.toLowerCase() === currentLanguage.toLowerCase()) return\n\n    // We can also return early if only the language codes match,\n    //   since we don't have culture-specific translations yet.\n    if (languageCode === currentLanguageCode) return\n\n    // Avoid fetching any resource if the requested language is the default one.\n    if (languageCode === defaultLanguageCode) {\n      currentLanguage = defaultLanguage\n      currentLanguageCode = defaultLanguageCode\n      currentTranslationTable = defaultTranslationTable\n      return\n    }\n    try {\n      currentTranslationTable = (await sbp('backend/translations/get', language)) || defaultTranslationTable\n\n      // Only set `currentLanguage` if there was no error fetching the resource.\n      currentLanguage = language\n      currentLanguageCode = languageCode\n    } catch (error) {\n      console.error(error)\n    }\n  }\n})          )\n\n/*\nExamples:\n\nSimple string:\n  i18n Hello world\n\nString with variables:\n  i18n(\n    :args='{ name: ourUsername }'\n  ) Hello {name}!\n\nString with HTML markup inside:\n  i18n(\n    :args='{ ...LTags(\"strong\", \"span\"), name: ourUsername }'\n  ) Hello {strong_}{name}{_strong}, today it's a {span_}nice day{_span}!\n  | or\n  i18n(\n    :args='{ ...LTags(\"span\"), name: \"<strong>${ourUsername}</strong>\" }'\n  ) Hello {name}, today it's a {span_}nice day{_span}!\n\nString with Vue components inside:\n  i18n(\n    compile\n    :args='{ r1: `<router-link class=\"link\" to=\"/login\">`, r2: \"</router-link>\"}'\n  ) Go to {r1}login{r2} page.\n\n## When to use LTags or write html as part of the key?\n- Use LTags when they wrap a variable and raw text. Example:\n\n  i18n(\n    :args='{ count: 5, ...LTags(\"strong\") }'\n  ) Invite {strong}{count} members{strong} to the party!\n\n- Write HTML when it wraps only the variable.\n-- That way translators don't need to worry about extra information.\n  i18n(\n    :args='{ count: \"<strong>5</strong>\" }'\n  ) Invite {count} members to the party!\n*/\n\nexport function LTags (...tags          )                  {\n  const o = {\n    'br_': '<br/>'\n  }\n  for (const tag of tags) {\n    o[`${tag}_`] = `<${tag}>`\n    o[`_${tag}`] = `</${tag}>`\n  }\n  return o\n}\n\nexport function L (\n  key        ,\n  args                          \n)         {\n  return template(currentTranslationTable[key] || key, args)\n    // Avoid inopportune linebreaks before certain punctuations.\n    // '\\u00a0' is a non-breaking space\n    // The character is used instead of `&nbsp;` or `&#160;` for conciseness\n    // and compatibility.\n    .replace(/\\s(?=[;:?!])/g, '\\u00a0')\n}\n\nexport function LError (error       , toGithub          )                       {\n  let url = 'https://github.com/okTurtles/group-income/issues'\n  if (!toGithub && sbp('state/vuex/state').loggedIn) {\n    const baseRoute = sbp('controller/router').options.base\n    url = `${baseRoute}?modal=UserSettingsModal&tab=application-logs&errorMsg=${encodeURIComponent(error.message)}`\n  }\n  return {\n    reportError: L('\"{errorMsg}\". You can {a_}report the error{_a}.', {\n      errorMsg: error.message,\n      'a_': `<a class=\"link\" target=\"_blank\" href=\"${url}\">`,\n      '_a': '</a>'\n    })\n  }\n}\n", "'use strict'\n\nimport { ChelErrorGenerator } from '~/shared/domains/chelonia/errors.js'\n\nexport const GIErrorIgnoreAndBan               = ChelErrorGenerator('GIErrorIgnoreAndBan')\n\n// Used to throw human readable errors on UI.\nexport const GIErrorUIRuntimeError               = ChelErrorGenerator('GIErrorUIRuntimeError')\n\nexport const GIErrorMissingSigningKeyError               = ChelErrorGenerator('GIErrorMissingSigningKeyError')\n", "'use strict'\n\n// ugly boilerplate because JavaScript is stupid\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\nexport const ChelErrorGenerator = (\n  name        ,\n  base               = Error\n)               =>\n  ((class extends base {\n    constructor (...params       ) {\n      super(...params)\n      this.name = name // string literal so minifier doesn't overwrite\n      // Polyfill for cause property\n      // $FlowFixMe[prop-missing]\n      if (params[1]?.cause !== this.cause) {\n        // $FlowFixMe[prop-missing]\n        Object.defineProperty(this, 'cause', { configurable: true, writable: true, value: params[1]?.cause })\n      }\n      if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, this.constructor)\n      }\n    }\n  }     )              )\n\nexport const ChelErrorWarning               = ChelErrorGenerator('ChelErrorWarning')\nexport const ChelErrorAlreadyProcessed               = ChelErrorGenerator('ChelErrorAlreadyProcessed')\nexport const ChelErrorDBBadPreviousHEAD               = ChelErrorGenerator('ChelErrorDBBadPreviousHEAD')\nexport const ChelErrorDBConnection               = ChelErrorGenerator('ChelErrorDBConnection')\nexport const ChelErrorUnexpected               = ChelErrorGenerator('ChelErrorUnexpected')\nexport const ChelErrorKeyAlreadyExists               = ChelErrorGenerator('ChelErrorKeyAlreadyExists')\nexport const ChelErrorUnrecoverable               = ChelErrorGenerator('ChelErrorUnrecoverable')\nexport const ChelErrorForkedChain               = ChelErrorGenerator('ChelErrorForkedChain')\nexport const ChelErrorDecryptionError               = ChelErrorGenerator('ChelErrorDecryptionError')\nexport const ChelErrorDecryptionKeyNotFound               = ChelErrorGenerator('ChelErrorDecryptionKeyNotFound', ChelErrorDecryptionError)\nexport const ChelErrorSignatureError               = ChelErrorGenerator('ChelErrorSignatureError')\nexport const ChelErrorSignatureKeyUnauthorized               = ChelErrorGenerator('ChelErrorSignatureKeyUnauthorized', ChelErrorSignatureError)\nexport const ChelErrorSignatureKeyNotFound               = ChelErrorGenerator('ChelErrorSignatureKeyNotFound', ChelErrorSignatureError)\nexport const ChelErrorFetchServerTimeFailed               = ChelErrorGenerator('ChelErrorFetchServerTimeFailed')\nexport const ChelErrorUnexpectedHttpResponseCode               = ChelErrorGenerator('ChelErrorUnexpectedHttpResponseCode')\nexport const ChelErrorResourceGone               = ChelErrorGenerator('ChelErrorResourceGone', ChelErrorUnexpectedHttpResponseCode)\n", "'use strict'\n\nimport { L } from '@common/common.js'\n\nexport const MINS_MILLIS = 60000\nexport const HOURS_MILLIS = 60 * MINS_MILLIS\nexport const DAYS_MILLIS = 24 * HOURS_MILLIS\nexport const MONTHS_MILLIS = 30 * DAYS_MILLIS\nexport const YEARS_MILLIS = 365 * DAYS_MILLIS\n\nexport const plusOnePeriodLength = (timestamp        , periodLength        )         => (\n  dateToPeriodStamp(addTimeToDate(timestamp, periodLength))\n)\n\nexport const minusOnePeriodLength = (timestamp        , periodLength        )         => (\n  dateToPeriodStamp(addTimeToDate(timestamp, -periodLength))\n)\n\n// @param knownSortedStamps\n// - MUST be sorted in ascending order (lower timestamps first)\n// - MAY NOT contain duplicate elements\n// @param guess\n// - when truthy, will use periodLength to guess the period stamp for the return values\n// - otherwise, will return undefined if the date is not in the knownSortedStamps\nexport function periodStampsForDate (\n  date               ,\n  { knownSortedStamps, periodLength, guess }                                                                        \n)         {\n  // $FlowFixMe - Pedantic '[method-unbinding]' error\n  if (!(isIsoString(date) || Object.prototype.toString.call(date) === '[object Date]')) {\n    throw new TypeError('must be ISO string or Date object')\n  }\n  const timestamp = typeof date === 'string' ? date : date.toISOString()\n  let previous, current, next\n  if (knownSortedStamps.length) {\n    const latest = knownSortedStamps[knownSortedStamps.length - 1]\n    const earliest = knownSortedStamps[0]\n    if (timestamp >= latest) {\n      current = periodStampGivenDate({ recentDate: timestamp, periodStart: latest, periodLength })\n      next = plusOnePeriodLength(current, periodLength)\n      previous = current > latest\n        ? minusOnePeriodLength(current, periodLength)\n        : knownSortedStamps[knownSortedStamps.length - 2]\n    } else if (guess && timestamp < earliest) {\n      // handle dates earlier than all known stamps\n      current = periodStampGivenDate({ recentDate: timestamp, periodStart: earliest, periodLength })\n      next = plusOnePeriodLength(current, periodLength)\n      previous = minusOnePeriodLength(current, periodLength)\n    } else {\n      for (let i = knownSortedStamps.length - 2; i >= 0; i--) {\n        if (timestamp >= knownSortedStamps[i]) {\n          current = knownSortedStamps[i]\n          // `i + 1` is always a valid index.\n          next = knownSortedStamps[i + 1]\n          previous = i > 0\n            ? knownSortedStamps[i - 1]\n            : (guess ? minusOnePeriodLength(current, periodLength) : undefined)\n          break\n        }\n      }\n    }\n  }\n  return { previous, current, next }\n}\n\nexport function addMonthsToDate (date        , months        )       {\n  const now = new Date(date)\n  return new Date(now.setMonth(now.getMonth() + months))\n}\n\n// It might be tempting to deal directly with Dates and ISOStrings, since that's basically\n// what a period stamp is at the moment, but keeping this abstraction allows us to change\n// our mind in the future simply by editing these two functions.\n// TODO: We may want to, for example, get the time from the server instead of relying on\n// the client in case the client's clock isn't set correctly.\n// See: https://github.com/okTurtles/group-income/issues/531\nexport function dateToPeriodStamp (date               )         {\n  return new Date(date).toISOString()\n}\n\nexport function dateFromPeriodStamp (daystamp        )       {\n  return new Date(daystamp)\n}\n\nexport function periodStampGivenDate ({ recentDate, periodStart, periodLength }   \n                                                               \n )         {\n  const periodStartDate = dateFromPeriodStamp(periodStart)\n  let nextPeriod = addTimeToDate(periodStartDate, periodLength)\n  const curDate = new Date(recentDate)\n  let curPeriod\n  if (curDate < nextPeriod) {\n    if (curDate >= periodStartDate) {\n      return periodStart // we're still in the same period\n    } else {\n      // we're in a period before the current one\n      curPeriod = periodStartDate\n      do {\n        curPeriod = addTimeToDate(curPeriod, -periodLength)\n      } while (curDate < curPeriod)\n    }\n  } else {\n    // we're at least a period ahead of periodStart\n    do {\n      curPeriod = nextPeriod\n      nextPeriod = addTimeToDate(nextPeriod, periodLength)\n    } while (curDate >= nextPeriod)\n  }\n\n  return dateToPeriodStamp(curPeriod)\n}\n\nexport function dateIsWithinPeriod ({ date, periodStart, periodLength }   \n                                                         \n )          {\n  const dateObj = new Date(date)\n  const start = dateFromPeriodStamp(periodStart)\n  return dateObj > start && dateObj < addTimeToDate(start, periodLength)\n}\n\nexport function addTimeToDate (date               , timeMillis        )       {\n  const d = new Date(date)\n  d.setTime(d.getTime() + timeMillis)\n  return d\n}\n\nexport function dateToMonthstamp (date               )         {\n  // we could use Intl.DateTimeFormat but that doesn't support .format() on Android\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DateTimeFormat/format\n  return new Date(date).toISOString().slice(0, 7)\n}\n\nexport function dateFromMonthstamp (monthstamp        )       {\n  // this is a hack to prevent new Date('2020-01').getFullYear() => 2019\n  return new Date(`${monthstamp}-01T00:01:00.000Z`) // the Z is important\n}\n\n// TODO: to prevent conflicts among user timezones, we need\n//       to use the server's time, and not our time here.\n//       https://github.com/okTurtles/group-income/issues/531\nexport function currentMonthstamp ()         {\n  return dateToMonthstamp(new Date())\n}\n\nexport function prevMonthstamp (monthstamp        )         {\n  const date = dateFromMonthstamp(monthstamp)\n  date.setMonth(date.getMonth() - 1)\n  return dateToMonthstamp(date)\n}\n\nexport function comparePeriodStamps (periodA        , periodB        )         {\n  return dateFromPeriodStamp(periodA).getTime() - dateFromPeriodStamp(periodB).getTime()\n}\n\nexport function compareMonthstamps (monthstampA        , monthstampB        )         {\n  return dateFromMonthstamp(monthstampA).getTime() - dateFromMonthstamp(monthstampB).getTime()\n  // const A = dateA.getMonth() + dateA.getFullYear() * 12\n  // const B = dateB.getMonth() + dateB.getFullYear() * 12\n  // return A - B\n}\n\nexport function compareISOTimestamps (a        , b        )         {\n  return new Date(a).getTime() - new Date(b).getTime()\n}\n\nexport function lastDayOfMonth (date      )       {\n  return new Date(date.getFullYear(), date.getMonth() + 1, 0)\n}\n\nexport function firstDayOfMonth (date      )       {\n  return new Date(date.getFullYear(), date.getMonth(), 1)\n}\n\nexport function getLocale ()         {\n  const fallback = 'en-US-POSIX'\n\n  return typeof navigator === 'undefined'\n    // Fallback for Mocha tests.\n    ? fallback\n    // Flow considers `navigator.languages` to be of type `$ReadOnlyArray<string>`,\n    // which is not compatible with the `string[]` expected by `.toLocaleDateString()`.\n    // Casting to `string[]` through `any` as a workaround.\n    : (navigator.languages     ) ?? navigator.language ?? fallback\n}\n\nexport function humanDate (\n  date                        ,\n  options                              = { month: 'short', day: 'numeric' }\n)         {\n  const dateObj = new Date(date)\n  // NOTE: `.toLocaleDateString()` automatically takes local timezone differences into account.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString\n  const locale = getLocale()\n\n  // Avoid returning 'Invalid Date'\n  if (!isNaN(dateObj.valueOf())) return dateObj.toLocaleDateString(locale, options)\n  return ''\n}\n\nexport function humanTimeString (\n  date                        ,\n  options       = { hour: '2-digit', minute: '2-digit' }\n)         {\n  const dateObj = new Date(date)\n  return dateObj.toLocaleTimeString(getLocale(), options)\n}\n\nexport function isPeriodStamp (arg        )          {\n  return isIsoString(arg)\n}\n\nexport function isFullMonthstamp (arg        )          {\n  return /^\\d{4}-(0[1-9]|1[0-2])$/.test(arg)\n}\n\nexport function isIsoString (arg     )          {\n  return typeof arg === 'string' && /\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z/.test(arg)\n}\n\nexport function isMonthstamp (arg        )          {\n  return isShortMonthstamp(arg) || isFullMonthstamp(arg)\n}\n\nexport function isShortMonthstamp (arg        )          {\n  return /^(0[1-9]|1[0-2])$/.test(arg)\n}\n\nexport function monthName (monthstamp        )         {\n  return humanDate(dateFromMonthstamp(monthstamp), { month: 'long' })\n}\n\nexport function proximityDate (date      )         {\n  date = new Date(date)\n  const today = new Date()\n  const yesterday = (d => new Date(d.setDate(d.getDate() - 1)))(new Date())\n  const lastWeek = (d => new Date(d.setDate(d.getDate() - 7)))(new Date())\n\n  for (const toReset of [date, today, yesterday, lastWeek]) {\n    toReset.setHours(0)\n    toReset.setMinutes(0)\n    toReset.setSeconds(0, 0)\n  }\n\n  const datems = Number(date)\n  let pd = date > lastWeek ? humanDate(datems, { month: 'short', day: 'numeric', year: 'numeric' }) : humanDate(datems)\n  if (date.getTime() === yesterday.getTime()) pd = L('Yesterday')\n  if (date.getTime() === today.getTime()) pd = L('Today')\n\n  return pd\n}\n\nexport function timeSince (datems        , dateNow         = Date.now())         {\n  const interval = dateNow - datems\n\n  if (interval >= DAYS_MILLIS * 2) {\n    // Make sure to replace any ordinary space character by a non-breaking one.\n    // $FlowFixMe\n    return humanDate(datems).replaceAll(' ', '\\xa0')\n  }\n  if (interval >= DAYS_MILLIS) {\n    return L('1d')\n  }\n  if (interval >= HOURS_MILLIS) {\n    return L('{hours}h', { hours: Math.floor(interval / HOURS_MILLIS) })\n  }\n  if (interval >= MINS_MILLIS) {\n    // Maybe use 'min' symbol rather than 'm'?\n    return L('{minutes}m', { minutes: Math.max(1, Math.floor(interval / MINS_MILLIS)) })\n  }\n  return L('<1m')\n}\n\nexport function cycleAtDate (atDate               )         {\n  const now = new Date(atDate) // Just in case the parameter is a string type.\n  const partialCycles = now.getDate() / lastDayOfMonth(now).getDate()\n  return partialCycles\n}\n", "// to make rollup happy, I copied flowTyper-js\n// library into this file (it was refusing to\n// import because of the way functions were being\n// exported).\n//\n// GI EDIT NOTES:\n//\n// - The following functions can be used directly with 'validate'\n//   because they've had their '_scope' second parameter removed:\n//   - arrayOf\n//   - mapOf\n//   - object\n//   - objectOf\n//   - objectMaybeOf (this is a custom function that didn't exist in flowTyper)\n//\n// TODO: remove this file from eslintIgnore in package.json and fix errors\n\n                                             \n                                           \n                                                \n                                                      \n                                                       \n                                                            \n                                                 \n\n                                \n                   \n                  \n \n\n                                   \n                   \n                   \n                  \n \n\n                                      \n                   \n                   \n                   \n                   \n \n\n                                         \n                   \n                   \n                   \n                   \n                  \n \n\nexport const EMPTY_VALUE = Symbol('@@empty')\nexport const isEmpty = v => v === EMPTY_VALUE\nexport const isNil = v => v === null\nexport const isUndef = v => typeof v === 'undefined'\nexport const isBoolean = v => typeof v === 'boolean'\nexport const isNumber = v => typeof v === 'number'\nexport const isString = v => typeof v === 'string'\nexport const isObject = v => !isNil(v) && typeof v === 'object'\nexport const isFunction = v => typeof v === 'function'\n\nexport const isType = typeFn => (v, _scope = '') => {\n  try {\n    typeFn(v, _scope)\n    return true\n  } catch (_) {\n    return false\n  }\n}\n\n// This function will return value based on schema with inferred types. This\n// value can be used to define type in Flow with 'typeof' utility.\nexport const typeOf = schema => schema(EMPTY_VALUE, '')\nexport const getType = (typeFn, _options) => {\n  if (isFunction(typeFn.type)) return typeFn.type(_options)\n  return typeFn.name || '?'\n}\n\n// error\nexport class TypeValidatorError extends Error {\n  expectedType        \n  valueType        \n  value        \n  typeScope        \n  sourceFile        \n\n  constructor (\n    message         ,\n    expectedType        ,\n    valueType        ,\n    value        ,\n    typeName         = '',\n    typeScope          = ''\n  ) {\n    const errMessage = message ||\n      `invalid \"${valueType}\" value type; ${typeName || expectedType} type expected`\n    super(errMessage)\n    this.expectedType = expectedType\n    this.valueType = valueType\n    this.value = value\n    this.typeScope = typeScope || ''\n    this.sourceFile = this.getSourceFile()\n    this.message = `${errMessage}\\n${this.getErrorInfo()}`\n    this.name = this.constructor.name\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, TypeValidatorError)\n    }\n  }\n\n  getSourceFile ()         {\n    const fileNames = this.stack.match(/(\\/[\\w_\\-.]+)+(\\.\\w+:\\d+:\\d+)/g) || []\n    return fileNames.find(fileName => fileName.indexOf('/flowTyper-js/dist/') === -1) || ''\n  }\n\n  getErrorInfo ()         {\n    return `\n    file     ${this.sourceFile}\n    scope    ${this.typeScope}\n    expected ${this.expectedType.replace(/\\n/g, '')}\n    type     ${this.valueType}\n    value    ${this.value}\n`\n  }\n}\n\n// TypeValidatorError.prototype.name = 'TypeValidatorError'\n// exports.TypeValidatorError = TypeValidatorError\n\nconst validatorError =    (\n  typeFn                  ,\n  value       ,\n  scope         ,\n  message         ,\n  expectedType         ,\n  valueType         \n)                     => {\n  return new TypeValidatorError(\n    message,\n    expectedType || getType(typeFn),\n    valueType || typeof value,\n    JSON.stringify(value),\n    typeFn.name,\n    scope\n  )\n}\n\nexport const arrayOf =\n     (typeFn                  , _scope          = 'Array')                        => {\n    function array (value) {\n      if (isEmpty(value)) return [typeFn(value)]\n      if (Array.isArray(value)) {\n        let index = 0\n        return value.map(v => typeFn(v, `${_scope}[${index++}]`))\n      }\n      throw validatorError(array, value, _scope)\n    }\n    array.type = () => `Array<${getType(typeFn)}>`\n    return array\n  }\n\nexport const literalOf =\n                   (primitive   )                   => {\n    function literal (value, _scope = '') {\n      if (isEmpty(value) || (value === primitive)) return primitive\n      throw validatorError(literal, value, _scope)\n    }\n    literal.type = () => {\n      if (isBoolean(primitive)) return `${primitive ? 'true' : 'false'}`\n      else return `\"${primitive}\"`\n    }\n    return literal\n  }\n\nexport const mapOf =       (\n  keyTypeFn                  ,\n  typeFn                  \n)                            => {\n  function mapOf (value) {\n    if (isEmpty(value)) return {}\n    const o = object(value)\n    const reducer = (acc, key) =>\n      Object.assign(\n        acc,\n        {\n          // $FlowFixMe\n          [keyTypeFn(key, 'Map[_]')]: typeFn(o[key], `Map.${key}`)\n        }\n      )\n    return Object.keys(o).reduce(reducer, {})\n  }\n  mapOf.type = () => `{ [_:${getType(keyTypeFn)}]: ${getType(typeFn)} }`\n  return mapOf\n}\n\nconst isPrimitiveFn = (typeName) =>\n  ['undefined', 'null', 'boolean', 'number', 'string'].includes(typeName)\n\nexport const maybe =\n     (typeFn                  )                        => {\n    function maybe (value, _scope = '') {\n      return (isNil(value) || isUndef(value)) ? value : typeFn(value, _scope)\n    }\n    maybe.type = () => !isPrimitiveFn(typeFn.name) ? `?(${getType(typeFn)})` : `?${getType(typeFn)}`\n    return maybe\n  }\n\nexport const mixed = (\n  function mixed (value) {\n    return value\n  }                  \n)\n\nexport const object = (\n  function (value) {\n    if (isEmpty(value)) return {}\n    if (isObject(value) && !Array.isArray(value)) {\n      return Object.assign({}, value)\n    }\n    throw validatorError(object, value)\n  }                                    \n)\n\nexport const objectOf =                            \n  (typeObj   , _scope          = 'Object')                                                        => {\n  function object2 (value) {\n    const o = object(value)\n    const typeAttrs = Object.keys(typeObj)\n    const unknownAttr = Object.keys(o).find(attr => !typeAttrs.includes(attr))\n    if (unknownAttr) {\n      throw validatorError(\n        object2,\n        value,\n        _scope,\n        `missing object property '${unknownAttr}' in ${_scope} type`\n      )\n    }\n    // IMPORTANT: because esbuild can actually rename the functions in the compiled source\n    //            (e.g. from 'optional' to 'optional2'), we use .includes() instead of ===\n    //            to check the .name of a function\n    const undefAttr = typeAttrs.find(property => {\n      const propertyTypeFn = typeObj[property]\n      return (propertyTypeFn.name.includes('maybe') && !o.hasOwnProperty(property))\n    })\n    if (undefAttr) {\n      throw validatorError(\n        object2,\n        o[undefAttr],\n        `${_scope}.${undefAttr}`,\n        `empty object property '${undefAttr}' for ${_scope} type`,\n        `void | null | ${getType(typeObj[undefAttr]).substr(1)}`,\n        '-'\n      )\n    }\n\n    const reducer = isEmpty(value)\n      ? (acc, key) => Object.assign(acc, { [key]: typeObj[key](value) })\n      : (acc, key) => {\n        const typeFn = typeObj[key]\n        if (typeFn.name.includes('optional') && !o.hasOwnProperty(key)) {\n          return Object.assign(acc, {})\n        } else {\n          return Object.assign(acc, { [key]: typeFn(o[key], `${_scope}.${key}`) })\n        }\n      }\n    return typeAttrs.reduce(reducer, {})\n  }\n  object2.type = () => {\n    const props = Object.keys(typeObj).map(\n      (key) => {\n        const ret = typeObj[key].name.includes('optional')\n        ? `${key}?: ${getType(typeObj[key], { noVoid: true })}`\n        : `${key}: ${getType(typeObj[key])}`\n        return ret\n      }\n    )\n    return `{|\\n ${props.join(',\\n  ')} \\n|}`\n  }\n  return object2\n}\n\n// TODO: add flow type annotations and make it use validatorError etc.\nexport function objectMaybeOf (validations        , _scope          = 'Object')         {\n  return function (data     ) {\n    object(data)\n    for (const key in data) {\n      validations[key]?.(data[key], `${_scope}.${key}`)\n    }\n    return data\n  }\n}\n\nexport const optional =\n     (typeFn                  )                          => {\n    const unionFn = unionOf(typeFn, undef)\n    function optional (v) {\n      return unionFn(v)\n    }\n    optional.type = ({ noVoid }) => !noVoid ? getType(unionFn) : getType(typeFn)\n    return optional\n  }\n\nexport const nil = (\n  function nil (value) {\n    if (isEmpty(value) || isNil(value)) return null\n    throw validatorError(nil, value)\n  }\n                       \n)\n\nexport function undef (value, _scope = '') {\n  if (isEmpty(value) || isUndef(value)) return undefined\n  throw validatorError(undef, value, _scope)\n}\nundef.type = () => 'void'\n// export const undef = (undef: TypeValidator<void>)\n\nexport const boolean = (\n  function boolean (value, _scope = '') {\n    if (isEmpty(value)) return false\n    if (isBoolean(value)) return value\n    throw validatorError(boolean, value, _scope)\n  }\n                          \n)\n\nexport const number = (\n  function number (value, _scope = '') {\n    if (isEmpty(value)) return 0\n    if (isNumber(value)) return value\n    throw validatorError(number, value, _scope)\n  }\n                         \n)\n\nexport const numberRange = (from        , to        , key         = '')                        => {\n  if (!isNumber(from) || !isNumber(to)) { throw new TypeError('Params for numberRange must be numbers') }\n  if (from >= to) { throw new TypeError('Params \"to\" should be bigger than \"from\"') }\n\n  function numberRange (value, _scope = '') {\n    number(value, _scope)\n    if (value >= from && value <= to) return value\n    throw validatorError(\n      numberRange,\n      value,\n      _scope,\n      key\n        ? `number type '${key}' must be within the range of [${from}, ${to}]`\n        : `must be within the range of [${from}, ${to}]`\n    )\n  }\n  numberRange.type = `number(range: [${from}, ${to}])`\n  return numberRange\n}\n\nexport const string = (\n  function string (value, _scope = '') {\n    if (isEmpty(value)) return ''\n    if (isString(value)) return value\n    throw validatorError(string, value, _scope)\n  }\n                         \n)\n\nexport const stringMax = (numChar        , key         = '')                        => {\n  if (!isNumber(numChar)) { throw new Error('param for stringMax must be number') }\n\n  function stringMax (value, _scope = '') {\n    string(value, _scope)\n    if (value.length <= numChar) return value\n    throw validatorError(\n      stringMax,\n      value,\n      _scope,\n      key\n        ? `string type '${key}' cannot exceed ${numChar} characters`\n        : `cannot exceed ${numChar} characters`\n    )\n  }\n  stringMax.type = () => `string(max: ${numChar})`\n  return stringMax\n}\n\n                            \n             \n                                     \n                                                 \n                                                             \n                                                                         \n                                                                                     \n                                                                                                 \n                                                                                                             \n                                                                                                                         \n                                                                                                                                     \n                                                                                                                                                 \n\nfunction tupleOf_ (...typeFuncs) {\n  function tuple (value       , _scope = '') {\n    const cardinality = typeFuncs.length\n    if (isEmpty(value)) return typeFuncs.map(fn => fn(value))\n    if (Array.isArray(value) && value.length === cardinality) {\n      const tupleValue = []\n      for (let i = 0; i < cardinality; i += 1) {\n        tupleValue.push(typeFuncs[i](value[i], _scope))\n      }\n      return tupleValue\n    }\n    throw validatorError(tuple, value, _scope)\n  }\n  tuple.type = () => `[${typeFuncs.map(fn => getType(fn)).join(', ')}]`\n  return tuple\n}\n\n// $FlowFixMe - $Tuple<(A, B, C, ...)[]>\n// const tupleOf: TupleT = tupleOf_\nexport const tupleOf = tupleOf_\n\n             \n                                   \n                                                \n                                                             \n                                                                          \n                                                                                       \n                                                                                                    \n                                                                                                                 \n                                                                                                                              \n                                                                                                                                           \n                                                                                                                                                        \n\nfunction unionOf_ (...typeFuncs) {\n  function union (value       , _scope = '') {\n    for (const typeFn of typeFuncs) {\n      try {\n        return typeFn(value, _scope)\n      } catch (_) {}\n    }\n    throw validatorError(union, value, _scope)\n  }\n  union.type = () => `(${typeFuncs.map(fn => getType(fn)).join(' | ')})`\n  return union\n}\n// $FlowFixMe\n// const unionOf: UnionT = (unionOf_)\nexport const unionOf = unionOf_\n\nexport const actionRequireInnerSignature = (next          )           => (data, props) => {\n  const innerSigningContractID = props.message.innerSigningContractID\n  if (!innerSigningContractID || innerSigningContractID === props.contractID) {\n    throw new Error('Missing inner signature')\n  }\n  return next(data, props)\n}\nexport const validatorFrom = (fn) => {\n  function customType (value       , _scope = '') {\n    if (!fn(value)) {\n      throw validatorError(customType, value, _scope)\n    }\n    return value\n  }\n  return customType\n}\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\n// $FlowFixMe\nimport { isFunction, objectOf, string } from '@model/contracts/misc/flowTyper.js'\nimport { MINS_MILLIS } from '@model/contracts/shared/time.js'\n\n// This file is used in both the SW and window contexts.\n// We do not import Vue for two reasons:\n//   (1) it's bulk that's not needed in the SW, and\n//   (2) there is no place in the app to re-render in response to state updates\n//       in `alreadyFired` and `lastRun`\n\nlet shortestDelay        \nexport const PERIODIC_NOTIFICATION_TYPE = {\n  MIN1: '1MIN',\n  MIN5: '5MIN',\n  MIN15: '15MIN',\n  MIN30: '30MIN'\n}\n\nconst ephemeralNotificationState   \n                                                                  \n  = {\n  notifications: [], partition: Object.create(null)\n}\n\nconst typeToDelayMap = {\n  [PERIODIC_NOTIFICATION_TYPE.MIN1]: 1 * MINS_MILLIS,\n  [PERIODIC_NOTIFICATION_TYPE.MIN5]: 5 * MINS_MILLIS,\n  [PERIODIC_NOTIFICATION_TYPE.MIN15]: 15 * MINS_MILLIS,\n  [PERIODIC_NOTIFICATION_TYPE.MIN30]: 30 * MINS_MILLIS\n}\n\nconst validateNotificationData = objectOf({\n  stateKey: (value) => {\n    value = string(value)\n    if (value.length === 0) {\n      throw new TypeError('Empty notification data state key')\n    }\n    return value\n  },\n  emitCondition: isFunction,\n  emit: isFunction,\n  shouldClearStateKey: isFunction\n})\n\n/**\n * Runs a recursive notification list handler that checks and emits\n * notifications based on specified conditions and delays.\n *\n * The function performs the following steps:\n * 1. Checks if enough time has passed since the last run based on the specified\n * delay.\n * 2. Iterates over each notification entry in the `data.notifications` array:\n *    - If the notification has not been fired and its emit condition evaluates\n *      to true, it:\n *        - Calls the emit function associated with the notification.\n *        - Marks the notification as fired in the `firedMap`.\n *    - If the notification has been fired and its clear condition evaluates to\n *      true, it:\n *        - Removes the notification from the `firedMap`.\n * 3. Updates the `lastRun` timestamp to the current time.\n * 4. Sets a timeout to recursively call `runNotificationListRecursive` after\n * the specified delay, adjusting for the time that has already passed since the\n * last run.\n */\nasync function runNotificationListRecursive () {\n  const rootState = sbp('state/vuex/state')\n  const rootGetters = sbp('state/vuex/getters')\n  const firedMap = rootState.periodicNotificationAlreadyFiredMap.alreadyFired\n  const lastRunMap = rootState.periodicNotificationAlreadyFiredMap.lastRun\n  const callWithStates = (func, stateKey) => func.call(ephemeralNotificationState.partition[stateKey], { rootState, rootGetters })\n\n  // Exit if a timeout is already set\n  if (ephemeralNotificationState.clearTimeout) return\n  // Prevent accidentally calling `runNotificationListRecursive` while it's\n  // still running\n  // We set `clearTimeout` to a local value to stop processing notifications\n  // when clearing stop notifications, to avoid calling\n  // `runNotificationListRecursive` while it's running and to be able to compare\n  // it to the local value later to replace `clearTimeout` later on in this\n  // function\n  let aborted          = false\n  const abort = () => { aborted = true }\n  ephemeralNotificationState.clearTimeout = abort\n\n  // If there are any queued invocations, wait until they're done\n  // This is needed because some of the notifications might need contract state\n  // to be ready. By waiting on all queues, we ensure that we have the latest\n  // state after setting up Chelonia. When periodic notifications were used\n  // only in the browser window (instead of also in the SW), a timeout was used\n  // for a similar effect.\n  await Promise.all(\n    ((Object.entries(sbp('okTurtles.eventQueue/queuedInvocations'))     )                                   )\n      .map(([queue, invocations]) => {\n        return !!invocations.length && sbp('okTurtles.eventQueue/queueEvent', queue, () => {}).catch(() => {})\n      })\n  )\n\n  // Check if enough time has passed since the last run\n  for (const entry of ephemeralNotificationState.notifications) {\n    if (aborted) break\n    const stateKey = entry.stateKey\n    const lastRun = lastRunMap[stateKey] || 0\n    // Use the delay from the notification entry\n    const delay = entry.delay\n    if ((Date.now() - lastRun) >= delay) {\n      try {\n        if (!firedMap[stateKey] && callWithStates(entry.emitCondition, stateKey)) {\n          await callWithStates(entry.emit, stateKey)\n          firedMap[stateKey] = true\n        }\n\n        if (firedMap[stateKey] && callWithStates(entry.shouldClearStateKey, stateKey)) {\n          delete firedMap[stateKey]\n        }\n      } catch (e) {\n        console.error('runNotificationListRecursive: Error calling notification', stateKey, e)\n      }\n\n      // Update the last run timestamp\n      lastRunMap[stateKey] = Date.now()\n    }\n  }\n\n  // Set a timeout for the next run of the notification check\n  // But only do so if `clearTimeout` hasn't been reset\n  if (ephemeralNotificationState.clearTimeout !== abort) return\n  ephemeralNotificationState.clearTimeout = (() => {\n    const timeoutId = setTimeout(\n      () => {\n        delete ephemeralNotificationState.clearTimeout\n        runNotificationListRecursive()\n      },\n      shortestDelay\n    )\n    return () => clearTimeout(timeoutId)\n  })()\n}\n\nfunction clearTimeoutObject () {\n  if (ephemeralNotificationState.clearTimeout) {\n    ephemeralNotificationState.clearTimeout()\n    delete ephemeralNotificationState.clearTimeout\n  }\n\n  ephemeralNotificationState.notifications.forEach(({ stateKey }) => {\n    ephemeralNotificationState.partition[stateKey] = Object.create(null)\n  })\n}\n\nsbp('sbp/selectors/register', {\n  'gi.periodicNotifications/init': function () {\n    return runNotificationListRecursive().catch((e) => {\n      console.error('[gi.periodicNotifications/init] Error', e)\n    })\n  },\n  'gi.periodicNotifications/clearStatesAndStopTimers': function () {\n    const rootState = sbp('state/vuex/state')\n\n    rootState.periodicNotificationAlreadyFiredMap = {\n      alreadyFired: Object.create(null), // { notificationKey: boolean },\n      lastRun: Object.create(null) // { notificationKey: number },\n    }\n    clearTimeoutObject()\n  },\n  'gi.periodicNotifications/importNotifications': function (entries) {\n    const keySet = new Set()\n    for (const { type, notificationData } of entries) {\n      if (!type || !notificationData) throw new Error('A required field in a periodic notification entry is missing.')\n\n      const delay = typeToDelayMap[type]\n      if (!delay) {\n        throw new RangeError('Invalid delay')\n      }\n      // Using inverted logic because `shortestDelay` could be undefined (on\n      // the first call to this function) and `undefined` is coerced to NaN.\n      if (!(shortestDelay <= delay)) shortestDelay = delay\n\n      validateNotificationData(notificationData)\n      if (keySet.has(notificationData.stateKey)) {\n        throw new Error('Duplicate periodic notification state key: ' + notificationData.stateKey)\n      }\n      keySet.add(notificationData.stateKey)\n\n      ephemeralNotificationState.partition[notificationData.stateKey] = Object.create(null)\n      ephemeralNotificationState.notifications.push({\n        ...notificationData,\n        delay\n      })\n    }\n  }\n})\n", "import { DAYS_MILLIS } from '~/frontend/model/contracts/shared/time.js'\n\n// The maximum allowed age of read (resp. unread) stored notifications.\n// Not to be confused with maximum storage duration.\n// Notifications older than `MAX_AGE_READ` are automatically marked as read\nexport const MAX_AGE_READ = 60 * DAYS_MILLIS\n// Notifications older than `MAX_AGE_UNREAD` are automatically discarded.\nexport const MAX_AGE_UNREAD = 180 * DAYS_MILLIS\n// The maximum allowed number of stored notifications.\nexport const MAX_COUNT = 30\n// The maximum allowed number of read (resp. unread) stored notifications.\nexport const MAX_COUNT_READ = 20\nexport const MAX_COUNT_UNREAD = 30\n", "export const empty = new Uint8Array(0);\nexport function toHex(d) {\n    return d.reduce((hex, byte) => hex + byte.toString(16).padStart(2, '0'), '');\n}\nexport function fromHex(hex) {\n    const hexes = hex.match(/../g);\n    return hexes != null ? new Uint8Array(hexes.map(b => parseInt(b, 16))) : empty;\n}\nexport function equals(aa, bb) {\n    if (aa === bb) {\n        return true;\n    }\n    if (aa.byteLength !== bb.byteLength) {\n        return false;\n    }\n    for (let ii = 0; ii < aa.byteLength; ii++) {\n        if (aa[ii] !== bb[ii]) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function coerce(o) {\n    if (o instanceof Uint8Array && o.constructor.name === 'Uint8Array') {\n        return o;\n    }\n    if (o instanceof ArrayBuffer) {\n        return new Uint8Array(o);\n    }\n    if (ArrayBuffer.isView(o)) {\n        return new Uint8Array(o.buffer, o.byteOffset, o.byteLength);\n    }\n    throw new Error('Unknown type, must be binary type');\n}\nexport function isBinary(o) {\n    return o instanceof ArrayBuffer || ArrayBuffer.isView(o);\n}\nexport function fromString(str) {\n    return new TextEncoder().encode(str);\n}\nexport function toString(b) {\n    return new TextDecoder().decode(b);\n}\n", "/* eslint-disable */\n// base-x encoding / decoding\n// Copyright (c) 2018 base-x contributors\n// Copyright (c) 2014-2018 The Bitcoin Core developers (base58.cpp)\n// Distributed under the MIT software license, see the accompanying\n// file LICENSE or http://www.opensource.org/licenses/mit-license.php.\n/**\n * @param {string} ALPHABET\n * @param {any} name\n */\nfunction base(ALPHABET, name) {\n    if (ALPHABET.length >= 255) {\n        throw new TypeError('Alphabet too long');\n    }\n    var BASE_MAP = new Uint8Array(256);\n    for (var j = 0; j < BASE_MAP.length; j++) {\n        BASE_MAP[j] = 255;\n    }\n    for (var i = 0; i < ALPHABET.length; i++) {\n        var x = ALPHABET.charAt(i);\n        var xc = x.charCodeAt(0);\n        if (BASE_MAP[xc] !== 255) {\n            throw new TypeError(x + ' is ambiguous');\n        }\n        BASE_MAP[xc] = i;\n    }\n    var BASE = ALPHABET.length;\n    var LEADER = ALPHABET.charAt(0);\n    var FACTOR = Math.log(BASE) / Math.log(256); // log(BASE) / log(256), rounded up\n    var iFACTOR = Math.log(256) / Math.log(BASE); // log(256) / log(BASE), rounded up\n    /**\n     * @param {any[] | Iterable<number>} source\n     */\n    function encode(source) {\n        // @ts-ignore\n        if (source instanceof Uint8Array) { }\n        else if (ArrayBuffer.isView(source)) {\n            source = new Uint8Array(source.buffer, source.byteOffset, source.byteLength);\n        }\n        else if (Array.isArray(source)) {\n            source = Uint8Array.from(source);\n        }\n        if (!(source instanceof Uint8Array)) {\n            throw new TypeError('Expected Uint8Array');\n        }\n        if (source.length === 0) {\n            return '';\n        }\n        // Skip & count leading zeroes.\n        var zeroes = 0;\n        var length = 0;\n        var pbegin = 0;\n        var pend = source.length;\n        while (pbegin !== pend && source[pbegin] === 0) {\n            pbegin++;\n            zeroes++;\n        }\n        // Allocate enough space in big-endian base58 representation.\n        var size = ((pend - pbegin) * iFACTOR + 1) >>> 0;\n        var b58 = new Uint8Array(size);\n        // Process the bytes.\n        while (pbegin !== pend) {\n            var carry = source[pbegin];\n            // Apply \"b58 = b58 * 256 + ch\".\n            var i = 0;\n            for (var it1 = size - 1; (carry !== 0 || i < length) && (it1 !== -1); it1--, i++) {\n                carry += (256 * b58[it1]) >>> 0;\n                b58[it1] = (carry % BASE) >>> 0;\n                carry = (carry / BASE) >>> 0;\n            }\n            if (carry !== 0) {\n                throw new Error('Non-zero carry');\n            }\n            length = i;\n            pbegin++;\n        }\n        // Skip leading zeroes in base58 result.\n        var it2 = size - length;\n        while (it2 !== size && b58[it2] === 0) {\n            it2++;\n        }\n        // Translate the result into a string.\n        var str = LEADER.repeat(zeroes);\n        for (; it2 < size; ++it2) {\n            str += ALPHABET.charAt(b58[it2]);\n        }\n        return str;\n    }\n    /**\n     * @param {string | string[]} source\n     */\n    function decodeUnsafe(source) {\n        if (typeof source !== 'string') {\n            throw new TypeError('Expected String');\n        }\n        if (source.length === 0) {\n            return new Uint8Array();\n        }\n        var psz = 0;\n        // Skip leading spaces.\n        if (source[psz] === ' ') {\n            return;\n        }\n        // Skip and count leading '1's.\n        var zeroes = 0;\n        var length = 0;\n        while (source[psz] === LEADER) {\n            zeroes++;\n            psz++;\n        }\n        // Allocate enough space in big-endian base256 representation.\n        var size = (((source.length - psz) * FACTOR) + 1) >>> 0; // log(58) / log(256), rounded up.\n        var b256 = new Uint8Array(size);\n        // Process the characters.\n        while (source[psz]) {\n            // Decode character\n            var carry = BASE_MAP[source.charCodeAt(psz)];\n            // Invalid character\n            if (carry === 255) {\n                return;\n            }\n            var i = 0;\n            for (var it3 = size - 1; (carry !== 0 || i < length) && (it3 !== -1); it3--, i++) {\n                carry += (BASE * b256[it3]) >>> 0;\n                b256[it3] = (carry % 256) >>> 0;\n                carry = (carry / 256) >>> 0;\n            }\n            if (carry !== 0) {\n                throw new Error('Non-zero carry');\n            }\n            length = i;\n            psz++;\n        }\n        // Skip trailing spaces.\n        if (source[psz] === ' ') {\n            return;\n        }\n        // Skip leading zeroes in b256.\n        var it4 = size - length;\n        while (it4 !== size && b256[it4] === 0) {\n            it4++;\n        }\n        var vch = new Uint8Array(zeroes + (size - it4));\n        var j = zeroes;\n        while (it4 !== size) {\n            vch[j++] = b256[it4++];\n        }\n        return vch;\n    }\n    /**\n     * @param {string | string[]} string\n     */\n    function decode(string) {\n        var buffer = decodeUnsafe(string);\n        if (buffer) {\n            return buffer;\n        }\n        throw new Error(`Non-${name} character`);\n    }\n    return {\n        encode: encode,\n        decodeUnsafe: decodeUnsafe,\n        decode: decode\n    };\n}\nvar src = base;\nvar _brrp__multiformats_scope_baseX = src;\nexport default _brrp__multiformats_scope_baseX;\n", "import { coerce } from '../bytes.mjs';\nimport basex from '../base-x.mjs';\n/**\n * Class represents both BaseEncoder and MultibaseEncoder meaning it\n * can be used to encode to multibase or base encode without multibase\n * prefix.\n */\nclass Encoder {\n    constructor(name, prefix, baseEncode) {\n        this.name = name;\n        this.prefix = prefix;\n        this.baseEncode = baseEncode;\n    }\n    encode(bytes) {\n        if (bytes instanceof Uint8Array) {\n            return `${this.prefix}${this.baseEncode(bytes)}`;\n        }\n        else {\n            throw Error('Unknown type, must be binary type');\n        }\n    }\n}\n/**\n * Class represents both BaseDecoder and MultibaseDecoder so it could be used\n * to decode multibases (with matching prefix) or just base decode strings\n * with corresponding base encoding.\n */\nclass Decoder {\n    constructor(name, prefix, baseDecode) {\n        this.name = name;\n        this.prefix = prefix;\n        /* c8 ignore next 3 */\n        if (prefix.codePointAt(0) === undefined) {\n            throw new Error('Invalid prefix character');\n        }\n        this.prefixCodePoint = prefix.codePointAt(0);\n        this.baseDecode = baseDecode;\n    }\n    decode(text) {\n        if (typeof text === 'string') {\n            if (text.codePointAt(0) !== this.prefixCodePoint) {\n                throw Error(`Unable to decode multibase string ${JSON.stringify(text)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);\n            }\n            return this.baseDecode(text.slice(this.prefix.length));\n        }\n        else {\n            throw Error('Can only multibase decode strings');\n        }\n    }\n    or(decoder) {\n        return or(this, decoder);\n    }\n}\nclass ComposedDecoder {\n    constructor(decoders) {\n        this.decoders = decoders;\n    }\n    or(decoder) {\n        return or(this, decoder);\n    }\n    decode(input) {\n        const prefix = input[0];\n        const decoder = this.decoders[prefix];\n        if (decoder != null) {\n            return decoder.decode(input);\n        }\n        else {\n            throw RangeError(`Unable to decode multibase string ${JSON.stringify(input)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`);\n        }\n    }\n}\nexport function or(left, right) {\n    var _a, _b;\n    return new ComposedDecoder(Object.assign(Object.assign({}, ((_a = left.decoders) !== null && _a !== void 0 ? _a : { [left.prefix]: left })), ((_b = right.decoders) !== null && _b !== void 0 ? _b : { [right.prefix]: right })));\n}\nexport class Codec {\n    constructor(name, prefix, baseEncode, baseDecode) {\n        this.name = name;\n        this.prefix = prefix;\n        this.baseEncode = baseEncode;\n        this.baseDecode = baseDecode;\n        this.encoder = new Encoder(name, prefix, baseEncode);\n        this.decoder = new Decoder(name, prefix, baseDecode);\n    }\n    encode(input) {\n        return this.encoder.encode(input);\n    }\n    decode(input) {\n        return this.decoder.decode(input);\n    }\n}\nexport function from({ name, prefix, encode, decode }) {\n    return new Codec(name, prefix, encode, decode);\n}\nexport function baseX({ name, prefix, alphabet }) {\n    const { encode, decode } = basex(alphabet, name);\n    return from({\n        prefix,\n        name,\n        encode,\n        decode: (text) => coerce(decode(text))\n    });\n}\nfunction decode(string, alphabet, bitsPerChar, name) {\n    // Build the character lookup table:\n    const codes = {};\n    for (let i = 0; i < alphabet.length; ++i) {\n        codes[alphabet[i]] = i;\n    }\n    // Count the padding bytes:\n    let end = string.length;\n    while (string[end - 1] === '=') {\n        --end;\n    }\n    // Allocate the output:\n    const out = new Uint8Array((end * bitsPerChar / 8) | 0);\n    // Parse the data:\n    let bits = 0; // Number of bits currently in the buffer\n    let buffer = 0; // Bits waiting to be written out, MSB first\n    let written = 0; // Next byte to write\n    for (let i = 0; i < end; ++i) {\n        // Read one character from the string:\n        const value = codes[string[i]];\n        if (value === undefined) {\n            throw new SyntaxError(`Non-${name} character`);\n        }\n        // Append the bits to the buffer:\n        buffer = (buffer << bitsPerChar) | value;\n        bits += bitsPerChar;\n        // Write out some bits if the buffer has a byte's worth:\n        if (bits >= 8) {\n            bits -= 8;\n            out[written++] = 0xff & (buffer >> bits);\n        }\n    }\n    // Verify that we have received just enough bits:\n    if (bits >= bitsPerChar || (0xff & (buffer << (8 - bits))) !== 0) {\n        throw new SyntaxError('Unexpected end of data');\n    }\n    return out;\n}\nfunction encode(data, alphabet, bitsPerChar) {\n    const pad = alphabet[alphabet.length - 1] === '=';\n    const mask = (1 << bitsPerChar) - 1;\n    let out = '';\n    let bits = 0; // Number of bits currently in the buffer\n    let buffer = 0; // Bits waiting to be written out, MSB first\n    for (let i = 0; i < data.length; ++i) {\n        // Slurp data into the buffer:\n        buffer = (buffer << 8) | data[i];\n        bits += 8;\n        // Write out as much as we can:\n        while (bits > bitsPerChar) {\n            bits -= bitsPerChar;\n            out += alphabet[mask & (buffer >> bits)];\n        }\n    }\n    // Partial character:\n    if (bits !== 0) {\n        out += alphabet[mask & (buffer << (bitsPerChar - bits))];\n    }\n    // Add padding characters until we hit a byte boundary:\n    if (pad) {\n        while (((out.length * bitsPerChar) & 7) !== 0) {\n            out += '=';\n        }\n    }\n    return out;\n}\n/**\n * RFC4648 Factory\n */\nexport function rfc4648({ name, prefix, bitsPerChar, alphabet }) {\n    return from({\n        prefix,\n        name,\n        encode(input) {\n            return encode(input, alphabet, bitsPerChar);\n        },\n        decode(input) {\n            return decode(input, alphabet, bitsPerChar, name);\n        }\n    });\n}\n", "import { baseX } from './base.mjs';\nexport const base58btc = baseX({\n    name: 'base58btc',\n    prefix: 'z',\n    alphabet: '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz'\n});\nexport const base58flickr = baseX({\n    name: 'base58flickr',\n    prefix: 'Z',\n    alphabet: '123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ'\n});\n", "// File generated by build.js, do not edit\nimport blakejs from 'blakejs';\nimport * as bytes from './bytes.mjs';\nimport { from } from './hasher.mjs';\nconst { blake2b } = blakejs;\nexport const blake2b8 = from({\n    name: 'blake2b-8',\n    code: 0xb201,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 1))\n});\nexport const blake2b16 = from({\n    name: 'blake2b-16',\n    code: 0xb202,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 2))\n});\nexport const blake2b24 = from({\n    name: 'blake2b-24',\n    code: 0xb203,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 3))\n});\nexport const blake2b32 = from({\n    name: 'blake2b-32',\n    code: 0xb204,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 4))\n});\nexport const blake2b40 = from({\n    name: 'blake2b-40',\n    code: 0xb205,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 5))\n});\nexport const blake2b48 = from({\n    name: 'blake2b-48',\n    code: 0xb206,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 6))\n});\nexport const blake2b56 = from({\n    name: 'blake2b-56',\n    code: 0xb207,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 7))\n});\nexport const blake2b64 = from({\n    name: 'blake2b-64',\n    code: 0xb208,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 8))\n});\nexport const blake2b72 = from({\n    name: 'blake2b-72',\n    code: 0xb209,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 9))\n});\nexport const blake2b80 = from({\n    name: 'blake2b-80',\n    code: 0xb20a,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 10))\n});\nexport const blake2b88 = from({\n    name: 'blake2b-88',\n    code: 0xb20b,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 11))\n});\nexport const blake2b96 = from({\n    name: 'blake2b-96',\n    code: 0xb20c,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 12))\n});\nexport const blake2b104 = from({\n    name: 'blake2b-104',\n    code: 0xb20d,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 13))\n});\nexport const blake2b112 = from({\n    name: 'blake2b-112',\n    code: 0xb20e,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 14))\n});\nexport const blake2b120 = from({\n    name: 'blake2b-120',\n    code: 0xb20f,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 15))\n});\nexport const blake2b128 = from({\n    name: 'blake2b-128',\n    code: 0xb210,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 16))\n});\nexport const blake2b136 = from({\n    name: 'blake2b-136',\n    code: 0xb211,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 17))\n});\nexport const blake2b144 = from({\n    name: 'blake2b-144',\n    code: 0xb212,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 18))\n});\nexport const blake2b152 = from({\n    name: 'blake2b-152',\n    code: 0xb213,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 19))\n});\nexport const blake2b160 = from({\n    name: 'blake2b-160',\n    code: 0xb214,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 20))\n});\nexport const blake2b168 = from({\n    name: 'blake2b-168',\n    code: 0xb215,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 21))\n});\nexport const blake2b176 = from({\n    name: 'blake2b-176',\n    code: 0xb216,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 22))\n});\nexport const blake2b184 = from({\n    name: 'blake2b-184',\n    code: 0xb217,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 23))\n});\nexport const blake2b192 = from({\n    name: 'blake2b-192',\n    code: 0xb218,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 24))\n});\nexport const blake2b200 = from({\n    name: 'blake2b-200',\n    code: 0xb219,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 25))\n});\nexport const blake2b208 = from({\n    name: 'blake2b-208',\n    code: 0xb21a,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 26))\n});\nexport const blake2b216 = from({\n    name: 'blake2b-216',\n    code: 0xb21b,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 27))\n});\nexport const blake2b224 = from({\n    name: 'blake2b-224',\n    code: 0xb21c,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 28))\n});\nexport const blake2b232 = from({\n    name: 'blake2b-232',\n    code: 0xb21d,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 29))\n});\nexport const blake2b240 = from({\n    name: 'blake2b-240',\n    code: 0xb21e,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 30))\n});\nexport const blake2b248 = from({\n    name: 'blake2b-248',\n    code: 0xb21f,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 31))\n});\nexport const blake2b256 = from({\n    name: 'blake2b-256',\n    code: 0xb220,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 32))\n});\nexport const blake2b264 = from({\n    name: 'blake2b-264',\n    code: 0xb221,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 33))\n});\nexport const blake2b272 = from({\n    name: 'blake2b-272',\n    code: 0xb222,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 34))\n});\nexport const blake2b280 = from({\n    name: 'blake2b-280',\n    code: 0xb223,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 35))\n});\nexport const blake2b288 = from({\n    name: 'blake2b-288',\n    code: 0xb224,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 36))\n});\nexport const blake2b296 = from({\n    name: 'blake2b-296',\n    code: 0xb225,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 37))\n});\nexport const blake2b304 = from({\n    name: 'blake2b-304',\n    code: 0xb226,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 38))\n});\nexport const blake2b312 = from({\n    name: 'blake2b-312',\n    code: 0xb227,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 39))\n});\nexport const blake2b320 = from({\n    name: 'blake2b-320',\n    code: 0xb228,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 40))\n});\nexport const blake2b328 = from({\n    name: 'blake2b-328',\n    code: 0xb229,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 41))\n});\nexport const blake2b336 = from({\n    name: 'blake2b-336',\n    code: 0xb22a,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 42))\n});\nexport const blake2b344 = from({\n    name: 'blake2b-344',\n    code: 0xb22b,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 43))\n});\nexport const blake2b352 = from({\n    name: 'blake2b-352',\n    code: 0xb22c,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 44))\n});\nexport const blake2b360 = from({\n    name: 'blake2b-360',\n    code: 0xb22d,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 45))\n});\nexport const blake2b368 = from({\n    name: 'blake2b-368',\n    code: 0xb22e,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 46))\n});\nexport const blake2b376 = from({\n    name: 'blake2b-376',\n    code: 0xb22f,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 47))\n});\nexport const blake2b384 = from({\n    name: 'blake2b-384',\n    code: 0xb230,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 48))\n});\nexport const blake2b392 = from({\n    name: 'blake2b-392',\n    code: 0xb231,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 49))\n});\nexport const blake2b400 = from({\n    name: 'blake2b-400',\n    code: 0xb232,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 50))\n});\nexport const blake2b408 = from({\n    name: 'blake2b-408',\n    code: 0xb233,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 51))\n});\nexport const blake2b416 = from({\n    name: 'blake2b-416',\n    code: 0xb234,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 52))\n});\nexport const blake2b424 = from({\n    name: 'blake2b-424',\n    code: 0xb235,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 53))\n});\nexport const blake2b432 = from({\n    name: 'blake2b-432',\n    code: 0xb236,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 54))\n});\nexport const blake2b440 = from({\n    name: 'blake2b-440',\n    code: 0xb237,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 55))\n});\nexport const blake2b448 = from({\n    name: 'blake2b-448',\n    code: 0xb238,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 56))\n});\nexport const blake2b456 = from({\n    name: 'blake2b-456',\n    code: 0xb239,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 57))\n});\nexport const blake2b464 = from({\n    name: 'blake2b-464',\n    code: 0xb23a,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 58))\n});\nexport const blake2b472 = from({\n    name: 'blake2b-472',\n    code: 0xb23b,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 59))\n});\nexport const blake2b480 = from({\n    name: 'blake2b-480',\n    code: 0xb23c,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 60))\n});\nexport const blake2b488 = from({\n    name: 'blake2b-488',\n    code: 0xb23d,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 61))\n});\nexport const blake2b496 = from({\n    name: 'blake2b-496',\n    code: 0xb23e,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 62))\n});\nexport const blake2b504 = from({\n    name: 'blake2b-504',\n    code: 0xb23f,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 63))\n});\nexport const blake2b512 = from({\n    name: 'blake2b-512',\n    code: 0xb240,\n    encode: (input) => bytes.coerce(blake2b(input, undefined, 64))\n});\n", "/* eslint-disable */\nvar encode_1 = encode;\nvar MSB = 0x80, REST = 0x7F, MSBALL = ~REST, INT = Math.pow(2, 31);\n/**\n * @param {number} num\n * @param {number[]} out\n * @param {number} offset\n */\nfunction encode(num, out, offset) {\n    out = out || [];\n    offset = offset || 0;\n    var oldOffset = offset;\n    while (num >= INT) {\n        out[offset++] = (num & 0xFF) | MSB;\n        num /= 128;\n    }\n    while (num & MSBALL) {\n        out[offset++] = (num & 0xFF) | MSB;\n        num >>>= 7;\n    }\n    out[offset] = num | 0;\n    // @ts-ignore\n    encode.bytes = offset - oldOffset + 1;\n    return out;\n}\nvar decode = read;\nvar MSB$1 = 0x80, REST$1 = 0x7F;\n/**\n * @param {string | any[]} buf\n * @param {number} offset\n */\nfunction read(buf, offset) {\n    var res = 0, offset = offset || 0, shift = 0, counter = offset, b, l = buf.length;\n    do {\n        if (counter >= l) {\n            // @ts-ignore\n            read.bytes = 0;\n            throw new RangeError('Could not decode varint');\n        }\n        b = buf[counter++];\n        res += shift < 28\n            ? (b & REST$1) << shift\n            : (b & REST$1) * Math.pow(2, shift);\n        shift += 7;\n    } while (b >= MSB$1);\n    // @ts-ignore\n    read.bytes = counter - offset;\n    return res;\n}\nvar N1 = Math.pow(2, 7);\nvar N2 = Math.pow(2, 14);\nvar N3 = Math.pow(2, 21);\nvar N4 = Math.pow(2, 28);\nvar N5 = Math.pow(2, 35);\nvar N6 = Math.pow(2, 42);\nvar N7 = Math.pow(2, 49);\nvar N8 = Math.pow(2, 56);\nvar N9 = Math.pow(2, 63);\nvar length = function (/** @type {number} */ value) {\n    return (value < N1 ? 1\n        : value < N2 ? 2\n            : value < N3 ? 3\n                : value < N4 ? 4\n                    : value < N5 ? 5\n                        : value < N6 ? 6\n                            : value < N7 ? 7\n                                : value < N8 ? 8\n                                    : value < N9 ? 9\n                                        : 10);\n};\nvar varint = {\n    encode: encode_1,\n    decode: decode,\n    encodingLength: length\n};\nvar _brrp_varint = varint;\nexport default _brrp_varint;\n", "/* eslint-disable */\nimport varint from './vendor/varint.mjs';\nexport function decode(data, offset = 0) {\n    const code = varint.decode(data, offset);\n    return [code, varint.decode.bytes];\n}\nexport function encodeTo(int, target, offset = 0) {\n    varint.encode(int, target, offset);\n    return target;\n}\nexport function encodingLength(int) {\n    return varint.encodingLength(int);\n}\n", "/* eslint-disable */\nimport { coerce, equals as equalBytes } from '../bytes.mjs';\nimport * as varint from '../varint.mjs';\n/**\n * Creates a multihash digest.\n */\nexport function create(code, digest) {\n    const size = digest.byteLength;\n    const sizeOffset = varint.encodingLength(code);\n    const digestOffset = sizeOffset + varint.encodingLength(size);\n    const bytes = new Uint8Array(digestOffset + size);\n    varint.encodeTo(code, bytes, 0);\n    varint.encodeTo(size, bytes, sizeOffset);\n    bytes.set(digest, digestOffset);\n    return new Digest(code, size, digest, bytes);\n}\n/**\n * Turns bytes representation of multihash digest into an instance.\n */\nexport function decode(multihash) {\n    const bytes = coerce(multihash);\n    const [code, sizeOffset] = varint.decode(bytes);\n    const [size, digestOffset] = varint.decode(bytes.subarray(sizeOffset));\n    const digest = bytes.subarray(sizeOffset + digestOffset);\n    if (digest.byteLength !== size) {\n        throw new Error('Incorrect length');\n    }\n    return new Digest(code, size, digest, bytes);\n}\nexport function equals(a, b) {\n    if (a === b) {\n        return true;\n    }\n    else {\n        const data = b;\n        return (a.code === data.code &&\n            a.size === data.size &&\n            data.bytes instanceof Uint8Array &&\n            equalBytes(a.bytes, data.bytes));\n    }\n}\n/**\n * Represents a multihash digest which carries information about the\n * hashing algorithm and an actual hash digest.\n */\nexport class Digest {\n    /**\n     * Creates a multihash digest.\n     */\n    constructor(code, size, digest, bytes) {\n        this.code = code;\n        this.size = size;\n        this.digest = digest;\n        this.bytes = bytes;\n    }\n}\n", "/* eslint-disable */\nimport * as Digest from './hashes/digest.mjs';\nexport function from({ name, code, encode }) {\n    return new Hasher(name, code, encode);\n}\n/**\n * Hasher represents a hashing algorithm implementation that produces as\n * `MultihashDigest`.\n */\nexport class Hasher {\n    constructor(name, code, encode) {\n        this.name = name;\n        this.code = code;\n        this.encode = encode;\n    }\n    digest(input) {\n        if (input instanceof Uint8Array || input instanceof ReadableStream) {\n            const result = this.encode(input);\n            return result instanceof Uint8Array\n                ? Digest.create(this.code, result)\n                /* c8 ignore next 1 */\n                : result.then(digest => Digest.create(this.code, digest));\n        }\n        else {\n            throw Error('Unknown type, must be binary type');\n            /* c8 ignore next 1 */\n        }\n    }\n}\n", "var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport blakejs from 'blakejs';\nimport * as bytes from './bytes.mjs';\nimport { from } from './hasher.mjs';\nconst { blake2b, blake2bInit, blake2bUpdate, blake2bFinal } = blakejs;\nexport const blake2b256stream = from({\n    name: 'blake2b-256',\n    code: 0xb220,\n    encode: (input) => __awaiter(void 0, void 0, void 0, function* () {\n        if (input instanceof ReadableStream) {\n            const ctx = blake2bInit(32);\n            const reader = input.getReader();\n            for (;;) {\n                const result = yield reader.read();\n                if (result.done)\n                    break;\n                blake2bUpdate(ctx, bytes.coerce(result.value));\n            }\n            return blake2bFinal(ctx);\n        }\n        else {\n            return bytes.coerce(blake2b(input, undefined, 32));\n        }\n    })\n});\n", "/* eslint-disable */\nimport { rfc4648 } from './base.mjs';\nexport const base32 = rfc4648({\n    prefix: 'b',\n    name: 'base32',\n    alphabet: 'abcdefghijklmnopqrstuvwxyz234567',\n    bitsPerChar: 5\n});\nexport const base32upper = rfc4648({\n    prefix: 'B',\n    name: 'base32upper',\n    alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567',\n    bitsPerChar: 5\n});\nexport const base32pad = rfc4648({\n    prefix: 'c',\n    name: 'base32pad',\n    alphabet: 'abcdefghijklmnopqrstuvwxyz234567=',\n    bitsPerChar: 5\n});\nexport const base32padupper = rfc4648({\n    prefix: 'C',\n    name: 'base32padupper',\n    alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=',\n    bitsPerChar: 5\n});\nexport const base32hex = rfc4648({\n    prefix: 'v',\n    name: 'base32hex',\n    alphabet: '0123456789abcdefghijklmnopqrstuv',\n    bitsPerChar: 5\n});\nexport const base32hexupper = rfc4648({\n    prefix: 'V',\n    name: 'base32hexupper',\n    alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUV',\n    bitsPerChar: 5\n});\nexport const base32hexpad = rfc4648({\n    prefix: 't',\n    name: 'base32hexpad',\n    alphabet: '0123456789abcdefghijklmnopqrstuv=',\n    bitsPerChar: 5\n});\nexport const base32hexpadupper = rfc4648({\n    prefix: 'T',\n    name: 'base32hexpadupper',\n    alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUV=',\n    bitsPerChar: 5\n});\nexport const base32z = rfc4648({\n    prefix: 'h',\n    name: 'base32z',\n    alphabet: 'ybndrfg8ejkmcpqxot1uwisza345h769',\n    bitsPerChar: 5\n});\n", "var _a;\nimport { base32 } from './bases/base32.mjs';\nimport { base58btc } from './bases/base58.mjs';\nimport { coerce } from './bytes.mjs';\nimport * as Digest from './hashes/digest.mjs';\nimport * as varint from './varint.mjs';\n// This way TS will also expose all the types from module\nexport * from './link/interface.mjs';\nexport function format(link, base) {\n    const { bytes, version } = link;\n    switch (version) {\n        case 0:\n            return toStringV0(bytes, baseCache(link), base !== null && base !== void 0 ? base : base58btc.encoder);\n        default:\n            return toStringV1(bytes, baseCache(link), (base !== null && base !== void 0 ? base : base32.encoder));\n    }\n}\nexport function toJSON(link) {\n    return {\n        '/': format(link)\n    };\n}\nexport function fromJSON(json) {\n    return CID.parse(json['/']);\n}\nconst cache = new WeakMap();\nfunction baseCache(cid) {\n    const baseCache = cache.get(cid);\n    if (baseCache == null) {\n        const baseCache = new Map();\n        cache.set(cid, baseCache);\n        return baseCache;\n    }\n    return baseCache;\n}\nexport class CID {\n    /**\n     * @param version - Version of the CID\n     * @param code - Code of the codec content is encoded in, see https://github.com/multiformats/multicodec/blob/master/table.csv\n     * @param multihash - (Multi)hash of the of the content.\n     */\n    constructor(version, code, multihash, bytes) {\n        this[_a] = 'CID';\n        this.code = code;\n        this.version = version;\n        this.multihash = multihash;\n        this.bytes = bytes;\n        // flag to serializers that this is a CID and\n        // should be treated specially\n        this['/'] = bytes;\n    }\n    /**\n     * Signalling `cid.asCID === cid` has been replaced with `cid['/'] === cid.bytes`\n     * please either use `CID.asCID(cid)` or switch to new signalling mechanism\n     *\n     * @deprecated\n     */\n    get asCID() {\n        return this;\n    }\n    // ArrayBufferView\n    get byteOffset() {\n        return this.bytes.byteOffset;\n    }\n    // ArrayBufferView\n    get byteLength() {\n        return this.bytes.byteLength;\n    }\n    toV0() {\n        switch (this.version) {\n            case 0: {\n                return this;\n            }\n            case 1: {\n                const { code, multihash } = this;\n                if (code !== DAG_PB_CODE) {\n                    throw new Error('Cannot convert a non dag-pb CID to CIDv0');\n                }\n                // sha2-256\n                if (multihash.code !== SHA_256_CODE) {\n                    throw new Error('Cannot convert non sha2-256 multihash CID to CIDv0');\n                }\n                return (CID.createV0(multihash));\n            }\n            default: {\n                throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`);\n            }\n        }\n    }\n    toV1() {\n        switch (this.version) {\n            case 0: {\n                const { code, digest } = this.multihash;\n                const multihash = Digest.create(code, digest);\n                return (CID.createV1(this.code, multihash));\n            }\n            case 1: {\n                return this;\n            }\n            default: {\n                throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`);\n            }\n        }\n    }\n    equals(other) {\n        return CID.equals(this, other);\n    }\n    static equals(self, other) {\n        const unknown = other;\n        return (unknown != null &&\n            self.code === unknown.code &&\n            self.version === unknown.version &&\n            Digest.equals(self.multihash, unknown.multihash));\n    }\n    toString(base) {\n        return format(this, base);\n    }\n    toJSON() {\n        return { '/': format(this) };\n    }\n    link() {\n        return this;\n    }\n    // Legacy\n    [(_a = Symbol.toStringTag, Symbol.for('nodejs.util.inspect.custom'))]() {\n        return `CID(${this.toString()})`;\n    }\n    /**\n     * Takes any input `value` and returns a `CID` instance if it was\n     * a `CID` otherwise returns `null`. If `value` is instanceof `CID`\n     * it will return value back. If `value` is not instance of this CID\n     * class, but is compatible CID it will return new instance of this\n     * `CID` class. Otherwise returns null.\n     *\n     * This allows two different incompatible versions of CID library to\n     * co-exist and interop as long as binary interface is compatible.\n     */\n    static asCID(input) {\n        if (input == null) {\n            return null;\n        }\n        const value = input;\n        if (value instanceof CID) {\n            // If value is instance of CID then we're all set.\n            return value;\n        }\n        else if ((value['/'] != null && value['/'] === value.bytes) || value.asCID === value) {\n            // If value isn't instance of this CID class but `this.asCID === this` or\n            // `value['/'] === value.bytes` is true it is CID instance coming from a\n            // different implementation (diff version or duplicate). In that case we\n            // rebase it to this `CID` implementation so caller is guaranteed to get\n            // instance with expected API.\n            const { version, code, multihash, bytes } = value;\n            return new CID(version, code, multihash, bytes !== null && bytes !== void 0 ? bytes : encodeCID(version, code, multihash.bytes));\n        }\n        else if (value[cidSymbol] === true) {\n            // If value is a CID from older implementation that used to be tagged via\n            // symbol we still rebase it to the this `CID` implementation by\n            // delegating that to a constructor.\n            const { version, multihash, code } = value;\n            const digest = Digest.decode(multihash);\n            return CID.create(version, code, digest);\n        }\n        else {\n            // Otherwise value is not a CID (or an incompatible version of it) in\n            // which case we return `null`.\n            return null;\n        }\n    }\n    /**\n     * @param version - Version of the CID\n     * @param code - Code of the codec content is encoded in, see https://github.com/multiformats/multicodec/blob/master/table.csv\n     * @param digest - (Multi)hash of the of the content.\n     */\n    static create(version, code, digest) {\n        if (typeof code !== 'number') {\n            throw new Error('String codecs are no longer supported');\n        }\n        if (!(digest.bytes instanceof Uint8Array)) {\n            throw new Error('Invalid digest');\n        }\n        switch (version) {\n            case 0: {\n                if (code !== DAG_PB_CODE) {\n                    throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);\n                }\n                else {\n                    return new CID(version, code, digest, digest.bytes);\n                }\n            }\n            case 1: {\n                const bytes = encodeCID(version, code, digest.bytes);\n                return new CID(version, code, digest, bytes);\n            }\n            default: {\n                throw new Error('Invalid version');\n            }\n        }\n    }\n    /**\n     * Simplified version of `create` for CIDv0.\n     */\n    static createV0(digest) {\n        return CID.create(0, DAG_PB_CODE, digest);\n    }\n    /**\n     * Simplified version of `create` for CIDv1.\n     *\n     * @param code - Content encoding format code.\n     * @param digest - Multihash of the content.\n     */\n    static createV1(code, digest) {\n        return CID.create(1, code, digest);\n    }\n    /**\n     * Decoded a CID from its binary representation. The byte array must contain\n     * only the CID with no additional bytes.\n     *\n     * An error will be thrown if the bytes provided do not contain a valid\n     * binary representation of a CID.\n     */\n    static decode(bytes) {\n        const [cid, remainder] = CID.decodeFirst(bytes);\n        if (remainder.length !== 0) {\n            throw new Error('Incorrect length');\n        }\n        return cid;\n    }\n    /**\n     * Decoded a CID from its binary representation at the beginning of a byte\n     * array.\n     *\n     * Returns an array with the first element containing the CID and the second\n     * element containing the remainder of the original byte array. The remainder\n     * will be a zero-length byte array if the provided bytes only contained a\n     * binary CID representation.\n     */\n    static decodeFirst(bytes) {\n        const specs = CID.inspectBytes(bytes);\n        const prefixSize = specs.size - specs.multihashSize;\n        const multihashBytes = coerce(bytes.subarray(prefixSize, prefixSize + specs.multihashSize));\n        if (multihashBytes.byteLength !== specs.multihashSize) {\n            throw new Error('Incorrect length');\n        }\n        const digestBytes = multihashBytes.subarray(specs.multihashSize - specs.digestSize);\n        const digest = new Digest.Digest(specs.multihashCode, specs.digestSize, digestBytes, multihashBytes);\n        const cid = specs.version === 0\n            ? CID.createV0(digest)\n            : CID.createV1(specs.codec, digest);\n        return [cid, bytes.subarray(specs.size)];\n    }\n    /**\n     * Inspect the initial bytes of a CID to determine its properties.\n     *\n     * Involves decoding up to 4 varints. Typically this will require only 4 to 6\n     * bytes but for larger multicodec code values and larger multihash digest\n     * lengths these varints can be quite large. It is recommended that at least\n     * 10 bytes be made available in the `initialBytes` argument for a complete\n     * inspection.\n     */\n    static inspectBytes(initialBytes) {\n        let offset = 0;\n        const next = () => {\n            const [i, length] = varint.decode(initialBytes.subarray(offset));\n            offset += length;\n            return i;\n        };\n        let version = next();\n        let codec = DAG_PB_CODE;\n        if (version === 18) {\n            // CIDv0\n            version = 0;\n            offset = 0;\n        }\n        else {\n            codec = next();\n        }\n        if (version !== 0 && version !== 1) {\n            throw new RangeError(`Invalid CID version ${version}`);\n        }\n        const prefixSize = offset;\n        const multihashCode = next(); // multihash code\n        const digestSize = next(); // multihash length\n        const size = offset + digestSize;\n        const multihashSize = size - prefixSize;\n        return { version, codec, multihashCode, digestSize, multihashSize, size };\n    }\n    /**\n     * Takes cid in a string representation and creates an instance. If `base`\n     * decoder is not provided will use a default from the configuration. It will\n     * throw an error if encoding of the CID is not compatible with supplied (or\n     * a default decoder).\n     */\n    static parse(source, base) {\n        const [prefix, bytes] = parseCIDtoBytes(source, base);\n        const cid = CID.decode(bytes);\n        if (cid.version === 0 && source[0] !== 'Q') {\n            throw Error('Version 0 CID string must not include multibase prefix');\n        }\n        // Cache string representation to avoid computing it on `this.toString()`\n        baseCache(cid).set(prefix, source);\n        return cid;\n    }\n}\nfunction parseCIDtoBytes(source, base) {\n    switch (source[0]) {\n        // CIDv0 is parsed differently\n        case 'Q': {\n            const decoder = base !== null && base !== void 0 ? base : base58btc;\n            return [\n                base58btc.prefix,\n                decoder.decode(`${base58btc.prefix}${source}`)\n            ];\n        }\n        case base58btc.prefix: {\n            const decoder = base !== null && base !== void 0 ? base : base58btc;\n            return [base58btc.prefix, decoder.decode(source)];\n        }\n        case base32.prefix: {\n            const decoder = base !== null && base !== void 0 ? base : base32;\n            return [base32.prefix, decoder.decode(source)];\n        }\n        default: {\n            if (base == null) {\n                throw Error('To parse non base32 or base58btc encoded CID multibase decoder must be provided');\n            }\n            return [source[0], base.decode(source)];\n        }\n    }\n}\nfunction toStringV0(bytes, cache, base) {\n    const { prefix } = base;\n    if (prefix !== base58btc.prefix) {\n        throw Error(`Cannot string encode V0 in ${base.name} encoding`);\n    }\n    const cid = cache.get(prefix);\n    if (cid == null) {\n        const cid = base.encode(bytes).slice(1);\n        cache.set(prefix, cid);\n        return cid;\n    }\n    else {\n        return cid;\n    }\n}\nfunction toStringV1(bytes, cache, base) {\n    const { prefix } = base;\n    const cid = cache.get(prefix);\n    if (cid == null) {\n        const cid = base.encode(bytes);\n        cache.set(prefix, cid);\n        return cid;\n    }\n    else {\n        return cid;\n    }\n}\nconst DAG_PB_CODE = 0x70;\nconst SHA_256_CODE = 0x12;\nfunction encodeCID(version, code, multihash) {\n    const codeOffset = varint.encodingLength(version);\n    const hashOffset = codeOffset + varint.encodingLength(code);\n    const bytes = new Uint8Array(hashOffset + multihash.byteLength);\n    varint.encodeTo(version, bytes, 0);\n    varint.encodeTo(code, bytes, codeOffset);\n    bytes.set(multihash, hashOffset);\n    return bytes;\n}\nconst cidSymbol = Symbol.for('@ipld/js-cid/CID');\n", "'use strict'\n\nimport { base58btc } from '@chelonia/multiformats/bases/base58'\nimport { blake2b256 } from '@chelonia/multiformats/blake2b'\nimport { blake2b256stream } from '@chelonia/multiformats/blake2bstream'\nimport { CID } from '@chelonia/multiformats/cid'\nimport { Buffer } from 'buffer'\nimport { has } from 'turtledash'\n\n// Values from https://github.com/multiformats/multicodec/blob/master/table.csv\nexport const multicodes                          = {\n  RAW: 0x00,\n  JSON: 0x0200,\n  SHELTER_CONTRACT_MANIFEST: 0x511e00,\n  SHELTER_CONTRACT_TEXT: 0x511e01,\n  SHELTER_CONTRACT_DATA: 0x511e02,\n  SHELTER_FILE_MANIFEST: 0x511e03,\n  SHELTER_FILE_CHUNK: 0x511e04\n}\n\nexport const parseCID = (cid        )         => {\n  if (!cid || cid.length < 52 || cid.length > 64) {\n    throw new RangeError('CID length too short or too long')\n  }\n  const parsed = CID.parse(cid, base58btc)\n  if (\n    parsed.version !== 1 ||\n    parsed.multihash.code !== blake2b256.code ||\n    !Object.values(multicodes).includes(parsed.code)\n  ) {\n    throw new Error('Invalid CID')\n  }\n\n  return parsed\n}\n\nexport const maybeParseCID = (cid        )                => {\n  try {\n    return parseCID(cid)\n  } catch {\n    // Ignore errors if the CID couldn't be parsed\n    return null\n  }\n}\n\n// Makes the `Buffer` global available in the browser if needed.\n// $FlowFixMe[cannot-resolve-name]\nif (typeof globalThis === 'object' && !has(globalThis, 'Buffer')) {\n  globalThis.Buffer = Buffer\n}\n\nexport async function createCIDfromStream (data                                      , multicode         = multicodes.RAW)                  {\n  const uint8array = typeof data === 'string' ? new TextEncoder().encode(data) : data\n  const digest = await blake2b256stream.digest(uint8array)\n  return CID.create(1, multicode, digest).toString(base58btc)\n}\n\n// TODO: implement a streaming hashing function for large files.\n// Note: in fact this returns a serialized CID, not a CID object.\nexport function createCID (data                     , multicode         = multicodes.RAW)         {\n  const uint8array = typeof data === 'string' ? new TextEncoder().encode(data) : data\n  const digest = blake2b256.digest(uint8array)\n  return CID.create(1, multicode, digest).toString(base58btc)\n}\n\nexport function blake32Hash (data                     )         {\n  const uint8array = typeof data === 'string' ? new TextEncoder().encode(data) : data\n  const digest = blake2b256.digest(uint8array)\n  // While `digest.digest` is only 32 bytes long in this case,\n  // `digest.bytes` is 36 bytes because it includes a multiformat prefix.\n  return base58btc.encode(digest.bytes)\n}\n\n// NOTE: to preserve consistency across browser and node, we use the Buffer\n//       class. We could use btoa and atob in web browsers (functions that\n//       are unavailable on Node.js), but they do not support Unicode,\n//       and you have to jump through some hoops to get it to work:\n//       https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa#Unicode_strings\n//       These hoops might result in inconsistencies between Node.js and the frontend.\nexport const b64ToBuf = (b64        )         => Buffer.from(b64, 'base64')\nexport const b64ToStr = (b64        )         => b64ToBuf(b64).toString('utf8')\nexport const bufToB64 = (buf        )         => Buffer.from(buf).toString('base64')\nexport const strToBuf = (str        )         => Buffer.from(str, 'utf8')\nexport const strToB64 = (str        )         => strToBuf(str).toString('base64')\nexport const bytesToB64 = (ary            )         => Buffer.from(ary).toString('base64')\n\n// Generate an UUID from a `PushSubscription'\nexport const getSubscriptionId = async (subscriptionInfo        )                  => {\n  const textEncoder = new TextEncoder()\n  // <https://w3c.github.io/push-api/#pushsubscription-interface>\n  const endpoint = textEncoder.encode(subscriptionInfo.endpoint)\n  // <https://w3c.github.io/push-api/#pushencryptionkeyname-enumeration>\n  const p256dh = textEncoder.encode(subscriptionInfo.keys.p256dh)\n  const auth = textEncoder.encode(subscriptionInfo.keys.auth)\n\n  const canonicalForm = new ArrayBuffer(\n    8 +\n      (4 + endpoint.byteLength) + (2 + p256dh.byteLength) +\n      (2 + auth.byteLength)\n  )\n  const canonicalFormU8 = new Uint8Array(canonicalForm)\n  const canonicalFormDV = new DataView(canonicalForm)\n  let offset = 0\n  canonicalFormDV.setFloat64(\n    offset,\n    subscriptionInfo.expirationTime == null\n      ? NaN\n      : subscriptionInfo.expirationTime,\n    false\n  )\n  offset += 8\n  canonicalFormDV.setUint32(offset, endpoint.byteLength, false)\n  offset += 4\n  canonicalFormU8.set(endpoint, offset)\n  offset += endpoint.byteLength\n  canonicalFormDV.setUint16(offset, p256dh.byteLength, false)\n  offset += 2\n  canonicalFormU8.set(p256dh, offset)\n  offset += p256dh.byteLength\n  canonicalFormDV.setUint16(offset, auth.byteLength, false)\n  offset += 2\n  canonicalFormU8.set(auth, offset)\n\n  const digest = await crypto.subtle.digest('SHA-384', canonicalForm)\n  const id = Buffer.from(digest.slice(0, 16))\n  id[6] = 0x80 | (id[6] & 0x0F)\n  id[8] = 0x80 | (id[8] & 0x3F)\n\n  return [\n    id.slice(0, 4),\n    id.slice(4, 6),\n    id.slice(6, 8),\n    id.slice(8, 10),\n    id.slice(10, 16)\n  ].map((p) => p.toString('hex')).join('-')\n}\n", "// manually implemented lodash functions are better than even:\n// https://github.com/lodash/babel-plugin-lodash\n// additional tiny versions of lodash functions are available in VueScript2\nexport function mapValues(obj, fn, o = {}) {\n    for (const key in obj) {\n        o[key] = fn(obj[key]);\n    }\n    return o;\n}\nexport function mapObject(obj, fn) {\n    return Object.fromEntries(Object.entries(obj).map(fn));\n}\nexport function pick(o, props) {\n    const x = Object.create(null);\n    for (const k of props) {\n        if (has(o, k)) {\n            x[k] = o[k];\n        }\n    }\n    return x;\n}\nexport function pickWhere(o, where) {\n    const x = Object.create(null);\n    for (const k in o) {\n        if (where(o[k])) {\n            x[k] = o[k];\n        }\n    }\n    return x;\n}\nexport function choose(array, indices) {\n    const x = [];\n    for (const idx of indices) {\n        x.push(array[idx]);\n    }\n    return x;\n}\nexport function omit(o, props) {\n    const x = Object.create(null);\n    for (const k in o) {\n        if (!props.includes(k)) {\n            x[k] = o[k];\n        }\n    }\n    return x;\n}\nexport function cloneDeep(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\nfunction isMergeableObject(val) {\n    const nonNullObject = val && typeof val === 'object';\n    return (nonNullObject &&\n        Object.prototype.toString.call(val) !== '[object RegExp]' &&\n        Object.prototype.toString.call(val) !== '[object Date]');\n}\nexport function merge(obj, src) {\n    const res = obj;\n    for (const key in src) {\n        const clone = isMergeableObject(src[key]) ? cloneDeep(src[key]) : undefined;\n        let x;\n        // `has` check needed to avoid using inherited properties. This is probably\n        // closer to the behaviour one expects and also avoids prototype pollution.\n        if (clone && has(obj, key) && isMergeableObject((x = res[key]))) {\n            merge(x, clone);\n            continue;\n        }\n        // The following simpler formulation isn't used because it can lead to\n        // prototype pollution. Instead, we use `Object.defineProperty`, which\n        // doesn't have this issue.\n        // // res[key] = clone || src[key] // DO NOT USE!\n        Object.defineProperty(res, key, {\n            configurable: true,\n            enumerable: true,\n            value: clone || src[key],\n            writable: true\n        });\n    }\n    return res;\n}\nexport function delay(msec) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, msec);\n    });\n}\nexport function randomBytes(length) {\n    return crypto.getRandomValues(new Uint8Array(length));\n}\nexport function randomHexString(length) {\n    return Array.from(randomBytes(length), byte => (byte % 16).toString(16)).join('');\n}\nexport function normalizeString(str) {\n    return str\n        // [1]. Normalize strings by replacing intial and final punctuation marks,\n        // which typically are used in smart quote substitution, with a standad\n        // character\n        // (reference issue: https://github.com/okTurtles/group-income/issues/2479)\n        .replace(/[\\p{Pf}\\p{Pi}]/gu, \"'\")\n        // [2]. Normalize the string based on 'Canonical equivalence'. eg) 'Am\u00E9lie' !== 'Ame\u0301lie' even when they are visually identical because their unicode sequences are different.\n        //      (reference: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize#canonical_equivalence_normalization)\n        .normalize('NFC');\n}\nexport function randomIntFromRange(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n}\nexport function randomFromArray(arr) {\n    return arr[Math.floor(Math.random() * arr.length)];\n}\nexport function linearScale([d1, d2], [r1, r2]) {\n    // generate a function that takes a value between d1 and d2 and then\n    // returns a linearly-scaled output whose min and max values are r1 and r2 respectively.\n    const [dSpan, rSpan] = [d2 - d1, r2 - r1];\n    return function (value) {\n        if (value <= d1) {\n            return r1;\n        }\n        else if (value >= d2) {\n            return r2;\n        }\n        else {\n            const percent = (value - d1) / dSpan;\n            return r1 + rSpan * percent;\n        }\n    };\n}\nexport function flatten(arr) {\n    let flat = [];\n    for (let i = 0; i < arr.length; i++) {\n        if (Array.isArray(arr[i])) {\n            flat = flat.concat(arr[i]);\n        }\n        else {\n            flat.push(arr[i]);\n        }\n    }\n    return flat;\n}\nexport function zip(...arr) {\n    const zipped = [];\n    let max = 0;\n    arr.forEach((current) => (max = Math.max(max, current.length)));\n    for (const current of arr) {\n        for (let i = 0; i < max; i++) {\n            zipped[i] = zipped[i] || [];\n            zipped[i].push(current[i]);\n        }\n    }\n    return zipped;\n}\nexport function uniq(array) {\n    return Array.from(new Set(array));\n}\nexport function union(...arrays) {\n    return uniq(Array.prototype.concat.apply([], arrays));\n}\nexport function intersection(a1, ...arrays) {\n    return uniq(a1).filter(v1 => arrays.every(v2 => v2.indexOf(v1) >= 0));\n}\nexport function difference(a1, ...arrays) {\n    const a2 = Array.prototype.concat.apply([], arrays);\n    return a1.filter(v => a2.indexOf(v) === -1);\n}\nexport function deepEqualJSONType(a, b) {\n    if (a === b)\n        return true;\n    if (a == null || b == null || typeof (a) !== typeof (b))\n        return false;\n    if (typeof a !== 'object')\n        return a === b;\n    if (Array.isArray(a) && Array.isArray(b)) {\n        if (a.length !== b.length)\n            return false;\n    }\n    else if (![Object.prototype, null].includes(Object.getPrototypeOf(a))) {\n        throw new Error(`not JSON type: ${a}`);\n    }\n    for (const key in a) {\n        if (!deepEqualJSONType(a[key], b[key]))\n            return false;\n    }\n    return true;\n}\nexport function hashableRepresentation(unsorted) {\n    if (!unsorted || typeof unsorted !== 'object') {\n        return unsorted;\n    }\n    if (Array.isArray(unsorted)) {\n        return unsorted.map(v => hashableRepresentation(v));\n    }\n    else {\n        return Object.keys(unsorted).sort().reduce((acc, curKey) => {\n            acc.push([\n                curKey,\n                hashableRepresentation(unsorted[curKey])\n            ]);\n            return acc;\n        }, []);\n    }\n}\n/**\n * Modified version of: https://github.com/component/debounce/blob/master/index.js\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear'\n * that is a function which will clear the timer to prevent previously scheduled executions.\n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param func function to wrap\n * @param wait timeout in ms (`100`)\n * @param immediate whether to execute at the beginning (`false`)\n * @api public\n */\nexport function debounce(func, wait, immediate) {\n    let timeout, args, context, timestamp, result;\n    if (wait == null)\n        wait = 100;\n    function later() {\n        const last = performance.now() - timestamp;\n        if (last < wait && last >= 0) {\n            timeout = setTimeout(later, wait - last);\n        }\n        else {\n            timeout = undefined;\n            if (!immediate) {\n                result = func.apply(context, args);\n                args = undefined;\n                context = undefined;\n            }\n        }\n    }\n    const debounced = function (...args_) {\n        args = args_;\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        context = this;\n        timestamp = performance.now();\n        const callNow = immediate && !timeout;\n        if (!timeout)\n            timeout = setTimeout(later, wait);\n        if (callNow) {\n            result = func.apply(context, args);\n            args = undefined;\n            context = undefined;\n        }\n        return result;\n    };\n    debounced.clear = function () {\n        if (timeout) {\n            clearTimeout(timeout);\n            timeout = undefined;\n        }\n    };\n    debounced.flush = function () {\n        if (timeout) {\n            result = func.apply(context, args);\n            args = undefined;\n            context = undefined;\n            clearTimeout(timeout);\n            timeout = undefined;\n        }\n    };\n    return debounced;\n}\nexport function throttle(func, delay) {\n    // reference: https://www.geeksforgeeks.org/javascript-throttling/\n    // Previously called time of the function\n    let prev = 0;\n    return (...args) => {\n        // Current called time of the function\n        const now = new Date().getTime();\n        // If difference is greater than delay call\n        if (now - prev > delay) {\n            prev = now;\n            return func(...args);\n        }\n    };\n}\n/**\n * Gets the value at `path` of `obj`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n */\nexport function get(obj, path, defaultValue) {\n    if (!path.length) {\n        return obj;\n    }\n    else if (obj == null) {\n        return defaultValue;\n    }\n    let result = obj;\n    let i = 0;\n    while (result && i < path.length) {\n        result = result[path[i]];\n        i++;\n    }\n    return result === undefined ? defaultValue : result;\n}\nexport const has = Function.prototype.call.bind(Object.prototype.hasOwnProperty);\n", "                                                   \nimport { DAYS_MILLIS as ONE_DAY, HOURS_MILLIS as ONE_HOUR } from '~/frontend/model/contracts/shared/time.js'\nimport {\n  MAX_AGE_READ,\n  MAX_AGE_UNREAD,\n  MAX_COUNT,\n  MAX_COUNT_READ,\n  MAX_COUNT_UNREAD\n} from './storageConstants.js'\nimport { blake32Hash } from '~/shared/functions.js'\nimport { hashableRepresentation } from 'turtledash'\n\n// How much time a notification can stay in the \"new\" state.\nexport const NEW_STATUS_DURATION = 2 * ONE_HOUR\n\nexport function age (notification              )         {\n  return Date.now() - notification.timestamp\n}\n\n/*\n * Creates a copy of the given notification list, possibly sorted and/or truncated to\n * make it suitable for offline storage.\n * The second argument, `status` contains separarately-stored parameters for that\n * notification hash to reflect how notifications are used in the app\n * (specifically, the `read` parameter is stored there).\n *\n * Algorithm steps taken on the copy:\n *\n * 1. Discard any expired notification, e.g. read notifications older than `MAX_AGE_READ`.\n * 2. If `MAX_COUNT_READ` is defined and more than `MAX_COUNT_READ` read\n *    notifications remain, then:\n *   2a. discard every read notification older than the `MAX_COUNT_READ` newest ones.\n * 3. Same step for `MAX_COUNT_UNREAD`.\n * 4. If `MAX_COUNT` is undefined or no more than `MAX_COUNT` notifications remain, then:\n *   4a. sort them by their creation timestamp, in descending order;\n *   4b. return them.\n * 5. Otherwise, take these steps until no more than `MAX_COUNT` notifications remain:\n *   5a. discard read notifications older than 48h;\n *   5b. discard unread notifications older than three weeks;\n *   5c. discard read notifications older than 25h;\n *   5d. discard unread notifications older than two weeks;\n *   5e. discard read notifications;\n *   5f. discard unread notifications, older ones first.\n * 6. Return the remaining notifications.\n */\nexport function applyStorageRules (notifications                , status                             = {})                 {\n  // Apply the MAX_AGE constraint by selecting items that have not yet expired.\n  let items = notifications.filter(item => !isExpired({ ...item, ...status[item.hash] }))\n\n  if (items.length > MAX_COUNT) {\n    // Sort the list by descending priority order.\n    items.sort(compareOnPriority)\n\n    // Apply the MAX_COUNT_READ and MAX_COUNT_UNREAD constraints if necessary.\n    ;[\n      [item => item.read, MAX_COUNT_READ],\n      [item => !item.read, MAX_COUNT_UNREAD]\n    ].forEach(([condition, associatedMaxCount]) => {\n      if (associatedMaxCount !== -1 && associatedMaxCount < MAX_COUNT) {\n        let count = 0\n\n        items = items.filter(item => !condition(item) || (count++, count <= associatedMaxCount))\n      }\n    })\n  }\n  // Check if there are still too many items to store.\n  if (items.length > MAX_COUNT) {\n    // Truncate the list to discard items which have the lowest \"weights\".\n    items.length = MAX_COUNT\n  }\n  // Sort items in chronological order, newest items first.\n  return items.sort(compareOnTimestamp)\n}\n\n// Compares notifications, so that newer ones come first.\nexport function compareOnTimestamp (notificationA              , notificationB              )         {\n  return notificationB.timestamp - notificationA.timestamp\n}\n\n// Compares notifications, so that higher priority ones come first.\nexport function compareOnPriority (notificationA              , notificationB              )         {\n  const TWO_DAYS = 2 * ONE_DAY\n  const FIFTEEN_DAYS = 15 * ONE_DAY\n  const THREE_WEEKS = 21 * ONE_DAY\n  const preferA = -1\n  const preferB = 1\n\n  // If the given notifications are both read or both unread, then prefer the newer one.\n  if (notificationA.read === notificationB.read) {\n    return notificationA.timestamp > notificationB.timestamp ? preferA : preferB\n  } else {\n    // Here, one notification is read, the other is unread.\n    const read = notificationA.read ? notificationA : notificationB\n    const unread = !notificationA.read ? notificationA : notificationB\n\n    // Prefer the unread one by default.\n    let preferred = unread\n\n    // However, under certain conditions we might want to keep the already read one instead.\n    // Note: use a condition array so that it is easy to add/remove conditions later.\n    const conditions = [\n      (read, unread) => age(read) < ONE_DAY && age(unread) > FIFTEEN_DAYS,\n      (read, unread) => age(read) < TWO_DAYS && age(unread) > THREE_WEEKS\n    ]\n    if (conditions.some(condition => condition(read, unread))) {\n      preferred = read\n    }\n    return preferred === notificationA ? preferA : preferB\n  }\n}\n\nexport function isExpired (notification              )          {\n  return age(notification) > maxAge(notification)\n}\n\nexport function isNew (notification              )          {\n  return age(notification) < NEW_STATUS_DURATION\n}\n\nexport function isOlder (notification              )          {\n  return !isNew(notification)\n}\n\nexport function maxAge (notification              )         {\n  return notification.read ? MAX_AGE_READ : MAX_AGE_UNREAD\n}\n\nexport function makeNotificationHash (notification        )         {\n  return blake32Hash(JSON.stringify(hashableRepresentation(notification)))\n}\n\nexport function extractProposalData (proposal        , extraFields         = {})         {\n  return {\n    proposalType: proposal.data.proposalType,\n    proposalData: proposal.data.proposalData,\n    expires_date_ms: proposal.data.expires_date_ms,\n    createdDate: proposal.meta.createdDate,\n    creatorID: proposal.creatorID,\n    ...extraFields\n  }\n}\n", "import { PROPOSAL_GENERIC, STATUS_OPEN } from '@model/contracts/shared/constants.js'\nimport { DAYS_MILLIS, comparePeriodStamps, dateToPeriodStamp } from '@model/contracts/shared/time.js'\nimport sbp from '@sbp/sbp'\nimport { PERIODIC_NOTIFICATION_TYPE } from './periodicNotifications.js'\nimport { extractProposalData } from './utils.js'\n\n// util functions\nconst myNotificationHas = (checkFunc, groupId = '') => {\n  const myNotifications = groupId\n    ? sbp('state/vuex/getters').notificationsByGroup(groupId)\n    : sbp('state/vuex/getters').currentNotifications\n\n  return myNotifications.some(item => checkFunc(item))\n}\n\nconst periodicNotificationEntries   \n               \n                     \n                     \n                                                                                \n                                                                                    \n                                                                                      \n   \n    = [\n  {\n    type: PERIODIC_NOTIFICATION_TYPE.MIN15,\n    notificationData: {\n      stateKey: 'nearDistributionEnd',\n      emitCondition ({ rootState, rootGetters }) {\n        const groupIds = rootGetters.ourGroups\n\n        this.nearDistributionEnd = groupIds.map((gId) => {\n          const currentPeriod = rootGetters.groupSettingsForGroup(rootState[gId]).distributionDate\n          if (!currentPeriod) { return null }\n\n          const nextPeriod = rootGetters.periodAfterPeriodForGroup(rootState[gId], currentPeriod)\n          const now = dateToPeriodStamp(new Date())\n          const comparison = comparePeriodStamps(nextPeriod, now)\n\n          return (\n            rootGetters.ourGroupProfileForGroup(rootState[gId])?.incomeDetailsType === 'pledgeAmount' &&\n              (comparison > 0 && comparison < DAYS_MILLIS * 7) &&\n              (rootGetters.ourPaymentsForGroup(rootState[gId])?.todo.length > 0) &&\n              !myNotificationHas(item => item.type === 'NEAR_DISTRIBUTION_END' && item.data.period === currentPeriod, gId)\n          )\n            ? [gId, currentPeriod]\n            : null\n        }).filter(Boolean)\n\n        return (this.nearDistributionEnd.length > 0)\n      },\n      emit () {\n        this.nearDistributionEnd.forEach(([groupID, period]) => {\n          sbp('gi.notifications/emit', 'NEAR_DISTRIBUTION_END', {\n            groupID,\n            period\n          })\n        })\n      },\n      shouldClearStateKey ({ rootGetters }) {\n        const groupIds = rootGetters.ourGroups\n\n        const groupedNotifications = rootGetters.notifications.filter(item => item.type === 'NEAR_DISTRIBUTION_END').reduce((acc, item) => {\n          if (!item.groupID) return acc\n          if (!acc[item.groupID]) acc[item.groupID] = []\n          acc[item.groupID].push(item.data.period)\n\n          return acc\n        }, Object.create(null))\n\n        return groupIds.every((groupId) => {\n          const currentPeriod = rootGetters.groupSettingsForGroup(groupId).distributionDate\n          return !!groupedNotifications[groupId]?.every(period => period !== currentPeriod)\n        })\n      }\n    }\n  },\n  {\n    type: PERIODIC_NOTIFICATION_TYPE.MIN5,\n    notificationData: {\n      stateKey: 'nextDistributionPeriod',\n      emitCondition ({ rootState, rootGetters }) {\n        const groupIds = rootGetters.ourGroups\n\n        this.nextDistributionPeriod = groupIds.map((gId) => {\n          const profile = rootGetters.ourGroupProfileForGroup(rootState[gId])\n          if (!profile?.incomeDetailsType) {\n            // if income-details are not set yet, ignore.\n            return null\n          }\n          const currentPeriod = rootGetters.groupSettingsForGroup(rootState[gId]).distributionDate\n          if (!currentPeriod) { return null }\n\n          return (\n            comparePeriodStamps(dateToPeriodStamp(new Date()), currentPeriod) > 0 &&\n              !myNotificationHas(item => item.type === 'NEW_DISTRIBUTION_PERIOD' && item.data.period === currentPeriod, gId)\n          )\n            ? [gId, currentPeriod, profile.incomeDetailsType]\n            : null\n        }).filter(Boolean)\n\n        return (this.nextDistributionPeriod.length > 0)\n      },\n      emit ({ rootGetters }) {\n        const creatorID = rootGetters.ourIdentityContractId\n        this.nextDistributionPeriod.forEach(([groupID, period, incomeDetailsType]) => {\n          sbp('gi.notifications/emit', 'NEW_DISTRIBUTION_PERIOD', {\n            groupID,\n            period,\n            creatorID,\n            memberType: incomeDetailsType === 'pledgeAmount' ? 'pledger' : 'receiver'\n          })\n        })\n      },\n      shouldClearStateKey ({ rootState, rootGetters }) {\n        const groupIds = rootGetters.ourGroups\n\n        return groupIds.every((groupId) => {\n          return comparePeriodStamps(dateToPeriodStamp(new Date()), rootGetters.groupSettingsForGroup(rootState[groupId]).distributionDate) > 0\n        })\n      }\n    }\n  },\n  {\n    type: PERIODIC_NOTIFICATION_TYPE.MIN5,\n    notificationData: {\n      stateKey: 'expiringOrExpiredProposals',\n      emitCondition ({ rootGetters }) {\n        this.expiringOrExpiredProposalsByGroup = rootGetters.groupsByName.map(group => {\n          const { contractID } = group\n          const expiredProposalIds = []\n          const expiringProposals = []\n          const groupNotificationItems = []\n          const groupProposals = rootGetters.groupProposals(contractID) || {}\n\n          for (const proposalId in groupProposals) {\n            const proposal = groupProposals[proposalId]\n            if (proposal.status !== STATUS_OPEN) { continue }\n\n            if (proposal.data.expires_date_ms < Date.now()) { // the proposal has already expired\n              expiredProposalIds.push(proposalId)\n            } else if (proposal.data.expires_date_ms < (Date.now() + DAYS_MILLIS)) { // the proposal is going to expire in next 24 hrs\n              if (!proposal.notifiedBeforeExpire) { // there is no group-chat notification sent for this proposal\n                expiringProposals.push(extractProposalData(proposal, { proposalId }))\n              }\n\n              if (!Object.keys(proposal.votes).includes(rootGetters.ourIdentityContractId) && // check if the user hasn't voted for this proposal.\n                  !myNotificationHas(item => item.type === 'PROPOSAL_EXPIRING' && item.data.proposalId === proposalId, contractID) // the user hasn't received the pop-up notification.\n              ) {\n                groupNotificationItems.push({\n                  proposalId,\n                  creatorID: proposal.creatorID,\n                  proposalType: proposal.data.proposalType,\n                  proposalData: proposal.data.proposalData\n                })\n              }\n            }\n          }\n\n          return { contractID, expiringProposals, groupNotificationItems, expiredProposalIds }\n        }).filter(entry => entry.expiringProposals.length || entry.groupNotificationItems.length || entry.expiredProposalIds.length)\n\n        return this.expiringOrExpiredProposalsByGroup.length\n      },\n      async emit () {\n        for (const { contractID, expiringProposals, groupNotificationItems, expiredProposalIds } of this.expiringOrExpiredProposalsByGroup) {\n          if (expiringProposals.length) {\n            await sbp('gi.actions/group/notifyExpiringProposals', {\n              contractID,\n              data: { proposals: expiringProposals }\n            })\n          }\n\n          if (groupNotificationItems.length) {\n            groupNotificationItems.forEach(proposal => {\n              sbp('gi.notifications/emit', 'PROPOSAL_EXPIRING', {\n                groupID: contractID,\n                creatorID: proposal.creatorID,\n                proposalId: proposal.proposalId,\n                proposalType: proposal.proposalType,\n                proposalData: proposal.proposalData,\n                title: proposal.proposalType === PROPOSAL_GENERIC ? proposal.proposalData.name : ''\n              })\n            })\n          }\n\n          if (expiredProposalIds.length) {\n            sbp('gi.actions/group/markProposalsExpired', {\n              contractID,\n              data: { proposalIds: expiredProposalIds }\n            })\n              .catch((e) => {\n                console.error('Error calling markProposalsExpired from notifications mixin', e)\n              })\n          }\n        }\n      },\n      shouldClearStateKey: () => true\n    }\n  },\n  {\n    type: PERIODIC_NOTIFICATION_TYPE.MIN5,\n    notificationData: {\n      stateKey: 'lastLoggedIn',\n      emitCondition ({ rootGetters }) {\n        return !!rootGetters.ourIdentityContractId\n      },\n      emit ({ rootState, rootGetters }) {\n        Promise.all(\n          rootGetters.groupsByName.filter(({ active }) => active).map(({ contractID }) => {\n            return sbp('gi.actions/group/kv/updateLastLoggedIn', {\n              contractID,\n              throttle: true\n            })\n          })\n        ).catch((e) => {\n          console.error('Error updating lastLoggedIn', e)\n        })\n      },\n      shouldClearStateKey: () => true\n    }\n  }\n]\n\nexport default periodicNotificationEntries\n", "'use strict'\nimport sbp from '@sbp/sbp'\nimport { throttle } from 'turtledash'\n\n// NOTE: since these functions don't modify contract state, it should\n//       be safe to modify them without worrying about version conflicts.\n// we throttle this because some browsers (Chrome) support change handlers\n// for both 'push' and 'notifications' permissions change events\nconst handler = throttle((status        ) => {\n  // For some reason, Safari seems to always return `'prompt'` with\n  // `Notification.permission` being correct.\n  const granted = status === 'granted' || (status === 'prompt' && Notification.permission === 'granted')\n\n  const { notificationEnabled } = sbp('state/vuex/state').settings\n  console.info(`Browser notifications have been: ${granted ? 'enabled' : 'disabled'}, notificationEnabled=${notificationEnabled}`)\n  // either report the fact that browser notification permissions have been disabled\n  // or report the fact that they've been enabled (when the user wants push notifications)\n  if (!granted || notificationEnabled) {\n    sbp('service-worker/setup-push-subscription').catch(e => {\n      console.error('[handler] Error calling service-worker/setup-push-subscription', e)\n    })\n  }\n}, 250)\n\nconst fallbackChangeListener = () => {\n  if (!Notification.permission) return\n  let oldValue = Notification.permission\n  handler(oldValue)\n  // This fallback runs when `navigator.permissions.query` isn't available\n  // It's meant to run while the tab is open to react to permission changes,\n  // and therefore it's not meant to be cleared\n  setInterval(() => {\n    const newValue = Notification.permission\n    if (oldValue !== newValue) {\n      handler((oldValue = newValue))\n    }\n  }, 1000)\n}\n\nexport const setupNativeNotificationsListeners = () => {\n  // If the required APIs for native notifications aren't available, skip setup\n  if (\n    typeof navigator !== 'object' ||\n    typeof Notification !== 'function' ||\n    typeof PushManager !== 'function' ||\n    typeof ServiceWorker !== 'function' ||\n    typeof navigator.serviceWorker !== 'object'\n  ) {\n    console.warn(\"Notifications aren't available in this browser!\")\n    return\n  }\n  const isWebkit = typeof navigator === 'object' && navigator.vendor === 'Apple Computer, Inc.'\n  if (\n    !isWebkit && // WebKit doesn't work\n    typeof navigator.permissions === 'object' &&\n    // $FlowFixMe[method-unbinding]\n    typeof navigator.permissions.query === 'function'\n  ) {\n    Promise.all([\n      navigator.permissions.query({ name: 'notifications' }),\n      navigator.permissions.query({ name: 'push', userVisibleOnly: true })\n    ]).then(\n      (statuses) => {\n        // they're both the same at the start but FF only pays attention to changes in notifications\n        handler(statuses[0].state)\n        statuses[0].addEventListener('change', () => {\n          handler(statuses[0].state)\n        }, false)\n        statuses[1].addEventListener('change', () => {\n          handler(statuses[1].state)\n        }, false)\n      }\n    ).catch((e) => {\n      console.error('Error querying notifications permission', e)\n      fallbackChangeListener()\n    })\n  } else {\n    fallbackChangeListener()\n  }\n}\n\nexport async function requestNotificationPermission (\n  { enableIfGranted }                               = { enableIfGranted: false }\n)                         {\n  if (typeof Notification !== 'function') {\n    return null\n  }\n  try {\n    const permission = await Notification.requestPermission()\n    if (enableIfGranted && permission === 'granted') {\n      sbp('state/vuex/commit', 'setNotificationEnabled', true)\n    }\n    return permission\n  } catch (e) {\n    console.error('requestNotificationPermission:', e.message)\n    return null\n  }\n}\n\n// eslint-disable-next-line require-await\nexport async function makeNotification ({ title, body, icon, path, groupID, sbpInvocation }   \n                                                                              \n                       \n )                {\n  if (typeof Notification !== 'function') return\n  if (typeof icon === 'object' && icon.manifestCid) {\n    // We only use cached files to render notifications as quickly as possible\n    const cachedArrayBuffer = await sbp('gi.db/filesCache/load', icon.manifestCid).catch((e) => {\n      console.error('[Avatar.vue] Error loading file from cache', e)\n    })\n    if (cachedArrayBuffer) {\n      // We use `data:` URLs because the SW is unable to create `blob:` URLs\n      icon = 'data:;base64,' + encodeURIComponent(Buffer.from(cachedArrayBuffer).toString('base64'))\n    }\n  }\n\n  // If not running on a SW\n  if (typeof WorkerGlobalScope !== 'function') {\n    try {\n      // $FlowFixMe[incompatible-type]\n      if (navigator.vendor === 'Apple Computer, Inc.') {\n        throw new Error('Safari requires a service worker for the notification to be displayed')\n      }\n      const notification = new Notification(title, { body, icon })\n      if (path) {\n        notification.onclick = (event) => {\n          sbp('controller/router').push({ path }).catch(console.warn)\n        }\n      }\n    } catch (e) {\n      return navigator.serviceWorker?.ready.then(registration => {\n        // $FlowFixMe\n        return registration.showNotification(title, { body, icon, data: { groupID, path, sbpInvocation } })\n      }).catch(console.warn)\n    }\n  } else {\n  // If running in a SW\n    return self.clients.matchAll({ type: 'window' }).then((clientList) => {\n      // If no window is focused, display a native notification\n      if (clientList.some(client => client.focused)) {\n        return\n      }\n      return self.registration.showNotification(title,\n        { body, icon, data: { groupID, path, sbpInvocation } }\n      ).catch(console.warn)\n    })\n  }\n}\n", "'use strict'\n\n// NOTE: do not place contract-related events in here!\n//       place those in @model/contracts/shared/constants.js instead\n//\n//       This file is primarily for frontend UI related events.\n\nexport const LOGIN = 'login'\nexport const LOGIN_ERROR = 'login-error'\nexport const LOGIN_COMPLETE = 'login-complete'\nexport const LOGGING_OUT = 'logging-out'\nexport const LOGOUT = 'logout'\n\nexport const ONLINE = 'online'\nexport const OFFLINE = 'offline'\nexport const RECONNECTING = 'reconnecting'\nexport const RECONNECTION_FAILED = 'reconnection-failed'\n\nexport const KV_EVENT = 'kv-event'\n\nexport const ACCEPTED_GROUP = 'accepted-group'\nexport const SWITCH_GROUP = 'switch-group'\nexport const JOINED_GROUP = 'joined-group'\nexport const LEFT_GROUP = 'left-group'\nexport const ERROR_GROUP_GENERAL_CHATROOM_DOES_NOT_EXIST = 'error-group-non-existent-#general'\n\nexport const JOINED_CHATROOM = 'joined-chatroom'\nexport const LEFT_CHATROOM = 'left-chatroom'\nexport const DELETED_CHATROOM = 'deleted-chatroom'\nexport const DELETE_ATTACHMENT = 'delete-attachment'\nexport const DELETE_ATTACHMENT_FEEDBACK = 'delete-attachment-complete'\nexport const ERROR_JOINING_CHATROOM = 'error-joining-chatroom'\n\nexport const REPLACED_STATE = 'replaced-state'\n\nexport const OPEN_MODAL = 'open-modal'\nexport const CLOSE_MODAL = 'close-modal'\nexport const REPLACE_MODAL = 'replace-modal'\nexport const SET_MODAL_QUERIES = 'set-modal-queries'\nexport const MODAL_RESPONSE = 'modal-response'\n\nexport const OPEN_EMOTICON = 'open-emoticon'\nexport const CLOSE_EMOTICON = 'close-emoticon'\nexport const SELECT_EMOTICON = 'select-emoticon'\n\nexport const OPEN_TOUCH_LINK_HELPER = 'open-touch-link-helper'\n\nexport const CAPTURED_LOGS = 'captured-logs'\nexport const SET_APP_LOGS_FILTER = 'set-app-logs-filter'\n\nexport const INCOME_DETAILS_UPDATE = 'income-details-update'\n\nexport const PAYMENTS_RECORDED = 'payments-recorded'\n\nexport const AVATAR_EDITED = 'avatar-edited'\n\nexport const THEME_CHANGE = 'theme-change'\n\nexport const CHATROOM_EVENTS = 'chatroom-events'\nexport const CHATROOM_USER_TYPING = 'chatroom-user-typing'\nexport const CHATROOM_USER_STOP_TYPING = 'chatroom-user-stop-typing'\n\nexport const NAMESPACE_REGISTRATION = 'namespace-registration'\n\nexport const KV_QUEUE = 'kv-queue'\n\nexport const PWA_INSTALLABLE = 'pwa-installable'\n\nexport const CHELONIA_STATE_MODIFIED = 'chelonia-state-modified'\n\nexport const NOTIFICATION_EMITTED = 'notification-emitted'\nexport const NOTIFICATION_REMOVED = 'notification-removed'\nexport const NOTIFICATION_STATUS_LOADED = 'notification-status-loaded'\n\nexport const NEW_CHATROOM_UNREAD_POSITION = 'new-chatroom-unread-position'\nexport const NEW_LAST_LOGGED_IN = 'new-last-logged-in'\nexport const NEW_UNREAD_MESSAGES = 'new-unread-messages'\nexport const NEW_PREFERENCES = 'new-preferences'\n\nexport const NEW_CHATROOM_NOTIFICATION_SETTINGS = 'new-chatroom-notification-settings'\n\nexport const CONTRACT_SYNCS_RESET = 'new-current-syncs'\n\nexport const SERIOUS_ERROR = 'serious-error'\n", "'use strict'\n\n// any constants that are dedicated to the UI of the app should be kept in this file.\n// (context: https://github.com/okTurtles/group-income/pull/1694#discussion_r1304706653)\n\nexport const CHAT_ATTACHMENT_SUPPORTED_EXTENSIONS = [\n  // reference: https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types\n  'avif', 'bmp', 'gif', 'ico', 'jpeg', 'jpg', 'png', 'svg', 'tif', 'tiff', 'webp', // image\n  'aac', 'cda', 'mid', 'midi', 'mp3', 'oga', 'opus', 'wav', 'weba', // audio\n  'avi', 'mov', 'mp4', 'mpeg', 'ogv', 'ogx', 'ts', 'webm', '3gp', '3g2', // video\n  'arc', 'bz', 'bz2', 'epub', 'gz', 'jar', 'rar', 'tar', 'zip', '7z', // archive\n  'csh', 'css', 'csv', 'doc', 'docx', 'htm', 'html', 'ics', 'js', 'json', 'jsonld', 'md', 'mjs', 'vue', 'ts', 'scss',\n  'odp', 'ods', 'odt', 'pdf', 'php', 'ppt', 'pptx', 'sh', 'txt', 'xhtml', 'xls', 'xlsx', 'xml', // common text/document\n  'eot', 'otf', 'rtf', 'ttf', 'woff', 'woff2', // font\n  'abw', 'azw', 'bin', 'csh', 'db', 'mpkg', 'vsd', 'xul' // miscellaneous\n]\n\n// NOTE: Below value was obtained from the '413 Payload Too Large' server error\n//       meaning if this limit is updated on the server-side, an update is required here too.\n// TODO: fetch this value from a server API\nexport const KILOBYTE = 1 << 10\nexport const MEGABYTE = 1 << 20\nexport const CHAT_ATTACHMENT_SIZE_LIMIT = 30 * MEGABYTE // in byte.\nexport const IMAGE_ATTACHMENT_MAX_SIZE = 400 * KILOBYTE // 400KB\nexport const CHAT_LONG_MESSAGE_HEIGHT_THRESHOLD_DESKTOP = 500 * 1.25 // in px\nexport const CHAT_LONG_MESSAGE_HEIGHT_THRESHOLD_MOBILE = 500 * 1.5 // The value of mobile is more tolerant considering smaller screen size.\n\nexport const TextObjectType = {\n  Text: 'TEXT',\n  InAppLink: 'IN_APP_LINK',\n  MemberMention: 'MEMBER_MENTION',\n  ChannelMention: 'CHANNEL_MENTION'\n}\n\nexport const KV_KEYS = {\n  UNREAD_MESSAGES: 'unreadMessages', // identity contract\n  LAST_LOGGED_IN: 'lastLoggedIn', // group contract\n  PREFERENCES: 'preferences', // identity contract\n  NOTIFICATIONS: 'notifications' // identity contract\n}\n\nexport const MAX_LOG_ENTRIES = 2000\n// The throttle window for updating lastLoggedIn\nexport const LAST_LOGGED_IN_THROTTLE_WINDOW = 30 * 60E3 // 30 minutes\n\nexport const DEVICE_SETTINGS = {\n  DISABLE_NOTIFICATIONS: 'disableNotifications'\n}\n", "'use strict'\n\n// A list with fixed capacity and constant-time `add()`.\nexport default class CircularList {\n  #buffer          \n  #capacity = 0\n  #defaultValue = ''\n  #isFull = false\n  #offset = 0\n\n  constructor (capacity        , defaultValue      = '') {\n    this.#buffer = new Array(capacity).fill(defaultValue)\n    this.#capacity = capacity\n    this.#defaultValue = defaultValue\n  }\n\n  add (entry     ) {\n    const capacity = this.#capacity\n    const offset = this.#offset\n    this.#buffer[offset] = entry\n    if (offset === capacity - 1) {\n      this.#isFull = true\n    }\n    this.#offset = (offset + 1) % capacity\n  }\n\n  addAll (entries          ) {\n    for (const entry of entries) {\n      this.add(entry)\n    }\n  }\n\n  clear () {\n    this.#buffer.fill(this.#defaultValue)\n    this.#isFull = false\n    this.#offset = 0\n  }\n\n  toArray ()           {\n    const buffer = this.#buffer\n    const offset = this.#offset\n    return (\n      this.#isFull\n        ? [...buffer.slice(offset), ...buffer.slice(0, offset)]\n        : buffer.slice(0, offset)\n    )\n  }\n}\n", "import sbp from '@sbp/sbp'\nimport { CAPTURED_LOGS } from '~/frontend/utils/events.js'\nimport CircularList from '~/shared/CircularList.js'\n\nconst loggingLevels = ['debug', 'error', 'info', 'log', 'warn']\nconst originalConsole = console\nconst noop = (...args     ) => undefined\n\nexport async function createLogger (config        , { getItem, removeItem, setItem }                                                                )         {\n  const entries = new CircularList(config.maxEntries)\n  const methods = Object.fromEntries(loggingLevels.map((name) =>\n    [name, (...args) => {\n      originalConsole[name](...args)\n      captureLogEntry(logger, name, config.source, ...args)\n    }]\n  ))\n  const appLogsFilter           = []\n  // Make a copy of 'methods' to prevent reassignment by 'setAppLogsFilter'\n  const consoleProxy = new Proxy({ ...methods }, {\n    get (o, p, r) {\n      return Reflect.has(o, p) ? Reflect.get(o, p, r) : Reflect.get(originalConsole, p, r)\n    },\n    has (o, p) {\n      return Reflect.has(originalConsole, p)\n    }\n  })\n  const logger = {\n    get appLogsFilter () {\n      return [...appLogsFilter]\n    },\n    console: consoleProxy,\n    entries,\n    async clear () {\n      await removeItem('entries')\n      entries.clear()\n    },\n    async save () {\n      try {\n        await setItem('entries', this.entries.toArray())\n      } catch (error) {\n        consoleProxy.error(error)\n      }\n    },\n    setAppLogsFilter (filter               ) {\n      appLogsFilter.splice(0, appLogsFilter.length, ...filter)\n      // NOTE: Find a way to capture logs without messing up with log file location.\n      // console.log() doesnt include stack trace, so when logged, we can't access\n      // where the log came from (file name), which} difficults debugging if needed.\n      for (const level of loggingLevels) {\n        // $FlowFixMe\n        consoleProxy[level] = appLogsFilter.includes(level) ? methods[level] : noop\n      }\n    }\n  }\n\n  // Handle potential data corruption gracefully\n  const previousEntries = await (async () => {\n    try {\n      const stored = await getItem('entries')\n      return stored ? JSON.parse(stored) : []\n    } catch (error) {\n      consoleProxy.error('Failed to parse stored entries:', error)\n      return []\n    }\n  })()\n\n  // If `maxEntries` is changed in a release, this will discard oldest logs as necessary.\n  if (config.maxEntries < previousEntries.length) {\n    previousEntries.splice(0, previousEntries.length - config.maxEntries)\n  }\n  // Load the previous entries to sync the in-memory array with the local storage.\n  if (previousEntries.length) {\n    logger.entries.addAll(previousEntries)\n  }\n\n  return logger\n}\n\nfunction captureLogEntry (logger        , type        , source        , ...args) {\n  const entry = {\n    timestamp: new Date().toISOString(),\n    source,\n    type,\n    // Detect when arg is an Error and capture it properly.\n    // ex: uncaught Vue errors or custom try/catch errors.\n    msg: args.map((arg) => {\n      try {\n        const seen = new WeakSet()\n        return JSON.parse(\n          JSON.stringify(arg, (_, v) => {\n            if (v instanceof Error) {\n              return {\n                name: v.name,\n                message: v.message,\n                stack: v.stack\n              }\n            }\n            // Handle circular references\n            if (typeof v === 'object' && v !== null) {\n              if (seen.has(v)) {\n                return '[Circular Reference]'\n              }\n              seen.add(v)\n            }\n            return v\n          })\n        )\n      } catch (e) {\n        return `[captureLogs failed to stringify argument of type '${typeof arg}'. Err: ${e.message}]`\n      }\n    })\n  }\n  logger.entries.add(entry)\n  // To avoid infinite loop because we log all selector calls, we run sbp calls\n  // here in a roundabout way by getting the function to which they're mapped.\n  // The reason this works is because the entire `sbp` domain is blacklisted\n  // from being logged in main.js.\n  sbp('sbp/selectors/fn', 'okTurtles.events/emit')(CAPTURED_LOGS, entry)\n}\n", "// \n\n'use strict'\n\n// =======================\n// Domain: Data persistence\n// =======================\n\nimport sbp from '@sbp/sbp'\n\nconst _store = new Map()\n\nexport default (sbp('sbp/selectors/register', {\n  'okTurtles.data/get': function (key) {\n    return _store.get(key)\n  },\n  'okTurtles.data/set': function (key, data) {\n    _store.set(key, data)\n    return data\n  },\n  'okTurtles.data/delete': function (key) {\n    return _store.delete(key)\n  },\n  'okTurtles.data/add': function (key, data) {\n    const array = _store.get(key)\n    if (array) {\n      array.push(data)\n    } else {\n      _store.set(key, [data])\n    }\n  },\n  'okTurtles.data/remove': function (key, data) {\n    const array = _store.get(key)\n    if (array) {\n      const aLen = array.length\n      const filtered = array.filter(v => v !== data)\n      _store.set(key, filtered)\n      return aLen - filtered.length\n    }\n  },\n  'okTurtles.data/apply': function (key, fn) {\n    return fn(_store.get(key))\n  }\n}))\n", "// =======================\n// Domain: Event publish/subscribe\n// =======================\nimport sbp from '@sbp/sbp';\nimport '@sbp/okturtles.data';\nconst listenKey = (evt) => `events/${evt}/listeners`;\nexport default sbp('sbp/selectors/register', {\n    'okTurtles.events/_init': function () {\n        this.errorHandler = (event, e) => {\n            console.error(`[okTurtles.events] Error at handler for ${event}`, e);\n        };\n    },\n    'okTurtles.events/on': function (event, handler) {\n        sbp('okTurtles.data/add', listenKey(event), handler);\n        return () => sbp('okTurtles.events/off', event, handler);\n    },\n    'okTurtles.events/once': function (event, handler) {\n        const cbWithOff = (...args) => {\n            handler(...args);\n            sbp('okTurtles.events/off', event, cbWithOff);\n        };\n        return sbp('okTurtles.events/on', event, cbWithOff);\n    },\n    'okTurtles.events/emit': function (event, ...data) {\n        var _a;\n        for (const listener of sbp('okTurtles.data/get', listenKey(event)) || []) {\n            try {\n                listener(...data);\n            }\n            catch (e) {\n                (_a = this.errorHandler) === null || _a === void 0 ? void 0 : _a.call(this, event, e);\n            }\n        }\n    },\n    // almost identical to Vue.prototype.$off, except we require `event` argument\n    'okTurtles.events/off': function (event, handler) {\n        if (handler) {\n            sbp('okTurtles.data/remove', listenKey(event), handler);\n        }\n        else {\n            sbp('okTurtles.data/delete', listenKey(event));\n        }\n    },\n    'okTurtles.events/setErrorHandler': function (errorHandler) {\n        this.errorHandler = errorHandler;\n    }\n});\n", "import sbp from '@sbp/sbp'\nimport '@sbp/okturtles.events'\nimport { CAPTURED_LOGS } from '~/frontend/utils/events.js'\n\nexport default (console        )           => {\n  // only log to server if we're in development mode and connected over the\n  // tunnel (which creates URLs that begin with 'https://gi' per Gruntfile.js)\n  if (process.env.NODE_ENV !== 'development' || !self.location.href.startsWith('https://gi')) return\n\n  sbp('okTurtles.events/on', CAPTURED_LOGS, ({ level, msg: stringifyMe }) => {\n    if (level === 'debug') return // comment out to send much more log info\n    const value = JSON.stringify(stringifyMe)\n    // To avoid infinite loop because we log all selector calls, we run sbp calls\n    // here in a roundabout way by getting the function to which they're mapped.\n    // The reason this works is because the entire `sbp` domain is blacklisted\n    // from being logged.\n    const apiUrl = sbp('sbp/selectors/fn', 'okTurtles.data/get')('API_URL')\n    fetch(`${apiUrl}/log`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ level, value })\n    }).catch(e => {\n      console.error(`[captureLogs] '${e.message}' attempting to log [${level}] to server:`, value)\n    })\n  })\n}\n", "import sbp from '@sbp/sbp'\nimport { debounce } from 'turtledash'\nimport { CAPTURED_LOGS, SET_APP_LOGS_FILTER } from '~/frontend/utils/events.js'\nimport { MAX_LOG_ENTRIES } from '~/frontend/utils/constants.js'\nimport { createLogger } from './logger.js'\nimport logServer from './logServer.js'\n\n/*\n  - giConsole/[username]/entries - the stored log entries.\n  - giConsole/[username]/config - the logger config used.\n*/\n\nconst config = {\n  maxEntries: MAX_LOG_ENTRIES,\n  source: 'sw'\n}\nconst originalConsole = self.console\n\n// These are initialized in `captureLogsStart()`.\nlet logger         = null\nlet identityContractID         = ''\n\n// A default storage backend using `IndexedDB`.\nconst getItem = (key        )                   => sbp('gi.db/logs/load', `giConsole/${identityContractID}/${key}`)\nconst removeItem = (key        )                => sbp('gi.db/logs/delete', `giConsole/${identityContractID}/${key}`)\nconst setItem = (key        , value     )                => {\n  return sbp('gi.db/logs/save', `giConsole/${identityContractID}/${key}`, typeof value === 'string' ? value : JSON.stringify(value))\n}\n\nasync function captureLogsStart (userLogged        ) {\n  identityContractID = userLogged\n\n  logger = await createLogger(config, { getItem, removeItem, setItem })\n\n  // Save the new config.\n  await setItem('config', config)\n\n  // TODO: Get this dynamically\n  logger.setAppLogsFilter((((process.env.NODE_ENV === 'development' || new URLSearchParams(location.search).get('debug'))\n    ? ['error', 'warn', 'info', 'debug', 'log']\n    : ['error', 'warn', 'info'])          ))\n\n  // Subscribe to `swLogsFilter` changes.\n  sbp('okTurtles.events/on', SET_APP_LOGS_FILTER, logger.setAppLogsFilter)\n\n  // Overwrite the original console.\n  self.console = logger.console\n\n  originalConsole.log('Starting to capture logs of type:', logger.swLogsFilter)\n}\n\nasync function captureLogsPause ({ wipeOut }                      )                {\n  if (wipeOut) { await clearLogs() }\n  sbp('okTurtles.events/off', SET_APP_LOGS_FILTER)\n  console.log('captureLogs paused')\n  // Restore original console behavior.\n  self.console = originalConsole\n}\n\nasync function clearLogs () {\n  await logger?.clear()\n}\n\n// In the SW, there's no event to detect when the SW is about to terminate. As\n// a result, we must save logs on every saved entry. However, this wouldn't be\n// very performant, so we debounce the save instead.\nsbp('okTurtles.events/on', CAPTURED_LOGS, debounce(() => {\n  logger?.save().catch(e => {\n    console.error('Error saving logs during CAPTURED_LOGS event handler', e)\n  })\n}, 1000))\n\n// Enable logging to the server\nlogServer(originalConsole)\n\nexport default (sbp('sbp/selectors/register', {\n  'swLogs/get' () { return logger?.entries.toArray() ?? [] },\n  async 'swLogs/save' () { await logger?.save() },\n  'swLogs/pauseCapture': captureLogsPause,\n  'swLogs/startCapture': captureLogsStart,\n  async 'swLogs/clearLogs' (userID) {\n    const savedID = identityContractID\n    identityContractID = userID\n    try { await clearLogs() } catch {}\n    identityContractID = savedID\n  }\n})          )\n", "// =======================\n// Domain: Serial Event Queue\n//\n// Use this to ensure asynchronous SBP invocations get invoked serially,\n// one after another, waiting for the previous invocation to finish completely.\n// =======================\nimport sbp from '@sbp/sbp';\nconst isEventQueueSbpEvent = (e) => {\n    return Object.prototype.hasOwnProperty.call(e, 'sbpInvocation');\n};\nexport default sbp('sbp/selectors/register', {\n    'okTurtles.eventQueue/_init': function () {\n        this.eventQueues = Object.create(null);\n    },\n    'okTurtles.eventQueue/isWaiting': function (name) {\n        var _a;\n        return !!((_a = this.eventQueues[name]) === null || _a === void 0 ? void 0 : _a.length);\n    },\n    'okTurtles.eventQueue/queuedInvocations': function (name) {\n        var _a, _b;\n        if (name == null) {\n            return Object.fromEntries(Object.entries(this.eventQueues).map(([name, events]) => [name, events.map((event) => {\n                    if (isEventQueueSbpEvent(event)) {\n                        return event.sbpInvocation;\n                    }\n                    else {\n                        return event.fn;\n                    }\n                })]));\n        }\n        return (_b = (_a = this.eventQueues[name]) === null || _a === void 0 ? void 0 : _a.map((event) => {\n            if (isEventQueueSbpEvent(event)) {\n                return event.sbpInvocation;\n            }\n            else {\n                return event.fn;\n            }\n        })) !== null && _b !== void 0 ? _b : [];\n    },\n    'okTurtles.eventQueue/queueEvent': async function (name, invocation) {\n        if (!Object.prototype.hasOwnProperty.call(this.eventQueues, name)) {\n            this.eventQueues[name] = [];\n        }\n        const events = this.eventQueues[name];\n        let accept;\n        const promise = new Promise((resolve) => { accept = resolve; });\n        const thisEvent = typeof invocation === 'function'\n            ? {\n                fn: invocation,\n                promise\n            }\n            : {\n                sbpInvocation: invocation,\n                promise\n            };\n        events.push(thisEvent);\n        while (events.length > 0) {\n            const event = events[0];\n            if (event === thisEvent) {\n                try {\n                    if (typeof invocation === 'function') {\n                        return await invocation();\n                    }\n                    else {\n                        return await sbp(...invocation);\n                    }\n                }\n                finally {\n                    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                    // @ts-ignore\n                    accept();\n                    events.shift();\n                }\n            }\n            else {\n                // wait for invocation to finish\n                await event.promise;\n            }\n        }\n    }\n});\n", "import { base58btc, blake2b256 } from '@chelonia/multiformats';\nimport scrypt from 'scrypt-async';\nimport nacl from 'tweetnacl';\nconst strToBuf = (str) => {\n    const textEncoder = new TextEncoder();\n    return textEncoder.encode(str);\n};\nconst blake32Hash = (data) => {\n    const uint8array = typeof data === 'string' ? strToBuf(data) : data;\n    const digest = blake2b256.digest(uint8array);\n    // While `digest.digest` is only 32 bytes long in this case,\n    // `digest.bytes` is 36 bytes because it includes a multiformat prefix.\n    return base58btc.encode(digest.bytes);\n};\nconst b64ToBuf = (data) => new Uint8Array(atob(data)\n    .split('')\n    .map((b) => b.charCodeAt(0)));\n// ENULL and SNULL are 'null' algorithms for asymmetric encryption and\n// signatures, respectively. They are useful for development and testing because\n// their values can easily be inspected by hand but they offer ABSOLUTELY NO\n// PROTECTION and should *NEVER* be used in production.\nexport const ENULL = 'eNULL';\nexport const SNULL = 'sNULL';\nexport const EDWARDS25519SHA512BATCH = 'edwards25519sha512batch';\nexport const CURVE25519XSALSA20POLY1305 = 'curve25519xsalsa20poly1305';\nexport const XSALSA20POLY1305 = 'xsalsa20poly1305';\n// 32 bytes of keying material, used for external keys (such as files)\nexport const EXTERNALKM32 = 'externalkm32';\nif (process.env.NODE_ENV === 'production' && process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true') {\n    throw new Error('ENABLE_UNSAFE_NULL_CRYPTO cannot be enabled in production mode');\n}\nconst bytesOrObjectToB64 = (ary) => {\n    if (!(ary instanceof Uint8Array)) {\n        throw TypeError('Unsupported type');\n    }\n    return btoa(Array.from(ary)\n        .map((c) => String.fromCharCode(c))\n        .join(''));\n};\nexport const keygen = (type) => {\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && (type === ENULL || type === SNULL)) {\n        const res = {\n            type,\n            publicKey: bytesOrObjectToB64(nacl.randomBytes(18))\n        };\n        Object.defineProperty(res, 'secretKey', { value: res.publicKey });\n        return res;\n    }\n    if (type === EDWARDS25519SHA512BATCH) {\n        const key = nacl.sign.keyPair();\n        const res = {\n            type,\n            publicKey: key.publicKey\n        };\n        // prevents 'secretKey' from being enumerated or appearing in JSON\n        Object.defineProperty(res, 'secretKey', { value: key.secretKey });\n        return res;\n    }\n    else if (type === CURVE25519XSALSA20POLY1305) {\n        const key = nacl.box.keyPair();\n        const res = {\n            type,\n            publicKey: key.publicKey\n        };\n        Object.defineProperty(res, 'secretKey', { value: key.secretKey });\n        return res;\n    }\n    else if (type === XSALSA20POLY1305) {\n        const res = {\n            type\n        };\n        Object.defineProperty(res, 'secretKey', { value: nacl.randomBytes(nacl.secretbox.keyLength) });\n        return res;\n    }\n    else if (type === EXTERNALKM32) {\n        const res = {\n            type\n        };\n        Object.defineProperty(res, 'secretKey', { value: nacl.randomBytes(32) });\n        return res;\n    }\n    throw new Error('Unsupported key type');\n};\nexport const generateSalt = () => {\n    return bytesOrObjectToB64(nacl.randomBytes(18));\n};\nexport const deriveKeyFromPassword = (type, password, salt) => {\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && (type === ENULL || type === SNULL)) {\n        const v = blake32Hash(blake32Hash(salt) + blake32Hash(password));\n        return Promise.resolve({\n            type,\n            secretKey: v,\n            publicKey: v\n        });\n    }\n    if (![EDWARDS25519SHA512BATCH, CURVE25519XSALSA20POLY1305, XSALSA20POLY1305].includes(type)) {\n        return Promise.reject(new Error('Unsupported type'));\n    }\n    return new Promise((resolve) => {\n        scrypt(password, salt, {\n            N: 16384,\n            r: 8,\n            p: 1,\n            dkLen: type === EDWARDS25519SHA512BATCH ? nacl.sign.seedLength : type === CURVE25519XSALSA20POLY1305 ? nacl.box.secretKeyLength : type === XSALSA20POLY1305 ? nacl.secretbox.keyLength : 0,\n            encoding: 'binary'\n        }, (derivedKey) => {\n            const buffer = new Uint8Array(derivedKey);\n            if (type === EDWARDS25519SHA512BATCH) {\n                const key = nacl.sign.keyPair.fromSeed(buffer);\n                resolve({\n                    type,\n                    secretKey: key.secretKey,\n                    publicKey: key.publicKey\n                });\n            }\n            else if (type === CURVE25519XSALSA20POLY1305) {\n                const key = nacl.box.keyPair.fromSecretKey(buffer);\n                resolve({\n                    type,\n                    secretKey: key.secretKey,\n                    publicKey: key.publicKey\n                });\n            }\n            else if (type === XSALSA20POLY1305) {\n                resolve({\n                    type,\n                    secretKey: buffer\n                });\n            }\n        });\n    });\n};\n// Format: [type, publicKey, secretKey]: [string, string, null] | [string, null, string]\n// Using an array instead of an object ensures that the object is serialized in order since the JSON specification does not define the order for object keys\n// and therefore different it could vary across implementations\nexport const serializeKey = (key, saveSecretKey) => {\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && (key.type === ENULL || key.type === SNULL)) {\n        return JSON.stringify([\n            key.type,\n            saveSecretKey ? null : key.publicKey,\n            saveSecretKey ? key.secretKey : null\n        ], undefined, 0);\n    }\n    if (key.type === EDWARDS25519SHA512BATCH || key.type === CURVE25519XSALSA20POLY1305) {\n        if (!saveSecretKey) {\n            if (!key.publicKey) {\n                throw new Error('Unsupported operation: no public key to export');\n            }\n            return JSON.stringify([\n                key.type,\n                bytesOrObjectToB64(key.publicKey),\n                null\n            ], undefined, 0);\n        }\n        if (!key.secretKey) {\n            throw new Error('Unsupported operation: no secret key to export');\n        }\n        return JSON.stringify([\n            key.type,\n            null,\n            bytesOrObjectToB64(key.secretKey)\n        ], undefined, 0);\n    }\n    else if (key.type === XSALSA20POLY1305) {\n        if (!saveSecretKey) {\n            throw new Error('Unsupported operation: no public key to export');\n        }\n        if (!key.secretKey) {\n            throw new Error('Unsupported operation: no secret key to export');\n        }\n        return JSON.stringify([\n            key.type,\n            null,\n            bytesOrObjectToB64(key.secretKey)\n        ], undefined, 0);\n    }\n    throw new Error('Unsupported key type');\n};\nexport const deserializeKey = (data) => {\n    const keyData = JSON.parse(data);\n    if (!keyData || keyData.length !== 3) {\n        throw new Error('Invalid key object');\n    }\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && (keyData[0] === ENULL || keyData[0] === SNULL)) {\n        const res = {\n            type: keyData[0]\n        };\n        if (keyData[2]) {\n            Object.defineProperty(res, 'secretKey', { value: keyData[2] });\n            res.publicKey = keyData[2];\n        }\n        else {\n            res.publicKey = keyData[1];\n        }\n        return res;\n    }\n    if (keyData[0] === EDWARDS25519SHA512BATCH) {\n        if (keyData[2]) {\n            const key = nacl.sign.keyPair.fromSecretKey(b64ToBuf(keyData[2]));\n            const res = {\n                type: keyData[0],\n                publicKey: key.publicKey\n            };\n            Object.defineProperty(res, 'secretKey', { value: key.secretKey });\n            return res;\n        }\n        else if (keyData[1]) {\n            return {\n                type: keyData[0],\n                publicKey: new Uint8Array(b64ToBuf(keyData[1]))\n            };\n        }\n        throw new Error('Missing secret or public key');\n    }\n    else if (keyData[0] === CURVE25519XSALSA20POLY1305) {\n        if (keyData[2]) {\n            const key = nacl.box.keyPair.fromSecretKey(b64ToBuf(keyData[2]));\n            const res = {\n                type: keyData[0],\n                publicKey: key.publicKey\n            };\n            Object.defineProperty(res, 'secretKey', { value: key.secretKey });\n            return res;\n        }\n        else if (keyData[1]) {\n            return {\n                type: keyData[0],\n                publicKey: new Uint8Array(b64ToBuf(keyData[1]))\n            };\n        }\n        throw new Error('Missing secret or public key');\n    }\n    else if (keyData[0] === XSALSA20POLY1305) {\n        if (!keyData[2]) {\n            throw new Error('Secret key missing');\n        }\n        const res = {\n            type: keyData[0]\n        };\n        Object.defineProperty(res, 'secretKey', { value: new Uint8Array(b64ToBuf(keyData[2])) });\n        return res;\n    }\n    throw new Error('Unsupported key type');\n};\nexport const keygenOfSameType = (inKey) => {\n    const key = typeof inKey === 'string' ? deserializeKey(inKey) : inKey;\n    return keygen(key.type);\n};\nexport const keyId = (inKey) => {\n    const key = typeof inKey === 'string' ? deserializeKey(inKey) : inKey;\n    const serializedKey = serializeKey(key, !key.publicKey);\n    return blake32Hash(serializedKey);\n};\nexport const sign = (inKey, data) => {\n    const key = typeof inKey === 'string' ? deserializeKey(inKey) : inKey;\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && key.type === SNULL) {\n        if (!key.secretKey) {\n            throw new Error('Secret key missing');\n        }\n        return key.secretKey + ';' + blake32Hash(data);\n    }\n    if (key.type !== EDWARDS25519SHA512BATCH) {\n        throw new Error('Unsupported algorithm');\n    }\n    if (!key.secretKey) {\n        throw new Error('Secret key missing');\n    }\n    const messageUint8 = strToBuf(data);\n    const signature = nacl.sign.detached(messageUint8, key.secretKey);\n    const base64Signature = bytesOrObjectToB64(signature);\n    return base64Signature;\n};\nexport const verifySignature = (inKey, data, signature) => {\n    const key = typeof inKey === 'string' ? deserializeKey(inKey) : inKey;\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && key.type === SNULL) {\n        if (!key.publicKey) {\n            throw new Error('Public key missing');\n        }\n        if ((key.publicKey + ';' + blake32Hash(data)) !== signature) {\n            throw new Error('Invalid signature');\n        }\n        return;\n    }\n    if (key.type !== EDWARDS25519SHA512BATCH) {\n        throw new Error('Unsupported algorithm');\n    }\n    if (!key.publicKey) {\n        throw new Error('Public key missing');\n    }\n    const decodedSignature = b64ToBuf(signature);\n    const messageUint8 = strToBuf(data);\n    const result = nacl.sign.detached.verify(messageUint8, decodedSignature, key.publicKey);\n    if (!result) {\n        throw new Error('Invalid signature');\n    }\n};\n/**\n * @param inKey - Encryption key to use\n * @param data - Data to encrypt\n * @param ad - Additional data (the AD in AEAD), used for validation\n */\nexport const encrypt = (inKey, data, ad) => {\n    const key = typeof inKey === 'string' ? deserializeKey(inKey) : inKey;\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && key.type === ENULL) {\n        if (!key.publicKey) {\n            throw new Error('Public key missing');\n        }\n        return `${key.publicKey};${data};${ad !== null && ad !== void 0 ? ad : ''}`;\n    }\n    if (key.type === XSALSA20POLY1305) {\n        if (!key.secretKey) {\n            throw new Error('Secret key missing');\n        }\n        const nonce = nacl.randomBytes(nacl.secretbox.nonceLength);\n        let encryptionNonce;\n        if (ad) {\n            encryptionNonce = new Uint8Array(nonce);\n            const adHash = nacl.hash(strToBuf(ad));\n            const len = Math.min(adHash.length, nonce.length);\n            for (let i = 0; i < len; i++) {\n                encryptionNonce[i] ^= adHash[i];\n            }\n        }\n        else {\n            encryptionNonce = nonce;\n        }\n        const messageUint8 = strToBuf(data);\n        const box = nacl.secretbox(messageUint8, encryptionNonce, key.secretKey);\n        const fullMessage = new Uint8Array(nonce.length + box.length);\n        fullMessage.set(nonce);\n        fullMessage.set(box, nonce.length);\n        const base64FullMessage = bytesOrObjectToB64(fullMessage);\n        return base64FullMessage;\n    }\n    else if (key.type === CURVE25519XSALSA20POLY1305) {\n        if (!key.publicKey) {\n            throw new Error('Public key missing');\n        }\n        const nonce = nacl.randomBytes(nacl.box.nonceLength);\n        let encryptionNonce;\n        if (ad) {\n            encryptionNonce = new Uint8Array(nonce);\n            const adHash = nacl.hash(strToBuf(ad));\n            const len = Math.min(adHash.length, nonce.length);\n            for (let i = 0; i < len; i++) {\n                encryptionNonce[i] ^= adHash[i];\n            }\n        }\n        else {\n            encryptionNonce = nonce;\n        }\n        const messageUint8 = strToBuf(data);\n        const ephemeralKey = nacl.box.keyPair();\n        const box = nacl.box(messageUint8, encryptionNonce, key.publicKey, ephemeralKey.secretKey);\n        // Attempt to discard the data in memory for ephemeralKey.secretKey\n        crypto.getRandomValues(ephemeralKey.secretKey);\n        ephemeralKey.secretKey.fill(0);\n        const fullMessage = new Uint8Array(nacl.box.publicKeyLength + nonce.length + box.length);\n        fullMessage.set(ephemeralKey.publicKey);\n        fullMessage.set(nonce, nacl.box.publicKeyLength);\n        fullMessage.set(box, nacl.box.publicKeyLength + nonce.length);\n        const base64FullMessage = bytesOrObjectToB64(fullMessage);\n        return base64FullMessage;\n    }\n    throw new Error('Unsupported algorithm');\n};\nexport const decrypt = (inKey, data, ad) => {\n    const key = typeof inKey === 'string' ? deserializeKey(inKey) : inKey;\n    if (process.env.ENABLE_UNSAFE_NULL_CRYPTO === 'true' && key.type === ENULL) {\n        if (!key.secretKey) {\n            throw new Error('Secret key missing');\n        }\n        if (!data.startsWith(key.secretKey + ';') || !data.endsWith(';' + (ad !== null && ad !== void 0 ? ad : ''))) {\n            throw new Error('Additional data mismatch');\n        }\n        return data.slice(String(key.secretKey).length + 1, data.length - 1 - (ad !== null && ad !== void 0 ? ad : '').length);\n    }\n    if (key.type === XSALSA20POLY1305) {\n        if (!key.secretKey) {\n            throw new Error('Secret key missing');\n        }\n        const messageWithNonceAsUint8Array = b64ToBuf(data);\n        const nonce = messageWithNonceAsUint8Array.slice(0, nacl.secretbox.nonceLength);\n        const message = messageWithNonceAsUint8Array.slice(nacl.secretbox.nonceLength, messageWithNonceAsUint8Array.length);\n        if (ad) {\n            const adHash = nacl.hash(strToBuf(ad));\n            const len = Math.min(adHash.length, nonce.length);\n            for (let i = 0; i < len; i++) {\n                nonce[i] ^= adHash[i];\n            }\n        }\n        const decrypted = nacl.secretbox.open(message, nonce, key.secretKey);\n        if (!decrypted) {\n            throw new Error('Could not decrypt message');\n        }\n        return Buffer.from(decrypted).toString('utf-8');\n    }\n    else if (key.type === CURVE25519XSALSA20POLY1305) {\n        if (!key.secretKey) {\n            throw new Error('Secret key missing');\n        }\n        const messageWithNonceAsUint8Array = b64ToBuf(data);\n        const ephemeralPublicKey = messageWithNonceAsUint8Array.slice(0, nacl.box.publicKeyLength);\n        const nonce = messageWithNonceAsUint8Array.slice(nacl.box.publicKeyLength, nacl.box.publicKeyLength + nacl.box.nonceLength);\n        const message = messageWithNonceAsUint8Array.slice(nacl.box.publicKeyLength + nacl.box.nonceLength);\n        if (ad) {\n            const adHash = nacl.hash(strToBuf(ad));\n            const len = Math.min(adHash.length, nonce.length);\n            for (let i = 0; i < len; i++) {\n                nonce[i] ^= adHash[i];\n            }\n        }\n        const decrypted = nacl.box.open(message, nonce, ephemeralPublicKey, key.secretKey);\n        if (!decrypted) {\n            throw new Error('Could not decrypt message');\n        }\n        return Buffer.from(decrypted).toString('utf-8');\n    }\n    throw new Error('Unsupported algorithm');\n};\n", "import sbp from '@sbp/sbp'\nimport { has } from 'turtledash'\nimport { blake32Hash } from '~/shared/functions.js'\n                                           \nimport { deserializeKey, keyId, serializeKey, sign, verifySignature } from '@chelonia/crypto'\nimport { ChelErrorSignatureError, ChelErrorSignatureKeyNotFound, ChelErrorSignatureKeyUnauthorized } from './errors.js'\n\nconst rootStateFn = () => sbp('chelonia/rootState')\n\n                                \n                                   \n                       \n                                                                          \n                                                                           \n                   \n                                                                     \n                                                                            \n                                                                             \n                                                  \n                                                                                    \n                                         \n                                               \n                                             \n                                                                              \n                                                \n                                                                             \n               \n                                        \n                                                                               \n          \n                                  \n                                                                             \n                          \n                                   \n \n\n// `proto` & `wrapper` are utilities for `isSignedData`\nconst proto         = Object.create(null, {\n  _isSignedData: {\n    value: true\n  }\n})\n\nconst wrapper =    (o   )    => {\n  return Object.setPrototypeOf(o, proto)\n}\n\n// `isSignedData` will return true for objects created by the various\n// `signed*Data` functions. It's meant to implement functionality equivalent\n// to `o instanceof SignedData`\nexport const isSignedData = (o     )          => {\n  return !!o && !!Object.getPrototypeOf(o)?._isSignedData\n}\n\n// TODO: Check for permissions and allowedActions; this requires passing some\n// additional context\nconst signData = function (stateOrContractID                 , sKeyId        , data     , extraFields        , additionalKeys        , additionalData        ) {\n  const state = typeof stateOrContractID === 'string' ? rootStateFn()[stateOrContractID] : stateOrContractID\n  if (!additionalData) {\n    throw new ChelErrorSignatureError('Signature additional data must be provided')\n  }\n  // Has the key been revoked? If so, attempt to find an authorized key by the same name\n  // $FlowFixMe\n  const designatedKey = state?._vm?.authorizedKeys?.[sKeyId]\n  if (!designatedKey?.purpose.includes(\n    'sig'\n  )) {\n    throw new ChelErrorSignatureKeyNotFound(`Signing key ID ${sKeyId} is missing or is missing signing purpose`)\n  }\n  if (designatedKey._notAfterHeight != null) {\n    const name = (state._vm     ).authorizedKeys[sKeyId].name\n    const newKeyId = (Object.values(state._vm?.authorizedKeys).find((v     ) => v._notAfterHeight == null && v.name === name && v.purpose.includes('sig'))     )?.id\n\n    if (!newKeyId) {\n      throw new ChelErrorSignatureKeyNotFound(`Signing key ID ${sKeyId} has been revoked and no new key exists by the same name (${name})`)\n    }\n\n    sKeyId = newKeyId\n  }\n\n  const key = additionalKeys[sKeyId]\n\n  if (!key) {\n    throw new ChelErrorSignatureKeyNotFound(`Missing signing key ${sKeyId}`)\n  }\n\n  const deserializedKey = typeof key === 'string' ? deserializeKey(key) : key\n\n  const serializedData = JSON.stringify(data, (_, v) => {\n    if (v && has(v, 'serialize') && typeof v.serialize === 'function') {\n      if (v.serialize.length === 1) {\n        return v.serialize(additionalData)\n      } else {\n        return v.serialize()\n      }\n    }\n    return v\n  })\n\n  const payloadToSign = blake32Hash(`${blake32Hash(additionalData)}${blake32Hash(serializedData)}`)\n\n  return {\n    ...extraFields,\n    _signedData: [\n      serializedData,\n      keyId(deserializedKey),\n      sign(deserializedKey, payloadToSign)\n    ]\n  }\n}\n\n// TODO: Check for permissions and allowedActions; this requires passing the\n// entire SPMessage\nconst verifySignatureData = function (state        , height        , data     , additionalData        ) {\n  if (!state) {\n    throw new ChelErrorSignatureError('Missing contract state')\n  }\n\n  if (!isRawSignedData(data)) {\n    throw new ChelErrorSignatureError('Invalid message format')\n  }\n\n  if (!Number.isSafeInteger(height) || height < 0) {\n    throw new ChelErrorSignatureError(`Height ${height} is invalid or out of range`)\n  }\n\n  const [serializedMessage, sKeyId, signature] = data._signedData\n  const designatedKey = state._vm?.authorizedKeys?.[sKeyId]\n\n  if (!designatedKey || (height > designatedKey._notAfterHeight) || (height < designatedKey._notBeforeHeight) || !designatedKey.purpose.includes(\n    'sig'\n  )) {\n    // These errors (ChelErrorSignatureKeyUnauthorized) are serious and\n    // indicate a bug. Make them fatal when running integration tests\n    // (otherwise, they get swallowed and shown as a notification)\n    if (process.env.CI) {\n      console.error(`Key ${sKeyId} is unauthorized or expired for the current contract`, { designatedKey, height, state: JSON.parse(JSON.stringify(sbp('state/vuex/state'))) })\n      // An unhandled promise rejection will cause Cypress to fail\n      Promise.reject(new ChelErrorSignatureKeyUnauthorized(\n        `Key ${sKeyId} is unauthorized or expired for the current contract`\n      ))\n    }\n    throw new ChelErrorSignatureKeyUnauthorized(\n      `Key ${sKeyId} is unauthorized or expired for the current contract`\n    )\n  }\n\n  // TODO\n  const deserializedKey = designatedKey.data\n\n  const payloadToSign = blake32Hash(`${blake32Hash(additionalData)}${blake32Hash(serializedMessage)}`)\n\n  try {\n    verifySignature(deserializedKey, payloadToSign, signature)\n\n    const message = JSON.parse(serializedMessage)\n\n    return [sKeyId, message]\n  } catch (e) {\n    throw new ChelErrorSignatureError(e?.message || e)\n  }\n}\n\nexport const signedOutgoingData =    (stateOrContractID                 , sKeyId        , data   , additionalKeys         )                => {\n  if (!stateOrContractID || data === undefined || !sKeyId) throw new TypeError('Invalid invocation')\n\n  if (!additionalKeys) {\n    additionalKeys = rootStateFn().secretKeys\n  }\n\n  const extraFields = Object.create(null)\n\n  const boundStringValueFn = signData.bind(null, stateOrContractID, sKeyId, data, extraFields, additionalKeys)\n  const serializefn = (additionalData         ) => boundStringValueFn(additionalData || '')\n\n  return wrapper({\n    get signingKeyId () {\n      return sKeyId\n    },\n    get serialize () {\n      return serializefn\n    },\n    get toString () {\n      return (additionalData         ) => JSON.stringify(this.serialize(additionalData))\n    },\n    get valueOf () {\n      return () => data\n    },\n    get recreate () {\n      return (data   ) => signedOutgoingData(stateOrContractID, sKeyId, data, additionalKeys)\n    },\n    get get () {\n      return (k        ) => extraFields[k]\n    },\n    get set () {\n      return (k        , v     ) => {\n        extraFields[k] = v\n      }\n    }\n  })\n}\n\n// Used for OP_CONTRACT as a state does not yet exist\nexport const signedOutgoingDataWithRawKey =    (key     , data   )                => {\n  const sKeyId = keyId(key)\n  const state = {\n    _vm: {\n      authorizedKeys: {\n        [sKeyId]: {\n          purpose: ['sig'],\n          data: serializeKey(key, false),\n          _notBeforeHeight: 0,\n          _notAfterHeight: undefined\n        }\n      }\n    }\n  }\n\n  const extraFields = Object.create(null)\n\n  const boundStringValueFn = signData.bind(null, state, sKeyId, data, extraFields, { [sKeyId]: key })\n  const serializefn = (additionalData         ) => boundStringValueFn(additionalData || '')\n\n  return wrapper({\n    get signingKeyId () {\n      return sKeyId\n    },\n    get serialize () {\n      return serializefn\n    },\n    get toString () {\n      return (additionalData         ) => JSON.stringify(this.serialize(additionalData))\n    },\n    get valueOf () {\n      return () => data\n    },\n    get recreate () {\n      return (data   ) => signedOutgoingDataWithRawKey(key, data)\n    },\n    get get () {\n      return (k        ) => extraFields[k]\n    },\n    get set () {\n      return (k        , v     ) => {\n        extraFields[k] = v\n      }\n    }\n  })\n}\n\nexport const signedIncomingData = (contractID        , state         , data     , height        , additionalData        , mapperFn           )                  => {\n  const stringValueFn = () => data\n  let verifySignedValue\n  const verifySignedValueFn = () => {\n    if (verifySignedValue) {\n      return verifySignedValue[1]\n    }\n    verifySignedValue = verifySignatureData(state || rootStateFn()[contractID], height, data, additionalData)\n    if (mapperFn) verifySignedValue[1] = mapperFn(verifySignedValue[1])\n    return verifySignedValue[1]\n  }\n\n  return wrapper({\n    get signingKeyId () {\n      if (verifySignedValue) return verifySignedValue[0]\n      return signedDataKeyId(data)\n    },\n    get serialize () {\n      return stringValueFn\n    },\n    get context () {\n      return [contractID, data, height, additionalData]\n    },\n    get toString () {\n      return () => JSON.stringify(this.serialize())\n    },\n    get valueOf () {\n      return verifySignedValueFn\n    },\n    get toJSON () {\n      return this.serialize\n    },\n    get get () {\n      return (k        ) => k !== '_signedData' ? data[k] : undefined\n    }\n  })\n}\n\nexport const signedDataKeyId = (data     )         => {\n  if (!isRawSignedData(data)) {\n    throw new ChelErrorSignatureError('Invalid message format')\n  }\n\n  return data._signedData[1]\n}\n\nexport const isRawSignedData = (data     )          => {\n  if (!data || typeof data !== 'object' || !has(data, '_signedData') || !Array.isArray(data._signedData) || data._signedData.length !== 3 || data._signedData.map(v => typeof v).filter(v => v !== 'string').length !== 0) {\n    return false\n  }\n\n  return true\n}\n\n// WARNING: The following function (rawSignedIncomingData) will not check signatures\nexport const rawSignedIncomingData = (data     )                  => {\n  if (!isRawSignedData(data)) {\n    throw new ChelErrorSignatureError('Invalid message format')\n  }\n\n  const stringValueFn = () => data\n  let verifySignedValue\n  const verifySignedValueFn = () => {\n    if (verifySignedValue) {\n      return verifySignedValue[1]\n    }\n    verifySignedValue = [data._signedData[1], JSON.parse(data._signedData[0])]\n    return verifySignedValue[1]\n  }\n\n  return wrapper({\n    get signingKeyId () {\n      if (verifySignedValue) return verifySignedValue[0]\n      return signedDataKeyId(data)\n    },\n    get serialize () {\n      return stringValueFn\n    },\n    get toString () {\n      return () => JSON.stringify(this.serialize())\n    },\n    get valueOf () {\n      return verifySignedValueFn\n    },\n    get toJSON () {\n      return this.serialize\n    },\n    get get () {\n      return (k        ) => k !== '_signedData' ? data[k] : undefined\n    }\n  })\n}\n", "import sbp from '@sbp/sbp'\nimport { has } from 'turtledash'\n                                           \nimport { decrypt, deserializeKey, encrypt, keyId, serializeKey } from '@chelonia/crypto'\nimport { ChelErrorDecryptionError, ChelErrorDecryptionKeyNotFound, ChelErrorUnexpected } from './errors.js'\nimport { isRawSignedData, signedIncomingData } from './signedData.js'\n\nconst rootStateFn = () => sbp('chelonia/rootState')\n\n                                   \n                                      \n                          \n                                                                             \n                                                               \n                   \n                                                                           \n                                                                            \n                                                                             \n                                                     \n                                                           \n                                                                                 \n                                                \n                                                                               \n          \n                                 \n \n\n// `proto` & `wrapper` are utilities for `isEncryptedData`\nconst proto         = Object.create(null, {\n  _isEncryptedData: {\n    value: true\n  }\n})\n\nconst wrapper =    (o   )    => {\n  return Object.setPrototypeOf(o, proto)\n}\n\n// `isEncryptedData` will return true for objects created by the various\n// `encrypt*Data` functions. It's meant to implement functionality equivalent\n// to `o instanceof EncryptedData`\nexport const isEncryptedData = (o     )          => {\n  return !!o && !!Object.getPrototypeOf(o)?._isEncryptedData\n}\n\n// TODO: Check for permissions and allowedActions; this requires passing some\n// additional context\nconst encryptData = function (stateOrContractID                 , eKeyId        , data     , additionalData        ) {\n  const state = typeof stateOrContractID === 'string' ? rootStateFn()[stateOrContractID] : stateOrContractID\n\n  // Has the key been revoked? If so, attempt to find an authorized key by the same name\n  // $FlowFixMe\n  const designatedKey = state?._vm?.authorizedKeys?.[eKeyId]\n  if (!designatedKey?.purpose.includes(\n    'enc'\n  )) {\n    throw new Error(`Encryption key ID ${eKeyId} is missing or is missing encryption purpose`)\n  }\n  if (designatedKey._notAfterHeight != null) {\n    const name = (state._vm     ).authorizedKeys[eKeyId].name\n    const newKeyId = (Object.values(state._vm?.authorizedKeys).find((v     ) => v._notAfterHeight == null && v.name === name && v.purpose.includes('enc'))     )?.id\n\n    if (!newKeyId) {\n      throw new Error(`Encryption key ID ${eKeyId} has been revoked and no new key exists by the same name (${name})`)\n    }\n\n    eKeyId = newKeyId\n  }\n\n  const key = state._vm?.authorizedKeys?.[eKeyId].data\n\n  if (!key) {\n    throw new Error(`Missing encryption key ${eKeyId}`)\n  }\n\n  const deserializedKey = typeof key === 'string' ? deserializeKey(key) : key\n\n  return [\n    keyId(deserializedKey),\n    encrypt(deserializedKey, JSON.stringify(data, (_, v) => {\n      if (v && has(v, 'serialize') && typeof v.serialize === 'function') {\n        if (v.serialize.length === 1) {\n          return v.serialize(additionalData)\n        } else {\n          return v.serialize()\n        }\n      }\n      return v\n    }), additionalData)\n  ]\n}\n\n// TODO: Check for permissions and allowedActions; this requires passing the\n// entire SPMessage\nconst decryptData = function (state        , height        , data     , additionalKeys        , additionalData        , validatorFn                               ) {\n  if (!state) {\n    throw new ChelErrorDecryptionError('Missing contract state')\n  }\n\n  // Compatibility with signedData (composed signed + encrypted data)\n  if (typeof data.valueOf === 'function') data = data.valueOf()\n\n  if (!isRawEncryptedData(data)) {\n    throw new ChelErrorDecryptionError('Invalid message format')\n  }\n\n  const [eKeyId, message] = data\n  const key = additionalKeys[eKeyId]\n\n  if (!key) {\n    // $FlowFixMe[extra-arg]\n    throw new ChelErrorDecryptionKeyNotFound(`Key ${eKeyId} not found`, { cause: eKeyId })\n  }\n\n  // height as NaN is used to allow checking for revokedKeys as well as\n  // authorizedKeys when decrypting data. This is normally inappropriate because\n  // revoked keys should be considered compromised and not used for encrypting\n  // new data\n  // However, OP_KEY_SHARE may include data encrypted with some other contract's\n  // keys when a key rotation is done. This is done, along with OP_ATOMIC and\n  // OP_KEY_UPDATE to rotate keys in a contract while allowing member contracts\n  // to retrieve and use the new key material.\n  // In such scenarios, since the keys really live in that other contract, it is\n  // impossible to know if the keys had been revoked in the 'source' contract\n  // at the time the key rotation was done. This is also different from foreign\n  // keys because these encryption keys are not necessarily authorized in the\n  // contract issuing OP_KEY_SHARE, and what is important is to refer to the\n  // (keys in the) foreign contract explicitly, as an alternative to sending\n  // an OP_KEY_SHARE to that contract.\n  // Using revoked keys represents some security risk since, as mentioned, they\n  // should generlly be considered compromised. However, in the scenario above\n  // we can trust that the party issuing OP_KEY_SHARE is not maliciously using\n  // old (revoked) keys, because there is little to be gained from not doing\n  // this. If that party's intention were to leak or compromise keys, they can\n  // already do so by other means, since they have access to the raw secrets\n  // that OP_KEY_SHARE is meant to protect. Hence, this attack does not open up\n  // any new attack vectors or venues that were not already available using\n  // different means.\n  const designatedKey = state._vm?.authorizedKeys?.[eKeyId]\n  if (!designatedKey || (height > designatedKey._notAfterHeight) || (height < designatedKey._notBeforeHeight) || !designatedKey.purpose.includes(\n    'enc'\n  )) {\n    throw new ChelErrorUnexpected(\n      `Key ${eKeyId} is unauthorized or expired for the current contract`\n    )\n  }\n\n  const deserializedKey = typeof key === 'string' ? deserializeKey(key) : key\n\n  try {\n    const result = JSON.parse(decrypt(deserializedKey, message, additionalData))\n    if (typeof validatorFn === 'function') validatorFn(result, eKeyId)\n    return result\n  } catch (e) {\n    throw new ChelErrorDecryptionError(e?.message || e)\n  }\n}\n\nexport const encryptedOutgoingData =    (stateOrContractID                 , eKeyId        , data   )                   => {\n  if (!stateOrContractID || data === undefined || !eKeyId) throw new TypeError('Invalid invocation')\n\n  const boundStringValueFn = encryptData.bind(null, stateOrContractID, eKeyId, data)\n\n  return wrapper({\n    get encryptionKeyId () {\n      return eKeyId\n    },\n    get serialize () {\n      return (additionalData         ) => boundStringValueFn(additionalData || '')\n    },\n    get toString () {\n      return (additionalData         ) => JSON.stringify(this.serialize(additionalData))\n    },\n    get valueOf () {\n      return () => data\n    }\n  })\n}\n\n// Used for OP_CONTRACT as a state does not yet exist\nexport const encryptedOutgoingDataWithRawKey =    (key     , data   )                   => {\n  if (data === undefined || !key) throw new TypeError('Invalid invocation')\n\n  const eKeyId = keyId(key)\n  const state = {\n    _vm: {\n      authorizedKeys: {\n        [eKeyId]: {\n          purpose: ['enc'],\n          data: serializeKey(key, false),\n          _notBeforeHeight: 0,\n          _notAfterHeight: undefined\n        }\n      }\n    }\n  }\n  const boundStringValueFn = encryptData.bind(null, state, eKeyId, data)\n\n  return wrapper({\n    get encryptionKeyId () {\n      return eKeyId\n    },\n    get serialize () {\n      return (additionalData         ) => boundStringValueFn(additionalData || '')\n    },\n    get toString () {\n      return (additionalData         ) => JSON.stringify(this.serialize(additionalData))\n    },\n    get valueOf () {\n      return () => data\n    }\n  })\n}\n\nexport const encryptedIncomingData =    (contractID        , state        , data     , height        , additionalKeys         , additionalData         , validatorFn                               )                   => {\n  let decryptedValue\n  const decryptedValueFn = ()      => {\n    if (decryptedValue) {\n      return decryptedValue\n    }\n    if (!state || !additionalKeys) {\n      const rootState = rootStateFn()\n      state = state || rootState[contractID]\n      additionalKeys = additionalKeys ?? rootState.secretKeys\n    }\n    decryptedValue = decryptData(state, height, data, additionalKeys, additionalData || '', validatorFn)\n\n    if (isRawSignedData(decryptedValue)) {\n      decryptedValue = signedIncomingData(contractID, state, decryptedValue, height, additionalData || '')\n    }\n\n    return decryptedValue\n  }\n\n  return wrapper({\n    get encryptionKeyId () {\n      return encryptedDataKeyId(data)\n    },\n    get serialize () {\n      return () => data\n    },\n    get toString () {\n      return () => JSON.stringify(this.serialize())\n    },\n    get valueOf () {\n      return decryptedValueFn\n    },\n    get toJSON () {\n      return this.serialize\n    }\n  })\n}\n\nexport const encryptedIncomingForeignData =    (contractID        , _0     , data     , _1     , additionalKeys         , additionalData         , validatorFn                   )                   => {\n  let decryptedValue\n  const decryptedValueFn = ()      => {\n    if (decryptedValue) {\n      return decryptedValue\n    }\n    const rootState = rootStateFn()\n    const state = rootState[contractID]\n    decryptedValue = decryptData(state, NaN, data, additionalKeys ?? rootState.secretKeys, additionalData || '', validatorFn)\n\n    if (isRawSignedData(decryptedValue)) {\n      // TODO: Specify height\n      return signedIncomingData(contractID, state, decryptedValue, NaN, additionalData || '')\n    }\n\n    return decryptedValue\n  }\n\n  return wrapper({\n    get encryptionKeyId () {\n      return encryptedDataKeyId(data)\n    },\n    get serialize () {\n      return () => data\n    },\n    get toString () {\n      return () => JSON.stringify(this.serialize())\n    },\n    get valueOf () {\n      return decryptedValueFn\n    },\n    get toJSON () {\n      return this.serialize\n    }\n  })\n}\n\nexport const encryptedIncomingDataWithRawKey =    (key     , data     , additionalData         )                   => {\n  if (data === undefined || !key) throw new TypeError('Invalid invocation')\n\n  let decryptedValue\n  const eKeyId = keyId(key)\n  const decryptedValueFn = ()      => {\n    if (decryptedValue) {\n      return decryptedValue\n    }\n    const state = {\n      _vm: {\n        authorizedKeys: {\n          [eKeyId]: {\n            purpose: ['enc'],\n            data: serializeKey(key, false),\n            _notBeforeHeight: 0,\n            _notAfterHeight: undefined\n          }\n        }\n      }\n    }\n    decryptedValue = decryptData(state, NaN, data, { [eKeyId]: key }, additionalData || '')\n\n    return decryptedValue\n  }\n\n  return wrapper({\n    get encryptionKeyId () {\n      return encryptedDataKeyId(data)\n    },\n    get serialize () {\n      return () => data\n    },\n    get toString () {\n      return () => JSON.stringify(this.serialize())\n    },\n    get valueOf () {\n      return decryptedValueFn\n    },\n    get toJSON () {\n      return this.serialize\n    }\n  })\n}\n\nexport const encryptedDataKeyId = (data     )         => {\n  if (!isRawEncryptedData(data)) {\n    throw new ChelErrorDecryptionError('Invalid message format')\n  }\n\n  return data[0]\n}\n\nexport const isRawEncryptedData = (data     )          => {\n  if (!Array.isArray(data) || data.length !== 2 || data.map(v => typeof v).filter(v => v !== 'string').length !== 0) {\n    return false\n  }\n\n  return true\n}\n\nexport const unwrapMaybeEncryptedData = (data     )                                                       => {\n  if (data == null) return\n  if (isEncryptedData(data)) {\n    try {\n      return {\n        encryptionKeyId: data.encryptionKeyId,\n        data: data.valueOf()\n      }\n    } catch (e) {\n      console.warn('unwrapMaybeEncryptedData: Unable to decrypt', e)\n    }\n  } else {\n    return {\n      encryptionKeyId: null,\n      data\n    }\n  }\n}\n\nexport const maybeEncryptedIncomingData =    (contractID        , state        , data     , height        , additionalKeys         , additionalData         , validatorFn                               )                   => {\n  if (isRawEncryptedData(data)) {\n    return encryptedIncomingData(contractID, state, data, height, additionalKeys, additionalData, validatorFn)\n  } else {\n    validatorFn?.(data, '')\n    return data\n  }\n}\n", "'use strict'\n\nimport { createCID, multicodes } from '~/shared/functions.js'\nimport { CURVE25519XSALSA20POLY1305, EDWARDS25519SHA512BATCH, XSALSA20POLY1305, keyId } from '@chelonia/crypto'\nimport { serdesDeserializeSymbol, serdesSerializeSymbol, serdesTagSymbol } from '@chelonia/serdes'\nimport { has } from 'turtledash'\n                                                             \n                                                       \nimport { encryptedIncomingData, encryptedIncomingForeignData, maybeEncryptedIncomingData, unwrapMaybeEncryptedData } from './encryptedData.js'\n                                                 \nimport { isRawSignedData, isSignedData, rawSignedIncomingData, signedIncomingData } from './signedData.js'\n\n                                                                                                                    \n\n                                        \n\n                     \n             \n               \n                          \n                    \n                              \n                                  \n               \n               \n                      \n                           \n                           \n                            \n \n// Allows server to check if the user is allowed to register this type of contract\n// TODO: rename 'type' to 'contractName':\n                                                                                                            \n                                                                                             \n                                                                                                       \n                                                                       // encrypted version of SPOpActionUnencrypted\n                                                         \n                                                           \n                                                          \n                                                                                                                                                     \n                                                                               \n// TODO encrypted SPOpKeyRequest\n                                   \n                     \n                 \n                         \n                            \n                                       \n     \n                  \n \n                                                                                     \n                                                                                                          \n                                                                                                  \n                           \n               \n              \n                   \n                \n                     \n                         \n                                  \n                \n \n                                                                        \n\n                                                                                                              \n                                                                                                                                                                                             \n                                                     \n                                                   \n                                                       \n                                        \n\n                                                    \n                                                                                                                         \n\n// Takes a raw message and processes it so that EncryptedData and SignedData\n// attributes are defined\nconst decryptedAndVerifiedDeserializedMessage = (head        , headJSON        , contractID        , parsedMessage           , additionalKeys         , state        )            => {\n  const op = head.op\n  const height = head.height\n\n  const message            = op === SPMessage.OP_ACTION_ENCRYPTED\n    // $FlowFixMe\n    ? encryptedIncomingData                       (contractID, state, (parsedMessage     ), height, additionalKeys, headJSON, undefined)\n    : parsedMessage\n\n  // If the operation is SPMessage.OP_KEY_ADD or SPMessage.OP_KEY_UPDATE,\n  // extract encrypted data from key.meta?.private?.content\n  if ([SPMessage.OP_KEY_ADD, SPMessage.OP_KEY_UPDATE].includes(op)) {\n    return ((message     )       ).map((key) => {\n      return maybeEncryptedIncomingData(contractID, state, key, height, additionalKeys, headJSON, (key) => {\n        if (key.meta?.private?.content) {\n          key.meta.private.content = encryptedIncomingData(contractID, state, key.meta.private.content, height, additionalKeys, headJSON, (value) => {\n          // Validator function to verify the key matches its expected ID\n            const computedKeyId = keyId(value)\n            if (computedKeyId !== key.id) {\n              throw new Error(`Key ID mismatch. Expected to decrypt key ID ${key.id} but got ${computedKeyId}`)\n            }\n          })\n        }\n        // key.meta?.keyRequest?.contractID could be optionally encrypted\n        if (key.meta?.keyRequest?.reference) {\n          try {\n            key.meta.keyRequest.reference = maybeEncryptedIncomingData(contractID, state, key.meta.keyRequest.reference, height, additionalKeys, headJSON)?.valueOf()\n          } catch {\n            // If we couldn't decrypt it, this value is of no use to us (we\n            // can't keep track of key requests and key shares), so we delete it\n            delete key.meta.keyRequest.reference\n          }\n        }\n        // key.meta?.keyRequest?.contractID could be optionally encrypted\n        if (key.meta?.keyRequest?.contractID) {\n          try {\n            key.meta.keyRequest.contractID = maybeEncryptedIncomingData(contractID, state, key.meta.keyRequest.contractID, height, additionalKeys, headJSON)?.valueOf()\n          } catch {\n            // If we couldn't decrypt it, this value is of no use to us (we\n            // can't keep track of key requests and key shares), so we delete it\n            delete key.meta.keyRequest.contractID\n          }\n        }\n      })\n    })\n  }\n\n  // If the operation is SPMessage.OP_CONTRACT,\n  // extract encrypted data from keys?.[].meta?.private?.content\n  if (op === SPMessage.OP_CONTRACT) {\n    (message     ).keys = (message     ).keys?.map((key) => {\n      return maybeEncryptedIncomingData(contractID, state, key, height, additionalKeys, headJSON, (key) => {\n        if (!key.meta?.private?.content) return\n        // The following two lines are commented out because this feature\n        // (using a foreign decryption contract) doesn't seem to be in use and\n        // the use case seems unclear.\n        // const decryptionFn = key.meta.private.foreignContractID ? encryptedIncomingForeignData : encryptedIncomingData\n        // const decryptionContract = key.meta.private.foreignContractID ? key.meta.private.foreignContractID : contractID\n        const decryptionFn = encryptedIncomingData\n        const decryptionContract = contractID\n        key.meta.private.content = decryptionFn(decryptionContract, state, key.meta.private.content, height, additionalKeys, headJSON, (value) => {\n          const computedKeyId = keyId(value)\n          if (computedKeyId !== key.id) {\n            throw new Error(`Key ID mismatch. Expected to decrypt key ID ${key.id} but got ${computedKeyId}`)\n          }\n        })\n      })\n    })\n  }\n\n  // If the operation is SPMessage.OP_KEY_SHARE,\n  // extract encrypted data from keys?.[].meta?.private?.content\n  if (op === SPMessage.OP_KEY_SHARE) {\n    return maybeEncryptedIncomingData(contractID, state, (message     ), height, additionalKeys, headJSON, (message) => {\n      (message     ).keys?.forEach((key) => {\n        if (!key.meta?.private?.content) return\n        const decryptionFn = message.foreignContractID ? encryptedIncomingForeignData : encryptedIncomingData\n        const decryptionContract = message.foreignContractID || contractID\n        key.meta.private.content = decryptionFn(decryptionContract, state, key.meta.private.content, height, additionalKeys, headJSON, (value) => {\n          const computedKeyId = keyId(value)\n          if (computedKeyId !== key.id) {\n            throw new Error(`Key ID mismatch. Expected to decrypt key ID ${key.id} but got ${computedKeyId}`)\n          }\n        })\n      })\n    })\n  }\n\n  // If the operation is OP_KEY_REQUEST, the payload might be EncryptedData\n  // The ReplyWith attribute is SignedData\n  if (op === SPMessage.OP_KEY_REQUEST) {\n    return maybeEncryptedIncomingData(contractID, state, (message     ), height, additionalKeys, headJSON, (msg) => {\n      msg.replyWith = signedIncomingData(msg.contractID, undefined, msg.replyWith, msg.height, headJSON)\n    })\n  }\n\n  // If the operation is OP_ACTION_UNENCRYPTED, it may contain an inner\n  // signature\n  // Actions must be signed using a key for the current contract\n  if (op === SPMessage.OP_ACTION_UNENCRYPTED && isRawSignedData(message)) {\n    return signedIncomingData(contractID, state, message, height, headJSON)\n  }\n\n  // Inner signatures are handled by EncryptedData\n  if (op === SPMessage.OP_ACTION_ENCRYPTED) {\n    return message\n  }\n\n  if (op === SPMessage.OP_KEY_DEL) {\n    return ((message     )       ).map((key) => {\n      return maybeEncryptedIncomingData(contractID, state, (key     ), height, additionalKeys, headJSON, undefined)\n    })\n  }\n\n  if (op === SPMessage.OP_KEY_REQUEST_SEEN) {\n    return maybeEncryptedIncomingData(contractID, state, (parsedMessage     ), height, additionalKeys, headJSON, undefined)\n  }\n\n  // If the operation is OP_ATOMIC, call this function recursively\n  if (op === SPMessage.OP_ATOMIC) {\n    return ((((message     )            )\n      .map(([opT, opV]) =>\n        [\n          opT,\n          decryptedAndVerifiedDeserializedMessage({ ...head, op: opT }, headJSON, contractID, (opV     ), additionalKeys, state)\n        ]\n      )     )            )\n  }\n\n  return message\n}\n\nexport class SPMessage {\n  // flow type annotations to make flow happy\n  _mapping        \n  _head        \n  _message        \n  _signedMessageData                       \n  _direction                \n  _decryptedValue        \n  _innerSigningKeyId         \n\n  static OP_CONTRACT      = 'c'\n  static OP_ACTION_ENCRYPTED       = 'ae' // e2e-encrypted action\n  static OP_ACTION_UNENCRYPTED       = 'au' // publicly readable action\n  static OP_KEY_ADD       = 'ka' // add this key to the list of keys allowed to write to this contract, or update an existing key\n  static OP_KEY_DEL       = 'kd' // remove this key from authorized keys\n  static OP_KEY_UPDATE       = 'ku' // update key in authorized keys\n  static OP_PROTOCOL_UPGRADE       = 'pu'\n  static OP_PROP_SET       = 'ps' // set a public key/value pair\n  static OP_PROP_DEL       = 'pd' // delete a public key/value pair\n  static OP_CONTRACT_AUTH       = 'ca' // authorize a contract\n  static OP_CONTRACT_DEAUTH       = 'cd' // deauthorize a contract\n  static OP_ATOMIC      = 'a' // atomic op\n  static OP_KEY_SHARE       = 'ks' // key share\n  static OP_KEY_REQUEST       = 'kr' // key request\n  static OP_KEY_REQUEST_SEEN        = 'krs' // key request response\n\n  // eslint-disable-next-line camelcase\n  static createV1_0 (\n    {\n      contractID,\n      previousHEAD = null,\n      previousKeyOp = null,\n      // Height will be automatically set to the correct value when sending\n      // The reason to set it to Number.MAX_SAFE_INTEGER is so that we can\n      // temporarily process outgoing messages with signature validation\n      // still working\n      height = Number.MAX_SAFE_INTEGER,\n      op,\n      manifest\n    }   \n                                \n                             \n                              \n                       \n                  \n                       \n     \n  )       {\n    const head = {\n      version: '1.0.0',\n      previousHEAD,\n      previousKeyOp,\n      height,\n      contractID,\n      op: op[0],\n      manifest\n    }\n    return new this(messageToParams(head, op[1]))\n  }\n\n  // SPMessage.cloneWith could be used when make a SPMessage object having the same id()\n  // https://github.com/okTurtles/group-income/issues/1503\n  static cloneWith (\n    targetHead        ,\n    targetOp         ,\n    sources        \n  )       {\n    const head = Object.assign({}, targetHead, sources)\n    return new this(messageToParams(head, targetOp[1]))\n  }\n\n  static deserialize (value        , additionalKeys         , state         , unwrapMaybeEncryptedDataFn            = unwrapMaybeEncryptedData)       {\n    if (!value) throw new Error(`deserialize bad value: ${value}`)\n    const { head: headJSON, ...parsedValue } = JSON.parse(value)\n    const head = JSON.parse(headJSON)\n    const contractID = head.op === SPMessage.OP_CONTRACT ? createCID(value, multicodes.SHELTER_CONTRACT_DATA) : head.contractID\n\n    // Special case for OP_CONTRACT, since the keys are not yet present in the\n    // state\n    if (!state?._vm?.authorizedKeys && head.op === SPMessage.OP_CONTRACT) {\n      const value = rawSignedIncomingData(parsedValue)\n      const authorizedKeys = Object.fromEntries(value.valueOf()?.keys.map(wk => {\n        const k = unwrapMaybeEncryptedDataFn(wk)\n        if (!k) return null\n        return [k.data.id, k.data]\n      }).filter(Boolean))\n      state = {\n        _vm: {\n          type: head.type,\n          authorizedKeys\n        }\n      }\n    }\n\n    const signedMessageData = signedIncomingData(\n      contractID, state, parsedValue, head.height, headJSON,\n      (message) => decryptedAndVerifiedDeserializedMessage(head, headJSON, contractID, message, additionalKeys, state)\n    )\n\n    return new this({\n      direction: 'incoming',\n      mapping: { key: createCID(value, multicodes.SHELTER_CONTRACT_DATA), value },\n      head,\n      signedMessageData\n    })\n  }\n\n  static deserializeHEAD (value        )                                                                                                         {\n    if (!value) throw new Error(`deserialize bad value: ${value}`)\n    let head, hash\n    const result = {\n      get head () {\n        if (head === undefined) {\n          head = JSON.parse(JSON.parse(value).head)\n        }\n        return head\n      },\n      get hash () {\n        if (!hash) {\n          hash = createCID(value, multicodes.SHELTER_CONTRACT_DATA)\n        }\n        return hash\n      },\n      get contractID () {\n        return result.head?.contractID ?? result.hash\n      },\n      // `description` is not a getter to prevent the value from being copied\n      // if the object is cloned or serialized\n      description ()         {\n        const type = this.head.op\n        return `<op_${type}|${this.hash} of ${this.contractID}>`\n      },\n      get isFirstMessage ()          {\n        return !result.head?.contractID\n      }\n    }\n    return result\n  }\n\n  constructor (params             ) {\n    this._direction = params.direction\n    this._mapping = params.mapping\n    this._head = params.head\n    this._signedMessageData = ((params.signedMessageData     )                       )\n\n    // perform basic sanity check\n    const type = this.opType()\n    let atomicTopLevel = true\n    const validate = (type, message) => {\n      switch (type) {\n        case SPMessage.OP_CONTRACT:\n          if (!this.isFirstMessage() || !atomicTopLevel) throw new Error('OP_CONTRACT: must be first message')\n          break\n        case SPMessage.OP_ATOMIC:\n          if (!atomicTopLevel) {\n            throw new Error('OP_ATOMIC not allowed inside of OP_ATOMIC')\n          }\n          if (!Array.isArray(message)) {\n            throw new TypeError('OP_ATOMIC must be of an array type')\n          }\n          atomicTopLevel = false;\n          (message       ).forEach(([t, m]) => validate(t, m))\n          break\n        case SPMessage.OP_KEY_ADD:\n        case SPMessage.OP_KEY_DEL:\n        case SPMessage.OP_KEY_UPDATE:\n          if (!Array.isArray(message)) throw new TypeError('OP_KEY_{ADD|DEL|UPDATE} must be of an array type')\n          break\n        case SPMessage.OP_KEY_SHARE:\n        case SPMessage.OP_KEY_REQUEST:\n        case SPMessage.OP_KEY_REQUEST_SEEN:\n        case SPMessage.OP_ACTION_ENCRYPTED:\n        case SPMessage.OP_ACTION_UNENCRYPTED:\n        // nothing for now\n          break\n        default:\n          throw new Error(`unsupported op: ${type}`)\n      }\n    }\n\n    // this._message is set as a getter to verify the signature only once the\n    // message contents are read\n    Object.defineProperty(this, '_message', {\n      get: ((validated          ) => () => {\n        const message = this._signedMessageData.valueOf()\n        // If we haven't validated the message, validate it now\n        if (!validated) {\n          validate(type, message)\n          validated = true\n        }\n        return message\n      })()\n    })\n  }\n\n  decryptedValue ()      {\n    if (this._decryptedValue) return this._decryptedValue\n    try {\n      const value = this.message()\n      // TODO: This uses `unwrapMaybeEncryptedData` instead of a configurable\n      // version based on `skipDecryptionAttempts`. This is fine based on current\n      // use, and also something else might be confusing based on the explicit\n      // name of this function, `decryptedValue`.\n      const data = unwrapMaybeEncryptedData(value)\n      // Did decryption succeed? (unwrapMaybeEncryptedData will return undefined\n      // on failure)\n      if (data?.data) {\n      // The data inside could be signed. In this case, we unwrap that to get\n      // to the inner contents\n        if (isSignedData(data.data)) {\n          this._innerSigningKeyId = data.data.signingKeyId\n          this._decryptedValue = data.data.valueOf()\n        } else {\n          this._decryptedValue = data.data\n        }\n      }\n      return this._decryptedValue\n    } catch {\n      // Signature or encryption error\n      // We don't log this error because it's already logged when the value is\n      // retrieved\n      return undefined\n    }\n  }\n\n  innerSigningKeyId ()      {\n    if (!this._decryptedValue) {\n      this.decryptedValue()\n    }\n    return this._innerSigningKeyId\n  }\n\n  head ()         { return this._head }\n\n  message ()            { return this._message }\n\n  op ()       { return [this.head().op, this.message()] }\n\n  rawOp ()          { return [this.head().op, this._signedMessageData] }\n\n  opType ()           { return this.head().op }\n\n  opValue ()            { return this.message() }\n\n  signingKeyId ()         { return this._signedMessageData.signingKeyId }\n\n  manifest ()         { return this.head().manifest }\n\n  description ()         {\n    const type = this.opType()\n    let desc = `<op_${type}`\n    if (type === SPMessage.OP_ACTION_UNENCRYPTED) {\n      try {\n        const value = this.opValue().valueOf()\n        // $FlowFixMe\n        if (typeof value.action === 'string') {\n          desc += `|${value.action}`\n        }\n      } catch (e) {\n        console.warn('Error on .description()', this.hash(), e)\n      }\n    }\n    return `${desc}|${this.hash()} of ${this.contractID()}>`\n  }\n\n  isFirstMessage ()          { return !this.head().contractID }\n\n  contractID ()         { return this.head().contractID || this.hash() }\n\n  serialize ()         { return this._mapping.value }\n\n  hash ()         { return this._mapping.key }\n\n  previousKeyOp ()          { return this._head.previousKeyOp }\n\n  height ()         { return this._head.height }\n\n  id ()         {\n    // TODO: Schedule for later removal\n    throw new Error('SPMessage.id() was called but it has been removed')\n  }\n\n  direction ()                          {\n    return this._direction\n  }\n\n  // `isKeyOp` is used to filter out non-key operations for providing an\n  // abbreviated chain fo snapshot validation\n  isKeyOp ()          {\n    let value     \n    return !!(\n      keyOps.includes(this.opType()) ||\n      // $FlowFixMe\n      (this.opType() === SPMessage.OP_ATOMIC && Array.isArray(value = this.opValue()) && (value       ).some(([opT]) => {\n        return (keyOps            ).includes(opT)\n      }))\n    )\n  }\n\n  // $FlowFixMe[unsupported-syntax]\n  static get [serdesTagSymbol] () {\n    return 'SPMessage'\n  }\n\n  // $FlowFixMe[unsupported-syntax]\n  static [serdesSerializeSymbol] (m           ) {\n    return [m.serialize(), m.direction(), m.decryptedValue(), m.innerSigningKeyId()]\n  }\n\n  // $FlowFixMe[unsupported-syntax]\n  static [serdesDeserializeSymbol] ([serialized, direction, decryptedValue, innerSigningKeyId]) {\n    const m = SPMessage.deserialize(serialized)\n    m._direction = direction\n    m._decryptedValue = decryptedValue\n    m._innerSigningKeyId = innerSigningKeyId\n    return m\n  }\n}\n\nfunction messageToParams (head        , message                       )              {\n  // NOTE: the JSON strings generated here must be preserved forever.\n  //       do not ever regenerate this message using the contructor.\n  //       instead store it using serialize() and restore it using deserialize().\n  //       The issue is that different implementations of JavaScript engines might generate different strings\n  //       when serializing JS objects using JSON.stringify\n  //       and that would lead to different hashes resulting from createCID.\n  //       So to get around this we save the serialized string upon creation\n  //       and keep a copy of it (instead of regenerating it as needed).\n  //       https://github.com/okTurtles/group-income/pull/1513#discussion_r1142809095\n  let mapping\n  return {\n    direction: has(message, 'recreate') ? 'outgoing' : 'incoming',\n    // Lazy computation of mapping to prevent us from serializing outgoing\n    // atomic operations\n    get mapping () {\n      if (!mapping) {\n        const headJSON = JSON.stringify(head)\n        const messageJSON = { ...message.serialize(headJSON), head: headJSON }\n        const value = JSON.stringify(messageJSON)\n\n        mapping = {\n          key: createCID(value, multicodes.SHELTER_CONTRACT_DATA),\n          value\n        }\n      }\n      return mapping\n    },\n    head,\n    signedMessageData: message\n  }\n}\n\n// Operations that affect valid keys\nconst keyOps = [SPMessage.OP_CONTRACT, SPMessage.OP_KEY_ADD, SPMessage.OP_KEY_DEL, SPMessage.OP_KEY_UPDATE]\n", "//      \n\nimport { serdesDeserializeSymbol, serdesSerializeSymbol, serdesTagSymbol } from '@chelonia/serdes'\n\n/* Wrapper class for secrets, which identifies them as such and prevents them\nfrom being logged */\n\n// Use a `WeakMap` to store the actual secret outside of the returned `Secret`\n// object. This ensures that the only way to access the secret is via the\n// `.valueOf()` method, and it prevents accidentally logging things that\n// shouldn't be logged.\nconst wm = new WeakMap()\nexport class Secret    {\n  // $FlowFixMe[unsupported-syntax]\n  static [serdesDeserializeSymbol] (secret) {\n    return new this(secret)\n  }\n\n  // $FlowFixMe[unsupported-syntax]\n  static [serdesSerializeSymbol] (secret        ) {\n    return wm.get(secret)\n  }\n\n  // $FlowFixMe[unsupported-syntax]\n  static get [serdesTagSymbol] () {\n    return '__chelonia_Secret'\n  }\n\n  constructor (value   ) {\n    // $FlowFixMe[escaped-generic]\n    wm.set(this, value)\n  }\n\n  valueOf ()    {\n    // $FlowFixMe[escaped-generic]\n    // $FlowFixMe[incompatible-return]\n    return wm.get(this)\n  }\n}\n", "export const INVITE_STATUS = {\n  REVOKED: 'revoked',\n  VALID: 'valid',\n  USED: 'used'\n}\n", "'use strict'\n\nexport const CHELONIA_RESET = 'chelonia-reset'\nexport const CONTRACT_IS_SYNCING = 'contract-is-syncing'\nexport const CONTRACTS_MODIFIED = 'contracts-modified'\nexport const CONTRACTS_MODIFIED_READY = 'contracts-modified-ready'\nexport const EVENT_HANDLED = 'event-handled'\nexport const EVENT_PUBLISHED = 'event-published'\nexport const EVENT_PUBLISHING_ERROR = 'event-publishing-error'\nexport const EVENT_HANDLED_READY = 'event-handled-ready'\nexport const CONTRACT_REGISTERED = 'contract-registered'\nexport const CONTRACT_UNREGISTERED = 'contract-unregistered'\nexport const CONTRACT_IS_PENDING_KEY_REQUESTS = 'contract-is-pending-key-requests'\nexport const CONTRACT_HAS_RECEIVED_KEYS = 'contract-has-received-keys'\nexport const PERSISTENT_ACTION_FAILURE = 'persistent-action-failure'\nexport const PERSISTENT_ACTION_SUCCESS = 'persistent-action-success'\nexport const PERSISTENT_ACTION_TOTAL_FAILURE = 'persistent-action-total_failure'\n", "import sbp from '@sbp/sbp'\nimport { has, omit } from 'turtledash'\nimport { b64ToStr } from '~/shared/functions.js'\n                                                                                                                                                                           \nimport { SPMessage } from './SPMessage.js'\nimport { Secret } from './Secret.js'\nimport { INVITE_STATUS } from './constants.js'\nimport { deserializeKey, serializeKey, sign, verifySignature } from '@chelonia/crypto'\n                                                       \nimport { ChelErrorForkedChain, ChelErrorResourceGone, ChelErrorUnexpectedHttpResponseCode, ChelErrorWarning } from './errors.js'\nimport { CONTRACT_IS_PENDING_KEY_REQUESTS } from './events.js'\n                                                 \nimport { isSignedData } from './signedData.js'\n\nconst MAX_EVENTS_AFTER = Number.parseInt(process.env.MAX_EVENTS_AFTER || '', 10) || Infinity\n\nexport const findKeyIdByName = (state        , name        )          => state._vm?.authorizedKeys && ((Object.values((state._vm.authorizedKeys     ))     )         ).find((k) => k.name === name && k._notAfterHeight == null)?.id\n\nexport const findForeignKeysByContractID = (state        , contractID        )            => state._vm?.authorizedKeys && ((Object.values((state._vm.authorizedKeys     ))     )         ).filter((k) => k._notAfterHeight == null && k.foreignKey?.includes(contractID)).map(k => k.id)\n\nexport const findRevokedKeyIdsByName = (state        , name        )           => state._vm?.authorizedKeys && ((Object.values((state._vm.authorizedKeys     ) || {})     )         ).filter((k) => k.name === name && k._notAfterHeight != null).map(k => k.id)\n\nexport const findSuitableSecretKeyId = (state        , permissions                , purposes                , ringLevel         , allowedActions                 )          => {\n  return state._vm?.authorizedKeys &&\n    ((Object.values((state._vm.authorizedKeys     ))     )         )\n      .filter((k) => {\n        return k._notAfterHeight == null &&\n        (k.ringLevel <= (ringLevel ?? Number.POSITIVE_INFINITY)) &&\n        sbp('chelonia/haveSecretKey', k.id) &&\n        (Array.isArray(permissions)\n          ? permissions.reduce((acc, permission) =>\n            acc && (k.permissions === '*' || k.permissions.includes(permission)), true\n          )\n          : permissions === k.permissions\n        ) &&\n      purposes.reduce((acc, purpose) => acc && k.purpose.includes(purpose), true) &&\n      (Array.isArray(allowedActions)\n        ? allowedActions.reduce((acc, action) =>\n          acc && (k.allowedActions === '*' || !!k.allowedActions?.includes(action)), true\n        )\n        : allowedActions ? allowedActions === k.allowedActions : true\n      )\n      })\n      .sort((a, b) => b.ringLevel - a.ringLevel)[0]?.id\n}\n\nexport const findContractIDByForeignKeyId = (state        , keyId        )          => {\n  let fk         \n  if (!keyId || !(fk = state?._vm?.authorizedKeys?.[keyId]?.foreignKey)) return\n\n  try {\n    const fkUrl = new URL(fk)\n    return fkUrl.pathname\n  } catch {}\n}\n\n// TODO: Resolve inviteKey being added (doesn't have krs permission)\nexport const findSuitablePublicKeyIds = (state        , permissions                , purposes                , ringLevel         )            => {\n  return state._vm?.authorizedKeys &&\n    ((Object.values((state._vm.authorizedKeys     ))     )         ).filter((k) =>\n      (k._notAfterHeight == null) &&\n      (k.ringLevel <= (ringLevel ?? Number.POSITIVE_INFINITY)) &&\n      (Array.isArray(permissions)\n        ? permissions.reduce((acc, permission) => acc && (k.permissions === '*' || k.permissions.includes(permission)), true)\n        : permissions === k.permissions\n      ) &&\n      purposes.reduce((acc, purpose) => acc && k.purpose.includes(purpose), true))\n      .sort((a, b) => b.ringLevel - a.ringLevel)\n      .map((k) => k.id)\n}\n\nconst validateActionPermissions = (msg           , signingKey       , state        , opT        , opV                       ) => {\n  const data                             = isSignedData(opV)\n    ? (opV     ).valueOf()\n    : (opV     )\n\n  if (\n    signingKey.allowedActions !== '*' && (\n      !Array.isArray(signingKey.allowedActions) ||\n      !signingKey.allowedActions.includes(data.action)\n    )\n  ) {\n    logEvtError(msg, `Signing key ${signingKey.id} is not allowed for action ${data.action}`)\n    return false\n  }\n\n  if (isSignedData(opV)) {\n    const s = ((opV     )                  )\n    const innerSigningKey = state._vm?.authorizedKeys?.[s.signingKeyId]\n\n    // For outgoing messages, we may be using an inner signing key that isn't\n    // available for us to see. In this case, we ignore the missing key.\n    // For incoming messages, we must check permissions and a missing\n    // key means no permissions.\n    if (!innerSigningKey && msg._direction === 'outgoing') return true\n\n    if (\n      !innerSigningKey ||\n      !Array.isArray(innerSigningKey.purpose) ||\n        !innerSigningKey.purpose.includes('sig') ||\n        (innerSigningKey.permissions !== '*' &&\n          (\n            !Array.isArray(innerSigningKey.permissions) ||\n            !innerSigningKey.permissions.includes(opT + '#inner')\n          )\n        )\n    ) {\n      logEvtError(msg, `Signing key ${s.signingKeyId} is missing permissions for operation ${opT}`)\n      return false\n    }\n\n    if (\n      innerSigningKey.allowedActions !== '*' && (\n        !Array.isArray(innerSigningKey.allowedActions) ||\n        !innerSigningKey.allowedActions.includes(data.action + '#inner')\n      )\n    ) {\n      logEvtError(msg, `Signing key ${innerSigningKey.id} is not allowed for action ${data.action}`)\n      return false\n    }\n  }\n\n  return true\n}\n\nexport const validateKeyPermissions = (msg           , config        , state        , signingKeyId        , opT        , opV           )          => {\n  const signingKey = state._vm?.authorizedKeys?.[signingKeyId]\n  if (\n    !signingKey ||\n    !Array.isArray(signingKey.purpose) ||\n      !signingKey.purpose.includes('sig') ||\n      (signingKey.permissions !== '*' &&\n        (\n          !Array.isArray(signingKey.permissions) ||\n          !signingKey.permissions.includes(opT)\n        )\n      )\n  ) {\n    logEvtError(msg, `Signing key ${signingKeyId} is missing permissions for operation ${opT}`)\n    return false\n  }\n\n  if (\n    opT === SPMessage.OP_ACTION_UNENCRYPTED &&\n    !validateActionPermissions(msg, signingKey, state, opT, (opV     ))\n  ) {\n    return false\n  }\n\n  if (\n    !config.skipActionProcessing &&\n    opT === SPMessage.OP_ACTION_ENCRYPTED &&\n    !validateActionPermissions(msg, signingKey, state, opT, (opV     ).valueOf())\n  ) {\n    return false\n  }\n\n  return true\n}\n\nexport const validateKeyAddPermissions = function (contractID        , signingKey       , state        , v                                  , skipPrivateCheck          ) {\n  const signingKeyPermissions = Array.isArray(signingKey.permissions) ? new Set(signingKey.permissions) : signingKey.permissions\n  const signingKeyAllowedActions = Array.isArray(signingKey.allowedActions) ? new Set(signingKey.allowedActions) : signingKey.allowedActions\n  if (!state._vm?.authorizedKeys?.[signingKey.id]) throw new Error('Singing key for OP_KEY_ADD or OP_KEY_UPDATE must exist in _vm.authorizedKeys. contractID=' + contractID + ' signingKeyId=' + signingKey.id)\n  const localSigningKey = state._vm.authorizedKeys[signingKey.id]\n  v.forEach(wk => {\n    // $FlowFixMe[prop-missing]\n    const data = this.config.unwrapMaybeEncryptedData(wk)\n    if (!data) return\n    const k = (data.data       )\n    if (!skipPrivateCheck && signingKey._private && !data.encryptionKeyId) {\n      throw new Error('Signing key is private but it tried adding a public key')\n    }\n    if (!Number.isSafeInteger(k.ringLevel) || k.ringLevel < localSigningKey.ringLevel) {\n      throw new Error('Signing key has ringLevel ' + localSigningKey.ringLevel + ' but attempted to add or update a key with ringLevel ' + k.ringLevel)\n    }\n    if (signingKeyPermissions !== '*') {\n      if (!Array.isArray(k.permissions) || !k.permissions.reduce((acc, cv) => acc && signingKeyPermissions.has(cv), true)) {\n        throw new Error('Unable to add or update a key with more permissions than the signing key. signingKey permissions: ' + String(signingKey?.permissions) + '; key add permissions: ' + String(k.permissions))\n      }\n    }\n    if (signingKeyAllowedActions !== '*' && k.allowedActions) {\n      if (!signingKeyAllowedActions || !Array.isArray(k.allowedActions) || !k.allowedActions.reduce((acc, cv) => acc && signingKeyAllowedActions.has(cv), true)) {\n        throw new Error('Unable to add or update a key with more allowed actions than the signing key. signingKey allowed actions: ' + String(signingKey?.allowedActions) + '; key add allowed actions: ' + String(k.allowedActions))\n      }\n    }\n  })\n}\n\nexport const validateKeyDelPermissions = function (contractID        , signingKey       , state        , v                                    ) {\n  if (!state._vm?.authorizedKeys?.[signingKey.id]) throw new Error('Singing key for OP_KEY_DEL must exist in _vm.authorizedKeys. contractID=' + contractID + ' signingKeyId=' + signingKey.id)\n  const localSigningKey = state._vm.authorizedKeys[signingKey.id]\n  v\n    .forEach((wid) => {\n      const data = this.config.unwrapMaybeEncryptedData(wid)\n      if (!data) return\n      const id = data.data\n      const k = state._vm.authorizedKeys[id]\n      if (!k) {\n        throw new Error('Nonexisting key ID ' + id)\n      }\n      if (signingKey._private) {\n        throw new Error('Signing key is private')\n      }\n      if (!k._private !== !data.encryptionKeyId) {\n        throw new Error('_private attribute must be preserved')\n      }\n      if (!Number.isSafeInteger(k.ringLevel) || k.ringLevel < localSigningKey.ringLevel) {\n        throw new Error('Signing key has ringLevel ' + localSigningKey.ringLevel + ' but attempted to remove a key with ringLevel ' + k.ringLevel)\n      }\n    })\n}\n\nexport const validateKeyUpdatePermissions = function (contractID        , signingKey       , state        , v                                              )                                     {\n  const updatedMap = ((Object.create(null)     )                         )\n  const keys = v.map((wuk)               => {\n    const data = this.config.unwrapMaybeEncryptedData(wuk)\n    if (!data) return undefined\n    const uk = (data.data             )\n\n    const existingKey = state._vm.authorizedKeys[uk.oldKeyId]\n    if (!existingKey) {\n      throw new ChelErrorWarning('Missing old key ID ' + uk.oldKeyId)\n    }\n    if (!existingKey._private !== !data.encryptionKeyId) {\n      throw new Error('_private attribute must be preserved')\n    }\n    if (uk.name !== existingKey.name) {\n      throw new Error('Name cannot be updated')\n    }\n    if (!uk.id !== !uk.data) {\n      throw new Error('Both or none of the id and data attributes must be provided. Old key ID: ' + uk.oldKeyId)\n    }\n    if (uk.data && existingKey.meta?.private && !(uk.meta?.private)) {\n      throw new Error('Missing private key. Old key ID: ' + uk.oldKeyId)\n    }\n    if (uk.id && uk.id !== uk.oldKeyId) {\n      updatedMap[uk.id] = uk.oldKeyId\n    }\n    // Discard `_notAfterHeight` and `_notBeforeHeight`, since retaining them\n    // can cause issues reprocessing messages.\n    // An example is reprocessing old messages in a chatroom using\n    // `chelonia/in/processMessage`: cloning `_notAfterHeight` will break key\n    // rotations, since the new key will have the same expiration value as the\n    // old key (the new key is supposed to have no expiration height).\n    const updatedKey = omit(existingKey, ['_notAfterHeight', '_notBeforeHeight'])\n    // Set the corresponding updated attributes\n    if (uk.permissions) {\n      updatedKey.permissions = uk.permissions\n    }\n    if (uk.allowedActions) {\n      updatedKey.allowedActions = uk.allowedActions\n    }\n    if (uk.purpose) {\n      updatedKey.purpose = uk.purpose\n    }\n    if (uk.meta) {\n      updatedKey.meta = uk.meta\n    }\n    if (uk.id) {\n      updatedKey.id = uk.id\n    }\n    if (uk.data) {\n      updatedKey.data = uk.data\n    }\n    return updatedKey\n  }).filter(Boolean)\n  validateKeyAddPermissions.call(this, contractID, signingKey, state, keys, true)\n  return [((keys     )         ), updatedMap]\n}\n\nexport const keyAdditionProcessor = function (_msg           , hash        , keys                                  , state        , contractID        , _signingKey       , internalSideEffectStack             ) {\n  const decryptedKeys = []\n  const keysToPersist = []\n\n  const storeSecretKey = (key, decryptedKey) => {\n    const decryptedDeserializedKey = deserializeKey(decryptedKey)\n    const transient = !!key.meta?.private?.transient\n    sbp('chelonia/storeSecretKeys', new Secret([{\n      key: decryptedDeserializedKey,\n      // We always set this to true because this could be done from\n      // an outgoing message\n      transient: true\n    }]))\n    if (!transient) {\n      keysToPersist.push({ key: decryptedDeserializedKey, transient })\n    }\n  }\n\n  for (const wkey of keys) {\n    const data = this.config.unwrapMaybeEncryptedData(wkey)\n    if (!data) continue\n    const key = data.data\n    let decryptedKey         \n    // Does the key have key.meta?.private? If so, attempt to decrypt it\n    if (key.meta?.private && key.meta.private.content) {\n      if (\n        key.id &&\n        key.meta.private.content &&\n        !sbp('chelonia/haveSecretKey', key.id, !key.meta.private.transient)\n      ) {\n        const decryptedKeyResult = this.config.unwrapMaybeEncryptedData(key.meta.private.content)\n        // Ignore data that couldn't be decrypted\n        if (decryptedKeyResult) {\n        // Data aren't encrypted\n          if (decryptedKeyResult.encryptionKeyId == null) {\n            throw new Error('Expected encrypted data but got unencrypted data for key with ID: ' + key.id)\n          }\n          decryptedKey = decryptedKeyResult.data\n          decryptedKeys.push([key.id, decryptedKey])\n          storeSecretKey(key, decryptedKey)\n        }\n      }\n    }\n\n    // Is this a #sak\n    if (key.name === '#sak') {\n      if (data.encryptionKeyId) {\n        throw new Error('#sak may not be encrypted')\n      }\n      if (key.permissions && (!Array.isArray(key.permissions) || key.permissions.length !== 0)) {\n        throw new Error('#sak may not have permissions')\n      }\n      if (!Array.isArray(key.purpose) || key.purpose.length !== 1 || key.purpose[0] !== 'sak') {\n        throw new Error(\"#sak must have exactly one purpose: 'sak'\")\n      }\n      if (key.ringLevel !== 0) {\n        throw new Error('#sak must have ringLevel 0')\n      }\n    }\n\n    // Is this a an invite key? If so, run logic for invite keys and invitation\n    // accounting\n    if (key.name.startsWith('#inviteKey-')) {\n      if (!state._vm.invites) state._vm.invites = Object.create(null)\n      const inviteSecret = decryptedKey || (\n        has(this.transientSecretKeys, key.id)\n          ? serializeKey(this.transientSecretKeys[key.id], true)\n          : undefined\n      )\n      state._vm.invites[key.id] = {\n        status: INVITE_STATUS.VALID,\n        initialQuantity: key.meta.quantity,\n        quantity: key.meta.quantity,\n        expires: key.meta.expires,\n        inviteSecret,\n        responses: []\n      }\n    }\n\n    // Is this KEY operation the result of requesting keys for another contract?\n    if (key.meta?.keyRequest?.contractID && findSuitableSecretKeyId(state, [SPMessage.OP_KEY_ADD], ['sig'])) {\n      const data = this.config.unwrapMaybeEncryptedData(key.meta.keyRequest.contractID)\n\n      // Are we subscribed to this contract?\n      // If we are not subscribed to the contract, we don't set pendingKeyRequests because we don't need that contract's state\n      // Setting pendingKeyRequests in these cases could result in issues\n      // when a corresponding OP_KEY_SHARE is received, which could trigger subscribing to this previously unsubscribed to contract\n      if (data && internalSideEffectStack) {\n        const keyRequestContractID = data.data\n        const reference = this.config.unwrapMaybeEncryptedData(key.meta.keyRequest.reference)\n\n        // Since now we'll make changes to keyRequestContractID, we need to\n        // do this while no other operations are running for that\n        // contract\n        internalSideEffectStack.push(() => {\n          sbp('chelonia/private/queueEvent', keyRequestContractID, () => {\n            const rootState = sbp(this.config.stateSelector)\n\n            const originatingContractState = rootState[contractID]\n            if (sbp('chelonia/contract/hasKeyShareBeenRespondedBy', originatingContractState, keyRequestContractID, reference)) {\n            // In the meantime, our key request has been responded, so we\n            // don't need to set pendingKeyRequests.\n              return\n            }\n\n            if (!has(rootState, keyRequestContractID)) this.config.reactiveSet(rootState, keyRequestContractID, Object.create(null))\n            const targetState = rootState[keyRequestContractID]\n\n            if (!targetState._volatile) {\n              this.config.reactiveSet(targetState, '_volatile', Object.create(null))\n            }\n            if (!targetState._volatile.pendingKeyRequests) {\n              this.config.reactiveSet(rootState[keyRequestContractID]._volatile, 'pendingKeyRequests', [])\n            }\n\n            if (targetState._volatile.pendingKeyRequests.some((pkr) => {\n              return pkr && pkr.contractID === contractID && pkr.hash === hash\n            })) {\n            // This pending key request has already been registered.\n            // Nothing left to do.\n              return\n            }\n\n            // Mark the contract for which keys were requested as pending keys\n            // The hash (of the current message) is added to this dictionary\n            // for cross-referencing puposes.\n            targetState._volatile.pendingKeyRequests.push({ contractID, name: key.name, hash, reference: reference?.data })\n\n            this.setPostSyncOp(contractID, 'pending-keys-for-' + keyRequestContractID, ['okTurtles.events/emit', CONTRACT_IS_PENDING_KEY_REQUESTS, { contractID: keyRequestContractID }])\n          }).catch((e) => {\n            // Using console.error instead of logEvtError because this\n            // is a side-effect and not relevant for outgoing messages\n            console.error('Error while setting or updating pendingKeyRequests', { contractID, keyRequestContractID, reference }, e)\n          })\n        })\n      }\n    }\n  }\n\n  // Any persistent keys are stored as a side-effect\n  if (keysToPersist.length) {\n    internalSideEffectStack?.push(() => {\n      sbp('chelonia/storeSecretKeys', new Secret(keysToPersist))\n    })\n  }\n  internalSideEffectStack?.push(() => subscribeToForeignKeyContracts.call(this, contractID, state))\n}\n\nexport const subscribeToForeignKeyContracts = function (contractID        , state        ) {\n  try {\n    // $FlowFixMe[incompatible-call]\n    Object.values((state._vm.authorizedKeys                        )).filter((key) => !!((key     )       ).foreignKey && findKeyIdByName(state, ((key     )       ).name) != null).forEach((key       ) => {\n      const foreignKey = String(key.foreignKey)\n      const fkUrl = new URL(foreignKey)\n      const foreignContract = fkUrl.pathname\n      const foreignKeyName = fkUrl.searchParams.get('keyName')\n\n      if (!foreignContract || !foreignKeyName) {\n        console.warn('Invalid foreign key: missing contract or key name', { contractID, keyId: key.id })\n        return\n      }\n\n      const rootState = sbp(this.config.stateSelector)\n\n      const signingKey = findSuitableSecretKeyId(state, [SPMessage.OP_KEY_DEL], ['sig'], key.ringLevel)\n      const canMirrorOperations = !!signingKey\n\n      // If we cannot mirror operations, then there is nothing left to do\n      if (!canMirrorOperations) return\n\n      // If the key is already being watched, do nothing\n      if (Array.isArray(rootState?.[foreignContract]?._volatile?.watch)) {\n        if (rootState[foreignContract]._volatile.watch.find((v) =>\n          v[0] === key.name && v[1] === contractID\n        )) return\n      }\n\n      if (!has(state._vm, 'pendingWatch')) this.config.reactiveSet(state._vm, 'pendingWatch', Object.create(null))\n      if (!has(state._vm.pendingWatch, foreignContract)) this.config.reactiveSet(state._vm.pendingWatch, foreignContract, [])\n      if (!state._vm.pendingWatch[foreignContract].find(([n]) => n === foreignKeyName)) {\n        state._vm.pendingWatch[foreignContract].push([foreignKeyName, key.id])\n      }\n\n      this.setPostSyncOp(contractID, `watchForeignKeys-${contractID}`, ['chelonia/private/watchForeignKeys', contractID])\n    })\n  } catch (e) {\n    console.warn('Error at subscribeToForeignKeyContracts: ' + (e.message || e))\n  }\n}\n\n// Messages might be sent before receiving already posted messages, which will\n// result in a conflict\n// When resending a message, race conditions might also occur (for example, if\n// key rotation is required and there are many clients simultaneously online, it\n// may be performed by all connected clients at once).\n// The following function handles re-signing of messages when a conflict\n// occurs (required because the message's previousHEAD will change) as well as\n// duplicate operations. For operations involving keys, the payload will be\n// rewritten to eliminate no-longer-relevant keys. In most cases, this would\n// result in an empty payload, in which case the message is omitted entirely.\nexport const recreateEvent = (entry           , state        , contractsState        )                               => {\n  const { HEAD: previousHEAD, height: previousHeight, previousKeyOp } = contractsState || {}\n  if (!previousHEAD) {\n    throw new Error('recreateEvent: Giving up because the contract has been removed')\n  }\n  const head = entry.head()\n\n  const [opT, rawOpV] = entry.rawOp()\n\n  const recreateOperation = (opT        , rawOpV                       ) => {\n    const opV = rawOpV.valueOf()\n    const recreateOperationInternal = (opT        , opV           )                               => {\n      let newOpV           \n      if (opT === SPMessage.OP_KEY_ADD) {\n        if (!Array.isArray(opV)) throw new Error('Invalid message format')\n        newOpV = ((opV     )            ).filter((k) => {\n          const kId = (k.valueOf()     ).id\n          return !has(state._vm.authorizedKeys, kId) || state._vm.authorizedKeys[kId]._notAfterHeight != null\n        })\n        // Has this key already been added? (i.e., present in authorizedKeys)\n        if (newOpV.length === 0) {\n          console.info('Omitting empty OP_KEY_ADD', { head })\n        } else if (newOpV.length === opV.length) {\n          return opV\n        }\n      } else if (opT === SPMessage.OP_KEY_DEL) {\n        if (!Array.isArray(opV)) throw new Error('Invalid message format')\n        // Has this key already been removed? (i.e., no longer in authorizedKeys)\n        newOpV = opV.filter((keyId) => {\n          const kId = (Object(keyId).valueOf()     )\n          return has(state._vm.authorizedKeys, kId) && state._vm.authorizedKeys[kId]._notAfterHeight == null\n        })\n        if (newOpV.length === 0) {\n          console.info('Omitting empty OP_KEY_DEL', { head })\n        } else if (newOpV.length === opV.length) {\n          return opV\n        }\n      } else if (opT === SPMessage.OP_KEY_UPDATE) {\n        if (!Array.isArray(opV)) throw new Error('Invalid message format')\n        // Has this key already been replaced? (i.e., no longer in authorizedKeys)\n        newOpV = ((opV     )               ).filter((k) => {\n          const oKId = (k.valueOf()     ).oldKeyId\n          const nKId = (k.valueOf()     ).id\n          return nKId == null || (has(state._vm.authorizedKeys, oKId) && state._vm.authorizedKeys[oKId]._notAfterHeight == null)\n        })\n        if (newOpV.length === 0) {\n          console.info('Omitting empty OP_KEY_UPDATE', { head })\n        } else if (newOpV.length === opV.length) {\n          return opV\n        }\n      } else if (opT === SPMessage.OP_ATOMIC) {\n        if (!Array.isArray(opV)) throw new Error('Invalid message format')\n        newOpV = ((((opV     )            ).map(([t, v]) => [t, recreateOperationInternal(t, v)]).filter(([, v]) => !!v)     )            )\n        if (newOpV.length === 0) {\n          console.info('Omitting empty OP_ATOMIC', { head })\n        } else if (newOpV.length === opV.length && newOpV.reduce((acc, cv, i) => acc && cv === opV[i], true)) {\n          return opV\n        } else {\n          return newOpV\n        }\n      } else {\n        return opV\n      }\n    }\n\n    const newOpV = recreateOperationInternal(opT, opV)\n\n    if (newOpV === opV) {\n      return rawOpV\n    } else if (newOpV === undefined) {\n      return\n    }\n\n    if (typeof rawOpV.recreate !== 'function') {\n      throw new Error('Unable to recreate operation')\n    }\n\n    return rawOpV.recreate(newOpV)\n  }\n\n  const newRawOpV = recreateOperation(opT, rawOpV)\n\n  if (!newRawOpV) return\n\n  const newOp = [opT, newRawOpV]\n\n  entry = SPMessage.cloneWith(\n    head, newOp, { previousKeyOp, previousHEAD, height: previousHeight + 1 }\n  )\n\n  return entry\n}\n\nexport const getContractIDfromKeyId = (contractID        , signingKeyId         , state        )          => {\n  if (!signingKeyId) return\n  return signingKeyId && state._vm?.authorizedKeys?.[signingKeyId]?.foreignKey\n    ? new URL(state._vm.authorizedKeys[signingKeyId].foreignKey).pathname\n    : contractID\n}\n\nexport function eventsAfter (contractID        , sinceHeight        , limit         , sinceHash         , { stream }                      = { stream: true })                                  {\n  if (!contractID) {\n    // Avoid making a network roundtrip to tell us what we already know\n    throw new Error('Missing contract ID')\n  }\n\n  let lastUrl\n  const fetchEventsStreamReader = async () => {\n    requestLimit = Math.min(limit ?? MAX_EVENTS_AFTER, remainingEvents)\n    lastUrl = `${this.config.connectionURL}/eventsAfter/${contractID}/${sinceHeight}${Number.isInteger(requestLimit) ? `/${requestLimit}` : ''}`\n    const eventsResponse = await this.config.fetch(lastUrl, { signal })\n    if (!eventsResponse.ok) {\n      const msg = `${eventsResponse.status}: ${eventsResponse.statusText}`\n      // $FlowFixMe[extra-arg]\n      if (eventsResponse.status === 404 || eventsResponse.status === 410) throw new ChelErrorResourceGone(msg, { cause: eventsResponse.status })\n      // $FlowFixMe[extra-arg]\n      throw new ChelErrorUnexpectedHttpResponseCode(msg, { cause: eventsResponse.status })\n    }\n    if (!eventsResponse.body) throw new Error('Missing body')\n    latestHeight = parseInt(eventsResponse.headers.get('shelter-headinfo-height'), 10)\n    if (!Number.isSafeInteger(latestHeight)) throw new Error('Invalid latest height')\n    requestCount++\n    // $FlowFixMe[incompatible-use]\n    return eventsResponse.body.getReader()\n  }\n  if (!Number.isSafeInteger(sinceHeight) || sinceHeight < 0) {\n    throw new TypeError('Invalid since height value. Expected positive integer.')\n  }\n  const signal = this.abortController.signal\n  let requestCount = 0\n  let remainingEvents = limit ?? Number.POSITIVE_INFINITY\n  let eventsStreamReader\n  let latestHeight\n  let state                                                                         = 'fetch'\n  let requestLimit        \n  let count        \n  let buffer         = ''\n  let currentEvent        \n  // return ReadableStream with a custom pull function to handle streamed data\n  const s = new ReadableStream({\n    // The pull function is called whenever the internal buffer of the stream\n    // becomes empty and needs more data.\n    async pull (controller) {\n      try {\n        for (;;) {\n        // Handle different states of the stream reading process.\n          switch (state) {\n          // When in 'fetch' state, initiate a new fetch request to obtain a\n          // stream reader for events.\n            case 'fetch': {\n              eventsStreamReader = await fetchEventsStreamReader()\n              // Transition to reading the new response and reset the processed\n              // events counter\n              state = 'read-new-response'\n              count = 0\n              break\n            }\n            case 'read-eos': // End of stream case\n            case 'read-new-response': // Just started reading a new response\n            case 'read': { // Reading from the response stream\n              const { done, value } = await eventsStreamReader.read()\n              // If done, determine if the stream should close or fetch more\n              // data by making a new request\n              if (done) {\n              // No more events to process or reached the latest event\n              // Using `>=` instead of `===` to avoid an infinite loop in the\n              // event of data loss on the server.\n                if (remainingEvents === 0 || sinceHeight >= latestHeight) {\n                  controller.close()\n                  return\n                } else if (state === 'read-new-response' || buffer) {\n                // If done prematurely, throw an error\n                  throw new Error('Invalid response: done too early')\n                } else {\n                // If there are still events to fetch, switch state to fetch\n                  state = 'fetch'\n                  break\n                }\n              }\n              if (!value) {\n              // If there's no value (e.g., empty response), throw an error\n                throw new Error('Invalid response: missing body')\n              }\n              // Concatenate new data to the buffer, trimming any\n              // leading/trailing whitespace (the response is a JSON array of\n              // base64-encoded data, meaning that whitespace is not significant)\n              buffer = buffer + Buffer.from(value).toString().trim()\n              // If there was only whitespace, try reading again\n              if (!buffer) break\n              if (state === 'read-new-response') {\n              // Response is in JSON format, so we look for the start of an\n              // array (`[`)\n                if (buffer[0] !== '[') {\n                  throw new Error('Invalid response: no array start delimiter')\n                }\n                // Trim the array start delimiter from the buffer\n                buffer = buffer.slice(1)\n              } else if (state === 'read-eos') {\n              // If in 'read-eos' state and still reading data, it's an error\n              // because the response isn't valid JSON (there should be\n              // nothing other than whitespace after `]`)\n                throw new Error('Invalid data at the end of response')\n              }\n              // If not handling new response or end-of-stream, switch to\n              // processing events\n              state = 'events'\n              break\n            }\n            case 'events': {\n            // Process events by looking for a comma or closing bracket that\n            // indicates the end of an event\n              const nextIdx = buffer.search(/(?<=\\s*)[,\\]]/)\n              // If the end of the event isn't found, go back to reading more\n              // data\n              if (nextIdx < 0) {\n                state = 'read'\n                break\n              }\n              let enqueued = false\n              try {\n              // Extract the current event's value and trim whitespace\n                const eventValue = buffer.slice(0, nextIdx).trim()\n                if (eventValue) {\n                // Check if the event limit is reached; if so, throw an error\n                  if (count === requestLimit) {\n                    throw new Error('Received too many events')\n                  }\n                  currentEvent = JSON.parse(b64ToStr(JSON.parse(eventValue))).message\n                  if (count === 0) {\n                    const hash = SPMessage.deserializeHEAD(currentEvent).hash\n                    const height = SPMessage.deserializeHEAD(currentEvent).head.height\n                    if (height !== sinceHeight || (sinceHash && sinceHash !== hash)) {\n                      if (height === sinceHeight && sinceHash && sinceHash !== hash) {\n                        throw new ChelErrorForkedChain(`Forked chain: hash(${hash}) !== since(${sinceHash})`)\n                      } else {\n                        throw new Error(`Unexpected data: hash(${hash}) !== since(${sinceHash || ''}) or height(${height}) !== since(${sinceHeight})`)\n                      }\n                    }\n                  }\n                  // If this is the first event in a second or later request,\n                  // drop the event because it's already been included in\n                  // a previous response\n                  if (count++ !== 0 || requestCount !== 0) {\n                    controller.enqueue(currentEvent)\n                    enqueued = true\n                    remainingEvents--\n                  }\n                }\n                // If the stream is finished (indicated by a closing bracket),\n                // update `since` (to make the next request if needed) and\n                // switch to 'read-eos'.\n                if (buffer[nextIdx] === ']') {\n                  if (currentEvent) {\n                    const deserialized = SPMessage.deserializeHEAD(currentEvent)\n                    sinceHeight = deserialized.head.height\n                    sinceHash = deserialized.hash\n                    state = 'read-eos'\n                  } else {\n                  // If the response came empty, assume there are no more events\n                  // after. Mostly this prevents infinite loops if a server is\n                  // claiming there are more events than it's willing to return\n                  // data for.\n                    state = 'eod'\n                  }\n                  // This should be an empty string now\n                  buffer = buffer.slice(nextIdx + 1).trim()\n                } else if (currentEvent) {\n                // Otherwise, move the buffer pointer to the next event\n                  buffer = buffer.slice(nextIdx + 1).trimStart()\n                } else {\n                // If the end delimiter (`]`) is missing, throw an error\n                  throw new Error('Missing end delimiter')\n                }\n                // If an event was successfully enqueued, exit the loop to wait\n                // for the next pull request\n                if (enqueued) {\n                  return\n                }\n              } catch (e) {\n                console.error('[chelonia] Error during event parsing', e)\n                throw e\n              }\n              break\n            }\n            case 'eod': {\n              if (remainingEvents === 0 || sinceHeight >= latestHeight) {\n                controller.close()\n              } else {\n                throw new Error('Unexpected end of data')\n              }\n              return\n            }\n          }\n        }\n      } catch (e) {\n        console.error('[eventsAfter] Error', { lastUrl }, e)\n        // $FlowFixMe[incompatible-use]\n        eventsStreamReader?.cancel('Error during pull').catch(e2 => {\n          console.error('Error canceling underlying event stream reader on error', e, e2)\n        })\n        throw e\n      }\n    }\n  })\n  if (stream) return s\n  // Workaround for <https://bugs.webkit.org/show_bug.cgi?id=215485>\n  return collectEventStream(s)\n}\n\nexport function buildShelterAuthorizationHeader (contractID        , state         )         {\n  if (!state) state = sbp(this.config.stateSelector)[contractID]\n  const SAKid = findKeyIdByName(state, '#sak')\n  if (!SAKid) {\n    throw new Error(`Missing #sak in ${contractID}`)\n  }\n  const SAK = this.transientSecretKeys[SAKid]\n  if (!SAK) {\n    throw new Error(`Missing secret #sak (${SAKid}) in ${contractID}`)\n  }\n  const deserializedSAK = typeof SAK === 'string' ? deserializeKey(SAK) : SAK\n\n  const nonceBytes = new Uint8Array(15)\n  // $FlowFixMe[cannot-resolve-name]\n  globalThis.crypto.getRandomValues(nonceBytes)\n\n  // <contractID> <UNIX ms time>.<nonce>\n  const data = `${contractID} ${sbp('chelonia/time')}.${Buffer.from(nonceBytes).toString('base64')}`\n\n  // shelter <contractID> <UNIX time>.<nonce>.<signature>\n  return `shelter ${data}.${sign(deserializedSAK, data)}`\n}\n\nexport function verifyShelterAuthorizationHeader (authorization        , rootState         )         {\n  const regex = /^shelter (([a-zA-Z0-9]+) ([0-9]+)\\.([a-zA-Z0-9+/=]{20}))\\.([a-zA-Z0-9+/=]+)$/i\n  if (authorization.length > 1024) {\n    throw new Error('Authorization header too long')\n  }\n  const matches = authorization.match(regex)\n  if (!matches) {\n    throw new Error('Unable to parse shelter authorization header')\n  }\n  // TODO: Remember nonces and reject already used ones\n  const [, data, contractID, timestamp, , signature] = matches\n  if (Math.abs(parseInt(timestamp) - Date.now()) > 60e3) {\n    throw new Error('Invalid signature time range')\n  }\n  if (!rootState) rootState = sbp('chelonia/rootState')\n  if (!has(rootState, contractID)) {\n    throw new Error(`Contract ${contractID} from shelter authorization header not found`)\n  }\n  const SAKid = findKeyIdByName(rootState[contractID], '#sak')\n  if (!SAKid) {\n    throw new Error(`Missing #sak in ${contractID}`)\n  }\n  const SAK = rootState[contractID]._vm.authorizedKeys[SAKid].data\n  if (!SAK) {\n    throw new Error(`Missing secret #sak (${SAKid}) in ${contractID}`)\n  }\n  const deserializedSAK = deserializeKey(SAK)\n\n  verifySignature(deserializedSAK, data, signature)\n\n  return contractID\n}\n\nexport const clearObject = (o        ) => {\n  Object.keys(o).forEach((k) => delete o[k])\n}\n\nexport const reactiveClearObject = (o        , fn                                        ) => {\n  Object.keys(o).forEach((k) => fn(o, k))\n}\n\nexport const checkCanBeGarbageCollected = function (id        )          {\n  const rootState = sbp(this.config.stateSelector)\n  return (\n    // Check persistent references\n    (!has(rootState.contracts, id) || !rootState.contracts[id] || !has(rootState.contracts[id], 'references')) &&\n    // Check ephemeral references\n    !has(this.ephemeralReferenceCount, id)) &&\n    // Check foreign keys (i.e., that no keys from this contract are being watched)\n    (!has(rootState, id) || !has(rootState[id], '_volatile') || !has(rootState[id]._volatile, 'watch') || rootState[id]._volatile.watch.length === 0 || rootState[id]._volatile.watch.filter(([, cID]) => this.subscriptionSet.has(cID)).length === 0)\n}\n\nexport const collectEventStream = async (s                )                 => {\n  const reader = s.getReader()\n  const r = []\n  for (;;) {\n    const { done, value } = await reader.read()\n    if (done) break\n    r.push(value)\n  }\n  return r\n}\n\n// Used inside processing functions for displaying errors at the 'warn' level\n// for outgoing messages to increase the signal-to-noise error. See issue #2773.\nexport const logEvtError = (msg           , ...args       ) => {\n  if (msg._direction === 'outgoing') {\n    console.warn(...args)\n  } else {\n    console.error(...args)\n  }\n}\n", "'use strict'\n\nimport { DAYS_MILLIS } from '@model/contracts/shared/time.js'\nimport sbp from '@sbp/sbp'\nimport { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\nimport { encryptedOutgoingData } from '~/shared/domains/chelonia/encryptedData.js'\nimport { findKeyIdByName, findSuitableSecretKeyId } from '~/shared/domains/chelonia/utils.js'\nimport { GIErrorMissingSigningKeyError, GIErrorUIRuntimeError, LError } from '@common/common.js'\nimport { EDWARDS25519SHA512BATCH, keyId, keygen, serializeKey } from '@chelonia/crypto'\n                                                \n\nconst enqueueDeferredPromise = (queue) => {\n  let finished            = Boolean // asssigned to keep Flow happy\n  const onFinishPromise = new Promise     ((resolve) => {\n    finished = resolve\n  })\n  sbp('okTurtles.eventQueue/queueEvent', queue, () => onFinishPromise)\n\n  return finished\n}\n\n// Utility function to send encrypted actions ('chelonia/out/actionEncrypted')\n// This function covers the common case of sending an encrypted action that is\n// both encrypted with that same contract's CEK and signed with that contract's\n// CSK.\n// It takes an optional handler function, which receives a sendMessage callback\n// to emit the encrypted action when appropriate.\n// Note that this function does not currently support specifying custom encryption\n// or signing keys, and that such keys in params get overridden.\nexport const encryptedAction = (\n  action        ,\n  humanError                   ,\n  handler                                                                                                                                                                                 ,\n  encryptionKeyName         ,\n  signingKeyName         ,\n  innerSigningKeyName         \n)         => {\n  const sendMessageFactory = (outerParams                , signingKeyId        , innerSigningKeyId         , encryptionKeyId        , originatingContractID         ) => (innerParams                         )                        => {\n    const params = innerParams ?? outerParams\n    const invocation = [\n      'chelonia/out/actionEncrypted',\n      {\n        ...params,\n        signingKeyId,\n        innerSigningKeyId,\n        encryptionKeyId,\n        action: action.replace('gi.actions', 'gi.contracts'),\n        originatingContractID\n      }\n    ]\n\n    if (params.returnInvocation) {\n      return invocation\n    } else {\n      return sbp(...invocation)\n    }\n  }\n  return {\n    [action]: async function (params                ) {\n      const contractID = params.contractID\n      if (!contractID) {\n        throw new Error('Missing contract ID')\n      }\n      const rootState = sbp('chelonia/rootState')\n      if (rootState.contracts[contractID] === null) {\n        console.warn(`[${action}] Contract is marked as permamently deleted, aborting`, contractID)\n        throw new Error('Contract permanently deleted: ' + contractID)\n      }\n\n      // The following ensures that logging out waits until all pending actions\n      // are written\n      const finished = enqueueDeferredPromise('encrypted-action')\n\n      let retainFailed = false\n      try {\n        // Writing to a contract requires being subscribed to it\n        // Since we're only interested in writing and we don't know whether\n        // we're subscribed or should be, we use an ephemeral retain here that\n        // is undone at the end in a finally block.\n        await sbp('chelonia/contract/retain', contractID, { ephemeral: true }).catch(e => {\n          // We use `retainFailed` because the `finally` block should only\n          // release when `retain` succeeded. Moving the `retain` call outside\n          // of the `try` block would have the same effect but would require\n          // duplicating the error handler.\n          retainFailed = true\n          throw e\n        })\n        const state = {\n          [contractID]: await sbp('chelonia/latestContractState', contractID)\n        }\n        const rootState = sbp('chelonia/rootState')\n\n        // Default signingContractID is the current contract\n        const signingContractID = params.signingContractID || contractID\n        if (!state[signingContractID]) {\n          state[signingContractID] = await sbp('chelonia/latestContractState', signingContractID)\n        }\n\n        // Default innerSigningContractID is the current logged in identity\n        // contract ID, unless we are signing for the current identity contract\n        // If params.innerSigningContractID is explicitly set to null, then\n        // no default value will be used.\n        const innerSigningContractID = params.innerSigningContractID !== undefined\n          ? params.innerSigningContractID\n          : contractID === rootState.loggedIn.identityContractID\n            ? null\n            : rootState.loggedIn.identityContractID\n\n        if (innerSigningContractID && !state[innerSigningContractID]) {\n          state[innerSigningContractID] = await sbp('chelonia/latestContractState', innerSigningContractID)\n        }\n\n        const signingKeyId = params.signingKeyId || findKeyIdByName(state[signingContractID], signingKeyName ?? 'csk')\n        // Inner signing key ID:\n        //  (1) If params.innerSigningKeyId is set, honor it\n        //      (a) If it's null, then no inner signature will be used\n        //      (b) If it's undefined, it's treated the same as if it's not set\n        //  (2) If params.innerSigningKeyId is not set:\n        //      (a) If innerSigningContractID is not set, then no inner\n        //          signature will be used\n        //      (b) Else, use the key by name `innerSigningKeyName` in\n        //          `innerSigningContractID`\n\n        const innerSigningKeyId = params.innerSigningKeyId || (\n          params.innerSigningKeyId !== null &&\n          innerSigningContractID &&\n          findKeyIdByName(state[innerSigningContractID], innerSigningKeyName ?? 'csk')\n        )\n        const encryptionKeyId = params.encryptionKeyId || findKeyIdByName(state[contractID], encryptionKeyName ?? 'cek')\n\n        if (!signingKeyId || !encryptionKeyId || !await sbp('chelonia/haveSecretKey', signingKeyId)) {\n          console.warn(`Refusing to send action ${action} due to missing CSK or CEK`, { contractID, action, signingKeyName, encryptionKeyName, signingKeyId, encryptionKeyId, signingContractID: params.signingContractID, originatingContractID: params.originatingContractID })\n          throw new GIErrorMissingSigningKeyError(`No key found to send ${action} for contract ${contractID}`)\n        }\n\n        if (innerSigningContractID && (!innerSigningKeyId || !await sbp('chelonia/haveSecretKey', innerSigningKeyId))) {\n          console.warn(`Refusing to send action ${action} due to missing inner signing key ID`, { contractID, action, signingKeyName, encryptionKeyName, signingKeyId, encryptionKeyId, signingContractID: params.signingContractID, originatingContractID: params.originatingContractID, innerSigningKeyId })\n          throw new GIErrorMissingSigningKeyError(`No key found to send ${action} for contract ${contractID}`)\n        }\n\n        const sm = sendMessageFactory(params, signingKeyId, innerSigningKeyId || null, encryptionKeyId, params.originatingContractID)\n\n        // make sure to await here so that if there's an error we show user-facing string\n        if (handler) {\n          return await handler(sm, params, signingKeyId, encryptionKeyId, params.originatingContractID)\n        } else {\n          return await sm()\n        }\n      } catch (e) {\n        const userFacingErrStr = typeof humanError === 'string'\n          ? `${humanError} ${LError(e).reportError}`\n          : humanError(params, e)\n        throw new GIErrorUIRuntimeError(userFacingErrStr, { cause: e })\n      } finally {\n        finished()\n        if (!retainFailed) {\n          await sbp('chelonia/contract/release', contractID, { ephemeral: true })\n        }\n      }\n    }\n  }\n}\n\nexport const encryptedNotification = (\n  action        ,\n  humanError                   ,\n  handler                                                                                                                                                                                 ,\n  encryptionKeyName         ,\n  signingKeyName         ,\n  innerSigningKeyName         \n)         => {\n  const sendMessageFactory = (outerParams                , signingKeyId        , innerSigningKeyId         , encryptionKeyId        , originatingContractID         ) => (innerParams                         )                        => {\n    const params = innerParams ?? outerParams\n\n    const actionReplaced = action.replace('gi.actions', 'gi.contracts')\n\n    return sbp('chelonia/out/encryptedOrUnencryptedPubMessage', {\n      contractID: params.contractID,\n      contractName: actionReplaced.split('/', 2).join('/'),\n      innerSigningKeyId,\n      encryptionKeyId,\n      signingKeyId,\n      data: [actionReplaced, params.data]\n    })\n  }\n  return {\n    [action]: async function (params                ) {\n      const contractID = params.contractID\n      if (!contractID) {\n        throw new Error('Missing contract ID')\n      }\n\n      try {\n        // Writing to a contract requires being subscribed to it\n        await sbp('chelonia/contract/retain', contractID, { ephemeral: true })\n        const state = {\n          [contractID]: await sbp('chelonia/latestContractState', contractID)\n        }\n        const rootState = sbp('chelonia/rootState')\n\n        // Default signingContractID is the current contract\n        const signingContractID = params.signingContractID || contractID\n        if (!state[signingContractID]) {\n          state[signingContractID] = await sbp('chelonia/latestContractState', signingContractID)\n        }\n\n        // Default innerSigningContractID is the current logged in identity\n        // contract ID, unless we are signing for the current identity contract\n        // If params.innerSigningContractID is explicitly set to null, then\n        // no default value will be used.\n        const innerSigningContractID = params.innerSigningContractID !== undefined\n          ? params.innerSigningContractID\n          : contractID === rootState.loggedIn.identityContractID\n            ? null\n            : rootState.loggedIn.identityContractID\n\n        if (innerSigningContractID && !state[innerSigningContractID]) {\n          state[innerSigningContractID] = await sbp('chelonia/latestContractState', innerSigningContractID)\n        }\n\n        const signingKeyId = params.signingKeyId || findKeyIdByName(state[signingContractID], signingKeyName ?? 'csk')\n        // Inner signing key ID:\n        //  (1) If params.innerSigningKeyId is set, honor it\n        //      (a) If it's null, then no inner signature will be used\n        //      (b) If it's undefined, it's treated the same as if it's not set\n        //  (2) If params.innerSigningKeyId is not set:\n        //      (a) If innerSigningContractID is not set, then no inner\n        //          signature will be used\n        //      (b) Else, use the key by name `innerSigningKeyName` in\n        //          `innerSigningContractID`\n\n        const innerSigningKeyId = params.innerSigningKeyId || (\n          params.innerSigningKeyId !== null &&\n          innerSigningContractID &&\n          findKeyIdByName(state[innerSigningContractID], innerSigningKeyName ?? 'csk')\n        )\n        const encryptionKeyId = params.encryptionKeyId || findKeyIdByName(state[contractID], encryptionKeyName ?? 'cek')\n\n        if (!signingKeyId || !encryptionKeyId || !await sbp('chelonia/haveSecretKey', signingKeyId)) {\n          console.warn(`Refusing to send action ${action} due to missing CSK or CEK`, { contractID, action, signingKeyName, encryptionKeyName, signingKeyId, encryptionKeyId, signingContractID: params.signingContractID, originatingContractID: params.originatingContractID })\n          throw new GIErrorMissingSigningKeyError(`No key found to send ${action} for contract ${contractID}`)\n        }\n\n        if (innerSigningContractID && (!innerSigningKeyId || !await sbp('chelonia/haveSecretKey', innerSigningKeyId))) {\n          console.warn(`Refusing to send action ${action} due to missing inner signing key ID`, { contractID, action, signingKeyName, encryptionKeyName, signingKeyId, encryptionKeyId, signingContractID: params.signingContractID, originatingContractID: params.originatingContractID, innerSigningKeyId })\n          throw new GIErrorMissingSigningKeyError(`No key found to send ${action} for contract ${contractID}`)\n        }\n\n        const sm = sendMessageFactory(params, signingKeyId, innerSigningKeyId || null, encryptionKeyId, params.originatingContractID)\n\n        // make sure to await here so that if there's an error we show user-facing string\n        if (handler) {\n          return await handler(sm, params, signingKeyId, encryptionKeyId, params.originatingContractID)\n        } else {\n          return await sm()\n        }\n      } catch (e) {\n        const userFacingErrStr = typeof humanError === 'string'\n          ? `${humanError} ${LError(e).reportError}`\n          : humanError(params, e)\n        throw new GIErrorUIRuntimeError(userFacingErrStr, { cause: e })\n      } finally {\n        await sbp('chelonia/contract/release', contractID, { ephemeral: true })\n      }\n    }\n  }\n}\n\nexport async function createInvite ({ contractID, quantity = 1, creatorID, expires, invitee }   \n                                                                                             \n )                                                                        {\n  const state = await sbp('chelonia/contract/state', contractID)\n\n  if (\n    !state ||\n    !state._vm ||\n    !findSuitableSecretKeyId(state, '*', ['sig']) ||\n    state._volatile?.pendingKeyRequests?.length\n  ) {\n    throw new Error('Invalid or missing current group state')\n  }\n\n  const CEKid = findKeyIdByName(state, 'cek')\n  const CSKid = findKeyIdByName(state, 'csk')\n\n  if (!CEKid || !CSKid) {\n    throw new Error('Contract is missing a CEK or CSK')\n  }\n\n  const inviteKey = keygen(EDWARDS25519SHA512BATCH)\n  const inviteKeyId = keyId(inviteKey)\n  const inviteKeyP = serializeKey(inviteKey, false)\n  const inviteKeyS = encryptedOutgoingData(state, CEKid, serializeKey(inviteKey, true))\n\n  await sbp('chelonia/out/keyAdd', {\n    contractID,\n    contractName: 'gi.contracts/group',\n    data: [{\n      id: inviteKeyId,\n      name: '#inviteKey-' + inviteKeyId,\n      purpose: ['sig'],\n      ringLevel: Number.MAX_SAFE_INTEGER,\n      permissions: [SPMessage.OP_KEY_REQUEST],\n      meta: {\n        quantity,\n        expires: Date.now() + DAYS_MILLIS * expires,\n        private: {\n          content: inviteKeyS\n        }\n      },\n      data: inviteKeyP\n    }],\n    signingKeyId: CSKid\n  })\n\n  return {\n    inviteKeyId,\n    creatorID,\n    invitee\n  }\n}\n\nexport function groupContractsByType (contracts         )         {\n  const contractIDs = Object.create(null)\n  if (contracts) {\n    // Note: `references` holds non-ephemeral references (i.e., explicit\n    // calls to `retain` without `{ ephemeral: true }`). These are the contracts\n    // that we want to restore.\n    // Apart from non-ephemeral references, `references` may not be set for\n    // contracts being 'watched' for foreign keys. The latter are managed\n    // directly by Chelonia, so we also don't subscribe to them\n    // $FlowFixMe[incompatible-use]\n    Object.entries(contracts)\n      .filter(([id, value]) => !!value)\n      // $FlowFixMe[incompatible-use]\n      .forEach(([id, { references, type }]) => {\n      // If the contract wasn't explicitly retained, skip it\n      // NB! Ignoring `references` could result in an exception being thrown, as\n      // as `sync` may only be called on contracts for which a reference count\n      // exists.\n        if (!references) return\n        if (!contractIDs[type]) {\n          contractIDs[type] = []\n        }\n        contractIDs[type].push(id)\n      })\n  }\n  return contractIDs\n}\n\nexport async function syncContractsInOrder (groupedContractIDs        )               {\n  // We need to sync contracts in this order to ensure that we have all the\n  // corresponding secret keys. Group chatrooms use group keys but there's\n  // no OP_KEY_SHARE, which will result in the keys not being available when\n  // the group keys are rotated.\n  // TODO: This functionality could be moved into Chelonia by keeping track\n  // of when secret keys without OP_KEY_SHARE become available.\n  const contractSyncPriorityList = [\n    'gi.contracts/identity',\n    'gi.contracts/group',\n    'gi.contracts/chatroom'\n  ]\n  const getContractSyncPriority = (key) => {\n    const index = contractSyncPriorityList.indexOf(key)\n    return index === -1 ? contractSyncPriorityList.length : index\n  }\n  const failedSyncs = []\n  try {\n    const sortedContractTypes = Object.entries(groupedContractIDs).sort(([a], [b]) => {\n      return getContractSyncPriority(a) - getContractSyncPriority(b)\n    })\n    for (const [type, contractIDs] of sortedContractTypes) {\n      // For each contract of this type, check if it still exists before syncing because\n      // e.g. syncing a group contract could have removed one of the chatroom contracts\n      // $FlowFixMe[incompatible-type]\n      for (const contractID of contractIDs) {\n        const { contracts } = sbp('chelonia/rootState')\n        if (contractID in contracts) {\n          try {\n            await sbp('chelonia/contract/sync', contractID)\n          } catch (e) {\n            console.error(`syncContractsInOrder: failed to sync ${type}(${contractID}):`, e)\n            if (e.name === 'ChelErrorResourceGone') {\n              console.info('[syncContractsInOrder] Contract ID ' + contractID + ' has been deleted')\n              sbp('chelonia/contract/remove', contractID, { permanent: true }).catch(e => {\n                console.error('[syncContractsInOrder] Error handling contract deletion', e)\n              })\n            } else {\n              failedSyncs.push(`${type}(\u2026${contractID.slice(-5)}) failed sync with '${e.message}'`)\n            }\n          }\n        } else {\n          console.warn(`syncContractsInOrder: skipping ${type}(${contractID}) as it was removed while syncing previous contracts`)\n        }\n      }\n    }\n    if (failedSyncs.length > 0) throw new Error(failedSyncs.join(', '))\n  } catch (err) {\n    console.error('Error during contract sync (syncing all contractIDs)', err)\n    throw err\n  }\n}\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport { L } from '@common/common.js'\nimport {\n  MESSAGE_TYPES,\n  POLL_STATUS,\n  PROPOSAL_GROUP_SETTING_CHANGE,\n  PROPOSAL_INVITE_MEMBER,\n  PROPOSAL_REMOVE_MEMBER,\n  PROPOSAL_PROPOSAL_SETTING_CHANGE,\n  PROPOSAL_GENERIC,\n  CHATROOM_MEMBER_MENTION_SPECIAL_CHAR\n} from './constants.js'\nimport { NEW_CHATROOM_UNREAD_POSITION } from '@utils/events.js'\nimport { humanDate } from './time.js'\n\n// !!!!!!!!!!!!!!!\n// !! IMPORTANT !!\n// !!!!!!!!!!!!!!!\n//\n// DO NOT CHANGE THE LOGIC TO ANY OF THESE FUNCTIONS!\n// INSTEAD, CREATE NEW FUNCTIONS WITH DIFFERENT NAMES\n// AND USE THOSE INSTEAD!\n//\n// THIS IS A CONSEQUENCE OF SHARING THIS CODE WITH THE REST OF THE APP.\n// IF YOU DO NOT NEED TO SHARE CODE WITH THE REST OF THE APP (AND CAN\n// KEEP IT WITHIN THE CONTRACT ONLY), THEN YOU DON'T NEED TO WORRY ABOUT\n// THIS, AND SHOULD INCLUDE THOSE FUNCTIONS (WITHOUT EXPORTING THEM),\n// DIRECTLY IN YOUR CONTRACT DEFINITION FILE. THEN YOU CAN MODIFY\n// THEM AS MUCH AS YOU LIKE (and generate new contract versions out of them).\n\n// group.js related\n\nexport function paymentHashesFromPaymentPeriod (periodPayments        )           {\n  let hashes = []\n  if (periodPayments) {\n    const { paymentsFrom } = periodPayments\n    for (const fromMemberID in paymentsFrom) {\n      for (const toMemberID in paymentsFrom[fromMemberID]) {\n        hashes = hashes.concat(paymentsFrom[fromMemberID][toMemberID])\n      }\n    }\n  }\n\n  return hashes\n}\n\nexport function createPaymentInfo (paymentHash        , payment        )   \n                                                                                                       \n  {\n  return {\n    fromMemberID: payment.data.fromMemberID,\n    toMemberID: payment.data.toMemberID,\n    hash: paymentHash,\n    amount: payment.data.amount,\n    isLate: !!payment.data.isLate,\n    when: payment.data.completedDate\n  }\n}\n\nexport function getProposalDetails (proposal        )         {\n  const { creatorID, status } = proposal\n  const { proposalType, proposalData } = proposal.data\n\n  const settingsTranslationMap = {\n    'mincomeAmount': L('mincome'),\n    'distributionDate': L('distribution date'),\n    'votingSystem': L('voting system'),\n    'votingRule': L('voting rules')\n  }\n  const options = {}\n  if (proposalType === PROPOSAL_PROPOSAL_SETTING_CHANGE) {\n    if (proposalData.ruleName !== proposalData.current.ruleName) {\n      options['settingType'] = 'votingSystem'\n    } else if (proposalData.ruleThreshold !== proposalData.current.ruleThreshold) {\n      options['settingType'] = 'votingRule'\n    }\n  } else if (proposalType === PROPOSAL_GROUP_SETTING_CHANGE) {\n    options['settingType'] = proposalData.setting\n  } else if (proposalType === PROPOSAL_GENERIC) {\n    options['title'] = proposalData.name\n  } else if (proposalType === PROPOSAL_INVITE_MEMBER) {\n    options['member'] = proposalData.memberName\n  } else if (proposalType === PROPOSAL_REMOVE_MEMBER) {\n    options['memberID'] = proposalData.memberID\n    // options['member'] is not set as it's part of external state. The code\n    // responsible for notifications (`frontend/model/notifications/templates.js`)\n    // will set it\n  }\n\n  const { proposedValue } = proposalData\n  if (proposedValue) {\n    if (options.settingType === 'distributionDate') {\n      options['value'] = humanDate(proposedValue, { month: 'long', year: 'numeric', day: 'numeric' })\n    } else {\n      options['value'] = proposedValue\n    }\n  }\n  if (options.settingType) {\n    options['setting'] = settingsTranslationMap[options.settingType]\n  }\n\n  return { creatorID, status, type: proposalType, options }\n}\n\n// chatroom.js related\n\nexport function createMessage ({ meta, data, hash, height, state, pending, innerSigningContractID }   \n               \n               \n               \n                 \n                 \n                    \n                                 \n )         {\n  const { type, text, replyingMessage, attachments } = data\n  const { createdDate } = meta\n\n  const newMessage      = {\n    type,\n    hash,\n    height,\n    from: innerSigningContractID,\n    datetime: new Date(createdDate).toISOString()\n  }\n\n  if (pending) {\n    newMessage.pending = true\n  }\n\n  if (type === MESSAGE_TYPES.TEXT) {\n    newMessage.text = text\n    if (replyingMessage) {\n      newMessage.replyingMessage = replyingMessage\n    }\n    if (attachments) {\n      newMessage.attachments = attachments\n    }\n  } else if (type === MESSAGE_TYPES.POLL) {\n    newMessage.pollData = {\n      ...data.pollData,\n      creatorID: innerSigningContractID,\n      status: POLL_STATUS.ACTIVE,\n      // 'voted' field below will contain the user names of the users who has voted for this option\n      options: data.pollData.options.map(opt => ({ ...opt, voted: [] }))\n    }\n  } else if (type === MESSAGE_TYPES.NOTIFICATION) {\n    const params = {\n      channelName: state?.attributes.name,\n      channelDescription: state?.attributes.description,\n      ...data.notification\n    }\n    delete params.type\n    newMessage.notification = { type: data.notification.type, params }\n  } else if (type === MESSAGE_TYPES.INTERACTIVE) {\n    newMessage.proposal = data.proposal\n  }\n  return newMessage\n}\n\nexport async function postLeaveChatRoomCleanup (contractID        , state        ) {\n  if (await sbp('chelonia/contract/isSyncing', contractID, { firstSync: true })) {\n    return\n  }\n\n  sbp('gi.actions/identity/kv/deleteChatRoomUnreadMessages', { contractID }).catch((e) => {\n    console.error('[leaveChatroom] Error at deleteChatRoomUnreadMessages ', contractID, e)\n  })\n  sbp('okTurtles.events/emit', NEW_CHATROOM_UNREAD_POSITION, { chatRoomID: contractID })\n  // NOTE: The contract that keeps track of chatrooms should now call `/release`\n  // This would be the group contract (for group chatrooms) or the identity\n  // contract (for DMs).\n}\n\nexport function findMessageIdx (hash        , messages                = [])         {\n  for (let i = messages.length - 1; i >= 0; i--) {\n    if (messages[i].hash === hash) {\n      return i\n    }\n  }\n  return -1\n}\n\nexport function makeMentionFromUserID (userID        )   \n                         \n  {\n  return {\n    me: userID ? `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${userID}` : '',\n    all: `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}all`\n  }\n}\n\n// The `referenceTally` function is meant as an utility function to handle\n// reference counting in contracts that import other contracts.\n// The selector returned is to be called in side-effects that 'retain' or\n// 'release' other contracts, and it works by pushing a single callback into\n// the contract queue that maintains a temporary reference count to be applied\n// at the end of a chain processing events.\n// For example, a chatroom supports the 'join' and 'leave' actions, and those\n// call 'retain' or 'release', respectively, on the identity contracts of\n// members.\n// Now, imagine this sequence of events: `[join, leave, join, leave]` (all\n// involving the same member).\n// Imagine all actions are processed at once (for example, the chatroom is being\n// synced from scratch). By calling the `referenceTally` selector, this would\n// happen in the event queue:\n//   queue slot 0: [sync]:\n//        (join)    event 0: [process]\n//                  event 0: [sideEffect]: this calls `referenceTally`, which\n//                             increases the temp count to 1 and pushes a\n//                             function into the queue.\n//        (leave)   event 1: [process]\n//                  event 1: [sideEffect]: this calls `referenceTally`, which\n//                             decreases the temp count to 0. No function is\n//                             pushed into the queue as one already exists.\n//        (join)    event 2: [process]\n//                  event 2: [sideEffect]: this calls `referenceTally`, which\n//                             increases the temp count to 1. No function is\n//                             pushed into the queue as one already exists.\n//        (leave)   event 3: [process]\n//                  event 3: [sideEffect]: this calls `referenceTally`, which\n//                             decreases the temp count to 0. No function is\n//                             pushed into the queue as one already exists.\n//   queue slot 1: [referenceTally]: Function pushed onto the queue by event 0.\n//                              Since the temp count is 0, no call to retain\n//                              or release happens.\n//\n// Now, imagine a different scenario, where the same events happen but they are\n// processed differently. Let's say that the grouping is:\n//    1. [join, leave]\n//    2. [join]\n//    3. [leave]\n// This situation could happen when syncing the chatroom from scratch (with\n// only the first two events having happened at this point in time) with the\n// other events being received over the web socket later.\n//   queue slot 0: [sync]:\n//        (join)    event 0: [process]\n//                  event 0: [sideEffect]: this calls `referenceTally`, which\n//                             increases the temp count to 1 and pushes a\n//                             function into the queue.\n//        (leave)   event 1: [process]\n//                  event 1: [sideEffect]: this calls `referenceTally`, which\n//                             decreases the temp count to 0. No function is\n//                             pushed into the queue as one already exists.\n//   queue slot 1: [referenceTally]: Function pushed onto the queue by event 0.\n//                              Since the temp count is 0, no call to retain\n//                              or release happens.\n//   queue slot 2: [sync]:\n//        (join)    event 2: [process]\n//                  event 2: [sideEffect]: this calls `referenceTally`, which\n//                             increases the temp count to and pushes a\n//                             function into the queue.\n//   queue slot 3: [referenceTally]: Function pushed onto the queue by event 2.\n//                              Since the temp count is 1, retain is called.\n//   queue slot 4: [sync]:\n//        (leave)   event 3: [process]\n//                  event 3: [sideEffect]: this calls `referenceTally`, which\n//                             decreases the temp count to -1 and pushes a\n//                             function into the queue.\n//   queue slot 5: [referenceTally]: Function pushed onto the queue by event 3.\n//                              Since the temp count is -1, release is called.\nexport const referenceTally = (selector        )         => {\n  const delta = {\n    'retain': 1,\n    'release': -1\n  }\n  return {\n    [selector]: (parentContractID        , childContractIDs                   , op                      ) => {\n      if (!Array.isArray(childContractIDs)) childContractIDs = [childContractIDs]\n      if (op !== 'retain' && op !== 'release') throw new Error('Invalid operation')\n      for (const childContractID of childContractIDs) {\n        const key = `${selector}-${parentContractID}-${childContractID}`\n        const count = sbp('okTurtles.data/get', key)\n        sbp('okTurtles.data/set', key, (count || 0) + delta[op])\n        if (count != null) return\n        sbp('chelonia/queueInvocation', parentContractID, () => {\n          const count = sbp('okTurtles.data/get', key)\n          sbp('okTurtles.data/delete', key)\n          if (count && count !== Math.sign(count)) {\n            console.warn(`[${selector}] Unexpected value`, parentContractID, childContractID, count)\n            // If we're running tests, we enforce checking that the temporary\n            // count _must_ be either of 0, 1 or -1. This is a correct\n            // assumption, based on the fact that a single contract should only\n            // call retain or release at most once after all operations are\n            // processed, per chunk of operations (e.g., there is no valid\n            // reason for a group contract to call `retain` twice on the same\n            // contract ID, without having called `release` first).\n            // This rule (or assumption) also applies to non-CI environments,\n            // but we are more lax in this case to allow for more leniency when\n            // running contracts with real users. However, this type of error\n            // indicates faulty reference bookkeeping that must be corrected.\n            if (process.env.CI) {\n              Promise.reject(new Error(`[${selector}] Unexpected value ${parentContractID} ${childContractID}: ${count}`))\n            }\n          }\n          switch (Math.sign(count)) {\n            case -1:\n              sbp('chelonia/contract/release', childContractID).catch(e => {\n                console.error(`[${selector}] Error calling release`, parentContractID, childContractID, e)\n              })\n              break\n            case 1:\n              sbp('chelonia/contract/retain', childContractID).catch(e => console.error(`[${selector}] Error calling retain`, parentContractID, childContractID, e))\n              break\n          }\n        }).catch(e => {\n          console.error(`[${selector}] Error in queued invocation`, parentContractID, childContractID, e)\n        })\n      }\n    }\n  }\n}\n", "'use strict'\nimport sbp from '@sbp/sbp'\nimport { makeMentionFromUserID } from '@model/contracts/shared/functions.js'\nimport {\n  CHATROOM_CHANNEL_MENTION_SPECIAL_CHAR,\n  CHATROOM_MEMBER_MENTION_SPECIAL_CHAR\n} from '@model/contracts/shared/constants.js'\n\nexport function makeChannelMention (str        , withId          = false)         {\n  return `${CHATROOM_CHANNEL_MENTION_SPECIAL_CHAR}${withId ? ':chatID:' : ''}${str}`\n}\n\nexport function getIdFromChannelMention (str        )         {\n  return str.includes(':chatID:')\n    ? str.split(':chatID:')[1]\n    : ''\n}\n\nexport function swapMentionIDForDisplayname (\n  text        ,\n  options         = {\n    escaped: true, // this indicates that the text contains escaped characters\n    forChat: true // this indicates that the function is being used for messages inside chatroom\n  }\n)         {\n  const {\n    getChatroomNameById,\n    usernameFromID,\n    userDisplayNameFromID\n  } = sbp('state/vuex/getters')\n  const { reverseNamespaceLookups } = sbp('state/vuex/state')\n  const possibleMentions = [\n    ...Object.keys(reverseNamespaceLookups).map(u => makeMentionFromUserID(u).me).filter(v => !!v),\n    makeChannelMention('[^\\\\s]+', true) // chat-mention as contractID has a format of `#:chatID:...`. So target them as a pattern instead of the exact strings.\n  ]\n\n  const { escaped, forChat } = options\n  const regEx = escaped\n    ? new RegExp(`(?<=\\\\s|^)(${possibleMentions.join('|')})(?=[^\\\\w\\\\d]|$)`)\n    : new RegExp(`(${possibleMentions.join('|')})`)\n\n  const swap = (t) => {\n    if (t.startsWith(CHATROOM_MEMBER_MENTION_SPECIAL_CHAR)) {\n      // swap member mention\n      const userID = t.slice(1)\n      const prefix = forChat ? CHATROOM_MEMBER_MENTION_SPECIAL_CHAR : ''\n      const body = forChat ? usernameFromID(userID) : userDisplayNameFromID(userID)\n      return prefix + body\n    } else if (t.startsWith(CHATROOM_CHANNEL_MENTION_SPECIAL_CHAR)) {\n      // swap channel mention\n      const channelID = getIdFromChannelMention(t)\n      const prefix = forChat ? CHATROOM_CHANNEL_MENTION_SPECIAL_CHAR : ''\n      return prefix + getChatroomNameById(channelID)\n    }\n    return t\n  }\n\n  return text\n    .split(regEx)\n    .map(t => regEx.test(t) ? swap(t) : t)\n    .join('')\n}\n\n// This function serves two purposes, depending on the forceUsername parameter\n// If forceUsername is true, mentions will be like @username, @all, for display\n// purposes.\n// If forceUsername is false (default), mentions like @username will be converted\n// to @<userID>, for internal representation purposes.\n// forceUsername is used for display purposes in the UI, so that we can show\n// a mention like @username instead of @userID in SendArea\nexport function makeMentionFromUsername (username        , forceUsername          )   \n                           \n    {\n  const rootGetters = sbp('state/vuex/getters')\n  // Even if forceUsername is true, we want to look up the contract ID to ensure\n  // that it exists, so that we know it'll later succeed.\n  const userID = rootGetters.ourContactProfilesByUsername[username]?.contractID\n  return makeMentionFromUserID(forceUsername && userID ? username : userID)\n}\n\nexport { makeMentionFromUserID }\n", "'use strict'\n\nimport { L } from '@common/common.js'\nimport sbp from '@sbp/sbp'\nimport {\n  CHATROOM_PRIVACY_LEVEL,\n  MESSAGE_NOTIFY_SETTINGS,\n  MESSAGE_RECEIVE,\n  MESSAGE_TYPES\n} from '@model/contracts/shared/constants.js'\nimport {\n  swapMentionIDForDisplayname\n} from '@model/chatroom/utils.js'\nimport { makeNotification } from './nativeNotification.js'\n\nasync function messageReceivePostEffect ({\n  contractID, messageHash, height, text,\n  isDMOrMention, messageType, memberID, chatRoomName\n}   \n                       \n                        \n                   \n                 \n                        \n                           \n                     \n                        \n   )                {\n  const rootGetters = await sbp('state/vuex/getters')\n  const rootState = await sbp('state/vuex/state')\n  const identityContractID = rootState.loggedIn?.identityContractID\n  if (!identityContractID) return\n  const isDM = rootState[identityContractID].chatRooms[contractID]\n  const shouldAddToUnreadMessages = isDMOrMention || [MESSAGE_TYPES.INTERACTIVE, MESSAGE_TYPES.POLL].includes(messageType)\n\n  await sbp('chelonia/contract/retain', contractID, { ephemeral: true })\n  try {\n    if (shouldAddToUnreadMessages) {\n      sbp('gi.actions/identity/kv/addChatRoomUnreadMessage', { contractID, messageHash, createdHeight: height }).catch(e => {\n        console.error('[messageReceivePostEffect] Error calling addChatRoomUnreadMessage', e)\n      })\n    }\n\n    /*\n    // TODO: This needs to be done differently in the SW\n    const currentRoute = sbp('controller/router').history.current || ''\n    const isTargetChatroomCurrentlyActive = currentRoute.path.includes('/group-chat') &&\n  rootGetters.currentChatRoomId === contractID // when the target chatroom is currently open/active on the browser, No need to send a notification.\n    if (isTargetChatroomCurrentlyActive) return // Skip notifications\n    // END TODO: This needs to be done differently in the SW\n    */\n\n    let title = `# ${chatRoomName}`\n    let icon\n    if (isDM) {\n    // NOTE: partner identity contract could not be synced yet\n      const members = rootState[contractID].members\n      const membersList = Object.keys(members)\n      const isDMToMyself = membersList.length === 1 && membersList[0] === identityContractID\n      const partnersList = membersList\n        .filter(memberID => memberID !== identityContractID)\n        .sort((p1, p2) => {\n          const p1JoinedDate = new Date(members[p1].joinedDate).getTime()\n          const p2JoinedDate = new Date(members[p2].joinedDate).getTime()\n          return p1JoinedDate - p2JoinedDate\n        })\n      const lastJoinedPartner = isDMToMyself ? identityContractID : partnersList[partnersList.length - 1]\n\n      title = isDMToMyself\n        ? rootGetters.userDisplayNameFromID(identityContractID)\n        : partnersList.map(cID => rootGetters.userDisplayNameFromID(cID)).join(', ')\n      icon = rootGetters.ourContactProfilesById[lastJoinedPartner]?.picture\n    } else {\n      icon = rootGetters.ourContactProfilesById[memberID]?.picture\n    }\n    const path = `/group-chat/${contractID}`\n\n    const privacyLevelPrivate = rootState[contractID]?.attributes?.privacyLevel === CHATROOM_PRIVACY_LEVEL.PRIVATE\n    const chatNotificationSettings = rootGetters.chatNotificationSettings[contractID] || (privacyLevelPrivate\n      ? rootGetters.chatNotificationSettings.privateDefault\n      : rootGetters.chatNotificationSettings.publicDefault\n    )\n    const { messageNotification, messageSound } = chatNotificationSettings\n\n    // If the contract is syncing (meaning we're loading the app, joining a\n    // chatroom, etc.), don't use a native notification or sound. Do this only\n    // for messages coming over the WS.\n    // This may not be 100% reliable, but `firstSync` should make it work in\n    // most cases.\n    const isSyncing = sbp('chelonia/contract/isSyncing', contractID, { firstSync: true })\n    // TODO: This could be an issue (false positive for emitting a native\n    // notification) when the initial sync gets interrupted (e.g., network issues)\n    // and then resumed.\n    // In this case, we may get sound notifications for old events that we\n    // should not, because technically it's not the first sync.\n    if (isSyncing) return\n\n    const shouldNotifyMessage = messageNotification === MESSAGE_NOTIFY_SETTINGS.ALL_MESSAGES ||\n      (messageNotification === MESSAGE_NOTIFY_SETTINGS.DIRECT_MESSAGES && isDMOrMention)\n    const shouldSoundMessage = messageSound === MESSAGE_NOTIFY_SETTINGS.ALL_MESSAGES ||\n      (messageSound === MESSAGE_NOTIFY_SETTINGS.DIRECT_MESSAGES && isDMOrMention)\n\n    shouldNotifyMessage && makeNotification({\n      title,\n      body: messageType === MESSAGE_TYPES.TEXT ? swapMentionIDForDisplayname(text) : L('New message'),\n      icon,\n      path\n    })\n    // `MESSAGE_RECEIVE` should be forwarded to the tab\n    shouldSoundMessage && sbp('okTurtles.events/emit', MESSAGE_RECEIVE, {\n      contractID,\n      messageHash,\n      messageType\n    })\n  } finally {\n    await sbp('chelonia/contract/release', contractID, { ephemeral: true })\n  }\n}\n\nexport default messageReceivePostEffect\n", "'use strict'\nimport sbp from '@sbp/sbp'\n\nimport { CURVE25519XSALSA20POLY1305, EDWARDS25519SHA512BATCH, deserializeKey, keyId, keygen, serializeKey } from '@chelonia/crypto'\nimport { GIErrorUIRuntimeError, L } from '@common/common.js'\nimport { CHATROOM_TYPES, MESSAGE_RECEIVE_RAW, MESSAGE_TYPES } from '@model/contracts/shared/constants.js'\nimport { has, omit } from 'turtledash'\nimport { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\nimport { Secret } from '~/shared/domains/chelonia/Secret.js'\nimport { encryptedOutgoingData, encryptedOutgoingDataWithRawKey } from '~/shared/domains/chelonia/encryptedData.js'\n                                             \nimport { encryptedAction, encryptedNotification } from './utils.js'\nimport { makeMentionFromUserID } from '@model/chatroom/utils.js'\nimport messageReceivePostEffect from '@model/notifications/messageReceivePostEffect.js'\n\nsbp('okTurtles.events/on', MESSAGE_RECEIVE_RAW, ({\n  contractID,\n  data,\n  innerSigningContractID,\n  // If newMessage is undefined, it means that an existing message is being edited\n  newMessage\n}) => {\n  const state = sbp('chelonia/contract/state', contractID)\n  const rootState = sbp('chelonia/rootState')\n  const getters = sbp('state/vuex/getters')\n  const mentions = makeMentionFromUserID(rootState.loggedIn?.identityContractID)\n  const msgData = newMessage || data\n  const isMentionedMe = (!!newMessage || data.type === MESSAGE_TYPES.TEXT) && msgData.text &&\n  (msgData.text.includes(mentions.me) || msgData.text.includes(mentions.all))\n\n  if (!newMessage) {\n    const isAlreadyAdded = !!getters\n      .chatRoomUnreadMessages(contractID).find(m => m.messageHash === data.hash)\n\n    if (isAlreadyAdded && !isMentionedMe) {\n      sbp('gi.actions/identity/kv/removeChatRoomUnreadMessage', { contractID, messageHash: data.hash }).catch(e => {\n        console.error('[MESSAGE_RECEIVE_RAW handler] Error calling removeChatRoomUnreadMessage', e)\n      })\n    }\n    if (isAlreadyAdded) return\n  }\n\n  messageReceivePostEffect({\n    contractID,\n    messageHash: msgData.hash,\n    height: msgData.height,\n    text: msgData.text,\n    isDMOrMention: isMentionedMe || state.attributes?.type === CHATROOM_TYPES.DIRECT_MESSAGE,\n    messageType: !newMessage ? MESSAGE_TYPES.TEXT : data.type,\n    memberID: innerSigningContractID,\n    chatRoomName: state.attributes?.name\n  }).catch(e => {\n    console.error('[action/chatroom.js] Error on messageReceivePostEffect', e)\n  })\n})\n\nexport default (sbp('sbp/selectors/register', {\n  'gi.actions/chatroom/create': async function (params             , billableContractID        ) {\n    const rootState = sbp('state/vuex/state')\n    const userID = rootState.loggedIn.identityContractID\n    await sbp('chelonia/contract/retain', userID, { ephemeral: true })\n    try {\n      let cskOpts = params.options?.csk\n      let cekOpts = params.options?.cek\n\n      if (!cekOpts) {\n        const CEK = keygen(CURVE25519XSALSA20POLY1305)\n        const CEKid = keyId(CEK)\n        const CEKp = serializeKey(CEK, false)\n        const CEKs = encryptedOutgoingDataWithRawKey(CEK, serializeKey(CEK, true))\n\n        cekOpts = {\n          id: CEKid,\n          foreignKey: undefined,\n          meta: {\n            private: {\n              content: CEKs,\n              shareable: true\n            }\n          },\n          data: CEKp,\n          _rawKey: CEK\n        }\n      }\n\n      const CEK = cekOpts._rawKey ? cekOpts._rawKey : deserializeKey(cekOpts.data)\n\n      if (!cskOpts) {\n        const CSK = keygen(EDWARDS25519SHA512BATCH)\n        const CSKid = keyId(CSK)\n        const CSKp = serializeKey(CSK, false)\n        const CSKs = encryptedOutgoingDataWithRawKey(CEK, serializeKey(CSK, true))\n\n        cskOpts = {\n          id: CSKid,\n          foreignKey: undefined,\n          meta: {\n            private: {\n              content: CSKs,\n              shareable: true\n            }\n          },\n          data: CSKp,\n          _rawKey: CSK\n        }\n      }\n\n      // Before creating the contract, put all keys into transient store\n      await sbp('chelonia/storeSecretKeys',\n        // $FlowFixMe[incompatible-use]\n        new Secret([cekOpts._rawKey, cskOpts._rawKey].map(key => ({ key, transient: true })))\n      )\n\n      const userCSKid = await sbp('chelonia/contract/currentKeyIdByName', userID, 'csk')\n      if (!userCSKid) throw new Error('User CSK id not found')\n\n      const SAK = keygen(EDWARDS25519SHA512BATCH)\n      const SAKid = keyId(SAK)\n      const SAKp = serializeKey(SAK, false)\n      const SAKs = encryptedOutgoingDataWithRawKey(CEK, serializeKey(SAK, true))\n\n      const chatroom = await sbp('chelonia/out/registerContract', {\n        ...omit(params, ['options']), // any 'options' are for this action, not for Chelonia\n        publishOptions: {\n          billableContractID,\n          ...params.publishOptions\n        },\n        signingKeyId: cskOpts.id,\n        actionSigningKeyId: cskOpts.id,\n        actionEncryptionKeyId: cekOpts.id,\n        keys: [\n          {\n            id: cskOpts.id,\n            name: 'csk',\n            purpose: ['sig'],\n            ringLevel: 0,\n            permissions: '*',\n            allowedActions: '*',\n            foreignKey: cskOpts.foreignKey,\n            meta: cskOpts.meta,\n            data: cskOpts.data\n          },\n          {\n            id: cekOpts.id,\n            name: 'cek',\n            purpose: ['enc'],\n            ringLevel: 0,\n            permissions: [SPMessage.OP_ACTION_ENCRYPTED],\n            allowedActions: '*',\n            foreignKey: cekOpts.foreignKey,\n            meta: cekOpts.meta,\n            data: cekOpts.data\n          },\n          ...(params.options?.groupKeys\n            ? [\n                {\n                  id: params.options.groupKeys[0].id,\n                  name: 'group-csk',\n                  purpose: ['sig'],\n                  ringLevel: 2,\n                  permissions: [SPMessage.OP_ATOMIC, SPMessage.OP_KEY_DEL, SPMessage.OP_ACTION_ENCRYPTED],\n                  allowedActions: ['gi.contracts/chatroom/leave'],\n                  foreignKey: params.options.groupKeys[0].foreignKey,\n                  meta: params.options.groupKeys[0].meta,\n                  data: params.options.groupKeys[0].data\n                },\n                {\n                  id: params.options.groupKeys[1].id,\n                  name: 'group-cek',\n                  purpose: ['enc'],\n                  ringLevel: 2,\n                  permissions: [SPMessage.OP_ATOMIC, SPMessage.OP_KEY_ADD, SPMessage.OP_KEY_DEL, SPMessage.OP_ACTION_ENCRYPTED],\n                  allowedActions: ['gi.contracts/chatroom/join', 'gi.contracts/chatroom/leave'],\n                  foreignKey: params.options.groupKeys[1].foreignKey,\n                  meta: params.options.groupKeys[1].meta,\n                  data: params.options.groupKeys[1].data\n                }\n              ]\n            : []),\n          {\n            id: SAKid,\n            name: '#sak',\n            purpose: ['sak'],\n            ringLevel: 0,\n            permissions: [],\n            allowedActions: [],\n            meta: {\n              private: {\n                content: SAKs\n              }\n            },\n            data: SAKp\n          }\n        ],\n        data: {\n          ...params.data,\n          attributes: {\n            ...params.data?.attributes,\n            creatorID: userID\n          }\n        },\n        contractName: 'gi.contracts/chatroom'\n      })\n\n      // After the contract has been created, store pesistent keys\n      await sbp('chelonia/storeSecretKeys',\n        // $FlowFixMe[incompatible-use]\n        new Secret([cekOpts._rawKey, cskOpts._rawKey].map(key => ({ key })))\n      )\n\n      return chatroom\n    } catch (e) {\n      console.error('gi.actions/chatroom/register failed!', e)\n      throw new GIErrorUIRuntimeError(L('Failed to create chat channel.'))\n    } finally {\n      await sbp('chelonia/contract/release', userID, { ephemeral: true })\n    }\n  },\n  'gi.actions/chatroom/shareNewKeys': async (contractID        , newKeys) => {\n    const state = sbp('chelonia/contract/state', contractID)\n    const mainCEKid = await sbp('chelonia/contract/currentKeyIdByName', state, 'cek')\n\n    const originatingContractID = state.attributes.groupContractID ? state.attributes.groupContractID : contractID\n\n    // $FlowFixMe\n    return Promise.all(Object.keys(state.members).map(async (pContractID) => {\n      const CEKid = await sbp('chelonia/contract/currentKeyIdByName', pContractID, 'cek')\n      if (!CEKid) {\n        console.warn(`Unable to share rotated keys for ${originatingContractID} with ${pContractID}: Missing CEK`)\n        return\n      }\n      return [\n        'chelonia/out/keyShare',\n        {\n          data: encryptedOutgoingData(contractID, mainCEKid, {\n            contractID,\n            foreignContractID: pContractID,\n            // $FlowFixMe\n            keys: Object.values(newKeys).map(([, newKey, newId]                    ) => ({\n              id: newId,\n              meta: {\n                private: {\n                  content: encryptedOutgoingData(pContractID, CEKid, serializeKey(newKey, true))\n                }\n              }\n            }))\n          })\n        }\n      ]\n    })).then((keys) => [keys.filter(Boolean)])\n  },\n  'gi.actions/chatroom/_ondeleted': async (contractID        , state        ) => {\n    const rootGetters = sbp('state/vuex/getters')\n    const identityState = rootGetters.currentIdentityState\n    if (identityState.chatRooms?.[contractID]) {\n      const identityContractID = rootGetters.ourIdentityContractId\n\n      await sbp('gi.actions/identity/deleteDirectMessage', { contractID: identityContractID, data: { contractID } }).catch(e => {\n        console.warn(`[handleDeletedContract] ${e.name} thrown by gi.actions/identity/deleteDirectMessage ${identityContractID} for ${contractID}:`, e)\n      })\n    } else {\n      // This is a group chatroom. To determine which group the chatroom\n      // belongs to, we need to go over each group, since there isn't a\n      // chatroom->group relationship stored.\n      const cIDs = Object.entries(identityState.groups || {}).filter(([cID, state]) => {\n        return !((state     )        ).hasLeft\n      }).map(([cID]) => {\n        return cID\n      })\n\n      for (const cID of cIDs) {\n        const groupState = sbp('chelonia/contract/state', cID)\n        // If the chatroom isn't part of this group, continue\n        if (!groupState?.chatRooms?.[contractID]) continue\n\n        if (!groupState.chatRooms[contractID].deletedDate) {\n          // If the chatroom hasn't been 'deleted' in the group, attempt to do\n          // so now.\n          await sbp('gi.actions/group/deleteChatRoom', {\n            contractID: cID,\n            data: { chatRoomID: contractID }\n          }).catch(e => {\n            console.warn(`[handleDeletedContract] ${e.name} thrown by gi.actions/group/deleteChatRoom ${cID} for ${contractID}:`, e)\n          })\n        }\n\n        // No need to continue in the loop, as chatrooms belong to a single\n        // group\n        break\n      }\n    }\n  },\n  ...encryptedNotification('gi.actions/chatroom/user-typing-event', L('Failed to send typing notification')),\n  ...encryptedNotification('gi.actions/chatroom/user-stop-typing-event', L('Failed to send stopped typing notification')),\n  ...encryptedAction('gi.actions/chatroom/addMessage', L('Failed to add message.')),\n  ...encryptedAction('gi.actions/chatroom/editMessage', L('Failed to edit message.')),\n  ...encryptedAction('gi.actions/chatroom/deleteMessage', L('Failed to delete message.')),\n  ...encryptedAction('gi.actions/chatroom/deleteAttachment', L('Failed to delete attachment of message.')),\n  ...encryptedAction('gi.actions/chatroom/makeEmotion', L('Failed to make emotion.')),\n  ...encryptedAction('gi.actions/chatroom/pinMessage', L('Failed to pin message.')),\n  ...encryptedAction('gi.actions/chatroom/unpinMessage', L('Failed to unpin message.')),\n  ...encryptedAction('gi.actions/chatroom/join', L('Failed to join chat channel.'), async (sendMessage, params, signingKeyId) => {\n    const rootState = sbp('state/vuex/state')\n    const identityContractID = rootState.loggedIn.identityContractID\n    // We accept an array for memberID to aggregate all joins\n    const userIDs = (\n      Array.isArray(params.data.memberID) ? params.data.memberID : [params.data.memberID]\n    // If the memberID isn't specified, it's ourselves joining. This is\n    // consistent with how the contract works and produces shorter messages\n    ).map(memberID => memberID == null ? identityContractID : memberID)\n\n    // We need to read values from both the chatroom and the identity contracts'\n    // state, so we call wait to run the rest of this function after all\n    // operations in those contracts have completed\n    await sbp('chelonia/contract/retain', userIDs, { ephemeral: true })\n    try {\n      await sbp('chelonia/contract/wait', params.contractID)\n\n      userIDs.forEach(cID => {\n        if (!cID || !has(rootState.contracts, cID) || !has(rootState, cID)) {\n          throw new Error(`Unable to send gi.actions/chatroom/join on ${params.contractID} because user ID contract ${cID} is missing`)\n        }\n      })\n\n      const CEKid = params.encryptionKeyId || await sbp('chelonia/contract/currentKeyIdByName', params.contractID, 'cek')\n\n      const userCSKids = await Promise.all(userIDs.map(async (cID) =>\n        [cID, await sbp('chelonia/contract/currentKeyIdByName', cID, 'csk')]\n      ))\n      return await sbp('chelonia/out/atomic', {\n        ...params,\n        contractName: 'gi.contracts/chatroom',\n        data: [\n        // Add the user's CSK to the contract\n          [\n            'chelonia/out/keyAdd', {\n            // TODO: Find a way to have this wrapping be done by Chelonia directly\n              data: userCSKids.map(([cID, cskID]                  ) => encryptedOutgoingData(params.contractID, CEKid, {\n                foreignKey: `shelter:${encodeURIComponent(cID)}?keyName=${encodeURIComponent('csk')}`,\n                id: cskID,\n                data: rootState[cID]._vm.authorizedKeys[cskID].data,\n                permissions: [SPMessage.OP_ACTION_ENCRYPTED + '#inner'],\n                allowedActions: '*',\n                purpose: ['sig'],\n                ringLevel: Number.MAX_SAFE_INTEGER,\n                name: `${cID}/${cskID}`\n              }))\n            }\n          ],\n          ...userIDs.map(cID => sendMessage({\n            ...params,\n            data: cID === identityContractID\n              ? {}\n              : { memberID: cID },\n            returnInvocation: true\n          }))\n        ],\n        signingKeyId\n      })\n    } finally {\n      await sbp('chelonia/contract/release', userIDs, { ephemeral: true })\n    }\n  }),\n  ...encryptedAction('gi.actions/chatroom/rename', L('Failed to rename chat channel.')),\n  ...encryptedAction('gi.actions/chatroom/changeDescription', L('Failed to change chat channel description.')),\n  ...encryptedAction('gi.actions/chatroom/leave', L('Failed to leave chat channel.'), async (sendMessage, params, signingKeyId) => {\n    const userID = params.data.memberID\n    const keyIds = userID && await sbp('chelonia/contract/foreignKeysByContractID', params.contractID, userID)\n\n    if (keyIds?.length) {\n      return await sbp('chelonia/out/atomic', {\n        ...params,\n        contractName: 'gi.contracts/chatroom',\n        data: [\n          sendMessage({ ...params, returnInvocation: true }),\n          // Remove the user's CSK from the contract\n          [\n            'chelonia/out/keyDel', {\n              data: keyIds\n            }\n          ]\n        ],\n        signingKeyId\n      })\n    }\n\n    return await sendMessage(params)\n  }),\n  ...encryptedAction('gi.actions/chatroom/delete', L('Failed to delete chat channel.')),\n  ...encryptedAction('gi.actions/chatroom/voteOnPoll', L('Failed to vote on a poll.')),\n  ...encryptedAction('gi.actions/chatroom/changeVoteOnPoll', L('Failed to change vote on a poll.')),\n  ...encryptedAction('gi.actions/chatroom/closePoll', L('Failed to close a poll.'))\n})          )\n", "'use strict'\n\nimport { literalOf, unionOf } from '~/frontend/model/contracts/misc/flowTyper.js'\nimport {\n  PROPOSAL_REMOVE_MEMBER,\n  PROFILE_STATUS\n} from '../constants.js'\n\nexport const VOTE_AGAINST = ':against'\nexport const VOTE_INDIFFERENT = ':indifferent'\nexport const VOTE_UNDECIDED = ':undecided'\nexport const VOTE_FOR = ':for'\n\nexport const RULE_PERCENTAGE = 'percentage'\nexport const RULE_DISAGREEMENT = 'disagreement'\nexport const RULE_MULTI_CHOICE = 'multi-choice'\n\n// TODO: ranked-choice? :D\n\n/* REVIVEW PR\n  the whole \"state\" being passed as argument to rules[rule]() is overwhelmed.\n  It would be simpler with just 2 simple args: \"threshold\" and \"population\".\n  Advantages:\n  - population: No need to do the logic to get it (and avoid import PROFILE_STATUS.ACTIVE from group.js).\n  - threshold: The selector to get the selector is huge.\n  - tests: Avoid the need to mock a complex state.\n  My suggestion: 1 parameter (object) with 4 explicit keys.\n  [RULE_PERCENTAGE]: function ({ votes, proposalType, population, threshold })\n*/\n\nconst getPopulation = (state) => Object.keys(state.profiles).filter(p => state.profiles[p].status === PROFILE_STATUS.ACTIVE).length\n\nconst rules         = {\n  [RULE_PERCENTAGE]: function (state, proposalType, votes) {\n    votes = Object.values(votes)\n    let population = getPopulation(state)\n    if (proposalType === PROPOSAL_REMOVE_MEMBER) population -= 1\n    const defaultThreshold = state.settings.proposals[proposalType].ruleSettings[RULE_PERCENTAGE].threshold\n    const threshold = getThresholdAdjusted(RULE_PERCENTAGE, defaultThreshold, population)\n    const totalIndifferent = votes.filter(x => x === VOTE_INDIFFERENT).length\n    const totalFor = votes.filter(x => x === VOTE_FOR).length\n    const totalAgainst = votes.filter(x => x === VOTE_AGAINST).length\n    const totalForOrAgainst = totalFor + totalAgainst\n    const turnout = totalForOrAgainst + totalIndifferent\n    const absent = population - turnout\n    // TODO: figure out if this is the right way to figure out the \"neededToPass\" number\n    //       and if so, explain it in the UI that the threshold is applied only to\n    //       *those who care, plus those who were abscent*.\n    //       Those who explicitely say they don't care are removed from consideration.\n    const neededToPass = Math.ceil(threshold * (population - totalIndifferent))\n    console.debug(`votingRule ${RULE_PERCENTAGE} for ${proposalType}:`, { neededToPass, totalFor, totalAgainst, totalIndifferent, threshold, absent, turnout, population })\n    if (totalFor >= neededToPass) {\n      return VOTE_FOR\n    }\n    return totalFor + absent < neededToPass ? VOTE_AGAINST : VOTE_UNDECIDED\n  },\n  [RULE_DISAGREEMENT]: function (state, proposalType, votes) {\n    votes = Object.values(votes)\n    const population = getPopulation(state)\n    const minimumMax = proposalType === PROPOSAL_REMOVE_MEMBER ? 2 : 1\n    const thresholdOriginal = Math.max(state.settings.proposals[proposalType].ruleSettings[RULE_DISAGREEMENT].threshold, minimumMax)\n    const threshold = getThresholdAdjusted(RULE_DISAGREEMENT, thresholdOriginal, population)\n    const totalFor = votes.filter(x => x === VOTE_FOR).length\n    const totalAgainst = votes.filter(x => x === VOTE_AGAINST).length\n    const turnout = votes.length\n    const absent = population - turnout\n\n    console.debug(`votingRule ${RULE_DISAGREEMENT} for ${proposalType}:`, { totalFor, totalAgainst, threshold, turnout, population, absent })\n    if (totalAgainst >= threshold) {\n      return VOTE_AGAINST\n    }\n    // consider proposal passed if more vote for it than against it and there aren't\n    // enough votes left to tip the scales past the threshold\n    return totalAgainst + absent < threshold ? VOTE_FOR : VOTE_UNDECIDED\n  },\n  [RULE_MULTI_CHOICE]: function (state, proposalType, votes) {\n    throw new Error('unimplemented!')\n    // TODO: return VOTE_UNDECIDED if 0 votes, otherwise value w/greatest number of votes\n    //       the proposal/poll is considered passed only after the expiry time period\n    // NOTE: are we sure though that this even belongs here as a voting rule...?\n    //       perhaps there could be a situation were one of several valid settings options\n    //       is being proposed... in effect this would be a plurality voting rule\n  }\n}\n\nexport default rules\n\nexport const ruleType      = unionOf(...Object.keys(rules).map(k => literalOf(k)))\nexport const voteType      = unionOf(...[VOTE_AGAINST, VOTE_INDIFFERENT, VOTE_UNDECIDED, VOTE_FOR].map(v => literalOf(v)))\n\n/**\n *\n * @example ('disagreement', 2, 1) => 2\n * @example ('disagreement', 5, 1) => 3\n * @example ('disagreement', 7, 10) => 7\n * @example ('disagreement', 20, 10) => 10\n *\n * @example ('percentage', 0.5, 3) => 0.5\n * @example ('percentage', 0.1, 3) => 0.33\n * @example ('percentage', 0.1, 10) => 0.2\n * @example ('percentage', 0.3, 10) => 0.3\n */\nexport const getThresholdAdjusted = (rule        , threshold        , groupSize        )         => {\n  const groupSizeVoting = Math.max(3, groupSize) // 3 = minimum groupSize to vote\n\n  return {\n    [RULE_DISAGREEMENT]: () => {\n      // Limit number of maximum \"no\" votes to group size\n      return Math.min(groupSizeVoting - 1, threshold)\n    },\n    [RULE_PERCENTAGE]: () => {\n      // Minimum threshold correspondent to 2 \"yes\" votes\n      const minThreshold = 2 / groupSizeVoting\n      return Math.max(minThreshold, threshold)\n    }\n  }[rule]()\n}\n\n/**\n *\n * @example (10, 0.5) => 5\n * @example (3, 0.8) => 3\n * @example (1, 0.6) => 2\n */\nexport const getCountOutOfMembers = (groupSize        , decimal        )         => {\n  const minGroupSize = 3 // when group can vote\n  return Math.ceil(Math.max(minGroupSize, groupSize) * decimal)\n}\n\nexport const getPercentFromDecimal = (decimal        )         => {\n  // convert decimal to percentage avoiding weird decimals results.\n  // e.g. 0.58 -> 58 instead of 57.99999\n  return Math.round(decimal * 100)\n}\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport { objectOf, literalOf, unionOf, number } from '~/frontend/model/contracts/misc/flowTyper.js'\nimport { DAYS_MILLIS } from '../time.js'\nimport rules, { ruleType, VOTE_AGAINST, VOTE_FOR, RULE_PERCENTAGE, RULE_DISAGREEMENT } from './rules.js'\nimport {\n  PROPOSAL_RESULT,\n  PROPOSAL_INVITE_MEMBER,\n  PROPOSAL_REMOVE_MEMBER,\n  PROPOSAL_GROUP_SETTING_CHANGE,\n  PROPOSAL_PROPOSAL_SETTING_CHANGE,\n  PROPOSAL_GENERIC,\n  // STATUS_OPEN,\n  STATUS_PASSED,\n  STATUS_FAILED\n  // STATUS_EXPIRED,\n  // STATUS_CANCELLED\n} from '../constants.js'\n\nexport function notifyAndArchiveProposal ({ state, proposalHash, proposal, contractID, meta, height }   \n                \n                       \n                \n                     \n               \n                \n ) {\n  delete state.proposals[proposalHash]\n\n  // NOTE: we can not make notification for the proposal closal\n  //       in the /proposalVote/sideEffect\n  //       because we remove the state.proposals[proposalHash] in the process function\n  //       and can not access the proposal data in the sideEffect\n  sbp('gi.contracts/group/pushSideEffect', contractID,\n    ['gi.contracts/group/makeNotificationWhenProposalClosed', state, contractID, meta, height, proposalHash, proposal]\n  )\n  sbp('gi.contracts/group/pushSideEffect', contractID,\n    ['gi.contracts/group/archiveProposal', contractID, proposalHash, proposal]\n  )\n}\n\nexport const proposalSettingsType      = objectOf({\n  rule: ruleType,\n  expires_ms: number,\n  ruleSettings: objectOf({\n    [RULE_PERCENTAGE]: objectOf({ threshold: number }),\n    [RULE_DISAGREEMENT]: objectOf({ threshold: number })\n  })\n})\n\nexport function oneVoteToCloseWith (state        , proposalHash        , expectedResult        )          {\n  const proposal = state.proposals[proposalHash]\n  const votes = Object.assign({}, proposal.votes)\n  const currentResult = rules[proposal.data.votingRule](state, proposal.data.proposalType, votes)\n  votes[String(Math.random())] = expectedResult\n  const newResult = rules[proposal.data.votingRule](state, proposal.data.proposalType, votes)\n  console.debug(`oneVoteToCloseWith currentResult(${currentResult}) newResult(${newResult})`)\n\n  // If a member was removed, currentResult could also be `expectedResult`\n  // TODO: Re-process active proposals to handle this case\n  // return currentResult === VOTE_UNDECIDED && newResult === `expectedResult`\n  return newResult === expectedResult\n}\n\n// returns true IF a single YES vote is required to pass the proposal\nexport function oneVoteToPass (state        , proposalHash        )          {\n  return oneVoteToCloseWith(state, proposalHash, VOTE_FOR)\n}\n\n// returns true IF a single YES vote is required to pass the proposal\nexport function oneVoteToFail (state        , proposalHash        )          {\n  return oneVoteToCloseWith(state, proposalHash, VOTE_AGAINST)\n}\n\nfunction voteAgainst (state     , { meta, data, contractID, height }     ) {\n  const { proposalHash } = data\n  const proposal = state.proposals[proposalHash]\n  proposal.status = STATUS_FAILED\n  sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_AGAINST, data)\n  notifyAndArchiveProposal({ state, proposalHash, proposal, contractID, meta, height })\n}\n\n// NOTE: The code is ready to receive different proposals settings,\n// However, we decided to make all settings the same, to simplify the UI/UX proptotype.\nexport const proposalDefaults = {\n  rule: RULE_PERCENTAGE,\n  expires_ms: 14 * DAYS_MILLIS,\n  ruleSettings: ({\n    [RULE_PERCENTAGE]: { threshold: 0.66 },\n    [RULE_DISAGREEMENT]: { threshold: 1 }\n  }                                                                            )\n}\n\nconst proposals         = {\n  [PROPOSAL_INVITE_MEMBER]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: async function (state, message) {\n      const { data, contractID, meta, height } = message\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.payload = data.passPayload\n      proposal.status = STATUS_PASSED\n      // NOTE: if invite/process requires more than just data+meta\n      //       this code will need to be updated...\n      const forMessage = { ...message, data: data.passPayload }\n      await sbp('gi.contracts/group/invite/process', forMessage, state)\n      sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_FOR, data)\n      notifyAndArchiveProposal({ state, proposalHash, proposal, contractID, meta, height })\n      // TODO: for now, generate the link and send it to the user's inbox\n      //       however, we cannot send SPMessages in any way from here\n      //       because that means each time someone synchronizes this contract\n      //       a new invite would be sent...\n      //       which means the voter who casts the deciding ballot needs to\n      //       include in this message the authorization for the new user to\n      //       join the group.\n      //       we could make it so that all users generate the same authorization\n      //       somehow...\n      //       however if it's an OP_KEY_* message ther can only be one of those!\n      //\n      //       so, the deciding voter is the one that generates the passPayload data for the\n      //       link includes the OP_KEY_* message in their final vote authorizing\n      //       the user.\n      //       additionally, for our testing purposes, we check to see if the\n      //       currently logged in user is the deciding voter, and if so we\n      //       send a message to that user's inbox with the link. The user\n      //       clicks the link and then generates an invite accept or invite decline message.\n      //\n      //       we no longer have a state.invitees, instead we have a state.invites\n      // sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_FOR, data)\n      // TODO: generate and save invite link, which is used to generate a group/inviteAccept message\n      //       the invite link contains the secret to a public/private keypair that is generated\n      //       by the final voter, this keypair is a special \"write only\" keypair that is allowed\n      //       to only send a single kind of message to the group (accepting the invite, deleting\n      //       the writeonly keypair, and registering a new keypair with the group that has\n      //       full member privileges, i.e. their identity contract). The writeonly keypair\n      //       that's registered originally also contains attributes that tell the server\n      //       what kind of message(s) it's allowed to send to the contract, and how many\n      //       of them.\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_REMOVE_MEMBER]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: async function (state, message) {\n      const { data, contractID, meta, height } = message\n      const { proposalHash, passPayload } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      proposal.payload = passPayload\n      const messageData = proposal.data.proposalData\n      const forMessage = { ...message, data: messageData, proposalHash }\n      await sbp('gi.contracts/group/removeMember/process', forMessage, state)\n      sbp('gi.contracts/group/pushSideEffect', contractID,\n        ['gi.contracts/group/removeMember/sideEffect', forMessage]\n      )\n      notifyAndArchiveProposal({ state, proposalHash, proposal, contractID, meta, height })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_GROUP_SETTING_CHANGE]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: async function (state, message) {\n      const { data, contractID, meta, height } = message\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      const { setting, proposedValue } = proposal.data.proposalData\n      // NOTE: if updateSettings ever needs more ethana just meta+data\n      //       this code will need to be updated\n      const forMessage = {\n        ...message,\n        data: { [setting]: proposedValue },\n        proposalHash\n      }\n      await sbp('gi.contracts/group/updateSettings/process', forMessage, state)\n      sbp('gi.contracts/group/pushSideEffect', contractID,\n        ['gi.contracts/group/updateSettings/sideEffect', forMessage])\n      notifyAndArchiveProposal({ state, proposalHash, proposal, contractID, meta, height })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_PROPOSAL_SETTING_CHANGE]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: async function (state, message) {\n      const { data, contractID, meta, height } = message\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      const forMessage = {\n        ...message,\n        data: proposal.data.proposalData,\n        proposalHash\n      }\n      await sbp('gi.contracts/group/updateAllVotingRules/process', forMessage, state)\n      notifyAndArchiveProposal({ state, proposalHash, proposal, contractID, meta, height })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_GENERIC]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: function (state, { data, contractID, meta, height }) {\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_FOR, data)\n      notifyAndArchiveProposal({ state, proposalHash, proposal, contractID, meta, height })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  }\n}\n\nexport default proposals\n\nexport const proposalType      = unionOf(...Object.keys(proposals).map(k => literalOf(k)))\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport { KILOBYTE, IMAGE_ATTACHMENT_MAX_SIZE } from './constants.js'\n\n// Copied from https://stackoverflow.com/questions/11876175/how-to-get-a-file-or-blob-from-an-object-url\nexport function objectURLtoBlob (url        )                {\n  return fetch(url).then(r => r.blob())\n}\n\n// Copied from https://stackoverflow.com/a/27980815/4737729\nexport function imageDataURItoBlob (dataURI        )       {\n  const [prefix, data] = dataURI.split(',')\n  const [imageType] = (/image\\/[^;]+/.exec(prefix) || [''])\n  const byteString = atob(data)\n  const ab = new ArrayBuffer(byteString.length)\n  const ia = new Uint8Array(ab)\n\n  for (let i = 0; i < byteString.length; i++) {\n    ia[i] = byteString.charCodeAt(i)\n  }\n\n  return new Blob([ab], { type: imageType })\n}\n\nexport const imageUpload = async (imageFile      , params         )                  => {\n  const file = imageFile\n  console.debug('will upload a picture of type:', file.type)\n  const { download } = await sbp('chelonia/fileUpload', imageFile, { type: file.type, cipher: 'aes256gcm' }, params)\n  return download\n}\n\n// Image compression\n\nexport function supportsWebP ()                   {\n  // Uses a very small webP image to check if the browser supports 'image/webp' format.\n  // (reference: https://developers.google.com/speed/webp/faq#in_your_own_javascript)\n  const verySmallWebP = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA'\n  const img = new Image()\n\n  return new Promise(resolve => {\n    img.onload = () => { resolve(img.height > 0) }\n    img.onerror = (e) => { resolve(false) }\n    img.src = verySmallWebP\n  })\n}\n\nfunction loadImage (url)      {\n  const imgEl = new Image()\n\n  return new Promise((resolve) => {\n    imgEl.onload = () => { resolve(imgEl) }\n    imgEl.src = url\n  })\n}\n\nfunction generateImageBlobByCanvas ({\n  sourceImage,\n  resizingFactor,\n  quality,\n  compressToType\n}) {\n  const { naturalWidth, naturalHeight } = sourceImage\n  const canvasEl = document.createElement('canvas')\n  const c = canvasEl.getContext('2d')\n\n  canvasEl.width = naturalWidth * resizingFactor\n  canvasEl.height = naturalHeight * resizingFactor\n\n  c.drawImage(\n    sourceImage,\n    0,\n    0,\n    canvasEl.width,\n    canvasEl.height\n  )\n\n  return new Promise((resolve) => {\n    canvasEl.toBlob(blob => {\n      resolve(blob)\n    }, compressToType, quality)\n  })\n}\n\nfunction getResizingFactor (sourceImage) {\n  // If image's physical size is greater than the max dimension, resize the image to the max dimension.\n  const imageMaxDimension = { width: 2048, height: 1536 }\n  const { naturalWidth, naturalHeight } = sourceImage\n\n  if (naturalWidth > imageMaxDimension.width || naturalHeight > imageMaxDimension.height) {\n    return Math.min(imageMaxDimension.width / naturalWidth, imageMaxDimension.height / naturalHeight)\n  }\n\n  return 1\n}\n\nexport async function compressImage (imgUrl        , sourceMimeType         )               {\n  // Takes a source image url and generate a blob of the compressed image.\n\n  // According to the testing result, webP format has a better compression ratio than jpeg.\n  const compressToType = await supportsWebP() ? 'image/webp' : 'image/jpeg'\n  const sourceImage = await loadImage(imgUrl)\n\n  // According to the testing result, 0.8 is a good starting point for quality for .jpeg and .webp.\n  // For other image types, use 0.9 as the starting point.\n  let quality = ['image/jpeg', 'image/webp'].includes(sourceMimeType) ? 0.8 : 0.9\n  const resizingFactor = getResizingFactor(sourceImage)\n\n  while (true) {\n    const blob = await generateImageBlobByCanvas({\n      sourceImage,\n      resizingFactor,\n      quality,\n      compressToType\n    })\n    const sizeDiff = blob.size - IMAGE_ATTACHMENT_MAX_SIZE\n\n    if (sizeDiff <= 0 || // if the compressed image is already smaller than the max size, return the compressed image.\n      quality <= 0.3) { // Do not sacrifice the image quality too much.\n      return blob\n    } else {\n      // if the size difference is greater than 100KB, reduce the next compression factors by 10%, otherwise 5%.\n      const minusFactor = sizeDiff > 100 * KILOBYTE ? 0.1 : 0.05\n      quality -= minusFactor\n    }\n  }\n}\n", "'use strict'\n\n                                           \nimport { CURVE25519XSALSA20POLY1305, EDWARDS25519SHA512BATCH, keyId, keygen, serializeKey } from '@chelonia/crypto'\nimport { GIErrorUIRuntimeError, L, LError } from '@common/common.js'\nimport {\n  CHATROOM_PRIVACY_LEVEL,\n  INVITE_INITIAL_CREATOR,\n  INVITE_EXPIRES_IN_DAYS,\n  MAX_GROUP_MEMBER_COUNT,\n  MESSAGE_TYPES,\n  PROFILE_STATUS,\n  PROPOSAL_GENERIC,\n  PROPOSAL_GROUP_SETTING_CHANGE,\n  PROPOSAL_INVITE_MEMBER,\n  PROPOSAL_PROPOSAL_SETTING_CHANGE,\n  PROPOSAL_REMOVE_MEMBER,\n  STATUS_OPEN,\n  STATUS_PASSED,\n  STATUS_FAILED,\n  STATUS_EXPIRING,\n  STATUS_EXPIRED,\n  STATUS_CANCELLED\n} from '@model/contracts/shared/constants.js'\nimport { merge, omit, randomIntFromRange } from 'turtledash'\nimport { DAYS_MILLIS, addTimeToDate, dateToPeriodStamp } from '@model/contracts/shared/time.js'\nimport proposals, { oneVoteToFail, oneVoteToPass } from '@model/contracts/shared/voting/proposals.js'\nimport { VOTE_FOR } from '@model/contracts/shared/voting/rules.js'\nimport sbp from '@sbp/sbp'\nimport {\n  ACCEPTED_GROUP,\n  JOINED_CHATROOM,\n  JOINED_GROUP,\n  LEFT_GROUP,\n  LOGOUT\n} from '@utils/events.js'\nimport { imageUpload } from '@utils/image.js'\nimport { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\nimport { Secret } from '~/shared/domains/chelonia/Secret.js'\n                                                                                 \nimport { encryptedOutgoingData, encryptedOutgoingDataWithRawKey } from '~/shared/domains/chelonia/encryptedData.js'\nimport { CHELONIA_RESET, CONTRACT_HAS_RECEIVED_KEYS, EVENT_HANDLED } from '~/shared/domains/chelonia/events.js'\n                                                \nimport { createInvite, encryptedAction } from './utils.js'\nimport { extractProposalData } from '@model/notifications/utils.js'\n\nsbp('okTurtles.events/on', LEFT_GROUP, ({ identityContractID, groupContractID }) => {\n  const rootState = sbp('chelonia/rootState')\n  if (!rootState.notifications || rootState.loggedIn?.identityContractID !== identityContractID) return\n  const notificationHashes = rootState.notifications.items.filter(item => item.groupID === groupContractID).map(item => item.hash)\n  sbp('gi.notifications/remove', notificationHashes)\n})\n\nconst JOINED_FAILED_KEY = 'gi.actions/group/join/failed'\nlet reattemptTimeoutId\n\nsbp('okTurtles.events/on', CHELONIA_RESET, () => {\n  sbp('okTurtles.data/delete', JOINED_FAILED_KEY)\n})\n\nexport default (sbp('sbp/selectors/register', {\n  'gi.actions/group/create': async function ({\n    data: {\n      name,\n      picture,\n      sharedValues,\n      mincomeAmount,\n      mincomeCurrency,\n      ruleName,\n      ruleThreshold,\n      distributionDate\n    },\n    publishOptions\n  }) {\n    let finalPicture = `${self.location.origin}/assets/images/group-avatar-default.png`\n\n    const rootState = sbp('chelonia/rootState')\n    const userID = rootState.loggedIn.identityContractID\n\n    if (picture) {\n      try {\n        finalPicture = await imageUpload(picture, { billableContractID: userID })\n      } catch (e) {\n        console.error('actions/group.js failed to upload the group picture', e)\n        throw new GIErrorUIRuntimeError(L('Failed to upload the group picture. {codeError}', { codeError: e.message }))\n      }\n    }\n\n    // Create the necessary keys to initialise the contract\n    // eslint-disable-next-line camelcase\n    const CSK = keygen(EDWARDS25519SHA512BATCH)\n    const CEK = keygen(CURVE25519XSALSA20POLY1305)\n    const inviteKey = keygen(EDWARDS25519SHA512BATCH)\n    const SAK = keygen(EDWARDS25519SHA512BATCH)\n\n    // Key IDs\n    const CSKid = keyId(CSK)\n    const CEKid = keyId(CEK)\n    const inviteKeyId = keyId(inviteKey)\n    const SAKid = keyId(SAK)\n\n    // Public keys to be stored in the contract\n    const CSKp = serializeKey(CSK, false)\n    const CEKp = serializeKey(CEK, false)\n    const inviteKeyP = serializeKey(inviteKey, false)\n    const SAKp = serializeKey(SAK, false)\n\n    // Secret keys to be stored encrypted in the contract\n    const CSKs = encryptedOutgoingDataWithRawKey(CEK, serializeKey(CSK, true))\n    const CEKs = encryptedOutgoingDataWithRawKey(CEK, serializeKey(CEK, true))\n    const inviteKeyS = encryptedOutgoingDataWithRawKey(CEK, serializeKey(inviteKey, true))\n    const SAKs = encryptedOutgoingDataWithRawKey(CEK, serializeKey(SAK, true))\n\n    try {\n      const proposalSettings = {\n        rule: ruleName,\n        ruleSettings: {\n          [ruleName]: {\n            threshold: +ruleThreshold // ensure this is a number\n          }\n        }\n      }\n      if (!distributionDate) {\n        // 3 days after group creation by default. we put this here for a kind of dumb but\n        // necessary reason: the Cypress tests do not allow us to import dateToPeriodStamp\n        // or any of these other time.js functions because thte Cypress environment can't\n        // handle Flowtype annotations, even though our .babelrc should make it work.\n        distributionDate = dateToPeriodStamp(addTimeToDate(new Date(), 3 * DAYS_MILLIS))\n      }\n\n      // Before creating the contract, put all keys into transient store\n      await sbp('chelonia/storeSecretKeys',\n        new Secret([CEK, CSK].map(key => ({ key, transient: true })))\n      )\n\n      const userCSKid = await sbp('chelonia/contract/currentKeyIdByName', userID, 'csk')\n      if (!userCSKid) throw new Error('User CSK id not found')\n\n      const userCEKid = await sbp('chelonia/contract/currentKeyIdByName', userID, 'cek')\n      if (!userCEKid) throw new Error('User CEK id not found')\n\n      const message = await sbp('chelonia/out/registerContract', {\n        contractName: 'gi.contracts/group',\n        publishOptions: {\n          billableContractID: userID,\n          ...publishOptions\n        },\n        signingKeyId: CSKid,\n        actionSigningKeyId: CSKid,\n        actionEncryptionKeyId: CEKid,\n        keys: [\n          {\n            id: CSKid,\n            name: 'csk',\n            purpose: ['sig'],\n            ringLevel: 1,\n            permissions: '*',\n            allowedActions: '*',\n            meta: {\n              private: {\n                content: CSKs,\n                shareable: true\n              }\n            },\n            data: CSKp\n          },\n          {\n            id: CEKid,\n            name: 'cek',\n            purpose: ['enc'],\n            ringLevel: 1,\n            permissions: '*',\n            allowedActions: '*',\n            meta: {\n              private: {\n                content: CEKs,\n                shareable: true\n              }\n            },\n            data: CEKp\n          },\n          {\n            id: inviteKeyId,\n            name: '#inviteKey-' + inviteKeyId,\n            purpose: ['sig'],\n            ringLevel: Number.MAX_SAFE_INTEGER,\n            permissions: [SPMessage.OP_KEY_REQUEST],\n            meta: {\n              quantity: MAX_GROUP_MEMBER_COUNT,\n              ...(INVITE_EXPIRES_IN_DAYS.ON_BOARDING && {\n                expires:\n                await sbp('chelonia/time') + DAYS_MILLIS * INVITE_EXPIRES_IN_DAYS.ON_BOARDING\n              }),\n              private: {\n                content: inviteKeyS\n              }\n            },\n            data: inviteKeyP\n          },\n          {\n            id: SAKid,\n            name: '#sak',\n            purpose: ['sak'],\n            ringLevel: 0,\n            permissions: [],\n            allowedActions: [],\n            meta: {\n              private: {\n                content: SAKs\n              }\n            },\n            data: SAKp\n          }\n        ],\n        data: {\n          invites: {\n            [inviteKeyId]: {\n              creatorID: INVITE_INITIAL_CREATOR,\n              inviteKeyId\n            }\n          },\n          settings: {\n            // authorizations: [contracts.CanModifyAuths.dummyAuth()], // TODO: this\n            groupName: name,\n            groupPicture: finalPicture,\n            sharedValues,\n            mincomeAmount: +mincomeAmount,\n            mincomeCurrency: mincomeCurrency,\n            distributionDate,\n            minimizeDistribution: true,\n            proposals: {\n              [PROPOSAL_GROUP_SETTING_CHANGE]: merge(\n                merge({}, proposals[PROPOSAL_GROUP_SETTING_CHANGE].defaults),\n                proposalSettings\n              ),\n              [PROPOSAL_INVITE_MEMBER]: merge(\n                merge({}, proposals[PROPOSAL_INVITE_MEMBER].defaults),\n                proposalSettings\n              ),\n              [PROPOSAL_REMOVE_MEMBER]: merge(\n                merge({}, proposals[PROPOSAL_REMOVE_MEMBER].defaults),\n                proposalSettings\n              ),\n              [PROPOSAL_PROPOSAL_SETTING_CHANGE]: merge(\n                merge({}, proposals[PROPOSAL_PROPOSAL_SETTING_CHANGE].defaults),\n                proposalSettings\n              ),\n              [PROPOSAL_GENERIC]: merge(\n                merge({}, proposals[PROPOSAL_GENERIC].defaults),\n                proposalSettings\n              )\n            }\n          },\n          groupOwnerID: userID\n        }\n      })\n\n      const contractID = message.contractID()\n\n      // After the contract has been created, store pesistent keys\n      await sbp('chelonia/storeSecretKeys',\n        new Secret([CEK, CSK, inviteKey].map(key => ({ key })))\n      )\n\n      // Using ephemeral retain-release to wait until the newly created group\n      // is synced, which includes creating the #general chatroom\n      await sbp('chelonia/contract/retain', contractID, { ephemeral: true })\n      // The #general chatroom is created as a side-effect, which could take\n      // a bit to be done\n      await Promise.race([\n        (async () => {\n          for (let i = 0; i < 10; i++) {\n            // Wait for outgoing actions to be sent (e.g., to the new chatroom\n            // or to the group)\n            await sbp('okTurtles.eventQueue/queueEvent', 'encrypted-action', () => {})\n            await sbp('chelonia/contract/wait', contractID)\n            const rootState = sbp('chelonia/rootState')\n            if (rootState[contractID]?.generalChatRoomId) {\n              return\n            }\n            // Extra wait to account for network delays\n            await new Promise(resolve => setTimeout(resolve, 50))\n          }\n          throw new Error('#General still not found')\n        })(),\n        new Promise((resolve, reject) => {\n          setTimeout(() => reject(new Error('Waiting for chatroom creation is taking too long')), 5000)\n        })\n      ]).catch((e) => {\n        console.error('Error waiting for new group contract to be ready', e)\n      })\n      try {\n        await sbp('gi.actions/identity/joinGroup', {\n          contractID: userID,\n          data: {\n            groupContractID: contractID,\n            inviteSecret: serializeKey(CSK, true),\n            creatorID: true\n          }\n        })\n      } finally {\n        await sbp('chelonia/contract/release', contractID, { ephemeral: true })\n      }\n\n      return message.contractID()\n    } catch (e) {\n      console.error('gi.actions/group/create failed!', e)\n      throw new GIErrorUIRuntimeError(L('Failed to create the group: {reportError}', LError(e)))\n    }\n  },\n  // The 'gi.actions/group/join' selector handles joining a group. It can be\n  // called from a variety of places: when accepting an invite, when logging\n  // in, and asynchronously with an event handler defined in this function.\n  // The function deals mostly with the group's contract state, and there are\n  // multiple scenarios that need to be considered.\n  // For example, when joining a group through an invite link, we need to\n  // first send a key request that an existing group member must answer.\n  // Until the key request has been answered, we cannot interact with the\n  // group.\n  // Once the key request is answered, we call the inviteAccept action to add\n  // our profile to the group and then join the General chatroom. At this point,\n  // we can fully interact with the group as a member.\n  // When logging in, the situation is similar to immediately after joining\n  // through an invite link, in that we could be: (a) waiting for the group\n  // secret keys to be shared with us, (b) ready to call the inviteAccept\n  // action if we haven't done so yet (because we were previously waiting for\n  // the keys), or (c) already a member and ready to interact with the group.\n  'gi.actions/group/join': function (params                              ) {\n    // This wrapper ensures that all join actions for the same contract happen in\n    // order. Because join is complex and there are many async steps involved,\n    // multiple calls to join for the same contract can result in conflicting with\n    // each other\n    return sbp('okTurtles.eventQueue/queueEvent', `JOIN_GROUP-${params.contractID}`, async () => {\n      console.debug('[gi.actions/group/join] Scheduled call starting', params.contractID, params)\n      const { loggedIn } = sbp('chelonia/rootState')\n      if (!loggedIn) throw new Error('[gi.actions/group/join] Not logged in')\n      const { identityContractID: userID } = loggedIn\n      // We want to process any current events first, so that we process leave\n      // actions and don't interfere with the leaving process (otherwise, the\n      // side-effects could prevent us from fully leaving).\n      await sbp('chelonia/contract/wait', [params.originatingContractID, params.contractID])\n\n      // When syncing the group contract, the contract might call /remove on\n      // itself if we had previously joined and left the group. By using\n      // ephemeral we ensure that it's not deleted until we've finished\n      // trying to join.\n      // We use a Set as normally params.originatingContractID and userID will\n      // be the same\n      const retainedContracts = [...new Set([params.contractID, params.originatingContractID])]\n      await sbp('chelonia/contract/retain', retainedContracts, { ephemeral: true })\n      try {\n        const rootState = sbp('chelonia/rootState')\n        if (!rootState.contracts[params.contractID]) {\n          console.warn('[gi.actions/group/join] The group contract was removed after sync. If this happened during logging in, this likely means that we left the group on a different session.', { contractID: params.contractID })\n          return\n        }\n\n        if (rootState.contracts[params.contractID].type !== 'gi.contracts/group') {\n          throw Error(`Contract ${params.contractID} is not a group`)\n        }\n\n        // At this point, we do not know whether we should continue with the\n        // join process, because we don't know where we stand in the process.\n        // One edge case we need to handle is that according to our records\n        // (in the identity contract) we're members, and we have completed\n        // all of the steps for joining in the past, but we've then been removed\n        // while we were offline. In this case, we should *not* re-join\n        // automatically, even if we have a valid invitation secret and are\n        // technically able to. However, in the previous situation we *should*\n        // attempt to rejoin if the action was user-initiated.\n        const hasKeyShareBeenRespondedBy = await sbp('chelonia/contract/hasKeyShareBeenRespondedBy', userID, params.contractID, params.reference)\n\n        const state = rootState[params.contractID]\n\n        // Do we have the secret keys with the right permissions to be able to\n        // perform all operations in the group? If we haven't, we are not\n        // able to participate in the group yet and may need to send a key\n        // request.\n        const hasSecretKeys = await sbp('chelonia/contract/receivedKeysToPerformOperation', userID, state, '*')\n\n        // Do we need to send a key request?\n        // If we don't have the group contract in our state and\n        // params.originatingContractID is set, it means that we're joining\n        // through an invite link, and we must send a key request to complete\n        // the joining process.\n        const sendKeyRequest = (!hasKeyShareBeenRespondedBy && !hasSecretKeys && !!params.originatingContractID)\n        const pendingKeyShares = await sbp('chelonia/contract/waitingForKeyShareTo', state, userID, params.reference)\n\n        // If we are expecting to receive keys, set up an event listener\n        // We are expecting to receive keys if:\n        //   (a) we are about to send a key request; or\n        //   (b) we have already sent a key request (!!pendingKeyRequests?.length)\n        if (sendKeyRequest || pendingKeyShares) {\n        // Event handler for continuing the join process if the keys are\n        // shared with us during the current session\n          const eventHandler = ({ contractID, sharedWithContractID, signingKeyName }) => {\n            if (contractID !== params.contractID || sharedWithContractID !== userID || (pendingKeyShares && !pendingKeyShares.includes(signingKeyName))) {\n              return\n            }\n\n            removeEventHandler()\n            removeLogoutHandler()\n            // The event handler recursively calls this same selector\n            // A different path should be taken, since te event handler\n            // should be called after the key request has been answered\n            // and processed\n            sbp('gi.actions/group/join', params).catch((e) => {\n              console.error('[gi.actions/group/join] Error during join (inside CONTRACT_HAS_RECEIVED_KEYS event handler)', e)\n            })\n          }\n          const logoutHandler = () => {\n            removeEventHandler()\n          }\n\n          // The event handler is configured before sending the request\n          // to avoid race conditions\n          const removeLogoutHandler = sbp('okTurtles.events/once', LOGOUT, logoutHandler)\n          const removeEventHandler = sbp('okTurtles.events/on', CONTRACT_HAS_RECEIVED_KEYS, eventHandler)\n        }\n\n        // !sendKeyRequest && !(hasSecretKeys && !pendingKeyShares) && !(!hasSecretKeys && !pendingKeyShares) && !pendingKeyShares\n\n        // After syncing the group contract, we send a key request\n        if (sendKeyRequest) {\n        // Send the key request\n        // **IMPORTANT**: DO NOT AWAIT ON /join from a function that is\n        // already waiting on the identity contract. Details:\n        // The way that chelonia/out/keyRequest works is by sending two\n        // messages to connect both contracts together.\n        // The first step is adding a new key to the identity contract.\n        // This new key has OP_KEY_SHARE permissions, as well as the\n        // permissions specified in the parameters.\n        // The second stap is sending an OP_KEY_REQUEST message to the\n        // group contract.\n        // Note that this is a two-step process that involves writing to\n        // two contracts: the current group contract and the originating\n        // (identity) contract. Calls to keyRequest require\n        // simultaneously waiting on the group and the identity\n        // (originating) contract.\n          await sbp('chelonia/out/keyRequest', {\n            ...omit(params, ['options']),\n            innerEncryptionKeyId: await sbp('chelonia/contract/currentKeyIdByName', params.contractID, 'cek'),\n            permissions: [SPMessage.OP_ACTION_ENCRYPTED],\n            allowedActions: ['gi.contracts/identity/joinDirectMessage'],\n            reference: params.reference,\n            encryptKeyRequestMetadata: true,\n            hooks: {\n              prepublish: params.hooks?.prepublish,\n              postpublish: null\n            }\n          }).catch((e) => {\n            console.error(`[gi.actions/group/join] Error while sending key request for ${params.contractID}:`, e?.message || e, e)\n            throw e\n          })\n\n          // Nothing left to do until the keys are received\n\n          // Called after logging in or during an existing session from the event\n          // handler above. It handles the tasks related to joining the group for\n          // the first time (if that's the case) or just sets this group as the\n          // current group.\n          // This block must be run after having received the group's secret keys\n          // (i.e., the CSK and the CEK) that were requested earlier.\n        } else if (hasSecretKeys && !pendingKeyShares) {\n        // We're joining for the first time\n        // In this case, we share our profile key with the group, call the\n        // inviteAccept action and join the General chatroom\n          if (state.profiles?.[userID]?.status !== PROFILE_STATUS.ACTIVE) {\n          // All reads are done here at the top to ensure that they happen\n          // synchronously, before any await calls.\n          // If reading after an asynchronous operation, we might get inconsistent\n          // values, as new operations could have been received on the contract\n            const CEKid = await sbp('chelonia/contract/currentKeyIdByName', params.contractID, 'cek')\n            const PEKid = await sbp('chelonia/contract/currentKeyIdByName', userID, 'pek')\n            const CSKid = await sbp('chelonia/contract/currentKeyIdByName', params.contractID, 'csk')\n            const userCSKid = await sbp('chelonia/contract/currentKeyIdByName', userID, 'csk')\n            const userCSKdata = rootState[userID]._vm.authorizedKeys[userCSKid].data\n\n            try {\n              const existingForeignKeys = await sbp('chelonia/contract/foreignKeysByContractID', params.contractID, userID)\n\n              await sbp('chelonia/out/atomic', {\n                ...omit(params, ['options', 'action', 'hooks', 'encryptionKeyId', 'signingKeyId']),\n                data: [\n                  // Share our PEK with the group so that group members can see\n                  // our name and profile information\n                  PEKid && await sbp('gi.actions/out/shareVolatileKeys', {\n                    contractID: params.contractID,\n                    contractName: 'gi.contracts/group',\n                    subjectContractID: userID,\n                    keyIds: [PEKid],\n                    returnInvocation: true\n                  }),\n                  // Check to avoid adding existing keys to the contract\n                  !existingForeignKeys?.includes(userCSKid) && ['chelonia/out/keyAdd', {\n                    contractID: params.contractID,\n                    contractName: 'gi.contracts/group',\n                    data: [encryptedOutgoingData(params.contractID, CEKid, {\n                      foreignKey: `shelter:${encodeURIComponent(userID)}?keyName=${encodeURIComponent('csk')}`,\n                      id: userCSKid,\n                      data: userCSKdata,\n                      permissions: [SPMessage.OP_ACTION_ENCRYPTED + '#inner'],\n                      allowedActions: '*',\n                      purpose: ['sig'],\n                      ringLevel: Number.MAX_SAFE_INTEGER,\n                      name: `${userID}/${userCSKid}`\n                    })],\n                    signingKeyId: CSKid\n                  }],\n                  // Send inviteAccept action to the group to add ourselves to the members list\n                  await sbp('gi.actions/group/inviteAccept', {\n                    ...omit(params, ['options', 'action', 'hooks', 'encryptionKeyId', 'signingKeyId']),\n                    data: {\n                      // The 'reference' value is used to help keep group joins\n                      // updated. A matching value is required when leaving a group,\n                      // which prevents us from accidentally leaving a group due to\n                      // a previous leave action when re-joining\n                      reference: rootState[userID].groups[params.contractID].hash\n                    },\n                    returnInvocation: true\n                  })\n                ].filter(Boolean),\n                signingKeyId: CSKid,\n                hooks: {\n                  prepublish: params.hooks?.prepublish,\n                  postpublish: null\n                }\n              })\n\n              // lastLoggedIn defaults to join date, hence there's no need to set\n              // it here\n            } catch (e) {\n              console.error(`[gi.actions/group/join] Error while accepting invite ${params.contractID}:`, e)\n              throw e\n            }\n          }\n\n          await sbp('chelonia/contract/wait', params.contractID)\n          sbp('okTurtles.events/emit', JOINED_GROUP, { identityContractID: userID, groupContractID: params.contractID })\n          // We don't have the secret keys and we're not waiting for OP_KEY_SHARE\n          // This means that we've been removed from the group\n        } else if (!hasSecretKeys && !pendingKeyShares) {\n        // We have already sent a key request that hasn't been answered. We cannot\n        // do much at this point, so we do nothing.\n        // This could happen, for example, after logging in if we still haven't\n        // received a response to the key request.\n        } else if (pendingKeyShares) {\n          console.info('Requested to join group but already waiting for OP_KEY_SHARE. contractID=' + params.contractID)\n        } else {\n          console.error('Requested to join group but the state appears invalid. This should be unreachable. contractID=' + params.contractID, { sendKeyRequest, hasSecretKeys, pendingKeyShares })\n        }\n      } catch (e) {\n        console.error('gi.actions/group/join failed!', e)\n        throw e\n      } finally {\n      // If we called join but it didn't result in any actions being sent, we\n      // may have left the group. In this case, we execute any pending /remove\n      // actions on the contract. This will have no side-effects if /remove on\n      // the group contract hasn't been called.\n        await sbp('chelonia/contract/release', retainedContracts, { ephemeral: true })\n      }\n    }).then(() => {\n      const map                   = sbp('okTurtles.data/get', JOINED_FAILED_KEY)\n      map?.delete(params.contractID)\n    }).catch(e => {\n      let map                   = sbp('okTurtles.data/get', JOINED_FAILED_KEY)\n      if (!map) {\n        map = new Map()\n        sbp('okTurtles.data/set', JOINED_FAILED_KEY, map)\n      }\n\n      map.set(params.contractID, params)\n\n      const scheduleReattempt = () => {\n        if (reattemptTimeoutId === undefined) {\n          reattemptTimeoutId = setTimeout(() => {\n            reattemptTimeoutId = undefined\n            if (map.size === 0) return\n\n            sbp('gi.actions/group/reattemptFailedJoins').catch(e => {\n              console.error('Error running reattemptFailedJoins', e)\n              scheduleReattempt()\n            })\n          }, 60e3)\n        }\n      }\n      scheduleReattempt()\n\n      throw e\n    })\n  },\n  'gi.actions/group/joinWithInviteSecret': async function (groupId        , secret        ) {\n    const identityContractID = sbp('state/vuex/state').loggedIn.identityContractID\n\n    // This action (`joinWithInviteSecret`) can get invoked while there are\n    // events being processed in the group or identity contracts. This can cause\n    // issues when re-joining a group, because the logic that keeps track\n    // of adding or removing groups from the identity contract may interfere,\n    // making us leave the group that we're trying to rejoin (what happens is\n    // (1) old group leave (2) leave in identity contract (3) join in identity\n    // contract (4) because of some other sync in the group contract, leave again\n    // on the identity contract, which is an error)\n    // We can avoid this by waiting on both contracts, especially the group\n    // contract.\n    await sbp('chelonia/contract/wait', [groupId, identityContractID])\n    try {\n      // Similarly, because not all events may have been processed, including\n      // side-effects, the group contract may be released too early (when\n      // re-joining a group, there could be an action for leaving the\n      // group that is pending processing). The following pattern (ephemeral\n      // retain + ephemeral release) ensures that we won't unsubscribe to it\n      // until we know what the next step is.\n      // Because the retain is paired with a release, at worst this will have\n      // no effect on the lifetime of the group contract.\n      await sbp('chelonia/contract/retain', groupId, { ephemeral: true })\n      await sbp('gi.actions/identity/joinGroup', {\n        contractID: identityContractID,\n        contractName: 'gi.contracts/identity',\n        data: {\n          groupContractID: groupId,\n          inviteSecret: secret\n        }\n      })\n    } finally {\n      await sbp('chelonia/contract/release', groupId, { ephemeral: true })\n    }\n  },\n  'gi.actions/group/reattemptFailedJoins': async function () {\n    const ourGroups = sbp('state/vuex/getters').ourGroups\n    const map                   = sbp('okTurtles.data/get', JOINED_FAILED_KEY)\n    if (!map) return\n\n    return await Promise.allSettled([...map.entries()].map(([contractID, params]) => {\n      if (!ourGroups.includes(contractID)) {\n        map.delete(contractID)\n        return undefined\n      }\n\n      return sbp('gi.actions/group/join', params).catch(e => {\n        console.error('Error on group join re-attempt', params, e)\n\n        throw e\n      })\n    })).then((results) => {\n      if (results.some(result => result.status === 'rejected')) {\n        throw new Error('Error on group join re-attempt')\n      }\n    })\n  },\n  'gi.actions/group/shareNewKeys': async (contractID        , newKeys) => {\n    const rootState = sbp('chelonia/rootState')\n    const state = rootState[contractID]\n    const mainCEKid = await sbp('chelonia/contract/currentKeyIdByName', state, 'cek')\n\n    // $FlowFixMe\n    return Promise.all(\n      Object.entries(state.profiles)\n        .filter(([_, p]) => (p     ).status === PROFILE_STATUS.ACTIVE)\n        .map(async ([pContractID]) => {\n          const CEKid = await sbp('chelonia/contract/currentKeyIdByName', rootState[pContractID], 'cek')\n          if (!CEKid) {\n            console.warn(`Unable to share rotated keys for ${contractID} with ${pContractID}: Missing CEK`)\n            return\n          }\n          return [\n            'chelonia/out/keyShare',\n            {\n              data: encryptedOutgoingData(contractID, mainCEKid, {\n                contractID,\n                foreignContractID: pContractID,\n                // $FlowFixMe\n                keys: Object.values(newKeys).map(([, newKey, newId]                    ) => ({\n                  id: newId,\n                  meta: {\n                    private: {\n                      content: encryptedOutgoingData(pContractID, CEKid, serializeKey(newKey, true))\n                    }\n                  }\n                }))\n              })\n            }]\n        })).then((keys) => [keys.filter(Boolean)])\n  },\n  ...encryptedAction('gi.actions/group/addChatRoom', L('Failed to add chat channel'), async function (sendMessage, params) {\n    const rootState = sbp('chelonia/rootState')\n    const contractState = rootState[params.contractID]\n    const userID = rootState.loggedIn.identityContractID\n    for (const contractId in contractState.chatRooms) {\n      if (params.data.attributes.name.toUpperCase().normalize() === contractState.chatRooms[contractId].name.toUpperCase().normalize()) {\n        throw new GIErrorUIRuntimeError(L('Duplicate channel name'))\n      }\n    }\n\n    const cskId = await sbp('chelonia/contract/currentKeyIdByName', contractState, 'csk')\n    const csk = {\n      id: cskId,\n      foreignKey: `shelter:${encodeURIComponent(params.contractID)}?keyName=${encodeURIComponent('csk')}`,\n      data: contractState._vm.authorizedKeys[cskId].data\n    }\n\n    const cekId = await sbp('chelonia/contract/currentKeyIdByName', contractState, 'cek')\n    const cek = {\n      id: cekId,\n      foreignKey: `shelter:${encodeURIComponent(params.contractID)}?keyName=${encodeURIComponent('cek')}`,\n      data: contractState._vm.authorizedKeys[cekId].data\n    }\n\n    // For 'public' and 'group' chatrooms, use the group's CSK and CEK\n    const privateChatroom = ![CHATROOM_PRIVACY_LEVEL.GROUP, CHATROOM_PRIVACY_LEVEL.PUBLIC].includes(params.data.attributes.privacyLevel)\n\n    const message = await sbp('gi.actions/chatroom/create', {\n      data: {\n        ...params.data,\n        attributes: {\n          adminIDs: [contractState.groupOwnerID],\n          ...params.data?.attributes\n        }\n      },\n      options: {\n        ...params.options,\n        // The CSK and the CEK are the group's for non-private chatrooms\n        // Otherwise, these are different from the group's, but they're still\n        // passed as groupKeys, so that membership operations can be mirrored\n        ...(!privateChatroom\n          ? {\n              csk, cek\n            }\n          : {\n              groupKeys: [csk, cek]\n            })\n      },\n      hooks: {\n        prepublish: params.hooks?.prepublish,\n        postpublish: null\n      }\n    }, params.contractID)\n\n    // When creating a public chatroom, that chatroom's secret keys are shared\n    // with the group (i.e., they are literally the same keys, using the\n    // foreignKey functionality). However, private chatrooms keep separate keys\n    // which must be shared using OP_KEY_SHARE\n    if (privateChatroom) {\n      await sbp('gi.actions/out/shareVolatileKeys', {\n        contractID: userID,\n        contractName: 'gi.contracts/identity',\n        subjectContractID: message.contractID(),\n        keyIds: '*'\n      })\n    }\n\n    await sendMessage({\n      ...omit(params, ['options', 'action', 'data', 'hooks']),\n      data: {\n        ...params.data,\n        chatRoomID: message.contractID()\n      },\n      hooks: {\n        prepublish: null,\n        postpublish: params.hooks?.postpublish\n      }\n    })\n\n    return message\n  }),\n  ...encryptedAction('gi.actions/group/joinChatRoom', L('Failed to join chat channel.'), async function (sendMessage, params) {\n    const rootState = sbp('chelonia/rootState')\n    const { identityContractID } = rootState.loggedIn\n    const memberID = params.data.memberID || identityContractID\n    const chatRoomID = params.data.chatRoomID\n    const groupContractID = params.contractID\n\n    // If we are inviting someone else to join, we need to share the chatroom's keys\n    // with them so that they are able to read messages and participate\n    if (memberID !== identityContractID && rootState[chatRoomID].attributes.privacyLevel === CHATROOM_PRIVACY_LEVEL.PRIVATE) {\n      await sbp('gi.actions/out/shareVolatileKeys', {\n        contractID: memberID,\n        contractName: 'gi.contracts/identity',\n        subjectContractID: chatRoomID,\n        keyIds: '*'\n      })\n    }\n\n    const switchChannelAfterJoined = (contractID        ) => {\n      if (contractID === chatRoomID) {\n        if (rootState[chatRoomID]?.members?.[identityContractID]) {\n          sbp('okTurtles.events/emit', JOINED_CHATROOM, { identityContractID, groupContractID, chatRoomID })\n          sbp('okTurtles.events/off', EVENT_HANDLED, switchChannelAfterJoined)\n        }\n      }\n    }\n    sbp('okTurtles.events/on', EVENT_HANDLED, switchChannelAfterJoined)\n\n    return sendMessage({\n      ...omit(params, ['options', 'action'])\n    })\n  }),\n  'gi.actions/group/addAndJoinChatRoom': async function (params                ) {\n    // Retain needed for the sync placed later to be guaranteed to work\n    await sbp('chelonia/contract/retain', params.contractID, { ephemeral: true })\n    try {\n      const message = await sbp('gi.actions/group/addChatRoom', {\n        ...omit(params, ['options', 'hooks']),\n        hooks: {\n          prepublish: params.hooks?.prepublish,\n          postpublish: null\n        }\n      })\n\n      const chatRoomID = message.contractID()\n\n      // Sync needed here to avoid \"Cannot join a chatroom which isn't part of\n      // the group\" error\n      await sbp('chelonia/contract/sync', params.contractID)\n      await sbp('gi.actions/group/joinChatRoom', {\n        ...omit(params, ['options', 'data', 'hooks']),\n        data: { chatRoomID },\n        hooks: {\n          postpublish: params.hooks?.postpublish\n        }\n      })\n\n      return chatRoomID\n    } finally {\n      sbp('chelonia/contract/release', params.contractID, { ephemeral: true }).catch(e =>\n        console.error('[gi.actions/group/addAndJoinChatRoom] Error releasing group chatroom', e)\n      )\n    }\n  },\n  ...encryptedAction('gi.actions/group/renameChatRoom', L('Failed to rename chat channel.'), async function (sendMessage, params) {\n    await sbp('gi.actions/chatroom/rename', {\n      ...omit(params, ['options', 'contractID', 'data', 'hooks']),\n      contractID: params.data.chatRoomID,\n      data: {\n        name: params.data.name\n      },\n      hooks: {\n        prepublish: params.hooks?.prepublish,\n        postpublish: null\n      }\n    })\n\n    return await sendMessage({\n      ...omit(params, ['options', 'action', 'hooks']),\n      hooks: {\n        prepublish: null,\n        postpublish: params.hooks?.postpublish\n      }\n    })\n  }),\n  'gi.actions/group/removeOurselves': (params                ) => {\n    return sbp('gi.actions/group/removeMember', {\n      ...omit(params, ['options', 'action']),\n      data: {}\n    })\n  },\n  ...encryptedAction('gi.actions/group/removeMember',\n    (params, e) => params.data.memberID ? L('Failed to remove {memberID}: {reportError}', { memberID: params.data.memberID, ...LError(e) }) : L('Failed to leave group. {codeError}', { codeError: e.message }),\n    async function (sendMessage, params, signingKeyId) {\n      await sendMessage({\n        ...omit(params, ['options', 'action'])\n      })\n    }),\n  ...encryptedAction('gi.actions/group/changeChatRoomDescription',\n    L('Failed to update description of chat channel.'),\n    async function (sendMessage, params                ) {\n      await sbp('gi.actions/chatroom/changeDescription', {\n        ...omit(params, ['options', 'contractID', 'data', 'hooks']),\n        contractID: params.data.chatRoomID,\n        data: {\n          description: params.data.description\n        },\n        hooks: {\n          prepublish: params.hooks?.prepublish,\n          postpublish: null\n        }\n      })\n\n      // NOTE: group contract should keep updated with all attributes of its chatrooms\n      //       so that group members can check chatroom details whether or not they are part of\n      return sendMessage({\n        ...omit(params, ['options', 'action', 'hooks']),\n        hooks: {\n          prepublish: null,\n          postpublish: params.hooks?.postpublish\n        }\n      })\n    }),\n  'gi.actions/group/autobanUser': async function (message           , error        , msgMeta                                                                                                                , attempt = 1) {\n    try {\n      if (attempt === 1) {\n        // to decrease likelihood of multiple proposals being created at the same time, wait\n        // a random amount of time on the first call\n        setTimeout(() => {\n          sbp('gi.actions/group/autobanUser', message, error, msgMeta, attempt + 1)\n            .catch((e) => {\n              console.error('[gi.actions/group/autobanUser] Error from setTimeout callback (1st attempt)', e)\n            })\n        }, randomIntFromRange(0, 5000))\n        return\n      }\n      // If we just joined, we're likely witnessing an old error that was handled\n      // by the existing members, so we shouldn't attempt to participate in voting\n      // in a proposal that has long since passed.\n      //\n      // NOTE: we cast to 'any' to work around flow errors\n      //       see: https://stackoverflow.com/a/41329247/1781435\n      const memberID = msgMeta && msgMeta.innerSigningContractID\n      const groupID = message.contractID()\n      const rootState = sbp('chelonia/rootState')\n      const contractState = rootState[groupID]\n      if (memberID && rootState.contracts[groupID]?.type === 'gi.contracts/group' && contractState?.profiles?.[memberID]?.status === PROFILE_STATUS.ACTIVE) {\n        const rootGetters = sbp('state/vuex/getters')\n        const username = rootGetters.usernameFromID(memberID)\n        console.warn(`autoBanSenderOfMessage: autobanning ${memberID} (username ${username}) from ${groupID}`)\n        // find existing proposal if it exists\n        let [proposalHash, proposal]                    = Object.entries(contractState.proposals)\n          .find(([hash, prop]                  ) => (\n            prop.status === STATUS_OPEN &&\n            prop.data.proposalType === PROPOSAL_REMOVE_MEMBER &&\n            prop.data.proposalData.memberID === memberID\n          )) ?? ['', undefined]\n        if (proposal) {\n          // cast our vote if we haven't already cast it\n          if (!proposal.votes[rootState.loggedIn.identityContractID]) {\n            await sbp('gi.actions/group/proposalVote', {\n              contractID: groupID,\n              data: { proposalHash, vote: VOTE_FOR, passPayload: { secret: '' } },\n              publishOptions: { maxAttempts: 3 }\n            })\n          }\n        } else {\n          // create our proposal to ban the user\n          try {\n            proposal = await sbp('gi.actions/group/proposal', {\n              contractID: groupID,\n              data: {\n                proposalType: PROPOSAL_REMOVE_MEMBER,\n                proposalData: {\n                  memberID,\n                  reason: L(\"Automated ban because they're sending malformed messages resulting in: {error}\", { error: error.message }),\n                  automated: true\n                },\n                votingRule: contractState.settings.proposals[PROPOSAL_REMOVE_MEMBER].rule,\n                expires_date_ms: Date.now() + contractState.settings.proposals[PROPOSAL_REMOVE_MEMBER].expires_ms\n              },\n              publishOptions: { maxAttempts: 1 }\n            })\n          } catch (e) {\n            if (attempt > 3) {\n              console.error(`autoBanSenderOfMessage: max attempts reached. Error ${e.message} attempting to ban ${memberID}`, message, e)\n            } else {\n              const randDelay = randomIntFromRange(0, 1500)\n              console.warn(`autoBanSenderOfMessage: ${e.message} attempting to ban ${memberID}, retrying in ${randDelay} ms...`, e)\n              setTimeout(() => {\n                sbp('gi.actions/group/autobanUser', message, error, msgMeta, attempt + 1)\n                  .catch((e) => {\n                    console.error('[gi.actions/group/autobanUser] Error from setTimeout callback (> 3rd attempt)', e)\n                  })\n              }, randDelay)\n            }\n          }\n        }\n      }\n    } catch (e) {\n      console.error(`${e.name} during autoBanSenderOfMessage!`, message, e)\n      // we really can't do much at this point since this is an exception\n      // inside of the exception handler :-(\n    }\n  },\n  'gi.actions/group/notifyProposalStateInGeneralChatRoom': async function ({ groupID, proposal }                                       ) {\n    const { generalChatRoomId } = await sbp('chelonia/contract/state', groupID)\n    return sbp('gi.actions/chatroom/addMessage', {\n      contractID: generalChatRoomId,\n      data: { type: MESSAGE_TYPES.INTERACTIVE, proposal }\n    })\n  },\n  ...encryptedAction('gi.actions/group/notifyExpiringProposals', L('Failed to notify expiring proposals.'), async function (sendMessage, params) {\n    const { proposals } = params.data\n    await sendMessage({\n      ...omit(params, ['options', 'data', 'action', 'hooks']),\n      data: { proposalIds: proposals.map(p => p.proposalId) },\n      hooks: {\n        prepublish: params.hooks?.prepublish,\n        postpublish: null\n      }\n    })\n\n    for (let i = 0; i < proposals.length; i++) {\n      await sbp('gi.actions/group/notifyProposalStateInGeneralChatRoom', {\n        groupID: params.contractID,\n        proposal: { ...proposals[i], status: STATUS_EXPIRING }\n      })\n    }\n  }),\n  ...encryptedAction('gi.actions/group/leaveChatRoom', L('Failed to leave chat channel.'), async (sendMessage, params) => {\n    const state = await sbp('chelonia/contract/state', params.contractID)\n    const memberID = params.data.memberID || sbp('state/vuex/state').loggedIn.identityContractID\n    const joinedHeight = state.chatRooms[params.data.chatRoomID].members[memberID].joinedHeight\n\n    // For more efficient and correct processing, augment the leaveChatRoom\n    // action with the height of the join action. This helps prevent reduce\n    // the logic running as side-effects when syncing contracts from scratch\n    // by only considering the most recent join/leave events.\n    await sendMessage({\n      ...params,\n      data: {\n        ...params.data,\n        joinedHeight\n      }\n    })\n  }),\n  ...encryptedAction('gi.actions/group/deleteChatRoom', L('Failed to delete chat channel.')),\n  ...encryptedAction('gi.actions/group/invite', L('Failed to create invite.')),\n  ...encryptedAction('gi.actions/group/inviteAccept', L('Failed to accept invite.'), async function (sendMessage, params) {\n    const response = await sendMessage(params)\n    sbp('okTurtles.events/emit', ACCEPTED_GROUP, { contractID: params.contractID })\n    return response\n  }),\n  ...encryptedAction('gi.actions/group/inviteRevoke', L('Failed to revoke invite.'), async function (sendMessage, params, signingKeyId) {\n    await sbp('chelonia/out/keyDel', {\n      contractID: params.contractID,\n      contractName: 'gi.contracts/group',\n      data: [params.data.inviteKeyId],\n      signingKeyId\n    })\n\n    return sendMessage(params)\n  }),\n  ...encryptedAction('gi.actions/group/payment', L('Failed to create payment.')),\n  ...encryptedAction('gi.actions/group/paymentUpdate', L('Failed to update payment.')),\n  ...encryptedAction('gi.actions/group/sendPaymentThankYou', L('Failed to send a payment thank you note.')),\n  ...encryptedAction('gi.actions/group/groupProfileUpdate', L('Failed to update group profile.')),\n  ...encryptedAction('gi.actions/group/proposal', L('Failed to create proposal.'), (sendMessage, params) => {\n    const { contractID } = params\n    return sendMessage({\n      ...params,\n      hooks: {\n        onprocessed: async (message) => {\n          try {\n            const proposalId = message.hash()\n            const state = await sbp('chelonia/contract/state', contractID)\n            const proposal = state.proposals[proposalId]\n            const proposalToSend = extractProposalData(proposal, { proposalId, status: STATUS_OPEN })\n\n            await sbp('gi.actions/group/notifyProposalStateInGeneralChatRoom', { groupID: contractID, proposal: proposalToSend })\n          } catch (e) {\n            console.error(`[gi.actions/group/proposal] Error while notifying proposal creation in general chatroom ${contractID}:`, e)\n            throw e\n          }\n        }\n      }\n    })\n  }),\n  ...encryptedAction('gi.actions/group/proposalVote', L('Failed to vote on proposal.'), async (sendMessage, params) => {\n    const { contractID, data } = params\n    const state = await sbp('chelonia/contract/state', contractID)\n    const proposalHash = data.proposalHash\n    const proposal = state.proposals[proposalHash]\n    const type = proposal.data.proposalType\n\n    const willBePassed = oneVoteToPass(state, proposalHash)\n    const willBeFailed = oneVoteToFail(state, proposalHash)\n    const isVoteFor = data.vote === VOTE_FOR\n    const isVoteAgainst = !isVoteFor\n    let passPayload = isVoteFor ? {} : undefined\n    let proposalToSend\n\n    if (willBePassed && isVoteFor) {\n      if (type === PROPOSAL_INVITE_MEMBER) {\n        passPayload = await createInvite({\n          contractID,\n          invitee: proposal.data.proposalData.memberName,\n          creatorID: proposal.creatorID,\n          expires: state.settings.inviteExpiryProposal\n        })\n      }\n\n      proposalToSend = extractProposalData(proposal, { proposalId: proposalHash, status: STATUS_PASSED })\n    } else if (willBeFailed && isVoteAgainst) {\n      proposalToSend = extractProposalData(proposal, { proposalId: proposalHash, status: STATUS_FAILED })\n    }\n\n    const response = await sendMessage({ ...params, data: { ...data, passPayload } })\n\n    if (proposalToSend) {\n      // NOTE: sometimes 'notifyProposalStateInGeneralChatRoom' function could be called\n      //       after the 'proposalVote' event is finished its processing (published, received, called process/sideEffect)\n      //       it's not a big problem unless the proposal to remove someone from the group is accepted by the current vote.\n      //       it's when the two messages will be created in general chatroom; one is to tells the proposal is approved\n      //       and the other is to tell the member is left general chatroom.\n      //       the order of two functions that will be called means the order of the two messages in general chatroom.\n      //       so the order of messages isn't always same and that could cause the heisenbug below\n      // https://github.com/okTurtles/group-income/tree/2226-heisenbug-in-group-chatspecjs-more-persistent-one\n      await sbp('gi.actions/group/notifyProposalStateInGeneralChatRoom', {\n        groupID: contractID,\n        proposal: proposalToSend\n      })\n    }\n\n    return response\n  }),\n  ...encryptedAction('gi.actions/group/proposalCancel', L('Failed to cancel proposal.'), async function (sendMessage, params) {\n    const { contractID, data } = params\n    const state = await sbp('chelonia/contract/state', contractID)\n    const proposal = state.proposals[data.proposalHash]\n    const proposalToSend = extractProposalData(proposal, { proposalId: data.proposalHash, status: STATUS_CANCELLED })\n\n    const response = await sendMessage(params)\n\n    await sbp('gi.actions/group/notifyProposalStateInGeneralChatRoom', { groupID: contractID, proposal: proposalToSend })\n\n    return response\n  }),\n  ...encryptedAction('gi.actions/group/markProposalsExpired', L('Failed to mark proposals expired.'), async function (sendMessage, params) {\n    const { contractID, data } = params\n    const state = await sbp('chelonia/contract/state', contractID)\n\n    for (const proposalHash of data.proposalIds) {\n      const proposal = state.proposals[proposalHash]\n      const proposalToSend = extractProposalData(proposal, { proposalId: proposalHash, status: STATUS_EXPIRED })\n\n      await sbp('gi.actions/group/notifyProposalStateInGeneralChatRoom', { groupID: contractID, proposal: proposalToSend })\n    }\n\n    const response = await sendMessage(params)\n    return response\n  }),\n  'gi.actions/group/_ondeleted': async (contractID        , state        ) => {\n    const rootGetters = sbp('state/vuex/getters')\n    const identityContractID = rootGetters.ourIdentityContractId\n    const currentIdentityState = rootGetters.currentIdentityState\n\n    if (!!currentIdentityState.groups?.[contractID] && !currentIdentityState.groups[contractID].hasLeft) {\n      await sbp('gi.actions/identity/leaveGroup', {\n        contractID: identityContractID,\n        data: {\n          groupContractID: contractID,\n          reference: state.profiles?.[identityContractID]?.reference\n        }\n      }).catch(e => {\n        console.warn(`[handleDeletedContract] ${e.name} thrown by gi.actions/identity/leaveGroup ${identityContractID} for ${contractID}:`, e)\n      })\n    }\n  },\n  ...encryptedAction('gi.actions/group/updateSettings', L('Failed to update group settings.')),\n  ...encryptedAction('gi.actions/group/updateAllVotingRules', (params, e) => L('Failed to update voting rules. {codeError}', { codeError: e.message })),\n  ...encryptedAction('gi.actions/group/updateDistributionDate', L('Failed to update group distribution date.')),\n  ...encryptedAction('gi.actions/group/updateGroupInviteExpiry', L('Failed to update group invite expiry.')),\n  ...((process.env.NODE_ENV === 'development' || process.env.CI) && {\n    ...encryptedAction('gi.actions/group/forceDistributionDate', L('Failed to force distribution date.'))\n  })\n})          )\n", "'use strict'\nimport sbp from '@sbp/sbp'\nimport { KV_KEYS, LAST_LOGGED_IN_THROTTLE_WINDOW } from '~/frontend/utils/constants.js'\nimport { KV_QUEUE, NEW_LAST_LOGGED_IN, ONLINE } from '~/frontend/utils/events.js'\n\nsbp('okTurtles.events/on', ONLINE, () => {\n  if (!sbp('state/vuex/state').loggedIn?.identityContractID) {\n    return\n  }\n  sbp('gi.actions/group/kv/load').catch(e => {\n    console.error(\"Error from 'gi.actions/group/kv/load' after reestablished connection:\", e)\n  })\n})\n\nexport default (sbp('sbp/selectors/register', {\n  'gi.actions/group/kv/load': async () => {\n    console.info('loading data from group key-value store...')\n    const cheloniaState = await sbp('chelonia/rootState')\n    const identityContractID = cheloniaState.loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to fetch group data without an active session')\n    }\n    await Promise.all(\n      Object.entries(cheloniaState[identityContractID].groups || {}).map(([contractID, state]) => {\n        // $FlowFixMe[incompatible-type]\n        if (state.hasLeft) return undefined\n        return sbp('chelonia/queueInvocation', contractID, ['gi.actions/group/kv/loadLastLoggedIn', { contractID }])\n      })\n    )\n    console.info('group key-value store data loaded!')\n  },\n  'gi.actions/group/kv/fetchLastLoggedIn': async ({ contractID }                        ) => {\n    const kvData = await sbp('chelonia/kv/get', contractID, KV_KEYS.LAST_LOGGED_IN)\n    // kvData could be falsy if the server returns 404\n    if (kvData) {\n      // Note: this could throw an exception if there's a signature or decryption\n      // issue\n      return kvData.data\n    }\n    return Object.create(null)\n  },\n  'gi.actions/group/kv/loadLastLoggedIn': ({ contractID }                        ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const data = await sbp('gi.actions/group/kv/fetchLastLoggedIn', { contractID })\n      sbp('okTurtles.events/emit', NEW_LAST_LOGGED_IN, [contractID, data])\n    }).catch(e => {\n      console.error('[gi.actions/group/kv/loadLastLoggedIn] Error loading last logged in', e)\n    })\n  },\n  'gi.actions/group/kv/updateLastLoggedIn': ({ contractID, throttle }                                           ) => {\n    const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to update lastLoggedIn without an active session')\n    }\n\n    const now = sbp('chelonia/time')\n    if (throttle) {\n      const state = sbp('state/vuex/state')\n      const lastLoggedInRawValue          = state.lastLoggedIn?.[contractID]?.[identityContractID]\n      if (lastLoggedInRawValue) {\n        const lastLoggedIn = new Date(lastLoggedInRawValue).getTime()\n\n        if ((now - lastLoggedIn) < LAST_LOGGED_IN_THROTTLE_WINDOW) return\n      }\n    }\n\n    const nowString = new Date(now).toISOString()\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const constructUpdatedLastLoggedIn = ({ etag, currentData = {} } = {}) => {\n        return [{ ...currentData, [identityContractID]: nowString }, etag]\n      }\n\n      const data = constructUpdatedLastLoggedIn()[0]\n      await sbp('chelonia/kv/set', contractID, KV_KEYS.LAST_LOGGED_IN, data, {\n        encryptionKeyId: await sbp('chelonia/contract/currentKeyIdByName', contractID, 'cek'),\n        signingKeyId: await sbp('chelonia/contract/currentKeyIdByName', contractID, 'csk'),\n        onconflict: constructUpdatedLastLoggedIn\n      })\n    })\n  }\n})          )\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport { CURVE25519XSALSA20POLY1305, decrypt, encrypt, generateSalt, keyId, keygen, serializeKey } from '@chelonia/crypto'\n\nconst _instances                       = []\n// Localforage-like API for IndexedDB\nconst localforage = {\n  async ready () {\n    await Promise.all(_instances.map((lazyInitDb) => lazyInitDb()))\n  },\n  createInstance ({ name, storeName }                                     ) {\n    // Open the IndexedDB database\n    // We lazy load the IndexedDB, because before we were loading it when this\n    // file was imported, but on iOS IndexedDB is not available in the service\n    // worker when the PWA is in the background.\n    // <https://bugs.webkit.org/show_bug.cgi?id=283793>\n    // So for that reason, and potentially other situations where IndexedDB\n    // might not be available, we lazy load it like this upon creation.\n    const lazyInitDb = (() => {\n      let promise\n      return () => {\n        if (!promise) {\n          promise = new Promise((resolve, reject) => {\n            if (name.includes('-') || storeName.includes('-')) {\n              reject(new Error('Unsupported characters in name: -'))\n              return\n            }\n\n            const openDB = (version         ) => {\n              // By default `version` is the latest DB version. Initially, we\n              // try to open that, but in some cases (e.g., when manually\n              // deleting the DBs), the schema will be wrong and miss the object\n              // store. In these cases, we need to upgrade the DB by\n              // incrementing the version number to re-create the schema, which\n              // can only be done when the DB is being 'upgraded'.\n              const request = self.indexedDB.open(name + '--' + storeName, version)\n\n              // Create the object store if it doesn't exist\n              request.onupgradeneeded = (event) => {\n                const db = event.target.result\n                db.createObjectStore(storeName)\n              }\n\n              request.onsuccess = (event) => {\n                const db = event.target.result\n                if (!db.objectStoreNames.contains(storeName)) {\n                  return openDB(db.version + 1)\n                }\n\n                resolve(db)\n              }\n\n              request.onerror = (error) => {\n                reject(error)\n              }\n\n              // If this happens, closing all tabs and stopping the SW could\n              // help.\n              request.onblocked = (event) => {\n                reject(new Error('DB is blocked'))\n              }\n            }\n\n            openDB()\n          })\n        }\n        return promise\n      }\n    })()\n\n    _instances.push(lazyInitDb)\n\n    return {\n      async clear () {\n        const db = await lazyInitDb()\n        const transaction = db.transaction([storeName], 'readwrite')\n        const objectStore = transaction.objectStore(storeName)\n        const request = objectStore.clear()\n        return new Promise((resolve, reject) => {\n          request.onsuccess = () => {\n            resolve()\n          }\n          request.onerror = (e) => {\n            reject(e)\n          }\n        })\n      },\n      async getItem (key        ) {\n        const db = await lazyInitDb()\n        const transaction = db.transaction([storeName], 'readonly')\n        const objectStore = transaction.objectStore(storeName)\n        const request = objectStore.get(key)\n        return new Promise((resolve, reject) => {\n          request.onsuccess = (event) => {\n            resolve(event.target.result)\n          }\n          request.onerror = (e) => {\n            reject(e)\n          }\n        })\n      },\n      async removeItem (key        ) {\n        const db = await lazyInitDb()\n        const transaction = db.transaction([storeName], 'readwrite')\n        const objectStore = transaction.objectStore(storeName)\n        const request = objectStore.delete(key)\n        return new Promise((resolve, reject) => {\n          request.onsuccess = () => {\n            resolve()\n          }\n          request.onerror = (e) => {\n            reject(e.target.error)\n          }\n        })\n      },\n      async setItem (key        , value     ) {\n        const db = await lazyInitDb()\n        const transaction = db.transaction([storeName], 'readwrite')\n        const objectStore = transaction.objectStore(storeName)\n        const request = objectStore.put(value, key)\n        return new Promise((resolve, reject) => {\n          request.onsuccess = () => {\n            resolve()\n          }\n          request.onerror = (e) => {\n            reject(e.target.error)\n          }\n        })\n      }\n    }\n  }\n}\n\nexport const generateEncryptionParams = async (stateKeyEncryptionKeyFn                                                            ) =>                               \n                               \n               \n                                     \n                                     {\n  // Create the necessary keys\n  // First, we generate the state encryption key\n  const stateEncryptionKey = keygen(CURVE25519XSALSA20POLY1305)\n  const stateEncryptionKeyId = keyId(stateEncryptionKey)\n  const stateEncryptionKeyS = serializeKey(stateEncryptionKey, true)\n  const stateEncryptionKeyP = serializeKey(stateEncryptionKey, false)\n\n  // Once we have the state encryption key, we generate a salt\n  const salt = generateSalt()\n\n  // We use the salt, the state encryption key ID and the password to\n  // derive a key to encrypt the state encryption key\n  // This key is not stored anywhere, but is used for reconstructing\n  // the state on a fresh session\n  const stateKeyEncryptionKey = await stateKeyEncryptionKeyFn(stateEncryptionKeyId, salt)\n\n  // Once everything is place, encrypt the state encryption key\n  const encryptedStateEncryptionKey = encrypt(stateKeyEncryptionKey, stateEncryptionKeyS, stateEncryptionKeyId)\n\n  return {\n    encryptionParams: {\n      stateEncryptionKeyId,\n      salt,\n      encryptedStateEncryptionKey\n    },\n    stateEncryptionKeyP\n  }\n}\n\nif (process.env.LIGHTWEIGHT_CLIENT !== 'true') {\n  const log = localforage.createInstance({\n    name: 'Group Income',\n    storeName: 'Contracts'\n  })\n  // use localforage for storage\n  sbp('sbp/selectors/overwrite', {\n    'chelonia.db/get': key => log.getItem(key),\n    // TODO: handle QuotaExceededError\n    'chelonia.db/set': (key, value) => log.setItem(key, value),\n    'chelonia.db/delete': (key        ) => log.removeItem(key)\n  })\n  sbp('sbp/selectors/lock', ['chelonia.db/get', 'chelonia.db/set', 'chelonia.db/delete'])\n}\n\n// =======================\n// App settings to persist state across sessions\n// =======================\n\nconst appSettings = localforage.createInstance({\n  name: 'Group Income',\n  storeName: 'Settings'\n})\n\n// Utility class to represent an empty state during error handling\nclass EmptyValue extends Error {}\n\nexport const SETTING_CURRENT_USER = '@settings/currentUser'\nexport const SETTING_CHELONIA_STATE = 'CHELONIA_STATE'\n\nsbp('sbp/selectors/register', {\n  'gi.db/ready': function () {\n    return localforage.ready()\n  },\n  'gi.db/settings/save': function (key        , value     )             {\n  // Items in the DB have a prefix to disambiguate their type.\n  //  'u' means unencrypted data\n  //  'e' means encrypted data\n  //  'k' means that it's a cryptographic key (used for encrypted data)\n  // This allows us to store encrypted and unencrypted states for the same key\n    return appSettings.setItem('u' + key, value)\n  },\n  'gi.db/settings/load': function (key        )               {\n    return appSettings.getItem('u' + key)\n  },\n  'gi.db/settings/delete': function (key        )                  {\n    return appSettings.removeItem('u' + key)\n  },\n  'gi.db/settings/saveEncrypted': async function (key        , value     , encryptionParams     )             {\n    const {\n      stateEncryptionKeyId,\n      salt,\n      encryptedStateEncryptionKey\n    } = encryptionParams\n    // Fetch the session encryption key\n    const stateEncryptionKeyP = await appSettings.getItem('k' + stateEncryptionKeyId)\n    if (!stateEncryptionKeyP) throw new Error(`Unable to retrieve the key corresponding to key ID ${stateEncryptionKeyId}`)\n    // Encrypt the current state\n    const encryptedState = encrypt(stateEncryptionKeyP, JSON.stringify(value), key)\n    // Save the four fields of the encrypted state. We use base64 encoding to\n    // allow saving any incoming data.\n    //   (1) stateEncryptionKeyId\n    //   (2) salt\n    //   (3) encryptedStateEncryptionKey (used for recovery when re-logging in)\n    //   (4) encryptedState\n    return appSettings.setItem('e' + key, `${btoa(stateEncryptionKeyId)}.${btoa(salt)}.${btoa(encryptedStateEncryptionKey)}.${btoa(encryptedState)}`).finally(() => {\n      // Delete the unencypted setting key, if it exists\n      sbp('gi.db/settings/delete', key).catch(e => {\n        console.error('[gi.db/settings/saveEncrypted] Error deleting unencrypted data for key', key, e)\n      })\n    })\n  },\n  'gi.db/settings/loadEncrypted': function (key        , stateKeyEncryptionKeyFn                                                            )             {\n    return appSettings.getItem('e' + key).then(async (encryptedValue) => {\n      if (!encryptedValue || typeof encryptedValue !== 'string') {\n        throw new EmptyValue(`Unable to retrive state for ${key || ''}`)\n      }\n      // Split the encrypted state into its constituent parts\n      const [stateEncryptionKeyId, salt, encryptedStateEncryptionKey, data] = encryptedValue.split('.').map(x => atob(x))\n\n      // Derive a temporary key from the password to decrypt the state\n      // encryption key\n      const stateKeyEncryptionKey = await stateKeyEncryptionKeyFn(stateEncryptionKeyId, salt)\n\n      // Decrypt the state encryption key\n      const stateEncryptionKeyS = decrypt(stateKeyEncryptionKey, encryptedStateEncryptionKey, stateEncryptionKeyId)\n\n      // Compute the key ID of the decrypted key and verify that it holds\n      // the expected value\n      const stateEncryptionKeyIdActual = keyId(stateEncryptionKeyS)\n      if (stateEncryptionKeyIdActual !== stateEncryptionKeyId) {\n        throw new Error(`Invalid state key ID: expected ${stateEncryptionKeyId} but got ${stateEncryptionKeyIdActual}`)\n      }\n\n      // Now, attempt to decrypt the state\n      const value = JSON.parse(decrypt(stateEncryptionKeyS, data, key || ''))\n\n      // Saving the state encryption key in appSettings is necessary for\n      // functionality such as refreshing the page to work\n      await appSettings.setItem('k' + stateEncryptionKeyId, stateEncryptionKeyS)\n\n      return {\n        encryptionParams: {\n          stateEncryptionKeyId,\n          salt,\n          encryptedStateEncryptionKey\n        },\n        value\n      }\n    }).catch(async (e) => {\n      // If we haven't got a password, we can't proceed deriving keys or\n      // encrypting, so we give up at this point\n      if (!stateKeyEncryptionKeyFn) { throw e }\n\n      // If the state was empty, this isn't necessarily an error\n      if (!(e instanceof EmptyValue)) {\n        console.warn('Error while retrieving local state', e)\n      }\n\n      const { encryptionParams, stateEncryptionKeyP } = await generateEncryptionParams(stateKeyEncryptionKeyFn)\n\n      // Save the state encryption key to local storage\n      await appSettings.setItem('k' + encryptionParams.stateEncryptionKeyId, stateEncryptionKeyP)\n\n      return {\n        encryptionParams,\n        value: null\n      }\n    })\n  },\n  'gi.db/settings/deleteStateEncryptionKey': function ({ stateEncryptionKeyId })                  {\n    return appSettings.removeItem('k' + stateEncryptionKeyId)\n  },\n  'gi.db/settings/deleteEncrypted': function (key        )                  {\n    return appSettings.removeItem('e' + key)\n  }\n})\n\n// =======================\n// Save file blobs here\n//\n// TODO: handle automatically deleting old files when we\n//       approach cache limits.\n// =======================\n\nconst filesCache = localforage.createInstance({\n  name: 'Group Income',\n  storeName: 'Files Cache'\n})\n\nconst maxFileEntries = 100\n\nsbp('sbp/selectors/register', {\n  'gi.db/filesCache/save': async function (cacheKey        , blob      )             {\n    if (cacheKey.startsWith('__')) throw new Error('Invalid key')\n    const keys = await filesCache.getItem('keys') ?? []\n\n    // We need to perform several operations in the DB, which includes\n    // the operation requested (i.e., saving a file) and updating the `keys`\n    // entry for caching, as well as possibly deleting cached entries.\n    // Because the `keys` entry is a point of contention among calls and we\n    // can only perform a single storage operation at the same time, we use\n    // a queue to ensure that all operations are done atomically.\n    return sbp('okTurtles.eventQueue/queueEvent', 'gi.db/files', () => {\n      return filesCache.setItem(cacheKey, blob).then(async v => {\n        console.log('successfully saved:', cacheKey)\n        const idx = keys.indexOf(cacheKey)\n        if (idx !== -1) {\n          // Remove current entry\n          keys.splice(idx, 1)\n        }\n        // And bring it to the top\n        keys.push(cacheKey)\n        // If the list gets too long, remove the last element\n        if (keys.length > maxFileEntries) {\n          const last = keys.splice(0, keys.length - maxFileEntries)\n          await Promise.all(last.map((e) => filesCache.removeItem(e)))\n        }\n        // Save the new current keys\n        await filesCache.setItem('keys', keys)\n      }).catch(e => {\n        console.error('error saving:', cacheKey, e)\n      })\n    })\n  },\n  'gi.db/filesCache/load': async function (cacheKey        )                {\n    if (cacheKey.startsWith('__')) throw new Error('Invalid key')\n    const file = await filesCache.getItem(cacheKey)\n    if (file) {\n      // No await here so that we can return early\n      sbp('okTurtles.eventQueue/queueEvent', 'gi.db/files', async () => {\n        const keys = await filesCache.getItem('keys') ?? []\n        const idx = keys.indexOf(cacheKey)\n        if (idx !== -1) {\n          // Bring entry to the top\n          keys.splice(idx, 1)\n          keys.push(cacheKey)\n          await filesCache.setItem('keys', keys)\n        }\n      }).catch(e => {\n        console.error('[gi.db/filesCache/load] Error updating keys')\n      })\n    }\n    return ((file     )      )\n  },\n  'gi.db/filesCache/delete': async function (cacheKey        )                {\n    if (cacheKey.startsWith('__')) throw new Error('Invalid key')\n    await filesCache.removeItem(cacheKey)\n    // No await here so that we can return early\n    sbp('okTurtles.eventQueue/queueEvent', 'gi.db/files', async () => {\n      const keys = await filesCache.getItem('keys') ?? []\n      const idx = keys.indexOf(cacheKey)\n      if (idx !== -1) {\n        keys.splice(idx, 1)\n        await filesCache.setItem('keys', keys)\n      }\n    }).catch(e => {\n      console.error('[gi.db/filesCache/delete] Error updating keys')\n    })\n  },\n  'gi.db/filesCache/clear': async function ()                {\n    await filesCache.clear()\n  }\n})\n\n// ======================================\n// Archive for proposals and anything else\n// ======================================\n\nconst archive = localforage.createInstance({\n  name: 'Group Income',\n  storeName: 'Archive'\n})\n\nsbp('sbp/selectors/register', {\n  'gi.db/archive/save': function (key        , value     )             {\n    return archive.setItem(key, value)\n  },\n  'gi.db/archive/load': function (key        )               {\n    return archive.getItem(key)\n  },\n  'gi.db/archive/delete': function (key        )                  {\n    return archive.removeItem(key)\n  },\n  'gi.db/archive/clear': function ()               {\n    return archive.clear()\n  }\n})\n\n// ======================================\n// Application logs, used for the SW logs\n// ======================================\n\nconst logs = localforage.createInstance({\n  name: 'Group Income',\n  storeName: 'Logs'\n})\n\nsbp('sbp/selectors/register', {\n  'gi.db/logs/save': function (key        , value     )             {\n    return logs.setItem(key, value)\n  },\n  'gi.db/logs/load': function (key        )               {\n    return logs.getItem(key)\n  },\n  'gi.db/logs/delete': function (key        )                  {\n    return logs.removeItem(key)\n  },\n  'gi.db/logs/clear': function ()               {\n    return logs.clear()\n  }\n})\n", "'use strict'\n\nimport { ChelErrorResourceGone, ChelErrorUnexpectedHttpResponseCode } from '~/shared/domains/chelonia/errors.js'\n\nexport function handleFetchResult (type        )                    {\n  return function (r        ) {\n    if (!r.ok) {\n      const msg = `${r.status}: ${r.statusText}`\n      // 410 is sometimes special (for example, it can mean that a contract or\n      // a file been deleted)\n      // $FlowFixMe[extra-arg]\n      if (r.status === 404 || r.status === 410) throw new ChelErrorResourceGone(msg, { cause: r.status })\n      throw new ChelErrorUnexpectedHttpResponseCode(msg)\n    }\n    return r[type]()\n  }\n}\n", "'use strict'\n\nimport { GIErrorUIRuntimeError, L, LError } from '@common/common.js'\nimport {\n  CHATROOM_PRIVACY_LEVEL,\n  CHATROOM_TYPES,\n  PROFILE_STATUS\n} from '@model/contracts/shared/constants.js'\nimport { cloneDeep, has, omit } from 'turtledash'\nimport { SETTING_CHELONIA_STATE } from '@model/database.js'\nimport sbp from '@sbp/sbp'\nimport { imageUpload, objectURLtoBlob } from '@utils/image.js'\nimport { SETTING_CURRENT_USER } from '~/frontend/model/database.js'\nimport { JOINED_CHATROOM, KV_QUEUE, LOGIN, LOGOUT, LOGGING_OUT } from '~/frontend/utils/events.js'\nimport { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\nimport { Secret } from '~/shared/domains/chelonia/Secret.js'\nimport { encryptedIncomingData, encryptedIncomingDataWithRawKey, encryptedOutgoingData, encryptedOutgoingDataWithRawKey } from '~/shared/domains/chelonia/encryptedData.js'\nimport { rawSignedIncomingData } from '~/shared/domains/chelonia/signedData.js'\nimport { EVENT_HANDLED } from '~/shared/domains/chelonia/events.js'\nimport { findKeyIdByName } from '~/shared/domains/chelonia/utils.js'\nimport { blake32Hash } from '~/shared/functions.js'\n                                           \nimport { CURVE25519XSALSA20POLY1305, EDWARDS25519SHA512BATCH, deserializeKey, generateSalt, keyId, keygen, serializeKey } from '@chelonia/crypto'\nimport { handleFetchResult } from '../utils/misc.js'\nimport { encryptedAction, groupContractsByType, syncContractsInOrder } from './utils.js'\n\n/**\n * Decrypts the old IEK list using the provided contract ID and IEK.\n *\n * @param contractID - The ID of the contract.\n * @param IEK - The encryption key object.\n * @param encryptedData - The encrypted data string, or null if not available.\n * @returns The decrypted old IEK list, or an empty array if decryption fails.\n */\nconst decryptOldIekList = (contractID        , IEK     , encryptedData         ) => {\n  // Return an empty array if no encrypted data is provided\n  if (!encryptedData) return []\n\n  try {\n    // Parse the encrypted data from JSON format\n    const parsedData = JSON.parse(encryptedData)\n\n    // Decrypt the incoming data using the IEK and contract ID\n    const decryptedData = encryptedIncomingDataWithRawKey(IEK, parsedData, `meta.private.oldKeys;${contractID}`)\n\n    // Parse the decrypted data back into a JavaScript object\n    const oldKeysList = JSON.parse(decryptedData.valueOf())\n\n    return oldKeysList // Return the decrypted old keys\n  } catch (error) {\n    // Log any errors that occur during decryption\n    console.error('[decryptOldIekList] Error during decryption', error)\n  }\n\n  // Don't return in case of error\n}\n\n/**\n * Decrypts the old IEK list using the provided contract ID and IEK.\n *\n * @param identityContractID - The identity contract ID\n * @param oldKeysAnchorCid - The CID corresponding to the password change message\n * @param IEK - The encryption key object.\n * @returns The decrypted old IEK list, or an empty array if decryption fails.\n */\nconst processOldIekList = async (identityContractID        , oldKeysAnchorCid        , IEK     ) => {\n  try {\n    // Fetch the old keys from the server\n    const result = await fetch(`${sbp('okTurtles.data/get', 'API_URL')}/file/${oldKeysAnchorCid}`).then(handleFetchResult('json'))\n\n    // Parse the signed data in the OP_KEY_UPDATE payload to extract keys\n    const oldKeys = (() => {\n      const data = rawSignedIncomingData(result)\n      const head = JSON.parse(data.get('head'))\n      if (head.contractID !== identityContractID) {\n        throw new Error('Unexpected contract ID.')\n      }\n      if (![SPMessage.OP_ATOMIC, SPMessage.OP_KEY_UPDATE].includes(head.op)) {\n        throw new Error('Unsupported opcode: ' + head.op)\n      }\n\n      // Normalize the payload as if it were `OP_ATOMIC`\n      const payload = (head.op === SPMessage.OP_KEY_UPDATE)\n        ? [[SPMessage.OP_KEY_UPDATE, data.valueOf()]]\n        : data.valueOf()\n\n      // Find the key with the name 'iek', and the `meta.private.oldKeys` field\n      // within it\n      return payload\n        .filter(([op]) => op === SPMessage.OP_KEY_UPDATE)\n        .flatMap(([, keys]) => keys)\n        .find((key) => key.name === 'iek' && key.meta?.private?.oldKeys)\n        ?.meta.private.oldKeys\n    })()\n\n    // Check if old keys are present in the metadata\n    if (!oldKeys) {\n      console.error('[processOldIekList] Error finding old IEKs, logging in will probably fail due to missing keys')\n    }\n\n    // Decrypt the old IEK list\n    const decryptedKeys = decryptOldIekList(identityContractID, IEK, oldKeys)\n\n    // Check if decryption was successful\n    if (!decryptedKeys) {\n      console.error('[processOldIekList] Error decrypting old IEKs, logging in will probably fail due to missing keys')\n    } else {\n      // Map the decrypted keys to the required format\n      const secretKeys = decryptedKeys.map(key => ({ key: deserializeKey(key), transient: true }))\n\n      // Store the secret keys using the sbp function\n      await sbp('chelonia/storeSecretKeys', new Secret(secretKeys))\n    }\n  } catch (error) {\n    console.error('[processOldIekList] Error fetching or processing old keys:', error)\n  }\n}\n\n/**\n * Appends a new IEK to the existing list of old IEKs.\n *\n * @param contractID - The ID of the contract.\n * @param IEK - The encryption key object.\n * @param oldIEK - The old IEK to be appended.\n * @param encryptedData - The encrypted data string, or null if not available.\n * @returns The updated encrypted data containing the new IEK.\n * @throws {Error} - Throws an error if decryption of old IEK list fails.\n */\nconst appendToIekList = (contractID        , IEK        , oldIEK        , encryptedData         ) => {\n  // Decrypt the old IEK list\n  const oldKeys = decryptOldIekList(contractID, oldIEK, encryptedData)\n\n  // If decryption fails, throw an error to prevent data loss\n  if (!oldKeys) {\n    throw new Error('Error decrypting old IEK list')\n  }\n\n  // Create a Set to store unique keys\n  const keysSet = new Set(oldKeys)\n\n  // Serialize the old IEK and add it to the Set\n  const serializedOldIEK = serializeKey(oldIEK, true)\n  keysSet.add(serializedOldIEK)\n\n  // Encrypt the updated list of keys and return the new encrypted data\n  const updatedKeysData = encryptedOutgoingDataWithRawKey(\n    IEK,\n    // Convert Set back to Array for serialization\n    JSON.stringify(Array.from(keysSet))\n  ).toString(`meta.private.oldKeys;${contractID}`)\n\n  return updatedKeysData // Return the updated encrypted data\n}\n\n// Event handler to detect password updates\nsbp('okTurtles.events/on', EVENT_HANDLED, (contractID, message) => {\n  const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n  // If the message isn't for our identity contract or it's not `OP_KEY_UPDATE`\n  // (possibly within `OP_ATOMIC`), we return early\n  if (contractID !== identityContractID || ![SPMessage.OP_ATOMIC, SPMessage.OP_KEY_UPDATE].includes(message.opType())) return\n\n  // If this could have changed our CSK, let's try to get the key ID and see if\n  // we have the corresponding secret key\n  const hasNewCsk = sbp('chelonia/contract/currentKeyIdByName', identityContractID, 'csk', true)\n  // If we do, we can still use the contract as normal\n  if (hasNewCsk) return\n\n  // Otherwise, force a logout\n  console.warn('Likely password change for identity contract. Logging us out.', identityContractID)\n  sbp('gi.actions/identity/logout').catch(e => {\n    console.error('Error while automatically logging out', e)\n  })\n})\n\nexport default (sbp('sbp/selectors/register', {\n  'gi.actions/identity/create': async function ({\n    IPK: wIPK,\n    IEK: wIEK,\n    publishOptions,\n    username,\n    email,\n    picture,\n    token\n  }) {\n    let finalPicture = `${self.location.origin}/assets/images/user-avatar-default.png`\n\n    // Unwrap secrets\n    wIPK = wIPK.valueOf()\n    wIEK = wIEK.valueOf()\n\n    const IPK = typeof wIPK === 'string' ? deserializeKey(wIPK) : wIPK\n    const IEK = typeof wIEK === 'string' ? deserializeKey(wIEK) : wIEK\n\n    const deletionToken = 'deletionToken' + generateSalt()\n    const deletionTokenHash = blake32Hash(deletionToken)\n\n    // Create the necessary keys to initialise the contract\n    const CSK = keygen(EDWARDS25519SHA512BATCH)\n    const CEK = keygen(CURVE25519XSALSA20POLY1305)\n    const PEK = keygen(CURVE25519XSALSA20POLY1305)\n    const SAK = keygen(EDWARDS25519SHA512BATCH)\n\n    // Key IDs\n    const IPKid = keyId(IPK)\n    const IEKid = keyId(IEK)\n    const CSKid = keyId(CSK)\n    const CEKid = keyId(CEK)\n    const PEKid = keyId(PEK)\n    const SAKid = keyId(SAK)\n\n    // Public keys to be stored in the contract\n    const IPKp = serializeKey(IPK, false)\n    const IEKp = serializeKey(IEK, false)\n    const CSKp = serializeKey(CSK, false)\n    const CEKp = serializeKey(CEK, false)\n    const PEKp = serializeKey(PEK, false)\n    const SAKp = serializeKey(SAK, false)\n\n    // Secret keys to be stored encrypted in the contract\n    const CSKs = encryptedOutgoingDataWithRawKey(IEK, serializeKey(CSK, true))\n    const CEKs = encryptedOutgoingDataWithRawKey(IEK, serializeKey(CEK, true))\n    const PEKs = encryptedOutgoingDataWithRawKey(CEK, serializeKey(PEK, true))\n    const SAKs = encryptedOutgoingDataWithRawKey(IEK, serializeKey(SAK, true))\n    const encryptedDeletionToken = encryptedOutgoingDataWithRawKey(IEK, deletionToken)\n\n    // Before creating the contract, put all keys into transient store\n    await sbp('chelonia/storeSecretKeys',\n      new Secret([IPK, IEK, CEK, CSK, PEK, SAK].map(key => ({ key, transient: true })))\n    )\n\n    let userID\n    // next create the identity contract itself\n    try {\n      await sbp('chelonia/out/registerContract', {\n        contractName: 'gi.contracts/identity',\n        publishOptions: {\n          ...publishOptions,\n          headers: {\n            ...publishOptions?.headers,\n            'shelter-deletion-token-digest': deletionTokenHash,\n            'shelter-namespace-registration': username,\n            'shelter-salt-registration-token': token.valueOf()\n          }\n        },\n        signingKeyId: IPKid,\n        actionSigningKeyId: CSKid,\n        actionEncryptionKeyId: PEKid,\n        keys: [\n          {\n            id: IPKid,\n            name: 'ipk',\n            purpose: ['sig'],\n            ringLevel: 0,\n            permissions: '*',\n            allowedActions: '*',\n            meta: {\n              private: {\n                transient: true\n              }\n            },\n            data: IPKp\n          },\n          {\n            id: IEKid,\n            name: 'iek',\n            purpose: ['enc'],\n            ringLevel: 0,\n            // TODO: Does this 'gi.contracts/identity/keymeta' pseudo selector\n            // make sense here? It is not being used and these types of permissions\n            // can be problematic because selectors can be updated\n            permissions: ['gi.contracts/identity/keymeta'],\n            meta: {\n              private: {\n                transient: true\n              }\n            },\n            data: IEKp\n          },\n          {\n            id: CSKid,\n            name: 'csk',\n            purpose: ['sig'],\n            ringLevel: 1,\n            permissions: [SPMessage.OP_KEY_ADD, SPMessage.OP_KEY_DEL, SPMessage.OP_ACTION_UNENCRYPTED, SPMessage.OP_ACTION_ENCRYPTED, SPMessage.OP_ATOMIC, SPMessage.OP_CONTRACT_AUTH, SPMessage.OP_CONTRACT_DEAUTH, SPMessage.OP_KEY_SHARE, SPMessage.OP_KEY_UPDATE, SPMessage.OP_ACTION_ENCRYPTED + '#inner'],\n            allowedActions: '*',\n            meta: {\n              private: {\n                content: CSKs\n              }\n            },\n            data: CSKp\n          },\n          {\n            id: CEKid,\n            name: 'cek',\n            purpose: ['enc'],\n            ringLevel: 1,\n            permissions: [SPMessage.OP_ACTION_ENCRYPTED, SPMessage.OP_KEY_ADD, SPMessage.OP_KEY_DEL, SPMessage.OP_KEY_REQUEST, SPMessage.OP_KEY_REQUEST_SEEN, SPMessage.OP_KEY_SHARE, SPMessage.OP_KEY_UPDATE],\n            allowedActions: '*',\n            meta: {\n              private: {\n                content: CEKs\n              }\n            },\n            data: CEKp\n          },\n          {\n            id: PEKid,\n            name: 'pek',\n            purpose: ['enc'],\n            ringLevel: 2,\n            permissions: [SPMessage.OP_ACTION_ENCRYPTED],\n            allowedActions: ['gi.actions/identity/setAttributes'],\n            meta: {\n              private: {\n                content: PEKs\n              }\n            },\n            data: PEKp\n          },\n          {\n            id: SAKid,\n            name: '#sak',\n            purpose: ['sak'],\n            ringLevel: 0,\n            permissions: [],\n            allowedActions: [],\n            meta: {\n              private: {\n                content: SAKs\n              }\n            },\n            data: SAKp\n          }\n        ],\n        hooks: {\n          postpublishContract: async (message) => {\n            // We need to get the contract state\n            await sbp('chelonia/contract/retain', message.contractID(), { ephemeral: true })\n\n            try {\n              userID = message.contractID()\n              if (picture) {\n                try {\n                  finalPicture = await imageUpload(picture, { billableContractID: userID })\n                } catch (e) {\n                  console.error('actions/identity.js picture upload error:', e)\n                  throw new GIErrorUIRuntimeError(L('Failed to upload the profile picture. {codeError}', { codeError: e.message }), { cause: e })\n                }\n              }\n            } finally {\n              await sbp('chelonia/contract/release', message.contractID(), { ephemeral: true })\n            }\n          }\n        },\n        data: {\n          // finalPicture is set after OP_CONTRACT is sent, which is after\n          // calling 'chelonia/out/registerContract' here. We use a getter for\n          // `picture` so that the action sent has the correct value\n          attributes: {\n            username,\n            email,\n            get picture () { return finalPicture },\n            encryptedDeletionToken: encryptedDeletionToken.serialize('encryptedDeletionToken')\n          }\n        }\n      })\n\n      // After the contract has been created, store persistent keys\n      await sbp('chelonia/storeSecretKeys',\n        new Secret([CEK, CSK, PEK, SAK].map(key => ({ key })))\n      )\n      // And remove transient keys, which require a user password\n      sbp('chelonia/clearTransientSecretKeys', [IEKid, IPKid])\n    } catch (e) {\n      console.error('gi.actions/identity/create failed!', e)\n      throw new GIErrorUIRuntimeError(L('Failed to create user identity: {reportError}', LError(e)), { cause: e })\n    } finally {\n      // And remove transient keys, which require a user password\n      await sbp('chelonia/clearTransientSecretKeys', [IEKid, IPKid])\n    }\n    return userID\n  },\n  'gi.actions/identity/login': function ({ identityContractID, encryptionParams, cheloniaState, state, transientSecretKeys, oldKeysAnchorCid }) {\n    // This wrapper ensures that there is at most one login flow action executed\n    // at any given time. Because of the async work done when logging in and out,\n    // it could happen that, e.g., `gi.actions/identity/login` is called before\n    // a previous call to `gi.actions/identity/logout` completed (this should\n    // not be allowed by the UI, and it'd require that users do things very\n    // quickly, but using automation can cause this).\n    // To prevent issues, the login and logout actions are wrapped an placed in\n    // a queue.\n    return sbp('okTurtles.eventQueue/queueEvent', 'ACTIONS-LOGIN', async () => {\n      console.debug('[gi.actions/identity/login] Scheduled call starting', identityContractID)\n      transientSecretKeys = transientSecretKeys.valueOf().map(k => ({ key: deserializeKey(k), transient: true }))\n\n      // If running in a SW, start log capture here\n      if (typeof WorkerGlobalScope === 'function') {\n        await sbp('swLogs/startCapture', identityContractID)\n      }\n      await sbp('chelonia/reset', { ...cheloniaState, loggedIn: { identityContractID } })\n      await sbp('chelonia/storeSecretKeys', new Secret(transientSecretKeys))\n\n      if (oldKeysAnchorCid) {\n        await processOldIekList(identityContractID, oldKeysAnchorCid, transientSecretKeys[0].key)\n      }\n\n      try {\n        // When syncing from scratch, we need to call `retain` on our own\n        // identity contract to ensure the reference count is positive and we\n        // don't accidentally remove it.\n        // When not syncing from scratch, we call `sync` instead, since we don't\n        // want to increment the reference count every time the app is loaded.\n        // To decide what to call, we don't simply check for `state` (which\n        // would be defined when restoring from a saved state) because in some\n        // cases the reference count could be 0, resulting in an error.\n        // Instead, we check if the reference count exists. This check is\n        // correct and also ensures that, if the state gets corrupted for some\n        // reason (for example, because the contract is deleted from the server\n        // and then restored) and the reference count lost, we call `/retain`\n        // again, which will succeed and also ensure our own identity contract\n        // won't get removed.\n        if (!cheloniaState?.contracts[identityContractID]?.references) {\n          // Make sure we don't unsubscribe from our own identity contract\n          // Note that this should be done _after_ calling\n          // `chelonia/storeSecretKeys`: If the following line results in\n          // syncing the identity contract and fetching events, the secret keys\n          // for processing them will not be available otherwise.\n          await sbp('chelonia/contract/retain', identityContractID)\n        } else {\n          // If there is a state, we've already retained the identity contract\n          // but might need to fetch the latest events\n          await sbp('chelonia/contract/sync', identityContractID)\n        }\n      } catch (e) {\n        console.error('[gi.actions/identity] Error during login contract sync', e)\n        throw new GIErrorUIRuntimeError(L('Error during login contract sync'), { cause: e })\n      }\n\n      try {\n        await sbp('gi.db/settings/save', SETTING_CURRENT_USER, identityContractID)\n        sbp('okTurtles.events/emit', LOGIN, { identityContractID, encryptionParams, state })\n\n        const contractIDs = groupContractsByType(cheloniaState?.contracts)\n        await syncContractsInOrder(contractIDs)\n\n        try {\n          // The state above might be null, so we re-grab it\n          const cheloniaState = sbp('chelonia/rootState')\n\n          // The updated list of groups\n          const groupIds = Object.keys(cheloniaState[identityContractID].groups)\n\n          // contract sync might've triggered an async call to /remove, so\n          // wait before proceeding\n          // $FlowFixMe[incompatible-call]\n          await sbp('chelonia/contract/wait', Array.from(new Set([...groupIds, ...Object.values(contractIDs).flat()])))\n\n          // Call 'gi.actions/group/join' on all groups which may need re-joining\n          await Promise.allSettled(\n            groupIds.map(async groupId => (\n              // (1) Check whether the contract exists (may have been removed\n              //     after sync)\n              has(cheloniaState.contracts, groupId) &&\n              has(cheloniaState[identityContractID].groups, groupId) &&\n              // (2) Check whether the join process is still incomplete\n              //     This needs to be re-checked because it may have changed after\n              //     sync\n              // //     We only check for groups where we don't have a profile, as\n              // //     re-joining is handled by the group contract itself.\n              // !state[groupId]?.profiles?.[identityContractID] && // ?.status !== PROFILE_STATUS.\n              cheloniaState[groupId]?.profiles?.[identityContractID]?.status !== PROFILE_STATUS.ACTIVE &&\n              // (3) Call join\n              sbp('gi.actions/group/join', {\n                originatingContractID: identityContractID,\n                originatingContractName: 'gi.contracts/identity',\n                contractID: groupId,\n                contractName: 'gi.contracts/group',\n                reference: cheloniaState[identityContractID].groups[groupId].hash,\n                signingKeyId: cheloniaState[identityContractID].groups[groupId].inviteSecretId,\n                innerSigningKeyId: await sbp('chelonia/contract/currentKeyIdByName', identityContractID, 'csk'),\n                encryptionKeyId: await sbp('chelonia/contract/currentKeyIdByName', identityContractID, 'cek')\n              }).catch((e) => {\n                console.error(`Error during gi.actions/group/join for ${groupId} at login`, e)\n                const humanErr = L('Join group error during login: {msg}', { msg: e?.message || 'unknown error' })\n                throw new GIErrorUIRuntimeError(humanErr)\n              })\n            ))\n          )\n\n          // update the 'lastLoggedIn' field in user's group profiles\n          // note: this is immediate and only done when logging in with a password\n          Object.entries(cheloniaState[identityContractID].groups)\n            // $FlowFixMe[incompatible-use]\n            .filter(([, { hasLeft }]) => !hasLeft)\n            .forEach(([cId]) => {\n              // We send this action only for groups we have fully joined (i.e.,\n              // accepted an invite and added our profile)\n              if (cheloniaState[cId]?.profiles?.[identityContractID]?.status === PROFILE_STATUS.ACTIVE) {\n                sbp('gi.actions/group/kv/updateLastLoggedIn', { contractID: cId, throttle: false }).catch((e) => console.error('Error sending updateLastLoggedIn', e))\n              }\n            })\n        } catch (e) {\n          console.error('[gi.actions/identity/login] Error re-joining groups after login', e)\n          throw e\n        }\n\n        return identityContractID\n      } catch (e) {\n        sbp('chelonia/clearTransientSecretKeys', transientSecretKeys.map(({ key }) => keyId(key)))\n        console.error('gi.actions/identity/login failed!', e)\n        const humanErr = L('Failed to log in: {reportError}', LError(e))\n        await sbp('gi.actions/identity/_private/logout')\n          .catch((e) => {\n            console.error('[gi.actions/identity/login] Error calling logout (after failure to login)', e)\n          })\n        throw new GIErrorUIRuntimeError(humanErr, { cause: e })\n      }\n    })\n  },\n  // Unlike the login function, the wrapper for logging out is used using a\n  // dedicated selector to allow it to be called from the login selector (if\n  // error occurs)\n  'gi.actions/identity/_private/logout': async function () {\n    let cheloniaState\n    sbp('okTurtles.events/emit', LOGGING_OUT)\n    try {\n      console.info('logging out, waiting for any events to finish...')\n      // wait for any pending operations to finish before calling state/vuex/save\n      // This includes, in order:\n      //   0. Pending login events\n      //   1. Actions to be sent (in the `encrypted-action` queue)\n      //   2. (In reset) Actions that haven't been published yet (the\n      //      `publish:${contractID}` queues)\n      //   3. (In reset) Processing of any action (waiting on all the contract\n      //      queues), including their side-effects (the `${contractID}` queues)\n      //   4. (In reset handler) Outgoing actions from side-effects (again, in\n      //      the `encrypted-action` queue)\n      await sbp('okTurtles.eventQueue/queueEvent', 'encrypted-action', () => {})\n      // reset will wait until we have processed any remaining actions\n      cheloniaState = await sbp('chelonia/reset', async () => {\n        // some of the actions that reset waited for might have side-effects\n        // that send actions\n        // we wait for those as well (the duplication in this case is\n        // intended) -- see 4. above\n        // The intent of this is to wait for all the current actions to be\n        // sent and then wait until any actions that are a side-effect are sent\n        // TODO: We might not need this second await and 1-3 could be fine (i.e.,\n        // we could avoid waiting on these 2nd layer of actions)\n        await sbp('okTurtles.eventQueue/queueEvent', 'encrypted-action', () => {})\n\n        // NOTE: wait for all the pending KV_QUEUE invocations to be finished\n        await sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, () => {})\n\n        // See comment below for 'gi.db/settings/delete'\n        const cheloniaState = await sbp('okTurtles.eventQueue/queueEvent', SETTING_CHELONIA_STATE, async () => {\n          const cheloniaState = cloneDeep(sbp('chelonia/rootState'))\n          await sbp('gi.db/settings/delete', SETTING_CHELONIA_STATE)\n          return cheloniaState\n        })\n        await sbp('gi.db/settings/save', SETTING_CURRENT_USER, null)\n\n        return cheloniaState\n      }).then((cheloniaState) => {\n        console.info('successfully logged out')\n\n        return cheloniaState\n      })\n    } catch (e) {\n      console.error(`${e.name} during logout: ${e.message}`, e)\n    }\n    // Clear the file cache when logging out to preserve privacy\n    sbp('gi.db/filesCache/clear').catch((e) => { console.error('Error clearing file cache', e) })\n    // If running inside a SW, clear logs\n    if (typeof WorkerGlobalScope === 'function') {\n      // clear stored logs to prevent someone else accessing sensitve data\n      sbp('swLogs/pauseCapture', { wipeOut: true }).catch((e) => { console.error('Error clearing file cache', e) })\n    }\n    sbp('okTurtles.events/emit', LOGOUT)\n    return cheloniaState\n  },\n  'gi.actions/identity/addJoinDirectMessageKey': async (contractID, foreignContractID, keyName) => {\n    const keyId = await sbp('chelonia/contract/currentKeyIdByName', foreignContractID, keyName)\n    const CEKid = await sbp('chelonia/contract/currentKeyIdByName', contractID, 'cek')\n    const foreignContractState = sbp('chelonia/contract/state', foreignContractID)\n\n    const existingForeignKeys = await sbp('chelonia/contract/foreignKeysByContractID', contractID, foreignContractID)\n\n    if (existingForeignKeys?.includes(keyId)) {\n      return\n    }\n\n    return await sbp('chelonia/out/keyAdd', {\n      contractID,\n      contractName: 'gi.contracts/identity',\n      data: [encryptedOutgoingData(contractID, CEKid, {\n        foreignKey: `shelter:${encodeURIComponent(foreignContractID)}?keyName=${encodeURIComponent(keyName)}`,\n        id: keyId,\n        data: foreignContractState._vm.authorizedKeys[keyId].data,\n        // The OP_ACTION_ENCRYPTED is necessary to let the DM counterparty\n        // that a chatroom has just been created\n        permissions: [SPMessage.OP_ACTION_ENCRYPTED + '#inner'],\n        allowedActions: ['gi.contracts/identity/joinDirectMessage#inner'],\n        purpose: ['sig'],\n        ringLevel: Number.MAX_SAFE_INTEGER,\n        name: `${foreignContractID}/${keyId}`\n      })],\n      signingKeyId: sbp('chelonia/contract/suitableSigningKey', contractID, [SPMessage.OP_KEY_ADD], ['sig'])\n    })\n  },\n  'gi.actions/identity/shareNewPEK': async (contractID        , newKeys) => {\n    const rootState = sbp('chelonia/rootState')\n    const state = rootState[contractID]\n    // TODO: Also share PEK with DMs\n    await Promise.all(Object.keys(state.groups || {}).filter(groupID => !state.groups[groupID].hasLeft && !!rootState.contracts[groupID]).map(async groupID => {\n      const CEKid = await sbp('chelonia/contract/currentKeyIdByName', groupID, 'cek')\n      const CSKid = await sbp('chelonia/contract/currentKeyIdByName', groupID, 'csk')\n\n      if (!CEKid || !CSKid) {\n        console.warn(`Unable to share rotated keys for ${contractID} with ${groupID}: Missing CEK or CSK`)\n        // We intentionally don't throw here to be able to share keys with the\n        // remaining groups\n        return\n      }\n      return sbp('chelonia/out/keyShare', {\n        contractID: groupID,\n        contractName: rootState.contracts[groupID].type,\n        data: encryptedOutgoingData(groupID, CEKid, {\n          contractID: groupID,\n          // $FlowFixMe\n          keys: Object.values(newKeys).map(([, newKey, newId]                    ) => ({\n            id: newId,\n            meta: {\n              private: {\n                content: encryptedOutgoingData(groupID, CEKid, serializeKey(newKey, true))\n              }\n            }\n          }))\n        }),\n        signingKeyId: CSKid,\n        hooks: {\n          preSendCheck: (_, state) => {\n            // Don't send this message if we're no longer a group member\n            return state?.profiles?.[contractID]?.status === PROFILE_STATUS.ACTIVE\n          }\n        }\n      }).catch(e => {\n        // We may no longer be a member of the group, so we ignore errors\n        // related to missing keys\n        if (e.name !== 'ChelErrorSignatureKeyNotFound') {\n          throw e\n        }\n      })\n    }))\n\n    // This selector is called by rotateKeys, which will include the keys to\n    // share along with OP_KEY_UPDATE. In this case, we're sharing all keys\n    // to their respective contracts and there are no keys to include in\n    // the same event as OP_KEY_UPDATE. Therefore, we return undefined\n    if (!newKeys.pek) return undefined\n    return [\n      undefined, // Nothing before OP_KEY_UPDATE\n      [\n        // Re-encrypt attributes with the new PEK\n        await sbp('gi.actions/identity/setAttributes', {\n          contractID,\n          data: state.attributes,\n          encryptionKey: newKeys.pek[1],\n          encryptionKeyId: newKeys.pek[2],\n          returnInvocation: true\n        })\n      ]\n    ]\n  },\n  ...encryptedAction('gi.actions/identity/setAttributes', L('Failed to set profile attributes.'), undefined, 'pek'),\n  ...encryptedAction('gi.actions/identity/updateSettings', L('Failed to update profile settings.')),\n  ...encryptedAction('gi.actions/identity/createDirectMessage', L('Failed to create a new direct message channel.'), async function (sendMessage, params) {\n    const rootGetters = sbp('state/vuex/getters')\n    const partnerIDs = params.data.memberIDs\n      .filter(memberID => memberID !== rootGetters.ourIdentityContractId)\n      .map(memberID => rootGetters.ourContactProfilesById[memberID].contractID)\n    const currentGroupId = params.data.currentGroupId\n    const identityContractID = rootGetters.ourIdentityContractId\n\n    const message = await sbp('gi.actions/chatroom/create', {\n      data: {\n        attributes: {\n          name: '',\n          description: '',\n          privacyLevel: CHATROOM_PRIVACY_LEVEL.PRIVATE,\n          type: CHATROOM_TYPES.DIRECT_MESSAGE\n        }\n      },\n      hooks: {\n        prepublish: params.hooks?.prepublish,\n        postpublish: null\n      }\n    }, identityContractID)\n\n    // Share the keys to the newly created chatroom with ourselves\n    await sbp('gi.actions/out/shareVolatileKeys', {\n      contractID: identityContractID,\n      contractName: 'gi.contracts/identity',\n      subjectContractID: message.contractID(),\n      keyIds: '*'\n    })\n\n    await sbp('gi.actions/chatroom/join', {\n      ...omit(params, ['options', 'contractID', 'data', 'hooks']),\n      contractID: message.contractID(),\n      data: { memberID: [identityContractID, ...partnerIDs] }\n    })\n\n    const switchChannelAfterJoined = (contractID        ) => {\n      if (contractID === message.contractID()) {\n        if (sbp('chelonia/contract/state', message.contractID())?.members?.[identityContractID]) {\n          sbp('okTurtles.events/emit', JOINED_CHATROOM, { identityContractID, groupContractID: currentGroupId, chatRoomID: message.contractID() })\n          sbp('okTurtles.events/off', EVENT_HANDLED, switchChannelAfterJoined)\n        }\n      }\n    }\n    sbp('okTurtles.events/on', EVENT_HANDLED, switchChannelAfterJoined)\n\n    await sendMessage({\n      ...omit(params, ['options', 'data', 'action', 'hooks']),\n      data: {\n        contractID: message.contractID()\n      },\n      hooks: {\n        onprocessed: params.hooks?.onprocessed\n      }\n    })\n\n    for (let index = 0; index < partnerIDs.length; index++) {\n      const hooks = index < partnerIDs.length - 1 ? undefined : { prepublish: null, postpublish: params.hooks?.postpublish }\n\n      // Share the keys to the newly created chatroom with partners\n      // TODO: We need to handle multiple groups and the possibility of not\n      // having any groups in common\n      await sbp('gi.actions/out/shareVolatileKeys', {\n        contractID: partnerIDs[index],\n        contractName: 'gi.contracts/identity',\n        subjectContractID: message.contractID(),\n        keyIds: '*'\n      })\n\n      await sbp('gi.actions/identity/joinDirectMessage', {\n        ...omit(params, ['options', 'contractID', 'data', 'hooks']),\n        contractID: partnerIDs[index],\n        data: {\n          // TODO: We need to handle multiple groups and the possibility of not\n          // having any groups in common\n          contractID: message.contractID()\n        },\n        // For now, we assume that we're messaging someone which whom we\n        // share a group\n        signingKeyId: await sbp('chelonia/contract/suitableSigningKey', partnerIDs[index], [SPMessage.OP_ACTION_ENCRYPTED], ['sig'], undefined, ['gi.contracts/identity/joinDirectMessage']),\n        innerSigningContractID: currentGroupId,\n        hooks\n      })\n    }\n\n    return message.contractID()\n  }),\n  ...encryptedAction('gi.actions/identity/joinDirectMessage', L('Failed to join a direct message.')),\n  ...encryptedAction('gi.actions/identity/joinGroup', L('Failed to join a group.')),\n  ...encryptedAction('gi.actions/identity/leaveGroup', L('Failed to leave a group.')),\n  ...encryptedAction('gi.actions/identity/setDirectMessageVisibility', L('Failed to set direct message visibility.')),\n  'gi.actions/identity/uploadFiles': async ({ attachments, billableContractID }   \n                                                          \n   ) => {\n    const { identityContractID } = sbp('state/vuex/state').loggedIn\n    try {\n      const attachmentsData = await Promise.all(attachments.map(async (attachment) => {\n        const { url, compressedBlob } = attachment\n        // url here is an instance of URL.createObjectURL(), which needs to be converted to a 'Blob'\n        const attachmentBlob = compressedBlob || await objectURLtoBlob(url)\n\n        const response = await sbp('chelonia/fileUpload', attachmentBlob, {\n          type: attachment.mimeType,\n          cipher: 'aes256gcm'\n        }, { billableContractID })\n        const { delete: token, download: downloadData } = response\n        return {\n          attributes: omit(attachment, ['url', 'compressedBlob', 'needsImageCompression']),\n          downloadData,\n          deleteData: { token }\n        }\n      }))\n\n      const tokensByManifestCid = attachmentsData.map(({ downloadData, deleteData }) => ({\n        manifestCid: downloadData.manifestCid,\n        token: deleteData.token\n      }))\n\n      await sbp('gi.actions/identity/saveFileDeleteToken', {\n        contractID: identityContractID,\n        data: { billableContractID, tokensByManifestCid }\n      })\n\n      return attachmentsData.map(({ attributes, downloadData }) => ({ ...attributes, downloadData }))\n    } catch (err) {\n      const humanErr = L('Failed to upload files: {reportError}', LError(err))\n      throw new GIErrorUIRuntimeError(humanErr)\n    }\n  },\n  'gi.actions/identity/removeFiles': async ({ manifestCids, option }   \n                                          \n   ) => {\n    const { identityContractID } = sbp('state/vuex/state').loggedIn\n    const { shouldDeleteFile, shouldDeleteToken, throwIfMissingToken } = option\n    let deleteResult, toDelete\n\n    const currentIdentityState = await sbp('chelonia/contract/state', identityContractID)\n\n    if (shouldDeleteFile) {\n      const credentials = Object.fromEntries(manifestCids.map(cid => {\n        // It could be that the file was already deleted, if we no longer have\n        // a delete token. In this case, omit those CIDs.\n        if (!throwIfMissingToken && shouldDeleteToken && !currentIdentityState.fileDeleteTokens[cid]) {\n          console.info('[gi.actions/identity/removeFiles] Skipping file as token is missing', cid)\n          return [cid, null]\n        };\n        const credential = shouldDeleteToken\n          ? { token: currentIdentityState.fileDeleteTokens[cid].token }\n          : { billableContractID: identityContractID }\n        return [cid, credential]\n      }))\n      toDelete = !throwIfMissingToken ? manifestCids.filter((cid) => !!credentials[cid]) : manifestCids\n      deleteResult = await sbp('chelonia/fileDelete', toDelete, credentials)\n    } else {\n      toDelete = manifestCids\n    }\n\n    if (shouldDeleteToken) {\n      await sbp('gi.actions/identity/removeFileDeleteToken', {\n        contractID: identityContractID,\n        data: {\n          manifestCids: deleteResult\n            ? toDelete.filter((_, i) => {\n              return deleteResult[i].status === 'fulfilled'\n            })\n            : toDelete\n        }\n      })\n    }\n\n    if (deleteResult?.some(r => r.status === 'rejected')) {\n      console.error('[gi.actions/identity/removeFiles] Some CIDs could not be deleted',\n        deleteResult?.map((r, i) => r.status === 'rejected' && toDelete[i]).filter(Boolean))\n      throw new Error('Some CIDs could not be deleted')\n    }\n  },\n  'gi.actions/identity/logout': (...params) => {\n    return sbp('okTurtles.eventQueue/queueEvent', 'ACTIONS-LOGIN', ['gi.actions/identity/_private/logout', ...params])\n  },\n  'gi.actions/identity/changePassword': async ({\n    identityContractID,\n    username,\n    oldIPK,\n    oldIEK,\n    newIPK: IPK,\n    newIEK: IEK,\n    updateToken,\n    hooks\n  }) => {\n    oldIPK = oldIPK.valueOf()\n    oldIEK = oldIEK.valueOf()\n    IPK = IPK.valueOf()\n    IEK = IEK.valueOf()\n    updateToken = updateToken.valueOf()\n\n    // Create the necessary keys to initialise the contract\n    const CSK = keygen(EDWARDS25519SHA512BATCH)\n    const CEK = keygen(CURVE25519XSALSA20POLY1305)\n    const SAK = keygen(EDWARDS25519SHA512BATCH)\n\n    // Key IDs\n    const oldIPKid = keyId(oldIPK)\n    const oldIEKid = keyId(oldIEK)\n    const IPKid = keyId(IPK)\n    const IEKid = keyId(IEK)\n    const CSKid = keyId(CSK)\n    const CEKid = keyId(CEK)\n    const SAKid = keyId(SAK)\n\n    // Public keys to be stored in the contract\n    const IPKp = serializeKey(IPK, false)\n    const IEKp = serializeKey(IEK, false)\n    const CSKp = serializeKey(CSK, false)\n    const CEKp = serializeKey(CEK, false)\n    const SAKp = serializeKey(SAK, false)\n\n    // Secret keys to be stored encrypted in the contract\n    const CSKs = encryptedOutgoingDataWithRawKey(IEK, serializeKey(CSK, true))\n    const CEKs = encryptedOutgoingDataWithRawKey(IEK, serializeKey(CEK, true))\n    const SAKs = encryptedOutgoingDataWithRawKey(IEK, serializeKey(SAK, true))\n\n    const state = sbp('chelonia/contract/state', identityContractID)\n\n    // Before rotating keys the contract, put all keys into transient store\n    await sbp('chelonia/storeSecretKeys',\n      new Secret([oldIPK, oldIEK, IPK, IEK, CEK, CSK, SAK].map(key => ({ key, transient: true })))\n    )\n\n    const oldKeysData = appendToIekList(\n      identityContractID, IEK, oldIEK,\n      state._vm.authorizedKeys[oldIEKid]?.meta?.private?.oldKeys\n    )\n\n    await sbp('chelonia/out/keyUpdate', {\n      contractID: identityContractID,\n      contractName: 'gi.contracts/identity',\n      data: [\n        {\n          id: IPKid,\n          name: 'ipk',\n          oldKeyId: oldIPKid,\n          meta: {\n            private: {\n              transient: true\n            }\n          },\n          data: IPKp\n        },\n        {\n          id: IEKid,\n          name: 'iek',\n          oldKeyId: oldIEKid,\n          meta: {\n            private: {\n              transient: true,\n              oldKeys: oldKeysData\n            }\n          },\n          data: IEKp\n        },\n        {\n          id: CSKid,\n          name: 'csk',\n          oldKeyId: findKeyIdByName(state, 'csk'),\n          meta: {\n            private: {\n              content: CSKs\n            }\n          },\n          data: CSKp\n        },\n        {\n          id: CEKid,\n          name: 'cek',\n          oldKeyId: findKeyIdByName(state, 'cek'),\n          meta: {\n            private: {\n              content: CEKs\n            }\n          },\n          data: CEKp\n        },\n        {\n          id: SAKid,\n          name: '#sak',\n          oldKeyId: findKeyIdByName(state, '#sak'),\n          meta: {\n            private: {\n              content: SAKs\n            }\n          },\n          data: SAKp\n        }\n      ],\n      signingKeyId: oldIPKid,\n      publishOptions: {\n        headers: {\n          'shelter-salt-update-token': updateToken\n        }\n      },\n      hooks\n    })\n\n    // After the contract has been updated, store persistent keys\n    await sbp('chelonia/storeSecretKeys',\n      new Secret([CEK, CSK, SAK].map(key => ({ key })))\n    )\n    // And remove transient keys, which require a user password\n    sbp('chelonia/clearTransientSecretKeys', [oldIEKid, oldIPKid, IEKid, IPKid])\n  },\n  'gi.actions/identity/delete': async ({\n    contractID,\n    transientSecretKeys,\n    oldKeysAnchorCid\n  }   \n                       \n                                          \n                            \n   ) => {\n    const state = sbp('chelonia/contract/state', contractID)\n    if (!state?.attributes?.encryptedDeletionToken) {\n      throw new Error('Missing encrypted deletion token')\n    }\n\n    const transientSecretKeysEntries = transientSecretKeys.valueOf().map(\n      k => ([keyId(k), deserializeKey(k)])\n    )\n    const encryptedDeletionToken = state.attributes.encryptedDeletionToken\n\n    // If there were key rotations, we need to decrypt keys using the CID of\n    // the message where the (last) rotation happened.\n    if (oldKeysAnchorCid) {\n      const IEK = transientSecretKeysEntries[0][1]\n      await processOldIekList(contractID, oldKeysAnchorCid, IEK)\n    }\n\n    const token = encryptedIncomingData(contractID, state, encryptedDeletionToken, NaN, Object.fromEntries(transientSecretKeysEntries), 'encryptedDeletionToken')\n\n    // Before actually deleting it, leave all groups and DMs. This avoids\n    // potentially leaving the UI in a weird state.\n    const { ourDirectMessages, ourGroups } = sbp('state/vuex/getters')\n    await Promise.all([\n      ...Object.keys(ourDirectMessages).map((contractID) => {\n        return sbp('gi.actions/chatroom/leave', { contractID, data: {} }).catch((e) => {\n        // We make this a warning and we don't propagate the error because this\n        // is not a requirement for deleting the contract.\n          console.warn('Error while leaving DM before deleting identity contract', contractID, e)\n        })\n      }),\n      ...ourGroups.map((contractID) => {\n        return sbp('gi.actions/group/removeOurselves', { contractID }).catch((e) => {\n        // We make this a warning and we don't propagate the error because this\n        // is not a requirement for deleting the contract.\n          console.warn('Error while leaving group before deleting identity contract', contractID, e)\n        })\n      })\n    ])\n\n    await sbp('chelonia/out/deleteContract', contractID, {\n      [contractID]: { token: new Secret(token.valueOf()) }\n    })\n  },\n  'gi.actions/identity/_ondeleted': async (contractID        , state        ) => {\n    const ourIdentityContractId = sbp('state/vuex/getters').ourIdentityContractId\n\n    if (contractID === ourIdentityContractId) {\n      // If our own identity contract has been deleted, there isn't much more\n      // that we can do on the app, so we log out. We don't wait for other running\n      // _ondeleted handlers because at this point our state can no longer be\n      // used, as we're no longer able to keep our identity meaningfully in sync\n      // with things happening on the server.\n      await sbp('gi.actions/identity/logout')\n    }\n  },\n  ...encryptedAction('gi.actions/identity/deleteDirectMessage', L('Failed to delete direct message.')),\n  ...encryptedAction('gi.actions/identity/saveFileDeleteToken', L('Failed to save delete tokens for the attachments.')),\n  ...encryptedAction('gi.actions/identity/removeFileDeleteToken', L('Failed to remove delete tokens for the attachments.')),\n  ...encryptedAction('gi.actions/identity/setGroupAttributes', L('Failed to set group attributes.'))\n})          )\n", "'use strict'\nimport sbp from '@sbp/sbp'\nimport { KV_KEYS } from '~/frontend/utils/constants.js'\nimport { KV_QUEUE, NEW_PREFERENCES, NEW_UNREAD_MESSAGES, ONLINE } from '~/frontend/utils/events.js'\nimport { isExpired } from '@model/notifications/utils.js'\n\nconst initNotificationStatus = (data = {}) => ({ ...data, read: false })\n\nsbp('okTurtles.events/on', ONLINE, () => {\n  if (!sbp('state/vuex/state').loggedIn?.identityContractID) {\n    return\n  }\n  sbp('gi.actions/identity/kv/load').catch(e => {\n    console.error(\"Error from 'gi.actions/identity/kv/load' after reestablished connection:\", e)\n  })\n})\n\nexport default (sbp('sbp/selectors/register', {\n  'gi.actions/identity/kv/load': async () => {\n    console.info('loading data from identity key-value store...')\n    await sbp('gi.actions/identity/kv/loadChatRoomUnreadMessages')\n    await sbp('gi.actions/identity/kv/loadPreferences')\n    await sbp('gi.actions/identity/kv/loadNotificationStatus')\n    console.info('identity key-value store data loaded!')\n  },\n  // Unread Messages\n  'gi.actions/identity/kv/fetchChatRoomUnreadMessages': async () => {\n    // Using 'chelonia/rootState' here as 'state/vuex/state' is not available\n    // in the SW, and because, even without a SW, 'loggedIn' is not yet there\n    // in Vuex state when logging in\n    const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to fetch chatroom unreadMessages without an active session')\n    }\n    return (await sbp('chelonia/kv/get', identityContractID, KV_KEYS.UNREAD_MESSAGES))?.data || {}\n  },\n  'gi.actions/identity/kv/saveChatRoomUnreadMessages': ({ data, onconflict }                                         ) => {\n    const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to update chatroom unreadMessages without an active session')\n    }\n\n    // NOTE: added the function `chelonia/kv/set` in identityContractID invocation queue in order to remove conflict error\n    //       because it uses fields of the identity contract state including height, cek, csk\n    //       this conflict error can cause the heisenbug mostly in Cypress\n    //       https://okturtles.slack.com/archives/C0EH7P20Y/p1720053305870019?thread_ts=1720025185.746849&cid=C0EH7P20Y\n    return sbp('chelonia/kv/queuedSet', {\n      contractID: identityContractID,\n      key: KV_KEYS.UNREAD_MESSAGES,\n      data,\n      onconflict\n    })\n  },\n  'gi.actions/identity/kv/loadChatRoomUnreadMessages': () => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const currentChatRoomUnreadMessages = await sbp('gi.actions/identity/kv/fetchChatRoomUnreadMessages')\n      sbp('okTurtles.events/emit', NEW_UNREAD_MESSAGES, currentChatRoomUnreadMessages)\n    })\n  },\n  'gi.actions/identity/kv/initChatRoomUnreadMessages': ({ contractID, messageHash, createdHeight }   \n                                                                  \n   ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedUnreadMessages = ({ currentData = {}, etag } = {}) => {\n        if (!currentData[contractID]) {\n          return [{\n            ...currentData,\n            [contractID]: {\n              readUntil: { messageHash, createdHeight },\n              unreadMessages: []\n            }\n          }, etag]\n        }\n        return null\n      }\n\n      const data = getUpdatedUnreadMessages()?.[0]\n      await sbp('gi.actions/identity/kv/saveChatRoomUnreadMessages', { data, onconflict: getUpdatedUnreadMessages })\n    })\n  },\n  'gi.actions/identity/kv/setChatRoomReadUntil': ({ contractID, messageHash, createdHeight, forceUpdate = false }   \n                       \n                        \n                          \n                                                                  \n                                                                                   \n                                                                                                           \n                                                                         \n                        \n   ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedUnreadMessages = ({ currentData = {}, etag } = {}) => {\n        if (forceUpdate || currentData[contractID]?.readUntil.createdHeight < createdHeight) {\n          const { unreadMessages } = currentData[contractID]\n          return [{\n            ...currentData,\n            [contractID]: {\n              readUntil: { messageHash, createdHeight },\n              unreadMessages: unreadMessages.filter(msg => msg.createdHeight > createdHeight)\n            }\n          }, etag]\n        }\n        return null\n      }\n\n      await sbp('gi.actions/identity/kv/saveChatRoomUnreadMessages', { onconflict: getUpdatedUnreadMessages })\n    })\n  },\n  'gi.actions/identity/kv/markAsUnread': ({ contractID, messageHash, createdHeight, unreadMessages }   \n                       \n                        \n                          \n                                                                         \n   ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedUnreadMessages = ({ currentData = {}, etag } = {}) => {\n        const existingReadUntil = currentData[contractID]?.readUntil\n\n        // If the requested mark-unread hash has already been set, ignore it.\n        if (existingReadUntil &&\n          existingReadUntil.isManuallyMarked &&\n          existingReadUntil?.messageHash === messageHash) { return null }\n\n        return [{\n          ...currentData,\n          [contractID]: {\n            readUntil: { messageHash, createdHeight, isManuallyMarked: true },\n            unreadMessages\n          }\n        }, etag]\n      }\n\n      await sbp('gi.actions/identity/kv/saveChatRoomUnreadMessages', { onconflict: getUpdatedUnreadMessages })\n    })\n  },\n  'gi.actions/identity/kv/addChatRoomUnreadMessage': ({ contractID, messageHash, createdHeight }   \n                                                                  \n   ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedUnreadMessages = ({ currentData = {}, etag } = {}) => {\n        if (currentData[contractID]?.readUntil.createdHeight < createdHeight) {\n          const index = currentData[contractID].unreadMessages.findIndex(msg => msg.messageHash === messageHash)\n          if (index === -1) {\n            currentData[contractID].unreadMessages.push({ messageHash, createdHeight })\n            return [currentData, etag]\n          }\n        }\n        return null\n      }\n\n      await sbp('gi.actions/identity/kv/saveChatRoomUnreadMessages', { onconflict: getUpdatedUnreadMessages })\n    })\n  },\n  'gi.actions/identity/kv/removeChatRoomUnreadMessage': ({ contractID, messageHash }   \n                                           \n   ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedUnreadMessages = ({ currentData = {}, etag } = {}) => {\n        const index = currentData[contractID]?.unreadMessages.findIndex(msg => msg.messageHash === messageHash)\n        // NOTE: index could be undefined if unreadMessages is not initialized\n        if (Number.isInteger(index) && index >= 0) {\n          currentData[contractID].unreadMessages.splice(index, 1)\n          return [currentData, etag]\n        }\n        return null\n      }\n\n      await sbp('gi.actions/identity/kv/saveChatRoomUnreadMessages', { onconflict: getUpdatedUnreadMessages })\n    })\n  },\n  'gi.actions/identity/kv/deleteChatRoomUnreadMessages': ({ contractID }                        ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedUnreadMessages = ({ currentData = {}, etag } = {}) => {\n        if (currentData[contractID]) {\n          delete currentData[contractID]\n          return [currentData, etag]\n        }\n        return null\n      }\n\n      await sbp('gi.actions/identity/kv/saveChatRoomUnreadMessages', { onconflict: getUpdatedUnreadMessages })\n    })\n  },\n  // Preferences\n  'gi.actions/identity/kv/fetchPreferences': async () => {\n    const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to fetch preferences without an active session')\n    }\n    return (await sbp('chelonia/kv/get', identityContractID, KV_KEYS.PREFERENCES))?.data || {}\n  },\n  'gi.actions/identity/kv/savePreferences': ({ data, onconflict }                                         ) => {\n    const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to update preferences without an active session')\n    }\n\n    return sbp('chelonia/kv/queuedSet', {\n      contractID: identityContractID,\n      key: KV_KEYS.PREFERENCES,\n      data,\n      onconflict\n    })\n  },\n  'gi.actions/identity/kv/loadPreferences': () => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const preferences = await sbp('gi.actions/identity/kv/fetchPreferences')\n      sbp('okTurtles.events/emit', NEW_PREFERENCES, preferences)\n    })\n  },\n  'gi.actions/identity/kv/updateDistributionBannerVisibility': ({ contractID, hidden }                                         ) => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedPreferences = ({ etag, currentData: currentPreferences = {} } = {}) => {\n        const hideDistributionBanner = {\n          ...(currentPreferences.hideDistributionBanner || {}),\n          [contractID]: hidden\n        }\n        return [{ ...currentPreferences, hideDistributionBanner }, etag]\n      }\n\n      const data = getUpdatedPreferences()[0]\n      await sbp('gi.actions/identity/kv/savePreferences', { data, onconflict: getUpdatedPreferences })\n    })\n  },\n  // Notifications\n  'gi.actions/identity/kv/fetchNotificationStatus': async () => {\n    const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to fetch notification status without an active session')\n    }\n    return (await sbp('chelonia/kv/get', identityContractID, KV_KEYS.NOTIFICATIONS))?.data || {}\n  },\n  'gi.actions/identity/kv/saveNotificationStatus': ({ data, onconflict }                                         ) => {\n    const identityContractID = sbp('state/vuex/state').loggedIn?.identityContractID\n    if (!identityContractID) {\n      throw new Error('Unable to update notification status without an active session')\n    }\n\n    const applyStorageRules = (notificationStatus) => {\n      return Object.keys(notificationStatus).reduce((acc, hash) => {\n        if (!isExpired(notificationStatus[hash])) {\n          acc[hash] = notificationStatus[hash]\n        }\n        return acc\n      }, {})\n    }\n\n    const updatedOnConflict = async (...args) => {\n      const result = await (onconflict          )(...args)\n      if (!result) return null\n\n      const [data, etag] = result\n      return [applyStorageRules(data), etag]\n    }\n\n    return sbp('chelonia/kv/queuedSet', {\n      contractID: identityContractID,\n      key: KV_KEYS.NOTIFICATIONS,\n      data: !!data && applyStorageRules(data),\n      onconflict: typeof onconflict === 'function' ? updatedOnConflict : null\n    })\n  },\n  'gi.actions/identity/kv/loadNotificationStatus': () => {\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const status = await sbp('gi.actions/identity/kv/fetchNotificationStatus')\n      sbp('gi.notifications/setNotificationStatus', status)\n    })\n  },\n  'gi.actions/identity/kv/addNotificationStatus': (notification        ) => {\n    const { hash, timestamp } = notification\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const getUpdatedNotificationStatus = ({ currentData = {}, etag } = {}) => {\n        if (!currentData?.[hash]) {\n          return [{\n            ...currentData,\n            [hash]: initNotificationStatus({ timestamp })\n          }, etag]\n        }\n        return null\n      }\n\n      const data = getUpdatedNotificationStatus()?.[0]\n      await sbp('gi.actions/identity/kv/saveNotificationStatus', { data, onconflict: getUpdatedNotificationStatus })\n    })\n  },\n  'gi.actions/identity/kv/markNotificationStatusRead': (hashes                   ) => {\n    if (typeof hashes === 'string') {\n      hashes = [hashes]\n    }\n    return sbp('okTurtles.eventQueue/queueEvent', KV_QUEUE, async () => {\n      const notifications = sbp('chelonia/rootState').notifications.items\n      const getUpdatedNotificationStatus = ({ currentData = {}, etag } = {}) => {\n        let isUpdated = false\n        for (const hash of hashes) {\n          const existing = notifications.find(n => n.hash === hash)\n          if (!currentData[hash]) {\n            currentData[hash] = initNotificationStatus({ timestamp: existing.timestamp })\n          }\n\n          const isUnRead = currentData[hash].read === false\n          // NOTE: sometimes the value from KV store could be different from the one\n          //       from client Vuex store when the device is offline or on bad network\n          //       in this case, we need to allow users to force the notifications to be marked as read\n          const isDifferent = currentData[hash].read !== existing.read\n          if (isUnRead || isDifferent) {\n            currentData[hash].read = true\n            isUpdated = true\n          }\n        }\n        return isUpdated ? [currentData, etag] : null\n      }\n\n      await sbp('gi.actions/identity/kv/saveNotificationStatus', { onconflict: getUpdatedNotificationStatus })\n    })\n  }\n})          )\n", "import { has, pick } from 'turtledash'\nimport sbp from '@sbp/sbp'\n                                                                   \nimport { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\nimport { encryptedDataKeyId, encryptedOutgoingData, encryptedOutgoingDataWithRawKey } from '~/shared/domains/chelonia/encryptedData.js'\nimport { findKeyIdByName, findSuitableSecretKeyId } from '~/shared/domains/chelonia/utils.js'\nimport { keyId, keygenOfSameType, serializeKey } from '@chelonia/crypto'\n\nexport { default as chatroom } from './chatroom.js'\nexport { default as group } from './group.js'\nexport { default as groupKV } from './group-kv.js'\nexport { default as identity } from './identity.js'\nexport { default as identityKV } from './identity-kv.js'\n\nsbp('sbp/selectors/register', {\n  // Utility function that covers the common scenario of needing to share some\n  // contract's secret keys with another contract. This function emits OP_KEY_SHARE\n  // by calling 'chelonia/out/keyShare'.\n  // One common use case for this function is sharing keys with ourselves after\n  // creating a new contract (for example, when we create a group) or to share\n  // keys of a child contract with a parent contract (such as sharing the keys to\n  // a chat room with its parent group contract)\n  'gi.actions/out/shareVolatileKeys': async ({\n    contractID,\n    contractName,\n    subjectContractID,\n    keyIds,\n    returnInvocation\n  }) => {\n    if (contractID === subjectContractID) {\n      return\n    }\n\n    const contractState = await sbp('chelonia/latestContractState', subjectContractID)\n\n    try {\n      await sbp('chelonia/contract/retain', contractID, { ephemeral: true })\n      const state = await sbp('chelonia/latestContractState', contractID)\n\n      const CEKid = findKeyIdByName(state, 'cek')\n      const signingKeyId = findSuitableSecretKeyId(state, [SPMessage.OP_KEY_SHARE], ['sig'])\n\n      if (!CEKid || !state?._vm?.authorizedKeys?.[CEKid]) {\n        throw new Error('Missing CEK; unable to proceed sharing keys')\n      }\n\n      // TODO: Use 'chelonia/haveSecretKey'\n      const secretKeys = await sbp('chelonia/rootState')['secretKeys']\n\n      const keysToShare = Array.isArray(keyIds)\n        ? pick(secretKeys, keyIds)\n        : keyIds === '*'\n          ? pick(secretKeys, Object.entries(contractState._vm.authorizedKeys)\n            .filter(([, key]) => {\n              return !!((key     )       ).meta?.private?.content\n            })\n            .map(([id]) => id)\n          )\n          : null\n\n      if (!keysToShare) {\n        throw new TypeError('Invalid parameter: keyIds')\n      }\n\n      const payload = {\n        contractID: subjectContractID,\n        keys: Object.entries(keysToShare).map(([keyId, key]                 ) => ({\n          id: keyId,\n          meta: {\n            private: {\n              content: encryptedOutgoingData(contractID, CEKid, key)\n            }\n          }\n        }))\n      }\n\n      const invocation = ['chelonia/out/keyShare', {\n        contractID,\n        contractName,\n        data: encryptedOutgoingData(contractID, CEKid, payload),\n        signingKeyId\n      }]\n      if (returnInvocation) return invocation\n\n      await sbp(...invocation)\n    } finally {\n      await sbp('chelonia/contract/release', contractID, { ephemeral: true })\n    }\n  },\n  // TODO: Move to chelonia\n  'gi.actions/out/rotateKeys': async (\n    contractID        ,\n    contractName        ,\n    keysToRotate                            ,\n    // Additional operations to be done along with key roation.\n    // If any, it should return an array of arrays of invocations that can be\n    // passed to `'chelonia/out/atomic'`. The first element of the array are\n    // operations to be done before `keyUpdate` and the second element are\n    // to be added after `keyUpdate`.\n    addtionalOperationsSelector         \n  ) => {\n    const state = sbp('chelonia/contract/state', contractID)\n\n    if (!state) {\n      throw new Error(`[gi.actions/out/rotateKeys] Cannot rotate keys for ${contractID}: No state exists`)\n    }\n\n    let ringLevel = Number.MAX_SAFE_INTEGER\n\n    // $FlowFixMe\n    const newKeys = Object.fromEntries(Object.entries(state._vm.authorizedKeys).filter(([id, data]                 ) => {\n      return !!data.meta?.private?.content && data._notAfterHeight == null && (\n        Array.isArray(keysToRotate)\n          ? keysToRotate.includes(data.name)\n          : keysToRotate === '*'\n            ? true\n            // $FlowFixMe\n            : state._volatile?.pendingKeyRevocations && has(state._volatile.pendingKeyRevocations, id))\n    }).map(([id, data]                 ) => {\n      const newKey = keygenOfSameType(data.data)\n      return [data.name, [id, newKey, keyId(newKey), encryptedDataKeyId(data.meta.private.content)]]\n    }))\n\n    if (!Object.keys(newKeys).length) {\n      console.debug('rotateKeys: No keys to rotate', { contractID })\n      return\n    }\n\n    // $FlowFixMe\n    const updatedKeys = Object.values(newKeys).map(([id, newKey, newId, eKID]) => {\n      const encryptionKeyName = state._vm.authorizedKeys[eKID].name\n      const isRotatedEncryptionKey = has(newKeys, encryptionKeyName)\n      const encryptionKey = isRotatedEncryptionKey ? newKeys[encryptionKeyName][1] : state._vm.authorizedKeys[eKID].data\n\n      if (state._vm.authorizedKeys[id].ringLevel < ringLevel) {\n        ringLevel = state._vm.authorizedKeys[id].ringLevel\n      }\n\n      return {\n        name: state._vm.authorizedKeys[id].name,\n        id: newId,\n        oldKeyId: id,\n        data: serializeKey(newKey, false),\n        meta: {\n          private: {\n            // We have two cases to handle: (1) when there is a new encryption\n            // key that is also being used to encrypt other keys and (2) when\n            // the keys are encrypted with an existing key (which is not being\n            // rotated)\n            content: isRotatedEncryptionKey\n              // For case (1), we need to call encryptedOutgoingDataWithRawKey\n              // because the new encryption key does not yet exist in\n              // _vm.authorizedKeys and because we want to encrypt keys with\n              // the specific value of encryptionKey (which is a new encryption\n              // key)\n              ? encryptedOutgoingDataWithRawKey(encryptionKey, serializeKey(newKey, true))\n              // For case (2), we call encryptedOutgoingData because the key\n              // is already present in _vm.authorizedKeys and because it may\n              // be rotated between the time we issue this operation and the\n              // time it is written to the contract\n              : encryptedOutgoingData(contractID, keyId(encryptionKey), serializeKey(newKey, true)),\n            shareable: state._vm.authorizedKeys[id].meta.private.shareable\n          }\n        }\n      }\n    })\n\n    const signingKeyId = findSuitableSecretKeyId(state, [SPMessage.OP_ATOMIC, SPMessage.OP_KEY_SHARE, SPMessage.OP_KEY_UPDATE], ['sig'], ringLevel)\n\n    if (!signingKeyId) {\n      throw new Error('No suitable signing key found')\n    }\n\n    // Additional operations to be done along with key roation.\n    // E.g., share new keys with other contracts\n    const additionalOperations = addtionalOperationsSelector ? await sbp(addtionalOperationsSelector, contractID, newKeys) : undefined\n\n    const preSendCheck = (msg, state) => {\n      const updatedKeysRemaining = updatedKeys.filter((key) => {\n        return state._vm.authorizedKeys[key.oldKeyId]._notAfterHeight == null\n      })\n\n      if (updatedKeysRemaining.length === 0) return false\n\n      // TODO: Update msg to remove unnecessary keys\n      return true\n    }\n\n    if (Array.isArray(additionalOperations) && additionalOperations.length > 0) {\n      // Issue OP_ATOMIC\n      await sbp('chelonia/out/atomic', {\n        contractID,\n        contractName,\n        data: [\n          ...(additionalOperations[0] ?? []),\n          ['chelonia/out/keyUpdate', { data: updatedKeys }],\n          ...(additionalOperations[1] ?? [])\n        ],\n        signingKeyId,\n        hooks: {\n          preSendCheck\n        }\n      })\n    } else {\n      // Issue OP_KEY_UPDATE\n      await sbp('chelonia/out/keyUpdate', {\n        contractID,\n        contractName,\n        data: updatedKeys,\n        signingKeyId,\n        hooks: {\n          preSendCheck\n        }\n      })\n    }\n  }\n})\n", "'use strict'\n\nimport { merge, union } from 'turtledash'\nimport { MESSAGE_NOTIFY_SETTINGS, CHATROOM_PRIVACY_LEVEL } from '@model/contracts/shared/constants.js'\n\nconst getters                                                                                            = {\n  currentChatRoomId (state, getters, rootState) {\n    return state.currentChatRoomIDs[rootState.currentGroupId] || null\n  },\n  currentChatRoomState (state, getters, rootState) {\n    return rootState[getters.currentChatRoomId] || {} // avoid \"undefined\" vue errors at inoportune times\n  },\n  chatNotificationSettings (state) {\n    return Object.assign({\n      publicDefault: {\n        messageNotification: MESSAGE_NOTIFY_SETTINGS.DIRECT_MESSAGES,\n        messageSound: MESSAGE_NOTIFY_SETTINGS.DIRECT_MESSAGES\n      },\n      privateDefault: {\n        messageNotification: MESSAGE_NOTIFY_SETTINGS.ALL_MESSAGES,\n        messageSound: MESSAGE_NOTIFY_SETTINGS.ALL_MESSAGES\n      }\n    }, state.chatNotificationSettings || {})\n  },\n  ourUnreadMessages (state) {\n    return state.unreadMessages || {}\n  },\n  directMessagesByGroup (state, getters, rootState) {\n    return groupID => {\n      const currentGroupDirectMessages = {}\n\n      if (!groupID) {\n        // NOTE: groupID could be null before finish syncing group contracts\n        return currentGroupDirectMessages\n      }\n\n      for (const chatRoomID of Object.keys(getters.ourDirectMessages)) {\n        const chatRoomState = rootState[chatRoomID]\n        const directMessageSettings = getters.ourDirectMessages[chatRoomID]\n        const myIdentityId = getters.ourIdentityContractId\n\n        // NOTE: skip DMs whose chatroom contracts are not synced yet\n        if (!chatRoomState || !chatRoomState.members?.[myIdentityId]) {\n          continue\n        }\n        // NOTE: direct messages should be filtered to the ones which are visible and of active group members\n        const members = Object.keys(chatRoomState.members)\n        const isDMToMyself = members.length === 1 && members[0] === myIdentityId\n        const partners = members\n          .filter(memberID => memberID !== myIdentityId)\n          .sort((p1, p2) => {\n            const p1JoinedDate = new Date(chatRoomState.members[p1].joinedDate).getTime()\n            const p2JoinedDate = new Date(chatRoomState.members[p2].joinedDate).getTime()\n            return p1JoinedDate - p2JoinedDate\n          })\n        const hasActiveMember = partners.some(memberID => Object.keys(getters.profilesByGroup(groupID)).includes(memberID))\n        if (directMessageSettings.visible && (isDMToMyself || hasActiveMember)) {\n          // NOTE: lastJoinedParter is chatroom member who has joined the chatroom for the last time.\n          //       His profile picture can be used as the picture of the direct message\n          //       possibly with the badge of the number of partners.\n          const lastJoinedPartner = isDMToMyself ? myIdentityId : partners[partners.length - 1]\n          const lastMsgTimeStamp = chatRoomState.messages?.length > 0\n            ? new Date(chatRoomState.messages[chatRoomState.messages.length - 1].datetime).getTime()\n            : 0\n\n          currentGroupDirectMessages[chatRoomID] = {\n            ...directMessageSettings,\n            members,\n            partners: partners.map(memberID => ({\n              contractID: memberID,\n              username: getters.usernameFromID(memberID),\n              displayName: getters.userDisplayNameFromID(memberID)\n            })),\n            lastJoinedPartner,\n            // TODO: The UI should display display names, usernames and (in the future)\n            // identity contract IDs differently in some way (e.g., font, font size,\n            // prefix (@), etc.) to make it impossible (or at least obvious) to impersonate\n            // users (e.g., 'user1' changing their display name to 'user2')\n            title: isDMToMyself\n              ? getters.userDisplayNameFromID(myIdentityId)\n              : partners.map(cID => getters.userDisplayNameFromID(cID)).join(', '),\n            lastMsgTimeStamp,\n            picture: getters.ourContactProfilesById[lastJoinedPartner]?.picture,\n            isDMToMyself // Can be useful when certain things in UI are meant only for 'DM to myself'\n          }\n        }\n      }\n      return currentGroupDirectMessages\n    }\n  },\n  ourGroupDirectMessages (state, getters, rootState) {\n    return getters.directMessagesByGroup(rootState.currentGroupId)\n  },\n  // NOTE: this getter is used to find the ID of the direct message in the current group\n  //       with the name[s] of partner[s]. Normally it's more useful to find direct message\n  //       by the partners instead of contractID\n  ourGroupDirectMessageFromUserIds (state, getters, rootState) {\n    return (partners) => { // NOTE: string | string[]\n      if (typeof partners === 'string') {\n        partners = [partners]\n      }\n\n      const shouldFindDMToMyself = partners.length === 1 && partners[0] === rootState.loggedIn.identityContractID\n      const currentGroupDirectMessages = getters.ourGroupDirectMessages\n      return Object.keys(currentGroupDirectMessages).find(chatRoomID => {\n        const chatRoomSettings = currentGroupDirectMessages[chatRoomID]\n\n        if (shouldFindDMToMyself) return chatRoomSettings.isDMToMyself\n        else {\n          const cPartners = chatRoomSettings.partners.map(partner => partner.contractID)\n          return cPartners.length === partners.length && union(cPartners, ((partners     )          )).length === partners.length\n        }\n      })\n    }\n  },\n  isGroupDirectMessage (state, getters) {\n    // NOTE: identity contract could not be synced at the time of calling this getter\n    return chatRoomID => !!getters.ourGroupDirectMessages[chatRoomID || getters.currentChatRoomId]\n  },\n  isDirectMessage (state, getters) {\n    // NOTE: identity contract could not be synced at the time of calling this getter\n    return chatRoomID => !!getters.ourDirectMessages[chatRoomID || getters.currentChatRoomId]\n  },\n  isGroupDirectMessageToMyself (state, getters) {\n    return chatRoomID => {\n      const chatRoomSettings = getters.ourGroupDirectMessages[chatRoomID || getters.currentChatRoomId]\n      return !!chatRoomSettings && chatRoomSettings?.isDMToMyself\n    }\n  },\n  isJoinedChatRoom (state, getters, rootState) {\n    return (chatRoomID        , memberID         ) => !!rootState[chatRoomID]?.members?.[memberID || getters.ourIdentityContractId]\n  },\n  currentChatVm (state, getters, rootState) {\n    return rootState?.[getters.currentChatRoomId]?._vm || null\n  },\n  currentChatRoomScrollPosition (state, getters) {\n    return state.chatRoomScrollPosition?.[getters.currentChatRoomId] // undefined means to the latest\n  },\n  currentChatRoomReadUntil (state, getters) {\n    // NOTE: Optional Chaining (?) is necessary when user viewing the chatroom which he is not part of\n    return getters.ourUnreadMessages[getters.currentChatRoomId]?.readUntil // undefined means to the latest\n  },\n  chatRoomUnreadMessages (state, getters) {\n    return (chatRoomID        ) => {\n      // NOTE: Optional Chaining (?) is necessary when user tries to get mentions of the chatroom which he is not part of\n      return getters.ourUnreadMessages[chatRoomID]?.unreadMessages || []\n    }\n  },\n  isChatRoomManuallyMarkedUnread (state, getters) {\n    return (chatroomID        ) => {\n      return Boolean(getters.ourUnreadMessages[chatroomID || getters.currentChatRoomId]?.readUntil?.isManuallyMarked)\n    }\n  },\n  groupUnreadMessages (state, getters, rootState) {\n    return (groupID        ) => {\n      const isGroupDirectMessage = cID => Object.keys(getters.directMessagesByGroup(groupID)).includes(cID)\n      const isGroupChatroom = cID => Object.keys(rootState[groupID]?.chatRooms || {}).includes(cID)\n      return Object.keys(getters.ourUnreadMessages)\n        .filter(cID => isGroupDirectMessage(cID) || isGroupChatroom(cID))\n        .map(cID => getters.ourUnreadMessages[cID].unreadMessages.length)\n        .reduce((sum, n) => sum + n, 0)\n    }\n  },\n  groupIdFromChatRoomId (state, getters, rootState) {\n    return (chatRoomID        ) => Object.keys(rootState.contracts)\n      .find(cId => rootState.contracts[cId].type === 'gi.contracts/group' &&\n        Object.keys(rootState[cId].chatRooms).includes(chatRoomID))\n  },\n  chatRoomsInDetail (state, getters, rootState) {\n    const chatRoomsInDetail = merge({}, getters.groupChatRooms)\n    const myIdentityId = rootState.loggedIn.identityContractID\n    for (const contractID in chatRoomsInDetail) {\n      const chatRoom = rootState[contractID]\n      if (chatRoom && chatRoom.attributes && chatRoom.members[myIdentityId]) {\n        chatRoomsInDetail[contractID] = {\n          ...chatRoom.attributes,\n          id: contractID,\n          unreadMessagesCount: getters.chatRoomUnreadMessages(contractID).length,\n          joined: true\n        }\n      } else {\n        const { name, privacyLevel } = chatRoomsInDetail[contractID]\n        chatRoomsInDetail[contractID] = { id: contractID, name, privacyLevel, joined: false }\n      }\n    }\n    return chatRoomsInDetail\n  },\n  mentionableChatroomsInDetails (state, getters) {\n    // NOTE: Channel types a user can mention\n    //       1. All public/group channels (regardless of whether joined or not).\n    //       2. A private channel that he/she has joined.\n    return Object.values(getters.chatRoomsInDetail).filter(\n      (details     ) => [CHATROOM_PRIVACY_LEVEL.GROUP, CHATROOM_PRIVACY_LEVEL.PUBLIC].includes(details.privacyLevel) ||\n      (details.privacyLevel === CHATROOM_PRIVACY_LEVEL.PRIVATE && details.joined)\n    )\n  },\n  getChatroomNameById (state, getters) {\n    return chatRoomID => {\n      const found      = Object.values(getters.chatRoomsInDetail).find((details     ) => details.id === chatRoomID)\n      return found ? found.name : null\n    }\n  },\n  chatRoomMembersInSort (state, getters) {\n    return getters.groupMembersSorted\n      .map(member => ({ contractID: member.contractID, username: member.username, displayName: member.displayName }))\n      .filter(member => !!getters.chatRoomMembers[member.contractID]) || []\n  }\n}\n\nexport default getters\n", "'use strict'\n\n                  \n                      \n                                         \n                                            \n                 \n                         \n                               \n  \n\n// https://github.com/okTurtles/group-income/issues/813#issuecomment-593680834\n// round all accounting to DECIMALS_MAX decimal places max to avoid consensus\n// issues that can arise due to different floating point values\n// at extreme precisions. If this becomes inadequate, instead of increasing\n// this value, switch to a different currency base, e.g. from BTC to mBTC.\nexport const DECIMALS_MAX = 8\n\nfunction commaToDots (value                 )         {\n  // ex: \"1,55\" -> \"1.55\"\n  return typeof value === 'string' ? value.replace(/,/, '.') : value.toString()\n}\n\nfunction isNumeric (nr        )          {\n  return !isNaN((nr     ) - parseFloat(nr))\n}\n\nfunction isInDecimalsLimit (nr        , decimalsMax        ) {\n  const decimals = nr.split('.')[1]\n  return !decimals || decimals.length <= decimalsMax\n}\n\n// NOTE: Unsure whether this is *always* string; it comes from 'validators' in other files\nfunction validateMincome (value        , decimalsMax        ) {\n  const nr = commaToDots(value)\n  return isNumeric(nr) && isInDecimalsLimit(nr, decimalsMax)\n}\n\nfunction decimalsOrInt (num        , decimalsMax        )         {\n  // ex: 12.5 -> \"12.50\", but 250 -> \"250\"\n  return num.toFixed(decimalsMax).replace(/\\.0+$/, '')\n}\n\nexport function saferFloat (value        )         {\n  // ex: 1.333333333333333333 -> 1.33333333\n  return parseFloat(value.toFixed(DECIMALS_MAX))\n}\n\nexport function normalizeCurrency (value        )         {\n  // ex: \"1,333333333333333333\" -> 1.33333333\n  return saferFloat(parseFloat(commaToDots(value)))\n}\n\n// NOTE: Unsure whether this is *always* string; it comes from 'validators' in other files\nexport function mincomePositive (value        )          {\n  return parseFloat(commaToDots(value)) > 0\n}\n\nfunction makeCurrency (options)           {\n  const { symbol, symbolWithCode, decimalsMax, formatCurrency } = options\n  return {\n    symbol,\n    symbolWithCode,\n    decimalsMax,\n    displayWithCurrency: (n        ) => formatCurrency(decimalsOrInt(n, decimalsMax)),\n    displayWithoutCurrency: (n        ) => decimalsOrInt(n, decimalsMax),\n    validate: (n        ) => validateMincome(n, decimalsMax)\n  }\n}\n\n// NOTE: if we needed for some reason, this could also be defined in\n//       a json file that's read in and generates this object. For\n//       example, that would allow the addition of currencies without\n//       having to \"recompile\" a new version of the app.\nconst currencies                         = {\n  USD: makeCurrency({\n    symbol: '$',\n    symbolWithCode: '$ USD',\n    decimalsMax: 2,\n    formatCurrency: amount => '$' + amount\n  }),\n  EUR: makeCurrency({\n    symbol: '\u20AC',\n    symbolWithCode: '\u20AC EUR',\n    decimalsMax: 2,\n    formatCurrency: amount => '\u20AC' + amount\n  }),\n  BTC: makeCurrency({\n    symbol: '\u0243',\n    symbolWithCode: '\u0243 BTC',\n    decimalsMax: DECIMALS_MAX,\n    formatCurrency: amount => amount + '\u0243'\n  })\n}\n\nexport default currencies\n", "'use strict'\n\n                              \n                   \n                  \n \n\nexport default function mincomeProportional (haveNeeds                       )                {\n  let totalHave = 0\n  let totalNeed = 0\n  const havers = []\n  const needers = []\n  for (const haveNeed of haveNeeds) {\n    if (haveNeed.haveNeed > 0) {\n      havers.push(haveNeed)\n      totalHave += haveNeed.haveNeed\n    } else if (haveNeed.haveNeed < 0) {\n      needers.push(haveNeed)\n      totalNeed += Math.abs(haveNeed.haveNeed)\n    }\n  }\n  const totalPercent = Math.min(1, totalNeed / totalHave)\n  const payments = []\n  for (const haver of havers) {\n    const distributionAmount = totalPercent * haver.haveNeed\n    for (const needer of needers) {\n      const belowPercentage = Math.abs(needer.haveNeed) / totalNeed\n      payments.push({\n        amount: distributionAmount * belowPercentage,\n        fromMemberID: haver.memberID,\n        toMemberID: needer.memberID\n      })\n    }\n  }\n  return payments\n}\n", "'use strict'\n\n// greedy algorithm responsible for \"balancing\" payments\n// such that the least number of payments are made.\nexport default function minimizeTotalPaymentsCount (\n  distribution               \n)                                                                            {\n  const neederTotalReceived = {}\n  const haverTotalHave = {}\n  const haversSorted = []\n  const needersSorted = []\n  const minimizedDistribution = []\n  for (const todo of distribution) {\n    neederTotalReceived[todo.toMemberID] = (neederTotalReceived[todo.toMemberID] || 0) + todo.amount\n    haverTotalHave[todo.fromMemberID] = (haverTotalHave[todo.fromMemberID] || 0) + todo.amount\n  }\n  for (const memberID in haverTotalHave) {\n    haversSorted.push({ memberID, amount: haverTotalHave[memberID] })\n  }\n  for (const memberID in neederTotalReceived) {\n    needersSorted.push({ memberID, amount: neederTotalReceived[memberID] })\n  }\n  // sort haves and needs: greatest to least\n  haversSorted.sort((a, b) => b.amount - a.amount)\n  needersSorted.sort((a, b) => b.amount - a.amount)\n  while (haversSorted.length > 0 && needersSorted.length > 0) {\n    const mostHaver = haversSorted.pop()\n    const mostNeeder = needersSorted.pop()\n    const diff = mostHaver.amount - mostNeeder.amount\n    if (diff < 0) {\n      // we used up everything the haver had\n      minimizedDistribution.push({ amount: mostHaver.amount, fromMemberID: mostHaver.memberID, toMemberID: mostNeeder.memberID })\n      mostNeeder.amount -= mostHaver.amount\n      needersSorted.push(mostNeeder)\n    } else if (diff > 0) {\n      // we completely filled up the needer's need and still have some left over\n      minimizedDistribution.push({ amount: mostNeeder.amount, fromMemberID: mostHaver.memberID, toMemberID: mostNeeder.memberID })\n      mostHaver.amount -= mostNeeder.amount\n      haversSorted.push(mostHaver)\n    } else {\n      // a perfect match\n      minimizedDistribution.push({ amount: mostNeeder.amount, fromMemberID: mostHaver.memberID, toMemberID: mostNeeder.memberID })\n    }\n  }\n  return minimizedDistribution\n}\n", "'use strict'\n\nimport { cloneDeep } from 'turtledash'\nimport { DECIMALS_MAX, saferFloat } from '../currencies.js'\nimport mincomeProportional from './mincome-proportional.js'\nimport minimizeTotalPaymentsCount from './payments-minimizer.js'\n\n                                  \n\nconst tinyNum = 1 / Math.pow(10, DECIMALS_MAX)\n\nexport function unadjustedDistribution ({ haveNeeds = [], minimize = true }   \n                                              \n )               {\n  const distribution = mincomeProportional(haveNeeds)\n  return minimize ? minimizeTotalPaymentsCount(distribution) : distribution\n}\n\nexport function adjustedDistribution (\n  { distribution, payments, dueOn }                                                                       \n)               {\n  distribution = cloneDeep(distribution)\n  // ensure the total is set because of how reduceDistribution works\n  for (const todo of distribution) {\n    todo.total = todo.amount\n  }\n  distribution = subtractDistributions(distribution, payments)\n    // remove any todos for containing miniscule amounts\n    // and pledgers who switched sides should have their todos removed\n    .filter(todo => todo.amount >= tinyNum)\n  for (const todo of distribution) {\n    todo.amount = saferFloat(todo.amount)\n    todo.total = saferFloat(todo.total)\n    todo.partial = todo.total !== todo.amount\n    todo.isLate = false\n    todo.dueOn = dueOn\n  }\n  // TODO: add in latePayments to the end of the distribution\n  //       consider passing in latePayments\n  return distribution\n}\n\n// Merges multiple payments between any combinations two of users:\nfunction reduceDistribution (payments              )               {\n  // Don't modify the payments list/object parameter in-place, as this is not intended:\n  payments = cloneDeep(payments)\n  for (let i = 0; i < payments.length; i++) {\n    const paymentA = payments[i]\n    for (let j = i + 1; j < payments.length; j++) {\n      const paymentB = payments[j]\n\n      // Were paymentA and paymentB between the same two users?\n      if ((paymentA.fromMemberID === paymentB.fromMemberID && paymentA.toMemberID === paymentB.toMemberID) ||\n        (paymentA.toMemberID === paymentB.fromMemberID && paymentA.fromMemberID === paymentB.toMemberID)) {\n        // Add or subtract paymentB's amount to paymentA's amount, depending on the relative\n        // direction of the two payments:\n        paymentA.amount += (paymentA.fromMemberID === paymentB.fromMemberID ? 1 : -1) * paymentB.amount\n        paymentA.total += (paymentA.fromMemberID === paymentB.fromMemberID ? 1 : -1) * paymentB.total\n        // Remove paymentB from payments, and decrement the inner sentinal loop variable:\n        payments.splice(j, 1)\n        j--\n      }\n    }\n  }\n  return payments\n}\n\nfunction addDistributions (paymentsA              , paymentsB              )               {\n  return reduceDistribution([...paymentsA, ...paymentsB])\n}\n\nfunction subtractDistributions (paymentsA              , paymentsB              )               {\n  // Don't modify any payment list/objects parameters in-place, as this is not intended:\n  paymentsB = cloneDeep(paymentsB)\n  // Reverse the sign of the second operand's amounts so that the final addition is actually subtraction:\n  for (const p of paymentsB) {\n    p.amount *= -1\n    p.total *= -1\n  }\n  return addDistributions(paymentsA, paymentsB)\n}\n", "'use strict'\n\nimport { unionOf, literalOf } from '~/frontend/model/contracts/misc/flowTyper.js'\n\nexport const PAYMENT_PENDING = 'pending'\nexport const PAYMENT_CANCELLED = 'cancelled'\nexport const PAYMENT_ERROR = 'error'\nexport const PAYMENT_NOT_RECEIVED = 'not-received'\nexport const PAYMENT_COMPLETED = 'completed'\nexport const paymentStatusType         = unionOf(...[PAYMENT_PENDING, PAYMENT_CANCELLED, PAYMENT_ERROR, PAYMENT_NOT_RECEIVED, PAYMENT_COMPLETED].map(k => literalOf(k)))\nexport const PAYMENT_TYPE_MANUAL = 'manual'\nexport const PAYMENT_TYPE_BITCOIN = 'bitcoin'\nexport const PAYMENT_TYPE_PAYPAL = 'paypal'\nexport const paymentType         = unionOf(...[PAYMENT_TYPE_MANUAL, PAYMENT_TYPE_BITCOIN, PAYMENT_TYPE_PAYPAL].map(k => literalOf(k)))\n", "export default ({\n  chatRoomSettings (state, getters) {\n    return getters.currentChatRoomState.settings || {}\n  },\n  chatRoomAttributes (state, getters) {\n    return getters.currentChatRoomState.attributes || {}\n  },\n  chatRoomMembers (state, getters) {\n    return getters.currentChatRoomState.members || {}\n  },\n  chatRoomRecentMessages (state, getters) {\n    return getters.currentChatRoomState.messages || []\n  },\n  chatRoomPinnedMessages (state, getters) {\n    return (getters.currentChatRoomState.pinnedMessages || []).sort((a, b) => a.height < b.height ? 1 : -1)\n  }\n}        )\n", "import { INVITE_STATUS } from '~/shared/domains/chelonia/constants.js'\nimport {\n  INVITE_INITIAL_CREATOR,\n  MAX_SAVED_PERIODS,\n  PROFILE_STATUS,\n  PROPOSAL_GENERIC\n} from '../constants.js'\nimport currencies from '../currencies.js'\nimport { createPaymentInfo, paymentHashesFromPaymentPeriod } from '../functions.js'\nimport { PAYMENT_COMPLETED } from '../payments/index.js'\nimport { addTimeToDate, dateFromPeriodStamp, dateIsWithinPeriod, dateToPeriodStamp, periodStampsForDate } from '../time.js'\n\n/*\n`-ForGroup` pattern:\n\nSome getters (see, e.g., `groupSettings` and `groupSettingsForGroup`) are\nimplemented in pairs, with a variant having the `ForGroup` suffix. This is\nbecause the non-suffixed version is supposed to work for the current group\n(meaning the result of `currentGroupState`), while the suffixed version takes\na group state as a parameter. To avoid redundancy, the non-suffixed version is\nimplemented using the suffixed version (i.e., calling it with\n`getters.currentGroupState` as a parameter).\n\nWhy state and not contract ID?\n\nWe don't use an `Id` version, e.g., `-ForGroupId`, because the ID isn't\nnecessarily known. Contracts rely on a different patter, a getter to get the\ncurrent state (e.g., `currentGroupState`) and using a `ForGroupId` pattern would\nbreak this and require significant refactoring. By using the state, getters are\neasily interoperable in all execution environments we support (i.e., browser\nwindows, SW and contracts)\n\nWhy do we need this?\n\nThe primary motivation for this pattern is to reduce redundancy and improve the\nflexibility of getters, as well as being to re-use complex logic in getters\nfrom most places. Currently, we use getters from three locations: in the 'app'\n(e.g., a browser window), in a service worker and in contracts.\n\nThe 'app' has a current group, so the non-prefixed version\n(e.g., `groupSettings`) is generally sufficient. Contracts have an implicit\ncurrent group, which is the current contract. In these cases, getters work by\ninjecting a `currentGroupState` getter that resolves to the current contract\nstate. However, the service worker doesn't have an implicit or explicit current\ngroup, and 'injecting' a `currentGroupState` can't be done in a way that is\nunderstandable and also is compatible with how Vuex getters work (*), should we\ndecide to move some of the SW code into the app.\n\nSince we want the SW to be able to do things for all groups without having a\nglobal 'current group', and we also don't want to be essentially re-defining\ngetters when they're needed, the prefixed version (e.g., `groupSettingsForGroup`)\ncan be used to bridge the gap and use existing definitions. This approach is\npotentially also useful in the 'app', if we want to access information about a\ngroup which isn't the current one (an example of this could be if we wanted to\nsay \"User 'alice' and you also have group 'foo' in common\").\n\n(*) One potential alternative solution is using a prototype-inheritance or a\nProxy object on the getters object to override `currentGroupState`. This can be\nmade to work in the SW using `this` magic, but is incompatible with the way\nVuex works. Also, this approach is potentially confusing and hard to read.\n\n*/\n\nexport default ({\n  currentGroupOwnerID (state, getters) {\n    return getters.currentGroupState.groupOwnerID\n  },\n  groupSettingsForGroup (state, getters) {\n    return (state) => state.settings || {}\n  },\n  groupSettings (state, getters) {\n    return getters.groupSettingsForGroup(getters.currentGroupState)\n  },\n  profileActive (state, getters) {\n    return member => {\n      const profiles = getters.currentGroupState.profiles\n      return profiles?.[member]?.status === PROFILE_STATUS.ACTIVE\n    }\n  },\n  pendingAccept (state, getters) {\n    return member => {\n      const profiles = getters.currentGroupState.profiles\n      return profiles?.[member]?.status === PROFILE_STATUS.PENDING\n    }\n  },\n  groupProfileForGroup (state, getters) {\n    return (state, member) => {\n      const profiles = state.profiles\n      return profiles && profiles[member] && {\n        ...profiles[member],\n        get lastLoggedIn () {\n          // Yes, technically `currentGroupLastLoggedIn` is for the current\n          // group, but we don't necessarily know the correct group ID here.\n          return getters.currentGroupLastLoggedIn[member] || this.joinedDate\n        }\n      }\n    }\n  },\n  groupProfile (state, getters) {\n    return member => getters.groupProfileForGroup(getters.currentGroupState, member)\n  },\n  groupProfilesForGroup (state, getters) {\n    return (state) => {\n      const profiles = {}\n      for (const member in (state.profiles || {})) {\n        const profile = getters.groupProfileForGroup(state, member)\n        if (profile.status === PROFILE_STATUS.ACTIVE) {\n          profiles[member] = profile\n        }\n      }\n      return profiles\n    }\n  },\n  groupProfiles (state, getters) {\n    return getters.groupProfilesForGroup(getters.currentGroupState)\n  },\n  groupCreatedDate (state, getters) {\n    return getters.groupProfile(getters.currentGroupOwnerID).joinedDate\n  },\n  groupMincomeAmountForGroup (state, getters) {\n    return state => getters.groupSettingsForGroup(state).mincomeAmount\n  },\n  groupMincomeAmount (state, getters) {\n    return getters.groupMincomeAmountForGroup(getters.currentGroupState)\n  },\n  groupMincomeCurrency (state, getters) {\n    return getters.groupSettings.mincomeCurrency\n  },\n  // Oldest period key first.\n  groupSortedPeriodKeysForGroup (state, getters) {\n    return state => {\n      const { distributionDate, distributionPeriodLength } = getters.groupSettingsForGroup(state)\n      if (!distributionDate) return []\n      // The .sort() call might be only necessary in older browser which don't maintain object key ordering.\n      // A comparator function isn't required for now since our keys are ISO strings.\n      const keys = Object.keys(getters.groupPeriodPaymentsForGroup(state)).sort()\n      // Append the waiting period stamp if necessary.\n      if (!keys.length && MAX_SAVED_PERIODS > 0) {\n        keys.push(dateToPeriodStamp(addTimeToDate(distributionDate, -distributionPeriodLength)))\n      }\n      // Append the distribution date if necessary.\n      if (keys[keys.length - 1] !== distributionDate) {\n        keys.push(distributionDate)\n      }\n      return keys\n    }\n  },\n  groupSortedPeriodKeys (state, getters) {\n    return getters.groupSortedPeriodKeysForGroup(getters.currentGroupState)\n  },\n  // paymentTotalfromMembertoMemberID (state, getters) {\n  // // this code was removed in https://github.com/okTurtles/group-income/pull/1691\n  // // because it was unused. feel free to bring it back if needed.\n  // },\n  //\n  // The following three getters return either a known period stamp for the given date,\n  // or a predicted one according to the period length.\n  // They may also return 'undefined', in which case the caller should check archived data.\n  periodStampGivenDateForGroup (state, getters) {\n    return (state, date               , periods           )                => {\n      return periodStampsForDate(date, {\n        knownSortedStamps: periods || getters.groupSortedPeriodKeysForGroup(state),\n        periodLength: getters.groupSettingsForGroup(state).distributionPeriodLength\n      }).current\n    }\n  },\n  periodStampGivenDate (state, getters) {\n    return (date               , periods           )                => {\n      return getters.periodStampGivenDateForGroup(getters.currentGroupState, date, periods)\n    }\n  },\n  periodBeforePeriodForGroup (state, getters) {\n    return (groupState        , periodStamp        , periods           )                => {\n      return periodStampsForDate(periodStamp, {\n        knownSortedStamps: periods || getters.groupSortedPeriodKeysForGroup(groupState),\n        periodLength: getters.groupSettingsForGroup(groupState).distributionPeriodLength\n      }).previous\n    }\n  },\n  periodBeforePeriod (state, getters) {\n    return (periodStamp        , periods           ) => getters.periodBeforePeriodForGroup(getters.currentGroupState, periodStamp, periods)\n  },\n  periodAfterPeriodForGroup (state, getters) {\n    return (groupState        , periodStamp        , periods           )                => {\n      return periodStampsForDate(periodStamp, {\n        knownSortedStamps: periods || getters.groupSortedPeriodKeysForGroup(groupState),\n        periodLength: getters.groupSettingsForGroup(groupState).distributionPeriodLength\n      }).next\n    }\n  },\n  periodAfterPeriod (state, getters) {\n    return (periodStamp        , periods           ) => getters.periodAfterPeriodForGroup(getters.currentGroupState, periodStamp, periods)\n  },\n  dueDateForPeriodForGroup (state, getters) {\n    return (state, periodStamp        , periods           ) => {\n      // NOTE: logically it's should be 1 milisecond before the periodAfterPeriod\n      //       1 mili-second doesn't make any difference to the users\n      //       so periodAfterPeriod is used to make it simple\n      return getters.periodAfterPeriodForGroup(state, periodStamp, periods)\n    }\n  },\n  dueDateForPeriod (state, getters) {\n    return (periodStamp        , periods           ) => {\n      return getters.dueDateForPeriodForGroup(getters.currentGroupState, periodStamp, periods)\n    }\n  },\n  paymentHashesForPeriodForGroup (state, getters) {\n    return (state, periodStamp) => {\n      const periodPayments = getters.groupPeriodPaymentsForGroup(state)[periodStamp]\n      if (periodPayments) {\n        return paymentHashesFromPaymentPeriod(periodPayments)\n      }\n    }\n  },\n  paymentHashesForPeriod (state, getters) {\n    return (periodStamp) => {\n      return getters.paymentHashesForPeriodForGroup(getters.currentGroupState, periodStamp)\n    }\n  },\n  groupMembersByContractID (state, getters) {\n    return Object.keys(getters.groupProfiles)\n  },\n  groupMembersCount (state, getters) {\n    return getters.groupMembersByContractID.length\n  },\n  groupMembersPending (state, getters) {\n    const invites = getters.currentGroupState.invites\n    const vmInvites = getters.currentGroupState._vm.invites\n    const pendingMembers = Object.create(null)\n    for (const inviteKeyId in invites) {\n      if (\n        vmInvites[inviteKeyId].status === INVITE_STATUS.VALID &&\n            invites[inviteKeyId].creatorID !== INVITE_INITIAL_CREATOR\n      ) {\n        pendingMembers[inviteKeyId] = {\n          displayName: invites[inviteKeyId].invitee,\n          invitedBy: invites[inviteKeyId].creatorID,\n          expires: vmInvites[inviteKeyId].expires\n        }\n      }\n    }\n    return pendingMembers\n  },\n  groupShouldPropose (state, getters) {\n    return getters.groupMembersCount >= 3\n  },\n  groupDistributionStarted (state, getters) {\n    return (currentDate        ) => currentDate >= getters.groupSettings?.distributionDate\n  },\n  groupProposalSettings (state, getters) {\n    return (proposalType = PROPOSAL_GENERIC) => {\n      return getters.groupSettings.proposals?.[proposalType]\n    }\n  },\n  groupCurrency (state, getters) {\n    const mincomeCurrency = getters.groupMincomeCurrency\n    return mincomeCurrency && currencies[mincomeCurrency]\n  },\n  groupMincomeFormatted (state, getters) {\n    return getters.withGroupCurrency?.(getters.groupMincomeAmount)\n  },\n  groupMincomeSymbolWithCode (state, getters) {\n    return getters.groupCurrency?.symbolWithCode\n  },\n  groupPeriodPaymentsForGroup (state, getters)         {\n    // note: a lot of code expects this to return an object, so keep the || {} below\n    return (state) => {\n      return state.paymentsByPeriod || {}\n    }\n  },\n  groupPeriodPayments (state, getters)         {\n    return getters.groupPeriodPaymentsForGroup(getters.currentGroupState)\n  },\n  groupThankYousFrom (state, getters)         {\n    return getters.currentGroupState.thankYousFrom || {}\n  },\n  groupStreaks (state, getters)         {\n    return getters.currentGroupState.streaks || {}\n  },\n  groupTotalPledgeAmount (state, getters)         {\n    return getters.currentGroupState.totalPledgeAmount || 0\n  },\n  withGroupCurrency (state, getters) {\n    // TODO: If this group has no defined mincome currency, not even a default one like\n    //       USD, then calling this function is probably an error which should be reported.\n    //       Just make sure the UI doesn't break if an exception is thrown, since this is\n    //       bound to the UI in some location.\n    return getters.groupCurrency?.displayWithCurrency\n  },\n  groupChatRooms (state, getters) {\n    return getters.currentGroupState.chatRooms\n  },\n  groupGeneralChatRoomId (state, getters) {\n    return getters.currentGroupState.generalChatRoomId\n  },\n  // getter is named haveNeedsForThisPeriod instead of haveNeedsForPeriod because it uses\n  // getters.groupProfiles - and that is always based on the most recent values. we still\n  // pass in the current period because it's used to set the \"when\" property\n  haveNeedsForThisPeriodForGroup (state, getters) {\n    return (state, currentPeriod        ) => {\n      // NOTE: if we ever switch back to the \"real-time\" adjusted distribution algorithm,\n      //       make sure that this function also handles userExitsGroupEvent\n      const groupProfiles = getters.groupProfilesForGroup(state) // TODO: these should use the haveNeeds for the specific period's distribution period\n      const haveNeeds = []\n      for (const memberID in groupProfiles) {\n        const { incomeDetailsType, joinedDate } = groupProfiles[memberID]\n        if (incomeDetailsType) {\n          const amount = groupProfiles[memberID][incomeDetailsType]\n          const haveNeed = incomeDetailsType === 'incomeAmount' ? amount - getters.groupMincomeAmountForGroup(state) : amount\n          // construct 'when' this way in case we ever use a pro-rated algorithm\n          let when = dateFromPeriodStamp(currentPeriod).toISOString()\n          if (dateIsWithinPeriod({\n            date: joinedDate,\n            periodStart: currentPeriod,\n            periodLength: getters.groupSettingsForGroup(state).distributionPeriodLength\n          })) {\n            when = joinedDate\n          }\n          haveNeeds.push({ memberID, haveNeed, when })\n        }\n      }\n      return haveNeeds\n    }\n  },\n  haveNeedsForThisPeriod (state, getters) {\n    return (currentPeriod        ) => {\n      return getters.haveNeedsForThisPeriodForGroup(getters.currentGroupState, currentPeriod)\n    }\n  },\n  paymentsForPeriodForGroup (state, getters) {\n    return (state, periodStamp) => {\n      const hashes = getters.paymentHashesForPeriodForGroup(state, periodStamp)\n      const events = []\n      if (hashes && hashes.length > 0) {\n        const payments = state.payments\n        for (const paymentHash of hashes) {\n          const payment = payments[paymentHash]\n          if (payment.data.status === PAYMENT_COMPLETED) {\n            events.push(createPaymentInfo(paymentHash, payment))\n          }\n        }\n      }\n      return events\n    }\n  },\n  paymentsForPeriod (state, getters) {\n    return (periodStamp) => {\n      return getters.paymentsForPeriodForGroup(getters.currentGroupState, periodStamp)\n    }\n  }\n  // distributionEventsForMonth (state, getters) {\n  //   return (monthstamp) => {\n  //     // NOTE: if we ever switch back to the \"real-time\" adjusted distribution\n  //     // algorithm, make sure that this function also handles userExitsGroupEvent\n  //     const distributionEvents = getters.haveNeedEventsForMonth(monthstamp)\n  //     const paymentEvents = getters.paymentEventsForMonth(monthstamp)\n  //     distributionEvents.splice(distributionEvents.length, 0, paymentEvents)\n  //     return distributionEvents.sort((a, b) => compareISOTimestamps(a.data.when, b.data.when))\n  //   }\n  // }\n}        )\n", "export default ({\n  loginState (state, getters) {\n    return getters.currentIdentityState.loginState\n  },\n  ourDirectMessages (state, getters) {\n    return getters.currentIdentityState.chatRooms || {}\n  }\n}        )\n", "import { L } from '@common/common.js'\nimport { INVITE_INITIAL_CREATOR, PROFILE_STATUS } from '@model/contracts/shared/constants.js'\nimport { INVITE_STATUS } from '~/shared/domains/chelonia/constants.js'\nimport { adjustedDistribution, unadjustedDistribution } from '@model/contracts/shared/distribution/distribution.js'\nimport { PAYMENT_NOT_RECEIVED } from '@model/contracts/shared/payments/index.js'\nimport chatroomGetters from './contracts/shared/getters/chatroom.js'\nimport groupGetters from './contracts/shared/getters/group.js'\nimport identityGetters from './contracts/shared/getters/identity.js'\n\nconst checkedUsername = (state        , username        , userID        ) => {\n  if (username && state.namespaceLookups?.[username] === userID) {\n    return username\n  }\n}\n\n// Find the 'anyone can join' invite ID. Since there could be multiple, and some\n// of those could have exipred, we need a for loop\nconst anyoneCanJoinInviteId = (invites        , getters        )          =>\n  Object.keys(invites).find(invite =>\n    // First, we want 'anyone can join' invites\n    invites[invite].creatorID === INVITE_INITIAL_CREATOR &&\n    // and that haven't been revoked\n    getters.currentGroupState._vm.invites[invite].status === INVITE_STATUS.VALID &&\n    // and that haven't expired (using negative logic because expires could be\n    // undefined for non expiring-invites)\n    !(getters.currentGroupState._vm.invites[invite].expires < Date.now()) &&\n    // and that that haven't been entirely used up\n    !(getters.currentGroupState._vm.invites[invite].quantity <= 0)\n  )\n\n// https://vuex.vuejs.org/en/getters.html\n// https://vuex.vuejs.org/en/modules.html\nconst getters                                                                         = {\n  // !!  IMPORTANT  !!\n  //\n  // We register pure Vuex getters here, but later on at the bottom of this file,\n  // we will also import into Vuex the contract getters so that they can be reused\n  // without having to be redefined. This is possible because Chelonia contract getters\n  // are designed to be compatible with Vuex getters.\n  //\n  // We will use the getters 'currentGroupState', 'currentIdentityState', and\n  // 'currentChatRoomState' as a \"bridge\" between the contract getters and Vuex.\n  //\n  // This makes it possible for the getters inside of contracts to refer to each\n  // specific contractID instance, while the Vuex version of those getters that\n  // are imported at the bottom of this file (in the listener for CONTRACT_REGISTERED\n  // will reference the state for the specific contractID for either the current group,\n  // the current user identity contract, or the current chatroom we're looking at.\n  //\n  // For getters that get data from only contract state, write them\n  // under the 'getters' key of the object passed to 'chelonia/defineContract'.\n  // See for example: frontend/model/contracts/group.js\n  //\n  // Again, for convenience, we've defined the same getter, `currentGroupState`,\n  // twice, so that we can reuse the same getter definitions both here with Vuex,\n  // and inside of the contracts (e.g. in group.js).\n  //\n  // The 'currentGroupState' here is based off the value of `state.currentGroupId`,\n  // a user preference that does not exist in the group contract state.\n  currentGroupState (state) {\n    // The service worker should not be using this getter.\n    if (process.env.NODE_ENV === 'development' || process.env.CI) {\n      // $FlowFixMe[cannot-resolve-name]\n      if (typeof Window === 'undefined') {\n        const error = new Error('Tried to access currentGroupState from outside a browsing context')\n        Promise.reject(error)\n        throw error\n      }\n    }\n    return state[state.currentGroupId] || {} // avoid \"undefined\" vue errors at inoportune times\n  },\n  currentIdentityState (state) {\n    return (state.loggedIn && state[state.loggedIn.identityContractID]) || {}\n  },\n  ourUsername (state, getters) {\n    return state.loggedIn && getters.usernameFromID(state.loggedIn.identityContractID)\n  },\n  ourPreferences (state) {\n    return state.preferences\n  },\n  ourProfileActive (state, getters) {\n    return getters.profileActive(getters.ourIdentityContractId)\n  },\n  ourPendingAccept (state, getters) {\n    return getters.pendingAccept(getters.ourIdentityContractId)\n  },\n  ourGroupProfileForGroup (state, getters) {\n    return (state) => getters.groupProfileForGroup(state, getters.ourIdentityContractId)\n  },\n  ourGroupProfile (state, getters) {\n    return getters.ourGroupProfileForGroup(getters.currentGroupState)\n  },\n  ourUserDisplayName (state, getters) {\n    // TODO - refactor Profile and Welcome and any other component that needs this\n    const userContract = getters.currentIdentityState || {}\n    return userContract.attributes?.displayName || getters.ourUsername || getters.ourIdentityContractId\n  },\n  ourIdentityContractId (state) {\n    return state.loggedIn && state.loggedIn.identityContractID\n  },\n  ourGroups (state, getters) {\n    const identityContractID = getters.ourIdentityContractId\n    if (!identityContractID) return []\n\n    return Object.keys(state[identityContractID]?.groups || {}).filter(\n      (gId) => !state[identityContractID].groups[gId].hasLeft && state[gId]\n    )\n  },\n  currentGroupLastLoggedIn (state) {\n    return state.lastLoggedIn[state.currentGroupId] || {}\n  },\n  // NOTE: since this getter is written using `getters.ourUsername`, which is based\n  //       on vuexState.loggedIn (a user preference), we cannot use this getter\n  //       into group.js\n  ourContributionSummary (state, getters) {\n    const groupProfiles = getters.groupProfiles\n    const ourIdentityContractId = getters.ourIdentityContractId\n    const ourGroupProfile = getters.ourGroupProfile\n\n    if (!ourGroupProfile || !ourGroupProfile.incomeDetailsType) {\n      return {}\n    }\n\n    const doWeNeedIncome = ourGroupProfile.incomeDetailsType === 'incomeAmount'\n    const distribution = getters.groupIncomeDistribution\n\n    const nonMonetaryContributionsOf = (memberID) => groupProfiles[memberID].nonMonetaryContributions || []\n\n    return {\n      givingMonetary: (() => {\n        if (doWeNeedIncome) { return null }\n        const who = []\n        const whoIds = []\n        const total = distribution\n          .filter(p => p.fromMemberID === ourIdentityContractId)\n          .reduce((acc, payment) => {\n            who.push(getters.userDisplayNameFromID(payment.toMemberID))\n            whoIds.push(payment.toMemberID)\n\n            return acc + payment.amount\n          }, 0)\n\n        return { who, whoIds, total, pledged: ourGroupProfile.pledgeAmount }\n      })(),\n      receivingMonetary: (() => {\n        if (!doWeNeedIncome) { return null }\n        const needed = getters.groupSettings.mincomeAmount - ourGroupProfile.incomeAmount\n        const who = []\n        const whoIds = []\n        const total = distribution\n          .filter(p => p.toMemberID === ourIdentityContractId)\n          .reduce((acc, payment) => {\n            who.push(getters.userDisplayNameFromID(payment.fromMemberID))\n            whoIds.push(payment.fromMemberID)\n\n            return acc + payment.amount\n          }, 0)\n\n        return { who, whoIds, total, needed }\n      })(),\n      receivingNonMonetary: (() => {\n        const listWho = Object.keys(groupProfiles)\n          .filter(memberID => memberID !== ourIdentityContractId && nonMonetaryContributionsOf(memberID).length > 0)\n        const listWhat = listWho.reduce((contr, memberID) => {\n          const displayName = getters.userDisplayNameFromID(memberID)\n          const userContributions = nonMonetaryContributionsOf(memberID)\n\n          userContributions.forEach((what) => {\n            const contributionIndex = contr.findIndex(c => c.what === what)\n\n            if (contributionIndex >= 0) {\n              contr[contributionIndex].who.push(displayName)\n              contr[contributionIndex].whoIds.push(memberID)\n            } else {\n              contr.push({ who: [displayName], whoIds: [memberID], what })\n            }\n          })\n          return contr\n        }, [])\n\n        return listWho.length > 0 ? { what: listWhat, who: listWho } : null\n      })(),\n      givingNonMonetary: (() => {\n        const contributions = ourGroupProfile.nonMonetaryContributions\n\n        return contributions.length > 0 ? contributions : null\n      })()\n    }\n  },\n  usernameFromID (state, getters) {\n    return (userID) => {\n      const profile = getters.ourContactProfilesById[userID]\n      return profile?.username || state.reverseNamespaceLookups[userID] || userID\n    }\n  },\n  userDisplayNameFromID (state, getters) {\n    return (userID) => {\n      if (userID === getters.ourIdentityContractId) {\n        return getters.ourUserDisplayName\n      }\n      const profile = getters.ourContactProfilesById[userID]\n      return profile?.displayName || profile?.username || state.reverseNamespaceLookups[userID] || userID\n    }\n  },\n  thisPeriodPaymentInfoForGroup (state, getters) {\n    return (state) => {\n      return getters.groupPeriodPaymentsForGroup(state)[getters.currentPaymentPeriodForGroup(state)]\n    }\n  },\n  thisPeriodPaymentInfo (state, getters) {\n    return getters.thisPeriodPaymentInfoForGroup(getters.currentGroupState)\n  },\n  latePayments (state, getters) {\n    const periodPayments = getters.groupPeriodPayments\n    if (Object.keys(periodPayments).length === 0) return\n    const ourIdentityContractId = getters.ourIdentityContractId\n    const pPeriod = getters.periodBeforePeriod(getters.currentPaymentPeriod)\n    const pPayments = periodPayments[pPeriod]\n    if (pPayments) {\n      return pPayments.lastAdjustedDistribution.filter(todo => todo.fromMemberID === ourIdentityContractId)\n    }\n  },\n  // used with graphs like those in the dashboard and in the income details modal\n  groupIncomeDistribution (state, getters) {\n    return unadjustedDistribution({\n      haveNeeds: getters.haveNeedsForThisPeriod(getters.currentPaymentPeriod),\n      minimize: false\n    })\n  },\n  // adjusted version of groupIncomeDistribution, used by the payments system\n  groupIncomeAdjustedDistributionForGroup (state, getters) {\n    return (state) => {\n      const paymentInfo = getters.thisPeriodPaymentInfoForGroup(state)\n      if (paymentInfo && paymentInfo.lastAdjustedDistribution) {\n        return paymentInfo.lastAdjustedDistribution\n      } else {\n        const period = getters.currentPaymentPeriodForGroup(state)\n        return adjustedDistribution({\n          distribution: unadjustedDistribution({\n            haveNeeds: getters.haveNeedsForThisPeriodForGroup(state, period),\n            minimize: getters.groupSettingsForGroup(state).minimizeDistribution\n          }),\n          payments: getters.paymentsForPeriodForGroup(state, period),\n          dueOn: getters.dueDateForPeriodForGroup(state, period)\n        })\n      }\n    }\n  },\n  groupIncomeAdjustedDistribution (state, getters) {\n    return getters.groupIncomeAdjustedDistributionForGroup(getters.currentGroupState)\n  },\n  ourPaymentsSentInPeriodForGroup (state, getters) {\n    return (state, period) => {\n      const periodPayments = getters.groupPeriodPaymentsForGroup(state)\n      if (Object.keys(periodPayments).length === 0) return\n      const payments = []\n      const thisPeriodPayments = periodPayments[period]\n      const paymentsFrom = thisPeriodPayments && thisPeriodPayments.paymentsFrom\n      if (paymentsFrom) {\n        const ourIdentityContractId = getters.ourIdentityContractId\n        const allPayments = state.payments\n        for (const toMemberID in paymentsFrom[ourIdentityContractId]) {\n          for (const paymentHash of paymentsFrom[ourIdentityContractId][toMemberID]) {\n            const { data, meta, height } = allPayments[paymentHash]\n\n            payments.push({ hash: paymentHash, height, data, meta, amount: data.amount, period })\n          }\n        }\n      }\n      return payments.sort((paymentA, paymentB) => paymentB.height - paymentA.height)\n    }\n  },\n  ourPaymentsSentInPeriod (state, getters) {\n    return (period) => getters.ourPaymentsSentInPeriodForGroup(getters.currentGroupState, period)\n  },\n  ourPaymentsReceivedInPeriodForGroup (state, getters) {\n    return (state, period) => {\n      const periodPayments = getters.groupPeriodPaymentsForGroup(state)\n      if (Object.keys(periodPayments).length === 0) return\n      const payments = []\n      const thisPeriodPayments = periodPayments[period]\n      const paymentsFrom = thisPeriodPayments && thisPeriodPayments.paymentsFrom\n      if (paymentsFrom) {\n        const ourIdentityContractId = getters.ourIdentityContractId\n        const allPayments = state.payments\n        for (const fromMemberID in paymentsFrom) {\n          for (const toMemberID in paymentsFrom[fromMemberID]) {\n            if (toMemberID === ourIdentityContractId) {\n              for (const paymentHash of paymentsFrom[fromMemberID][toMemberID]) {\n                const { data, meta, height } = allPayments[paymentHash]\n\n                payments.push({ hash: paymentHash, height, data, meta, amount: data.amount })\n              }\n            }\n          }\n        }\n      }\n      return payments.sort((paymentA, paymentB) => paymentB.height - paymentA.height)\n    }\n  },\n  ourPaymentsReceivedInPeriod (state, getters) {\n    return (period) => getters.ourPaymentsReceivedInPeriodForGroup(getters.currentGroupState, period)\n  },\n  ourPaymentsForGroup (state, getters) {\n    return (state) => {\n      const periodPayments = getters.groupPeriodPaymentsForGroup(state)\n      if (Object.keys(periodPayments).length === 0) return\n      const ourIdentityContractId = getters.ourIdentityContractId\n      const cPeriod = getters.currentPaymentPeriodForGroup(state)\n      const pPeriod = getters.periodBeforePeriodForGroup(state, cPeriod)\n      const currentSent = getters.ourPaymentsSentInPeriodForGroup(state, cPeriod)\n      const previousSent = getters.ourPaymentsSentInPeriodForGroup(state, pPeriod)\n      const currentReceived = getters.ourPaymentsReceivedInPeriodForGroup(state, cPeriod)\n      const previousReceived = getters.ourPaymentsReceivedInPeriodForGroup(state, pPeriod)\n\n      // TODO: take into account pending payments that have been sent but not yet completed\n      const todo = () => {\n        return getters.groupIncomeAdjustedDistributionForGroup(state).filter(p => p.fromMemberID === ourIdentityContractId)\n      }\n\n      return {\n        sent: [...currentSent, ...previousSent],\n        received: [...currentReceived, ...previousReceived],\n        todo: todo()\n      }\n    }\n  },\n  ourPayments (state, getters) {\n    return getters.ourPaymentsForGroup(getters.currentGroupState)\n  },\n  ourPaymentsSummary (state, getters) {\n    const isNeeder = getters.ourGroupProfile.incomeDetailsType === 'incomeAmount'\n    const ourIdentityContractId = getters.ourIdentityContractId\n    const isOurPayment = (payment) => {\n      return isNeeder ? payment.toMemberID === ourIdentityContractId : payment.fromMemberID === ourIdentityContractId\n    }\n    const sumUpAmountReducer = (acc, payment) => acc + payment.amount\n    const cPeriod = getters.currentPaymentPeriod\n    const ourAdjustedPayments = getters.groupIncomeAdjustedDistribution.filter(isOurPayment)\n    const receivedOrSent = isNeeder\n      ? getters.ourPaymentsReceivedInPeriod(cPeriod)\n      : getters.ourPaymentsSentInPeriod(cPeriod)\n\n    const markedAsNotReceived = receivedOrSent.filter(payment => payment.data.status === PAYMENT_NOT_RECEIVED)\n    const markedAsNotReceivedTotal = markedAsNotReceived.reduce(sumUpAmountReducer, 0)\n\n    const paymentsTotal = ourAdjustedPayments.length + receivedOrSent.length\n    const nonLateAdjusted = ourAdjustedPayments.filter((p) => !p.isLate)\n    const paymentsDone = paymentsTotal - nonLateAdjusted.length - markedAsNotReceived.length\n    const hasPartials = ourAdjustedPayments.some(p => p.partial)\n    const amountDone = receivedOrSent.reduce(sumUpAmountReducer, 0) - markedAsNotReceivedTotal\n    const amountLeft = ourAdjustedPayments.reduce((acc, payment) => acc + payment.amount, 0) + markedAsNotReceivedTotal\n    const amountTotal = amountDone + amountLeft\n    return {\n      paymentsDone,\n      hasPartials,\n      paymentsTotal,\n      amountDone,\n      amountTotal\n    }\n  },\n  currentWelcomeInvite (state, getters) {\n    const invites = getters.currentGroupState.invites\n    const inviteId = anyoneCanJoinInviteId(invites, getters)\n    const expires = getters.currentGroupState._vm.invites[inviteId].expires\n    return { inviteId, expires }\n  },\n  // list of group names and contractIDs\n  groupsByName (state, getters) {\n    const identityContractID = getters.ourIdentityContractId\n    const groups = state[identityContractID]?.groups\n    if (!groups) return []\n    // The code below was originally Object.entries(...) but changed to .keys()\n    // due to the same flow issue as https://github.com/facebook/flow/issues/5838\n    // we return event pending groups that we haven't finished joining so that we are not stuck\n    // on the /pending-approval page if we are part of another working group already\n    return Object.entries(groups)\n    // $FlowFixMe[incompatible-use]\n      .filter(([, { hasLeft }]) => !hasLeft)\n      .map(([contractID]) => ({ groupName: state[contractID]?.settings?.groupName || L('Pending'), contractID, active: state[contractID]?.profiles?.[identityContractID]?.status === PROFILE_STATUS.ACTIVE }))\n  },\n  profilesByGroup (state, getters) {\n    return groupID => {\n      const profiles = {}\n      if (state.contracts[groupID]?.type !== 'gi.contracts/group') {\n        return profiles\n      }\n      const groupProfiles = state[groupID].profiles || {}\n      for (const member in groupProfiles) {\n        const profile = groupProfiles[member]\n        if (profile.status === PROFILE_STATUS.ACTIVE) {\n          profiles[member] = profile\n        }\n      }\n      return profiles\n    }\n  },\n  groupMembersSorted (state, getters) {\n    const profiles = getters.currentGroupState.profiles\n    if (!profiles || !profiles[getters.ourIdentityContractId]) return []\n    const weJoinedHeight = profiles[getters.ourIdentityContractId].joinedHeight\n    const isNewMember = (memberID) => {\n      if (memberID === getters.ourIdentityContractId) { return false }\n      const memberProfile = profiles[memberID]\n      if (!memberProfile) return false\n      const memberJoinedHeight = memberProfile.joinedHeight\n      const memberJoinedMs = new Date(memberProfile.joinedDate).getTime()\n      const joinedAfterUs = weJoinedHeight < memberJoinedHeight\n      return joinedAfterUs && Date.now() - memberJoinedMs < 604800000 // joined less than 1w (168h) ago.\n    }\n\n    const groupMembersPending = getters.groupMembersPending\n\n    // $FlowFixMe[method-unbinding]\n    return [groupMembersPending, getters.groupProfiles].flatMap(Object.keys)\n      .filter(memberID => getters.groupProfiles[memberID] ||\n          !(getters.groupMembersPending[memberID].expires < Date.now()))\n      .map(memberID => {\n        const { contractID, displayName, username } = getters.globalProfile(memberID) || groupMembersPending[memberID] || (getters.groupProfiles[memberID] ? { contractID: memberID } : {})\n        return {\n          id: memberID, // common unique ID: it can be either the contract ID or the invite key\n          contractID,\n          username,\n          displayName: displayName || username || memberID,\n          invitedBy: getters.groupMembersPending[memberID],\n          isNew: isNewMember(memberID)\n        }\n      })\n      .sort((userA, userB) => {\n        const nameA = userA.displayName.normalize().toUpperCase()\n        const nameB = userB.displayName.normalize().toUpperCase()\n        // Show pending members first\n        if (userA.invitedBy && !userB.invitedBy) { return -1 }\n        if (!userA.invitedBy && userB.invitedBy) { return 1 }\n        // Then new members...\n        if (userA.isNew && !userB.isNew) { return -1 }\n        if (!userA.isNew && userB.isNew) { return 1 }\n        // and sort them all by A-Z\n        return nameA < nameB ? -1 : 1\n      })\n  },\n  groupProposals (state, getters) {\n    return contractID => state[contractID]?.proposals\n  },\n  globalProfile (state, getters) {\n    // get profile from username who is part of current group\n    return memberID => {\n      return getters.ourContactProfilesById[memberID]\n    }\n  },\n  ourContactProfilesByUsername (state, getters) {\n    const profiles = {}\n    Object.keys(state.contracts)\n      .filter(contractID => state.contracts[contractID]?.type === 'gi.contracts/identity')\n      .forEach(contractID => {\n        const attributes = state[contractID].attributes\n        if (attributes) { // NOTE: this is for fixing the error while syncing the identity contracts\n          const username = checkedUsername(state, attributes.username, contractID)\n          if (!username) return\n          profiles[username] = {\n            ...attributes,\n            username,\n            contractID\n          }\n        }\n      })\n    return profiles\n  },\n  ourContactProfilesById (state, getters) {\n    const profiles = {}\n    Object.keys(state.contracts)\n      .filter(contractID => state.contracts[contractID]?.type === 'gi.contracts/identity')\n      .forEach(contractID => {\n        const attributes = state[contractID]?.attributes\n        if (attributes) { // NOTE: this is for fixing the error while syncing the identity contracts\n          const username = checkedUsername(state, attributes.username, contractID)\n          profiles[contractID] = {\n            ...attributes,\n            username,\n            contractID\n          }\n        } else {\n          profiles[contractID] = {\n            contractID\n          }\n        }\n      })\n    // For consistency, add users that were known in the past (since those\n    // contracts will be removed). This keeps mentions working in existing\n    // devices\n    Object.keys(state.reverseNamespaceLookups).forEach((contractID) => {\n      if (profiles[contractID] || state.contracts[contractID] === null) return\n      profiles[contractID] = {\n        username: state.reverseNamespaceLookups[contractID],\n        contractID\n      }\n    })\n    return profiles\n  },\n  currentGroupContactProfilesById (state, getters) {\n    const currentGroupProfileIds = Object.keys(getters.currentGroupState.profiles || {})\n    const filtered = {}\n\n    for (const identityContractID in getters.ourContactProfilesById) {\n      if (currentGroupProfileIds.includes(identityContractID)) {\n        filtered[identityContractID] = getters.ourContactProfilesById[identityContractID]\n      }\n    }\n    return filtered\n  },\n  ourContactsById (state, getters) {\n    return Object.keys(getters.ourContactProfilesById)\n      .sort((userIdA, userIdB) => {\n        const nameA = ((getters.ourContactProfilesById[userIdA].displayName)) || getters.ourContactProfilesById[userIdA].username || userIdA\n        const nameB = ((getters.ourContactProfilesById[userIdB].displayName)) || getters.ourContactProfilesById[userIdB].username || userIdB\n        return nameA.normalize().toUpperCase() > nameB.normalize().toUpperCase() ? 1 : -1\n      })\n  },\n  ourContactsByUsername (state, getters) {\n    return Object.keys(getters.ourContactProfilesByUsername)\n      .sort((usernameA, usernameB) => {\n        const nameA = getters.ourContactProfilesByUsername[usernameA].displayName || usernameA\n        const nameB = getters.ourContactProfilesByUsername[usernameB].displayName || usernameB\n        return nameA.normalize().toUpperCase() > nameB.normalize().toUpperCase() ? 1 : -1\n      })\n  },\n  seenWelcomeScreen (state, getters) {\n    return (\n      getters.currentIdentityState?.groups?.[state.currentGroupId]?.hasLeft ||\n      (\n        getters.ourProfileActive &&\n        getters.currentIdentityState?.groups?.[state.currentGroupId]?.seenWelcomeScreen\n      )\n    )\n  },\n  ...chatroomGetters,\n  ...groupGetters,\n  ...identityGetters\n}\n\nexport default getters\n", "import { MAX_AGE_READ, MAX_AGE_UNREAD } from './storageConstants.js'\nimport { age, isNew, isOlder } from './utils.js'\n\nconst getters                                                                                            = {\n  notifications (state, getters, rootState) {\n    return state.items.map(item => {\n      const notification = { ...item, ...state.status[item.hash] }\n      // Notifications older than MAX_AGE_UNREAD are discarded\n      if (age(notification) > MAX_AGE_UNREAD) {\n        return null\n      } else if (!notification.read && age(notification) > MAX_AGE_READ) {\n        // Unread notifications older than MAX_AGE_READ are automatically\n        // marked as read\n        notification.read = true\n      }\n      return notification\n    }).filter(Boolean)\n  },\n  // Notifications relevant to the current group only.\n  currentGroupNotifications (state, getters, rootState) {\n    return getters.notifications.filter(item => item.groupID === rootState.currentGroupId)\n  },\n\n  // Notifications relevant to a specific group.\n  notificationsByGroup (state, getters) {\n    return groupID => getters.notifications.filter(item => item.groupID === groupID)\n  },\n\n  currentGroupUnreadNotificationCount (state, getters) {\n    return getters.currentGroupUnreadNotifications.length\n  },\n\n  // Unread notifications relevant to the current group only.\n  currentGroupUnreadNotifications (state, getters, rootState) {\n    return getters.currentGroupNotifications.filter(item => !item.read)\n  },\n\n  currentNewNotifications (state, getters) {\n    return getters.currentNotifications.filter(isNew)\n  },\n\n  currentNotificationCount (state, getters) {\n    return getters.currentNotifications.length\n  },\n\n  // Notifications relevant to the current group, plus notifications that don't belong to any group in particular.\n  currentNotifications (state, getters, rootState) {\n    return getters.notifications.filter(item => !item.groupID || item.groupID === rootState.currentGroupId)\n  },\n\n  currentOlderNotifications (state, getters) {\n    return getters.currentNotifications.filter(isOlder)\n  },\n\n  currentUnreadNotificationCount (state, getters) {\n    return getters.currentNotifications.filter(item => !item.read).length\n  },\n\n  currentUnreadNotifications (state, getters) {\n    return getters.currentNotifications.filter(item => !item.read)\n  },\n\n  totalUnreadNotificationCount (state, getters) {\n    return getters.notifications.filter(item => !item.read).length\n  },\n\n  // Finds what number to display on a group's avatar badge in the sidebar. Used in GroupsList.vue.\n  unreadGroupNotificationCountFor (state, getters) {\n    return (groupID) => getters.unreadGroupNotificationsFor(groupID).length\n  },\n\n  unreadGroupNotificationsFor (state, getters, rootState) {\n    return (groupID) => (\n      groupID === rootState.currentGroupId\n        ? getters.currentGroupUnreadNotifications\n        : getters.notifications.filter(item => !item.read && item.groupID === groupID)\n    )\n  }\n}\n\nexport default getters\n", "import { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\n             \n                  \n                      \n                        \n\nimport sbp from '@sbp/sbp'\nimport { L, LTags } from '@common/common.js'\nimport { humanDate } from '@model/contracts/shared/time.js'\nimport {\n  STATUS_PASSED, STATUS_FAILED, STATUS_CANCELLED, STATUS_EXPIRED,\n  PROPOSAL_INVITE_MEMBER, PROPOSAL_REMOVE_MEMBER, CHATROOM_MEMBER_MENTION_SPECIAL_CHAR,\n  PROPOSAL_GROUP_SETTING_CHANGE, PROPOSAL_PROPOSAL_SETTING_CHANGE, PROPOSAL_GENERIC\n} from '@model/contracts/shared/constants.js'\nimport { getProposalDetails } from '@model/contracts/shared/functions.js'\nimport { findContractIDByForeignKeyId } from '~/shared/domains/chelonia/utils.js'\n\nexport default ({\n  CHELONIA_ERROR (data                                                                          ) {\n    const { activity, error, message, msgMeta } = data\n    const contractID = message.contractID()\n    const opType = message.opType()\n    const value = message.decryptedValue()\n    let action\n    if (value) {\n      if ([SPMessage.OP_ACTION_ENCRYPTED, SPMessage.OP_ACTION_UNENCRYPTED].includes(opType)) {\n        action = value.action\n      } else if (msgMeta && opType === SPMessage.OP_ATOMIC && Number.isFinite(msgMeta.index) && [SPMessage.OP_ACTION_ENCRYPTED, SPMessage.OP_ACTION_UNENCRYPTED].includes(value[msgMeta.index][0])) {\n        action = value[msgMeta.index][1].action\n      }\n    }\n    const state = sbp('state/vuex/state')\n    let who, plaintextWho\n\n    if (message.innerSigningKeyId()) {\n      const innerSigningContractID = findContractIDByForeignKeyId(state[message.contractID()], message.innerSigningKeyId())\n      if (innerSigningContractID) {\n        who = `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${innerSigningContractID}`\n        plaintextWho = sbp('state/vuex/getters').userDisplayNameFromID(innerSigningContractID)\n      }\n    }\n\n    const LcommonParams = {\n      errName: error.name,\n      activity,\n      action: action ?? opType,\n      contract: state.contracts[contractID]?.type ?? contractID,\n      errMsg: error.message\n    }\n\n    const Lparams = {\n      ...LcommonParams,\n      ...LTags('b'),\n      who\n    }\n\n    const LplaintextParams = {\n      ...LcommonParams,\n      who: plaintextWho\n    }\n\n    return {\n      title: L('Internal error'),\n      body: who\n        ? L(\"{errName} during {activity} for '{action}' from {b_}{who}{_b} to '{contract}': '{errMsg}'\", Lparams)\n        : L(\"{errName} during {activity} for '{action}' to '{contract}': '{errMsg}'\", Lparams),\n      plaintextBody: who\n        ? L(\"{errName} during {activity} for '{action}' from {who} to '{contract}': '{errMsg}'\", LplaintextParams)\n        : L(\"{errName} during {activity} for '{action}' to '{contract}': '{errMsg}'\", LplaintextParams),\n      icon: 'exclamation-triangle',\n      level: 'danger',\n      linkTo: `/app/dashboard?modal=UserSettingsModal&tab=application-logs&errorMsg=${encodeURIComponent(error.message)}`,\n      scope: 'app'\n    }\n  },\n  GENERAL (data                                         ) {\n    return {\n      title: L('Group Income'),\n      body: data.message,\n      plaintextBody: data.message,\n      icon: 'cog',\n      level: 'info',\n      linkTo: '',\n      scope: 'app'\n    }\n  },\n  WARNING (data                                         ) {\n    return {\n      title: L('Warning'),\n      body: data.message,\n      plaintextBody: data.message,\n      icon: 'exclamation-triangle',\n      level: 'danger',\n      linkTo: '',\n      scope: 'app'\n    }\n  },\n  ERROR (data                                         ) {\n    return {\n      title: L('Error'),\n      body: data.message,\n      plaintextBody: data.message,\n      icon: 'exclamation-triangle',\n      level: 'danger',\n      linkTo: `/app/dashboard?modal=UserSettingsModal&tab=application-logs&errorMsg=${encodeURIComponent(data.message)}`,\n      scope: 'app'\n    }\n  },\n  CONTRIBUTION_REMINDER (data                  ) {\n    return {\n      title: L('Contribution reminder'),\n      body: L('Do not forget to send your pledge by {strong_}{date}{_strong}.', {\n        date: data.date,\n        ...LTags('strong')\n      }),\n      plaintextBody: L('Do not forget to send your pledge by {strong_}{date}{_strong}.', {\n        date: data.date\n      }),\n      icon: 'coins',\n      level: 'info',\n      linkTo: '/payments',\n      scope: 'user'\n    }\n  },\n  INCOME_DETAILS_OLD (data                                             ) {\n    return {\n      title: L('Update income details'),\n      body: L(\"You haven't updated your income details in more than {months} months. Would you like to review them now?\", {\n        months: Math.floor(data.months) // Avoid displaying decimals\n      }),\n      plaintextBody: L(\"You haven't updated your income details in more than {months} months. Would you like to review them now?\", {\n        months: Math.floor(data.months) // Avoid displaying decimals\n      }),\n      icon: 'coins',\n      level: 'info',\n      linkTo: '/contributions?modal=IncomeDetails',\n      scope: 'user',\n      data: { lastUpdatedDate: data.lastUpdatedDate }\n    }\n  },\n  MEMBER_ADDED (data                                       ) {\n    const rootState = sbp('state/vuex/state')\n    const plaintextName = sbp('state/vuex/getters').userDisplayNameFromID(data.memberID)\n    // Used to avoid displaying a contract ID when no name is available, see\n    // <https://github.com/okTurtles/group-income/issues/2834>\n    const hasPlaintextName = plaintextName !== data.memberID\n    return {\n      avatarUserID: data.memberID,\n      title: rootState[data.groupID]?.settings?.groupName || L('Member added'),\n      body: L('The group has a new member. Say hi to {strong_}{name}{_strong}!', {\n        name: `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${data.memberID}`,\n        ...LTags('strong')\n      }),\n      plaintextBody: hasPlaintextName\n        ? L('The group has a new member. Say hi to {strong_}{name}{_strong}!', {\n          name: plaintextName\n        })\n        : L('The group has a new member. Say hi!'),\n      icon: 'user-plus',\n      level: 'info',\n      linkTo: `/group-chat/${rootState[data.groupID]?.generalChatRoomId}`,\n      scope: 'group',\n      groupID: data.groupID\n    }\n  },\n  MEMBER_LEFT (data                                       ) {\n    const rootState = sbp('state/vuex/state')\n    const plaintextName = sbp('state/vuex/getters').userDisplayNameFromID(data.memberID)\n    // Used to avoid displaying a contract ID when no name is available, see\n    // <https://github.com/okTurtles/group-income/issues/2834>\n    const hasPlaintextName = plaintextName !== data.memberID\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Member added'),\n      avatarUserID: data.memberID,\n      body: L('{strong_}{name}{_strong} has left your group. Contributions were updated accordingly.', {\n        name: `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${data.memberID}`,\n        ...LTags('strong')\n      }),\n      plaintextBody: hasPlaintextName\n        ? L('{strong_}{name}{_strong} has left your group. Contributions were updated accordingly.', {\n          name: plaintextName\n        })\n        : L('A member left your group. Contributions were updated accordingly.', {\n          name: plaintextName\n        }),\n      icon: 'user-minus',\n      level: 'danger',\n      linkTo: '/contributions',\n      scope: 'group',\n      groupID: data.groupID\n    }\n  },\n  MEMBER_REMOVED (data                                       ) {\n    const rootState = sbp('state/vuex/state')\n    const plaintextName = sbp('state/vuex/getters').userDisplayNameFromID(data.memberID)\n    const hasPlaintextName = plaintextName !== data.memberID\n    // Used to avoid displaying a contract ID when no name is available, see\n    // <https://github.com/okTurtles/group-income/issues/2834>\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Member added'),\n      avatarUserID: data.memberID,\n      // REVIEW @mmbotelho - Not only contributions, but also proposals.\n      body: L('{strong_}{name}{_strong} was kicked out of the group. Contributions were updated accordingly.', {\n        name: `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${data.memberID}`,\n        ...LTags('strong')\n      }),\n      plaintextBody: hasPlaintextName\n        ? L('{strong_}{name}{_strong} was kicked out of the group. Contributions were updated accordingly.', {\n          name: plaintextName\n        })\n        : L('A member was kicked out of the group. Contributions were updated accordingly.'),\n      icon: 'user-minus',\n      level: 'danger',\n      linkTo: '/contributions',\n      scope: 'group',\n      groupID: data.groupID\n    }\n  },\n  NEW_PROPOSAL (data                                                                                        ) {\n    const rootState = sbp('state/vuex/state')\n    const isCreator = data.creatorID === sbp('state/vuex/getters').ourIdentityContractId // notification message is different for creator and non-creator.\n    const args = {\n      name: `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${data.creatorID}`,\n      ...LTags('strong')\n    }\n    const plaintextArgs = {\n      name: sbp('state/vuex/getters').userDisplayNameFromID(data.creatorID)\n    }\n\n    const bodyTemplateMap = {\n      ADD_MEMBER: isCreator\n        ? L('You proposed to add a member to the group.')\n        : L('{strong_}{name}{_strong} proposed to add a member to the group. Vote now!', args),\n      CHANGE_MINCOME: isCreator\n        ? L('You proposed to change the group mincome.')\n        : L('{strong_}{name}{_strong} proposed to change the group mincome. Vote now!', args),\n      CHANGE_DISTRIBUTION_DATE: isCreator\n        ? L('You proposed to change the group distribution date.')\n        : L('{strong_}{name}{_strong} proposed to change the group distribution date. Vote now!', args),\n      CHANGE_VOTING_RULE: isCreator\n        ? L('You proposed to change the group voting system.')\n        : L('{strong_}{name}{_strong} proposed to change the group voting system. Vote now!', args),\n      REMOVE_MEMBER: isCreator\n        ? L('You proposed to remove a member from the group.')\n        : L('{strong_}{name}{_strong} proposed to remove a member from the group. Vote now!', args),\n      GENERIC: isCreator\n        ? L('You created a proposal.')\n        : L('{strong_}{name}{_strong} created a proposal. Vote now!', args)\n    }\n\n    const plaintextBodyTemplateMap = {\n      ADD_MEMBER: isCreator\n        ? L('You proposed to add a member to the group.')\n        : L('{strong_}{name}{_strong} proposed to add a member to the group. Vote now!', plaintextArgs),\n      CHANGE_MINCOME: isCreator\n        ? L('You proposed to change the group mincome.')\n        : L('{strong_}{name}{_strong} proposed to change the group mincome. Vote now!', plaintextArgs),\n      CHANGE_DISTRIBUTION_DATE: isCreator\n        ? L('You proposed to change the group distribution date.')\n        : L('{strong_}{name}{_strong} proposed to change the group distribution date. Vote now!', plaintextArgs),\n      CHANGE_VOTING_RULE: isCreator\n        ? L('You proposed to change the group voting system.')\n        : L('{strong_}{name}{_strong} proposed to change the group voting system. Vote now!', plaintextArgs),\n      REMOVE_MEMBER: isCreator\n        ? L('You proposed to remove a member from the group.')\n        : L('{strong_}{name}{_strong} proposed to remove a member from the group. Vote now!', plaintextArgs),\n      GENERIC: isCreator\n        ? L('You created a proposal.')\n        : L('{strong_}{name}{_strong} created a proposal. Vote now!', plaintextArgs)\n    }\n\n    const iconMap = {\n      ADD_MEMBER: 'user-plus',\n      CHANGE_MINCOME: 'dollar-sign',\n      CHANGE_DISTRIBUTION_DATE: 'chart-pie',\n      CHANGE_VOTING_RULE: 'vote-yea',\n      REMOVE_MEMBER: 'user-minus',\n      GENERIC: 'envelope-open-text'\n    }\n\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('New proposal'),\n      avatarUserID: data.creatorID,\n      body: bodyTemplateMap[data.subtype],\n      plaintextBody: plaintextBodyTemplateMap[data.subtype],\n      creatorID: data.creatorID,\n      icon: iconMap[data.subtype],\n      level: 'info',\n      subtype: data.subtype,\n      scope: 'group',\n      sbpInvocation: ['gi.app/group/checkAndSeeProposal', {\n        contractID: data.groupID,\n        data: { proposalHash: data.proposalHash }\n      }]\n    }\n  },\n  PROPOSAL_EXPIRING (data                                                           ) {\n    const rootState = sbp('state/vuex/state')\n    const { proposalData, proposalType } = data.proposal.data\n    const typeToTitleMap = {\n      [PROPOSAL_INVITE_MEMBER]: L('Member addition'),\n      [PROPOSAL_REMOVE_MEMBER]: L('Member removal'),\n      [PROPOSAL_GROUP_SETTING_CHANGE]: {\n        mincomeAmount: L('Mincome change'),\n        distributionDate: L('Distribution date change')\n      }[proposalData.setting],\n      [PROPOSAL_PROPOSAL_SETTING_CHANGE]: L('Voting rule change'),\n      [PROPOSAL_GENERIC]: proposalData.name\n    }\n\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Proposal expiring'),\n      avatarUserID: '',\n      body: L('Proposal about to expire: {i_}\"{proposalTitle}\"{_i}. Please vote!', {\n        ...LTags('i'),\n        proposalTitle: typeToTitleMap[proposalType]\n      }),\n      plaintextBody: L('Proposal about to expire: {i_}\"{proposalTitle}\"{_i}. Please vote!', {\n        proposalTitle: typeToTitleMap[proposalType]\n      }),\n      level: 'info',\n      icon: 'exclamation-triangle',\n      scope: 'group',\n      data: { proposalId: data.proposalId },\n      sbpInvocation: ['gi.app/group/checkAndSeeProposal', {\n        contractID: data.groupID,\n        data: { proposalHash: data.proposalId }\n      }]\n    }\n  },\n  PROPOSAL_CLOSED (data                                                             ) {\n    const rootState = sbp('state/vuex/state')\n    const { creatorID, status, type, options } = getProposalDetails(data.proposal)\n    const isCreator = creatorID === sbp('state/vuex/getters').ourIdentityContractId // notification message is different for creator and non-creator\n\n    const statusMap = {\n      [STATUS_PASSED]: { icon: 'check', level: 'success', closedWith: L('accepted') },\n      [STATUS_FAILED]: { icon: 'times', level: 'danger', closedWith: L('rejected') },\n      [STATUS_CANCELLED]: { icon: 'times', level: 'danger', closedWith: L('cancelled') }, // TODO: define icon, level\n      [STATUS_EXPIRED]: { icon: 'times', level: 'danger', closedWith: L('expired') } // TODO: define icon, level\n    }\n    const args = {\n      ...options,\n      ...LTags('strong'),\n      closedWith: statusMap[status].closedWith,\n      name: !isCreator ? `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${creatorID}` : ''\n    }\n\n    const plaintextArgs = {\n      ...options,\n      closedWith: statusMap[status].closedWith,\n      name: !isCreator ? sbp('state/vuex/getters').userDisplayNameFromID(creatorID) : ''\n    }\n\n    if (options.memberID) {\n      // NOTE: replace member with their mention when their contractID is provided\n      //       e.g., when the type is  PROPOSAL_REMOVE_MEMBER\n      args['member'] = `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${options.memberID}`\n      plaintextArgs['member'] = sbp('state/vuex/getters').userDisplayNameFromID(options.memberID)\n    }\n\n    const bodyTemplateMap = {\n      [PROPOSAL_INVITE_MEMBER]: isCreator\n        ? L('Your proposal to add {member} to the group was {strong_}{closedWith}{_strong}.', args)\n        : L(\"{strong_}{name}'s{_strong} proposal to add {member} to the group was {strong_}{closedWith}{_strong}.\", args),\n      [PROPOSAL_REMOVE_MEMBER]: isCreator\n        ? L('Your proposal to remove {member} from the group was {strong_}{closedWith}{_strong}.', args)\n        : L(\"{strong_}{name}'s{_strong} proposal to remove {member} from the group was {strong_}{closedWith}{_strong}.\", args),\n      [PROPOSAL_GROUP_SETTING_CHANGE]: isCreator\n        ? L('Your proposal to change group\\'s {setting} to {value} was {strong_}{closedWith}{_strong}.', args)\n        : L(\"{strong_}{name}'s{_strong} proposal to change group's {setting} to {value} was {strong_}{closedWith}{_strong}.\", args),\n      [PROPOSAL_PROPOSAL_SETTING_CHANGE]: isCreator\n        ? L('Your proposal to change group\\'s {setting} was {strong_}{closedWith}{_strong}.', args)\n        : L(\"{strong_}{name}'s{_strong} proposal to change group's {setting} was {strong_}{closedWith}{_strong}.\", args),\n      [PROPOSAL_GENERIC]: isCreator\n        ? L('Your proposal \"{title}\" was {strong_}{closedWith}{_strong}.', args)\n        : L(\"{strong_}{name}'s{_strong} proposal \\\"{title}\\\" was {strong_}{closedWith}{_strong}.\", args)\n    }\n\n    const plaintextBodyTemplateMap = {\n      [PROPOSAL_INVITE_MEMBER]: isCreator\n        ? L('Your proposal to add {member} to the group was {strong_}{closedWith}{_strong}.', plaintextArgs)\n        : L(\"{strong_}{name}'s{_strong} proposal to add {member} to the group was {strong_}{closedWith}{_strong}.\", plaintextArgs),\n      [PROPOSAL_REMOVE_MEMBER]: isCreator\n        ? L('Your proposal to remove {member} from the group was {strong_}{closedWith}{_strong}.', plaintextArgs)\n        : L(\"{strong_}{name}'s{_strong} proposal to remove {member} from the group was {strong_}{closedWith}{_strong}.\", plaintextArgs),\n      [PROPOSAL_GROUP_SETTING_CHANGE]: isCreator\n        ? L('Your proposal to change group\\'s {setting} to {value} was {strong_}{closedWith}{_strong}.', plaintextArgs)\n        : L(\"{strong_}{name}'s{_strong} proposal to change group's {setting} to {value} was {strong_}{closedWith}{_strong}.\", plaintextArgs),\n      [PROPOSAL_PROPOSAL_SETTING_CHANGE]: isCreator\n        ? L('Your proposal to change group\\'s {setting} was {strong_}{closedWith}{_strong}.', plaintextArgs)\n        : L(\"{strong_}{name}'s{_strong} proposal to change group's {setting} was {strong_}{closedWith}{_strong}.\", plaintextArgs),\n      [PROPOSAL_GENERIC]: isCreator\n        ? L('Your proposal \"{title}\" was {strong_}{closedWith}{_strong}.', plaintextArgs)\n        : L(\"{strong_}{name}'s{_strong} proposal \\\"{title}\\\" was {strong_}{closedWith}{_strong}.\", plaintextArgs)\n    }\n\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Proposal closed'),\n      avatarUserID: creatorID,\n      body: bodyTemplateMap[type],\n      plaintextBody: plaintextBodyTemplateMap[type],\n      icon: statusMap[status].icon,\n      level: statusMap[status].level,\n      scope: 'group',\n      sbpInvocation: ['gi.app/group/checkAndSeeProposal', {\n        contractID: data.groupID,\n        data: { proposalHash: data.proposalHash }\n      }]\n    }\n  },\n  PAYMENT_RECEIVED (data                                                                             ) {\n    const rootState = sbp('state/vuex/state')\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Payment received'),\n      avatarUserID: data.creatorID,\n      body: L('{strong_}{name}{_strong} sent you a {amount} mincome contribution. {strong_}Review and send a thank you note.{_strong}', {\n        name: `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${data.creatorID}`,\n        amount: data.amount,\n        ...LTags('strong')\n      }),\n      plaintextBody: L('{strong_}{name}{_strong} sent you a {amount} mincome contribution. {strong_}Review and send a thank you note.{_strong}', {\n        name: sbp('state/vuex/getters').userDisplayNameFromID(data.creatorID),\n        amount: data.amount\n      }),\n      creatorID: data.creatorID,\n      icon: '',\n      level: 'info',\n      linkTo: `/payments?modal=PaymentDetail&id=${data.paymentHash}`,\n      scope: 'group',\n      groupID: data.groupID\n    }\n  },\n  PAYMENT_THANKYOU_SENT (data                                                                                  ) {\n    const rootState = sbp('state/vuex/state')\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Thank you note received'),\n      avatarUserID: data.fromMemberID,\n      body: L('{strong_}{name}{_strong} sent you a {strong_}thank you note{_strong} for your contribution.', {\n        name: `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${data.fromMemberID}`,\n        ...LTags('strong')\n      }),\n      plaintextBody: L('{strong_}{name}{_strong} sent you a {strong_}thank you note{_strong} for your contribution.', {\n        name: sbp('state/vuex/getters').userDisplayNameFromID(data.fromMemberID)\n      }),\n      creatorID: data.fromMemberID,\n      icon: '',\n      level: 'info',\n      linkTo: `/payments?modal=ThankYouNoteModal&from=${data.fromMemberID}&to=${data.toMemberID}`,\n      scope: 'group',\n      groupID: data.groupID\n    }\n  },\n  MINCOME_CHANGED (data                                                                                            ) {\n    const rootState = sbp('state/vuex/state')\n    const { withGroupCurrency } = sbp('state/vuex/getters')\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Mincome changes'),\n      avatarUserID: data.creatorID,\n      body: L('The mincome has changed to {amount}.', { amount: withGroupCurrency(data.to) }),\n      plaintextBody: L('The mincome has changed to {amount}.', { amount: withGroupCurrency(data.to) }),\n      creatorID: data.creatorID,\n      icon: 'dollar-sign',\n      level: 'info',\n      scope: 'group',\n      sbpInvocation: ['gi.app/group/displayMincomeChangedPrompt', {\n        contractID: data.groupID,\n        data: {\n          amount: data.to,\n          memberType: data.memberType,\n          increased: data.increased\n        }\n      }]\n    }\n  },\n  NEW_DISTRIBUTION_PERIOD (data                                                                            ) {\n    const rootState = sbp('state/vuex/state')\n    const { period, creatorID, memberType } = data\n    const periodDisplay = humanDate(period, { month: 'short', day: 'numeric', year: 'numeric' })\n    const bodyTemplate = {\n      // Display the distribution period in the notification message (issue: https://github.com/okTurtles/group-income/issues/1903)\n      'pledger': L('A new distribution period ({period}) has started. Please check Payment TODOs.', { period: periodDisplay }),\n      'receiver': L('A new distribution period ({period}) has started. Please update your income details if they have changed.', { period: periodDisplay })\n    }\n\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('New distribution period'),\n      avatarUserID: creatorID,\n      body: bodyTemplate[memberType],\n      plaintextBody: bodyTemplate[memberType],\n      level: 'info',\n      icon: 'coins',\n      linkTo: memberType === 'pledger' ? '/payments' : '/contributions?modal=IncomeDetails',\n      scope: 'group',\n      data: { period }, // is used to check if a notification has already been sent for a particular dist-period\n      groupID: data.groupID\n    }\n  },\n  NEAR_DISTRIBUTION_END (data                                     ) {\n    const rootState = sbp('state/vuex/state')\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Distribution period ends soon'),\n      body: L(\"Less than 1 week left before the distribution period ends - don't forget to send payments!\"),\n      plaintextBody: L(\"Less than 1 week left before the distribution period ends - don't forget to send payments!\"),\n      level: 'info',\n      icon: 'coins',\n      linkTo: '/payments',\n      scope: 'group',\n      data,\n      groupID: data.groupID\n    }\n  },\n  NONMONETARY_CONTRIBUTION_UPDATE (\n    data   \n                      \n                        \n                                               \n     \n  ) {\n    const rootState = sbp('state/vuex/state')\n    const { prev, after } = data.updateData\n    const added = after.filter(v => !prev.includes(v))\n    const removed = prev.filter(v => !after.includes(v))\n    const updateType = added.length\n      ? removed.length\n        ? 'updated'\n        : 'added'\n      : removed.length\n        ? 'removed'\n        : null\n\n    if (!updateType) {\n      throw new Error('Cannot emit a NONMONETARY_CONTRIBUTION_UPDATE notification for no updates.')\n    }\n\n    const name = `${CHATROOM_MEMBER_MENTION_SPECIAL_CHAR}${data.creatorID}`\n    const plaintextName = sbp('state/vuex/getters').userDisplayNameFromID(data.creatorID)\n    const contributionsFormatted = (entries) => {\n      const first = entries[0]\n      const len = entries.length\n      return entries.length > 1\n        ? L('{first} and {rest} more', { first, rest: len - 1 })\n        : first\n    }\n    const bodyContentMap = {\n      added: () => L('{name} added non-monetary contribution: {strong_}{added}{_strong}', { name, added: contributionsFormatted(added), ...LTags('strong') }),\n      removed: () => L('{name} removed non-monetary contribution: {strong_}{removed}{_strong}', { name, removed: contributionsFormatted(removed), ...LTags('strong') }),\n      updated: () => L('{name} updated non-monetary contribution: added {strong_}{added}{_strong} and removed {strong_}{removed}{_strong}', {\n        name,\n        added: contributionsFormatted(added),\n        removed: contributionsFormatted(removed),\n        ...LTags('strong')\n      })\n    }\n    const plaintextBodyContentMap = {\n      added: () => L('{name} added non-monetary contribution: {strong_}{added}{_strong}', { name: plaintextName, added: contributionsFormatted(added) }),\n      removed: () => L('{name} removed non-monetary contribution: {strong_}{removed}{_strong}', { name: plaintextName, removed: contributionsFormatted(removed) }),\n      updated: () => L('{name} updated non-monetary contribution: added {strong_}{added}{_strong} and removed {strong_}{removed}{_strong}', {\n        name: plaintextName,\n        added: contributionsFormatted(added),\n        removed: contributionsFormatted(removed)\n      })\n    }\n    return {\n      title: rootState[data.groupID]?.settings?.groupName || L('Non-monetary contribution updated'),\n      body: bodyContentMap[updateType](),\n      plaintextBody: plaintextBodyContentMap[updateType](),\n      scope: 'group',\n      avatarUserID: data.creatorID,\n      level: 'info',\n      icon: 'chart-pie',\n      linkTo: '/contributions',\n      groupID: data.groupID\n    }\n  }\n}                                                             )\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\n                                                                                           \nimport templates from './templates.js'\nimport { makeNotificationHash } from './utils.js'\nimport { CHELONIA_STATE_MODIFIED, NOTIFICATION_EMITTED, NOTIFICATION_REMOVED, NOTIFICATION_STATUS_LOADED } from '~/frontend/utils/events.js'\n\n/*\n * NOTE: do not refactor occurences of `sbp('state/vuex/state')` by defining a shared constant in the\n *   outer scope, because login actions might invalidate it by calling `replaceState()`.\n */\nsbp('sbp/selectors/register', {\n  /*\n   * Creates and dispatches a new notification.\n   * NOTE: two arguments (type, data) need to be minimal to be identifiable\n   *       for each notification in order to avoid the following two problems\n   *       Problem 1 - same hash for different notifications\n   *       Problem 2 - different hash for the same notifications\n   *       for example, adding needless 'createdDate' inside the data could cause the Problem 2\n   *                    removing necessary 'createdDate' from the data could cause the Problem 1\n   * https://github.com/okTurtles/group-income/pull/2129#discussion_r1659219172\n   */\n  'gi.notifications/emit' (type        , data                  ) {\n    const template                       = templates[type](data)\n\n    if (template.scope === 'group' && !data.groupID) {\n      throw new TypeError('Incomplete notification data: `data.groupID` is required.')\n    }\n\n    // Creates the notification object in a single step.\n    const notification = {\n      ...template,\n      hash: makeNotificationHash({ ...data, type }),\n      avatarUserID: template.avatarUserID || sbp('state/vuex/getters').ourIdentityContractId,\n      // Sets 'groupID' if this notification only pertains to a certain group.\n      ...(template.scope === 'group' ? { groupID: data.groupID } : {}),\n      // Store integer timestamps rather than ISO strings here to make age comparisons easier.\n      timestamp: new Date(data.createdDate ? data.createdDate : sbp('chelonia/time')).getTime(),\n      type\n    }\n    const rootState = sbp('chelonia/rootState')\n    if (rootState.notifications.items.some(item => item.hash === notification.hash)) {\n      // We cannot throw here, as this code might be called from within a contract side effect.\n      return console.error('[gi.notifications/emit] This notification is already in the store.', notification.hash)\n    }\n    const index = rootState.notifications.items.findLastIndex(item => item.timestamp < notification.timestamp)\n    rootState.notifications.items.splice(Math.max(0, index), 0, notification)\n    sbp('okTurtles.events/emit', CHELONIA_STATE_MODIFIED)\n    sbp('gi.actions/identity/kv/addNotificationStatus', notification)\n    sbp('okTurtles.events/emit', NOTIFICATION_EMITTED, notification)\n  },\n  'gi.notifications/markAsRead' (notification              ) {\n    sbp('gi.actions/identity/kv/markNotificationStatusRead', notification.hash)\n  },\n  'gi.notifications/markAllAsRead' (groupID        ) {\n    const rootState = sbp('chelonia/rootState')\n    if (!rootState.notifications) return\n    const hashes = rootState.notifications.items.filter(item => {\n      return !item.read && (!groupID || !item.groupID || item.groupID === groupID)\n    }).map(item => item.hash)\n    sbp('gi.actions/identity/kv/markNotificationStatusRead', hashes)\n  },\n  'gi.notifications/remove' (hashes                   ) {\n    if (!Array.isArray(hashes)) hashes = [hashes]\n    const rootState = sbp('chelonia/rootState')\n    if (!rootState.notifications) return\n    const hashesSet = new Set(hashes)\n    const indices = rootState.notifications.items.map((item, index) => {\n      if (hashesSet.has(item.hash)) {\n        hashesSet.delete(item.hash)\n        return index\n      }\n      return false\n    }).filter((v) => v !== false).sort().map((v, i) => v - i)\n    indices.forEach((index) => rootState.notifications.items.splice(index, 1))\n    sbp('okTurtles.events/emit', NOTIFICATION_REMOVED, hashes)\n  },\n  'gi.notifications/setNotificationStatus' (status) {\n    const rootState = sbp('chelonia/rootState')\n    rootState.notifications.status = status\n    sbp('okTurtles.events/emit', CHELONIA_STATE_MODIFIED)\n    sbp('okTurtles.events/emit', NOTIFICATION_STATUS_LOADED, status)\n  }\n})\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport '@sbp/okturtles.events'\n                                                             \n\n// ====== Enums ====== //\n\nexport const NOTIFICATION_TYPE = Object.freeze({\n  ENTRY: 'entry',\n  DELETION: 'deletion',\n  KV: 'kv',\n  KV_FILTER: 'kv_filter',\n  PING: 'ping',\n  PONG: 'pong',\n  PUB: 'pub',\n  SUB: 'sub',\n  UNSUB: 'unsub',\n  VERSION_INFO: 'version_info'\n})\n\nexport const REQUEST_TYPE = Object.freeze({\n  PUB: 'pub',\n  SUB: 'sub',\n  UNSUB: 'unsub',\n  PUSH_ACTION: 'push_action',\n  KV_FILTER: 'kv_filter'\n})\n\nexport const RESPONSE_TYPE = Object.freeze({\n  ERROR: 'error',\n  OK: 'ok'\n})\n\nexport const PUSH_SERVER_ACTION_TYPE = Object.freeze({\n  SEND_PUBLIC_KEY: 'send-public-key',\n  STORE_SUBSCRIPTION: 'store-subscription',\n  DELETE_SUBSCRIPTION: 'delete-subscription',\n  SEND_PUSH_NOTIFICATION: 'send-push-notification'\n})\n\n                                                                    \n                                                          \n                                                            \n\n// TODO: verify these are good defaults\nconst defaultOptions = {\n  logPingMessages: process.env.NODE_ENV === 'development' && !process.env.CI,\n  pingTimeout: 45000,\n  maxReconnectionDelay: 60000,\n  maxRetries: 10,\n  minReconnectionDelay: 500,\n  reconnectOnDisconnection: true,\n  reconnectOnOnline: true,\n  // Defaults to false to avoid reconnection attempts in case the server doesn't\n  // respond because of a failed authentication.\n  reconnectOnTimeout: false,\n  reconnectionDelayGrowFactor: 2,\n  timeout: 60000\n}\n\n// ====== Event name constants ====== //\n\nexport const PUBSUB_ERROR = 'pubsub-error'\nexport const PUBSUB_RECONNECTION_ATTEMPT = 'pubsub-reconnection-attempt'\nexport const PUBSUB_RECONNECTION_FAILED = 'pubsub-reconnection-failed'\nexport const PUBSUB_RECONNECTION_SCHEDULED = 'pubsub-reconnection-scheduled'\nexport const PUBSUB_RECONNECTION_SUCCEEDED = 'pubsub-reconnection-succeeded'\nexport const PUBSUB_SUBSCRIPTION_SUCCEEDED = 'pubsub-subscription-succeeded'\n\n// ====== Types ====== //\n\n/*\n * Flowtype usage notes:\n *\n * - The '+' prefix indicates properties that should not be re-assigned or\n *   deleted after their initialization.\n *\n * - 'TimeoutID' is an opaque type declared in Flow's core definition file,\n *   used as the return type of the core setTimeout() function.\n */\n\n                       \n                          \n               \n \n\n                            \n                                        \n                              \n                               \n                                   \n                    \n                 \n                     \n                           \n                                                 \n                   \n                                       \n                                         \n                                  \n                           \n                           \n                                \n                                   \n               \n            \n                         \n                  \n                  \n                                               \n                                    \n                               \n                                \n \n\n                          \n               \n                     \n                 \n \n\n                          \n                          \n               \n                     \n                           \n \n\n                            \n                          \n                 \n                    \n \n\n// ====== API ====== //\n\n/**\n * Creates a pubsub client instance.\n *\n * @param {string} url - A WebSocket URL to connect to.\n * @param {Object?} options\n * {object?} handlers - Custom handlers for WebSocket events.\n * {boolean?} logPingMessages - Whether to log received pings.\n * {boolean?} manual - Whether the factory should call 'connect()' automatically.\n *   Also named 'autoConnect' or 'startClosed' in other libraries.\n * {object?} messageHandlers - Custom handlers for different message types.\n * {number?} pingTimeout=45_000 - How long to wait for the server to send a ping, in milliseconds.\n * {boolean?} reconnectOnDisconnection=true - Whether to reconnect after a server-side disconnection.\n * {boolean?} reconnectOnOnline=true - Whether to reconnect after coming back online.\n * {boolean?} reconnectOnTimeout=false - Whether to reconnect after a connection timeout.\n * {number?} timeout=5_000 - Connection timeout duration in milliseconds.\n * @returns {PubSubClient}\n */\nexport function createClient (url        , options          = {})               {\n  const client               = {\n    customEventHandlers: options.handlers || {},\n    // The current number of connection attempts that failed.\n    // Reset to 0 upon successful connection.\n    // Used to compute how long to wait before the next reconnection attempt.\n    failedConnectionAttempts: 0,\n    isLocal: /\\/\\/(localhost|127\\.0\\.0\\.1)([:?/]|$)/.test(url),\n    // True if this client has never been connected yet.\n    isNew: true,\n    listeners: Object.create(null),\n    messageHandlers: { ...defaultMessageHandlers, ...options.messageHandlers },\n    nextConnectionAttemptDelayID: undefined,\n    options: { ...defaultOptions, ...options },\n    // Requested subscriptions for which we didn't receive a response yet.\n    pendingSubscriptionSet: new Set(),\n    pendingUnsubscriptionSet: new Set(),\n    pingTimeoutID: undefined,\n    shouldReconnect: true,\n    // The underlying WebSocket object.\n    // A new one is necessary for every connection or reconnection attempt.\n    socket: null,\n    subscriptionSet: new Set(),\n    kvFilter: new Map(),\n    connectionTimeoutID: undefined,\n    url: url.replace(/^http/, 'ws'),\n    ...publicMethods\n  }\n  // Create and save references to reusable event listeners.\n  // Every time a new underlying WebSocket object will be created for this\n  // client instance, these event listeners will be detached from the older\n  // socket then attached to the new one, hereby avoiding both unnecessary\n  // allocations and garbage collections of a bunch of functions every time.\n  // Another benefit is the ability to patch the client protocol at runtime by\n  // updating the client's custom event handler map.\n  for (const name of Object.keys(defaultClientEventHandlers)) {\n    client.listeners[name] = (event) => {\n      try {\n        // Use `.call()` to pass the client via the 'this' binding.\n        (defaultClientEventHandlers[name].call          )(client, event)\n        client.customEventHandlers[name]?.call(client, event)\n      } catch (error) {\n        // Do not throw any error but emit an `error` event instead.\n        sbp('okTurtles.events/emit', PUBSUB_ERROR, client, error?.message)\n      }\n    }\n  }\n  // Add global event listeners before the first connection.\n  if (typeof self === 'object' && self instanceof EventTarget) {\n    for (const name of globalEventNames) {\n      globalEventMap.set(name, client.listeners[name])\n    }\n  }\n  if (!client.options.manual) {\n    client.connect()\n  }\n  return client\n}\n\nexport function createMessage (type        , data          , meta         )         {\n  const message = { ...meta, type, data }\n  let string        \n  const stringify = function () {\n    if (!string) string = JSON.stringify(this)\n    return string\n  }\n  // $FlowFixMe[prop-missing]\n  Object.defineProperties(message, {\n    [Symbol.toPrimitive]: {\n      value: stringify\n    }\n  })\n  return message\n}\n\nexport function createKvMessage (channelID        , key        , data          )         {\n  return JSON.stringify({ type: NOTIFICATION_TYPE.KV, channelID, key, data })\n}\n\nexport function createPubMessage (channelID        , data          )         {\n  return JSON.stringify({ type: NOTIFICATION_TYPE.PUB, channelID, data })\n}\n\nexport function createRequest (type                 , data            )         {\n  // Had to use Object.assign() instead of object spreading to make Flow happy.\n  return JSON.stringify(Object.assign({ type }, data))\n}\n\n// These handlers receive the PubSubClient instance through the `this` binding.\nconst defaultClientEventHandlers = {\n  // Emitted when the connection is closed.\n  close (event            ) {\n    const client = this\n\n    console.debug('[pubsub] Event: close', event.code, event.reason)\n    client.failedConnectionAttempts++\n\n    if (client.socket) {\n      // Remove event listeners to avoid memory leaks.\n      for (const name of socketEventNames) {\n        client.socket.removeEventListener(name, client.listeners[name])\n      }\n    }\n    client.socket = null\n    client.clearAllTimers()\n\n    // This has been commented out to make the client always try to reconnect.\n    // See https://github.com/okTurtles/group-income/issues/1246\n    /*\n    // See \"Status Codes\" https://tools.ietf.org/html/rfc6455#section-7.4\n    switch (event.code) {\n      // TODO: verify that this list of codes is correct.\n      case 1000: case 1002: case 1003: case 1007: case 1008: {\n        client.shouldReconnect = false\n        break\n      }\n      default: break\n    }\n    */\n    // If we should reconnect then consider our current subscriptions as pending again,\n    // waiting to be restored upon reconnection.\n    if (client.shouldReconnect) {\n      client.subscriptionSet.forEach((channelID) => {\n        // Skip contracts from which we had to unsubscribe anyway.\n        if (!client.pendingUnsubscriptionSet.has(channelID)) {\n          client.pendingSubscriptionSet.add(channelID)\n        }\n      })\n    }\n    // We are no longer subscribed to any contracts since we are now disconnected.\n    client.subscriptionSet.clear()\n    client.pendingUnsubscriptionSet.clear()\n\n    if (client.shouldReconnect && client.options.reconnectOnDisconnection) {\n      if (client.failedConnectionAttempts > client.options.maxRetries) {\n        sbp('okTurtles.events/emit', PUBSUB_RECONNECTION_FAILED, client)\n      } else {\n        // If we are definetely offline then do not try to reconnect now,\n        // unless the server is local.\n        if (!isDefinetelyOffline() || client.isLocal) {\n          client.scheduleConnectionAttempt()\n        }\n      }\n    }\n  },\n\n  // Emitted when an error has occured.\n  // The socket will be closed automatically by the engine if necessary.\n  error (event       ) {\n    const client = this\n    // Not all error events should be logged with console.error, for example every\n    // failed connection attempt generates one such event.\n    console.warn('[pubsub] Event: error', event)\n    clearTimeout(client.pingTimeoutID)\n  },\n\n  // Emitted when a message is received.\n  // The connection will be terminated if the message is malformed or has an\n  // unexpected data type (e.g. binary instead of text).\n  message (event              ) {\n    const client = this\n    const { data } = event\n\n    if (typeof data !== 'string') {\n      sbp('okTurtles.events/emit', PUBSUB_ERROR, client, {\n        message: `Wrong data type: ${typeof data}`\n      })\n      return client.destroy()\n    }\n    let msg          = { type: '' }\n\n    try {\n      msg = messageParser(data)\n    } catch (error) {\n      sbp('okTurtles.events/emit', PUBSUB_ERROR, client, {\n        message: `Malformed message: ${error?.message}`\n      })\n      return client.destroy()\n    }\n    const handler = client.messageHandlers[msg.type]\n\n    if (handler) {\n      handler.call(client, msg)\n    } else {\n      throw new Error(`Unhandled message type: ${msg.type}`)\n    }\n  },\n\n  offline () {\n    console.info('[pubsub] Event: offline')\n    const client = this\n\n    client.clearAllTimers()\n    // Reset the connection attempt counter so that we'll start a new\n    // reconnection loop when we are back online.\n    client.failedConnectionAttempts = 0\n    client.socket?.close()\n  },\n\n  online () {\n    console.info('[pubsub] Event: online')\n    const client = this\n\n    if (client.options.reconnectOnOnline && client.shouldReconnect) {\n      if (!client.socket) {\n        client.failedConnectionAttempts = 0\n        client.scheduleConnectionAttempt()\n      }\n    }\n  },\n\n  // Emitted when the connection is established.\n  open () {\n    console.debug('[pubsub] Event: open')\n    const client = this\n    const { options } = this\n\n    client.connectionTimeUsed = undefined\n    client.clearAllTimers()\n    sbp('okTurtles.events/emit', PUBSUB_RECONNECTION_SUCCEEDED, client)\n\n    // Set it to -1 so that it becomes 0 on the next `close` event.\n    client.failedConnectionAttempts = -1\n    client.isNew = false\n    // Setup a ping timeout if required.\n    // It will close the connection if we don't get any message from the server.\n    if (options.pingTimeout > 0 && options.pingTimeout < Infinity) {\n      client.pingTimeoutID = setTimeout(() => {\n        client.socket?.close()\n      }, options.pingTimeout)\n    }\n    // Send any pending subscription request.\n    client.pendingSubscriptionSet.forEach((channelID) => {\n      const kvFilter = this.kvFilter.get(channelID)\n      // $FlowFixMe[incompatible-call]\n      client.socket?.send(createRequest(REQUEST_TYPE.SUB, kvFilter ? { channelID, kvFilter } : { channelID }))\n    })\n    // There should be no pending unsubscription since we just got connected.\n  },\n\n  'reconnection-attempt' () {\n    console.info('[pubsub] Trying to reconnect...')\n  },\n\n  'reconnection-succeeded' () {\n    console.info('[pubsub] Connection re-established')\n  },\n\n  'reconnection-failed' () {\n    console.warn('[pubsub] Reconnection failed')\n    const client = this\n\n    client.destroy()\n  },\n\n  'reconnection-scheduled' (event             ) {\n    const { delay, nth } = event.detail\n    console.info(`[pubsub] Scheduled connection attempt ${nth} in ~${delay} ms`)\n  },\n\n  'subscription-succeeded' (event             ) {\n    const { channelID } = event.detail\n    console.debug(`[pubsub] Subscribed to channel ${channelID}`)\n  }\n}\n\n// These handlers receive the PubSubClient instance through the `this` binding.\nconst defaultMessageHandlers = {\n  [NOTIFICATION_TYPE.ENTRY] (msg) {\n    console.debug('[pubsub] Received ENTRY:', msg)\n  },\n\n  [NOTIFICATION_TYPE.PING] ({ data }) {\n    const client = this\n\n    if (client.options.logPingMessages) {\n      console.debug(`[pubsub] Ping received in ${Date.now() - Number(data)} ms`)\n    }\n    // Reply with a pong message using the same data.\n    client.socket?.send(createMessage(NOTIFICATION_TYPE.PONG, data))\n    // Refresh the ping timer, waiting for the next ping.\n    clearTimeout(client.pingTimeoutID)\n    client.pingTimeoutID = setTimeout(() => {\n      client.socket?.close()\n    }, client.options.pingTimeout)\n  },\n\n  [NOTIFICATION_TYPE.PUB] ({ channelID, data }) {\n    console.log(`[pubsub] Received data from channel ${channelID}:`, data)\n    // No need to reply.\n  },\n\n  [NOTIFICATION_TYPE.KV] ({ channelID, key, data }) {\n    console.log(`[pubsub] Received KV update from channel ${channelID} ${key}:`, data)\n    // No need to reply.\n  },\n\n  [NOTIFICATION_TYPE.SUB] (msg) {\n    console.debug(`[pubsub] Ignoring ${msg.type} message:`, msg.data)\n  },\n\n  [NOTIFICATION_TYPE.UNSUB] (msg) {\n    console.debug(`[pubsub] Ignoring ${msg.type} message:`, msg.data)\n  },\n\n  [RESPONSE_TYPE.ERROR] ({ data }) {\n    const { type, channelID, reason } = data\n    console.warn(`[pubsub] Received ERROR response for ${type} request to ${channelID}`)\n    const client = this\n\n    switch (type) {\n      case REQUEST_TYPE.SUB: {\n        console.warn(`[pubsub] Could not subscribe to ${channelID}: ${reason}`)\n        client.pendingSubscriptionSet.delete(channelID)\n        break\n      }\n      case REQUEST_TYPE.UNSUB: {\n        console.warn(`[pubsub] Could not unsubscribe from ${channelID}: ${reason}`)\n        client.pendingUnsubscriptionSet.delete(channelID)\n        break\n      }\n      case REQUEST_TYPE.PUSH_ACTION: {\n        const { actionType, message } = data\n        console.warn(`[pubsub] Received ERROR for PUSH_ACTION request with the action type '${actionType}' and the following message: ${message}`)\n        break\n      }\n      default: {\n        console.error(`[pubsub] Malformed response: invalid request type ${type}`)\n      }\n    }\n  },\n\n  [RESPONSE_TYPE.OK] ({ data: { type, channelID } }) {\n    const client = this\n\n    switch (type) {\n      case REQUEST_TYPE.SUB: {\n        client.pendingSubscriptionSet.delete(channelID)\n        client.subscriptionSet.add(channelID)\n        sbp('okTurtles.events/emit', PUBSUB_SUBSCRIPTION_SUCCEEDED, client, { channelID })\n        break\n      }\n      case REQUEST_TYPE.UNSUB: {\n        console.debug(`[pubsub] Unsubscribed from ${channelID}`)\n        client.pendingUnsubscriptionSet.delete(channelID)\n        client.subscriptionSet.delete(channelID)\n        client.kvFilter.delete(channelID)\n        break\n      }\n      case REQUEST_TYPE.KV_FILTER: {\n        console.debug(`[pubsub] Set KV filter for ${channelID}`)\n        break\n      }\n      default: {\n        console.error(`[pubsub] Malformed response: invalid request type ${type}`)\n      }\n    }\n  }\n}\n\nconst globalEventNames = ['offline', 'online']\nconst socketEventNames = ['close', 'error', 'message', 'open']\nconst globalEventMap = new Map()\n\nif (typeof self === 'object' && self instanceof EventTarget) {\n  // We need to do things in this roundabout way because Chrome doesn't like\n  // these events handlers not being top-level.\n  // `Event handler of 'online' event must be added on the initial evaluation of worker script.`\n  for (const name of globalEventNames) {\n    const handler = (ev) => {\n      const h = globalEventMap.get(name)\n      return h?.(ev)\n    }\n    self.addEventListener(name, handler, false)\n  }\n}\n\n// `navigator.onLine` can give confusing false positives when `true`,\n// so we'll define `isDefinetelyOffline()` rather than `isOnline()` or `isOffline()`.\n// See https://developer.mozilla.org/en-US/docs/Web/API/Navigator/onLine\nconst isDefinetelyOffline = () => typeof navigator === 'object' && navigator.onLine === false\n\n// Parses and validates a received message.\nexport const messageParser = (data        )          => {\n  const msg = JSON.parse(data)\n\n  if (typeof msg !== 'object' || msg === null) {\n    throw new TypeError('Message is null or not an object')\n  }\n  const { type } = msg\n\n  if (typeof type !== 'string' || type === '') {\n    throw new TypeError('Message type must be a non-empty string')\n  }\n  return msg\n}\n\nconst publicMethods = {\n  clearAllTimers () {\n    const client = this\n\n    clearTimeout(client.connectionTimeoutID)\n    clearTimeout(client.nextConnectionAttemptDelayID)\n    clearTimeout(client.pingTimeoutID)\n    client.connectionTimeoutID = undefined\n    client.nextConnectionAttemptDelayID = undefined\n    client.pingTimeoutID = undefined\n  },\n\n  // Performs a connection or reconnection attempt.\n  connect () {\n    const client = this\n\n    if (client.socket !== null) {\n      throw new Error('connect() can only be called if there is no current socket.')\n    }\n    if (client.nextConnectionAttemptDelayID) {\n      throw new Error('connect() must not be called during a reconnection delay.')\n    }\n    if (!client.shouldReconnect) {\n      throw new Error('connect() should no longer be called on this instance.')\n    }\n    client.socket = new WebSocket(client.url)\n    // Sometimes (like when using `createMessage`), we want to send objects that\n    // are serialized as strings. Native web sockets don't support objects, so\n    // we use this workaround.\n    // $FlowFixMe[cannot-write]\n    client.socket.send = function (data) {\n      // $FlowFixMe[method-unbinding]\n      const send = WebSocket.prototype.send.bind(this)\n      if (typeof data === 'object' && typeof data[Symbol.toPrimitive] === 'function') {\n        return send(data[Symbol.toPrimitive]())\n      }\n      return send(data)\n    }\n\n    if (client.options.timeout) {\n      const start = performance.now()\n      client.connectionTimeoutID = setTimeout(() => {\n        client.connectionTimeoutID = undefined\n        if (client.options.reconnectOnTimeout) {\n          client.connectionTimeUsed = performance.now() - start\n        }\n        client.socket?.close(4000, 'timeout')\n      }, client.options.timeout)\n    }\n    // Attach WebSocket event listeners.\n    for (const name of socketEventNames) {\n      client.socket.addEventListener(name, client.listeners[name])\n    }\n  },\n\n  /**\n   * Immediately close the socket, stop listening for events and clear any cache.\n   *\n   * This method is used in unit tests.\n   * - In particular, no 'close' event handler will be called.\n   * - Any incoming or outgoing buffered data will be discarded.\n   * - Any pending messages will be discarded.\n   */\n  destroy () {\n    const client = this\n\n    client.clearAllTimers()\n    // Update property values.\n    // Note: do not clear 'client.options'.\n    client.pendingSubscriptionSet.clear()\n    client.pendingUnsubscriptionSet.clear()\n    client.subscriptionSet.clear()\n    // Remove global event listeners.\n    if (typeof self === 'object' && self instanceof EventTarget) {\n      for (const name of globalEventNames) {\n        globalEventMap.delete(name)\n      }\n    }\n    // Remove WebSocket event listeners.\n    if (client.socket) {\n      for (const name of socketEventNames) {\n        client.socket.removeEventListener(name, client.listeners[name])\n      }\n      client.socket.close()\n    }\n    client.listeners = {}\n    client.socket = null\n    client.shouldReconnect = false\n  },\n\n  getNextRandomDelay ()         {\n    const client = this\n\n    const {\n      maxReconnectionDelay,\n      minReconnectionDelay,\n      reconnectionDelayGrowFactor\n    } = client.options\n\n    const minDelay = minReconnectionDelay * reconnectionDelayGrowFactor ** client.failedConnectionAttempts\n    const maxDelay = minDelay * reconnectionDelayGrowFactor\n    const connectionTimeUsed = client.connectionTimeUsed\n    client.connectionTimeUsed = undefined\n\n    return Math.min(\n      // See issue #1943: Have the connection time used 'eat into' the\n      // reconnection time used\n      Math.max(\n        minReconnectionDelay,\n        connectionTimeUsed ? maxReconnectionDelay - connectionTimeUsed : maxReconnectionDelay\n      ),\n      Math.round(minDelay + (0, Math.random)() * (maxDelay - minDelay))\n    )\n  },\n\n  // Schedules a connection attempt to happen after a delay computed according to\n  // a randomized exponential backoff algorithm variant.\n  scheduleConnectionAttempt () {\n    const client = this\n\n    if (!client.shouldReconnect) {\n      throw new Error('Cannot call `scheduleConnectionAttempt()` when `shouldReconnect` is false.')\n    }\n    if (client.nextConnectionAttemptDelayID) {\n      return console.warn('[pubsub] A reconnection attempt is already scheduled.')\n    }\n    const delay = client.getNextRandomDelay()\n    const nth = client.failedConnectionAttempts + 1\n\n    client.nextConnectionAttemptDelayID = setTimeout(() => {\n      sbp('okTurtles.events/emit', PUBSUB_RECONNECTION_ATTEMPT, client)\n      client.nextConnectionAttemptDelayID = undefined\n      client.connect()\n    }, delay)\n    sbp('okTurtles.events/emit', PUBSUB_RECONNECTION_SCHEDULED, client, { delay, nth })\n  },\n\n  // Can be used to send ephemeral messages outside of any contract log.\n  // Does nothing if the socket is not in the OPEN state.\n  pub (channelID        , data          ) {\n    if (this.socket?.readyState === WebSocket.OPEN) {\n      this.socket.send(createPubMessage(channelID, data))\n    }\n  },\n  /**\n   * Sends a SUB request to the server as soon as possible.\n   *\n   * - The given channel ID will be cached until we get a relevant server\n   * response, allowing us to resend the same request if necessary.\n   * - Any identical UNSUB request that has not been sent yet will be cancelled.\n   * - Calling this method again before the server has responded has no effect.\n   * @param channelID - The ID of the channel whose updates we want to subscribe to.\n   */\n  sub (channelID        ) {\n    const client = this\n    const { socket } = this\n\n    if (!client.pendingSubscriptionSet.has(channelID)) {\n      client.pendingSubscriptionSet.add(channelID)\n      client.pendingUnsubscriptionSet.delete(channelID)\n\n      if (socket?.readyState === WebSocket.OPEN) {\n        const kvFilter = client.kvFilter.get(channelID)\n        socket.send(createRequest(REQUEST_TYPE.SUB, kvFilter ? { channelID, kvFilter } : { channelID }))\n      }\n    }\n  },\n\n  /**\n   * Sends a KV_FILTER request to the server as soon as possible.\n   */\n  setKvFilter (channelID        , kvFilter           ) {\n    const client = this\n    const { socket } = this\n\n    if (kvFilter) {\n      client.kvFilter.set(channelID, kvFilter)\n    } else {\n      client.kvFilter.delete(channelID)\n    }\n\n    if (client.subscriptionSet.has(channelID)) {\n      if (socket?.readyState === WebSocket.OPEN) {\n        // $FlowFixMe[incompatible-call]\n        socket.send(createRequest(REQUEST_TYPE.KV_FILTER, kvFilter ? { channelID, kvFilter } : { channelID }))\n      }\n    }\n  },\n\n  /**\n   * Sends an UNSUB request to the server as soon as possible.\n   *\n   * - The given channel ID will be cached until we get a relevant server\n   * response, allowing us to resend the same request if necessary.\n   * - Any identical SUB request that has not been sent yet will be cancelled.\n   * - Calling this method again before the server has responded has no effect.\n   * @param channelID - The ID of the channel whose updates we want to unsubscribe from.\n   */\n  unsub (channelID        ) {\n    const client = this\n    const { socket } = this\n\n    if (!client.pendingUnsubscriptionSet.has(channelID)) {\n      client.pendingSubscriptionSet.delete(channelID)\n      client.pendingUnsubscriptionSet.add(channelID)\n\n      if (socket?.readyState === WebSocket.OPEN) {\n        socket.send(createRequest(REQUEST_TYPE.UNSUB, { channelID }))\n      }\n    }\n  }\n}\n\n// Register custom SBP event listeners before the first connection.\nfor (const name of Object.keys(defaultClientEventHandlers)) {\n  if (name === 'error' || !socketEventNames.includes(name)) {\n    sbp('okTurtles.events/on', `pubsub-${name}`, (target, detail         ) => {\n      const ev = new CustomEvent(name, { detail })\n      target.listeners[name].call(target, ev)\n    })\n  }\n}\n\nexport default {\n  NOTIFICATION_TYPE,\n  REQUEST_TYPE,\n  RESPONSE_TYPE,\n  createClient,\n  createMessage,\n  createRequest\n}\n", "import sbp from '@sbp/sbp'\n\n// This file contains non-core parts of Chelonia, i.e., functionality that is\n// useful but optional. The threshold for something being 'optional' generally\n// is something that can be implemented externally using only public Chelonia\n// selectors.\n// Optional functionality can make certain assumptions about contracts or\n// actions to make things simpler or easier to implement.\n// Currently, a single selector is defined: 'chelonia/kv/queuedSet'.\n// TODO: Other things should be moved to this file, such as `encryptedAction`\n// (the wrapper) and 'gi.actions/out/rotateKeys'.\n\nexport default (sbp('sbp/selectors/register', {\n  // This selector is a wrapper for the `chelonia/kv/set` selector that uses\n  // the contract queue and allows referring to keys by name, with default key\n  // names set to `csk` and `cek` for signatures and encryption, respectively.\n  // For most 'simple' use cases, this selector is a better choice than\n  // `chelonia/kv/set`. However, the `chelonia/kv/set` primitive is needed if\n  // the queueing logic needs to be more advanced, the key to use requires\n  // custom logic or _if the `onconflict` callback also needs to be queued_.\n  'chelonia/kv/queuedSet': ({ contractID, key, data, onconflict, ifMatch, encryptionKeyName = 'cek', signingKeyName = 'csk' }) => {\n    return sbp('chelonia/queueInvocation', contractID, () => {\n      return sbp('chelonia/kv/set', contractID, key, data, {\n        ifMatch,\n        encryptionKeyId: sbp('chelonia/contract/currentKeyIdByName', contractID, encryptionKeyName),\n        signingKeyId: sbp('chelonia/contract/currentKeyIdByName', contractID, signingKeyName),\n        onconflict\n      })\n    })\n  }\n})          )\n", "var m=/;\\s*boundary=(?:\"([0-9a-zA-Z'()+_,\\-./:=? ]{0,69}[0-9a-zA-Z'()+_,\\-./:=?])\"|([0-9a-zA-Z'+_\\-.]{0,69}[0-9a-zA-Z'+_\\-.]))/;var M=n=>new ReadableStream({pull(e){if(ArrayBuffer.isView(n))e.enqueue(n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength));else if(n instanceof ArrayBuffer)e.enqueue(n);else throw new TypeError(\"Expected ArrayBuffer or an ArrayBuffer view.\");e.close()}}),u=M;var b=new TextEncoder,T=/;\\s*boundary=(?:\"([^\"]+)\"|([^;\",]+))/,h=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+_-.\",A=()=>{let n=new Uint8Array(24);return globalThis.crypto.getRandomValues(n),Array.from(n).map(s=>h[s%h.length]).join(\"\")},i={preventClose:!0};async function*g(n,s,e){let l=b.encode(`\\r\n--${n}`);if(Array.isArray(s)&&s.length<1){await e.abort(Error(\"At least one part is required\"));return}let d=0;for await(let r of s){d++;let o,t;if(!r.body&&r.parts)if(t=r.headers.get(\"content-type\"),!t)o=A(),t=`multipart/mixed; boundary=\"${o}\"`;else if(!t.startsWith(\"multipart/\")||!T.test(t)){await e.abort(Error(\"Invalid multipart content type: \"+t));return}else{let a=t.match(m);(!a||!(o=a[1]||a[2]))&&(o=A(),t=t.replace(T,`; boundary=\"${o}\"`))}await u(l).pipeTo(e,i),yield;{let a=[\"\"];if(t){let y=!1;r.headers.forEach((f,c)=>{c!==\"content-type\"?a.push(`${c}: ${f}`):(y=!0,a.push(`${c}: ${t}`))}),y||a.push(`content-type: ${t}`)}else r.headers.forEach((y,f)=>{a.push(`${f}: ${y}`)});r.parts||!r.body?a.push(\"\"):a.push(\"\",\"\");let B=b.encode(a.join(`\\r\n`));a.length=0,await u(B).pipeTo(e,i),yield}if(r.body){if(r.body instanceof ArrayBuffer||ArrayBuffer.isView(r.body))await u(r.body).pipeTo(e,i);else if(r.body instanceof Blob)await r.body.stream().pipeTo(e,i);else if(r.body instanceof ReadableStream)await r.body.pipeTo(e,i);else{await e.abort(Error(\"Invalid body type\"));return}yield}else if(r.parts){if(!o){await e.abort(Error(\"Runtime exception: undefined part boundary\"));return}yield*g(o,r.parts,e),yield}}if(!d){await e.abort(Error(\"At least one part is required\"));return}let p=b.encode(`\\r\n--${n}--`);await u(p).pipeTo(e,i)}var w=(n,s)=>{let e=new TransformStream,l=g(n,s,e.writable),d=!1,p=e.readable.getReader();return new ReadableStream({start(o){(async()=>{for(;;)try{let t=await p.read();if(t.done){let a=new Uint8Array([13,10]);o.enqueue(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)),o.close();return}o.enqueue(t.value)}catch(t){console.error(\"Read error:\",t),o.error(t);return}})().catch(()=>{})},async pull(){if(d)return;(await l.next()).done&&(d=!0,await e.writable.close())}})},x=w;export{x as default,x as encodeMultipartMessage};\n", "var v=async(n,T,w,L)=>{let u=await globalThis.crypto.subtle.importKey(\"raw\",T,\"HKDF\",!1,[\"deriveKey\",\"deriveBits\"]),d=await globalThis.crypto.subtle.deriveKey({name:\"HKDF\",hash:\"SHA-256\",info:n.cek_info,salt:w},u,n.params,!1,L),A=await globalThis.crypto.subtle.deriveBits({name:\"HKDF\",hash:\"SHA-256\",info:n.nonce_info,salt:w},u,n.nonce_length<<3);return[d,function*(){let s=new ArrayBuffer(n.nonce_length),e=new DataView(s),y=new Uint8Array(s),i=new Uint8Array(A),b=4294967295,f=(n.nonce_length>>2)-1,l=new Array(f).fill(0);for(;;){for(let a=0;a<=b;a++){e.setUint32(e.byteLength-4,a,!1);let t=new Uint8Array(n.nonce_length);for(let r=0;r<t.length;r++)t[r]=i[r]^y[r];yield t}for(let a=0;a<f;a++){if(a===f-1&&l[a]===b)throw new RangeError(\"Maximum number of segments exceeded\");if(l[a]=(l[a]+1)%(b+1),e.setUint32(e.byteLength-4*(a+2),l[a],!1),l[a]!==0)break}}}()]},I=v;var B=n=>ArrayBuffer.isView(n)?new Uint8Array(n.buffer).subarray(n.byteOffset,n.byteOffset+n.byteLength):new Uint8Array(n),m=B;var o={salt:{},recordSize:{},keyIdLen:{},keyId:{},payload:{},done:{}},R=(n,T,w,L)=>{let u=new Uint8Array(16),d,A,E,s=0,e=0,y=new Uint8Array(256),i=o.salt,b=new TransformStream({start:()=>{},transform:async(f,l)=>{let a=m(f),t=0;for(;t<f.byteLength;)switch(i){case o.salt:{let r=a.subarray(t,t+u.byteLength-e);if(u.set(r,e),e+=r.byteLength,t+=r.byteLength,e===u.byteLength){e=0,i=o.recordSize;continue}break}case o.recordSize:{let r=a.subarray(t,t+4-e),g=new ArrayBuffer(4),h=new Uint8Array(g),c=new DataView(g);if(h.set(r,e),s|=c.getUint32(0,!1),e+=r.byteLength,t+=r.byteLength,e===4){if(s<=n.tag_length+1||s>(L==null?4294967295:Math.min(4294967295,L)))throw new RangeError(\"Invalid record size: \"+s);e=0,i=o.keyIdLen;continue}break}case o.keyIdLen:{y[0]=a[t++],i=o.keyId;continue}case o.keyId:{let r=a.subarray(t,t+y[0]-e);if(y.set(r,1+e),e+=r.byteLength,t+=r.byteLength,e===y[0]){let g=await w(y.subarray(1,1+y[0]));w=void 0;let h=await I(n,g,u,[\"decrypt\"]);A=h[0],E=h[1],d=new Uint8Array(s),e=0,i=o.payload;continue}break}case o.payload:{let r=a.subarray(t,t+s-e);if(d.set(r,e),e+=r.byteLength,t+=r.byteLength,e===s){let h=E.next().value,c=m(await globalThis.crypto.subtle.decrypt({name:n.params.name,iv:h,tagLength:n.tag_length<<3},A,d.subarray(0,e))),p=c.byteLength-1;for(;p>0&&c[p]===0;p--);if(c[p]===2){if(t!==f.byteLength)throw new Error(\"Unexpected terminal padding delimiter\");i=o.done}else if(c[p]!==1)throw new Error(\"Invalid padding delimiter\");l.enqueue(c.buffer.slice(0,p)),c.fill(0),e=0;continue}break}default:throw new Error(\"Invalid state\")}},flush:async f=>{switch(i){case o.done:return;case o.payload:{if(e<1+n.tag_length)throw new Error(\"Unexpected end of data\");let a=E.next().value,t=m(await globalThis.crypto.subtle.decrypt({name:n.params.name,iv:a,tagLength:n.tag_length<<3},A,d.subarray(0,e))),r=t.byteLength-1;for(;r>0&&t[r]===0;r--);if(t[r]!==2)throw new Error(\"Unexpected non-terminal padding delimiter\");f.enqueue(t.buffer.slice(0,r)),t.fill(0);return}default:throw new Error(\"Invalid state\")}}});return T.pipeThrough(b),b.readable},S=R;export{S as default};\n", "var x={params:{name:\"AES-GCM\",length:128},get cek_info(){return new Uint8Array([67,111,110,116,101,110,116,45,69,110,99,111,100,105,110,103,58,32,97,101,115,49,50,56,103,99,109,0])},get nonce_info(){return new Uint8Array([67,111,110,116,101,110,116,45,69,110,99,111,100,105,110,103,58,32,110,111,110,99,101,0])},block_size:16,tag_length:16,nonce_length:12},e={params:{name:\"AES-GCM\",length:256},get cek_info(){return new Uint8Array([67,111,110,116,101,110,116,45,69,110,99,111,100,105,110,103,58,32,97,101,115,50,53,54,103,99,109,0])},get nonce_info(){return new Uint8Array([67,111,110,116,101,110,116,45,69,110,99,111,100,105,110,103,58,32,110,111,110,99,101,0])},block_size:16,tag_length:16,nonce_length:12};export{x as aes128gcm,e as aes256gcm};\n", "var R=async(e,b,f,i)=>{let A=await globalThis.crypto.subtle.importKey(\"raw\",b,\"HKDF\",!1,[\"deriveKey\",\"deriveBits\"]),y=await globalThis.crypto.subtle.deriveKey({name:\"HKDF\",hash:\"SHA-256\",info:e.cek_info,salt:f},A,e.params,!1,i),u=await globalThis.crypto.subtle.deriveBits({name:\"HKDF\",hash:\"SHA-256\",info:e.nonce_info,salt:f},A,e.nonce_length<<3);return[y,function*(){let L=new ArrayBuffer(e.nonce_length),c=new DataView(L),h=new Uint8Array(L),a=new Uint8Array(u),g=4294967295,o=(e.nonce_length>>2)-1,s=new Array(o).fill(0);for(;;){for(let t=0;t<=g;t++){c.setUint32(c.byteLength-4,t,!1);let n=new Uint8Array(e.nonce_length);for(let r=0;r<n.length;r++)n[r]=a[r]^h[r];yield n}for(let t=0;t<o;t++){if(t===o-1&&s[t]===g)throw new RangeError(\"Maximum number of segments exceeded\");if(s[t]=(s[t]+1)%(g+1),c.setUint32(c.byteLength-4*(t+2),s[t],!1),s[t]!==0)break}}}()]},E=R;var B=e=>ArrayBuffer.isView(e)?new Uint8Array(e.buffer).subarray(e.byteOffset,e.byteOffset+e.byteLength):new Uint8Array(e),w=B;var N=()=>{let e=new Uint8Array(16);return globalThis.crypto.getRandomValues(e),e},U=async(e,b,f,i,A,y)=>{if(f<=e.tag_length+1||f>4294967295)throw new RangeError(\"Invalid record size: \"+f);if(i.byteLength>255)throw new RangeError(\"Key ID too long\");if(y&&y.byteLength!==16)throw new RangeError(\"Invald salt length: \"+y.byteLength);let u=f-e.tag_length-1,l=y?w(y):N(),[L,c]=await E(e,A,l,[\"encrypt\"]);A=void 0;let h=new Uint8Array(u),a=0,g=new TransformStream({start:o=>{let s=l.byteLength+4+1+i.byteLength,t=new ArrayBuffer(s);new Uint8Array(t,0,l.byteLength).set(l);let r=new DataView(t,l.byteLength,5);r.setUint32(0,f,!1),r.setUint8(4,i.byteLength);let d=new Uint8Array(t,l.byteLength+4+1,i.byteLength),m=w(i);d.set(m),o.enqueue(t)},transform:async(o,s)=>{let t=w(o),n=0;for(;n<o.byteLength;){let r=t.subarray(n,n+u-a);if(h.set(r,a),a+=r.byteLength,n+=r.byteLength,a===u){let m=c.next().value,p=new Uint8Array(u+1);p.set(h.subarray(0,a)),p[a]=1;let T=await globalThis.crypto.subtle.encrypt({name:e.params.name,iv:m,tagLength:e.tag_length<<3},L,p);s.enqueue(T),a=0}}},flush:async o=>{let t=c.next().value,n=new Uint8Array(a+1);n.set(h.subarray(0,a)),n[a]=2;let r=await globalThis.crypto.subtle.encrypt({name:e.params.name,iv:t,tagLength:e.tag_length<<3},L,n);o.enqueue(r),h.fill(0),n.fill(0)}});return b.pipeThrough(g),g.readable},K=U;export{K as default};\n", "import encodeMultipartMessage from '@exact-realty/multipart-parser/encodeMultipartMessage'\nimport decrypt from '@apeleghq/rfc8188/decrypt'\nimport { aes256gcm } from '@apeleghq/rfc8188/encodings'\nimport encrypt from '@apeleghq/rfc8188/encrypt'\nimport { generateSalt } from '@chelonia/crypto'\nimport sbp from '@sbp/sbp'\nimport { blake32Hash, createCID, createCIDfromStream, multicodes } from '~/shared/functions.js'\nimport { has } from 'turtledash'\nimport { coerce } from '@chelonia/multiformats/bytes'\n                                         \nimport { buildShelterAuthorizationHeader } from './utils.js'\n\n// Snippet from <https://github.com/WebKit/standards-positions/issues/24#issuecomment-1181821440>\n// Node.js supports request streams, but also this check isn't meant for Node.js\n// This part only checks for client-side support. Later, when we try uploading\n// a file for the first time, we'll check if requests work, as streams are not\n// supported in HTTP/1.1 and lower versions.\nlet supportsRequestStreams = typeof window !== 'object' || (() => {\n  let duplexAccessed = false\n\n  const hasContentType = new Request('', {\n    body: new ReadableStream(),\n    method: 'POST',\n    get duplex () {\n      duplexAccessed = true\n      return 'half'\n    }\n  }).headers.has('content-type')\n\n  return duplexAccessed && !hasContentType\n})()\n\nconst streamToUint8Array = async (s                ) => {\n  const reader = s.getReader()\n  const chunks               = []\n  let length = 0\n  for (;;) {\n    const result = await reader.read()\n    if (result.done) break\n    chunks.push(coerce(result.value))\n    // $FlowFixMe[incompatible-use]\n    length += result.value.byteLength\n  }\n  const body = new Uint8Array(length)\n  chunks.reduce((offset, chunk) => {\n    body.set(chunk, offset)\n    return offset + chunk.byteLength\n  }, 0)\n  return body\n}\n\n// Check for streaming support, as of today (Feb 2024) only Blink-\n// based browsers support this (i.e., Firefox and Safari don't).\nconst ArrayBufferToUint8ArrayStream = async function (connectionURL        , s                ) {\n  // Even if the browser supports streams, some browsers (e.g., Chrome) also\n  // require that the server support HTTP/2\n  if (supportsRequestStreams === true) {\n    await this.config.fetch(`${connectionURL}/streams-test`, {\n      method: 'POST',\n      body: new ReadableStream({ start (c) { c.enqueue(Buffer.from('ok')); c.close() } }),\n      duplex: 'half'\n    }).then((r) => {\n      if (!r.ok) throw new Error('Unexpected response')\n      // supportsRequestStreams is tri-state\n      supportsRequestStreams = 2\n    }).catch(() => {\n      console.info('files: Disabling streams support because the streams test failed')\n      supportsRequestStreams = false\n    })\n  }\n  if (!supportsRequestStreams) {\n    return await streamToUint8Array(s)\n  }\n\n  return s.pipeThrough(\n    // eslint-disable-next-line no-undef\n    new TransformStream(\n      // $FlowFixMe[extra-arg]\n      {\n        transform (chunk, controller) {\n          controller.enqueue(coerce(chunk))\n        }\n      })\n  )\n}\n\nconst computeChunkDescriptors = (inStream                ) => {\n  let length = 0\n  const [lengthStream, cidStream] = inStream.tee()\n  const lengthPromise = new Promise((resolve, reject) => {\n    // $FlowFixMe[incompatible-call]\n    lengthStream.pipeTo(new WritableStream({\n      write (chunk) {\n        length += chunk.byteLength\n      },\n      close () {\n        resolve(length)\n      },\n      abort (reason) {\n        reject(reason)\n      }\n    }))\n  })\n  const cidPromise = createCIDfromStream(cidStream, multicodes.SHELTER_FILE_CHUNK)\n  return Promise.all([lengthPromise, cidPromise])\n}\n\nconst fileStream = (chelonia        , manifest        ) => {\n  const dataGenerator = async function * () {\n    let readSize = 0\n    for (const chunk of manifest.chunks) {\n      if (\n        !Array.isArray(chunk) ||\n        typeof chunk[0] !== 'number' ||\n        typeof chunk[1] !== 'string'\n      ) {\n        throw new Error('Invalid chunk descriptor')\n      }\n      const chunkResponse = await chelonia.config.fetch(`${chelonia.config.connectionURL}/file/${chunk[1]}`, {\n        method: 'GET',\n        signal: chelonia.abortController.signal\n      })\n      if (!chunkResponse.ok) {\n        throw new Error('Unable to retrieve manifest')\n      }\n      // TODO: We're reading the chunks in their entirety instead of using the\n      // stream interface. In the future, this can be changed to get a stream\n      // instead. Ensure then that the following checks are replaced with a\n      // streaming version (length and CID)\n      const chunkBinary = await chunkResponse.arrayBuffer()\n      if (chunkBinary.byteLength !== chunk[0]) throw new Error('mismatched chunk size')\n      readSize += chunkBinary.byteLength\n      if (readSize > manifest.size) throw new Error('read size exceeds declared size')\n      if (createCID(coerce(chunkBinary), multicodes.SHELTER_FILE_CHUNK) !== chunk[1]) throw new Error('mismatched chunk hash')\n      yield chunkBinary\n    }\n    // Now that we're done, we check to see if we read the correct size\n    // If all went well, we should have and this would never throw. However,\n    // if the payload was tampered with, we could have read a different size\n    // than expected. This will throw at the end, after all chunks are processed\n    // and after some or all of the data have already been consumed.\n    // If integrity of the entire payload is important, consumers must buffer\n    // the stream and wait until the end before any processing.\n    if (readSize !== manifest.size) throw new Error('mismatched size')\n  }\n\n  const dataIterator = dataGenerator()\n\n  return new ReadableStream({\n    async pull (controller) {\n      try {\n        const chunk = await dataIterator.next()\n        if (chunk.done) {\n          controller.close()\n          return\n        }\n        controller.enqueue(chunk.value)\n      } catch (e) {\n        controller.error(e)\n      }\n    }\n  })\n}\n\nexport const aes256gcmHandlers      = {\n  upload: (_chelonia        , manifestOptions        ) => {\n    // IKM stands for Input Keying Material, and is a random value used to\n    // derive the encryption used in the chunks. See RFC 8188 for how the\n    // actual encryption key gets derived from the IKM.\n    const params = manifestOptions['cipher-params']\n    let IKM = params?.IKM\n    const recordSize = params?.rs ?? 1 << 16\n    if (!IKM) {\n      IKM = new Uint8Array(33)\n      self.crypto.getRandomValues(IKM)\n    }\n    // The keyId is only used as a sanity check but otherwise it is not needed\n    // Because the keyId is computed from the IKM, which is a secret, it is\n    // truncated to just eight characters so that it doesn't disclose too much\n    // information about the IKM (in theory, since it's a random string 33 bytes\n    // long, a full hash shouldn't disclose too much information anyhow).\n    // The reason the keyId is not _needed_ is that the IKM is part of the\n    // downloadParams, so anyone downloading a file should have the required\n    // context, and there is exactly one valid IKM for any downloadParams.\n    // By truncating the keyId, the only way to fully verify whether a given\n    // IKM decrypts a file is by attempting decryption.\n    // A side-effect of truncating the keyId is that, if the IKM were shared\n    // some other way (e.g., using the OP_KEY_SHARE mechanism), because of\n    // collisions it may not always be possible to look up the correct IKM.\n    // Therefore, a handler that uses a different strategy than the one used\n    // here (namely, including the IKM in the downloadParams) may need to use\n    // longer key IDs, possibly a full hash.\n    const keyId = blake32Hash('aes256gcm-keyId' + blake32Hash(IKM)).slice(-8)\n    const binaryKeyId = Buffer.from(keyId)\n    return {\n      cipherParams: {\n        keyId\n      },\n      streamHandler: async (stream                ) => {\n        return await encrypt(aes256gcm, stream, recordSize, binaryKeyId, IKM)\n      },\n      downloadParams: {\n        IKM: Buffer.from(IKM).toString('base64'),\n        rs: recordSize\n      }\n    }\n  },\n  download: (chelonia        , downloadParams        , manifest        ) => {\n    const IKMb64 = downloadParams.IKM\n    if (!IKMb64) {\n      throw new Error('Missing IKM in downloadParams')\n    }\n    const IKM = Buffer.from(IKMb64, 'base64')\n    const keyId = blake32Hash('aes256gcm-keyId' + blake32Hash(IKM)).slice(-8)\n    if (!manifest['cipher-params'] || !manifest['cipher-params'].keyId) {\n      throw new Error('Missing cipher-params')\n    }\n    if (keyId !== manifest['cipher-params'].keyId) {\n      throw new Error('Key ID mismatch')\n    }\n    const maxRecordSize = downloadParams.rs ?? 1 << 27 // 128 MiB\n    return {\n      payloadHandler: async () => {\n        const bytes = await streamToUint8Array(\n          decrypt(aes256gcm, fileStream(chelonia, manifest), (actualKeyId) => {\n            if (Buffer.from(actualKeyId).toString() !== keyId) {\n              throw new Error('Invalid key ID')\n            }\n            return IKM\n          }, maxRecordSize)\n        )\n        return new Blob([bytes], { type: manifest.type || 'application/octet-stream' })\n      }\n    }\n  }\n}\n\nexport const noneHandlers      = {\n  upload: () => {\n    return {\n      cipherParams: undefined,\n      streamHandler: (stream                ) => {\n        return stream\n      },\n      downloadParams: undefined\n    }\n  },\n  download: (chelonia        , _downloadParams        , manifest        ) => {\n    return {\n      payloadHandler: async () => {\n        const bytes = await streamToUint8Array(fileStream(chelonia, manifest))\n        return new Blob([bytes], { type: manifest.type || 'application/octet-stream' })\n      }\n    }\n  }\n}\n\n// TODO: Move into Chelonia config\nconst cipherHandlers = {\n  aes256gcm: aes256gcmHandlers,\n  none: noneHandlers\n}\n\nexport default (sbp('sbp/selectors/register', {\n  'chelonia/fileUpload': async function (chunks               , manifestOptions        , { billableContractID }                                 = {}) {\n    if (!Array.isArray(chunks)) chunks = [chunks]\n    const chunkDescriptors                              = []\n    const cipherHandler = await cipherHandlers[manifestOptions.cipher]?.upload?.(this, manifestOptions)\n    if (!cipherHandler) throw new Error('Unsupported cipher')\n    const cipherParams = cipherHandler.cipherParams\n    const transferParts = await Promise.all(chunks.map(async (chunk      , i) => {\n      const stream = chunk.stream()\n      const encryptedStream = await cipherHandler.streamHandler(stream)\n      const [body, s] = encryptedStream.tee()\n      chunkDescriptors.push(computeChunkDescriptors(s))\n      return {\n        headers: new Headers([\n          ['content-disposition', `form-data; name=\"${i}\"; filename=\"${i}\"`],\n          ['content-type', 'application/octet-stream']\n        ]),\n        body\n      }\n    }))\n    transferParts.push({\n      headers: new Headers([\n        ['content-disposition', 'form-data; name=\"manifest\"; filename=\"manifest.json\"'],\n        ['content-type', 'application/vnd.shelter.filemanifest']\n      ]),\n      body: new ReadableStream({\n        async start (controller) {\n          const chunks = await Promise.all(chunkDescriptors)\n          const manifest = {\n            version: '1.0.0',\n            // ?? undefined coerces null and undefined to undefined\n            // This ensures that null or undefined values don't make it to the\n            // JSON (otherwise, null values _would_ be stringified as 'null')\n            type: manifestOptions.type ?? undefined,\n            meta: manifestOptions.meta ?? undefined,\n            cipher: manifestOptions.cipher,\n            'cipher-params': cipherParams,\n            size: chunks.reduce((acc, [cv]) => acc + cv, 0),\n            chunks,\n            'name-map': manifestOptions['name-map'] ?? undefined,\n            alternatives: manifestOptions.alternatives ?? undefined\n          }\n          controller.enqueue(Buffer.from(JSON.stringify(manifest)))\n          controller.close()\n        }\n      })\n    })\n    // TODO: Using `self.crypto.randomUUID` breaks the tests. Maybe upgrading\n    // Cypress would fix this.\n    const boundary = typeof self.crypto?.randomUUID === 'function'\n      ? self.crypto.randomUUID()\n      // If randomUUID not available, we instead compute a random boundary\n      // The indirect call to Math.random (`(0, Math.random)`) is to explicitly\n      // mark that we intend on using Math.random, even though it's not a\n      // CSPRNG, so that it's not reported as a bug in by static analysis tools.\n      : new Array(36).fill('').map(() =>\n        'abcdefghijklmnopqrstuvwxyz'[(0, Math.random)() * 26 | 0]).join('')\n    const stream = encodeMultipartMessage(boundary, transferParts)\n\n    const deletionToken = 'deletionToken' + generateSalt()\n    const deletionTokenHash = blake32Hash(deletionToken)\n\n    const uploadResponse = await this.config.fetch(`${this.config.connectionURL}/file`, {\n      method: 'POST',\n      signal: this.abortController.signal,\n      body: await ArrayBufferToUint8ArrayStream.call(this, this.config.connectionURL, stream),\n      headers: new Headers([\n        ...(billableContractID ? [['authorization', buildShelterAuthorizationHeader.call(this, billableContractID)]] : []),\n        ['content-type', `multipart/form-data; boundary=${boundary}`],\n        ['shelter-deletion-token-digest', deletionTokenHash]\n      ]),\n      duplex: 'half'\n    })\n\n    if (!uploadResponse.ok) throw new Error('Error uploading file')\n    return {\n      download: {\n        manifestCid: await uploadResponse.text(),\n        downloadParams: cipherHandler.downloadParams\n      },\n      delete: deletionToken\n    }\n  },\n  'chelonia/fileDownload': async function (downloadOptions                                                         , manifestChecker                                                   ) {\n    // Using a function to prevent accidental logging\n    const { manifestCid, downloadParams } = downloadOptions.valueOf()\n    const manifestResponse = await this.config.fetch(`${this.config.connectionURL}/file/${manifestCid}`, {\n      method: 'GET',\n      signal: this.abortController.signal\n    })\n    if (!manifestResponse.ok) {\n      throw new Error('Unable to retrieve manifest')\n    }\n    const manifestBinary = await manifestResponse.arrayBuffer()\n    if (createCID(coerce(manifestBinary), multicodes.SHELTER_FILE_MANIFEST) !== manifestCid) throw new Error('mismatched manifest hash')\n    const manifest = JSON.parse(Buffer.from(manifestBinary).toString())\n    if (typeof manifest !== 'object') throw new Error('manifest format is invalid')\n    if (manifest.version !== '1.0.0') throw new Error('unsupported manifest version')\n    if (!Array.isArray(manifest.chunks)) throw new Error('missing required field: chunks')\n\n    if (manifestChecker) {\n      const proceed = await manifestChecker?.(manifest)\n      if (!proceed) return false\n    }\n\n    const cipherHandler = await cipherHandlers[manifest.cipher]?.download?.(this, downloadParams, manifest)\n    if (!cipherHandler) throw new Error('Unsupported cipher')\n\n    return cipherHandler.payloadHandler()\n  },\n  'chelonia/fileDelete': async function (manifestCid                   , credentials                                                                             = {}) {\n    if (!manifestCid) {\n      throw new TypeError('A manifest CID must be provided')\n    }\n    if (!Array.isArray(manifestCid)) manifestCid = [manifestCid]\n    return await Promise.allSettled(manifestCid.map(async (cid) => {\n      const hasCredential = has(credentials, cid)\n      const hasToken = has(credentials[cid], 'token') && credentials[cid].token\n      const hasBillableContractID = has(credentials[cid], 'billableContractID') && credentials[cid].billableContractID\n      if (!hasCredential || hasToken === hasBillableContractID) {\n        throw new TypeError(`Either a token or a billable contract ID must be provided for ${cid}`)\n      }\n\n      const response = await this.config.fetch(`${this.config.connectionURL}/deleteFile/${cid}`, {\n        method: 'POST',\n        signal: this.abortController.signal,\n        headers: new Headers([\n          ['authorization',\n            hasToken\n              // $FlowFixMe[incompatible-type]\n              ? `bearer ${(credentials[cid].token     ).valueOf()}`\n              // $FlowFixMe[incompatible-type]\n              // $FlowFixMe[incompatible-call]\n              : buildShelterAuthorizationHeader.call(this, credentials[cid].billableContractID)]\n        ])\n      })\n      if (!response.ok) {\n        throw new Error(`Unable to delete file ${cid}`)\n      }\n    }))\n  }\n})          )\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport '@sbp/okturtles.data'\nimport '@sbp/okturtles.eventqueue'\nimport { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\nimport { ChelErrorDBBadPreviousHEAD, ChelErrorDBConnection } from './errors.js'\n\nconst headPrefix = 'head='\n\nconst getContractIdFromLogHead = (key        )          => {\n  if (!key.startsWith(headPrefix)) return undefined\n  return key.slice(headPrefix.length)\n}\nconst getLogHead = (contractID        )         => `${headPrefix}${contractID}`\n\n                                                                         \n\nexport const checkKey = (key        )       => {\n  // Disallow unprintable characters, slashes, and TAB.\n  // Also disallow characters not allowed by Windows:\n  // <https://learn.microsoft.com/en-us/windows/win32/fileio/naming-a-file>\n  if (/[\\x00-\\x1f\\x7f\\t\\\\/<>:\"|?*]/.test(key)) { // eslint-disable-line no-control-regex\n    throw new Error(`bad key: ${JSON.stringify(key)}`)\n  }\n}\n\nexport const parsePrefixableKey = (key        )                   => {\n  const i = key.indexOf(':')\n  if (i === -1) {\n    return ['', key]\n  }\n  const prefix = key.slice(0, i + 1)\n  if (prefix in prefixHandlers) {\n    return [prefix, key.slice(prefix.length)]\n  }\n  throw new ChelErrorDBConnection(`Unknown prefix in '${key}'.`)\n}\n\nexport const prefixHandlers         = {\n  // Decode buffers, but don't transform other values.\n  '': value => Buffer.isBuffer(value) ? value.toString('utf8') : value,\n  'any:': value => value\n  /*\n  // 2025-03-24: Commented out because it's not used; currently, only `any:`\n  // is used in the `/file` route.\n  // Throw if the value if not a buffer.\n  'blob:': value => {\n    if (Buffer.isBuffer(value)) {\n      return value\n    }\n    throw new ChelErrorDBConnection('Unexpected value: expected a buffer.')\n  }\n  */\n}\n\n// NOTE: To enable persistence of log use 'sbp/selectors/overwrite'\n//       to overwrite the following selectors:\nsbp('sbp/selectors/unsafe', ['chelonia.db/get', 'chelonia.db/set', 'chelonia.db/delete'])\n// NOTE: MAKE SURE TO CALL 'sbp/selectors/lock' after overwriting them!\n\n// When using a lightweight client, the client doesn't keep a copy of messages\n// in the DB. Therefore, `chelonia.db/*` selectors are mostly turned into no-ops.\n// The `chelonia.db/get` selector is slightly more complex than a no-op, because\n// Chelonia relies on being able to find the current contract head. To overcome\n// this, if a head is requested, 'chelonia.db/get' returns information from\n// the Chelonia contract state.\nconst dbPrimitiveSelectors = process.env.LIGHTWEIGHT_CLIENT === 'true'\n  ? {\n      'chelonia.db/get': function (key        )                                             {\n        const id = getContractIdFromLogHead(key)\n        if (!id) return Promise.resolve()\n        const state = sbp('chelonia/rootState').contracts[id]\n        const value = (state?.HEAD\n          ? JSON.stringify({\n            HEAD: state.HEAD,\n            height: state.height,\n            previousKeyOp: state.previousKeyOp\n          })\n          : undefined)\n        return Promise.resolve(value)\n      },\n      'chelonia.db/set': function ()                        {\n        return Promise.resolve()\n      },\n      'chelonia.db/delete': function ()                   { return Promise.resolve(true) }\n    }\n  : {\n      // eslint-disable-next-line require-await\n      'chelonia.db/get': async function (prefixableKey        )                                                     {\n        const [prefix, key] = parsePrefixableKey(prefixableKey)\n        const value = sbp('okTurtles.data/get', key)\n        if (value === undefined) {\n          return\n        }\n        return prefixHandlers[prefix](value)\n      },\n      // eslint-disable-next-line require-await\n      'chelonia.db/set': async function (key        , value                 )                        {\n        checkKey(key)\n        return sbp('okTurtles.data/set', key, value)\n      },\n      // eslint-disable-next-line require-await\n      'chelonia.db/delete': async function (key        )                   {\n        return sbp('okTurtles.data/delete', key)\n      }\n    }\n\nexport default ((sbp('sbp/selectors/register', {\n  ...dbPrimitiveSelectors,\n  'chelonia/db/getEntryMeta': async (contractID        , height        ) => {\n    const entryMetaJson = await sbp('chelonia.db/get', `_private_hidx=${contractID}#${height}`)\n    if (!entryMetaJson) return\n\n    return JSON.parse(entryMetaJson)\n  },\n  'chelonia/db/setEntryMeta': async (contractID        , height        , entryMeta        ) => {\n    const entryMetaJson = JSON.stringify(entryMeta)\n    await sbp('chelonia.db/set', `_private_hidx=${contractID}#${height}`, entryMetaJson)\n  },\n  'chelonia/db/latestHEADinfo': async (contractID        )                           => {\n    const r = await sbp('chelonia.db/get', getLogHead(contractID))\n    return r && JSON.parse(r)\n  },\n  'chelonia/db/deleteLatestHEADinfo': (contractID        )                => {\n    return sbp('chelonia.db/set', getLogHead(contractID), '')\n  },\n  'chelonia/db/getEntry': async function (hash        )                     {\n    try {\n      const value         = await sbp('chelonia.db/get', hash)\n      if (!value) throw new Error(`no entry for ${hash}!`)\n      return SPMessage.deserialize(value, this.transientSecretKeys, undefined, this.config.unwrapMaybeEncryptedData)\n    } catch (e) {\n      throw new ChelErrorDBConnection(`${e.name} during getEntry: ${e.message}`)\n    }\n  },\n  'chelonia/db/addEntry': function (entry           )                  {\n    // because addEntry contains multiple awaits - we want to make sure it gets executed\n    // \"atomically\" to minimize the chance of a contract fork\n    return sbp('okTurtles.eventQueue/queueEvent', `chelonia/db/${entry.contractID()}`, [\n      'chelonia/private/db/addEntry', entry\n    ])\n  },\n  // NEVER call this directly yourself! _always_ call 'chelonia/db/addEntry' instead\n  'chelonia/private/db/addEntry': async function (entry           )                  {\n    try {\n      const { previousHEAD: entryPreviousHEAD, previousKeyOp: entryPreviousKeyOp, height: entryHeight } = entry.head()\n      const contractID         = entry.contractID()\n      if (await sbp('chelonia.db/get', entry.hash())) {\n        console.warn(`[chelonia.db] entry exists: ${entry.hash()}`)\n        return entry.hash()\n      }\n      const HEADinfo = await sbp('chelonia/db/latestHEADinfo', contractID)\n      if (!entry.isFirstMessage()) {\n        if (!HEADinfo) {\n          throw new Error(`No latest HEAD for ${contractID} when attempting to process entry with previous HEAD ${entryPreviousHEAD} at height ${entryHeight}`)\n        }\n        const { HEAD: contractHEAD, previousKeyOp: contractPreviousKeyOp, height: contractHeight } = HEADinfo\n        if (entryPreviousHEAD !== contractHEAD) {\n          console.warn(`[chelonia.db] bad previousHEAD: ${entryPreviousHEAD}! Expected: ${contractHEAD} for contractID: ${contractID}`)\n          throw new ChelErrorDBBadPreviousHEAD(`bad previousHEAD: ${entryPreviousHEAD}. Expected ${contractHEAD} for contractID: ${contractID}`)\n        } else if (entryPreviousKeyOp !== contractPreviousKeyOp) {\n          console.error(`[chelonia.db] bad previousKeyOp: ${entryPreviousKeyOp}! Expected: ${contractPreviousKeyOp} for contractID: ${contractID}`)\n          throw new ChelErrorDBBadPreviousHEAD(`bad previousKeyOp: ${entryPreviousKeyOp}. Expected ${contractPreviousKeyOp} for contractID: ${contractID}`)\n        } else if (!Number.isSafeInteger(entryHeight) || entryHeight !== (contractHeight + 1)) {\n          console.error(`[chelonia.db] bad height: ${entryHeight}! Expected: ${contractHeight + 1} for contractID: ${contractID}`)\n          throw new ChelErrorDBBadPreviousHEAD(`[chelonia.db] bad height: ${entryHeight}! Expected: ${contractHeight + 1} for contractID: ${contractID}`)\n        }\n      } else {\n        if (HEADinfo) {\n          console.error(`[chelonia.db] bad previousHEAD: ${entryPreviousHEAD}! Expected: <null> for contractID: ${contractID}`)\n          throw new ChelErrorDBBadPreviousHEAD(`bad previousHEAD: ${entryPreviousHEAD}. Expected <null> for contractID: ${contractID}`)\n        } else if (entryHeight !== 0) {\n          console.error(`[chelonia.db] bad height: ${entryHeight}! Expected: 0 for contractID: ${contractID}`)\n          throw new ChelErrorDBBadPreviousHEAD(`[chelonia.db] bad height: ${entryHeight}! Expected: 0 for contractID: ${contractID}`)\n        }\n      }\n      await sbp('chelonia.db/set', entry.hash(), entry.serialize())\n      await sbp('chelonia.db/set', getLogHead(contractID), JSON.stringify({\n        HEAD: entry.hash(),\n        previousKeyOp: entry.isKeyOp() ? entry.hash() : entry.previousKeyOp(),\n        height: entry.height()\n      }))\n      console.debug(`[chelonia.db] HEAD for ${contractID} updated to:`, entry.hash())\n      await sbp('chelonia/db/setEntryMeta', contractID, entryHeight, {\n        // The hash is used for reverse lookups (height to CID)\n        hash: entry.hash(),\n        // The date isn't currently used, but will be used for filtering messages\n        date: new Date().toISOString(),\n        // isKeyOp is used for filtering messages (the actual filtering is\n        // done more efficiently a separate index key, but `isKeyOp` allows\n        // us to bootstrap this process without having to load the full message)\n        // The separate index key bears the prefix `_private_keyop_idx_`.\n        ...(entry.isKeyOp() && { isKeyOp: true })\n      })\n      return entry.hash()\n    } catch (e) {\n      if (e.name.includes('ErrorDB')) {\n        throw e // throw the specific type of ErrorDB instance\n      }\n      throw new ChelErrorDBConnection(`${e.name} during addEntry: ${e.message}`)\n    }\n  },\n  'chelonia/db/lastEntry': async function (contractID        )                     {\n    try {\n      const latestHEADinfo = await sbp('chelonia/db/latestHEADinfo', contractID)\n      if (!latestHEADinfo) throw new Error(`contract ${contractID} has no latest hash!`)\n      return sbp('chelonia/db/getEntry', latestHEADinfo.HEAD)\n    } catch (e) {\n      throw new ChelErrorDBConnection(`${e.name} during lastEntry: ${e.message}`)\n    }\n  }\n})     )          )\n", "'use strict'\n\nimport sbp, { domainFromSelector } from '@sbp/sbp'\nimport { handleFetchResult } from '~/frontend/controller/utils/misc.js'\nimport { multicodes } from '~/shared/functions.js'\nimport { cloneDeep, debounce, delay, has, pick, randomIntFromRange } from 'turtledash'\n                                                                                                                                                                                                                                                                             \nimport { SPMessage } from './SPMessage.js'\nimport { Secret } from './Secret.js'\nimport { INVITE_STATUS } from './constants.js'\nimport { deserializeKey, keyId, verifySignature } from '@chelonia/crypto'\nimport './db.js'\nimport { encryptedIncomingData, encryptedOutgoingData } from './encryptedData.js'\n                                                       \nimport { ChelErrorKeyAlreadyExists, ChelErrorResourceGone, ChelErrorUnrecoverable, ChelErrorWarning, ChelErrorDBBadPreviousHEAD, ChelErrorAlreadyProcessed, ChelErrorFetchServerTimeFailed, ChelErrorForkedChain } from './errors.js'\nimport { CONTRACTS_MODIFIED, CONTRACT_HAS_RECEIVED_KEYS, CONTRACT_IS_SYNCING, EVENT_HANDLED, EVENT_PUBLISHED, EVENT_PUBLISHING_ERROR } from './events.js'\nimport { buildShelterAuthorizationHeader, findKeyIdByName, findSuitablePublicKeyIds, findSuitableSecretKeyId, getContractIDfromKeyId, keyAdditionProcessor, logEvtError, recreateEvent, validateKeyPermissions, validateKeyAddPermissions, validateKeyDelPermissions, validateKeyUpdatePermissions } from './utils.js'\nimport { isSignedData, signedIncomingData } from './signedData.js'\n// import 'ses'\n\n// Used for temporarily storing the missing decryption key IDs in a given\n// message\nconst missingDecryptionKeyIdsMap = new WeakMap()\n\nconst getMsgMeta = function (message           , contractID        , state        , index         ) {\n  const signingKeyId = message.signingKeyId()\n  let innerSigningKeyId          = null\n  const config = this.config\n\n  const result = {\n    signingKeyId,\n    get signingContractID () {\n      return getContractIDfromKeyId(contractID, signingKeyId, state)\n    },\n    get innerSigningKeyId () {\n      if (innerSigningKeyId === null) {\n        const value = message.message()\n        const data = config.unwrapMaybeEncryptedData(value)\n        if (data?.data && isSignedData(data.data)) {\n          innerSigningKeyId = (data.data     ).signingKeyId\n        } else {\n          innerSigningKeyId = undefined\n        }\n        return innerSigningKeyId\n      }\n    },\n    get innerSigningContractID () {\n      return getContractIDfromKeyId(contractID, result.innerSigningKeyId, state)\n    },\n    index\n  }\n\n  return result\n}\n\nconst keysToMap = function (keys_                                  , height        , authorizedKeys         )         {\n  // Using cloneDeep to ensure that the returned object is serializable\n  // Keys in a SPMessage may not be serializable (i.e., supported by the\n  // structured clone algorithm) when they contain encryptedIncomingData\n  const keys = keys_.map((key) => {\n    const data = this.config.unwrapMaybeEncryptedData(key)\n    if (!data) return undefined\n    if (data.encryptionKeyId) {\n      data.data._private = data.encryptionKeyId\n    }\n    return ((data.data     )       )\n  }).filter(Boolean)\n\n  const keysCopy = cloneDeep(keys)\n  return Object.fromEntries(keysCopy.map((key) => {\n    key._notBeforeHeight = height\n    if (authorizedKeys?.[key.id]) {\n      if (authorizedKeys[key.id]._notAfterHeight == null) {\n        throw new ChelErrorKeyAlreadyExists(`Cannot set existing unrevoked key: ${key.id}`)\n      }\n      // If the key was get previously, preserve its _notBeforeHeight\n      // NOTE: (SECURITY) This may allow keys for periods for which it wasn't\n      // supposed to be active. This is a trade-off for simplicity, instead of\n      // considering discrete periods, which is the correct solution\n      // Discrete ranges *MUST* be implemented because they impact permissions\n      key._notBeforeHeight = Math.min(height, authorizedKeys[key.id]._notBeforeHeight ?? 0)\n    } else {\n      key._notBeforeHeight = height\n    }\n    delete key._notAfterHeight\n    return [key.id, key]\n  }))\n}\n\nconst keyRotationHelper = (contractID        , state        , config        , updatedKeysMap        , requiredPermissions          , outputSelector        , outputMapper                                 , internalSideEffectStack        ) => {\n  if (!internalSideEffectStack || !Array.isArray(state._volatile?.watch)) return\n\n  const rootState = sbp(config.stateSelector)\n  const watchMap = Object.create(null)\n\n  state._volatile.watch.forEach(([name, cID]) => {\n    if (!updatedKeysMap[name] || watchMap[cID] === null) {\n      return\n    }\n    if (!watchMap[cID]) {\n      if (!rootState.contracts[cID]?.type || !findSuitableSecretKeyId(rootState[cID], [SPMessage.OP_KEY_UPDATE], ['sig'])) {\n        watchMap[cID] = null\n        return\n      }\n\n      watchMap[cID] = []\n    }\n\n    watchMap[cID].push(name)\n  })\n\n  Object.entries((watchMap        )).forEach(([cID, names]) => {\n    if (!Array.isArray(names) || !names.length) return\n\n    const [keyNamesToUpdate, signingKeyId] = names.map((name) => {\n      const foreignContractKey = rootState[cID]?._vm?.authorizedKeys?.[updatedKeysMap[name].oldKeyId]\n\n      if (!foreignContractKey) return undefined\n\n      const signingKeyId = findSuitableSecretKeyId(rootState[cID], requiredPermissions, ['sig'], foreignContractKey.ringLevel)\n\n      if (signingKeyId) {\n        return [[name, foreignContractKey.name], signingKeyId, rootState[cID]._vm.authorizedKeys[signingKeyId].ringLevel]\n      }\n\n      return undefined\n    }).filter(Boolean).reduce((acc, [name, signingKeyId, ringLevel]) => {\n      // $FlowFixMe\n      acc[0].push(name)\n      return ringLevel < acc[2] ? [acc[0], signingKeyId, ringLevel] : acc\n    }, [[], undefined, Number.POSITIVE_INFINITY])\n\n    if (!signingKeyId) return\n\n    // Send output based on keyNamesToUpdate, signingKeyId\n    const contractName = rootState.contracts[cID]?.type\n\n    internalSideEffectStack?.push(() => {\n      // We can't await because it'll block on a different contract, which\n      // is possibly waiting on this current contract.\n      sbp(outputSelector, {\n        contractID: cID,\n        contractName,\n        data: keyNamesToUpdate.map(outputMapper).map((v) => {\n          return v\n        }),\n        signingKeyId\n      }).catch((e) => {\n        console.warn(`Error mirroring key operation (${outputSelector}) from ${contractID} to ${cID}: ${e?.message || e}`)\n      })\n    })\n  })\n}\n\n// export const FERAL_FUNCTION = Function\n\nexport default (sbp('sbp/selectors/register', {\n  //     DO NOT CALL ANY OF THESE YOURSELF!\n  'chelonia/private/state': function () {\n    return this.state\n  },\n  'chelonia/private/invoke': function (instance, invocation) {\n    // If this._instance !== instance (i.e., chelonia/reset was called)\n    if (this._instance !== instance) {\n      console.info('[\\'chelonia/private/invoke] Not proceeding with invocation as Chelonia was restarted', { invocation })\n      return\n    }\n    if (Array.isArray(invocation)) {\n      return sbp(...invocation)\n    } else if (typeof invocation === 'function') {\n      return invocation()\n    } else {\n      throw new TypeError(`[chelonia/private/invoke] Expected invocation to be an array or a function. Saw ${typeof invocation} instead.`)\n    }\n  },\n  'chelonia/private/queueEvent': function (queueName, invocation) {\n    return sbp('okTurtles.eventQueue/queueEvent', queueName, ['chelonia/private/invoke', this._instance, invocation])\n  },\n  'chelonia/private/verifyManifestSignature': function (contractName        , manifestHash        , manifest        ) {\n    // We check that the manifest contains a 'signature' field with the correct\n    // shape\n    if (!has(manifest, 'signature') || typeof manifest.signature.keyId !== 'string' || typeof manifest.signature.value !== 'string') {\n      throw new Error(`Invalid or missing signature field for manifest ${manifestHash} (named ${contractName})`)\n    }\n\n    // Now, start the signature verification process\n    const rootState = sbp(this.config.stateSelector)\n    if (!has(rootState, 'contractSigningKeys')) {\n      this.config.reactiveSet(rootState, 'contractSigningKeys', Object.create(null))\n    }\n    // Because `contractName` comes from potentially unsafe sources (for\n    // instance, from `processMessage`), the key isn't used directly because\n    // it could overlap with current or future 'special' key names in JavaScript,\n    // such as `prototype`, `__proto__`, etc. We also can't guarantee that the\n    // `contractSigningKeys` always has a null prototype, and, because of the\n    // way we manage state, neither can we use `Map`. So, we use prefix for the\n    // lookup key that's unlikely to ever be part of a special JS name.\n    const contractNameLookupKey = `name:${contractName}`\n    // If the contract name has been seen before, validate its signature now\n    let signatureValidated = false\n    if (process.env.UNSAFE_TRUST_ALL_MANIFEST_SIGNING_KEYS !== 'true' && has(rootState.contractSigningKeys, contractNameLookupKey)) {\n      console.info(`[chelonia] verifying signature for ${manifestHash} with an existing key`)\n      if (!has(rootState.contractSigningKeys[contractNameLookupKey], manifest.signature.keyId)) {\n        console.error(`The manifest with ${manifestHash} (named ${contractName}) claims to be signed with a key with ID ${manifest.signature.keyId}, which is not trusted. The trusted key IDs for this name are:`, Object.keys(rootState.contractSigningKeys[contractNameLookupKey]))\n        throw new Error(`Invalid or missing signature in manifest ${manifestHash} (named ${contractName}). It claims to be signed with a key with ID ${manifest.signature.keyId}, which has not been authorized for this contract before.`)\n      }\n      const signingKey = rootState.contractSigningKeys[contractNameLookupKey][manifest.signature.keyId]\n      verifySignature(signingKey, manifest.body + manifest.head, manifest.signature.value)\n      console.info(`[chelonia] successful signature verification for ${manifestHash} (named ${contractName}) using the already-trusted key ${manifest.signature.keyId}.`)\n      signatureValidated = true\n    }\n    // Otherwise, when this is a yet-unseen contract, we parse the body to\n    // see its allowed signers to trust on first-use (TOFU)\n    const body = JSON.parse(manifest.body)\n    // If we don't have a list of authorized signatures yet, verify this\n    // contract's signature and set the auhorized signing keys\n    if (!signatureValidated) {\n      console.info(`[chelonia] verifying signature for ${manifestHash} (named ${contractName}) for the first time`)\n      if (!has(body, 'signingKeys') || !Array.isArray(body.signingKeys)) {\n        throw new Error(`Invalid manifest file ${manifestHash} (named ${contractName}). Its body doesn't contain a 'signingKeys' list'`)\n      }\n      let contractSigningKeys                          \n      try {\n        contractSigningKeys = Object.fromEntries(body.signingKeys.map((serializedKey) => {\n          return [\n            keyId(serializedKey),\n            serializedKey\n          ]\n        }))\n      } catch (e) {\n        console.error(`[chelonia] Error parsing the public keys list for ${manifestHash} (named ${contractName})`, e)\n        throw e\n      }\n      if (!has(contractSigningKeys, manifest.signature.keyId)) {\n        throw new Error(`Invalid or missing signature in manifest ${manifestHash} (named ${contractName}). It claims to be signed with a key with ID ${manifest.signature.keyId}, which is not listed in its 'signingKeys' field.`)\n      }\n      verifySignature(contractSigningKeys[manifest.signature.keyId], manifest.body + manifest.head, manifest.signature.value)\n      console.info(`[chelonia] successful signature verification for ${manifestHash} (named ${contractName}) using ${manifest.signature.keyId}. The following key IDs will now be trusted for this contract name`, Object.keys(contractSigningKeys))\n      signatureValidated = true\n      rootState.contractSigningKeys[contractNameLookupKey] = contractSigningKeys\n    }\n\n    // If verification was successful, return the parsed body to make the newly-\n    // loaded contract available\n    return body\n  },\n  'chelonia/private/loadManifest': async function (contractName        , manifestHash        ) {\n    if (!contractName || typeof contractName !== 'string') {\n      throw new Error('Invalid or missing contract name')\n    }\n    if (this.manifestToContract[manifestHash]) {\n      console.warn('[chelonia]: already loaded manifest', manifestHash)\n      return\n    }\n    const manifestSource = await sbp('chelonia/out/fetchResource', manifestHash, { code: multicodes.SHELTER_CONTRACT_MANIFEST })\n    const manifest = JSON.parse(manifestSource)\n    const body = sbp('chelonia/private/verifyManifestSignature', contractName, manifestHash, manifest)\n    if (body.name !== contractName) {\n      throw new Error(`Mismatched contract name. Expected ${contractName} but got ${body.name}`)\n    }\n    const contractInfo = (this.config.contracts.defaults.preferSlim && body.contractSlim) || body.contract\n    console.info(`[chelonia] loading contract '${contractInfo.file}'@'${body.version}' from manifest: ${manifestHash}`)\n    const source = await sbp('chelonia/out/fetchResource', contractInfo.hash, { code: multicodes.SHELTER_CONTRACT_TEXT })\n    const reduceAllow = (acc, v) => { acc[v] = true; return acc }\n    const allowedSels = ['okTurtles.events/on', 'chelonia/defineContract', 'chelonia/out/keyRequest']\n      .concat(this.config.contracts.defaults.allowedSelectors)\n      .reduce(reduceAllow, {})\n    const allowedDoms = this.config.contracts.defaults.allowedDomains\n      .reduce(reduceAllow, {})\n    const contractSBP = (selector        , ...args) => {\n      const domain = domainFromSelector(selector)\n      if (selector.startsWith(contractName + '/')) {\n        selector = `${manifestHash}/${selector}`\n      }\n      if (allowedSels[selector] || allowedDoms[domain]) {\n        return sbp(selector, ...args)\n      } else {\n        console.error('[chelonia] selector not on allowlist', { selector, allowedSels, allowedDoms })\n        throw new Error(`[chelonia] selector not on allowlist: '${selector}'`)\n      }\n    }\n    // const saferEval: Function = new FERAL_FUNCTION(`\n    // eslint-disable-next-line no-new-func\n    const saferEval           = new Function(`\n      return function (globals) {\n        // almost a real sandbox\n        // stops (() => this)().fetch\n        // needs additional step of locking down Function constructor to stop:\n        // new (()=>{}).constructor(\"console.log(typeof this.fetch)\")()\n        globals.self = globals\n        globals.globalThis = globals\n        with (new Proxy(globals, {\n          get (o, p) { return o[p] },\n          has (o, p) { /* console.log('has', p); */ return true }\n        })) {\n          (function () {\n            'use strict'\n            ${source}\n          })()\n        }\n      }\n    `)()\n    // TODO: lock down Function constructor! could just use SES lockdown()\n    // or do our own version of it.\n    // https://github.com/endojs/endo/blob/master/packages/ses/src/tame-function-constructors.js\n    this.defContractSBP = contractSBP\n    this.defContractManifest = manifestHash\n    // contracts will also be signed, so even if sandbox breaks we still have protection\n    saferEval({\n      // pass in globals that we want access to by default in the sandbox\n      // note: you can undefine these by setting them to undefined in exposedGlobals\n      crypto: {\n        // $FlowFixMe\n        getRandomValues: (v) => globalThis.crypto.getRandomValues(v)\n      },\n      ...(typeof window === 'object' && window && {\n        alert: window.alert.bind(window),\n        confirm: window.confirm.bind(window),\n        prompt: window.prompt.bind(window)\n      }),\n      isNaN,\n      console,\n      Object,\n      Error,\n      TypeError,\n      RangeError,\n      Math,\n      Symbol,\n      Date,\n      Array,\n      // $FlowFixMe\n      BigInt,\n      Boolean,\n      Buffer,\n      String,\n      Number,\n      Int8Array,\n      Int16Array,\n      Int32Array,\n      Uint8Array,\n      Uint16Array,\n      Uint32Array,\n      Float32Array,\n      Float64Array,\n      ArrayBuffer,\n      JSON,\n      RegExp,\n      parseFloat,\n      parseInt,\n      Promise,\n      Function,\n      Map,\n      WeakMap,\n      ...this.config.contracts.defaults.exposedGlobals,\n      require: (dep) => {\n        return dep === '@sbp/sbp'\n          ? contractSBP\n          : this.config.contracts.defaults.modules[dep]\n      },\n      sbp: contractSBP,\n      fetchServerTime: async (fallback           = true) => {\n        // If contracts need the current timestamp (for example, for metadata 'createdDate')\n        // they must call this function so that clients are kept synchronized to the server's\n        // clock, for consistency, so that if one client's clock is off, it doesn't conflict\n        // with other client's clocks.\n        // See: https://github.com/okTurtles/group-income/issues/531\n        try {\n          const response = await this.config.fetch(`${this.config.connectionURL}/time`, { signal: this.abortController.signal })\n          return handleFetchResult('text')(response)\n        } catch (e) {\n          console.warn('[fetchServerTime] Error', e)\n          if (fallback) {\n            return new Date(sbp('chelonia/time')).toISOString()\n          }\n          throw new ChelErrorFetchServerTimeFailed('Can not fetch server time. Please check your internet connection.')\n        }\n      }\n    })\n    if (contractName !== this.defContract.name) {\n      throw new Error(`Invalid contract name for manifest ${manifestHash}. Expected ${contractName} but got ${this.defContract.name}`)\n    }\n    this.defContractSelectors.forEach(s => { allowedSels[s] = true })\n    this.manifestToContract[manifestHash] = {\n      slim: contractInfo === body.contractSlim,\n      info: contractInfo,\n      contract: this.defContract\n    }\n  },\n  // Warning: avoid using this unless you know what you're doing. Prefer using /remove.\n  'chelonia/private/removeImmediately': function (contractID        , params                                            ) {\n    const state = sbp(this.config.stateSelector)\n    const contractName = state.contracts[contractID]?.type\n    if (!contractName) {\n      console.error('[chelonia/private/removeImmediately] Missing contract name for contract', { contractID })\n      return\n    }\n\n    const manifestHash = this.config.contracts.manifests[contractName]\n    if (manifestHash) {\n      const destructor = `${manifestHash}/${contractName}/_cleanup`\n      // Check if a destructor is defined\n      if (sbp('sbp/selectors/fn', destructor)) {\n        // And call it\n        try {\n          sbp(destructor, { contractID, resync: !!params?.resync, state: state[contractID] })\n        } catch (e) {\n          console.error(`[chelonia/private/removeImmediately] Error at destructor for ${contractID}`, e)\n        }\n      }\n    }\n\n    if (params?.resync) {\n      // If re-syncing, keep the reference count\n      Object.keys(state.contracts[contractID])\n        .filter((k) => k !== 'references')\n        .forEach((k) => this.config.reactiveDel(state.contracts[contractID], k))\n      // If re-syncing, keep state._volatile.watch\n      Object.keys(state[contractID])\n        .filter((k) => k !== '_volatile')\n        .forEach((k) => this.config.reactiveDel(state[contractID], k))\n      if (state[contractID]._volatile) {\n        Object.keys(state[contractID]._volatile)\n          .filter((k) => k !== 'watch')\n          .forEach((k) => this.config.reactiveDel(state[contractID]._volatile, k))\n      }\n    } else {\n      delete this.ephemeralReferenceCount[contractID]\n      if (params?.permanent) {\n        // Keep a 'null' state to remember permanently-deleted contracts\n        // (e.g., when they've been removed from the server)\n        this.config.reactiveSet(state.contracts, contractID, null)\n      } else {\n        this.config.reactiveDel(state.contracts, contractID)\n      }\n      this.config.reactiveDel(state, contractID)\n    }\n\n    this.subscriptionSet.delete(contractID)\n    // calling this will make pubsub unsubscribe for events on `contractID`\n    sbp('okTurtles.events/emit', CONTRACTS_MODIFIED, Array.from(this.subscriptionSet), {\n      added: [],\n      removed: [contractID],\n      permanent: params?.permanent,\n      resync: params?.resync\n    })\n  },\n  // used by, e.g. 'chelonia/contract/wait'\n  'chelonia/private/noop': function () {},\n  'chelonia/private/out/sync': function (contractIDs                   , params                                        )             {\n    const listOfIds = typeof contractIDs === 'string' ? [contractIDs] : contractIDs\n    const forcedSync = !!params?.force\n    return Promise.all(listOfIds.map(contractID => {\n      // If this isn't a forced sync and we're already subscribed to the contract,\n      // only wait on the event queue (as events should come over the subscription)\n      if (!forcedSync && this.subscriptionSet.has(contractID)) {\n        const rootState = sbp(this.config.stateSelector)\n        // However, if the contract has been marked as dirty (meaning its state\n        // could be wrong due to newly received encryption keys), sync it anyhow\n        // (i.e., disregard the force flag and proceed to sync the contract)\n        if (!rootState[contractID]?._volatile?.dirty) {\n          return sbp('chelonia/private/queueEvent', contractID, ['chelonia/private/noop'])\n        }\n      }\n      // enqueue this invocation in a serial queue to ensure\n      // handleEvent does not get called on contractID while it's syncing,\n      // but after it's finished. This is used in tandem with\n      // queuing the 'chelonia/private/in/handleEvent' selector, defined below.\n      // This prevents handleEvent getting called with the wrong previousHEAD for an event.\n      return sbp('chelonia/private/queueEvent', contractID, [\n        'chelonia/private/in/syncContract', contractID, params\n      ]).catch((err) => {\n        console.error(`[chelonia] failed to sync ${contractID}:`, err)\n        throw err // re-throw the error\n      })\n    }))\n  },\n  'chelonia/private/out/publishEvent': function (entry           , { maxAttempts = 5, headers, billableContractID, bearer } = {}, hooks) {\n    const contractID = entry.contractID()\n    const originalEntry = entry\n\n    return sbp('chelonia/private/queueEvent', `publish:${contractID}`, async () => {\n      let attempt = 1\n      let lastAttemptedHeight\n      // prepublish is asynchronous to allow for cleanly sending messages to\n      // different contracts\n      await hooks?.prepublish?.(entry)\n\n      const onreceivedHandler = (_contractID        , message           ) => {\n        if (entry.hash() === message.hash()) {\n          sbp('okTurtles.events/off', EVENT_HANDLED, onreceivedHandler)\n          hooks.onprocessed(entry)\n        }\n      }\n\n      if (typeof hooks?.onprocessed === 'function') {\n        sbp('okTurtles.events/on', EVENT_HANDLED, onreceivedHandler)\n      }\n\n      // auto resend after short random delay\n      // https://github.com/okTurtles/group-income/issues/608\n      while (true) {\n      // Queued event to ensure that we send the event with whatever the\n      // 'latest' state may be for that contract (in case we were receiving\n      // something over the web socket)\n      // This also ensures that the state doesn't change while reading it\n        lastAttemptedHeight = entry.height()\n        const newEntry = await sbp('chelonia/private/queueEvent', contractID, async () => {\n          const rootState = sbp(this.config.stateSelector)\n          const state = rootState[contractID]\n          const isFirstMessage = entry.isFirstMessage()\n\n          if (!state && !isFirstMessage) {\n            console.info(`[chelonia] Not sending message as contract state has been removed: ${entry.description()}`)\n            return\n          }\n\n          if (hooks?.preSendCheck) {\n            if (!await hooks.preSendCheck(entry, state)) {\n              console.info(`[chelonia] Not sending message as preSendCheck hook returned non-truish value: ${entry.description()}`)\n              return\n            }\n          }\n\n          // Process message to ensure that it is valid. Should this throw,\n          // we propagate the error. Calling `processMessage` will perform\n          // validation by checking signatures, well-formedness and, in the case\n          // of actions, by also calling both the `validate` method (which\n          // doesn't mutate the state) and the `process` method (which could\n          // mutate the state).\n          // `SPMessage` objects have an implicit `direction` field that's set\n          // based on how the object was constructed. For messages that will be\n          // sent to the server (this case), `direction` is set to `outgoing`.\n          // This `direction` affects how certain errors are reported during\n          // processing, and is also exposed to contracts (which could then\n          // alter their behavior based on this) to support some features (such\n          // as showing users that a certain message is 'pending').\n          // Validation ensures that we don't write messages known to be invalid.\n          // Although those invalid messages will be ignored if sent anyhow,\n          // sending them is wasteful.\n          // The only way to know for sure if a message is valid or not is using\n          // the same logic that would be used if the message was received,\n          // hence the call to `processMessage`. Validation requires having the\n          // state and all mutations that would be applied. For example, when\n          // joining a chatroom, this is usually done by sending an OP_ATOMIC\n          // that contains OP_KEY_ADD and OP_ACTION_ENCRYPTED. Correctly\n          // validating this operation requires applying the OP_KEY_ADD to the\n          // state in order to know whether OP_ACTION_ENCRYPTED has a valid\n          // signature or not.\n          // We also rely on this logic to keep different contracts in sync\n          // when there are side-effects. For example, the side-effect in a\n          // group for someone joining a chatroom can call the `join` action\n          // on the chatroom unconditionally, since validation will prevent\n          // the message from being sent.\n          // Because of this, 'chelonia/private/in/processMessage' SHOULD NOT\n          // change the global Chelonia state and it MUST NOT call any\n          // side-effects or change the global state in a way that affects\n          // the meaning of any future messages or successive invocations.\n          // Note: mutations to the contract state, if any, are immediately\n          // discarded (see the temporary object created using `cloneDeep`).\n          await sbp('chelonia/private/in/processMessage', entry, cloneDeep(state || {}))\n\n          // if this isn't the first event (i.e., OP_CONTRACT), recreate and\n          // resend message\n          // This is mainly to set height and previousHEAD. For the first event,\n          // this doesn't need to be done because previousHEAD is always undefined\n          // and height is always 0.\n          // We always call recreateEvent because we may have received new events\n          // in the web socket\n          if (!isFirstMessage) {\n            return recreateEvent(entry, state, rootState.contracts[contractID])\n          }\n\n          return entry\n        })\n\n        // If there is no event to send, return\n        if (!newEntry) return\n\n        await hooks?.beforeRequest?.(newEntry, entry)\n        entry = newEntry\n\n        const r = await this.config.fetch(`${this.config.connectionURL}/event`, {\n          method: 'POST',\n          body: entry.serialize(),\n          headers: {\n            ...headers,\n            ...bearer && {\n              'Authorization': `Bearer ${bearer}`\n            },\n            ...billableContractID && {\n              'Authorization': buildShelterAuthorizationHeader.call(this, billableContractID)\n            },\n            'Content-Type': 'text/plain'\n          },\n          signal: this.abortController.signal\n        })\n        if (r.ok) {\n          await hooks?.postpublish?.(entry)\n          return entry\n        }\n        try {\n          if (r.status === 409) {\n            if (attempt + 1 > maxAttempts) {\n              console.error(`[chelonia] failed to publish ${entry.description()} after ${attempt} attempts`, entry)\n              throw new Error(`publishEvent: ${r.status} - ${r.statusText}. attempt ${attempt}`)\n            }\n            // create new entry\n            const randDelay = randomIntFromRange(0, 1500)\n            console.warn(`[chelonia] publish attempt ${attempt} of ${maxAttempts} failed. Waiting ${randDelay} msec before resending ${entry.description()}`)\n            attempt += 1\n            await delay(randDelay) // wait randDelay ms before sending it again\n\n            // TODO: The [pubsub] code seems to miss events that happened between\n            // a call to sync and the subscription time. This is a temporary measure\n            // to handle this until [pubsub] is updated.\n            if (!entry.isFirstMessage() && entry.height() === lastAttemptedHeight) {\n              await sbp('chelonia/private/out/sync', contractID, { force: true })\n            }\n          } else {\n            const message = (await r.json())?.message\n            console.error(`[chelonia] ERROR: failed to publish ${entry.description()}: ${r.status} - ${r.statusText}: ${message}`, entry)\n            throw new Error(`publishEvent: ${r.status} - ${r.statusText}: ${message}`)\n          }\n        } catch (e) {\n          sbp('okTurtles.events/off', EVENT_HANDLED, onreceivedHandler)\n\n          throw e\n        }\n      }\n    }).then((entry) => {\n      sbp('okTurtles.events/emit', EVENT_PUBLISHED, { contractID, message: entry, originalMessage: originalEntry })\n      return entry\n    }).catch((e) => {\n      sbp('okTurtles.events/emit', EVENT_PUBLISHING_ERROR, { contractID, message: entry, originalMessage: originalEntry, error: e })\n      throw e\n    })\n  },\n  'chelonia/private/out/latestHEADinfo': function (contractID        ) {\n    return this.config.fetch(`${this.config.connectionURL}/latestHEADinfo/${contractID}`, {\n      cache: 'no-store',\n      signal: this.abortController.signal\n    }).then(handleFetchResult('json'))\n  },\n  'chelonia/private/postKeyShare': function (contractID, previousVolatileState, signingKey) {\n    const cheloniaState = sbp(this.config.stateSelector)\n    const targetState = cheloniaState[contractID]\n\n    if (!targetState) return\n\n    if (previousVolatileState && has(previousVolatileState, 'watch')) {\n      if (!targetState._volatile) this.config.reactiveSet(targetState, '_volatile', Object.create(null))\n      if (!targetState._volatile.watch) {\n        this.config.reactiveSet(targetState._volatile, 'watch', previousVolatileState.watch)\n      } else if (targetState._volatile.watch !== previousVolatileState.watch) {\n        previousVolatileState.watch.forEach((pWatch) => {\n          if (!targetState._volatile.watch.some((tWatch) => {\n            return (tWatch[0] === pWatch[0]) && (tWatch[1] === pWatch[1])\n          })) {\n            targetState._volatile.watch.push(pWatch)\n          }\n        })\n      }\n    }\n\n    if (!Array.isArray(targetState._volatile?.pendingKeyRequests)) return\n\n    this.config.reactiveSet(\n      targetState._volatile, 'pendingKeyRequests',\n      targetState._volatile.pendingKeyRequests.filter((pkr) =>\n        pkr?.name !== signingKey.name\n      )\n    )\n  },\n  'chelonia/private/in/processMessage': async function (message           , state        , internalSideEffectStack        , contractName         ) {\n    const [opT, opV] = message.op()\n    const hash = message.hash()\n    const height = message.height()\n    const contractID = message.contractID()\n    const manifestHash = message.manifest()\n    const signingKeyId = message.signingKeyId()\n    const direction = message.direction()\n    const config = this.config\n    const self = this\n    const opName = Object.entries(SPMessage).find(([, y]) => y === opT)?.[0]\n    console.debug('PROCESSING OPCODE:', opName, 'to', contractID)\n    if (state?._volatile?.dirty) {\n      console.debug('IGNORING OPCODE BECAUSE CONTRACT STATE IS MARKED AS DIRTY.', 'OPCODE:', opName, 'CONTRACT:', contractID)\n      return\n    }\n    if (!state._vm) state._vm = Object.create(null)\n    const opFns                                                = {\n      /*\n        There are two types of \"errors\" that we need to consider:\n        1. \"Ignoring\" errors\n        2. \"Failure\" errors\n        Example: OP_KEY_ADD\n        1. IGNORING: an error is thrown because we wanted to add a key but the key we wanted to add is already there. This is not a hard error, it's an ignoring error. We don't care that the operation failed in this case because the intent was accomplished.\n        2. FAILURE: an error is thrown while attempting to add a key that doesn't exist.\n        Example: OP_ACTION_ENCRYPTED\n        1. IGNORING: An error is thrown because we don't have the key to decrypt the action. We ignore it.\n        2. FAILURE: An error is thrown by the process function during processing.\n        Handling these in OP_ATOMIC\n        \u2022 ALL errors of class \"IGNORING\" should be ignored. They should not impact our ability to process the rest of the operations in the OP_ATOMIC. No matter how many of these are thrown, it doesn't affect the rest of the operations.\n        \u2022 ANY error of class \"FAILURE\" will call the rest of the operations to fail and the state to be reverted to prior to the OP_ATOMIC. No side-effects should be run. Because an intention failed.\n      */\n      async [SPMessage.OP_ATOMIC] (v            ) {\n        for (let i = 0; i < v.length; i++) {\n          const u = v[i]\n          try {\n            if (u[0] === SPMessage.OP_ATOMIC) throw new Error('Cannot nest OP_ATOMIC')\n            if (!validateKeyPermissions(message, config, state, signingKeyId, u[0], u[1])) {\n              throw new Error('Inside OP_ATOMIC: no matching signing key was defined')\n            }\n            await opFns[u[0]](u[1])\n          } catch (e_) {\n            const e = (e_        )\n            if (e && typeof e === 'object') {\n              if (e.name === 'ChelErrorDecryptionKeyNotFound') {\n                console.warn(`[chelonia] [OP_ATOMIC] WARN '${e.name}' in processMessage for ${message.description()}: ${e.message}`, e, message.serialize())\n                if (e.cause) {\n                  const missingDecryptionKeyIds = missingDecryptionKeyIdsMap.get(message)\n                  if (missingDecryptionKeyIds) {\n                    missingDecryptionKeyIds.add(e.cause)\n                  } else {\n                    missingDecryptionKeyIdsMap.set(message, new Set([e.cause]))\n                  }\n                }\n                continue\n              } else {\n                logEvtError(message, `[chelonia] [OP_ATOMIC] ERROR '${e.name}' in processMessage for ${message.description()}: ${e.message || e}`, e, message.serialize())\n              }\n              console.warn(`[chelonia] [OP_ATOMIC] Error processing ${message.description()}: ${message.serialize()}. Any side effects will be skipped!`)\n              if (config.strictProcessing) {\n                throw e\n              }\n              config.hooks.processError?.(e, message, getMsgMeta.call(self, message, contractID, state))\n              if (e.name === 'ChelErrorWarning') continue\n            } else {\n              logEvtError(message, 'Inside OP_ATOMIC: Non-object or null error thrown', contractID, message, i, e)\n            }\n            throw e\n          }\n        }\n      },\n      [SPMessage.OP_CONTRACT] (v              ) {\n        state._vm.type = v.type\n        const keys = keysToMap.call(self, v.keys, height)\n        state._vm.authorizedKeys = keys\n        // Loop through the keys in the contract and try to decrypt all of the private keys\n        // Example: in the identity contract you have the IEK, IPK, CSK, and CEK.\n        // When you login you have the IEK which is derived from your password, and you\n        // will use it to decrypt the rest of the keys which are encrypted with that.\n        // Specifically, the IEK is used to decrypt the CSKs and the CEKs, which are\n        // the encrypted versions of the CSK and CEK.\n        keyAdditionProcessor.call(self, message, hash, v.keys, state, contractID, signingKey, internalSideEffectStack)\n      },\n      [SPMessage.OP_ACTION_ENCRYPTED] (v                     ) {\n        if (config.skipActionProcessing) {\n          if (!config.skipDecryptionAttempts) {\n            console.log('OP_ACTION_ENCRYPTED: skipped action processing')\n          }\n          return\n        }\n        return opFns[SPMessage.OP_ACTION_UNENCRYPTED](v.valueOf())\n      },\n      async [SPMessage.OP_ACTION_UNENCRYPTED] (v                       ) {\n        if (!config.skipActionProcessing) {\n          let innerSigningKeyId                           \n          if (isSignedData(v)) {\n            innerSigningKeyId = (v     ).signingKeyId\n            v = (v     ).valueOf()\n          }\n\n          const { data, meta, action } = (v     )\n\n          if (!config.whitelisted(action)) {\n            throw new Error(`chelonia: action not whitelisted: '${action}'`)\n          }\n\n          await sbp(\n            `${manifestHash}/${action}/process`,\n            {\n              data,\n              meta,\n              hash,\n              height,\n              contractID,\n              direction: message.direction(),\n              signingKeyId,\n              get signingContractID () {\n                return getContractIDfromKeyId(contractID, signingKeyId, state)\n              },\n              innerSigningKeyId,\n              get innerSigningContractID () {\n                return getContractIDfromKeyId(contractID, innerSigningKeyId, state)\n              }\n            },\n            state\n          )\n        }\n      },\n      [SPMessage.OP_KEY_SHARE] (wv              ) {\n        // TODO: Prompt to user if contract not in pending\n\n        const data = config.unwrapMaybeEncryptedData(wv)\n        if (!data) return\n        const v = (data.data                   )\n\n        for (const key of v.keys) {\n          if (key.id && key.meta?.private?.content) {\n            if (!has(state._vm, 'sharedKeyIds')) state._vm.sharedKeyIds = []\n            if (!state._vm.sharedKeyIds.some((sK) => sK.id === key.id)) state._vm.sharedKeyIds.push({ id: key.id, contractID: v.contractID, height, keyRequestHash: v.keyRequestHash, keyRequestHeight: v.keyRequestHeight })\n          }\n        }\n\n        // If this is a response to an OP_KEY_REQUEST (marked by the\n        // presence of the keyRequestHash attribute), then we'll mark the\n        // key request as completed\n        // TODO: Verify that the keyRequestHash is what we expect (on the\n        // other contact's state, we should have a matching structure in\n        // state._volatile.pendingKeyRequests = [\n        //    { contractID: \"this\", name: \"name of this signingKeyId\", reference: \"this reference\", hash: \"KA\" }, ..., but we don't\n        // have a copy of the keyRequestHash (this would need a new\n        // message to ourselves in the KR process), so for now we trust\n        // that if it has keyRequestHash, it's a response to a request\n        // we sent.\n        // For similar reasons, we can't check pendingKeyRequests, because\n        // depending on how and in which order events are processed, it may\n        // not be available.\n        // ]\n        if (has(v, 'keyRequestHash') && state._vm.authorizedKeys[signingKeyId].meta?.keyRequest) {\n          state._vm.authorizedKeys[signingKeyId].meta.keyRequest.responded = hash\n        }\n\n        internalSideEffectStack?.push(async () => {\n          delete self.postSyncOperations[contractID]?.['pending-keys-for-' + v.contractID]\n\n          const cheloniaState = sbp(self.config.stateSelector)\n\n          const targetState = cheloniaState[v.contractID]\n          const missingDecryptionKeyIds = cheloniaState.contracts[v.contractID]?.missingDecryptionKeyIds\n\n          let newestEncryptionKeyHeight = Number.POSITIVE_INFINITY\n          for (const key of v.keys) {\n            if (key.id && key.meta?.private?.content) {\n              // Outgoing messages' keys are always transient\n              const transient = direction === 'outgoing' || key.meta.private.transient\n              if (\n                !sbp('chelonia/haveSecretKey', key.id, !transient)\n              ) {\n                try {\n                  const decrypted = key.meta.private.content.valueOf()\n                  sbp('chelonia/storeSecretKeys', new Secret([{\n                    key: deserializeKey(decrypted),\n                    transient\n                  }]))\n                  // If we've just received a known missing key (i.e., a key\n                  // that previously resulted in a decryption error), we know\n                  // our state is outdated and we need to re-sync the contract\n                  if (missingDecryptionKeyIds?.includes(key.id)) {\n                    newestEncryptionKeyHeight = Number.NEGATIVE_INFINITY\n                  } else if (\n                  // Otherwise, we make an educated guess on whether a re-sync\n                  // is needed based on the height.\n                    targetState?._vm?.authorizedKeys?.[key.id]?._notBeforeHeight != null &&\n                      Array.isArray(targetState._vm.authorizedKeys[key.id].purpose) &&\n                      targetState._vm.authorizedKeys[key.id].purpose.includes('enc')\n                  ) {\n                    newestEncryptionKeyHeight = Math.min(newestEncryptionKeyHeight, targetState._vm.authorizedKeys[key.id]._notBeforeHeight)\n                  }\n                } catch (e_) {\n                  const e = (e_        )\n                  if (e?.name === 'ChelErrorDecryptionKeyNotFound') {\n                    console.warn(`OP_KEY_SHARE (${hash} of ${contractID}) missing secret key: ${e.message}`,\n                      e)\n                  } else {\n                    // Using console.error instead of logEvtError because this\n                    // is a side-effect and not relevant for outgoing messages\n                    console.error(`OP_KEY_SHARE (${hash} of ${contractID}) error '${e.message || e}':`,\n                      e)\n                  }\n                }\n              }\n            }\n          }\n\n          // If an encryption key has been shared with _notBefore lower than the\n          // current height, then the contract must be resynced.\n          const mustResync = !!(newestEncryptionKeyHeight < cheloniaState.contracts[v.contractID]?.height)\n\n          if (mustResync) {\n            if (!has(targetState, '_volatile')) config.reactiveSet(targetState, '_volatile', Object.create(null))\n            config.reactiveSet(targetState._volatile, 'dirty', true)\n\n            if (!Object.keys(targetState).some((k) => k !== '_volatile')) {\n              // If the contract only has _volatile state, we don't force sync it\n              return\n            }\n\n            // Mark contracts that have foreign keys that have been received\n            // as dirty\n            // First, we group watched keys by key and contracts\n            const keyDict = Object.create(null)\n            targetState._volatile?.watch?.forEach(([keyName, contractID]) => {\n              if (!keyDict[keyName]) {\n                keyDict[keyName] = [contractID]\n                return\n              }\n              keyDict[keyName].push(contractID)\n            })\n            // Then, see which of those contracts need to be updated\n            // $FlowFixMe[incompatible-call]\n            const contractIdsToUpdate = Array.from(new Set(Object.entries(keyDict).flatMap(([keyName, contractIDs]) => {\n              const keyId = findKeyIdByName(targetState, keyName)\n              if (\n                // Does the key exist? (i.e., is it a current key)\n                keyId &&\n                // Is it an encryption key? (signing keys don't build up a\n                // potentially invalid state because the private key isn't\n                // required for validation; however, missing encryption keys\n                // prevent message processing)\n                targetState._vm.authorizedKeys[keyId].purpose.includes('enc') &&\n                // Is this a newly set key? (avoid re-syncing contracts that\n                // haven't been affected by the `OP_KEY_SHARE`)\n                targetState._vm.authorizedKeys[keyId]._notBeforeHeight >= newestEncryptionKeyHeight\n              ) {\n                return contractIDs\n              }\n              return []\n            })))\n            // Mark these contracts as dirty\n            contractIdsToUpdate.forEach((contractID) => {\n              const targetState = cheloniaState[contractID]\n              if (!targetState) return\n              if (!has(targetState, '_volatile')) config.reactiveSet(targetState, '_volatile', Object.create(null))\n              config.reactiveSet(targetState._volatile, 'dirty', true)\n            })\n\n            // Since we have received new keys, the current contract state might be wrong, so we need to remove the contract and resync\n            // Note: The following may be problematic when several tabs are open\n            // sharing the same state. This is more of a general issue in this\n            // situation, not limited to the following sequence of events\n            if (self.subscriptionSet.has(v.contractID)) {\n              const resync = sbp('chelonia/private/queueEvent', v.contractID, [\n                'chelonia/private/in/syncContract', v.contractID\n              ]).then(() => {\n                // Now, if we're subscribed to any of the contracts that were\n                // marked as dirty, re-sync them\n                sbp('chelonia/private/out/sync',\n                  contractIdsToUpdate.filter((contractID) => {\n                    return self.subscriptionSet.has(contractID)\n                  }),\n                  { force: true, resync: true }\n                ).catch(e => {\n                  // Using console.error instead of logEvtError because this\n                  // is a side-effect and not relevant for outgoing messages\n                  console.error('[chelonia] Error resyncing contracts with foreign key references after key rotation', e)\n                })\n              }).catch((e) => {\n                // Using console.error instead of logEvtError because this\n                // is a side-effect and not relevant for outgoing messages\n                console.error(`[chelonia] Error during sync for ${v.contractID} during OP_KEY_SHARE for ${contractID}`)\n                if (v.contractID === contractID) {\n                  throw e\n                }\n              })\n\n              // If the keys received were for the current contract, we can't\n              // use queueEvent as we're already on that same queue\n              if (v.contractID !== contractID) {\n                await resync\n              }\n            }\n          }\n\n          const previousVolatileState = targetState?._volatile\n          sbp('chelonia/private/queueEvent', v.contractID, ['chelonia/private/postKeyShare', v.contractID, mustResync ? previousVolatileState : null, signingKey])\n            .then(() => {\n            // The CONTRACT_HAS_RECEIVED_KEYS event is placed on the queue for\n            // the current contract so that calling\n            // 'chelonia/contract/waitingForKeyShareTo' will give correct results\n            // (i.e., the event is processed after the state is written)\n              sbp('chelonia/private/queueEvent', contractID, () => {\n                sbp('okTurtles.events/emit', CONTRACT_HAS_RECEIVED_KEYS, { contractID: v.contractID, sharedWithContractID: contractID, signingKeyId, get signingKeyName () { return state._vm?.authorizedKeys?.[signingKeyId]?.name } })\n              }).catch(e => {\n                // Using console.error instead of logEvtError because this\n                // is a side-effect and not relevant for outgoing messages\n                console.error(`[chelonia] Error while emitting the CONTRACT_HAS_RECEIVED_KEYS event for ${contractID}`, e)\n              })\n            })\n        })\n      },\n      [SPMessage.OP_KEY_REQUEST] (wv                ) {\n        const data = config.unwrapMaybeEncryptedData(wv)\n\n        // If we're unable to decrypt the OP_KEY_REQUEST, then still\n        // proceed to do accounting of invites\n        const v = data?.data || { contractID: '(private)', replyWith: { context: undefined }, request: '*' }\n\n        const originatingContractID = v.contractID\n\n        if (state._vm?.invites?.[signingKeyId]?.quantity != null) {\n          if (state._vm.invites[signingKeyId].quantity > 0) {\n            if ((--state._vm.invites[signingKeyId].quantity) <= 0) {\n              state._vm.invites[signingKeyId].status = INVITE_STATUS.USED\n            }\n          } else {\n            logEvtError(message, 'Ignoring OP_KEY_REQUEST because it exceeds allowed quantity: ' + originatingContractID)\n            return\n          }\n        }\n\n        if (state._vm?.invites?.[signingKeyId]?.expires != null) {\n          if (state._vm.invites[signingKeyId].expires < Date.now()) {\n            logEvtError(message, 'Ignoring OP_KEY_REQUEST because it expired at ' + state._vm.invites[signingKeyId].expires + ': ' + originatingContractID)\n            return\n          }\n        }\n\n        // If skipping porocessing or if the message is outgoing, there isn't\n        // anything else to do\n        if (config.skipActionProcessing || direction === 'outgoing') {\n          return\n        }\n\n        // Outgoing messages don't have a context attribute\n        if (!has(v.replyWith, 'context')) {\n          logEvtError(message, 'Ignoring OP_KEY_REQUEST because it is missing the context attribute')\n          return\n        }\n\n        const context = v.replyWith.context\n\n        if (data && (!Array.isArray(context) || (context     )[0] !== originatingContractID)) {\n          logEvtError(message, 'Ignoring OP_KEY_REQUEST because it is signed by the wrong contract')\n          return\n        }\n\n        if (v.request !== '*') {\n          logEvtError(message, 'Ignoring OP_KEY_REQUEST because it has an unsupported request attribute', v.request)\n          return\n        }\n\n        if (!state._vm.pendingKeyshares) state._vm.pendingKeyshares = Object.create(null)\n\n        state._vm.pendingKeyshares[message.hash()] = context\n          ? [\n              // Full-encryption (i.e., KRS encryption) requires that this request\n              // was encrypted and that the invite is marked as private\n              !!data?.encryptionKeyId,\n              message.height(),\n              signingKeyId,\n              context\n            ]\n          : [\n              !!data?.encryptionKeyId,\n              message.height(),\n              signingKeyId\n            ]\n\n        // Call 'chelonia/private/respondToAllKeyRequests' after sync\n        if (data) {\n          internalSideEffectStack?.push(() => {\n            self.setPostSyncOp(contractID, 'respondToAllKeyRequests-' + message.contractID(), ['chelonia/private/respondToAllKeyRequests', contractID])\n          })\n        }\n      },\n      [SPMessage.OP_KEY_REQUEST_SEEN] (wv                    ) {\n        if (config.skipActionProcessing) {\n          return\n        }\n        // TODO: Handle boolean (success) value\n\n        const data = config.unwrapMaybeEncryptedData(wv)\n        if (!data) return\n        const v = (data.data                         )\n\n        if (state._vm.pendingKeyshares && v.keyRequestHash in state._vm.pendingKeyshares) {\n          const hash = v.keyRequestHash\n          const pending = state._vm.pendingKeyshares[hash]\n          delete state._vm.pendingKeyshares[hash]\n          if (pending.length !== 4) return\n\n          // If we were able to respond, clean up responders\n          const keyId = pending[2]\n          const originatingContractID = pending[3][0]\n          if (Array.isArray(state._vm?.invites?.[keyId]?.responses)) {\n            state._vm?.invites?.[keyId]?.responses.push(originatingContractID)\n          }\n\n          if (!has(state._vm, 'keyshares')) state._vm.keyshares = Object.create(null)\n\n          const success = v.success\n\n          state._vm.keyshares[hash] = {\n            contractID: originatingContractID,\n            height,\n            success,\n            ...(success && {\n              hash: v.keyShareHash\n            })\n          }\n        }\n      },\n      [SPMessage.OP_PROP_DEL]: notImplemented,\n      [SPMessage.OP_PROP_SET] (v             ) {\n        if (!state._vm.props) state._vm.props = {}\n        state._vm.props[v.key] = v.value\n      },\n      [SPMessage.OP_KEY_ADD] (v            ) {\n        const keys = keysToMap.call(self, v, height, state._vm.authorizedKeys)\n        const keysArray = ((Object.values(v)     )         )\n        keysArray.forEach((k) => {\n          if (has(state._vm.authorizedKeys, k.id) && state._vm.authorizedKeys[k.id]._notAfterHeight == null) {\n            throw new ChelErrorWarning('Cannot use OP_KEY_ADD on existing keys. Key ID: ' + k.id)\n          }\n        })\n        validateKeyAddPermissions.call(self, contractID, signingKey, state, v)\n        state._vm.authorizedKeys = { ...state._vm.authorizedKeys, ...keys }\n        keyAdditionProcessor.call(self, message, hash, v, state, contractID, signingKey, internalSideEffectStack)\n      },\n      [SPMessage.OP_KEY_DEL] (v            ) {\n        if (!state._vm.authorizedKeys) state._vm.authorizedKeys = Object.create(null)\n        if (!state._volatile) state._volatile = Object.create(null)\n        if (!state._volatile.pendingKeyRevocations) state._volatile.pendingKeyRevocations = Object.create(null)\n        validateKeyDelPermissions.call(self, contractID, signingKey, state, v)\n        const keyIds = ((v.map((k) => {\n          const data = config.unwrapMaybeEncryptedData(k)\n          if (!data) return undefined\n          return data.data\n        })     )          ).filter((keyId) => {\n          if (!keyId || typeof keyId !== 'string') return false\n          if (!has(state._vm.authorizedKeys, (keyId     )) || state._vm.authorizedKeys[keyId]._notAfterHeight != null) {\n            console.warn('Attempted to delete non-existent key from contract', { contractID, keyId })\n            return false\n          }\n          return true\n        })\n\n        keyIds.forEach((keyId) => {\n          const key = state._vm.authorizedKeys[keyId]\n          state._vm.authorizedKeys[keyId]._notAfterHeight = height\n\n          if (has(state._volatile.pendingKeyRevocations, keyId)) {\n            delete state._volatile.pendingKeyRevocations[keyId]\n          }\n\n          // Are we deleting a foreign key? If so, we also need to remove\n          // the operation from (1) _volatile.watch (on the other contract)\n          // and (2) pendingWatch\n          if (key.foreignKey) {\n            const fkUrl = new URL(key.foreignKey)\n            const foreignContract = fkUrl.pathname\n            const foreignKeyName = fkUrl.searchParams.get('keyName')\n\n            if (!foreignContract || !foreignKeyName) throw new Error('Invalid foreign key: missing contract or key name')\n\n            internalSideEffectStack?.push(() => {\n              sbp('chelonia/private/queueEvent', foreignContract, () => {\n                const rootState = sbp(config.stateSelector)\n                if (Array.isArray(rootState[foreignContract]?._volatile?.watch)) {\n                  // Stop watching events for this key\n                  const oldWatch = rootState[foreignContract]._volatile.watch\n                  rootState[foreignContract]._volatile.watch = oldWatch.filter(([name, cID]) => name !== foreignKeyName || cID !== contractID)\n                  if (oldWatch.length !== rootState[foreignContract]._volatile.watch.length) {\n                    // If the number of foreign keys changed, maybe there's no\n                    // reason to remain subscribed to this contract. In this\n                    // case, attempt to release it.\n                    sbp('chelonia/contract/release', foreignContract, { try: true }).catch(e => {\n                      // Using console.error instead of logEvtError because this\n                      // is a side-effect and not relevant for outgoing messages\n                      console.error(`[chelonia] Error at OP_KEY_DEL internalSideEffectStack while attempting to release foreign contract ${foreignContract}`, e)\n                    })\n                  }\n                }\n              }).catch((e) => {\n                // Using console.error instead of logEvtError because this\n                // is a side-effect and not relevant for outgoing messages\n                console.error('Error stopping watching events after removing key', { contractID, foreignContract, foreignKeyName, fkUrl }, e)\n              })\n            })\n\n            const pendingWatch = state._vm.pendingWatch?.[foreignContract]\n            if (pendingWatch) {\n              state._vm.pendingWatch[foreignContract] = pendingWatch.filter(([, kId]) => kId !== keyId)\n            }\n          }\n\n          // Set the status to revoked for invite keys\n          if (key.name.startsWith('#inviteKey-') && state._vm.invites[key.id]) {\n            state._vm.invites[key.id].status = INVITE_STATUS.REVOKED\n          }\n        })\n\n        // Check state._volatile.watch for contracts that should be\n        // mirroring this operation\n        if (Array.isArray(state._volatile?.watch)) {\n          const updatedKeysMap = Object.create(null)\n\n          keyIds.forEach((keyId) => {\n            updatedKeysMap[state._vm.authorizedKeys[keyId].name] = {\n              name: state._vm.authorizedKeys[keyId].name,\n              oldKeyId: keyId\n            }\n          })\n\n          keyRotationHelper(contractID, state, config, updatedKeysMap, [SPMessage.OP_KEY_DEL], 'chelonia/out/keyDel', (name) => updatedKeysMap[name[0]].oldKeyId, internalSideEffectStack)\n        }\n      },\n      [SPMessage.OP_KEY_UPDATE] (v               ) {\n        if (!state._volatile) state._volatile = Object.create(null)\n        if (!state._volatile.pendingKeyRevocations) state._volatile.pendingKeyRevocations = Object.create(null)\n        const [updatedKeys, updatedMap] = validateKeyUpdatePermissions.call(self, contractID, signingKey, state, v)\n        const keysToDelete = ((Object.values(updatedMap)     )          )\n        for (const keyId of keysToDelete) {\n          if (has(state._volatile.pendingKeyRevocations, keyId)) {\n            delete state._volatile.pendingKeyRevocations[keyId]\n          }\n\n          state._vm.authorizedKeys[keyId]._notAfterHeight = height\n        }\n        for (const key of updatedKeys) {\n          if (!has(state._vm.authorizedKeys, key.id)) {\n            key._notBeforeHeight = height\n            state._vm.authorizedKeys[key.id] = cloneDeep(key)\n          }\n        }\n        keyAdditionProcessor.call(self, message, hash, (updatedKeys     ), state, contractID, signingKey, internalSideEffectStack)\n\n        // Check state._volatile.watch for contracts that should be\n        // mirroring this operation\n        if (Array.isArray(state._volatile?.watch)) {\n          const updatedKeysMap = Object.create(null)\n\n          updatedKeys.forEach((key) => {\n            if (key.data) {\n              updatedKeysMap[key.name] = cloneDeep(key)\n              updatedKeysMap[key.name].oldKeyId = updatedMap[key.id]\n            }\n          })\n\n          keyRotationHelper(contractID, state, config, updatedKeysMap, [SPMessage.OP_KEY_UPDATE], 'chelonia/out/keyUpdate', (name) => ({\n            name: name[1],\n            oldKeyId: updatedKeysMap[name[0]].oldKeyId,\n            id: updatedKeysMap[name[0]].id,\n            data: updatedKeysMap[name[0]].data\n          }), internalSideEffectStack)\n        }\n      },\n      [SPMessage.OP_PROTOCOL_UPGRADE]: notImplemented\n    }\n    if (!this.config.skipActionProcessing && !this.manifestToContract[manifestHash]) {\n      const rootState = sbp(this.config.stateSelector)\n      // Having rootState.contracts[contractID] is not enough to determine we\n      // have previously synced this contract, as reference counts are also\n      // stored there. Hence, we check for the presence of 'type'\n      if (!contractName) {\n        contractName = has(rootState.contracts, contractID) && rootState.contracts[contractID] && has(rootState.contracts[contractID], 'type')\n          ? rootState.contracts[contractID].type\n          : opT === SPMessage.OP_CONTRACT\n            ? ((opV     )              ).type\n            : ''\n      }\n      if (!contractName) {\n        throw new Error(`Unable to determine the name for a contract and refusing to load it (contract ID was ${contractID} and its manifest hash was ${manifestHash})`)\n      }\n      await sbp('chelonia/private/loadManifest', contractName, manifestHash)\n    }\n    let processOp = true\n    if (config.preOp) {\n      processOp = config.preOp(message, state) !== false && processOp\n    }\n\n    let signingKey       \n    // Signature verification\n    {\n      // This sync code has potential issues\n      // The first issue is that it can deadlock if there are circular references\n      // The second issue is that it doesn't handle key rotation. If the key used for signing is invalidated / removed from the originating contract, we won't have it in the state\n      // Both of these issues can be resolved by introducing a parameter with the message ID the state is based on. This requires implementing a separate, ephemeral, state container for operations that refer to a different contract.\n      // The difficulty of this is how to securely determine the message ID to use.\n      // The server can assist with this.\n\n      const stateForValidation = opT === SPMessage.OP_CONTRACT && !state?._vm?.authorizedKeys\n        ? {\n            _vm: {\n              authorizedKeys: keysToMap.call(this, ((opV     )              ).keys, height)\n            }\n          }\n        : state\n\n      // Verify that the signing key is found, has the correct purpose and is\n      // allowed to sign this particular operation\n      if (!validateKeyPermissions(message, config, stateForValidation, signingKeyId, opT, opV)) {\n        throw new Error('No matching signing key was defined')\n      }\n\n      signingKey = stateForValidation._vm.authorizedKeys[signingKeyId]\n    }\n\n    if (config[`preOp_${opT}`]) {\n      processOp = config[`preOp_${opT}`](message, state) !== false && processOp\n    }\n    if (processOp) {\n      await opFns[opT](opV)\n      config.postOp?.(message, state)\n      config[`postOp_${opT}`]?.(message, state) // hack to fix syntax highlighting `\n    }\n  },\n  'chelonia/private/in/enqueueHandleEvent': function (contractID        , event        ) {\n    // make sure handleEvent is called AFTER any currently-running invocations\n    // to 'chelonia/private/out/sync', to prevent gi.db from throwing\n    // \"bad previousHEAD\" errors\n    return sbp('chelonia/private/queueEvent', contractID, async () => {\n      await sbp('chelonia/private/in/handleEvent', contractID, event)\n      // Before the next operation is enqueued, enqueue post sync ops. This\n      // makes calling `/wait` more reliable\n      sbp('chelonia/private/enqueuePostSyncOps', contractID)\n    })\n  },\n  'chelonia/private/in/syncContract': async function (contractID        , params                                        ) {\n    const state = sbp(this.config.stateSelector)\n    if (state.contracts[contractID] === null) {\n      throw new ChelErrorResourceGone('Cannot sync permanently deleted contract ' + contractID)\n    }\n\n    try {\n      this.currentSyncs[contractID] = { firstSync: !state.contracts[contractID]?.type }\n      sbp('okTurtles.events/emit', CONTRACT_IS_SYNCING, contractID, true)\n      const currentVolatileState = state[contractID]?._volatile || Object.create(null)\n      // If the dirty flag is set (indicating that new encryption keys were received),\n      // we remove the current state before syncing (this has the effect of syncing\n      // from the beginning, recreating the entire state). When this is the case,\n      // the _volatile state is preserved\n      if (currentVolatileState?.dirty || params?.resync) {\n        delete currentVolatileState.dirty\n        currentVolatileState.resyncing = true\n        sbp('chelonia/private/removeImmediately', contractID, { resync: true })\n        this.config.reactiveSet(state, contractID, Object.create(null))\n        this.config.reactiveSet(state[contractID], '_volatile', currentVolatileState)\n      }\n\n      const { HEAD: latestHEAD } = await sbp('chelonia/out/latestHEADInfo', contractID)\n      console.debug(`[chelonia] syncContract: ${contractID} latestHash is: ${latestHEAD}`)\n      // there is a chance two users are logged in to the same machine and must check their contracts before syncing\n      const { HEAD: recentHEAD, height: recentHeight } = state.contracts[contractID] || {}\n      const isSubscribed = this.subscriptionSet.has(contractID)\n      if (!isSubscribed) {\n        const entry = this.pending.find((entry) => entry?.contractID === contractID)\n        // we're syncing a contract for the first time, make sure to add to pending\n        // so that handleEvents knows to expect events from this contract\n        if (!entry) {\n          this.pending.push({ contractID })\n        }\n      }\n      this.postSyncOperations[contractID] = this.postSyncOperations[contractID] ?? Object.create(null)\n\n      if (latestHEAD !== recentHEAD) {\n        console.debug(`[chelonia] Synchronizing Contract ${contractID}: our recent was ${recentHEAD || 'undefined'} but the latest is ${latestHEAD}`)\n        // TODO: fetch events from localStorage instead of server if we have them\n        const eventsStream = sbp('chelonia/out/eventsAfter', contractID, recentHeight ?? 0, undefined, recentHEAD ?? contractID)\n        // Sanity check: verify event with latest hash exists in list of events\n        // TODO: using findLastIndex, it will be more clean but it needs Cypress 9.7+ which has bad performance\n        //       https://docs.cypress.io/guides/references/changelog#9-7-0\n        //       https://github.com/cypress-io/cypress/issues/22868\n        let latestHashFound = false\n        const eventReader = eventsStream.getReader()\n        // remove the first element in cases where we are not getting the contract for the first time\n        for (let skip = has(state.contracts, contractID) && has(state.contracts[contractID], 'HEAD'); ; skip = false) {\n          const { done, value: event } = await eventReader.read()\n          if (done) {\n            if (!latestHashFound) {\n              throw new ChelErrorForkedChain(`expected hash ${latestHEAD} in list of events for contract ${contractID}`)\n            }\n            break\n          }\n          if (!latestHashFound) {\n            latestHashFound = SPMessage.deserializeHEAD(event).hash === latestHEAD\n          }\n          if (skip) continue\n          // this must be called directly, instead of via enqueueHandleEvent\n          await sbp('chelonia/private/in/handleEvent', contractID, event)\n        }\n      } else if (!isSubscribed) {\n        this.subscriptionSet.add(contractID)\n        sbp('okTurtles.events/emit', CONTRACTS_MODIFIED, Array.from(this.subscriptionSet), { added: [contractID], removed: [] })\n        const entryIndex = this.pending.findIndex((entry) => entry?.contractID === contractID)\n        if (entryIndex !== -1) {\n          this.pending.splice(entryIndex, 1)\n        }\n        console.debug(`[chelonia] added already synchronized ${contractID} to subscription set`)\n      } else {\n        console.debug(`[chelonia] contract ${contractID} was already synchronized`)\n      }\n\n      // Do not await here as the post-sync ops might themselves might be\n      // waiting on the same queue, causing a deadlock\n      sbp('chelonia/private/enqueuePostSyncOps', contractID)\n    } catch (e) {\n      console.error(`[chelonia] syncContract error: ${e.message || e}`, e)\n      this.config.hooks.syncContractError?.(e, contractID)\n      throw e\n    } finally {\n      if (state[contractID]?._volatile?.resyncing) {\n        this.config.reactiveDel(state[contractID]._volatile, 'resyncing')\n      }\n      delete this.currentSyncs[contractID]\n      sbp('okTurtles.events/emit', CONTRACT_IS_SYNCING, contractID, false)\n    }\n  },\n  'chelonia/private/enqueuePostSyncOps': function (contractID        ) {\n    if (!has(this.postSyncOperations, contractID)) return\n\n    // Iterate over each post-sync operation associated with the given contractID.\n    Object.entries(this.postSyncOperations[contractID]).forEach(([key, op]) => {\n      // Remove the operation which is about to be handled so that subsequent\n      // calls to this selector don't result in repeat calls to the post-sync op\n      delete this.postSyncOperations[contractID][key]\n\n      // Queue the current operation for execution.\n      // Note that we do _not_ await because it could be unsafe to do so.\n      // If the operation fails for some reason, just log the error.\n      sbp('chelonia/private/queueEvent', contractID, op).catch((e) => {\n        console.error(`Post-sync operation for ${contractID} failed`, { contractID, op, error: e })\n      })\n    })\n  },\n  'chelonia/private/watchForeignKeys': function (externalContractID        ) {\n    const state = sbp(this.config.stateSelector)\n    const externalContractState = state[externalContractID]\n\n    const pendingWatch = externalContractState?._vm?.pendingWatch\n\n    if (!pendingWatch || !Object.keys(pendingWatch).length) return\n\n    const signingKey = findSuitableSecretKeyId(externalContractState, [SPMessage.OP_KEY_DEL], ['sig'])\n    const canMirrorOperations = !!signingKey\n\n    // Only sync contract if we are actually able to mirror key operations\n    // This avoids exponentially growing the number of contracts that we need\n    // to be subscribed to.\n    // Otherwise, every time there is a foreign key, we would subscribe to that\n    // contract, plus the contracts referenced by the foreign keys of that\n    // contract, plus those contracts referenced by the foreign keys of those\n    // other contracts and so on.\n    if (!canMirrorOperations) {\n      console.info('[chelonia/private/watchForeignKeys]: Returning as operations cannot be mirrored', { externalContractID })\n      return\n    }\n\n    // For each pending watch operation, queue a synchronization event in the\n    // respective contract queue\n    Object.entries(pendingWatch).forEach(([contractID, keys]) => {\n      if (\n        !Array.isArray(keys) ||\n        // Check that the keys exist and haven't been revoked\n        // $FlowFixMe[incompatible-use]\n        !keys.reduce((acc, [, id]) => {\n          return acc || has(externalContractState._vm.authorizedKeys, id)\n        }, false)\n      ) {\n        console.info('[chelonia/private/watchForeignKeys]: Skipping as none of the keys to watch exist', {\n          externalContractID,\n          contractID\n        })\n        return\n      }\n\n      sbp('chelonia/private/queueEvent', contractID, ['chelonia/private/in/syncContractAndWatchKeys', contractID, externalContractID]).catch((e) => {\n        console.error(`Error at syncContractAndWatchKeys for contractID ${contractID} and externalContractID ${externalContractID}`, e)\n      })\n    })\n  },\n  'chelonia/private/in/syncContractAndWatchKeys': async function (contractID        , externalContractID        ) {\n    const rootState = sbp(this.config.stateSelector)\n    const externalContractState = rootState[externalContractID]\n    const pendingWatch = externalContractState?._vm?.pendingWatch?.[contractID]?.splice(0)\n\n    // We duplicate the check in 'chelonia/private/watchForeignKeys' because\n    // new events may have been received in the meantime. This avoids\n    // unnecessarily subscribing to the contract\n    if (\n      !Array.isArray(pendingWatch) ||\n      // Check that the keys exist and haven't been revoked\n      !pendingWatch.reduce((acc, [, id]) => {\n        return acc || (\n          has(externalContractState._vm.authorizedKeys, id) &&\n          findKeyIdByName(externalContractState, externalContractState._vm.authorizedKeys[id].name) != null\n        )\n      }, false)\n    ) {\n      console.info('[chelonia/private/syncContractAndWatchKeys]: Skipping as none of the keys to watch exist', {\n        externalContractID,\n        contractID\n      })\n      return\n    }\n\n    // We check this.subscriptionSet to see if we're already\n    // subscribed to the contract; if not, we call sync.\n    if (!this.subscriptionSet.has(contractID)) {\n      await sbp('chelonia/private/in/syncContract', contractID)\n    }\n\n    const contractState = rootState[contractID]\n    const keysToDelete = []\n    const keysToUpdate = []\n\n    pendingWatch.forEach(([keyName, externalId]) => {\n    // Does the key exist? If not, it has probably been removed and instead\n    // of waiting, we need to remove it ourselves\n      const keyId = findKeyIdByName(contractState, keyName)\n      if (!keyId) {\n        keysToDelete.push(externalId)\n        return\n      } else if (keyId !== externalId) {\n      // Or, the key has been updated and we need to update it in the external\n      // contract as well\n        keysToUpdate.push(externalId)\n      }\n\n      // Add keys to watchlist as another contract is waiting on these\n      // operations\n      if (!contractState._volatile) {\n        this.config.reactiveSet(contractState, '_volatile', Object.create(null, { watch: { value: [[keyName, externalContractID]], configurable: true, enumerable: true, writable: true } }))\n      } else {\n        if (!contractState._volatile.watch) this.config.reactiveSet(contractState._volatile, 'watch', [[keyName, externalContractID]])\n        if (Array.isArray(contractState._volatile.watch) && !contractState._volatile.watch.find((v) => v[0] === keyName && v[1] === externalContractID)) contractState._volatile.watch.push([keyName, externalContractID])\n      }\n    })\n\n    // If there are keys that need to be revoked, queue an event to handle the\n    // deletion\n    if (keysToDelete.length || keysToUpdate.length) {\n      if (!externalContractState._volatile) {\n        this.config.reactiveSet(externalContractState, '_volatile', Object.create(null))\n      }\n      if (!externalContractState._volatile.pendingKeyRevocations) {\n        this.config.reactiveSet(externalContractState._volatile, 'pendingKeyRevocations', Object.create(null))\n      }\n      keysToDelete.forEach((id) => this.config.reactiveSet(externalContractState._volatile.pendingKeyRevocations, id, 'del'))\n      keysToUpdate.forEach((id) => this.config.reactiveSet(externalContractState._volatile.pendingKeyRevocations, id, true))\n\n      sbp('chelonia/private/queueEvent', externalContractID, ['chelonia/private/deleteOrRotateRevokedKeys', externalContractID]).catch((e) => {\n        console.error(`Error at deleteOrRotateRevokedKeys for contractID ${contractID} and externalContractID ${externalContractID}`, e)\n      })\n    }\n  },\n  // The following function gets called when we start watching a contract for\n  // foreign keys for the first time, and it ensures that, at the point the\n  // watching starts, keys are in sync between the two contracts (later on,\n  // this will be handled automatically for incoming OP_KEY_DEL and\n  // OP_KEY_UPDATE).\n  // For any given foreign key, there are three possible states:\n  //   1. The key is in sync with the foreign contract. In this case, there's\n  //      nothing left to do.\n  //   2. The key has been rotated in the foreign contract (replaced by another\n  //      key of the same name). We need to mirror this operation manually\n  //      since watching only affects new messages we receive.\n  //   3. The key has been removed in the foreign contract. We also need to\n  //      mirror the operation.\n  'chelonia/private/deleteOrRotateRevokedKeys': function (contractID        ) {\n    const rootState = sbp(this.config.stateSelector)\n    const contractState = rootState[contractID]\n    const pendingKeyRevocations = contractState?._volatile?.pendingKeyRevocations\n\n    if (!pendingKeyRevocations || Object.keys(pendingKeyRevocations).length === 0) return\n\n    // First, we handle keys that have been rotated\n    const keysToUpdate           = Object.entries(pendingKeyRevocations).filter(([, v]) => v === true).map(([id]) => id)\n\n    // Aggregate the keys that we can update to send them in a single operation\n    const [, keyUpdateSigningKeyId, keyUpdateArgs] = keysToUpdate.reduce((acc, keyId) => {\n      const key = contractState._vm?.authorizedKeys?.[keyId]\n      if (!key || !key.foreignKey) return acc\n      const foreignKey = String(key.foreignKey)\n      const fkUrl = new URL(foreignKey)\n      const foreignContractID = fkUrl.pathname\n      const foreignKeyName = fkUrl.searchParams.get('keyName')\n      if (!foreignKeyName) throw new Error('Missing foreign key name')\n      const foreignState = rootState[foreignContractID]\n      if (!foreignState) return acc\n      const fKeyId = findKeyIdByName(foreignState, foreignKeyName)\n      if (!fKeyId) {\n        // Key was deleted; mark it for deletion\n        if (pendingKeyRevocations[keyId] === true) {\n          this.config.reactiveSet(pendingKeyRevocations, keyId, 'del')\n        }\n        return acc\n      }\n\n      const [currentRingLevel, currentSigningKeyId, currentKeyArgs] = acc\n      const ringLevel = Math.min(currentRingLevel, key.ringLevel ?? Number.POSITIVE_INFINITY)\n      if (ringLevel >= currentRingLevel) {\n        (currentKeyArgs     ).push({\n          name: key.name,\n          oldKeyId: keyId,\n          id: fKeyId,\n          data: foreignState._vm.authorizedKeys[fKeyId].data\n        })\n        return [currentRingLevel, currentSigningKeyId, currentKeyArgs]\n      } else if (Number.isFinite(ringLevel)) {\n        const signingKeyId = findSuitableSecretKeyId(contractState, [SPMessage.OP_KEY_UPDATE], ['sig'], ringLevel)\n        if (signingKeyId) {\n          (currentKeyArgs     ).push({\n            name: key.name,\n            oldKeyId: keyId,\n            id: fKeyId,\n            data: foreignState._vm.authorizedKeys[fKeyId].data\n          })\n          return [ringLevel, signingKeyId, currentKeyArgs]\n        }\n      }\n      return acc\n    }, [Number.POSITIVE_INFINITY, '', []])\n\n    if (keyUpdateArgs.length !== 0) {\n      const contractName = contractState._vm.type\n\n      // This is safe to do without await because it's sending an operation\n      // Using await could deadlock when retrying to send the message\n      sbp('chelonia/out/keyUpdate', { contractID, contractName, data: keyUpdateArgs, signingKeyId: keyUpdateSigningKeyId }).catch(e => {\n        console.error(`[chelonia/private/deleteOrRotateRevokedKeys] Error sending OP_KEY_UPDATE for ${contractID}`, e.message)\n      })\n    }\n\n    // And then, we handle keys that have been deleted\n    const keysToDelete = Object.entries(pendingKeyRevocations).filter(([, v]) => v === 'del').map(([id]) => id)\n\n    // Aggregate the keys that we can delete to send them in a single operation\n    const [, keyDelSigningKeyId, keyIdsToDelete] = keysToDelete.reduce((acc, keyId) => {\n      const [currentRingLevel, currentSigningKeyId, currentKeyIds] = acc\n      const ringLevel = Math.min(currentRingLevel, contractState._vm?.authorizedKeys?.[keyId]?.ringLevel ?? Number.POSITIVE_INFINITY)\n      if (ringLevel >= currentRingLevel) {\n        (currentKeyIds     ).push(keyId)\n        return [currentRingLevel, currentSigningKeyId, currentKeyIds]\n      } else if (Number.isFinite(ringLevel)) {\n        const signingKeyId = findSuitableSecretKeyId(contractState, [SPMessage.OP_KEY_DEL], ['sig'], ringLevel)\n        if (signingKeyId) {\n          (currentKeyIds     ).push(keyId)\n          return [ringLevel, signingKeyId, currentKeyIds]\n        }\n      }\n      return acc\n    }, [Number.POSITIVE_INFINITY, '', []])\n\n    if (keyIdsToDelete.length !== 0) {\n      const contractName = contractState._vm.type\n\n      // This is safe to do without await because it's sending an operation\n      // Using await could deadlock when retrying to send the message\n      sbp('chelonia/out/keyDel', { contractID, contractName, data: keyIdsToDelete, signingKeyId: keyDelSigningKeyId }).catch(e => {\n        console.error(`[chelonia/private/deleteRevokedKeys] Error sending OP_KEY_DEL for ${contractID}`, e.message)\n      })\n    }\n  },\n  'chelonia/private/respondToAllKeyRequests': function (contractID        ) {\n    const state = sbp(this.config.stateSelector)\n    const contractState = state[contractID] ?? {}\n\n    const pending = contractState?._vm?.pendingKeyshares\n    if (!pending) return\n\n    const signingKeyId = findSuitableSecretKeyId(contractState, [SPMessage.OP_ATOMIC, SPMessage.OP_KEY_REQUEST_SEEN, SPMessage.OP_KEY_SHARE], ['sig'])\n\n    if (!signingKeyId) {\n      console.log('Unable to respond to key request because there is no suitable secret key with OP_KEY_REQUEST_SEEN permission')\n      return\n    }\n\n    Object.entries(pending).map(([hash, entry]) => {\n      if (!Array.isArray(entry) || entry.length !== 4) {\n        return undefined\n      }\n\n      const [,,, [originatingContractID]] = ((entry     )                                                             )\n\n      return sbp('chelonia/private/queueEvent', originatingContractID, ['chelonia/private/respondToKeyRequest', contractID, signingKeyId, hash]).catch((e) => {\n        console.error(`respondToAllKeyRequests: Error responding to key request ${hash} from ${originatingContractID} to ${contractID}`, e)\n      })\n    })\n  },\n  'chelonia/private/respondToKeyRequest': async function (contractID        , signingKeyId        , hash        ) {\n    const state = sbp(this.config.stateSelector)\n    const contractState = state[contractID]\n    const entry = contractState?._vm?.pendingKeyshares?.[hash]\n    const instance = this._instance\n\n    if (!Array.isArray(entry) || entry.length !== 4) {\n      return\n    }\n\n    const [keyShareEncryption, height, , [originatingContractID, rv, originatingContractHeight, headJSON]] = ((entry     )                                                             )\n    entry.pop()\n\n    const krsEncryption = !!contractState._vm.authorizedKeys?.[signingKeyId]?._private\n\n    // 1. Sync (originating) identity contract\n\n    await sbp('chelonia/private/in/syncContract', originatingContractID)\n    if (instance !== this._instance) return\n\n    const originatingState = state[originatingContractID]\n    const contractName = state.contracts[contractID].type\n    const originatingContractName = originatingState._vm.type\n\n    const v = signedIncomingData(originatingContractID, originatingState, rv, originatingContractHeight, headJSON).valueOf()\n\n    // 2. Verify 'data'\n    const { encryptionKeyId } = v\n\n    const responseKey = encryptedIncomingData(contractID, contractState, v.responseKey, height, this.transientSecretKeys, headJSON).valueOf()\n\n    const deserializedResponseKey = deserializeKey(responseKey)\n    const responseKeyId = keyId(deserializedResponseKey)\n\n    // This is safe to do without await because it's sending actions\n    // If we had await it could deadlock when retrying to send the event\n    Promise.resolve().then(() => {\n      if (instance !== this._instance) return\n      if (!has(originatingState._vm.authorizedKeys, responseKeyId) || originatingState._vm.authorizedKeys[responseKeyId]._notAfterHeight != null) {\n        throw new Error(`Unable to respond to key request for ${originatingContractID}. Key ${responseKeyId} is not valid.`)\n      }\n\n      // We don't need to worry about persistence (if it was an outgoing\n      // message) here as this is done from an internal side-effect.\n      sbp('chelonia/storeSecretKeys', new Secret([\n        { key: deserializedResponseKey }\n      ]))\n\n      const keys = pick(\n        state.secretKeys,\n        Object.entries(contractState._vm.authorizedKeys)\n          .filter(([, key]) => !!(key     ).meta?.private?.shareable)\n          .map(([kId]) => kId)\n      )\n\n      if (!keys || Object.keys(keys).length === 0) {\n        console.info('respondToAllKeyRequests: no keys to share', { contractID, originatingContractID })\n        return\n      }\n\n      const keySharePayload = {\n        contractID: contractID,\n        keys: Object.entries(keys).map(([keyId, key]                 ) => ({\n          id: keyId,\n          meta: {\n            private: {\n              content: encryptedOutgoingData(originatingContractID, encryptionKeyId, key),\n              shareable: true\n            }\n          }\n        })),\n        keyRequestHash: hash,\n        keyRequestHeight: height\n      }\n\n      // 3. Send OP_KEY_SHARE to identity contract\n      if (!contractState?._vm?.pendingKeyshares?.[hash]) {\n      // While we were getting ready, another client may have shared the keys\n        return\n      }\n\n      return keySharePayload\n    }).then((keySharePayload) => {\n      if (instance !== this._instance || !keySharePayload) return\n\n      return sbp('chelonia/out/keyShare', {\n        contractID: originatingContractID,\n        contractName: originatingContractName,\n        data: keyShareEncryption\n          ? encryptedOutgoingData(\n            originatingContractID,\n            findSuitablePublicKeyIds(originatingState, [SPMessage.OP_KEY_SHARE], ['enc'])?.[0] || '',\n            keySharePayload\n          )\n          : keySharePayload,\n        signingKeyId: responseKeyId\n      }).then((msg) => {\n        if (instance !== this._instance) return\n\n        // 4(i). Remove originating contract and update current contract with information\n        const payload = { keyRequestHash: hash, keyShareHash: msg.hash(), success: true }\n        const connectionKeyPayload = {\n          contractID: originatingContractID,\n          keys: [\n            {\n              id: responseKeyId,\n              meta: {\n                private: {\n                  content: encryptedOutgoingData(contractID, findSuitablePublicKeyIds(contractState, [SPMessage.OP_KEY_REQUEST_SEEN], ['enc'])?.[0] || '', responseKey),\n                  shareable: true\n                }\n              }\n            }\n          ]\n        }\n\n        // This is safe to do without await because it's sending an action\n        // If we had await it could deadlock when retrying to send the event\n        sbp('chelonia/out/atomic', {\n          contractID,\n          contractName,\n          signingKeyId,\n          data: [\n            [\n              'chelonia/out/keyRequestResponse',\n              {\n                data:\n                krsEncryption\n                  ? encryptedOutgoingData(\n                    contractID,\n                    findSuitablePublicKeyIds(contractState, [SPMessage.OP_KEY_REQUEST_SEEN], ['enc'])?.[0] || '',\n                    payload\n                  )\n                  : payload\n              }\n            ],\n            [\n              // Upon successful key share, we want to share deserializedResponseKey\n              // with ourselves\n              'chelonia/out/keyShare',\n              {\n                data: keyShareEncryption\n                  ? encryptedOutgoingData(\n                    contractID,\n                    findSuitablePublicKeyIds(contractState, [SPMessage.OP_KEY_SHARE], ['enc'])?.[0] || '',\n                    connectionKeyPayload\n                  )\n                  : connectionKeyPayload\n              }\n            ]\n          ]\n        }).catch((e) => {\n          console.error('Error at respondToKeyRequest while sending keyRequestResponse', e)\n        })\n      })\n    }).catch((e) => {\n      console.error('Error at respondToKeyRequest', e)\n      const payload = { keyRequestHash: hash, success: false }\n\n      // 4(ii). Remove originating contract and update current contract with information\n      if (!contractState?._vm?.pendingKeyshares?.[hash]) {\n        // While we were getting ready, another client may have shared the keys\n        return\n      }\n\n      // This is safe to do without await because it's sending an action\n      // If we had await it could deadlock when retrying to send the event\n      sbp('chelonia/out/keyRequestResponse', {\n        contractID,\n        contractName,\n        signingKeyId,\n        data: krsEncryption\n          ? encryptedOutgoingData(contractID, findSuitablePublicKeyIds(contractState, [SPMessage.OP_KEY_REQUEST_SEEN], ['enc'])?.[0] || '', payload)\n          : payload\n      }).catch((e) => {\n        console.error('Error at respondToKeyRequest while sending keyRequestResponse in error handler', e)\n      })\n    })\n  },\n  'chelonia/private/in/handleEvent': async function (contractID        , rawMessage        ) {\n    const state = sbp(this.config.stateSelector)\n    const { preHandleEvent, postHandleEvent, handleEventError } = this.config.hooks\n    let processingErrored = false\n    let message\n    // Errors in mutations result in ignored messages\n    // Errors in side effects result in dropped messages to be reprocessed\n    try {\n      // verify we're expecting to hear from this contract\n      if (!this.config.acceptAllMessages && !this.pending.some((entry) => entry?.contractID === contractID) && !this.subscriptionSet.has(contractID)) {\n        console.warn(`[chelonia] WARN: ignoring unexpected event for ${contractID}:`, rawMessage)\n        return\n      }\n      // contractStateCopy has a copy of the current contract state, or an empty\n      // object if the state doesn't exist. This copy will be used to apply\n      // any changes from processing the current event as well as when calling\n      // side-effects and, once everything is processed, it will be applied\n      // to the global state. Important note: because the state change is\n      // applied to the Vuex state only if process is successful (and after both\n      // process and the sideEffect finish), any sideEffects that need to the\n      // access the state should do so only through the state that is passed in\n      // to the call to the sideEffect, or through a call though queueInvocation\n      // (so that the side effect runs after the changes are applied)\n      const contractStateCopy = state[contractID] ? cloneDeep(state[contractID]) : Object.create(null)\n      // Now, deserialize the messsage\n      // The message is deserialized *here* and not earlier because deserialize\n      // constructs objects of signedIncomingData and encryptedIncomingData\n      // which are bound to the state. For some opcodes (such as OP_ATOMIC), the\n      // state could change in ways that are significant for further processing,\n      // so those objects need to be bound to the state copy (which is mutated)\n      // as opposed to the the root state (which is mutated only after\n      // processing is done).\n      // For instance, let's say the message contains an OP_ATOMIC comprising\n      // two operations: OP_KEY_ADD (adding a signing key) and OP_ACTION_ENCRYPTED\n      // (with an inner signature using this key in OP_KEY_ADD). If the state\n      // is bound to the copy (as below), then by the time OP_ACTION_ENCRYPTED\n      // is processed, the result of OP_KEY_ADD has been applied to the state\n      // copy. If we didn't specify a state or instead grabbed it from the root\n      // state, then we wouldn't be able to process OP_ACTION_ENCRYPTED correctly,\n      // as we wouldn't know that the key is valid from that state, and the\n      // state copy (contractStateCopy) is only written to the root state after\n      // all processing has completed.\n      message = SPMessage.deserialize(rawMessage, this.transientSecretKeys, contractStateCopy, this.config.unwrapMaybeEncryptedData)\n      if (message.contractID() !== contractID) {\n        throw new Error(`[chelonia] Wrong contract ID. Expected ${contractID} but got ${message.contractID()}`)\n      }\n      if (!message.isFirstMessage() && (!has(state.contracts, contractID) || !has(state, contractID))) {\n        throw new ChelErrorUnrecoverable('The event is not for a first message but the contract state is missing')\n      }\n      preHandleEvent?.(message)\n      // the order the following actions are done is critically important!\n      // first we make sure we can save this message to the db\n      // if an exception is thrown here we do not need to revert the state\n      // because nothing has been processed yet\n      const proceed = handleEvent.checkMessageOrdering.call(this, message)\n      if (proceed === false) return\n\n      // If the contract was marked as dirty, we stop processing\n      // The 'dirty' flag is set, possibly *by another contract*, indicating\n      // that a previously unknown encryption key has been received. This means\n      // that the current state is invalid (because it could changed based on\n      // this new information) and we must re-sync the contract. When this\n      // happens, we stop processing because the state will be regenerated.\n      if (state[contractID]?._volatile?.dirty) {\n        console.info(`[chelonia] Ignoring message ${message.description()} as the contract is marked as dirty`)\n        return\n      }\n\n      const internalSideEffectStack = !this.config.skipSideEffects ? [] : undefined\n\n      // process the mutation on the state\n      // IMPORTANT: even though we 'await' processMutation, everything in your\n      //            contract's 'process' function must be synchronous! The only\n      //            reason we 'await' here is to dynamically load any new contract\n      //            source / definitions specified by the SPMessage\n      missingDecryptionKeyIdsMap.delete(message)\n      try {\n        await handleEvent.processMutation.call(this, message, contractStateCopy, internalSideEffectStack)\n      } catch (e_) {\n        const e = (e_        )\n        if (e?.name === 'ChelErrorDecryptionKeyNotFound') {\n          console.warn(`[chelonia] WARN '${e.name}' in processMutation for ${message.description()}: ${e.message}`, e, message.serialize())\n          if (e.cause) {\n            const missingDecryptionKeyIds = missingDecryptionKeyIdsMap.get(message)\n            if (missingDecryptionKeyIds) {\n              missingDecryptionKeyIds.add(e.cause)\n            } else {\n              missingDecryptionKeyIdsMap.set(message, new Set([e.cause]))\n            }\n          }\n        } else {\n          console.error(`[chelonia] ERROR '${e.name}' in processMutation for ${message.description()}: ${e.message || e}`, e, message.serialize())\n        }\n        // we revert any changes to the contract state that occurred, ignoring this mutation\n        console.warn(`[chelonia] Error processing ${message.description()}: ${message.serialize()}. Any side effects will be skipped!`)\n        if (this.config.strictProcessing) {\n          throw e\n        }\n        processingErrored = e?.name !== 'ChelErrorWarning'\n        this.config.hooks.processError?.(e, message, getMsgMeta.call(this, message, contractID, contractStateCopy))\n        // special error that prevents the head from being updated, effectively killing the contract\n        if (\n          e.name === 'ChelErrorUnrecoverable' ||\n          e.name === 'ChelErrorForkedChain' ||\n          message.isFirstMessage()\n        ) {\n          throw e\n        }\n      }\n\n      // process any side-effects (these must never result in any mutation to the contract state!)\n      if (!processingErrored) {\n        // Gets run get when skipSideEffects is false\n        if (Array.isArray(internalSideEffectStack) && internalSideEffectStack.length > 0) {\n          await Promise.all(internalSideEffectStack.map(fn => Promise.resolve(fn({ state: contractStateCopy, message })).catch((e_) => {\n            const e = (e_        )\n            console.error(`[chelonia] ERROR '${e.name}' in internal side effect for ${message.description()}: ${e.message}`, e, { message: message.serialize() })\n          })))\n        }\n\n        if (!this.config.skipActionProcessing && !this.config.skipSideEffects) {\n          await handleEvent.processSideEffects.call(this, message, contractStateCopy)?.catch((e_) => {\n            const e = (e_        )\n            console.error(`[chelonia] ERROR '${e.name}' in sideEffect for ${message.description()}: ${e.message}`, e, { message: message.serialize() })\n            // We used to revert the state and rethrow the error here, but we no longer do that\n            // see this issue for why: https://github.com/okTurtles/group-income/issues/1544\n            this.config.hooks.sideEffectError?.(e, message)\n          })\n        }\n      }\n\n      // We keep changes to the contract state and state.contracts as close as\n      // possible in the code to reduce the chances of still ending up with\n      // an inconsistent state if a sudden failure happens while this code\n      // is executing. In particular, everything in between should be synchronous.\n      // This block will apply all the changes related to modifying the state\n      // after an event has been processed:\n      //   1. Adding the messge to the DB\n      //   2. Applying changes to the contract state\n      //   3. Applying changes to rootState.contracts\n      try {\n        const state = sbp(this.config.stateSelector)\n        await handleEvent.applyProcessResult.call(this, { message, state, contractState: contractStateCopy, processingErrored, postHandleEvent })\n      } catch (e_) {\n        const e = (e_        )\n        console.error(`[chelonia] ERROR '${e.name}' for ${message.description()} marking the event as processed: ${e.message}`, e, { message: message.serialize() })\n      }\n    } catch (e_) {\n      const e = (e_        )\n      console.error(`[chelonia] ERROR in handleEvent: ${e.message || e}`, e)\n      try {\n        handleEventError?.(e, message)\n      } catch (e2) {\n        console.error('[chelonia] Ignoring user error in handleEventError hook:', e2)\n      }\n      throw e\n    } finally {\n      if (message) {\n        missingDecryptionKeyIdsMap.delete(message)\n      }\n    }\n  }\n})          )\n\nconst eventsToReingest = []\nconst reprocessDebounced = debounce((contractID) => sbp('chelonia/private/out/sync', contractID, { force: true }).catch((e) => {\n  console.error(`[chelonia] Error at reprocessDebounced for ${contractID}`, e)\n}), 1000)\n\nconst handleEvent = {\n  checkMessageOrdering (message           ) {\n    const contractID = message.contractID()\n    const hash = message.hash()\n    const height = message.height()\n    const state = sbp(this.config.stateSelector)\n    // The latest height we want to use is the one from `state.contracts` and\n    // not the one from the DB. The height in the state reflects the latest\n    // message that's been processed, which is desired here. On the other hand,\n    // the DB function includes the latest known message for that contract,\n    // which can be ahead of the latest message processed.\n    const latestProcessedHeight = state.contracts[contractID]?.height\n    if (!Number.isSafeInteger(height)) {\n      throw new ChelErrorDBBadPreviousHEAD(`Message ${hash} in contract ${contractID} has an invalid height.`)\n    }\n    // Avoid re-processing already processed messages\n    if (\n      message.isFirstMessage()\n        // If this is the first message, the height is is expected not to exist\n        ? latestProcessedHeight != null\n        // If this isn't the first message, the height must not be lower than the\n        // current's message height. The check is negated to handle NaN values\n        : !(latestProcessedHeight < height)\n    ) {\n      // The web client may sometimes get repeated messages. If strict ordering\n      // isn't enabled, instead of throwing we return false.\n      // On the other hand, the server must enforce strict ordering.\n      if (!this.config.strictOrdering) {\n        return false\n      }\n      throw new ChelErrorAlreadyProcessed(`Message ${hash} with height ${height} in contract ${contractID} has already been processed. Current height: ${latestProcessedHeight}.`)\n    }\n    // If the message is from the future, add it to eventsToReingest\n    if ((latestProcessedHeight + 1) < height) {\n      if (this.config.strictOrdering) {\n        throw new ChelErrorDBBadPreviousHEAD(`Unexpected message ${hash} with height ${height} in contract ${contractID}: height is too high. Current height: ${latestProcessedHeight}.`)\n      }\n      // sometimes we simply miss messages, it's not clear why, but it happens\n      // in rare cases. So we attempt to re-sync this contract once\n      if (eventsToReingest.length > 100) {\n        throw new ChelErrorUnrecoverable('more than 100 different bad previousHEAD errors')\n      }\n      if (!eventsToReingest.includes(hash)) {\n        console.warn(`[chelonia] WARN bad previousHEAD for ${message.description()}, will attempt to re-sync contract to reingest message`)\n        eventsToReingest.push(hash)\n        reprocessDebounced(contractID)\n        return false // ignore the error for now\n      } else {\n        console.error(`[chelonia] ERROR already attempted to reingest ${message.description()}, will not attempt again!`)\n        throw new ChelErrorDBBadPreviousHEAD(`Already attempted to reingest ${hash}`)\n      }\n    }\n    const reprocessIdx = eventsToReingest.indexOf(hash)\n    if (reprocessIdx !== -1) {\n      console.warn(`[chelonia] WARN: successfully reingested ${message.description()}`)\n      eventsToReingest.splice(reprocessIdx, 1)\n    }\n  },\n  async processMutation (message           , state        , internalSideEffectStack        ) {\n    const contractID = message.contractID()\n    if (message.isFirstMessage()) {\n      // Allow having _volatile but nothing else if this is the first message,\n      // as we should be starting off with a clean state\n      if (Object.keys(state).some(k => k !== '_volatile')) {\n        throw new ChelErrorUnrecoverable(`state for ${contractID} is already set`)\n      }\n    }\n    await sbp('chelonia/private/in/processMessage', message, state, internalSideEffectStack)\n  },\n  processSideEffects (message           , state        ) {\n    const opT = message.opType()\n    if (![SPMessage.OP_ATOMIC, SPMessage.OP_ACTION_ENCRYPTED, SPMessage.OP_ACTION_UNENCRYPTED].includes(opT)) {\n      return\n    }\n\n    const contractID = message.contractID()\n    const manifestHash = message.manifest()\n    const hash = message.hash()\n    const height = message.height()\n    const signingKeyId = message.signingKeyId()\n\n    const callSideEffect = async (field) => {\n      const wv = this.config.unwrapMaybeEncryptedData(field)\n      if (!wv) return\n      let v = wv.data\n      let innerSigningKeyId                           \n      if (isSignedData(v)) {\n        innerSigningKeyId = (v     ).signingKeyId\n        v = (v     ).valueOf()\n      }\n\n      const { action, data, meta } = (v     )\n      const mutation = {\n        data,\n        meta,\n        hash,\n        height,\n        contractID,\n        description: message.description(),\n        direction: message.direction(),\n        signingKeyId,\n        get signingContractID () {\n          return getContractIDfromKeyId(contractID, signingKeyId, state)\n        },\n        innerSigningKeyId,\n        get innerSigningContractID () {\n          return getContractIDfromKeyId(contractID, innerSigningKeyId, state)\n        }\n      }\n      return await sbp(`${manifestHash}/${action}/sideEffect`, mutation, state)\n    }\n    const msg = Object(message.message())\n\n    if (opT !== SPMessage.OP_ATOMIC) {\n      return callSideEffect(msg)\n    }\n\n    const reducer = (acc, [opT, opV]) => {\n      if ([SPMessage.OP_ACTION_ENCRYPTED, SPMessage.OP_ACTION_UNENCRYPTED].includes(opT)) {\n        acc.push(Object(opV))\n      }\n      return acc\n    }\n\n    const actionsOpV = ((msg     )            ).reduce(reducer, [])\n\n    return Promise.allSettled(actionsOpV.map((action) => callSideEffect(action))).then((results) => {\n      const errors = results.filter((r) => r.status === 'rejected').map((r) => (r     ).reason)\n      if (errors.length > 0) {\n        console.error('Side-effect errors', contractID, errors)\n        // $FlowFixMe[cannot-resolve-name]\n        throw new AggregateError(errors, `Error at side effects for ${contractID}`)\n      }\n    })\n  },\n  async applyProcessResult ({ message, state, contractState, processingErrored, postHandleEvent }                                                                                                                      ) {\n    const contractID = message.contractID()\n    const hash = message.hash()\n    const height = message.height()\n\n    await sbp('chelonia/db/addEntry', message)\n    if (!processingErrored) {\n      // Once side-effects are called, we apply changes to the state.\n      // This means, as mentioned above, that retrieving the contract state\n      // via the global state will yield incorrect results. Doing things in\n      // this order ensures that incomplete processing of events (i.e., process\n      // + side-effects), e.g., due to sudden failures (like power outages,\n      // Internet being disconnected, etc.) aren't persisted. This allows\n      // us to recover by re-processing the event when these sudden failures\n      // happen\n      this.config.reactiveSet(state, contractID, contractState)\n\n      try {\n        postHandleEvent?.(message)\n      } catch (e) {\n        console.error(`[chelonia] ERROR '${e.name}' for ${message.description()} in event post-handling: ${e.message}`, e, { message: message.serialize() })\n      }\n    }\n    // whether or not there was an exception, we proceed ahead with updating the head\n    // you can prevent this by throwing an exception in the processError hook\n    if (message.isFirstMessage()) {\n      const { type } = ((message.opValue()     )              )\n      if (!has(state.contracts, contractID)) {\n        this.config.reactiveSet(state.contracts, contractID, Object.create(null))\n      }\n      this.config.reactiveSet(state.contracts[contractID], 'type', type)\n      console.debug(`contract ${type} registered for ${contractID}`)\n    }\n    if (message.isKeyOp()) {\n      this.config.reactiveSet(state.contracts[contractID], 'previousKeyOp', hash)\n    }\n    this.config.reactiveSet(state.contracts[contractID], 'HEAD', hash)\n    this.config.reactiveSet(state.contracts[contractID], 'height', height)\n    // If there were decryption errors due to missing encryption keys, we store\n    // those key IDs. If those key IDs are later shared with us, we can re-sync\n    // the contract. Without this information, we can only guess whether a\n    // re-sync is needed or not.\n    // We do it here because the property is stored under `.contracts` instead\n    // of in the contract state itself, and this is where `.contracts` gets\n    // updated after handling a message.\n    const missingDecryptionKeyIdsForMessage = missingDecryptionKeyIdsMap.get(message)\n    if (missingDecryptionKeyIdsForMessage) {\n      let missingDecryptionKeyIds = state.contracts[contractID].missingDecryptionKeyIds\n      if (!missingDecryptionKeyIds) {\n        missingDecryptionKeyIds = []\n        this.config.reactiveSet(state.contracts[contractID], 'missingDecryptionKeyIds', missingDecryptionKeyIds)\n      }\n      missingDecryptionKeyIdsForMessage.forEach(keyId => {\n        if (missingDecryptionKeyIds.includes(keyId)) return\n        missingDecryptionKeyIds.push(keyId)\n      })\n    }\n\n    if (!this.subscriptionSet.has(contractID)) {\n      const entry = this.pending.find((entry) => entry?.contractID === contractID)\n      // we've successfully received it back, so remove it from expectation pending\n      if (entry) {\n        const index = this.pending.indexOf(entry)\n        if (index !== -1) {\n          this.pending.splice(index, 1)\n        }\n      }\n      this.subscriptionSet.add(contractID)\n      sbp('okTurtles.events/emit', CONTRACTS_MODIFIED, Array.from(this.subscriptionSet), { added: [contractID], removed: [] })\n    }\n\n    if (!processingErrored) {\n      sbp('okTurtles.events/emit', hash, contractID, message)\n      sbp('okTurtles.events/emit', EVENT_HANDLED, contractID, message)\n    }\n  }\n}\n\nconst notImplemented = (v) => {\n  throw new Error(`chelonia: action not implemented to handle: ${JSON.stringify(v)}.`)\n}\n\n// The code below represents different ways to dynamically load code at runtime,\n// and the SES example shows how to sandbox runtime loaded code (although it doesn't\n// work, see https://github.com/endojs/endo/issues/1207 for details). It's also not\n// super important since we're loaded signed contracts.\n/*\n// https://2ality.com/2019/10/eval-via-import.html\n// Example: await import(esm`${source}`)\n// const esm = ({ raw }, ...vals) => {\n//   return URL.createObjectURL(new Blob([String.raw({ raw }, ...vals)], { type: 'text/javascript' }))\n// }\n\n// await loadScript.call(this, contractInfo.file, source, contractInfo.hash)\n//   .then(x => {\n//     console.debug(`loaded ${contractInfo.file}`)\n//     return x\n//   })\n// eslint-disable-next-line no-unused-vars\nfunction loadScript (file, source, hash) {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script')\n    // script.type = 'application/javascript'\n    script.type = 'module'\n    // problem with this is that scripts will step on each other's feet\n    script.text = source\n    // NOTE: this will work if the file route adds .header('Content-Type', 'application/javascript')\n    // script.src = `${this.config.connectionURL}/file/${hash}`\n    // this results in: \"SyntaxError: import declarations may only appear at top level of a module\"\n    // script.text = `(function () {\n    //   ${source}\n    // })()`\n    script.onload = () => resolve(script)\n    script.onerror = (err) => reject(new Error(`${err || 'Error'} trying to load: ${file}`))\n    document.getElementsByTagName('head')[0].appendChild(script)\n  })\n}\n\n// This code is cobbled together based on:\n// https://github.com/endojs/endo/blob/master/packages/ses/test/test-import-cjs.js\n// https://github.com/endojs/endo/blob/master/packages/ses/test/test-import.js\n//   const vm = await sesImportVM.call(this, `${this.config.connectionURL}/file/${contractInfo.hash}`)\n// eslint-disable-next-line no-unused-vars\nfunction sesImportVM (url): Promise<Object> {\n  // eslint-disable-next-line no-undef\n  const vm = new Compartment(\n    {\n      ...this.config.contracts.defaults.exposedGlobals,\n      console\n    },\n    {}, // module map\n    {\n      resolveHook (spec, referrer) {\n        console.debug('resolveHook', { spec, referrer })\n        return spec\n      },\n      // eslint-disable-next-line require-await\n      async importHook (moduleSpecifier: string, ...args) {\n        const source = await this.config.fetch(moduleSpecifier).then(handleFetchResult('text'))\n        console.debug('importHook', { fetch: moduleSpecifier, args, source })\n        const execute = (moduleExports, compartment, resolvedImports) => {\n          console.debug('execute called with:', { moduleExports, resolvedImports })\n          const functor = compartment.evaluate(\n            `(function (require, exports, module, __filename, __dirname) { ${source} })`\n            // this doesn't seem to help with: https://github.com/endojs/endo/issues/1207\n            // { __evadeHtmlCommentTest__: false, __rejectSomeDirectEvalExpressions__: false }\n          )\n          const require_ = (importSpecifier) => {\n            console.debug('in-source require called with:', importSpecifier, 'keying:', resolvedImports)\n            const namespace = compartment.importNow(resolvedImports[importSpecifier])\n            console.debug('got namespace:', namespace)\n            return namespace.default === undefined ? namespace : namespace.default\n          }\n          const module_ = {\n            get exports () {\n              return moduleExports\n            },\n            set exports (newModuleExports) {\n              moduleExports.default = newModuleExports\n            }\n          }\n          functor(require_, moduleExports, module_, moduleSpecifier)\n        }\n        if (moduleSpecifier === '@common/common.js') {\n          return {\n            imports: [],\n            exports: ['Vue', 'L'],\n            execute\n          }\n        } else {\n          return {\n            imports: ['@common/common.js'],\n            exports: [],\n            execute\n          }\n        }\n      }\n    }\n  )\n  // vm.evaluate(source)\n  return vm.import(url)\n}\n*/\n", "import sbp from '@sbp/sbp'\n\n// `wallBase` is the base used to calculate wall time (i.e., time elapsed as one\n// would get from, e.g., looking a clock hanging from a wall).\n// Although optimistically\n// it has a default value to local time, it'll be updated to the server's time\n// once `chelonia/private/startClockSync` is called\n// From Wikipedia: 'walltime is the actual time taken from the start of a\n// computer program to the end. In other words, it is the difference between\n// the time at which a task finishes and the time at which the task started.'\nlet wallBase = Date.now()\n// `monotonicBase` is the base used to calculate an offset to apply to `wallBase`\n// to estimate the server's current wall time.\nlet monotonicBase = performance.now()\n// `undefined` means the sync process has been stopped, `null` that the current\n// request has finished\nlet resyncTimeout\nlet watchdog\n\nconst syncServerTime = async function () {\n  // Get our current monotonic time\n  const startTime = performance.now()\n  // Now, ask the server for the time\n  const time = await this.config.fetch(`${this.config.connectionURL}/time`, { signal: this.abortController.signal })\n  const requestTimeElapsed = performance.now()\n  if (requestTimeElapsed - startTime > 8000) {\n    throw new Error('Error fetching server time: request took too long')\n  }\n  // If the request didn't succeed, report it\n  if (!time.ok) throw new Error('Error fetching server time')\n  const serverTime = (new Date(await time.text())).valueOf()\n  // If the value could not be parsed, report that as well\n  if (Number.isNaN(serverTime)) throw new Error('Unable to parse server time')\n  // Adjust `wallBase` based on the elapsed request time. We can't know\n  // how long it took for the server to respond, but we can estimate that it's\n  // about half the time from the moment we made the request.\n  const newMonotonicBase = performance.now()\n  wallBase =\n    serverTime +\n    (requestTimeElapsed - startTime) / 2 +\n    // Also take into account the time elapsed between `requestTimeElapsed`\n    // and this line (which should be very little)\n    (newMonotonicBase - requestTimeElapsed)\n  monotonicBase = newMonotonicBase\n}\n\nexport default (sbp('sbp/selectors/register', {\n  'chelonia/private/startClockSync': function () {\n    if (resyncTimeout !== undefined) {\n      throw new Error('chelonia/private/startClockSync has already been called')\n    }\n    // Default re-sync every 5 minutes\n    const resync = (delay         = 300000) => {\n      // If there's another time sync process in progress, don't do anything\n      if (resyncTimeout !== null) return\n      const timeout = setTimeout(() => {\n        // Get the server time\n        syncServerTime.call(this).then(() => {\n          // Mark the process as finished\n          if (resyncTimeout === timeout) resyncTimeout = null\n          // And then restart the listener\n          resync()\n        }).catch(e => {\n          // If there was an error, log it and possibly attempt again\n          if (resyncTimeout === timeout) {\n            // In this case, it was the current task that failed\n            resyncTimeout = null\n            console.error('Error re-syncing server time; will re-attempt in 5s', e)\n            // Call resync again, with a shorter delay\n            setTimeout(() => resync(0), 5000)\n          } else {\n            // If there is already another attempt, just log it\n            console.error('Error re-syncing server time; another attempt is in progress', e)\n          }\n        })\n      }, delay)\n      resyncTimeout = timeout\n    }\n\n    let wallLast = Date.now()\n    let monotonicLast = performance.now()\n\n    // Watchdog to ensure our time doesn't drift. Periodically check for\n    // differences between the elapsed wall time and the elapsed monotonic\n    // time\n    watchdog = setInterval(() => {\n      const wallNow = Date.now()\n      const monotonicNow = performance.now()\n      const difference = Math.abs(Math.abs((wallNow - wallLast)) - Math.abs((monotonicNow - monotonicLast)))\n      // Tolerate up to a 10ms difference\n      if (difference > 10) {\n        if (resyncTimeout != null) clearTimeout(resyncTimeout)\n        resyncTimeout = null\n        resync(0)\n      }\n      wallLast = wallNow\n      monotonicLast = monotonicNow\n    }, 10000)\n\n    // Start the sync process\n    resyncTimeout = null\n    resync(0)\n  },\n  'chelonia/private/stopClockSync': () => {\n    if (resyncTimeout !== undefined) {\n      if (watchdog != null) clearInterval(watchdog)\n      if (resyncTimeout != null) clearTimeout(resyncTimeout)\n      watchdog = undefined\n      resyncTimeout = undefined\n    }\n  },\n  // Get an estimate of the server's current time based on the time elapsed as\n  // measured locally (using a monotonic clock), which is used as an offset, and\n  // a previously retrieved server time. The time value is returned as a UNIX\n  // _millisecond_ timestamp (milliseconds since 1 Jan 1970 00:00:00 UTC)\n  'chelonia/time': function ()         {\n    const monotonicNow = performance.now()\n    const wallNow = wallBase - monotonicBase + monotonicNow\n    return Math.round(wallNow)\n  }\n})          )\n", "'use strict'\n\nimport '@sbp/okturtles.eventqueue'\nimport '@sbp/okturtles.events'\nimport sbp from '@sbp/sbp'\nimport { handleFetchResult } from '~/frontend/controller/utils/misc.js'\nimport { cloneDeep, delay, difference, has, intersection, merge, randomHexString, randomIntFromRange } from 'turtledash'\nimport { createCID, parseCID } from '~/shared/functions.js'\nimport { NOTIFICATION_TYPE, createClient } from '~/shared/pubsub.js'\n                                                                                                                                                                         \n                                           \nimport { EDWARDS25519SHA512BATCH, deserializeKey, keyId, keygen, serializeKey } from '@chelonia/crypto'\nimport { ChelErrorResourceGone, ChelErrorUnexpected, ChelErrorUnexpectedHttpResponseCode, ChelErrorUnrecoverable } from './errors.js'\nimport { CHELONIA_RESET, CONTRACTS_MODIFIED, CONTRACT_REGISTERED } from './events.js'\n// TODO: rename this to ChelMessage\nimport { SPMessage } from './SPMessage.js'\n                                         \nimport './chelonia-utils.js'\n                                                       \nimport { encryptedOutgoingData, encryptedOutgoingDataWithRawKey, isEncryptedData, maybeEncryptedIncomingData, unwrapMaybeEncryptedData } from './encryptedData.js'\nimport './files.js'\nimport './internals.js'\nimport { isSignedData, signedIncomingData, signedOutgoingData, signedOutgoingDataWithRawKey } from './signedData.js'\nimport './time-sync.js'\nimport { buildShelterAuthorizationHeader, checkCanBeGarbageCollected, clearObject, collectEventStream, eventsAfter, findForeignKeysByContractID, findKeyIdByName, findRevokedKeyIdsByName, findSuitableSecretKeyId, getContractIDfromKeyId, reactiveClearObject } from './utils.js'\n\n// TODO: define ChelContractType for /defineContract\n\n                             \n                       \n                                      \n               \n                       \n                             \n                                 \n                                         \n                                 \n           \n                                             \n                                              \n                                               \n                                                            \n                                              \n                                               \n                                               \n    \n                                                                                          \n \n\n                                \n                 \n                                      \n                     \n               \n                       \n                            \n                           \n                      \n           \n                                             \n                                              \n                                               \n    \n                                           \n                  \n \n\n                                \n                       \n                     \n                   \n                       \n           \n                                             \n                                              \n                                               \n    \n                                           \n                  \n \n\n                                \n                       \n                     \n                   \n                       \n           \n                                             \n                                              \n                                               \n    \n                                           \n                  \n \n\n                                   \n                       \n                     \n                      \n                       \n           \n                                             \n                                              \n                                               \n    \n                                           \n                  \n \n\n                                  \n                                 \n                                   \n                     \n                       \n                     \n                        \n                   \n           \n                                             \n                                              \n                                               \n    \n                                           \n                  \n \n\n                                    \n                                \n                                  \n                       \n                     \n                       \n                            \n                          \n                               \n                                      \n                               \n                                  \n                                                                      \n                                                                  \n                     \n           \n                                             \n                                              \n                                               \n    \n                                           \n                  \n \n\n                                            \n                       \n                     \n                           \n                       \n           \n                                             \n                                              \n                                               \n    \n                                           \n                  \n \n\n                                \n                                \n                                  \n                       \n                     \n                       \n                           \n           \n                                             \n                                              \n                                               \n    \n                                           \n \n\n                                        \n                                                                                                                                         \n                              \n\nexport { SPMessage }\n\nexport const ACTION_REGEX         = /^((([\\w.]+)\\/([^/]+))(?:\\/(?:([^/]+)\\/)?)?)\\w*/\n// ACTION_REGEX.exec('gi.contracts/group/payment/process')\n// 0 => 'gi.contracts/group/payment/process'\n// 1 => 'gi.contracts/group/payment/'\n// 2 => 'gi.contracts/group'\n// 3 => 'gi.contracts'\n// 4 => 'group'\n// 5 => 'payment'\n\nexport default (sbp('sbp/selectors/register', {\n  // https://www.wordnik.com/words/chelonia\n  // https://gitlab.okturtles.org/okturtles/group-income/-/wikis/E2E-Protocol/Framework.md#alt-names\n  'chelonia/_init': function () {\n    this.config = {\n      // TODO: handle connecting to multiple servers for federation\n      get connectionURL () { throw new Error('Invalid use of connectionURL before initialization') },\n      // override!\n      set connectionURL (value) { Object.defineProperty(this, 'connectionURL', { value, writable: true }) },\n      stateSelector: 'chelonia/private/state', // override to integrate with, for example, vuex\n      contracts: {\n        defaults: {\n          modules: {}, // '<module name>' => resolved module import\n          exposedGlobals: {},\n          allowedDomains: [],\n          allowedSelectors: [],\n          preferSlim: false\n        },\n        overrides: {}, // override default values per-contract\n        manifests: {} // override! contract names => manifest hashes\n      },\n      whitelisted: (action        )          => !!this.whitelistedActions[action],\n      reactiveSet: (obj, key, value) => { obj[key] = value; return value }, // example: set to Vue.set\n      fetch: (...args) => fetch(...args),\n      reactiveDel: (obj, key) => { delete obj[key] },\n      // acceptAllMessages disables checking whether we are expecting a message\n      // or not for processing\n      acceptAllMessages: false,\n      skipActionProcessing: false,\n      skipDecryptionAttempts: false,\n      skipSideEffects: false,\n      // Strict processing will treat all processing errors as unrecoverable\n      // This is useful, e.g., in the server, to prevent invalid messages from\n      // being added to the database\n      strictProcessing: false,\n      // Strict ordering will throw on past events with ChelErrorAlreadyProcessed\n      // Similarly, future events will not be reingested and will throw\n      // with ChelErrorDBBadPreviousHEAD\n      strictOrdering: false,\n      connectionOptions: {\n        maxRetries: Infinity, // See https://github.com/okTurtles/group-income/issues/1183\n        reconnectOnTimeout: true // can be enabled since we are not doing auth via web sockets\n      },\n      hooks: {\n        preHandleEvent: null, // async (message: SPMessage) => {}\n        postHandleEvent: null, // async (message: SPMessage) => {}\n        processError: null, // (e: Error, message: SPMessage) => {}\n        sideEffectError: null, // (e: Error, message: SPMessage) => {}\n        handleEventError: null, // (e: Error, message: SPMessage) => {}\n        syncContractError: null, // (e: Error, contractID: string) => {}\n        pubsubError: null // (e:Error, socket: Socket)\n      },\n      unwrapMaybeEncryptedData\n    }\n    // Used in publishEvent to cancel sending events after reset (logout)\n    this._instance = Object.create(null)\n    this.abortController = new AbortController()\n    this.state = {\n      contracts: {}, // contractIDs => { type, HEAD } (contracts we've subscribed to)\n      pending: [] // prevents processing unexpected data from a malicious server\n    }\n    this.manifestToContract = {}\n    this.whitelistedActions = {}\n    this.currentSyncs = Object.create(null)\n    this.postSyncOperations = Object.create(null)\n    this.sideEffectStacks = Object.create(null) // [contractID]: Array<*>\n    this.sideEffectStack = (contractID        )           => {\n      let stack = this.sideEffectStacks[contractID]\n      if (!stack) {\n        this.sideEffectStacks[contractID] = stack = []\n      }\n      return stack\n    }\n    // setPostSyncOp defines operations to be run after all recent events have\n    // been processed. This is useful, for example, when responding to\n    // OP_KEY_REQUEST, as we want to send an OP_KEY_SHARE only to yet-unanswered\n    // requests, which is information in the future (from the point of view of\n    // the event handler).\n    // We could directly enqueue the operations, but by using a map we avoid\n    // enqueueing more operations than necessary\n    // The operations defined here will be executed:\n    //   (1) After a call to /sync or /syncContract; or\n    //   (2) After an event has been handled, if it was received on a web socket\n    this.setPostSyncOp = (contractID        , key        , op          ) => {\n      this.postSyncOperations[contractID] = this.postSyncOperations[contractID] || Object.create(null)\n      this.postSyncOperations[contractID][key] = op\n    }\n    const secretKeyGetter = (o, p) => {\n      if (has(o, p)) return o[p]\n      const rootState = sbp(this.config.stateSelector)\n      if (rootState?.secretKeys && has(rootState.secretKeys, p)) {\n        const key = deserializeKey(rootState.secretKeys[p])\n        o[p] = key\n        return key\n      }\n    }\n    const secretKeyList = (o) => {\n      const rootState = sbp(this.config.stateSelector)\n      const stateKeys = Object.keys(rootState?.secretKeys || {})\n      return Array.from(new Set([...Object.keys(o), ...stateKeys]))\n    }\n    this.transientSecretKeys = new Proxy(Object.create(null), {\n      get: secretKeyGetter,\n      ownKeys: secretKeyList\n    })\n    this.ephemeralReferenceCount = Object.create(null)\n    // subscriptionSet includes all the contracts in state.contracts for which\n    // we can process events (contracts for which we have called /sync)\n    // The reason we can't use, e.g., Object.keys(state.contracts), is that\n    // when resetting the state (calling /reset, e.g., after logging out) we may\n    // still receive events for old contracts that belong to the old session.\n    // Those events must be ignored or discarded until the new session is set up\n    // (i.e., login has finished running) because we don't necessarily have\n    // all the information needed to process events in those contracts, such as\n    // secret keys.\n    // A concrete example is:\n    //   1. user1 logs in to the group and rotates the group keys, then logs out\n    //   2. user2 logs in to the group.\n    //   3. If an event came over the web socket for the group, we must not\n    //      process it before we've processed the OP_KEY_SHARE containing the\n    //      new keys, or else we'll build an incorrect state.\n    // The example above is simplified, but this is even more of an issue\n    // when there is a third contract (for example, a group chatroom) using\n    // those rotated keys as foreign keys.\n    this.subscriptionSet = new Set()\n    // pending includes contracts that are scheduled for syncing or in the\n    // process of syncing for the first time. After sync completes for the\n    // first time, they are removed from pending and added to subscriptionSet\n    this.pending = []\n  },\n  'chelonia/config': function () {\n    return {\n      ...cloneDeep(this.config),\n      fetch: this.config.fetch,\n      reactiveSet: this.config.reactiveSet,\n      reactiveDel: this.config.reactiveDel\n    }\n  },\n  'chelonia/configure': async function (config        ) {\n    merge(this.config, config)\n    // merge will strip the hooks off of config.hooks when merging from the root of the object\n    // because they are functions and cloneDeep doesn't clone functions\n    Object.assign(this.config.hooks, config.hooks || {})\n    // using Object.assign here instead of merge to avoid stripping away imported modules\n    if (config.contracts) {\n      Object.assign(this.config.contracts.defaults, config.contracts.defaults || {})\n      const manifests = this.config.contracts.manifests\n      console.debug('[chelonia] preloading manifests:', Object.keys(manifests))\n      for (const contractName in manifests) {\n        await sbp('chelonia/private/loadManifest', contractName, manifests[contractName])\n      }\n    }\n    if (has(config, 'skipDecryptionAttempts')) {\n      if (config.skipDecryptionAttempts) {\n        this.config.unwrapMaybeEncryptedData = (data) => {\n          if (!isEncryptedData(data)) {\n            return {\n              encryptionKeyId: null, data\n            }\n          }\n        }\n      } else {\n        this.config.unwrapMaybeEncryptedData = unwrapMaybeEncryptedData\n      }\n    }\n  },\n  'chelonia/reset': async function (newState, postCleanupFn) {\n    // Allow optional newState OR postCleanupFn\n    if (typeof newState === 'function' && typeof postCleanupFn === 'undefined') {\n      postCleanupFn = newState\n      newState = undefined\n    }\n    if (this.pubsub) {\n      sbp('chelonia/private/stopClockSync')\n    }\n    // wait for any pending sync operations to finish before saving\n    Object.keys(this.postSyncOperations).forEach(cID => {\n      sbp('chelonia/private/enqueuePostSyncOps', cID)\n    })\n    await sbp('chelonia/contract/waitPublish')\n    await sbp('chelonia/contract/wait')\n    // do this again to catch operations that are the result of side-effects\n    // or post sync ops\n    Object.keys(this.postSyncOperations).forEach(cID => {\n      sbp('chelonia/private/enqueuePostSyncOps', cID)\n    })\n    await sbp('chelonia/contract/waitPublish')\n    await sbp('chelonia/contract/wait')\n    const result = await postCleanupFn?.()\n    // The following are all synchronous operations\n    const rootState = sbp(this.config.stateSelector)\n    // Cancel all outgoing messages by replacing this._instance\n    this._instance = Object.create(null)\n    this.abortController.abort()\n    this.abortController = new AbortController()\n    // Remove all contracts, including all contracts from pending\n    reactiveClearObject(rootState, this.config.reactiveDel)\n    this.config.reactiveSet(rootState, 'contracts', Object.create(null))\n    clearObject(this.ephemeralReferenceCount)\n    this.pending.splice(0)\n    clearObject(this.currentSyncs)\n    clearObject(this.postSyncOperations)\n    clearObject(this.sideEffectStacks)\n    const removedContractIDs = Array.from(this.subscriptionSet)\n    this.subscriptionSet.clear()\n    sbp('chelonia/clearTransientSecretKeys')\n    sbp('okTurtles.events/emit', CHELONIA_RESET)\n    sbp('okTurtles.events/emit', CONTRACTS_MODIFIED, Array.from(this.subscriptionSet), { added: [], removed: removedContractIDs })\n    if (this.pubsub) {\n      sbp('chelonia/private/startClockSync')\n    }\n    if (newState) {\n      Object.entries(newState).forEach(([key, value]) => {\n        this.config.reactiveSet(rootState, key, value)\n      })\n    }\n    return result\n  },\n  'chelonia/storeSecretKeys': function (wkeys                                                    ) {\n    const rootState = sbp(this.config.stateSelector)\n    if (!rootState.secretKeys) this.config.reactiveSet(rootState, 'secretKeys', Object.create(null))\n    let keys = wkeys.valueOf()\n    if (!keys) return\n    if (!Array.isArray(keys)) keys = [keys]\n    keys.forEach(({ key, transient }) => {\n      if (!key) return\n      if (typeof key === 'string') {\n        key = deserializeKey(key)\n      }\n      const id = keyId(key)\n      // Store transient keys transientSecretKeys\n      if (!has(this.transientSecretKeys, id)) {\n        this.transientSecretKeys[id] = key\n      }\n      if (transient) return\n      // If the key is marked as persistent, write it to the state as well\n      if (!has(rootState.secretKeys, id)) {\n        this.config.reactiveSet(rootState.secretKeys, id, serializeKey(key, true))\n      }\n    })\n  },\n  'chelonia/clearTransientSecretKeys': function (ids           ) {\n    if (Array.isArray(ids)) {\n      ids.forEach((id) => {\n        delete this.transientSecretKeys[id]\n      })\n    } else {\n      Object.keys(this.transientSecretKeys).forEach((id) => {\n        delete this.transientSecretKeys[id]\n      })\n    }\n  },\n  'chelonia/haveSecretKey': function (keyId        , persistent          ) {\n    if (!persistent && has(this.transientSecretKeys, keyId)) return true\n    const rootState = sbp(this.config.stateSelector)\n    return !!rootState?.secretKeys && has(rootState.secretKeys, keyId)\n  },\n  'chelonia/contract/isResyncing': function (contractIDOrState                 ) {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    return !!contractIDOrState?._volatile?.dirty || !!contractIDOrState?._volatile?.resyncing\n  },\n  'chelonia/contract/hasKeyShareBeenRespondedBy': function (contractIDOrState                  , requestedToContractID        , reference         )          {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const result = Object.values(contractIDOrState?._vm.authorizedKeys || {}).some((r) => {\n      // $FlowFixMe[incompatible-use]\n      return r?.meta?.keyRequest?.responded && r.meta.keyRequest.contractID === requestedToContractID && (!reference || r.meta.keyRequest.reference === reference)\n    })\n\n    return result\n  },\n  'chelonia/contract/waitingForKeyShareTo': function (contractIDOrState                 , requestingContractID         , reference         )                  {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const result = contractIDOrState._volatile?.pendingKeyRequests\n      ?.filter((r) => {\n        return r && (!requestingContractID || r.contractID === requestingContractID) && (!reference || r.reference === reference)\n      })\n      ?.map(({ name }) => name)\n\n    if (!result?.length) return null\n    return result\n  },\n  'chelonia/contract/successfulKeySharesByContractID': function (contractIDOrState                 , requestingContractID         ) {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const keyShares = Object.values(contractIDOrState._vm.keyshares || {})\n    if (!keyShares?.length) return\n    const result = Object.create(null)\n    // $FlowFixMe[incompatible-call]\n    keyShares.forEach((kS                                                                        ) => {\n      if (!kS.success) return\n      if (requestingContractID && kS.contractID !== requestingContractID) return\n      if (!result[kS.contractID]) result[kS.contractID] = []\n      result[kS.contractID].push({ height: kS.height, hash: kS.hash })\n    })\n    Object.keys(result).forEach(cID => {\n      result[cID].sort((a, b) => {\n        return b.height - a.height\n      })\n    })\n    return result\n  },\n  'chelonia/contract/hasKeysToPerformOperation': function (contractIDOrState                 , operation        ) {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const op = (operation !== '*') ? [operation] : operation\n    return !!findSuitableSecretKeyId(contractIDOrState, op, ['sig'])\n  },\n  // Did sourceContractIDOrState receive an OP_KEY_SHARE to perform the given\n  // operation on contractIDOrState?\n  'chelonia/contract/receivedKeysToPerformOperation': function (sourceContractIDOrState                 , contractIDOrState                 , operation        ) {\n    const rootState = sbp(this.config.stateSelector)\n    if (typeof sourceContractIDOrState === 'string') {\n      sourceContractIDOrState = rootState[sourceContractIDOrState]\n    }\n    if (typeof contractIDOrState === 'string') {\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const op = (operation !== '*') ? [operation] : operation\n    const keyId = findSuitableSecretKeyId(contractIDOrState, op, ['sig'])\n\n    return sourceContractIDOrState?._vm?.sharedKeyIds?.some((sK) => sK.id === keyId)\n  },\n  'chelonia/contract/currentKeyIdByName': function (contractIDOrState                 , name        , requireSecretKey          ) {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const currentKeyId = findKeyIdByName(contractIDOrState, name)\n    if (requireSecretKey && !sbp('chelonia/haveSecretKey', currentKeyId)) {\n      return\n    }\n    return currentKeyId\n  },\n  'chelonia/contract/foreignKeysByContractID': function (contractIDOrState                 , foreignContractID        ) {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    return findForeignKeysByContractID(contractIDOrState, foreignContractID)\n  },\n  'chelonia/contract/historicalKeyIdsByName': function (contractIDOrState                 , name        ) {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const currentKeyId = findKeyIdByName(contractIDOrState, name)\n    const revokedKeyIds = findRevokedKeyIdsByName(contractIDOrState, name)\n    return currentKeyId ? [currentKeyId, ...revokedKeyIds] : revokedKeyIds\n  },\n  'chelonia/contract/suitableSigningKey': function (contractIDOrState                 , permissions, purposes, ringLevel, allowedActions) {\n    if (typeof contractIDOrState === 'string') {\n      const rootState = sbp(this.config.stateSelector)\n      contractIDOrState = rootState[contractIDOrState]\n    }\n    const keyId = findSuitableSecretKeyId(contractIDOrState, permissions, purposes, ringLevel, allowedActions)\n    return keyId\n  },\n  'chelonia/contract/setPendingKeyRevocation': function (contractID        , names          ) {\n    const rootState = sbp(this.config.stateSelector)\n    const state = rootState[contractID]\n\n    if (!state._volatile) this.config.reactiveSet(state, '_volatile', Object.create(null))\n    if (!state._volatile.pendingKeyRevocations) this.config.reactiveSet(state._volatile, 'pendingKeyRevocations', Object.create(null))\n\n    for (const name of names) {\n      const keyId = findKeyIdByName(state, name)\n      if (keyId) {\n        this.config.reactiveSet(state._volatile.pendingKeyRevocations, keyId, true)\n      } else {\n        console.warn('[setPendingKeyRevocation] Unable to find keyId for name', { contractID, name })\n      }\n    }\n  },\n  'chelonia/shelterAuthorizationHeader' (contractID        ) {\n    return buildShelterAuthorizationHeader.call(this, contractID)\n  },\n  // The purpose of the 'chelonia/crypto/*' selectors is so that they can be called\n  // from contracts without including the crypto code (i.e., importing crypto.js)\n  // This function takes a function as a parameter that returns a string\n  // It does not a string directly to prevent accidentally logging the value,\n  // which is a secret\n  'chelonia/crypto/keyId': (inKey                      ) => {\n    return keyId(inKey.valueOf())\n  },\n  // TODO: allow connecting to multiple servers at once\n  'chelonia/connect': function (options = {})         {\n    if (!this.config.connectionURL) throw new Error('config.connectionURL missing')\n    if (!this.config.connectionOptions) throw new Error('config.connectionOptions missing')\n    if (this.pubsub) {\n      this.pubsub.destroy()\n    }\n    let pubsubURL = this.config.connectionURL\n    if (process.env.NODE_ENV === 'development') {\n      // This is temporarily used in development mode to help the server improve\n      // its console output until we have a better solution. Do not use for auth.\n      pubsubURL += `?debugID=${randomHexString(6)}`\n    }\n    if (this.pubsub) {\n      sbp('chelonia/private/stopClockSync')\n    }\n    sbp('chelonia/private/startClockSync')\n    this.pubsub = createClient(pubsubURL, {\n      ...this.config.connectionOptions,\n      handlers: {\n        ...options.handlers,\n        // Every time we get a REQUEST_TYPE.SUB response, which happens for\n        // 'new' subscriptions as well as every time the connection is reset\n        'subscription-succeeded': function (event) {\n          const { channelID } = event.detail\n          // The check below is needed because we could have unsubscribed since\n          // requesting a subscription from the server. In that case, we don't\n          // need to call `sync`.\n          if (this.subscriptionSet.has(channelID)) {\n            // For new subscriptions, some messages could have been lost\n            // between the time the subscription was requested and it was\n            // actually set up. In these cases, force sync contracts to get them\n            // updated.\n            sbp('chelonia/private/out/sync', channelID, { force: true }).catch(err => {\n              console.warn(`[chelonia] Syncing contract ${channelID} failed: ${err.message}`)\n            })\n          }\n          options.handlers?.['subscription-succeeded']?.call(this, event)\n        }\n      },\n      // Map message handlers to transparently handle encryption and signatures\n      messageHandlers: {\n        ...(Object.fromEntries(\n          Object.entries(options.messageHandlers || {}).map(([k, v]) => {\n            switch (k) {\n              case NOTIFICATION_TYPE.PUB:\n                return [k, (msg) => {\n                  if (!msg.channelID) {\n                    console.info('[chelonia] Discarding pub event without channelID')\n                    return\n                  }\n                  if (!this.subscriptionSet.has(msg.channelID)) {\n                    console.info(`[chelonia] Discarding pub event for ${msg.channelID} because it's not in the current subscriptionSet`)\n                    return\n                  }\n                  sbp('chelonia/queueInvocation', msg.channelID, () => {\n                    (v          ).call(this.pubsub, parseEncryptedOrUnencryptedMessage(this, {\n                      contractID: msg.channelID,\n                      serializedData: msg.data\n                    }))\n                  }).catch(e => {\n                    console.error(`[chelonia] Error processing pub event for ${msg.channelID}`, e)\n                  })\n                }]\n              case NOTIFICATION_TYPE.KV:\n                return [k, (msg) => {\n                  if (!msg.channelID || !msg.key) {\n                    console.info('[chelonia] Discarding kv event without channelID or key')\n                    return\n                  }\n                  if (!this.subscriptionSet.has(msg.channelID)) {\n                    console.info(`[chelonia] Discarding kv event for ${msg.channelID} because it's not in the current subscriptionSet`)\n                    return\n                  }\n                  sbp('chelonia/queueInvocation', msg.channelID, () => {\n                    (v          ).call(this.pubsub, [msg.key, parseEncryptedOrUnencryptedMessage(this, {\n                      contractID: msg.channelID,\n                      meta: msg.key,\n                      serializedData: JSON.parse(Buffer.from(msg.data).toString())\n                    })])\n                  }).catch(e => {\n                    console.error(`[chelonia] Error processing kv event for ${msg.channelID} and key ${msg.key}`, msg, e)\n                  })\n                }]\n              case NOTIFICATION_TYPE.DELETION:\n                return [k, (msg) => (v          ).call(this.pubsub, msg.data)]\n              default:\n                return [k, v]\n            }\n          })\n        )),\n        [NOTIFICATION_TYPE.ENTRY] (msg) {\n          // We MUST use 'chelonia/private/in/enqueueHandleEvent' to ensure handleEvent()\n          // is called AFTER any currently-running calls to 'chelonia/private/out/sync'\n          // to prevent gi.db from throwing \"bad previousHEAD\" errors.\n          // Calling via SBP also makes it simple to implement 'test/backend.js'\n          const { contractID } = SPMessage.deserializeHEAD(msg.data)\n          sbp('chelonia/private/in/enqueueHandleEvent', contractID, msg.data)\n        }\n      }\n    })\n    if (!this.contractsModifiedListener) {\n      // Keep pubsub in sync (logged into the right \"rooms\") with 'state.contracts'\n      this.contractsModifiedListener = () => sbp('chelonia/pubsub/update')\n      sbp('okTurtles.events/on', CONTRACTS_MODIFIED, this.contractsModifiedListener)\n    }\n    return this.pubsub\n  },\n  // This selector is defined primarily for ingesting web push notifications,\n  // although it can be used as a general-purpose API to process events received\n  // from other external sources that are not managed by Chelonia itself (i.e. sources\n  // other than the Chelonia-managed websocket connection and RESTful API).\n  'chelonia/handleEvent': async function (event        ) {\n    const { contractID } = SPMessage.deserializeHEAD(event)\n    return await sbp('chelonia/private/in/enqueueHandleEvent', contractID, event)\n  },\n  'chelonia/defineContract': function (contract        ) {\n    if (!ACTION_REGEX.exec(contract.name)) throw new Error(`bad contract name: ${contract.name}`)\n    if (!contract.metadata) contract.metadata = { validate () {}, create: () => ({}) }\n    if (!contract.getters) contract.getters = {}\n    contract.state = (contractID) => sbp(this.config.stateSelector)[contractID]\n    contract.manifest = this.defContractManifest\n    contract.sbp = this.defContractSBP\n    this.defContractSelectors = []\n    this.defContract = contract\n    this.defContractSelectors.push(...sbp('sbp/selectors/register', {\n      // expose getters for Vuex integration and other conveniences\n      [`${contract.manifest}/${contract.name}/getters`]: () => contract.getters,\n      // 2 ways to cause sideEffects to happen: by defining a sideEffect function in the\n      // contract, or by calling /pushSideEffect w/async SBP call. Can also do both.\n      [`${contract.manifest}/${contract.name}/pushSideEffect`]: (contractID        , asyncSbpCall          ) => {\n        // if this version of the contract is pushing a sideEffect to a function defined by the\n        // contract itself, make sure that it calls the same version of the sideEffect\n        const [sel] = asyncSbpCall\n        if (sel.startsWith(contract.name + '/')) {\n          asyncSbpCall[0] = `${contract.manifest}/${sel}`\n        }\n        this.sideEffectStack(contractID).push(asyncSbpCall)\n      }\n    }))\n    for (const action in contract.actions) {\n      contractNameFromAction(action) // ensure actions are appropriately named\n      this.whitelistedActions[action] = true\n      // TODO: automatically generate send actions here using `${action}/send`\n      //       allow the specification of:\n      //       - the optype (e.g. OP_ACTION_(UN)ENCRYPTED)\n      //       - a localized error message\n      //       - whatever keys should be passed in as well\n      //       base it off of the design of encryptedAction()\n      this.defContractSelectors.push(...sbp('sbp/selectors/register', {\n        [`${contract.manifest}/${action}/process`]: async (message        , state        ) => {\n          const { meta, data, contractID } = message\n          // TODO: optimize so that you're creating a proxy object only when needed\n          // TODO: Note: when sandboxing contracts, contracts may not have\n          // access to the state directly, meaning that modifications would need\n          // to be re-applied\n          state = state || contract.state(contractID)\n          const gProxy = gettersProxy(state, contract.getters)\n          // These `await` are here to help with sandboxing in the future\n          // Sandboxing may mean that contracts are executed in another context\n          // (e.g., a worker), which would require asynchronous communication\n          // between Chelonia and the contract.\n          // Even though these are asynchronous calls, contracts should not\n          // call side effects from these functions\n          await contract.metadata.validate(meta, { state, ...gProxy, contractID })\n\n          await contract.actions[action].validate(data, { state, ...gProxy, meta, message, contractID })\n          // it's possible that the sideEffect stack got filled up by the call to `processMessage` from\n          // a call to `publishEvent` (when an outgoing message is being sent).\n          this.sideEffectStacks[contractID] = []\n          await contract.actions[action].process(message, { state, ...gProxy })\n        },\n        // 'mutation' is an object that's similar to 'message', but not identical\n        [`${contract.manifest}/${action}/sideEffect`]: async (mutation        , state         ) => {\n          if (contract.actions[action].sideEffect) {\n            state = state || contract.state(mutation.contractID)\n            if (!state) {\n              console.warn(`[${contract.manifest}/${action}/sideEffect]: Skipping side-effect since there is no contract state for contract ${mutation.contractID}`)\n              return\n            }\n            // TODO: Copy to simulate a sandbox boundary without direct access\n            // as well as to enforce the rule that side-effects must not mutate\n            // state\n            const stateCopy = cloneDeep(state)\n            const gProxy = gettersProxy(stateCopy, contract.getters)\n            await contract.actions[action].sideEffect(mutation, { state: stateCopy, ...gProxy })\n          }\n          // since both /process and /sideEffect could call /pushSideEffect, we make sure\n          // to process the side effects on the stack after calling /sideEffect.\n          const sideEffects = this.sideEffectStack(mutation.contractID)\n          while (sideEffects.length > 0) {\n            const sideEffect = sideEffects.shift()\n            try {\n              await contract.sbp(...sideEffect)\n            } catch (e_) {\n              const e = (e_        )\n              console.error(`[chelonia] ERROR: '${e.name}' ${e.message}, for pushed sideEffect of ${mutation.description}:`, sideEffect)\n              this.sideEffectStacks[mutation.contractID] = [] // clear the side effects\n              throw e\n            }\n          }\n        }\n      }))\n    }\n    for (const method in contract.methods) {\n      this.defContractSelectors.push(...sbp('sbp/selectors/register', {\n        [`${contract.manifest}/${method}`]: contract.methods[method]\n      }))\n    }\n    sbp('okTurtles.events/emit', CONTRACT_REGISTERED, contract)\n  },\n  'chelonia/queueInvocation': (contractID, sbpInvocation) => {\n    // We maintain two queues, contractID, used for internal events (i.e.,\n    // from chelonia) and public:contractID, used for operations that need to\n    // be done after all the current internal events (if any) have\n    // finished processing.\n    // Once all of the current internal events (in the contractID queue)\n    // have completed, the operation requested is put into the public queue.\n    // The reason for maintaining two different queues is to provide users\n    // a way to run operations after internal operations have been processed\n    // (for example, a side-effect might call queueInvocation to do work\n    // after the current and future events have been processed), without the\n    // work in these user-functions blocking Chelonia and prventing it from\n    // processing events.\n    // For example, a contract could have an action called\n    // 'example/setProfilePicture'. The side-effect could look like this:\n    //\n    //    sideEffect ({ data, contractID }, { state }) {\n    //      const profilePictureUrl = data.url\n    //\n    //      sbp('chelonia/queueInvocation', contractID, () => {\n    //        const rootState = sbp('state/vuex/state')\n    //        if  (rootState[contractID].profilePictureUrl !== profilePictureUrl)\n    //          return // The profile picture changed, so we do nothing\n    //\n    //        // The following could take a long time. We want Chelonia\n    //        // to still work and process events as normal.\n    //        return this.config.fetch(profilePictureUrl).then(doSomeWorkWithTheFile)\n    //      })\n    //    }\n    return sbp('chelonia/private/queueEvent', contractID, ['chelonia/private/noop']).then(() => sbp('chelonia/private/queueEvent', 'public:' + contractID, sbpInvocation))\n  },\n  'chelonia/begin': async (...invocations) => {\n    for (const invocation of invocations) {\n      await sbp(...invocation)\n    }\n  },\n  // call this manually to resubscribe/unsubscribe from contracts as needed\n  // if you are using a custom stateSelector and reload the state (e.g. upon login)\n  'chelonia/pubsub/update': function () {\n    const client = this.pubsub\n    const subscribedIDs = [...client.subscriptionSet]\n    const currentIDs = Array.from(this.subscriptionSet)\n    const leaveSubscribed = intersection(subscribedIDs, currentIDs)\n    const toUnsubscribe = difference(subscribedIDs, leaveSubscribed)\n    const toSubscribe = difference(currentIDs, leaveSubscribed)\n    // There is currently no need to tell other clients about our sub/unsubscriptions.\n    try {\n      for (const contractID of toUnsubscribe) {\n        client.unsub(contractID)\n      }\n      for (const contractID of toSubscribe) {\n        client.sub(contractID)\n      }\n    } catch (e) {\n      console.error(`[chelonia] pubsub/update: error ${e.name}: ${e.message}`, { toUnsubscribe, toSubscribe }, e)\n      this.config.hooks.pubsubError?.(e, client)\n    }\n  },\n  // resolves when all pending actions for these contractID(s) finish\n  'chelonia/contract/wait': function (contractIDs                    )             {\n    const listOfIds = contractIDs\n      ? (typeof contractIDs === 'string' ? [contractIDs] : contractIDs)\n      : Object.keys(sbp(this.config.stateSelector).contracts)\n    return Promise.all(listOfIds.flatMap(cID => {\n      return sbp('chelonia/queueInvocation', cID, ['chelonia/private/noop'])\n    }))\n  },\n  // resolves when all pending *writes* for these contractID(s) finish\n  'chelonia/contract/waitPublish': function (contractIDs                    )             {\n    const listOfIds = contractIDs\n      ? (typeof contractIDs === 'string' ? [contractIDs] : contractIDs)\n      : Object.keys(sbp(this.config.stateSelector).contracts)\n    return Promise.all(listOfIds.flatMap(cID => {\n      return sbp('chelonia/private/queueEvent', `publish:${cID}`, ['chelonia/private/noop'])\n    }))\n  },\n  // 'chelonia/contract' - selectors related to injecting remote data and monitoring contracts\n  // TODO: add an optional parameter to \"retain\" the contract (see #828)\n  // eslint-disable-next-line require-await\n  'chelonia/contract/sync': async function (contractIDs                   , params                       )             {\n    // The exposed `chelonia/contract/sync` selector is meant for users of\n    // Chelonia and not for internal use within Chelonia.\n    // It should only be called after `/retain` where needed (for example, when\n    // starting up Chelonia with a saved state)\n    const listOfIds = typeof contractIDs === 'string' ? [contractIDs] : contractIDs\n    // Verify that there's a valid reference count\n    listOfIds.forEach((id) => {\n      if (checkCanBeGarbageCollected.call(this, id)) {\n        if (process.env.CI) {\n          Promise.reject(new Error('[chelonia] Missing reference count for contract ' + id))\n        }\n        console.error('[chelonia] Missing reference count for contract ' + id)\n        throw new Error('Missing reference count for contract')\n      }\n    })\n    // Call the internal sync selector. `force` is always true as using `/sync`\n    // besides internally is only needed to force sync a contract\n    return sbp('chelonia/private/out/sync', listOfIds, { ...params, force: true })\n  },\n  'chelonia/contract/isSyncing': function (contractID        , { firstSync = false } = {})          {\n    const isSyncing = !!this.currentSyncs[contractID]\n    return firstSync\n      ? isSyncing && this.currentSyncs[contractID].firstSync\n      : isSyncing\n  },\n  'chelonia/contract/currentSyncs': function () {\n    return Object.keys(this.currentSyncs)\n  },\n  // Because `/remove` is done asynchronously and a contract might be removed\n  // much later than when the call to remove was made, an optional callback\n  // can be passed to verify whether to proceed with removal. This is used as\n  // part of the `/release` mechanism to prevent removing contracts that have\n  // acquired new references since the call to `/remove`.\n  'chelonia/contract/remove': function (\n    contractIDs                   ,\n    { confirmRemovalCallback, permanent }   \n                                                               \n                        \n      = {}\n  )             {\n    const rootState = sbp(this.config.stateSelector)\n    const listOfIds = typeof contractIDs === 'string' ? [contractIDs] : contractIDs\n    return Promise.all(listOfIds.map(contractID => {\n      if (!rootState?.contracts?.[contractID]) {\n        return undefined\n      }\n\n      return sbp('chelonia/private/queueEvent', contractID, () => {\n        // This allows us to double-check that the contract is meant to be\n        // removed, as circumstances could have changed from the time remove\n        // was called and this function is executed. For example, `/release`\n        // makes a synchronous check, but processing of other events since\n        // require this to be re-checked (in this case, for reference counts).\n        if (confirmRemovalCallback && !confirmRemovalCallback(contractID)) {\n          return\n        }\n        const rootState = sbp(this.config.stateSelector)\n        const fkContractIDs = Array.from(new Set(Object.values(rootState[contractID]?._vm?.authorizedKeys ?? {}).filter((k) => {\n          return !!(k     ).foreignKey\n        }).map((k) => {\n          try {\n            const fkUrl = new URL((k     ).foreignKey)\n            return fkUrl.pathname\n          } catch {\n            return undefined\n          }\n        }).filter(Boolean)))\n\n        sbp('chelonia/private/removeImmediately', contractID, { permanent })\n\n        if (fkContractIDs.length) {\n          // Attempt to release all contracts that are being monitored for\n          // foreign keys\n          sbp('chelonia/contract/release', fkContractIDs, { try: true }).catch((e) => {\n            console.error('[chelonia] Error attempting to release foreign key contracts', e)\n          })\n        }\n      })\n    }))\n  },\n  'chelonia/contract/retain': async function (contractIDs                   , params                         )             {\n    const listOfIds = typeof contractIDs === 'string' ? [contractIDs] : contractIDs\n    const rootState = sbp(this.config.stateSelector)\n    if (listOfIds.length === 0) return Promise.resolve()\n    const checkIfDeleted = (id) => {\n      // Contract has been permanently deleted\n      if (rootState.contracts[id] === null) {\n        console.error('[chelonia/contract/retain] Called /retain on permanently deleted contract.', id)\n        throw new ChelErrorResourceGone('Unable to retain permanently deleted contract ' + id)\n      }\n    }\n    if (!params?.ephemeral) {\n      listOfIds.forEach((id) => {\n        checkIfDeleted(id)\n        if (!has(rootState.contracts, id)) {\n          this.config.reactiveSet(rootState.contracts, id, Object.create(null))\n        }\n        this.config.reactiveSet(rootState.contracts[id], 'references', (rootState.contracts[id].references ?? 0) + 1)\n      })\n    } else {\n      listOfIds.forEach((id) => {\n        checkIfDeleted(id)\n        if (!has(this.ephemeralReferenceCount, id)) {\n          this.ephemeralReferenceCount[id] = 1\n        } else {\n          this.ephemeralReferenceCount[id] = this.ephemeralReferenceCount[id] + 1\n        }\n      })\n    }\n    return await sbp('chelonia/private/out/sync', listOfIds)\n  },\n  // the `try` parameter does not affect (ephemeral or persistent) reference\n  // counts, but rather removes a contract if the reference count is zero\n  // and the contract isn't being monitored for foreign keys. This parameter\n  // is meant mostly for internal chelonia use, so that removing or releasing\n  // a contract can also remove other contracts that this first contract\n  // was monitoring.\n  'chelonia/contract/release': async function (contractIDs                   , params                                         )             {\n    const listOfIds = typeof contractIDs === 'string' ? [contractIDs] : contractIDs\n    const rootState = sbp(this.config.stateSelector)\n    if (!params?.try) {\n      if (!params?.ephemeral) {\n        listOfIds.forEach((id) => {\n          // Contract has been permanently deleted\n          if (rootState.contracts[id] === null) {\n            console.warn('[chelonia/contract/release] Called /release on permanently deleted contract. This has no effect.', id)\n            return\n          }\n          if (has(rootState.contracts, id) && has(rootState.contracts[id], 'references')) {\n            const current = rootState.contracts[id].references\n            if (current === 0) {\n              console.error('[chelonia/contract/release] Invalid negative reference count for', id)\n              if (process.env.CI) {\n                // If running in CI, force tests to fail\n                Promise.reject(new Error('Invalid negative reference count: ' + id))\n              }\n              throw new Error('Invalid negative reference count')\n            }\n            if (current <= 1) {\n              this.config.reactiveDel(rootState.contracts[id], 'references')\n            } else {\n              this.config.reactiveSet(rootState.contracts[id], 'references', current - 1)\n            }\n          } else {\n            console.error('[chelonia/contract/release] Invalid negative reference count for', id)\n            if (process.env.CI) {\n              // If running in CI, force tests to fail\n              Promise.reject(new Error('Invalid negative reference count: ' + id))\n            }\n            throw new Error('Invalid negative reference count')\n          }\n        })\n      } else {\n        listOfIds.forEach((id) => {\n          // Contract has been permanently deleted\n          if (rootState.contracts[id] === null) {\n            console.warn('[chelonia/contract/release] Called /release on permanently deleted contract. This has no effect.', id)\n            return\n          }\n          if (has(this.ephemeralReferenceCount, id)) {\n            const current = this.ephemeralReferenceCount[id] ?? 0\n            if (current <= 1) {\n              delete this.ephemeralReferenceCount[id]\n            } else {\n              this.ephemeralReferenceCount[id] = current - 1\n            }\n          } else {\n            console.error('[chelonia/contract/release] Invalid negative ephemeral reference count for', id)\n            if (process.env.CI) {\n              // If running in CI, force tests to fail\n              Promise.reject(new Error('Invalid negative ephemeral reference count: ' + id))\n            }\n            throw new Error('Invalid negative ephemeral reference count')\n          }\n        })\n      }\n    }\n\n    // This function will be called twice. The first time, it provides a list of\n    // candidate contracts to remove. The second time, it confirms that the\n    // contract is safe to remove\n    const boundCheckCanBeGarbageCollected = checkCanBeGarbageCollected.bind(this)\n    const idsToRemove = listOfIds.filter(boundCheckCanBeGarbageCollected)\n    return idsToRemove.length ? await sbp('chelonia/contract/remove', idsToRemove, { confirmRemovalCallback: boundCheckCanBeGarbageCollected }) : undefined\n  },\n  'chelonia/contract/disconnect': async function (contractID, contractIDToDisconnect) {\n    const state = sbp(this.config.stateSelector)\n    const contractState = state[contractID]\n\n    const keyIds = Object.values(contractState._vm.authorizedKeys).filter((k) => {\n      // $FlowFixMe\n      return k._notAfterHeight == null && k.meta?.keyRequest?.contractID === contractIDToDisconnect\n    }).map(k => (k     ).id)\n\n    if (!keyIds.length) return\n\n    return await sbp('chelonia/out/keyDel', {\n      contractID,\n      contractName: contractState._vm.type,\n      data: keyIds,\n      signingKeyId: findSuitableSecretKeyId(contractState, [SPMessage.OP_KEY_DEL], ['sig'])\n    })\n  },\n  'chelonia/in/processMessage': function (messageOrRawMessage                    , state        ) {\n    const stateCopy = cloneDeep(state)\n    const message = typeof messageOrRawMessage === 'string' ? SPMessage.deserialize(messageOrRawMessage, this.transientSecretKeys, stateCopy, this.config.unwrapMaybeEncryptedData) : messageOrRawMessage\n    return sbp('chelonia/private/in/processMessage', message, stateCopy).then(() => stateCopy).catch((e) => {\n      console.warn(`chelonia/in/processMessage: reverting mutation ${message.description()}: ${message.serialize()}`, e)\n      return state\n    })\n  },\n  'chelonia/out/fetchResource': async function (cid        , { code }                    = {}) {\n    const parsedCID = parseCID(cid)\n    if (code != null) {\n      if (parsedCID.code !== code) {\n        throw new Error(`Invalid CID content type. Expected ${code}, got ${parsedCID.code}`)\n      }\n    }\n    // Note that chelonia.db/get (set) is a no-op for lightweight clients\n    // This was added for consistency (processing an event also adds it to the DB)\n    const local = await sbp('chelonia.db/get', cid)\n    // We don't verify the CID because it's already been verified when it was set\n    if (local != null) return local\n    const url = `${this.config.connectionURL}/file/${cid}`\n    const data = await this.config.fetch(url, { signal: this.abortController.signal }).then(handleFetchResult('text'))\n    const ourHash = createCID(data, parsedCID.code)\n    if (ourHash !== cid) {\n      throw new Error(`expected hash ${cid}. Got: ${ourHash}`)\n    }\n    await sbp('chelonia.db/set', cid, data)\n    return data\n  },\n  'chelonia/out/latestHEADInfo': function (contractID        ) {\n    return this.config.fetch(`${this.config.connectionURL}/latestHEADinfo/${contractID}`, {\n      cache: 'no-store',\n      signal: this.abortController.signal\n    }).then(handleFetchResult('json'))\n  },\n  'chelonia/out/eventsAfter': eventsAfter,\n  'chelonia/out/eventsBefore': function (contractID        , beforeHeight        , limit        , options) {\n    if (limit <= 0) {\n      console.error('[chelonia] invalid params error: \"limit\" needs to be positive integer')\n    }\n    const offset = Math.max(0, beforeHeight - limit + 1)\n    const eventsAfterLimit = Math.min(beforeHeight + 1, limit)\n    return sbp('chelonia/out/eventsAfter', contractID, offset, eventsAfterLimit, undefined, options)\n  },\n  'chelonia/out/eventsBetween': function (contractID        , startHash        , endHeight        , offset         = 0, { stream } = { stream: true }) {\n    if (offset < 0) {\n      console.error('[chelonia] invalid params error: \"offset\" needs to be positive integer or zero')\n      return\n    }\n    let reader                      \n    const s = new ReadableStream({\n      start: async (controller) => {\n        const first = await this.config.fetch(`${this.config.connectionURL}/file/${startHash}`, { signal: this.abortController.signal }).then(handleFetchResult('text'))\n        const deserializedHEAD = SPMessage.deserializeHEAD(first)\n        if (deserializedHEAD.contractID !== contractID) {\n          controller.error(new Error('chelonia/out/eventsBetween: Mismatched contract ID'))\n          return\n        }\n        const startOffset = Math.max(0, deserializedHEAD.head.height - offset)\n        const limit = endHeight - startOffset + 1\n        if (limit < 1) {\n          controller.close()\n          return\n        }\n        reader = sbp('chelonia/out/eventsAfter', contractID, startOffset, limit).getReader()\n      },\n      async pull (controller) {\n        const { done, value } = await reader.read()\n        if (done) {\n          controller.close()\n        } else {\n          controller.enqueue(value)\n        }\n      }\n    })\n\n    if (stream) return s\n    // Workaround for <https://bugs.webkit.org/show_bug.cgi?id=215485>\n    return collectEventStream(s)\n  },\n  'chelonia/rootState': function () { return sbp(this.config.stateSelector) },\n  'chelonia/latestContractState': async function (contractID        , options = { forceSync: false }) {\n    const rootState = sbp(this.config.stateSelector)\n    // return a copy of the state if we already have it, unless the only key that's in it is _volatile,\n    // in which case it means we should sync the contract to get more info.\n    if (rootState.contracts[contractID] === null) {\n      throw new ChelErrorResourceGone('Permanently deleted contract ' + contractID)\n    }\n    if (!options.forceSync && rootState[contractID] && Object.keys(rootState[contractID]).some((x) => x !== '_volatile')) {\n      return cloneDeep(rootState[contractID])\n    }\n    let state = Object.create(null)\n    let contractName = rootState.contracts[contractID]?.type\n    const eventsStream = sbp('chelonia/out/eventsAfter', contractID, 0, undefined, contractID)\n    const eventsStreamReader = eventsStream.getReader()\n    if (rootState[contractID]) state._volatile = rootState[contractID]._volatile\n    for (;;) {\n      const { value: event, done } = await eventsStreamReader.read()\n      if (done) return state\n      const stateCopy = cloneDeep(state)\n      try {\n        await sbp('chelonia/private/in/processMessage', SPMessage.deserialize(event, this.transientSecretKeys, state, this.config.unwrapMaybeEncryptedData), state, undefined, contractName)\n        if (!contractName && state._vm) {\n          contractName = state._vm.type\n        }\n      } catch (e) {\n        console.warn(`[chelonia] latestContractState: '${e.name}': ${e.message} processing:`, event, e.stack)\n        if (e instanceof ChelErrorUnrecoverable) throw e\n        state = stateCopy\n      }\n    }\n  },\n  'chelonia/contract/state': function (contractID        , height         ) {\n    const state = sbp(this.config.stateSelector)[contractID]\n    const stateCopy = state && cloneDeep(state)\n    if (stateCopy?._vm && height != null) {\n      // Remove keys in the future\n      Object.keys(stateCopy._vm.authorizedKeys).forEach(keyId => {\n        if (stateCopy._vm.authorizedKeys[keyId]._notBeforeHeight > height) {\n          delete stateCopy._vm.authorizedKeys[keyId]\n        }\n      })\n    }\n    return stateCopy\n  },\n  'chelonia/contract/fullState': function (contractID                   ) {\n    const rootState = sbp(this.config.stateSelector)\n    if (Array.isArray(contractID)) {\n      return Object.fromEntries(contractID.map(contractID => {\n        return [\n          contractID,\n          {\n            contractState: rootState[contractID],\n            cheloniaState: rootState.contracts[contractID]\n          }\n        ]\n      }))\n    }\n    return {\n      contractState: rootState[contractID],\n      cheloniaState: rootState.contracts[contractID]\n    }\n  },\n  // 'chelonia/out' - selectors that send data out to the server\n  'chelonia/out/registerContract': async function (params               ) {\n    const { contractName, keys, hooks, publishOptions, signingKeyId, actionSigningKeyId, actionEncryptionKeyId } = params\n    const manifestHash = this.config.contracts.manifests[contractName]\n    const contractInfo = this.manifestToContract[manifestHash]\n    if (!contractInfo) throw new Error(`contract not defined: ${contractName}`)\n    const signingKey = this.transientSecretKeys[signingKeyId]\n    if (!signingKey) throw new Error(`Signing key ${signingKeyId} is not defined`)\n    const payload = ({\n      type: contractName,\n      keys: keys\n    }              )\n    const contractMsg = SPMessage.createV1_0({\n      contractID: null,\n      height: 0,\n      op: [\n        SPMessage.OP_CONTRACT,\n        signedOutgoingDataWithRawKey(signingKey, payload)\n      ],\n      manifest: manifestHash\n    })\n    const contractID = contractMsg.hash()\n    await sbp('chelonia/private/out/publishEvent', contractMsg, (params.namespaceRegistration\n      ? {\n          ...publishOptions,\n          headers: {\n            ...publishOptions?.headers,\n            'shelter-namespace-registration': params.namespaceRegistration\n          }\n        }\n      : publishOptions), hooks && {\n      prepublish: hooks.prepublishContract,\n      postpublish: hooks.postpublishContract\n    })\n    await sbp('chelonia/private/out/sync', contractID)\n    const msg = await sbp(actionEncryptionKeyId\n      ? 'chelonia/out/actionEncrypted'\n      : 'chelonia/out/actionUnencrypted', {\n      action: contractName,\n      contractID,\n      data: params.data,\n      signingKeyId: actionSigningKeyId ?? signingKeyId,\n      encryptionKeyId: actionEncryptionKeyId,\n      hooks,\n      publishOptions\n    })\n    return msg\n  },\n  'chelonia/out/ownResources': async function (contractID        ) {\n    if (!contractID) {\n      throw new TypeError('A contract ID must be provided')\n    }\n\n    const response = await this.config.fetch(`${this.config.connectionURL}/ownResources`, {\n      method: 'GET',\n      signal: this.abortController.signal,\n      headers: new Headers([\n        [\n          'authorization',\n          buildShelterAuthorizationHeader.call(this, contractID)\n        ]\n      ])\n    })\n    if (!response.ok) {\n      console.error('Unable to fetch own resources', contractID, response.status)\n      throw new Error(`Unable to fetch own resources for ${contractID}: ${response.status}`)\n    }\n\n    return response.json()\n  },\n  'chelonia/out/deleteContract': async function (\n    contractID                   ,\n    credentials   \n                                                                           \n      = {}\n  ) {\n    if (!contractID) {\n      throw new TypeError('A contract ID must be provided')\n    }\n    if (!Array.isArray(contractID)) contractID = [contractID]\n    return await Promise.allSettled(contractID.map(async (cid) => {\n      const hasCredential = has(credentials, cid)\n      const hasToken = has(credentials[cid], 'token') && credentials[cid].token\n      const hasBillableContractID = has(credentials[cid], 'billableContractID') && credentials[cid].billableContractID\n      if (!hasCredential || hasToken === hasBillableContractID) {\n        throw new TypeError(`Either a token or a billable contract ID must be provided for ${cid}`)\n      }\n\n      const response = await this.config.fetch(`${this.config.connectionURL}/deleteContract/${cid}`, {\n        method: 'POST',\n        signal: this.abortController.signal,\n        headers: new Headers([\n          ['authorization',\n            hasToken\n              // $FlowFixMe[incompatible-type]\n              ? `bearer ${(credentials[cid].token     ).valueOf()}`\n              // $FlowFixMe[incompatible-type]\n              // $FlowFixMe[incompatible-call]\n              : buildShelterAuthorizationHeader.call(this, credentials[cid].billableContractID)]\n        ])\n      })\n      if (!response.ok) {\n        if (response.status === 404 || response.status === 410) {\n          console.warn('Contract appears to have been deleted already', cid, response.status)\n          return\n        }\n        console.error('Unable to delete contract', cid, response.status)\n        throw new Error(`Unable to delete contract ${cid}: ${response.status}`)\n      }\n    }))\n  },\n  // all of these functions will do both the creation of the SPMessage\n  // and the sending of it via 'chelonia/private/out/publishEvent'\n  'chelonia/out/actionEncrypted': function (params                  )                     {\n    return outEncryptedOrUnencryptedAction.call(this, SPMessage.OP_ACTION_ENCRYPTED, params)\n  },\n  'chelonia/out/actionUnencrypted': function (params                  )                     {\n    return outEncryptedOrUnencryptedAction.call(this, SPMessage.OP_ACTION_UNENCRYPTED, params)\n  },\n  'chelonia/out/keyShare': async function (params                    )                     {\n    const { atomic, originatingContractName, originatingContractID, contractName, contractID, data, hooks, publishOptions } = params\n    const originatingManifestHash = this.config.contracts.manifests[originatingContractName]\n    const destinationManifestHash = this.config.contracts.manifests[contractName]\n    const originatingContract = originatingContractID ? this.manifestToContract[originatingManifestHash]?.contract : undefined\n    const destinationContract = this.manifestToContract[destinationManifestHash]?.contract\n\n    if ((originatingContractID && !originatingContract) || !destinationContract) {\n      throw new Error('Contract name not found')\n    }\n\n    const payload = (data              )\n\n    if (!params.signingKeyId && !params.signingKey) {\n      throw new TypeError('Either signingKeyId or signingKey must be specified')\n    }\n\n    let msg = SPMessage.createV1_0({\n      contractID,\n      op: [\n        SPMessage.OP_KEY_SHARE,\n        params.signingKeyId\n          ? signedOutgoingData(contractID, params.signingKeyId, payload, this.transientSecretKeys)\n          // $FlowFixMe\n          : signedOutgoingDataWithRawKey(params.signingKey, payload)\n      ],\n      manifest: destinationManifestHash\n    })\n    if (!atomic) {\n      msg = await sbp('chelonia/private/out/publishEvent', msg, publishOptions, hooks)\n    }\n    return msg\n  },\n  'chelonia/out/keyAdd': async function (params                  )                            {\n    // TODO: For foreign keys, recalculate the key id\n    // TODO: Make this a noop if the key already exsits with the given permissions\n    const { atomic, contractID, contractName, data, hooks, publishOptions } = params\n    const manifestHash = this.config.contracts.manifests[contractName]\n    const contract = this.manifestToContract[manifestHash]?.contract\n    if (!contract) {\n      throw new Error('Contract name not found')\n    }\n    const state = contract.state(contractID)\n\n    const payload = (data            ).filter((wk) => {\n      const k = (((isEncryptedData(wk) ? wk.valueOf() : wk)     )       )\n      if (has(state._vm.authorizedKeys, k.id)) {\n        if (state._vm.authorizedKeys[k.id]._notAfterHeight == null) {\n          // Can't add a key that exists\n          return false\n        }\n      }\n\n      return true\n    })\n    if (payload.length === 0) return\n    let msg = SPMessage.createV1_0({\n      contractID,\n      op: [\n        SPMessage.OP_KEY_ADD,\n        signedOutgoingData(contractID, params.signingKeyId, payload, this.transientSecretKeys)\n      ],\n      manifest: manifestHash\n    })\n    if (!atomic) {\n      msg = await sbp('chelonia/private/out/publishEvent', msg, publishOptions, hooks)\n    }\n    return msg\n  },\n  'chelonia/out/keyDel': async function (params                  )                     {\n    const { atomic, contractID, contractName, data, hooks, publishOptions } = params\n    const manifestHash = this.config.contracts.manifests[contractName]\n    const contract = this.manifestToContract[manifestHash]?.contract\n    if (!contract) {\n      throw new Error('Contract name not found')\n    }\n    const state = contract.state(contractID)\n    const payload = (data            ).map((keyId) => {\n      if (isEncryptedData(keyId)) return keyId\n      // $FlowFixMe\n      if (!has(state._vm.authorizedKeys, keyId) || state._vm.authorizedKeys[keyId]._notAfterHeight != null) return undefined\n      if (state._vm.authorizedKeys[keyId]._private) {\n        return encryptedOutgoingData(contractID, state._vm.authorizedKeys[keyId]._private, keyId)\n      } else {\n        return keyId\n      }\n    }).filter(Boolean)\n    let msg = SPMessage.createV1_0({\n      contractID,\n      op: [\n        SPMessage.OP_KEY_DEL,\n        signedOutgoingData(contractID, params.signingKeyId, (payload     ), this.transientSecretKeys)\n      ],\n      manifest: manifestHash\n    })\n    if (!atomic) {\n      msg = await sbp('chelonia/private/out/publishEvent', msg, publishOptions, hooks)\n    }\n    return msg\n  },\n  'chelonia/out/keyUpdate': async function (params                     )                     {\n    const { atomic, contractID, contractName, data, hooks, publishOptions } = params\n    const manifestHash = this.config.contracts.manifests[contractName]\n    const contract = this.manifestToContract[manifestHash]?.contract\n    if (!contract) {\n      throw new Error('Contract name not found')\n    }\n    const state = contract.state(contractID)\n    const payload = (data               ).map((key) => {\n      if (isEncryptedData(key)) return key\n      // $FlowFixMe\n      const { oldKeyId } = key\n      if (state._vm.authorizedKeys[oldKeyId]._private) {\n        return encryptedOutgoingData(contractID, state._vm.authorizedKeys[oldKeyId]._private, key)\n      } else {\n        return key\n      }\n    })\n    let msg = SPMessage.createV1_0({\n      contractID,\n      op: [\n        SPMessage.OP_KEY_UPDATE,\n        signedOutgoingData(contractID, params.signingKeyId, (payload     ), this.transientSecretKeys)\n      ],\n      manifest: manifestHash\n    })\n    if (!atomic) {\n      msg = await sbp('chelonia/private/out/publishEvent', msg, publishOptions, hooks)\n    }\n    return msg\n  },\n  'chelonia/out/keyRequest': async function (params                      )                      {\n    const { originatingContractID, originatingContractName, contractID, contractName, hooks, publishOptions, innerSigningKeyId, encryptionKeyId, innerEncryptionKeyId, encryptKeyRequestMetadata, reference } = params\n    // `encryptKeyRequestMetadata` is optional because it could be desirable\n    // sometimes to allow anyone to audit OP_KEY_REQUEST and OP_KEY_SHARE\n    // operations. If `encryptKeyRequestMetadata` were always true, it would\n    // be harder in these situations to see interactions between two contracts.\n    const manifestHash = this.config.contracts.manifests[contractName]\n    const originatingManifestHash = this.config.contracts.manifests[originatingContractName]\n    const contract = this.manifestToContract[manifestHash]?.contract\n    const originatingContract = this.manifestToContract[originatingManifestHash]?.contract\n    if (!contract) {\n      throw new Error('Contract name not found')\n    }\n    const rootState = sbp(this.config.stateSelector)\n    try {\n      await sbp('chelonia/contract/retain', contractID, { ephemeral: true })\n      const state = contract.state(contractID)\n      const originatingState = originatingContract.state(originatingContractID)\n\n      const havePendingKeyRequest = Object.values(originatingState._vm.authorizedKeys).findIndex((k) => {\n        // $FlowFixMe\n        return k._notAfterHeight == null && k.meta?.keyRequest?.contractID === contractID && state?._volatile?.pendingKeyRequests?.some(pkr => pkr.name === k.name)\n      }) !== -1\n\n      // If there's a pending key request for this contract, return\n      if (havePendingKeyRequest) {\n        return\n      }\n\n      const keyRequestReplyKey = keygen(EDWARDS25519SHA512BATCH)\n      const keyRequestReplyKeyId = keyId(keyRequestReplyKey)\n      const keyRequestReplyKeyP = serializeKey(keyRequestReplyKey, false)\n      const keyRequestReplyKeyS = serializeKey(keyRequestReplyKey, true)\n\n      const signingKeyId = findSuitableSecretKeyId(originatingState, [SPMessage.OP_KEY_ADD], ['sig'])\n      if (!signingKeyId) {\n        throw ChelErrorUnexpected(`Unable to send key request. Originating contract is missing a key with OP_KEY_ADD permission. contractID=${contractID} originatingContractID=${originatingContractID}`)\n      }\n      const keyAddOp = () => sbp('chelonia/out/keyAdd', {\n        contractID: originatingContractID,\n        contractName: originatingContractName,\n        data: [{\n          id: keyRequestReplyKeyId,\n          name: '#krrk-' + keyRequestReplyKeyId,\n          purpose: ['sig'],\n          ringLevel: Number.MAX_SAFE_INTEGER,\n          permissions: params.permissions === '*'\n            ? '*'\n            : Array.isArray(params.permissions)\n              ? [...params.permissions, SPMessage.OP_KEY_SHARE]\n              : [SPMessage.OP_KEY_SHARE],\n          allowedActions: params.allowedActions,\n          meta: {\n            private: {\n              content: encryptedOutgoingData(originatingContractID, encryptionKeyId, keyRequestReplyKeyS),\n              shareable: false\n            },\n            keyRequest: {\n              ...(reference && { reference: encryptKeyRequestMetadata ? encryptedOutgoingData(originatingContractID, encryptionKeyId, reference) : reference }),\n              contractID: encryptKeyRequestMetadata ? encryptedOutgoingData(originatingContractID, encryptionKeyId, contractID) : contractID\n            }\n          },\n          data: keyRequestReplyKeyP\n        }],\n        signingKeyId\n      }).catch(e => {\n        console.error(`[chelonia] Error sending OP_KEY_ADD for ${originatingContractID} during key request to ${contractID}`, e)\n        throw e\n      })\n      const payload = ({\n        contractID: originatingContractID,\n        height: rootState.contracts[originatingContractID].height,\n        replyWith: signedOutgoingData(originatingContractID, innerSigningKeyId, {\n          encryptionKeyId,\n          responseKey: encryptedOutgoingData(contractID, innerEncryptionKeyId, keyRequestReplyKeyS)\n        }, this.transientSecretKeys),\n        request: '*'\n      }                )\n      let msg = SPMessage.createV1_0({\n        contractID,\n        op: [\n          SPMessage.OP_KEY_REQUEST,\n          signedOutgoingData(contractID, params.signingKeyId,\n            encryptKeyRequestMetadata\n              ? (encryptedOutgoingData(contractID, innerEncryptionKeyId, payload)     )\n              : payload, this.transientSecretKeys\n          )\n        ],\n        manifest: manifestHash\n      })\n      msg = await sbp('chelonia/private/out/publishEvent', msg, publishOptions, {\n        ...hooks,\n        // We ensure that both messages are placed into the publish queue\n        prepublish: (...args) => {\n          return keyAddOp().then(() => hooks?.prepublish?.(...args))\n        }\n      })\n      return msg\n    } finally {\n      await sbp('chelonia/contract/release', contractID, { ephemeral: true })\n    }\n  },\n  'chelonia/out/keyRequestResponse': async function (params                              )                     {\n    const { atomic, contractID, contractName, data, hooks, publishOptions } = params\n    const manifestHash = this.config.contracts.manifests[contractName]\n    const contract = this.manifestToContract[manifestHash]?.contract\n    if (!contract) {\n      throw new Error('Contract name not found')\n    }\n    const payload = (data                    )\n    let message = SPMessage.createV1_0({\n      contractID,\n      op: [\n        SPMessage.OP_KEY_REQUEST_SEEN,\n        signedOutgoingData(contractID, params.signingKeyId, payload, this.transientSecretKeys)\n      ],\n      manifest: manifestHash\n    })\n    if (!atomic) {\n      message = await sbp('chelonia/private/out/publishEvent', message, publishOptions, hooks)\n    }\n    return message\n  },\n  'chelonia/out/atomic': async function (params                  )                     {\n    const { contractID, contractName, data, hooks, publishOptions } = params\n    const manifestHash = this.config.contracts.manifests[contractName]\n    const contract = this.manifestToContract[manifestHash]?.contract\n    if (!contract) {\n      throw new Error('Contract name not found')\n    }\n    const payload = (await Promise.all(data.map(([selector, opParams]) => {\n      if (!['chelonia/out/actionEncrypted', 'chelonia/out/actionUnencrypted', 'chelonia/out/keyAdd', 'chelonia/out/keyDel', 'chelonia/out/keyUpdate', 'chelonia/out/keyRequestResponse', 'chelonia/out/keyShare'].includes(selector)) {\n        throw new Error('Selector not allowed in OP_ATOMIC: ' + selector)\n      }\n      return sbp(selector, { ...opParams, ...params, data: opParams.data, atomic: true })\n    }))).flat().filter(Boolean).map((msg) => {\n      return [msg.opType(), msg.opValue()]\n    })\n    let msg = SPMessage.createV1_0({\n      contractID,\n      op: [\n        SPMessage.OP_ATOMIC,\n        signedOutgoingData(contractID, params.signingKeyId, (payload     ), this.transientSecretKeys)\n      ],\n      manifest: manifestHash\n    })\n    msg = await sbp('chelonia/private/out/publishEvent', msg, publishOptions, hooks)\n    return msg\n  },\n  'chelonia/out/protocolUpgrade': async function () {\n\n  },\n  'chelonia/out/propSet': async function () {\n\n  },\n  'chelonia/out/propDel': async function () {\n\n  },\n  'chelonia/out/encryptedOrUnencryptedPubMessage': function ({\n    contractID,\n    innerSigningKeyId,\n    encryptionKeyId,\n    signingKeyId,\n    data\n  }   \n                       \n                               \n                             \n                         \n                \n   ) {\n    const serializedData = outputEncryptedOrUnencryptedMessage.call(this, {\n      contractID,\n      innerSigningKeyId,\n      encryptionKeyId,\n      signingKeyId,\n      data\n    })\n    this.pubsub.pub(contractID, serializedData)\n  },\n  // Note: This is a bare-bones function designed for precise control. In many\n  // situations, the `chelonia/kv/queuedSet` selector (in chelonia-utils.js)\n  // will be simpler and more appropriate to use.\n  // In most situations, you want to use some queuing strategy (which this\n  // selector doesn't provide) alongside writing to the KV store. Therefore, as\n  // a general rule, you shouldn't be calling this selector directly unless\n  // you're building a utility library or if you have very specific needs. In\n  // this case, see if `chelonia/kv/queuedSet` covers your needs.\n  // `data` is allowed to be falsy, in which case a fetch will occur first and\n  // the `onconflict` handler will be called.\n  'chelonia/kv/set': async function (contractID        , key        , data          , {\n    ifMatch,\n    innerSigningKeyId,\n    encryptionKeyId,\n    signingKeyId,\n    maxAttempts,\n    onconflict\n  }   \n                     \n                               \n                             \n                         \n                         \n                                          \n   ) {\n    maxAttempts = maxAttempts ?? 3\n    const url = `${this.config.connectionURL}/kv/${encodeURIComponent(contractID)}/${encodeURIComponent(key)}`\n    const hasOnconflict = typeof onconflict === 'function'\n\n    let response          \n    // The `resolveData` function is tasked with computing merged data, as in\n    // merging the existing stored values (after a conflict or initial fetch)\n    // and new data. The return value indicates whether there should be a new\n    // attempt at storing updated data (if `true`) or not (if `false`)\n    const resolveData = async () => {\n      let currentValue\n      // Rationale:\n      //  * response.ok could be the result of `GET` (no initial data)\n      //  * 409 indicates a conflict because the height used is too old\n      //  * 412 indicates a conflict (precondition failed) because the data\n      //    on the KV store have been updated / is not what we expected\n      // All of these situations should trigger parsing the respinse and\n      // conlict resolution\n      if (response.ok || response.status === 409 || response.status === 412) {\n        const serializedDataText = await response.text()\n        // We can get 409 even if there's no data on the server. We still need\n        // to call `onconflict` in this case, but we don't need to attempt to\n        // parse the response.\n        // This prevents this from failing in such cases, which can result in\n        // race conditions and data not being properly initialised.\n        // See <https://github.com/okTurtles/group-income/issues/2780>\n        currentValue = serializedDataText\n          ? parseEncryptedOrUnencryptedMessage(this, {\n            contractID,\n            serializedData: JSON.parse(serializedDataText),\n            meta: key\n          })\n          : undefined\n      // Rationale: 404 and 410 both indicate that the store key doesn't exist.\n      // These are not treated as errors since we could still set the value.\n      } else if (response.status !== 404 && response.status !== 410) {\n        throw new ChelErrorUnexpectedHttpResponseCode('[kv/set] Invalid response code: ' + response.status)\n      }\n      const result = await (onconflict          )({\n        contractID,\n        key,\n        failedData: data,\n        status: response.status,\n        // If no x-cid or etag header was returned, `ifMatch` would likely be\n        // returned as undefined, which will then use the `''` fallback value\n        // when writing. This allows 404 / 410 responses to work even if no\n        // etag is explicitly given\n        etag: response.headers.get('x-cid') || response.headers.get('etag'),\n        get currentData () {\n          return currentValue?.data\n        },\n        currentValue\n      })\n      if (!result) return false\n\n      data = result[0]\n      ifMatch = result[1]\n      return true\n    }\n\n    for (;;) {\n      if (data !== undefined) {\n        const serializedData = outputEncryptedOrUnencryptedMessage.call(this, {\n          contractID,\n          innerSigningKeyId,\n          encryptionKeyId,\n          signingKeyId,\n          data,\n          meta: key\n        })\n        response = await this.config.fetch(url, {\n          headers: new Headers([[\n            'authorization', buildShelterAuthorizationHeader.call(this, contractID)\n          ], [\n            'if-match', ifMatch || '\"\"'\n          ]\n          ]),\n          method: 'POST',\n          body: JSON.stringify(serializedData),\n          signal: this.abortController.signal\n        })\n      } else {\n        if (!hasOnconflict) {\n          throw TypeError('onconflict required with empty data')\n        }\n        // If no initial data provided, perform a GET `fetch` to get the current\n        // data and CID. Then, `onconflict` will be used to merge the current\n        // and new data.\n        response = await this.config.fetch(url, {\n          headers: new Headers([[\n            'authorization', buildShelterAuthorizationHeader.call(this, contractID)\n          ]]),\n          signal: this.abortController.signal\n        })\n\n        // This is only for the initial case; the logic is replicated below\n        // for subsequent iterations that require conflic resolution.\n        if (await resolveData()) {\n          continue\n        } else {\n          break\n        }\n      }\n      if (!response.ok) {\n        // Rationale: 409 and 412 indicate conflict resolution is needed\n        if (response.status === 409 || response.status === 412) {\n          if (--maxAttempts <= 0) {\n            throw new Error('kv/set conflict setting KV value')\n          }\n          // Only retry if an onconflict handler exists to potentially resolve it\n          await delay(randomIntFromRange(0, 1500))\n          if (hasOnconflict) {\n            if (await resolveData()) {\n              continue\n            } else {\n              break\n            }\n          } else {\n            // Can't resolve automatically if there's no conflict handler\n            throw new Error(`kv/set failed with status ${response.status} and no onconflict handler was provided`)\n          }\n        }\n        throw new ChelErrorUnexpectedHttpResponseCode('kv/set invalid response status: ' + response.status)\n      }\n      break\n    }\n  },\n  'chelonia/kv/get': async function (contractID        , key        ) {\n    const response = await this.config.fetch(`${this.config.connectionURL}/kv/${encodeURIComponent(contractID)}/${encodeURIComponent(key)}`, {\n      headers: new Headers([[\n        'authorization', buildShelterAuthorizationHeader.call(this, contractID)\n      ]]),\n      signal: this.abortController.signal\n    })\n    if (response.status === 404) {\n      return null\n    }\n    if (!response.ok) {\n      throw new Error('Invalid response status: ' + response.status)\n    }\n    const data = await response.json()\n    return parseEncryptedOrUnencryptedMessage(this, {\n      contractID,\n      serializedData: data,\n      meta: key\n    })\n  },\n  // To set filters for a contract, call with `filter` set to an array of KV\n  // keys to receive updates for over the WebSocket. An empty array means that\n  // no KV updates will be sent.\n  // Calling with a single argument (the contract ID) will remove filters,\n  // meaning that KV updates will be sent for _any_ KV key.\n  // The last call takes precedence, so, for example, calling with filter\n  // set to `['foo', 'bar']` and then with `['baz']` means that KV updates will\n  // be received for `baz` only, not for `foo`, `bar` or any other keys.\n  'chelonia/kv/setFilter': function (contractID        , filter           ) {\n    this.pubsub.setKvFilter(contractID, filter)\n  },\n  'chelonia/parseEncryptedOrUnencryptedDetachedMessage': function ({ contractID, serializedData, meta }                                                                ) {\n    return parseEncryptedOrUnencryptedMessage(this, {\n      contractID,\n      serializedData,\n      meta\n    })\n  }\n})          )\n\nfunction contractNameFromAction (action        )         {\n  const regexResult = ACTION_REGEX.exec(action)\n  const contractName = regexResult?.[2]\n  if (!contractName) throw new Error(`Poorly named action '${action}': missing contract name.`)\n  return contractName\n}\n\nfunction outputEncryptedOrUnencryptedMessage ({\n  contractID,\n  innerSigningKeyId,\n  encryptionKeyId,\n  signingKeyId,\n  data,\n  meta\n}   \n                     \n                             \n                           \n                       \n               \n                \n ) {\n  const state = sbp(this.config.stateSelector)[contractID]\n  const signedMessage = innerSigningKeyId\n    ? (state._vm.authorizedKeys[innerSigningKeyId] && state._vm.authorizedKeys[innerSigningKeyId]?._notAfterHeight == null)\n        ? signedOutgoingData(contractID, innerSigningKeyId, (data     ), this.transientSecretKeys)\n        : signedOutgoingDataWithRawKey(this.transientSecretKeys[innerSigningKeyId], (data     ))\n    : data\n  const payload = !encryptionKeyId\n    ? signedMessage\n    : encryptedOutgoingData(contractID, encryptionKeyId, signedMessage)\n  const message = signedOutgoingData(contractID, signingKeyId, (payload     ), this.transientSecretKeys)\n  const rootState = sbp(this.config.stateSelector)\n  const height = String(rootState.contracts[contractID].height)\n  const serializedData = { ...message.serialize((meta ?? '') + height), height }\n  return serializedData\n}\n\nfunction parseEncryptedOrUnencryptedMessage (ctx, {\n  contractID,\n  serializedData,\n  meta\n}   \n                     \n                         \n                \n ) {\n  if (!serializedData) {\n    throw new TypeError('[chelonia] parseEncryptedOrUnencryptedMessage: serializedData is required')\n  }\n  const state = sbp(ctx.config.stateSelector)[contractID]\n  const numericHeight = parseInt(serializedData.height)\n  const rootState = sbp(ctx.config.stateSelector)\n  const currentHeight = rootState.contracts[contractID].height\n  if (!(numericHeight >= 0) || !(numericHeight <= currentHeight)) {\n    throw new Error(`[chelonia] parseEncryptedOrUnencryptedMessage: Invalid height ${serializedData.height}; it must be between 0 and ${currentHeight}`)\n  }\n\n  // Additional data used for verification\n  const aad = (meta ?? '') + serializedData.height\n\n  const v = signedIncomingData(contractID, state, serializedData, numericHeight, aad, (message) => {\n    return maybeEncryptedIncomingData(contractID, state, message, numericHeight, ctx.transientSecretKeys, aad, undefined)\n  })\n\n  // Cached values\n  let encryptionKeyId\n  let innerSigningKeyId\n\n  // Lazy unwrap function\n  // We don't use `unwrapMaybeEncryptedData`, which would almost do the same,\n  // because it swallows decryption errors, which we want to propagate to\n  // consumers of the KV API.\n  const unwrap = (() => {\n    let result\n\n    return () => {\n      if (!result) {\n        try {\n          let unwrapped\n          // First, we unwrap the signed data\n          unwrapped = v.valueOf()\n          // If this is encrypted data, attempt decryption\n          if (isEncryptedData(unwrapped)) {\n            encryptionKeyId = unwrapped.encryptionKeyId\n            unwrapped = unwrapped.valueOf()\n\n            // There could be inner signed data (inner signatures), so we unwrap\n            // that too\n            if (isSignedData(unwrapped)) {\n              innerSigningKeyId = unwrapped.signingKeyId\n              unwrapped = unwrapped.valueOf()\n            } else {\n              innerSigningKeyId = null\n            }\n          } else {\n            encryptionKeyId = null\n            innerSigningKeyId = null\n          }\n          result = [unwrapped]\n        } catch (e) {\n          result = [undefined, e]\n        }\n      }\n\n      if (result.length === 2) {\n        throw result[1]\n      }\n      return result[0]\n    }\n  })()\n\n  const result = {\n    get contractID () {\n      return contractID\n    },\n    get innerSigningKeyId () {\n      if (innerSigningKeyId === undefined) {\n        try {\n          unwrap()\n        } catch {\n          // We're not interested in an error, that'd only be for the 'data'\n          // accessor.\n        }\n      }\n      return innerSigningKeyId\n    },\n    get encryptionKeyId () {\n      if (encryptionKeyId === undefined) {\n        try {\n          unwrap()\n        } catch {\n          // We're not interested in an error, that'd only be for the 'data'\n          // accessor.\n        }\n      }\n      return encryptionKeyId\n    },\n    get signingKeyId () {\n      return v.signingKeyId\n    },\n    get data () {\n      return unwrap()\n    },\n    get signingContractID () {\n      return getContractIDfromKeyId(contractID, result.signingKeyId, state)\n    },\n    get innerSigningContractID () {\n      return getContractIDfromKeyId(contractID, result.innerSigningKeyId, state)\n    }\n  }\n\n  return result\n}\n\nasync function outEncryptedOrUnencryptedAction (\n  opType             ,\n  params                  \n) {\n  const { atomic, action, contractID, data, hooks, publishOptions } = params\n  const contractName = contractNameFromAction(action)\n  const manifestHash = this.config.contracts.manifests[contractName]\n  const { contract } = this.manifestToContract[manifestHash]\n  const state = contract.state(contractID)\n  const meta = await contract.metadata.create()\n  const unencMessage = ({ action, data, meta }                       )\n  const signedMessage = params.innerSigningKeyId\n    ? (state._vm.authorizedKeys[params.innerSigningKeyId] && state._vm.authorizedKeys[params.innerSigningKeyId]?._notAfterHeight == null)\n        ? signedOutgoingData(contractID, params.innerSigningKeyId, (unencMessage     ), this.transientSecretKeys)\n        : signedOutgoingDataWithRawKey(this.transientSecretKeys[params.innerSigningKeyId], (unencMessage     ))\n    : unencMessage\n  if (opType === SPMessage.OP_ACTION_ENCRYPTED && !params.encryptionKeyId) {\n    throw new Error('OP_ACTION_ENCRYPTED requires an encryption key ID be given')\n  }\n  if (params.encryptionKey) {\n    if (params.encryptionKeyId !== keyId(params.encryptionKey)) {\n      throw new Error('OP_ACTION_ENCRYPTED raw encryption key does not match encryptionKeyId')\n    }\n  }\n\n  const payload = opType === SPMessage.OP_ACTION_UNENCRYPTED\n    ? signedMessage\n    : params.encryptionKey\n      ? encryptedOutgoingDataWithRawKey(((params.encryptionKey     )     ), signedMessage)\n      : encryptedOutgoingData(contractID, ((params.encryptionKeyId     )        ), signedMessage)\n  let message = SPMessage.createV1_0({\n    contractID,\n    op: [\n      opType,\n      signedOutgoingData(contractID, params.signingKeyId, (payload     ), this.transientSecretKeys)\n    ],\n    manifest: manifestHash\n  })\n  if (!atomic) {\n    message = await sbp('chelonia/private/out/publishEvent', message, publishOptions, hooks)\n  }\n  return message\n}\n\n// The gettersProxy is what makes Vue-like getters possible. In other words,\n// we want to make sure that the getter functions that we defined in each\n// contract get passed the 'state' when a getter is accessed.\n// We pass in the state by creating a Proxy object that does it for us.\n// This allows us to maintain compatibility with Vue.js and integrate\n// the contract getters into the Vue-facing getters.\n// For this to work, other getters need to be implemented relative to a\n// 'current' getter that returns the state itself. For example:\n// ```\n// {\n//   currentMailboxState: (state) => state, // In the contract\n//   currentMailboxState: (state) => state[state.currentMailboxId], // In the app\n//   lastMessage: (state, getters) => // Shared getter for both app and contract\n//     getters.currentMailboxState.messages.slice(-1).pop()\n// }\n// ```\nfunction gettersProxy (state        , getters        ) {\n  const proxyGetters = new Proxy({}, {\n    get (_target, prop) {\n      return getters[prop](state, proxyGetters)\n    }\n  })\n  return { getters: proxyGetters }\n}\n\nsbp('sbp/domains/lock', ['chelonia'])\n", "export const PUBSUB_INSTANCE = '@instance/pubsub'\n", "{\n  \"manifests\": {\n    \"gi.contracts/chatroom\": \"zL7mM9d4Xb4TUZovL5nbzHAwkuPuvJj2HLY778JUwMKXWZJdndRwNj7E\",\n    \"gi.contracts/group\": \"zL7mM9d4Xb4TUeDxkCdK3gtMEearhxVeWGDUmYRvKrjQkAaJ68xpAyCB\",\n    \"gi.contracts/identity\": \"zL7mM9d4Xb4THA1sugUsGkDKkfyPGjvDu5T3AUBY34rjfwfTdozC4VEo\"\n  }\n}\n", "'use strict'\n\nimport * as Common from '@common/common.js'\nimport { debounce, has } from 'turtledash'\nimport sbp from '@sbp/sbp'\nimport '~/shared/domains/chelonia/chelonia.js'\n                                                                      \nimport { CONTRACTS_MODIFIED } from '~/shared/domains/chelonia/events.js'\nimport { NOTIFICATION_TYPE, PUBSUB_ERROR, REQUEST_TYPE } from '../shared/pubsub.js'\nimport { groupContractsByType, syncContractsInOrder } from './controller/actions/utils.js'\nimport { PUBSUB_INSTANCE } from './controller/instance-keys.js'\nimport manifests from './model/contracts/manifests.json'\nimport { SETTING_CHELONIA_STATE, SETTING_CURRENT_USER } from './model/database.js'\nimport { CHATROOM_USER_STOP_TYPING, CHATROOM_USER_TYPING, CHELONIA_STATE_MODIFIED, KV_EVENT, LOGGING_OUT, LOGIN_COMPLETE, LOGOUT, OFFLINE, ONLINE, RECONNECTING, RECONNECTION_FAILED, SERIOUS_ERROR } from './utils/events.js'\nimport { KV_KEYS } from './utils/constants.js'\n\nconst handleDeletedContract = async (contractID        ) => {\n  const { cheloniaState, contractState } = sbp('chelonia/contract/fullState', contractID)\n  if (!cheloniaState) return\n\n  await sbp('chelonia/contract/remove', contractID, { permanent: true })\n\n  const type = cheloniaState.type?.replace(/^gi\\.contracts\\//, 'gi.actions/')\n  const handler = type && sbp('sbp/selectors/fn', `${type}/_ondeleted`)\n\n  const currentIdentityState = sbp('state/vuex/getters').currentIdentityState\n  // Delete redudant file deletion tokens. If a contract has been deleted, so\n  // have been the files it contained, and therefore we no longer need to\n  // hold on to their file deletion tokens.\n  if (currentIdentityState.fileDeleteTokens) {\n    // $FlowFixMe[incompatible-use]\n    const manifestCids = Object.entries(currentIdentityState.fileDeleteTokens).filter(([, { billableContractID }]) => {\n      return billableContractID === contractID\n    }).map(([cid]) => cid)\n    await sbp('gi.actions/identity/removeFiles', {\n      manifestCids,\n      option: {\n        shouldDeleteToken: true\n      }\n    }).catch(e => {\n      console.error('[handleDeletedContract] Error deleting saved tokens for deleted contract', contractID, e)\n    })\n  }\n\n  // Note: when multiple contracts are deleted, the order in which the `handler`\n  // is called isn't guaranteed. The `_ondeleted` handlers should be written in\n  // such a way that the order in which they're called is of no consequence.\n  // For example, a group might use `_ondeleted` to remove it from its associated\n  // identity contract, since this is safe. If the identity contract is also being\n  // removed, this is at worst redudant, but still safe, since removal of the\n  // identity contract also deletes the same information.\n  if (typeof handler === 'function') {\n    await handler(contractID, contractState).catch(e => {\n      console.error('[handleDeletedContract] Error handling deletion of contract', contractID, e)\n    })\n  } else {\n    console.warn('[handleDeletedContract] Received contract deletion notification for contract without a declared deletion handler', contractID, cheloniaState.type)\n  }\n}\n\n// This function is tasked with most common tasks related to setting up Chelonia\n// for Group Income. If Chelonia is running in a service worker, the service\n// worker should call this function. On the other hand, if Chelonia is running\n// in the browsing context, the browsing context is the one that should call this\n// function.\nconst setupChelonia = async ()             => {\n  // Load Chelonia state (this needs to be done in the SW when Chelonia is\n  // running there)\n  // We only load Chelonia state when SETTING_CURRENT_USER is set because,\n  // currently, Chelonia only has meaningful persistent state when there's\n  // an active session. If there's no logged in user, it means that there's\n  // no state to restore.\n  // Note that `gi.app/identity/login` and `gi.actions/identity/login` also\n  // load Chelonia state. The difference between this and that case is that\n  // the code immediately below loads Chelonia state when there already is\n  // an active sessin (e.g., when refreshing the page). On the other hand, the\n  // login functions _replace_ the Chelonia state with a saved state when a\n  // fresh session is started. For example, when logging back in on a device.\n  // In short:\n  //   - Active session on this device: load state from CHELONIA_STATE directly.\n  //   - Completely fresh session (no saved state): fresh state (not loaded from\n  //     anywhere).\n  //   - Fresh session with saved state: /login logic, CHELONIA_STATE is\n  //     decrypyted from the saved state and loaded. This is also saved in\n  //     CHELONIA_STATE so that refreshing the page works.\n  // Difference between Chelonia state (chelonia/rootState) and Vuex state\n  // (state/vuex/state):\n  //   1. Chelonia state is authoritative for Chelonia\n  //   2. Vuex state is authoritative for Vue\n  //   3. There is a single Chelonia state, but there could be many different\n  //      instances of Vuex state. (E.g., with a SW, Chelonia is running in a\n  //      SW and has a single state there, but each tab has a different Vuex\n  //      state)\n  //   4. A copy of (parts of) Chelonia state is kept in Vuex state so that\n  //      the application can react to contract state changes. However, these\n  //      copies are to be considered a cache and are not authoritative.\n  //   5. Vuex state is _not_ copied to Chelonia state (i.e., the copying is\n  //      in a single direction: Chelonia -> Vuex)\n  await sbp('gi.db/settings/load', SETTING_CHELONIA_STATE).then(async (cheloniaState) => {\n    if (!cheloniaState) return\n    const identityContractID = await sbp('gi.db/settings/load', SETTING_CURRENT_USER)\n    if (!identityContractID) return\n    await sbp('chelonia/reset', cheloniaState)\n    // [SW] If there's an active session, we need to start capture now\n    if (typeof WorkerGlobalScope === 'function') {\n      await sbp('swLogs/startCapture', identityContractID)\n    }\n  })\n\n  // Used in 'chelonia/configure' hooks to emit an error notification.\n  const errorNotification = (activity        , error       , message           , msgMeta         ) => {\n    sbp('gi.notifications/emit', 'CHELONIA_ERROR', { createdDate: new Date().toISOString(), activity, error, message, msgMeta })\n    // Since a runtime error just occured, we likely want to persist app logs to local storage now.\n    sbp('appLogs/save').catch(e => {\n      console.error('Error saving logs during error notification', e)\n    })\n  }\n\n  let logoutInProgress = false\n  const saveChelonia = () => sbp('okTurtles.eventQueue/queueEvent', SETTING_CHELONIA_STATE, () => {\n    if (logoutInProgress) return\n    return sbp('gi.db/settings/save', SETTING_CHELONIA_STATE, sbp('chelonia/rootState'))\n  })\n  const saveCheloniaDebounced = debounce(saveChelonia, 200)\n\n  // When running in a SW, this call here needs to be moved to be made from the\n  // SW itself\n  await sbp('chelonia/configure', {\n    connectionURL: sbp('okTurtles.data/get', 'API_URL'),\n    // Because Chelonia state is kept separately from Vuex state, there is\n    // no need to override stateSelector. However, `reactiveSet` and `reactiveDel`\n    // are still needed to persist Chelonia state (this separation means that\n    // Chelonia state and Vuex state need to be persisted separately).\n    // // stateSelector: 'state/vuex/state',\n    reactiveSet: (o        , k        , v        ) => {\n      if (o[k] !== v) {\n        o[k] = v\n        saveCheloniaDebounced()\n      }\n    },\n    reactiveDel: (o        , k        ) => {\n      if (has(o, k)) {\n        delete o[k]\n        saveCheloniaDebounced()\n      }\n    },\n    contracts: {\n      ...manifests,\n      defaults: {\n        modules: { '@common/common.js': Common },\n        allowedSelectors: [\n          'namespace/lookup', 'namespace/lookupCached',\n          // TODO: [SW] the `state/` selectors should _not_ be used from contracts\n          // since they refer to Vuex (i.e., tab / window) state and not to\n          // Chelonia state.\n          'state/vuex/state', 'state/vuex/settings', 'state/vuex/commit', 'state/vuex/getters',\n          'chelonia/rootState', 'chelonia/contract/state', 'chelonia/contract/sync', 'chelonia/contract/isSyncing', 'chelonia/contract/remove', 'chelonia/contract/retain', 'chelonia/contract/release', 'controller/router',\n          'chelonia/contract/suitableSigningKey', 'chelonia/contract/currentKeyIdByName',\n          'chelonia/contract/foreignKeysByContractID',\n          'chelonia/contract/setPendingKeyRevocation',\n          'chelonia/storeSecretKeys', 'chelonia/crypto/keyId',\n          'chelonia/queueInvocation', 'chelonia/contract/wait',\n          'chelonia/out/deleteContract',\n          'chelonia/contract/waitingForKeyShareTo',\n          'chelonia/contract/successfulKeySharesByContractID',\n          'gi.actions/group/removeOurselves', 'gi.actions/group/groupProfileUpdate', 'gi.actions/group/displayMincomeChangedPrompt', 'gi.actions/group/addChatRoom',\n          'gi.actions/group/join', 'gi.actions/group/joinChatRoom',\n          'gi.actions/identity/addJoinDirectMessageKey', 'gi.actions/identity/leaveGroup',\n          'gi.actions/chatroom/delete',\n          'gi.notifications/emit',\n          'gi.actions/out/rotateKeys', 'gi.actions/group/shareNewKeys', 'gi.actions/chatroom/shareNewKeys', 'gi.actions/identity/shareNewPEK',\n          'chelonia/out/keyDel',\n          'chelonia/contract/disconnect',\n          'gi.actions/identity/removeFiles',\n          'gi.actions/chatroom/join', 'gi.actions/chatroom/leave',\n          'chelonia/contract/hasKeysToPerformOperation',\n          'gi.actions/identity/kv/initChatRoomUnreadMessages', 'gi.actions/identity/kv/deleteChatRoomUnreadMessages',\n          'gi.actions/identity/kv/setChatRoomReadUntil',\n          'gi.actions/identity/kv/addChatRoomUnreadMessage', 'gi.actions/identity/kv/removeChatRoomUnreadMessage'\n        ],\n        allowedDomains: ['okTurtles.data', 'okTurtles.events', 'okTurtles.eventQueue', 'gi.db', 'gi.contracts'],\n        preferSlim: true,\n        exposedGlobals: {\n          // note: needs to be written this way and not simply \"Notification\"\n          // because that breaks on mobile where Notification is undefined\n          Notification: self.Notification\n        }\n      }\n    },\n    hooks: {\n      syncContractError: (e, contractID) => {\n        if (!e) return\n        if (e.name === 'ChelErrorResourceGone') {\n          console.info('[syncContractError] Contract ID ' + contractID + ' has been deleted')\n          handleDeletedContract(contractID).catch(e => {\n            console.error('[syncContractError] Error handling contract deletion', e)\n          })\n        }\n        if (['ChelErrorUnrecoverable', 'ChelErrorForkedChain'].includes(e.name)) {\n          sbp('okTurtles.events/emit', SERIOUS_ERROR, e, { contractID })\n        }\n      },\n      handleEventError: (e       , message           ) => {\n        if (['ChelErrorUnrecoverable', 'ChelErrorForkedChain'].includes(e?.name)) {\n          const contractID = message.contractID()\n          sbp('okTurtles.events/emit', SERIOUS_ERROR, e, { contractID, message })\n        }\n        if (sbp('okTurtles.data/get', 'sideEffectError') !== message.hash()) {\n          // Avoid duplicate notifications for the same message.\n          errorNotification('handleEvent', e, message)\n        }\n      },\n      processError: (e       , message           , msgMeta                                                                                                                                ) => {\n        if (e.name === 'GIErrorIgnoreAndBan') {\n          sbp('okTurtles.eventQueue/queueEvent', message.contractID(), [\n            'gi.actions/group/autobanUser', message, e, msgMeta\n          ])\n        }\n        // For now, we ignore all missing keys errors\n        if (e.name === 'ChelErrorDecryptionKeyNotFound') {\n          return\n        }\n        // We also ignore errors related to outgoing messages\n        if (message.direction() === 'outgoing') {\n          console.warn('Ignoring error on outgoing message', message, e)\n          return\n        }\n        errorNotification('process', e, message, msgMeta)\n      },\n      sideEffectError: (e       , message           ) => {\n        const contractID = message.contractID()\n        sbp('okTurtles.events/emit', SERIOUS_ERROR, e, { contractID, message })\n        sbp('okTurtles.data/set', 'sideEffectError', message.hash())\n        errorNotification('sideEffect', e, message)\n      }\n    }\n  })\n\n  sbp('okTurtles.events/on', LOGIN_COMPLETE, () => {\n    const state = sbp('chelonia/rootState')\n    if (!state.loggedIn) {\n      console.warn('Received LOGIN_COMPLETE event but state.loggedIn is not an object')\n      return\n    }\n\n    sbp('gi.actions/identity/kv/load').catch(e => {\n      console.error(\"Error from 'gi.actions/identity/kv/load' during login:\", e)\n    })\n\n    saveChelonia().catch(e => {\n      console.error('LOGIN_COMPLETE handler: Error saving Chelonia state', e)\n    })\n  })\n\n  sbp('okTurtles.events/on', CHELONIA_STATE_MODIFIED, () => {\n    saveChelonia().catch(e => {\n      console.error('CHELONIA_STATE_MODIFIED handler: Error saving Chelonia state', e)\n    })\n  })\n\n  sbp('okTurtles.events/on', LOGGING_OUT, () => {\n    logoutInProgress = true\n  })\n\n  sbp('okTurtles.events/on', LOGOUT, () => {\n    // TODO: [SW] This is to be done by the SW\n    saveCheloniaDebounced.clear()\n    Promise.all([\n      sbp('chelonia/reset'),\n      sbp('gi.db/settings/delete', SETTING_CHELONIA_STATE)\n    ]).catch(e => {\n      console.error('Logout event: error deleting Chelonia state:', e)\n    }).finally(() => {\n      logoutInProgress = false\n    })\n  })\n\n  sbp('okTurtles.events/on', CONTRACTS_MODIFIED, (_, { added }) => {\n    // Wait for the added contracts to be ready, then call the update function\n    if (!added.length) return\n    const rootState = sbp('chelonia/rootState')\n    added.forEach((cID) => {\n      switch (rootState.contracts[cID]?.type) {\n        case 'gi.contracts/identity':\n          if (cID === rootState.loggedIn?.identityContractID) {\n            sbp('chelonia/kv/setFilter', cID, [KV_KEYS.UNREAD_MESSAGES, KV_KEYS.PREFERENCES, KV_KEYS.NOTIFICATIONS])\n            return\n          }\n          // Use the default case for foreign identity contracts\n          break\n        case 'gi.contracts/group':\n          sbp('chelonia/kv/setFilter', cID, [KV_KEYS.LAST_LOGGED_IN])\n          return\n      }\n      sbp('chelonia/kv/setFilter', cID, [])\n    })\n  })\n\n  // must create the connection before we call login\n  sbp('okTurtles.data/set', PUBSUB_INSTANCE, sbp('chelonia/connect', {\n    messageHandlers: {\n      [NOTIFICATION_TYPE.VERSION_INFO] (msg) {\n        const ourVersion = process.env.GI_VERSION\n        const theirVersion = msg.data.GI_VERSION\n\n        const ourContractsVersion = process.env.CONTRACTS_VERSION\n        const theirContractsVersion = msg.data.CONTRACTS_VERSION\n\n        const isContractVersionDiff = ourContractsVersion !== theirContractsVersion\n        const isGIVersionDiff = ourVersion !== theirVersion\n        // We only compare GI_VERSION in development mode so that the page auto-refreshes if `grunt dev` is re-run\n        // This check cannot be done in production mode as it would lead to an infinite page refresh bug\n        // when using `grunt deploy` with `grunt serve`\n        console.info('VERSION_INFO received:', {\n          ourVersion,\n          theirVersion,\n          ourContractsVersion,\n          theirContractsVersion\n        })\n        if (isContractVersionDiff || isGIVersionDiff) {\n          sbp('okTurtles.events/emit', NOTIFICATION_TYPE.VERSION_INFO, msg.data)\n        }\n      },\n      [REQUEST_TYPE.PUSH_ACTION] (msg) {\n        sbp('okTurtles.events/emit', REQUEST_TYPE.PUSH_ACTION, { data: msg.data })\n      },\n      [NOTIFICATION_TYPE.PUB] (msg) {\n        const { contractID, innerSigningContractID, data } = msg\n\n        switch (data[0]) {\n          case 'gi.contracts/chatroom/user-typing-event': {\n            sbp('okTurtles.events/emit', CHATROOM_USER_TYPING, { contractID, innerSigningContractID })\n            break\n          }\n          case 'gi.contracts/chatroom/user-stop-typing-event': {\n            sbp('okTurtles.events/emit', CHATROOM_USER_STOP_TYPING, { contractID, innerSigningContractID })\n            break\n          }\n          default: {\n            console.log(`[pubsub] Received data from channel ${contractID}:`, data)\n          }\n        }\n      },\n      [NOTIFICATION_TYPE.KV] ([key, value]) {\n        const { contractID, data } = value\n        if (!data) return\n\n        sbp('okTurtles.events/emit', KV_EVENT, { contractID, key, data })\n      },\n      [NOTIFICATION_TYPE.DELETION] (contractID) {\n        console.info('[messageHandler] Contract ID ' + contractID + ' has been deleted')\n        handleDeletedContract(contractID).catch(e => {\n          console.error('[messageHandler] Error handling contract deletion', e)\n        })\n      }\n    },\n    handlers: {\n      offline () {\n        sbp('okTurtles.events/emit', OFFLINE)\n      },\n      online () {\n        sbp('okTurtles.events/emit', ONLINE)\n        console.info('back online!')\n      },\n      'reconnection-attempt' () {\n        sbp('okTurtles.events/emit', RECONNECTING)\n      },\n      'reconnection-failed' () {\n        sbp('okTurtles.events/emit', RECONNECTION_FAILED)\n      },\n      'reconnection-succeeded' () {\n        sbp('okTurtles.events/emit', ONLINE)\n        console.info('reconnected to pubsub!')\n      }\n    }\n  }))\n\n  // this should be done here and not in LOGIN_COMPLETE because:\n  // If the SW awakens but it's not a navigation event, you'll skip the code syncing all\n  // contracts, which will remove all contracts from the push subscription. So, the second\n  // time the SW wakes up it'll have no contracts\n  sbp('gi.db/settings/load', SETTING_CURRENT_USER).then(async (identityContractID) => {\n    // This loads CHELONIA_STATE when _not_ running as a service worker\n    const cheloniaState = await sbp('chelonia/rootState')\n    if (!cheloniaState || !identityContractID) return\n    if (cheloniaState.loggedIn?.identityContractID !== identityContractID) return\n    // it is important we first login before syncing any contracts here since that will load the\n    // state and the contract sideEffects will sometimes need that state, e.g. loggedIn.identityContractID\n    await sbp('chelonia/contract/sync', identityContractID).then(async () => {\n      const contractIDs = groupContractsByType(cheloniaState.contracts)\n      await syncContractsInOrder(contractIDs)\n    }).catch(e => {\n      console.error('[setupChelonia] Error syncing identity contract and groups', e)\n    })\n  })\n}\n\n// This implements a 'singleton promise' or 'lazy intialization' of setupChelonia.\n// The idea is that `setupChelonia` be called only once, regardless of how many\n// actual invocations actually happen (unless the last invocation resolved\n// and rejected)\nexport default ((() => {\n  const singletonFn = () => {\n    if (!promise) {\n      promise = setupChelonia().catch((e) => {\n        console.error('[setupChelonia] Error during chelonia setup', e)\n        promise = undefined // Reset on error\n        throw e // Re-throw the error\n      })\n    }\n    return promise\n  }\n  let promise\n\n  // Listen for `PUBSUB_ERROR` events. These cause the WS to be destroyed\n  // When this happens, if `setupChelonia` has been called, we will reset\n  // `promise` and then call `singletonFn` after a short delay.\n  sbp('okTurtles.events/on', PUBSUB_ERROR, () => {\n    if (!promise) return\n    promise = undefined\n    setTimeout(() => singletonFn().catch((e) => {\n      console.error('[PUBSUB_ERROR handler] Error setting up Chelonia', e)\n    }), 100)\n  })\n\n  return singletonFn\n})()                     )\n", "import { L } from '@common/common.js'\nimport { PUBSUB_INSTANCE } from '@controller/instance-keys.js'\nimport { makeNotification } from '@model/notifications/nativeNotification.js'\nimport sbp from '@sbp/sbp'\nimport setupChelonia from '~/frontend/setupChelonia.js'\nimport { NOTIFICATION_TYPE, PUBSUB_RECONNECTION_SUCCEEDED, PUSH_SERVER_ACTION_TYPE, REQUEST_TYPE, createMessage } from '~/shared/pubsub.js'\nimport { getSubscriptionId } from '~/shared/functions.js'\nimport { DEVICE_SETTINGS } from '@utils/constants.js'\n\n// The application server (public) key could be either an ArrayBuffer (which is\n// what we get from fetching the current subscription), or it could be a\n// base64url-encoded string (which is what we usually get from the server)\n// This string coerces both of these into an `Uint8Array` instance.\nconst strOrBufToBuf = (v                                   ) => {\n  if (typeof v === 'string') {\n    v = Buffer.from(\n      // Convert from base64url to base64\n      v.replace(/_/g, '/').replace(/-/g, '+') + '='.repeat((4 - v.length % 4) % 4),\n      'base64'\n    )\n    return v\n  }\n  return new Uint8Array(v)\n}\n\nconst bufferEq = (a                           , b                           ) => {\n  // eslint-disable-next-line eqeqeq\n  if (a == null || b == null) return a == b\n\n  const ab = strOrBufToBuf(a)\n  const bb = strOrBufToBuf(b)\n\n  if (ab.byteLength !== bb.byteLength) return false\n\n  for (let i = ab.byteLength - 1; i >= 0; i--) {\n    if (ab[i] !== bb[i]) return false\n  }\n\n  return true\n}\n\nexport default (sbp('sbp/selectors/register', {\n  'push/getSubscriptionOptions': (() => {\n    let cachedVapidInformation\n\n    sbp('okTurtles.events/on', REQUEST_TYPE.PUSH_ACTION, ({ data }) => {\n      if (data.type !== PUSH_SERVER_ACTION_TYPE.SEND_PUBLIC_KEY) return\n      const oldKey = cachedVapidInformation?.[1].applicationServerKey\n      cachedVapidInformation = [performance.now(), {\n        userVisibleOnly: true,\n        applicationServerKey: data.data\n      }]\n      if (oldKey === data.data) return\n      (async () => {\n        const subscription = await self.registration.pushManager.getSubscription()\n        if (!subscription) return\n        if (bufferEq(subscription.options.applicationServerKey, data.data)) return\n        console.warn('VAPID server key changed; removing existing subscription and setting up a new one', {\n          oldApplicationServerPublicKey: subscription.options.applicationServerKey && Buffer.from(subscription.options.applicationServerKey).toString('base64'),\n          newApplicationServerPublicKey: data.data\n        })\n        // If unsubscribe fails, it doesn't make much sense to proceed, as we\n        // can't really create new subscription\n        await subscription.unsubscribe()\n        // return b/c device settings not loaded\n        if (!sbp('chelonia/rootState').loggedIn || sbp('sw/deviceSettings/get', DEVICE_SETTINGS.DISABLE_NOTIFICATIONS)) return\n        const newSubscription = await self.registration.pushManager.subscribe(cachedVapidInformation[1])\n        await sbp('push/reportExistingSubscription', newSubscription?.toJSON(), newSubscription?.options.applicationServerKey)\n      })()\n    })\n\n    return () => {\n      if (\n        cachedVapidInformation &&\n        // Cache the VAPID information for one hour. The server public\n        // information should change very infrequently, if it changes at all.\n        (performance.now() - cachedVapidInformation[0]) < 3600e3\n      ) {\n        return Promise.resolve(cachedVapidInformation[1])\n      }\n\n      return new Promise((resolve, reject) => {\n        const handler = ({ data }) => {\n          if (data.type !== PUSH_SERVER_ACTION_TYPE.SEND_PUBLIC_KEY) return\n          sbp('okTurtles.events/off', REQUEST_TYPE.PUSH_ACTION, handler)\n          clearTimeout(timeoutId)\n          // Set in the handler above\n          resolve(cachedVapidInformation[1])\n        }\n        const pubsub = sbp('okTurtles.data/get', PUBSUB_INSTANCE)\n        if (!pubsub) reject(new Error('Missing pubsub instance'))\n\n        const readyState = pubsub.socket?.readyState\n        if (readyState !== WebSocket.OPEN) {\n          reject(new Error('WebSocket connection is not open'))\n        }\n\n        sbp('okTurtles.events/on', REQUEST_TYPE.PUSH_ACTION, handler)\n        const timeoutId = setTimeout(() => {\n          sbp('okTurtles.events/off', REQUEST_TYPE.PUSH_ACTION, handler)\n          reject(new Error('Timed out requesting VAPID key'))\n        }, 10e3)\n\n        pubsub.socket.send(createMessage(\n          REQUEST_TYPE.PUSH_ACTION,\n          { action: PUSH_SERVER_ACTION_TYPE.SEND_PUBLIC_KEY }\n        ))\n      })\n    }\n  })(),\n  // This function reports the existing push subscription to the server\n  // It is called in three scenarios:\n  //   1. When a push subscription is created (usually right after granting the\n  //      notification permission). This is done from outside of the SW, because\n  //      requesting permissions can't be done from the SW itself and typically\n  //      requires user interaction.\n  //   2. When re-connecting (or connecting) to the server via WebSocket. This\n  //      keeps push subscriptions paired to WS connections, so that we can\n  //      seamlessly switch from WS to Web Push notifications on disconnection.\n  //   3. On the 'pushsubscriptionchange' event. This is to let the server know\n  //      to update the existing push subscription and replace it with a new\n  //      one.\n  'push/reportExistingSubscription': (() => {\n    const reportedSubscriptionBySocket = new WeakMap()\n    async function getSubID (subscription) {\n      try {\n        return await getSubscriptionId(subscription)\n      } catch (e) {\n        return `ERR: ${e.message}`\n      }\n    }\n\n    return async (subscriptionInfo         , applicationServerKey              ) => {\n      const pubsub = sbp('okTurtles.data/get', PUBSUB_INSTANCE)\n      if (!pubsub) throw new Error('Missing pubsub instance')\n\n      const readyState = pubsub.socket?.readyState\n      if (readyState !== WebSocket.OPEN) {\n        throw new Error('WebSocket connection is not open')\n      }\n\n      const socket = pubsub.socket\n      const reported = reportedSubscriptionBySocket.get(socket)\n      reportedSubscriptionBySocket.set(socket, subscriptionInfo)\n      if (subscriptionInfo?.endpoint) {\n        if (!reported || subscriptionInfo.endpoint !== reported.endpoint) {\n          const subID = await getSubID(subscriptionInfo)\n          const host = new URL(subscriptionInfo.endpoint).host\n          console.info(`[reportExistingSubscription] reporting '${subID}':`, host)\n          // If the subscription has changed, report it to the server\n          pubsub.socket.send(createMessage(\n            REQUEST_TYPE.PUSH_ACTION,\n            {\n              action: PUSH_SERVER_ACTION_TYPE.STORE_SUBSCRIPTION,\n              payload: {\n                applicationServerKey: applicationServerKey\n                  ? Buffer.from(applicationServerKey).toString('base64')\n                  : null,\n                settings: {\n                  heartbeatInterval: 12 * 60 * 60 * 1000\n                },\n                subscriptionInfo\n              }\n            }\n          ))\n        }\n      } else if (reported) {\n        const subID = await getSubID(reported)\n        const host = new URL(reported.endpoint).host\n        console.info(`[reportExistingSubscription] removing subscription '${subID}':`, host)\n        // If the subscription has been removed, also report it to the server\n        pubsub.socket.send(createMessage(\n          REQUEST_TYPE.PUSH_ACTION,\n          { action: PUSH_SERVER_ACTION_TYPE.DELETE_SUBSCRIPTION, payload: null }\n        ))\n      }\n    }\n  })()\n})          )\n\nif (self.registration?.pushManager) {\n  (() => {\n    let inProgress = false\n    sbp('okTurtles.events/on', PUBSUB_RECONNECTION_SUCCEEDED, async () => {\n      if (inProgress) return\n      if (!sbp('chelonia/rootState').loggedIn) return // return b/c device settings not loaded\n      inProgress = true\n      const disableNotifications = sbp('sw/deviceSettings/get', DEVICE_SETTINGS.DISABLE_NOTIFICATIONS)\n      console.info('pubsub reconnected. disableNotifications=', disableNotifications)\n      if (!disableNotifications) {\n        try {\n          const subscription = await self.registration.pushManager.getSubscription()\n          await sbp('push/reportExistingSubscription', subscription?.toJSON(), subscription?.options.applicationServerKey)\n        } catch (e) {\n          console.error('Error reporting subscription on reconnection', e)\n        }\n      }\n      inProgress = false\n    })\n  })()\n}\n\nself.addEventListener('push', function (event) {\n  // PushEvent reference: https://developer.mozilla.org/en-US/docs/Web/API/PushEvent\n  if (!event.data) return\n  let data\n  try {\n    data = event.data.json()\n  } catch (e) {\n    console.error('[push event] Invalid JSON:', e)\n    return\n  }\n  if (data.type === NOTIFICATION_TYPE.ENTRY) {\n    event.waitUntil(setupChelonia().then(() => {\n      // We have event data, so we process it\n      if (data.data) return sbp('chelonia/handleEvent', data.data)\n      // We just sync the contract if there's no event data. Sync could fail if\n      // there are no references, hence the catch\n      return sbp('chelonia/contract/sync', data.contractID).catch(e => {\n        console.error('[push event] Error syncing', data.contractID, e)\n      })\n    }).catch((e) => {\n      console.error('Error processing push event', e)\n      if (data.contractType === 'gi.contracts/chatroom') {\n        return makeNotification({\n          title: L('Chatroom activity'),\n          body: L('New chatroom message. An iOS bug prevents us from saying what it is.')\n        })\n      } else if (data.contractType === 'gi.contracts/group') {\n        return makeNotification({\n          title: L('Group activity'),\n          body: L('New group activity. An iOS bug prevents us from saying what it is.')\n        })\n      }\n    }))\n  } else if (data.type === 'recurring') {\n    event.waitUntil(\n      sbp('gi.periodicNotifications/init')\n    )\n  }\n}, false)\n\nself.addEventListener('pushsubscriptionchange', function (event) {\n  // NOTE: Currently there is no specific way to validate if a push-subscription is valid. So it has to be handled in the front-end.\n  // (reference: https://pushpad.xyz/blog/web-push-how-to-check-if-a-push-endpoint-is-still-valid)\n  event.waitUntil((async () => {\n    try {\n      let subscription = null\n      if (event.oldSubscription) {\n        subscription = await self.registration.pushManager.subscribe(event.oldSubscription.options)\n      }\n      await sbp('push/reportExistingSubscription', subscription?.toJSON(), subscription?.options.applicationServerKey)\n    } catch (e) {\n      console.error('[pushsubscriptionchange] Error resubscribing:', e)\n    }\n  })())\n}, false)\n\nself.addEventListener('periodicsync', (event) => {\n  if (event.tag === 'periodic-notifications') {\n    event.waitUntil(\n      sbp('gi.periodicNotifications/init')\n    )\n  }\n})\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport { NAMESPACE_REGISTRATION } from '~/frontend/utils/events.js'\n\n// NOTE: prefix groups with `group/` and users with `user/` ?\nsbp('sbp/selectors/register', {\n  'namespace/lookupCached': (name        ) => {\n    const cache = sbp('chelonia/rootState').namespaceLookups\n    // 'cache' may be undefined when starting up or after calling chelonia/reset\n    return cache?.[name] ?? null\n  },\n  'namespace/lookupReverseCached': (id        ) => {\n    const cache = sbp('chelonia/rootState').reverseNamespaceLookups\n    return cache?.[id] ?? null\n  },\n  'namespace/lookup': (name        , { skipCache }                         = { skipCache: false }) => {\n    if (!skipCache) {\n      const cached = sbp('namespace/lookupCached', name)\n      if (cached) {\n        // Wrapping in a Promise to return a consistent type across all execution\n        // paths (next return is a Promise)\n        // This way we can call .then() on the result\n        return Promise.resolve(cached)\n      }\n    }\n    return fetch(`${sbp('okTurtles.data/get', 'API_URL')}/name/${encodeURIComponent(name)}`).then((r        ) => {\n      if (!r.ok) {\n        console.warn(`namespace/lookup: ${r.status} for ${name}`)\n        if (r.status !== 404) {\n          throw new Error(`${r.status}: ${r.statusText}`)\n        }\n        return null\n      }\n      return r['text']()\n    }).then(value => {\n      if (value !== null) {\n        const reactiveSet = sbp('chelonia/config').reactiveSet\n        const rootState = sbp('chelonia/rootState')\n        if (!rootState.namespaceLookups) reactiveSet(rootState, 'namespaceLookups', Object.create(null))\n        if (!rootState.reverseNamespaceLookups) reactiveSet(rootState, 'reverseNamespaceLookups', Object.create(null))\n        const cache = rootState.namespaceLookups\n        const reverseCache = rootState.reverseNamespaceLookups\n        reactiveSet(cache, name, value)\n        reactiveSet(reverseCache, value, name)\n        sbp('okTurtles.events/emit', NAMESPACE_REGISTRATION, { name, value })\n      } else {\n        const rootState = sbp('chelonia/rootState')\n        const cache = rootState.namespaceLookups\n        const currentValue = cache?.[name]\n        if (currentValue) {\n          const reactiveDel = sbp('chelonia/config').reactiveDel\n          const reverseCache = rootState.reverseNamespaceLookups\n\n          reactiveDel(cache, name)\n          if (reverseCache[currentValue] === name) {\n            reactiveDel(cache, currentValue)\n          }\n          sbp('okTurtles.events/emit', NAMESPACE_REGISTRATION, { name, deletedValue: currentValue })\n        }\n      }\n      return value\n    })\n  }\n})\n", "'use strict'\n\nimport { deserializer, serializer } from '@chelonia/serdes'\nimport { MESSAGE_RECEIVE, MESSAGE_SEND, PROPOSAL_ARCHIVED } from '@model/contracts/shared/constants.js'\nimport periodicNotificationEntries from '@model/notifications/mainPeriodicNotificationEntries.js'\nimport { makeNotification } from '@model/notifications/nativeNotification.js'\nimport '@model/notifications/periodicNotifications.js'\nimport '@model/swCaptureLogs.js'\nimport '@sbp/okturtles.data'\nimport '@sbp/okturtles.eventqueue'\nimport '@sbp/okturtles.events'\nimport sbp from '@sbp/sbp'\nimport '~/frontend/controller/actions/index.js'\nimport chatroomGetters from '~/frontend/model/chatroom/getters.js'\nimport getters from '~/frontend/model/getters.js'\nimport notificationGetters from '~/frontend/model/notifications/getters.js'\nimport '~/frontend/model/notifications/selectors.js'\nimport setupChelonia from '~/frontend/setupChelonia.js'\nimport { KV_KEYS } from '~/frontend/utils/constants.js'\nimport { CHELONIA_STATE_MODIFIED, LOGGING_OUT, LOGIN, LOGIN_ERROR, LOGOUT } from '~/frontend/utils/events.js'\nimport { SPMessage } from '~/shared/domains/chelonia/SPMessage.js'\nimport { Secret } from '~/shared/domains/chelonia/Secret.js'\nimport { CHELONIA_RESET, CONTRACTS_MODIFIED, CONTRACT_IS_SYNCING, CONTRACT_REGISTERED, EVENT_HANDLED } from '~/shared/domains/chelonia/events.js'\nimport { NOTIFICATION_TYPE } from '~/shared/pubsub.js'\nimport {\n  ACCEPTED_GROUP, CAPTURED_LOGS, CHATROOM_USER_STOP_TYPING,\n  CHATROOM_USER_TYPING, DELETED_CHATROOM,\n  ERROR_GROUP_GENERAL_CHATROOM_DOES_NOT_EXIST, ERROR_JOINING_CHATROOM,\n  JOINED_CHATROOM, JOINED_GROUP,\n  KV_EVENT, LEFT_CHATROOM, LEFT_GROUP, NAMESPACE_REGISTRATION,\n  NEW_CHATROOM_NOTIFICATION_SETTINGS,\n  NEW_CHATROOM_UNREAD_POSITION, NEW_LAST_LOGGED_IN, NEW_PREFERENCES,\n  NEW_UNREAD_MESSAGES, NOTIFICATION_EMITTED, NOTIFICATION_REMOVED,\n  NOTIFICATION_STATUS_LOADED, OFFLINE, ONLINE, RECONNECTING,\n  RECONNECTION_FAILED, SERIOUS_ERROR, SWITCH_GROUP\n} from '../../utils/events.js'\nimport './push.js'\nimport './sw-namespace.js'\n\nconsole.info('GI_VERSION:', process.env.GI_VERSION)\nconsole.info('GI_GIT_VERSION:', process.env.GI_GIT_VERSION)\nconsole.info('CONTRACTS_VERSION:', process.env.CONTRACTS_VERSION)\nconsole.info('LIGHTWEIGHT_CLIENT:', process.env.LIGHTWEIGHT_CLIENT)\nconsole.info('NODE_ENV:', process.env.NODE_ENV)\n\nif (process.env.CI) {\n  const originalFetch = self.fetch\n  self.fetch = (...args) => {\n    return originalFetch.apply(self, args).catch(e => {\n      console.error('FETCH FAILED', args, new Error().stack, e)\n      throw e\n    })\n  }\n}\n\ndeserializer.register(SPMessage)\ndeserializer.register(Secret)\n\n// https://serviceworke.rs/message-relay_service-worker_doc.html\n// https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers\n// https://jakearchibald.com/2014/using-serviceworker-today/\n// https://github.com/w3c/ServiceWorker/blob/master/explainer.md\n// https://frontendian.co/service-workers\n// https://stackoverflow.com/a/49748437 => https://medium.com/@nekrtemplar/self-destroying-serviceworker-73d62921d717 => https://love2dev.com/blog/how-to-uninstall-a-service-worker/\n\nconst reducer = (o, v) => { o[v] = true; return o }\n// Domains for which debug logging won't be enabled.\nconst domainBlacklist = [\n  'sbp',\n  'okTurtles.data'\n].reduce(reducer, {})\n// Selectors for which debug logging won't be enabled.\nconst selectorBlacklist = [\n  'chelonia.db/get',\n  'chelonia.db/set',\n  'chelonia/rootState',\n  'chelonia/haveSecretKey',\n  'chelonia/private/enqueuePostSyncOps',\n  'chelonia/private/invoke',\n  'state/vuex/state',\n  'state/vuex/getters',\n  'state/vuex/settings',\n  'gi.db/settings/save',\n  'gi.db/logs/save'\n].reduce(reducer, {})\nsbp('sbp/filters/global/add', (domain, selector, data) => {\n  if (domainBlacklist[domain] || selectorBlacklist[selector]) return\n  console.debug(`[sbp] ${selector}`, data)\n})\n\n// This function sets up state keys used in the SW that mirror the corresponding\n// Vuex keys\nconst setupRootState = () => {\n  const rootState = sbp('chelonia/rootState')\n\n  if (!rootState.chatroom) rootState.chatroom = Object.create(null)\n  if (!rootState.chatroom.chatNotificationSettings) rootState.chatroom.chatNotificationSettings = Object.create(null)\n  if (!rootState.chatroom.chatRoomScrollPosition) rootState.chatroom.chatRoomScrollPosition = Object.create(null)\n  if (!rootState.chatroom.unreadMessages) rootState.chatroom.unreadMessages = Object.create(null)\n\n  if (!rootState.lastLoggedIn) rootState.lastLoggedIn = Object.create(null)\n\n  if (!rootState.notifications) rootState.notifications = Object.create(null)\n  if (!rootState.notifications.items) rootState.notifications.items = []\n  if (!rootState.notifications.status) rootState.notifications.status = Object.create(null)\n\n  if (!rootState.periodicNotificationAlreadyFiredMap) {\n    rootState.periodicNotificationAlreadyFiredMap = {\n      alreadyFired: Object.create(null), // { notificationKey: boolean },\n      lastRun: Object.create(null) // { notificationKey: number },\n    }\n  }\n\n  if (!rootState.namespaceLookups) rootState.namespaceLookups = Object.create(null)\n  if (!rootState.reverseNamespaceLookups) rootState.reverseNamespaceLookups = Object.create(null)\n\n  if (!rootState.deviceSettings) rootState.deviceSettings = Object.create(null)\n}\n\nsbp('okTurtles.events/on', CHELONIA_RESET, setupRootState)\n\nconst broadcastMessage = (...args) => {\n  self.clients.matchAll()\n    .then((clientList) => {\n      // eslint-disable-next-line require-await\n      return Promise.all(clientList.map(async (client) => {\n        return client.postMessage(...args)\n      })).catch(e => {\n        console.error('[broadcastMessage] Error', args, e)\n      })\n    })\n}\n\n// These are all of the events that will be forwarded to all open tabs and windows\n;[\n  CHELONIA_RESET, CONTRACTS_MODIFIED, CONTRACT_IS_SYNCING,\n  ERROR_GROUP_GENERAL_CHATROOM_DOES_NOT_EXIST, ERROR_JOINING_CHATROOM,\n  EVENT_HANDLED, LOGIN, LOGIN_ERROR, LOGOUT, LOGGING_OUT, ACCEPTED_GROUP,\n  CHATROOM_USER_STOP_TYPING, CHATROOM_USER_TYPING, DELETED_CHATROOM,\n  LEFT_CHATROOM, LEFT_GROUP, JOINED_CHATROOM, JOINED_GROUP, KV_EVENT,\n  NOTIFICATION_TYPE.VERSION_INFO,\n  MESSAGE_RECEIVE, MESSAGE_SEND, NAMESPACE_REGISTRATION, NEW_LAST_LOGGED_IN,\n  NEW_PREFERENCES, NEW_UNREAD_MESSAGES, NOTIFICATION_EMITTED,\n  NOTIFICATION_REMOVED, NOTIFICATION_STATUS_LOADED, OFFLINE, ONLINE,\n  RECONNECTING, RECONNECTION_FAILED, PROPOSAL_ARCHIVED, SERIOUS_ERROR, SWITCH_GROUP\n].forEach(et => {\n  sbp('okTurtles.events/on', et, (...args) => {\n    const { data, transferables } = serializer(args)\n    const message = {\n      type: 'event',\n      subtype: et,\n      data\n    }\n    broadcastMessage(message, transferables)\n  })\n})\n\nsbp('okTurtles.events/on', CONTRACT_REGISTERED, (contract) => {\n  // Remove function types from contract data\n  // This avoids unnecessary MessagePorts\n  const argsCopy = {\n    manifest: contract.manifest,\n    name: contract.name\n  }\n  const { data, transferables } = serializer([argsCopy])\n  const message = {\n    type: 'event',\n    subtype: CONTRACT_REGISTERED,\n    data\n  }\n  broadcastMessage(message, transferables)\n})\n\n// This event (`NEW_CHATROOM_UNREAD_POSITION`) requires special handling because\n// it can be sent from the SW to clients or from clients to the SW. Handling it\n// the normal way (in the forwarding logic above) would result in event loops.\nsbp('okTurtles.events/on', NEW_CHATROOM_UNREAD_POSITION, (args) => {\n  // Set a 'from' parameter to signal it comes from the SW\n  const argsCopy = { ...args, from: 'sw' }\n  const { data, transferables } = serializer([argsCopy])\n  const message = {\n    type: 'event',\n    subtype: NEW_CHATROOM_UNREAD_POSITION,\n    data\n  }\n  broadcastMessage(message, transferables)\n})\nsbp('okTurtles.events/on', NEW_CHATROOM_NOTIFICATION_SETTINGS, (args) => {\n  // Set a 'from' parameter to signal it comes from the SW\n  const argsCopy = { ...args, from: 'sw' }\n  const { data, transferables } = serializer([argsCopy])\n  const message = {\n    type: 'event',\n    subtype: NEW_CHATROOM_NOTIFICATION_SETTINGS,\n    data\n  }\n  broadcastMessage(message, transferables)\n})\n\n// Logs are treated especially to avoid spamming logs with event emitted\n// entries\nsbp('okTurtles.events/on', CAPTURED_LOGS, (...args) => {\n  const { data, transferables } = serializer(args)\n  const message = {\n    type: CAPTURED_LOGS,\n    data\n  }\n  broadcastMessage(message, transferables)\n})\n\nsbp('sbp/selectors/register', {\n  'state/vuex/state': () => sbp('chelonia/rootState'),\n  'state/vuex/getters': (() => {\n    // Singleton lazily generated getters\n    let computedGetters\n\n    return () => {\n      if (!computedGetters) {\n        computedGetters = Object.create(null)\n        Object.defineProperties(computedGetters, Object.fromEntries(Object.entries(getters).map(([getter, fn]                    ) => {\n          return [getter, {\n            get: function () {\n              const state = sbp('chelonia/rootState')\n              // `fn` takes the state as the first parameter and the getters as\n              // a second parameter. We use `this` instead of `computedGetters`\n              // so that we can locally override the `computedGetters` object\n              // (e.g., using inheritance or a `Proxy`) to redefine certain\n              // getters. This is convenient, but it's incompatible with the\n              // way Vuex getters work, which do _not_ use `this`.\n              // This incompatibility is fine, since one has to go out of their\n              // way to make `this` and `computedGetters` different.\n              return fn(state, this)\n            }\n          }]\n        })))\n        Object.defineProperties(computedGetters, Object.fromEntries(Object.entries(chatroomGetters).map(([getter, fn]                    ) => {\n          return [getter, {\n            get: function () {\n              const state = sbp('chelonia/rootState')\n              // `state.chatroom` represents the `chatroom` module. For the SW,\n              // this is defined in `sw-primary.js`.\n              // The same idea applies here for the use of `this` instead of\n              // `computedGetters` as above.\n              return fn(state.chatroom || {}, this, state)\n            }\n          }]\n        })))\n        Object.defineProperties(computedGetters, Object.fromEntries(Object.entries(notificationGetters).map(([getter, fn]                    ) => {\n          return [getter, {\n            get: function () {\n              const state = sbp('chelonia/rootState')\n              // `state.chatroom` represents the `chatroom` module. For the SW,\n              // this is defined in `sw-primary.js`.\n              // The same idea applies here for the use of `this` instead of\n              // `computedGetters` as above.\n              return fn(state.notifications || {}, this, state)\n            }\n          }]\n        })))\n        Object.defineProperty(computedGetters, 'currentPaymentPeriodForGroup', {\n          get: function () {\n            return (state) => this.periodStampGivenDateForGroup(state, new Date())\n          }\n        })\n      }\n\n      return computedGetters\n    }\n  })()\n})\n\nconst ourLocation = new URL(self.location)\n\nsbp('sbp/selectors/register', {\n  'controller/router': () => {\n    return { options: { base: ourLocation.searchParams.get('routerBase') } }\n  }\n})\n\nsbp('sbp/selectors/register', {\n  'appLogs/save': () => sbp('swLogs/save')\n})\n\nsbp('sbp/selectors/register', {\n  'sw/version': () => {\n    return {\n      GI_VERSION: process.env.GI_VERSION,\n      GI_GIT_VERSION: process.env.GI_GIT_VERSION,\n      CONTRACTS_VERSION: process.env.CONTRACTS_VERSION,\n      LIGHTWEIGHT_CLIENT: process.env.LIGHTWEIGHT_CLIENT,\n      NODE_ENV: process.env.NODE_ENV\n    }\n  },\n  'sw/deviceSettings/set': (key, value) => {\n    const reactiveSet = sbp('chelonia/config').reactiveSet\n    const rootState = sbp('chelonia/rootState')\n    reactiveSet(rootState.deviceSettings, key, value)\n  },\n  'sw/deviceSettings/get': (key) => {\n    return sbp('chelonia/rootState').deviceSettings[key]\n  }\n})\n\nsbp('gi.periodicNotifications/importNotifications', periodicNotificationEntries)\n\n// Set up periodic notifications on the `CHELONIA_RESET` event. We do this here,\n// before calling `setupRootState`, so that the `CHELONIA_RESET` it will trigger\n// will set up periodic notifications.\nsbp('okTurtles.events/on', CHELONIA_RESET, () => {\n  sbp('gi.periodicNotifications/clearStatesAndStopTimers')\n  sbp('gi.periodicNotifications/init')\n})\n\nlet currentVersionInfo\nsbp('okTurtles.events/on', NOTIFICATION_TYPE.VERSION_INFO, (versionInfo) => {\n  currentVersionInfo = versionInfo\n})\n\nsbp('okTurtles.data/set', 'API_URL', self.location.origin)\nsetupRootState()\nconst setupPromise = setupChelonia()\n\nself.addEventListener('install', function (event) {\n  console.debug('[sw] install')\n  // `skipWaiting` tells the browser that the SW should immediately move from\n  // installed to activated (or from waiting to activated). We only want to do\n  // this after setup is complete, hence the `.then`.\n  event.waitUntil(setupPromise.then(() => self.skipWaiting()))\n})\n\nself.addEventListener('activate', function (event) {\n  console.debug('[sw] activate')\n\n  // 'clients.claim()' reference: https://web.dev/articles/service-worker-lifecycle#clientsclaim\n  event.waitUntil(self.clients.claim())\n})\n\nself.addEventListener('fetch', function (event) {\n  console.debug(`[sw] fetch : ${event.request.method} - ${event.request.url}`)\n})\n\n// TODO: this doesn't persist data across browser restarts, so try to use\n// the cache instead, or just localstorage. Investigate whether the service worker\n// has the ability to access and clear the localstorage periodically.\n/* const store = {}\nconst sendMessageToClient = async function (payload) {\n  if (!store.clientId) {\n    console.error('[sw] Cannot send a message to a client, because no client id is found')\n    return\n  }\n\n  const client = await self.clients.get(store.clientId)\n  if (client) {\n    client.postMessage(payload)\n  }\n}\n*/\n\nself.addEventListener('message', function (event) {\n  console.debug(`[sw] message from ${event.source.id} of type ${event.data?.type}.`)\n  // const client = await self.clients.get(event.source.id)\n  // const client = await self.clients.get(event.clientId)\n  if (typeof event.data === 'object' && event.data.type) {\n    console.debug('[sw] event received:', event.data)\n    switch (event.data.type) {\n      case 'sbp': {\n        // We don't filter the selectors because such a filter would be\n        // difficult to implement and easy to circumvent.\n        const port = event.data.port\n        ;(async () => await sbp(...deserializer(event.data.data)))().then((r) => {\n          const { data, transferables } = serializer(r)\n          port.postMessage([true, data], transferables)\n        }).catch((e) => {\n          const { data, transferables } = serializer(e)\n          port.postMessage([false, data], transferables)\n        }).finally(() => {\n          port.close()\n        })\n        break\n      }\n      case 'ping':\n        event.source.postMessage({ type: 'pong' })\n        break\n      case 'shutdown':\n        self.registration.unregister()\n          .then(function () {\n            return self.clients.matchAll()\n          })\n          .then(function (clients) {\n            // Force a refresh of each SW window. This ensures that the service\n            // worker is completely removed\n            clients.forEach(client => client.navigate(client.url))\n          })\n        break\n      case 'skip-waiting':\n        self.skipWaiting()\n        break\n      case 'event':\n        sbp('okTurtles.events/emit', event.data.subtype, ...deserializer(event.data.data))\n        break\n      case 'ready': {\n        // The 'ready' message is sent by a client (i.e., a tab or window) to\n        // ensure that Chelonia has been setup\n        const port = event.data.port\n        Promise.race([\n          setupChelonia(),\n          new Promise((resolve, reject) => {\n            setTimeout(() => {\n              reject(new Error('Timed out setting up Chelonia'))\n            }, 30e3)\n          })\n        ]).then(() => {\n          port.postMessage({\n            type: 'ready',\n            currentSyncs: sbp('chelonia/contract/currentSyncs'),\n            GI_VERSION: process.env.GI_VERSION\n          })\n        }, (e) => {\n          port.postMessage({ type: 'error', error: e })\n        }).finally(() => {\n          port.close()\n        })\n\n        // If the window is outdated (different GI_VERSION), trigger an event\n        // of type 'NOTIFICATION_TYPE.VERSION_INFO'.\n        // This handles new SW clients that have an outdated\n        // `process.env.GI_VERSION` (for example, by having loaded a cached\n        // version of `main.js`).\n        if (\n          currentVersionInfo &&\n          event.source &&\n          event.data.GI_VERSION !== currentVersionInfo.GI_VERSION\n        ) {\n          event.source.postMessage({\n            type: 'event',\n            subtype: NOTIFICATION_TYPE.VERSION_INFO,\n            data: [currentVersionInfo]\n          })\n        }\n        break\n      }\n      default:\n        console.error('[sw] unknown message type:', event.data)\n        break\n    }\n  } else {\n    console.error('[sw] unexpected data:', event.data)\n  }\n})\n\n// Handle clicks on notifications issued via registration.showNotification().\nself.addEventListener('notificationclick', event => {\n  console.debug('[sw] Notification clicked:', event.notification)\n  event.notification.close()\n\n  event.waitUntil(\n    self.clients.matchAll({ type: 'window' }).then((clientList) => {\n      clientList.sort((a, b) => {\n        if (a.focused !== b.focused) {\n          return a.focused ? -1 : 1\n        }\n        if (a.visibilityState !== b.visibilityState) {\n        // order is visible, prerender, hidden\n          if (a.visibilityState === 'visible') return -1\n          if (b.visibilityState === 'visible') return 1\n          if (a.visibilityState === 'hidden') return 1\n          if (b.visibilityState === 'hidden') return -1\n        }\n\n        return 0\n      })\n      // If there are no open windows, open a new window when the notification\n      // is clicked\n      if (!clientList.length) {\n        return self.clients.openWindow(`${sbp('controller/router').options.base}${event.notification.data.path ?? '/'}`).then((client) => {\n          if (event.notification.data?.sbpInvocation) {\n            const { data } = serializer(event.notification.data.sbpInvocation)\n            client.postMessage({\n              type: 'sbp',\n              data\n            })\n          } else if (event.notification.data?.groupID) {\n            client.postMessage({\n              type: 'sbp',\n              data: ['state/vuex/commit', 'setCurrentGroupId', { contractID: event.notification.data.groupID }]\n            })\n          }\n\n          return client\n        })\n      }\n      // Otherwise, pick the first client\n      const client = clientList[0]\n      if (event.notification.data?.sbpInvocation) {\n        const { data } = serializer(event.notification.data.sbpInvocation)\n        client.postMessage({\n          type: 'sbp',\n          data\n        })\n      } else if (event.notification.data?.path) {\n        client.postMessage({\n          type: 'navigate',\n          groupID: event.notification.data.groupID,\n          path: event.notification.data.path\n        })\n      }\n      if (!client.focused) return client.focus()\n    }))\n})\n\nsbp('okTurtles.events/on', KV_EVENT, ({ contractID, key, data }) => {\n  const rootState = sbp('chelonia/rootState')\n  const ourIdentityContractID = rootState.loggedIn?.identityContractID\n  if (contractID !== ourIdentityContractID) return\n  // the following keys mirror the corresponding keys in Vuex modules in the\n  // app\n  switch (key) {\n    case KV_KEYS.LAST_LOGGED_IN: {\n      rootState.lastLoggedIn[contractID] = data\n      break\n    }\n    case KV_KEYS.UNREAD_MESSAGES: {\n      rootState.chatroom.unreadMessages = data\n      break\n    }\n    case KV_KEYS.PREFERENCES: {\n      rootState.preferences = data\n      break\n    }\n    case KV_KEYS.NOTIFICATIONS: {\n      rootState.notifications.status = data\n      break\n    }\n    default:\n      return\n  }\n  sbp('okTurtles.events/emit', CHELONIA_STATE_MODIFIED)\n})\n\nsbp('okTurtles.events/on', NEW_CHATROOM_UNREAD_POSITION, ({ chatRoomID, messageHash }) => {\n  const rootState = sbp('chelonia/rootState')\n  if (messageHash) {\n    rootState.chatroom.chatRoomScrollPosition[chatRoomID] = messageHash\n  } else {\n    delete rootState.chatroom.chatRoomScrollPosition[chatRoomID]\n  }\n  sbp('okTurtles.events/emit', CHELONIA_STATE_MODIFIED)\n})\n\nsbp('okTurtles.events/on', NOTIFICATION_EMITTED, (notification) => {\n  const rootState = sbp('state/vuex/state')\n  const rootGetters = sbp('state/vuex/getters')\n  const icon = notification.avatarUserID && rootGetters.ourContactProfilesById[notification.avatarUserID]?.picture\n    ? rootGetters.ourContactProfilesById[notification.avatarUserID].picture\n    : (notification.groupID && rootState[notification.groupID])\n        ? rootGetters.groupSettingsForGroup(rootState[notification.groupID]).groupPicture\n        : undefined\n\n  makeNotification({\n    icon: icon || undefined,\n    title: notification.title,\n    body: notification.plaintextBody,\n    groupID: notification.groupID,\n    path: notification.linkTo,\n    sbpInvocation: notification.sbpInvocation\n  }).catch(e => {\n    console.error('Error displaying native notification', e)\n  })\n})\n\n// These `NEW_*` events are emitted in KV files. To keep things consistent with\n// the browser state, we update the state when these events are generated.\nsbp('okTurtles.events/on', NEW_LAST_LOGGED_IN, ([contractID, data]) => {\n  const rootState = sbp('state/vuex/state')\n  rootState.lastLoggedIn[contractID] = data\n})\nsbp('okTurtles.events/on', NEW_PREFERENCES, (preferences) => {\n  const rootState = sbp('state/vuex/state')\n  rootState.preferences = preferences\n})\nsbp('okTurtles.events/on', NEW_UNREAD_MESSAGES, (currentChatRoomUnreadMessages) => {\n  const rootState = sbp('state/vuex/state')\n  rootState.chatroom.unreadMessages = currentChatRoomUnreadMessages\n})\nsbp('okTurtles.events/on', NEW_CHATROOM_NOTIFICATION_SETTINGS, ({ chatRoomID, settings }) => {\n  const rootState = sbp('chelonia/rootState')\n  if (chatRoomID) {\n    if (!rootState.chatroom.chatNotificationSettings[chatRoomID]) {\n      rootState.chatroom.chatNotificationSettings[chatRoomID] = {}\n    }\n    for (const key in settings) {\n      rootState.chatroom.chatNotificationSettings[chatRoomID][key] = settings[key]\n    }\n  }\n})\n"],
  "mappings": "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AEG,CAAC,EAAG,CAAC,EAC5BH,GAAEK,CAAC,EAAIL,GAAEK,CAAC,EAAIL,GAAEM,CAAC,EACjBN,GAAEI,CAAC,EAAIK,GAAOT,GAAEI,CAAC,EAAIJ,GAAEK,CAAC,EAAG,CAAC,CAC9B,CAKA,SAASI,GAAQF,EAAGC,EAAG,CACrB,OAAQD,IAAMC,EAAMD,GAAM,GAAKC,CACjC,CAGA,IAAME,GAAa,IAAI,YAAY,CACjC,WACA,WACA,WACA,WACA,WACA,WACA,UACA,UACF,CAAC,EAEKC,GAAQ,IAAI,WAAW,CAC3B,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,EACA,EACA,GACA,EACA,EACA,EACA,GACA,EACA,GACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,EACA,EACA,EACA,GACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,GACA,GACA,EACA,EACA,EACA,GACA,EACA,GACA,EACA,GACA,EACA,GACA,EACA,EACA,EACA,GACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,EACA,EACA,GACA,GACA,GACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,EACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,EACA,EACA,EACA,GACA,EACA,GACA,GACA,EACA,GACA,EACA,EACA,EACA,GACA,EACA,GACA,EACA,EACA,EACA,GACA,EACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,EACA,GACA,EACA,GACA,GACA,CACF,CAAC,EAGKX,GAAI,IAAI,YAAY,EAAE,EACtBY,GAAI,IAAI,YAAY,EAAE,EAC5B,SAASC,GAAiBC,EAAKC,EAAM,CACnC,IAAId,EAAI,EACR,IAAKA,EAAI,EAAGA,EAAI,EAAGA,IAEjBD,GAAEC,CAAC,EAAIa,EAAI,EAAEb,CAAC,EACdD,GAAEC,EAAI,CAAC,EAAIS,GAAWT,CAAC,EAUzB,IAPAD,GAAE,EAAE,GAAKc,EAAI,EACbd,GAAE,EAAE,GAAKc,EAAI,EAAI,WACbC,IAEFf,GAAE,EAAE,EAAI,CAACA,GAAE,EAAE,GAGVC,EAAI,EAAGA,EAAI,GAAIA,IAElBW,GAAEX,CAAC,EAAIF,GAAUe,EAAI,EAAG,EAAIb,CAAC,EAO/B,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAElBC,GAAM,EAAG,EAAG,EAAG,GAAIU,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,CAAC,EAC7DC,GAAM,EAAG,EAAG,EAAG,GAAIU,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,CAAC,EAC7DC,GAAM,EAAG,EAAG,GAAI,GAAIU,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,CAAC,EAC9DC,GAAM,EAAG,EAAG,GAAI,GAAIU,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,CAAC,EAC9DC,GAAM,EAAG,EAAG,GAAI,GAAIU,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,CAAC,CAAC,CAAC,EAC9DC,GAAM,EAAG,EAAG,GAAI,GAAIU,GAAED,GAAMV,EAAI,GAAK,EAAE,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,EAAE,CAAC,CAAC,EAChEC,GAAM,EAAG,EAAG,EAAG,GAAIU,GAAED,GAAMV,EAAI,GAAK,EAAE,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,EAAE,CAAC,CAAC,EAC/DC,GAAM,EAAG,EAAG,EAAG,GAAIU,GAAED,GAAMV,EAAI,GAAK,EAAE,CAAC,EAAGW,GAAED,GAAMV,EAAI,GAAK,EAAE,CAAC,CAAC,EAIjE,IAAKA,EAAI,EAAGA,EAAI,EAAGA,IACjBa,EAAI,EAAEb,CAAC,GAAKD,GAAEC,CAAC,EAAID,GAAEC,EAAI,CAAC,CAG9B,CAKA,SAASe,GAAaC,EAAQC,EAAK,CACjC,GAAI,EAAED,EAAS,GAAKA,GAAU,IAC5B,MAAM,IAAI,MAAM,+CAA+C,EAEjE,IAAME,EAASD,EAAMA,EAAI,OAAS,EAClC,GAAIA,GAAO,EAAEC,EAAS,GAAKA,GAAU,IACnC,MAAM,IAAI,MAAM,4CAA4C,EAG9D,IAAML,EAAM,CACV,EAAG,IAAI,YAAYJ,EAAU,EAC7B,EAAG,IAAI,WAAW,EAAE,EACpB,EAAG,EACH,EAAG,EACH,OAAQO,CACV,EACA,OAAAH,EAAI,EAAE,CAAC,GAAK,SAAcK,GAAU,EAAKF,EAErCE,EAAS,IACXC,GAAcN,EAAKI,CAAG,EACtBJ,EAAI,EAAI,IAGHA,CACT,CAIA,SAASM,GAAeN,EAAKO,EAAO,CAClC,QAASpB,EAAI,EAAGA,EAAIoB,EAAM,OAAQpB,IAC5Ba,EAAI,IAAM,KAEZA,EAAI,GAAKA,EAAI,EACbD,GAAgBC,EAAK,EAAK,EAC1BA,EAAI,EAAI,GAEVA,EAAI,EAAEA,EAAI,GAAG,EAAIO,EAAMpB,CAAC,CAE5B,CAIA,SAASqB,GAAcR,EAAK,CAE1B,IADAA,EAAI,GAAKA,EAAI,EACNA,EAAI,EAAI,IAEbA,EAAI,EAAEA,EAAI,GAAG,EAAI,EAEnBD,GAAgBC,EAAK,EAAI,EAGzB,IAAMS,EAAM,IAAI,WAAWT,EAAI,MAAM,EACrC,QAASb,EAAI,EAAGA,EAAIa,EAAI,OAAQb,IAC9BsB,EAAItB,CAAC,EAAKa,EAAI,EAAEb,GAAK,CAAC,GAAM,GAAKA,EAAI,GAAO,IAE9C,OAAOsB,CACT,CAUA,SAASC,GAASH,EAAOH,EAAKD,EAAQ,CAEpCA,EAASA,GAAU,GACnBI,EAAQvB,GAAK,eAAeuB,CAAK,EAGjC,IAAMP,EAAME,GAAYC,EAAQC,CAAG,EACnC,OAAAE,GAAcN,EAAKO,CAAK,EACjBC,GAAaR,CAAG,CACzB,CAUA,SAASW,GAAYJ,EAAOH,EAAKD,EAAQ,CACvC,IAAMS,EAASF,GAAQH,EAAOH,EAAKD,CAAM,EACzC,OAAOnB,GAAK,MAAM4B,CAAM,CAC1B,CAEA7B,GAAO,QAAU,CACf,QAAS2B,GACT,WAAYC,GACZ,YAAaT,GACb,cAAeI,GACf,aAAcE,EAChB,IChWA,IAAAK,GAAAC,GAAA,CAAAC,GAAAC,KAAA,KAAMC,GAAM,KACNC,GAAM,KAEZF,GAAO,QAAU,CACf,QAASC,GAAI,QACb,WAAYA,GAAI,WAChB,YAAaA,GAAI,YACjB,cAAeA,GAAI,cACnB,aAAcA,GAAI,aAClB,QAASC,GAAI,QACb,WAAYA,GAAI,WAChB,YAAaA,GAAI,YACjB,cAAeA,GAAI,cACnB,aAAcA,GAAI,YACpB,ICdA,IAAAC,GAAAC,GAAAC,IAAA,cAEAA,GAAQ,WAAaC,GACrBD,GAAQ,YAAcE,GACtBF,GAAQ,cAAgBG,GAExB,IAAIC,GAAS,CAAC,EACVC,GAAY,CAAC,EACbC,GAAM,OAAO,WAAe,IAAc,WAAa,MAEvDC,GAAO,mEACX,IAASC,GAAI,EAAGC,GAAMF,GAAK,OAAQC,GAAIC,GAAK,EAAED,GAC5CJ,GAAOI,EAAC,EAAID,GAAKC,EAAC,EAClBH,GAAUE,GAAK,WAAWC,EAAC,CAAC,EAAIA,GAFzB,IAAAA,GAAOC,GAOhBJ,GAAU,EAAiB,EAAI,GAC/BA,GAAU,EAAiB,EAAI,GAE/B,SAASK,GAASC,EAAK,CACrB,IAAIF,EAAME,EAAI,OAEd,GAAIF,EAAM,EAAI,EACZ,MAAM,IAAI,MAAM,gDAAgD,EAKlE,IAAIG,EAAWD,EAAI,QAAQ,GAAG,EAC1BC,IAAa,KAAIA,EAAWH,GAEhC,IAAII,EAAkBD,IAAaH,EAC/B,EACA,EAAKG,EAAW,EAEpB,MAAO,CAACA,EAAUC,CAAe,CACnC,CAGA,SAASZ,GAAYU,EAAK,CACxB,IAAIG,EAAOJ,GAAQC,CAAG,EAClBC,EAAWE,EAAK,CAAC,EACjBD,EAAkBC,EAAK,CAAC,EAC5B,OAASF,EAAWC,GAAmB,EAAI,EAAKA,CAClD,CAEA,SAASE,GAAaJ,EAAKC,EAAUC,EAAiB,CACpD,OAASD,EAAWC,GAAmB,EAAI,EAAKA,CAClD,CAEA,SAASX,GAAaS,EAAK,CACzB,IAAIK,EACAF,EAAOJ,GAAQC,CAAG,EAClBC,EAAWE,EAAK,CAAC,EACjBD,EAAkBC,EAAK,CAAC,EAExBG,EAAM,IAAIX,GAAIS,GAAYJ,EAAKC,EAAUC,CAAe,CAAC,EAEzDK,EAAU,EAGVT,EAAMI,EAAkB,EACxBD,EAAW,EACXA,EAEAJ,EACJ,IAAKA,EAAI,EAAGA,EAAIC,EAAKD,GAAK,EACxBQ,EACGX,GAAUM,EAAI,WAAWH,CAAC,CAAC,GAAK,GAChCH,GAAUM,EAAI,WAAWH,EAAI,CAAC,CAAC,GAAK,GACpCH,GAAUM,EAAI,WAAWH,EAAI,CAAC,CAAC,GAAK,EACrCH,GAAUM,EAAI,WAAWH,EAAI,CAAC,CAAC,EACjCS,EAAIC,GAAS,EAAKF,GAAO,GAAM,IAC/BC,EAAIC,GAAS,EAAKF,GAAO,EAAK,IAC9BC,EAAIC,GAAS,EAAIF,EAAM,IAGzB,OAAIH,IAAoB,IACtBG,EACGX,GAAUM,EAAI,WAAWH,CAAC,CAAC,GAAK,EAChCH,GAAUM,EAAI,WAAWH,EAAI,CAAC,CAAC,GAAK,EACvCS,EAAIC,GAAS,EAAIF,EAAM,KAGrBH,IAAoB,IACtBG,EACGX,GAAUM,EAAI,WAAWH,CAAC,CAAC,GAAK,GAChCH,GAAUM,EAAI,WAAWH,EAAI,CAAC,CAAC,GAAK,EACpCH,GAAUM,EAAI,WAAWH,EAAI,CAAC,CAAC,GAAK,EACvCS,EAAIC,GAAS,EAAKF,GAAO,EAAK,IAC9BC,EAAIC,GAAS,EAAIF,EAAM,KAGlBC,CACT,CAEA,SAASE,GAAiBC,EAAK,CAC7B,OAAOhB,GAAOgB,GAAO,GAAK,EAAI,EAC5BhB,GAAOgB,GAAO,GAAK,EAAI,EACvBhB,GAAOgB,GAAO,EAAI,EAAI,EACtBhB,GAAOgB,EAAM,EAAI,CACrB,CAEA,SAASC,GAAaC,EAAOC,EAAOC,EAAK,CAGvC,QAFIR,EACAS,EAAS,CAAC,EACL,EAAIF,EAAO,EAAIC,EAAK,GAAK,EAChCR,GACIM,EAAM,CAAC,GAAK,GAAM,WAClBA,EAAM,EAAI,CAAC,GAAK,EAAK,QACtBA,EAAM,EAAI,CAAC,EAAI,KAClBG,EAAO,KAAKN,GAAgBH,CAAG,CAAC,EAElC,OAAOS,EAAO,KAAK,EAAE,CACvB,CAEA,SAAStB,GAAemB,EAAO,CAQ7B,QAPIN,EACAP,EAAMa,EAAM,OACZI,EAAajB,EAAM,EACnBkB,EAAQ,CAAC,EACTC,EAAiB,MAGZpB,EAAI,EAAGqB,EAAOpB,EAAMiB,EAAYlB,EAAIqB,EAAMrB,GAAKoB,EACtDD,EAAM,KAAKN,GAAYC,EAAOd,EAAIA,EAAIoB,EAAkBC,EAAOA,EAAQrB,EAAIoB,CAAe,CAAC,EAI7F,OAAIF,IAAe,GACjBV,EAAMM,EAAMb,EAAM,CAAC,EACnBkB,EAAM,KACJvB,GAAOY,GAAO,CAAC,EACfZ,GAAQY,GAAO,EAAK,EAAI,EACxB,IACF,GACSU,IAAe,IACxBV,GAAOM,EAAMb,EAAM,CAAC,GAAK,GAAKa,EAAMb,EAAM,CAAC,EAC3CkB,EAAM,KACJvB,GAAOY,GAAO,EAAE,EAChBZ,GAAQY,GAAO,EAAK,EAAI,EACxBZ,GAAQY,GAAO,EAAK,EAAI,EACxB,GACF,GAGKW,EAAM,KAAK,EAAE,CACtB,ICrJA,IAAAG,GAAAC,GAAAC,IAAA,CACAA,GAAQ,KAAO,SAAUC,EAAQC,EAAQC,EAAMC,EAAMC,EAAQ,CAC3D,IAAIC,EAAGC,EACHC,EAAQH,EAAS,EAAKD,EAAO,EAC7BK,GAAQ,GAAKD,GAAQ,EACrBE,EAAQD,GAAQ,EAChBE,EAAQ,GACRC,EAAIT,EAAQE,EAAS,EAAK,EAC1BQ,EAAIV,EAAO,GAAK,EAChBW,EAAIb,EAAOC,EAASU,CAAC,EAOzB,IALAA,GAAKC,EAELP,EAAIQ,GAAM,GAAM,CAACH,GAAU,EAC3BG,IAAO,CAACH,EACRA,GAASH,EACFG,EAAQ,EAAGL,EAAKA,EAAI,IAAOL,EAAOC,EAASU,CAAC,EAAGA,GAAKC,EAAGF,GAAS,EAAG,CAK1E,IAHAJ,EAAID,GAAM,GAAM,CAACK,GAAU,EAC3BL,IAAO,CAACK,EACRA,GAASP,EACFO,EAAQ,EAAGJ,EAAKA,EAAI,IAAON,EAAOC,EAASU,CAAC,EAAGA,GAAKC,EAAGF,GAAS,EAAG,CAE1E,GAAIL,IAAM,EACRA,EAAI,EAAII,MACH,IAAIJ,IAAMG,EACf,OAAOF,EAAI,KAAQO,EAAI,GAAK,GAAK,MAEjCP,EAAIA,EAAI,KAAK,IAAI,EAAGH,CAAI,EACxBE,EAAIA,EAAII,EAEV,OAAQI,EAAI,GAAK,GAAKP,EAAI,KAAK,IAAI,EAAGD,EAAIF,CAAI,CAChD,EAEAJ,GAAQ,MAAQ,SAAUC,EAAQc,EAAOb,EAAQC,EAAMC,EAAMC,EAAQ,CACnE,IAAIC,EAAGC,EAAGS,EACNR,EAAQH,EAAS,EAAKD,EAAO,EAC7BK,GAAQ,GAAKD,GAAQ,EACrBE,EAAQD,GAAQ,EAChBQ,EAAMb,IAAS,GAAK,KAAK,IAAI,EAAG,GAAG,EAAI,KAAK,IAAI,EAAG,GAAG,EAAI,EAC1DQ,EAAIT,EAAO,EAAKE,EAAS,EACzBQ,EAAIV,EAAO,EAAI,GACfW,EAAIC,EAAQ,GAAMA,IAAU,GAAK,EAAIA,EAAQ,EAAK,EAAI,EAmC1D,IAjCAA,EAAQ,KAAK,IAAIA,CAAK,EAElB,MAAMA,CAAK,GAAKA,IAAU,KAC5BR,EAAI,MAAMQ,CAAK,EAAI,EAAI,EACvBT,EAAIG,IAEJH,EAAI,KAAK,MAAM,KAAK,IAAIS,CAAK,EAAI,KAAK,GAAG,EACrCA,GAASC,EAAI,KAAK,IAAI,EAAG,CAACV,CAAC,GAAK,IAClCA,IACAU,GAAK,GAEHV,EAAII,GAAS,EACfK,GAASE,EAAKD,EAEdD,GAASE,EAAK,KAAK,IAAI,EAAG,EAAIP,CAAK,EAEjCK,EAAQC,GAAK,IACfV,IACAU,GAAK,GAGHV,EAAII,GAASD,GACfF,EAAI,EACJD,EAAIG,GACKH,EAAII,GAAS,GACtBH,GAAMQ,EAAQC,EAAK,GAAK,KAAK,IAAI,EAAGZ,CAAI,EACxCE,EAAIA,EAAII,IAERH,EAAIQ,EAAQ,KAAK,IAAI,EAAGL,EAAQ,CAAC,EAAI,KAAK,IAAI,EAAGN,CAAI,EACrDE,EAAI,IAIDF,GAAQ,EAAGH,EAAOC,EAASU,CAAC,EAAIL,EAAI,IAAMK,GAAKC,EAAGN,GAAK,IAAKH,GAAQ,EAAG,CAI9E,IAFAE,EAAKA,GAAKF,EAAQG,EAClBC,GAAQJ,EACDI,EAAO,EAAGP,EAAOC,EAASU,CAAC,EAAIN,EAAI,IAAMM,GAAKC,EAAGP,GAAK,IAAKE,GAAQ,EAAG,CAE7EP,EAAOC,EAASU,EAAIC,CAAC,GAAKC,EAAI,GAChC,ICpFA,IAAAI,GAAAC,GAAAC,IAAA,cAUA,IAAMC,GAAS,KACTC,GAAU,KACVC,GACH,OAAO,QAAW,YAAc,OAAO,OAAO,KAAW,WACtD,OAAO,IAAO,4BAA4B,EAC1C,KAENH,GAAQ,OAASI,EACjBJ,GAAQ,WAAaK,GACrBL,GAAQ,kBAAoB,GAE5B,IAAMM,GAAe,WACrBN,GAAQ,WAAaM,GAgBrBF,EAAO,oBAAsBG,GAAkB,EAE3C,CAACH,EAAO,qBAAuB,OAAO,QAAY,KAClD,OAAO,QAAQ,OAAU,YAC3B,QAAQ,MACN,+IAEF,EAGF,SAASG,IAAqB,CAE5B,GAAI,CACF,IAAMC,EAAM,IAAI,WAAW,CAAC,EACtBC,EAAQ,CAAE,IAAK,UAAY,CAAE,MAAO,GAAG,CAAE,EAC/C,cAAO,eAAeA,EAAO,WAAW,SAAS,EACjD,OAAO,eAAeD,EAAKC,CAAK,EACzBD,EAAI,IAAI,IAAM,EACvB,MAAY,CACV,MAAO,EACT,CACF,CAEA,OAAO,eAAeJ,EAAO,UAAW,SAAU,CAChD,WAAY,GACZ,IAAK,UAAY,CACf,GAAKA,EAAO,SAAS,IAAI,EACzB,OAAO,KAAK,MACd,CACF,CAAC,EAED,OAAO,eAAeA,EAAO,UAAW,SAAU,CAChD,WAAY,GACZ,IAAK,UAAY,CACf,GAAKA,EAAO,SAAS,IAAI,EACzB,OAAO,KAAK,UACd,CACF,CAAC,EAED,SAASM,GAAcC,EAAQ,CAC7B,GAAIA,EAASL,GACX,MAAM,IAAI,WAAW,cAAgBK,EAAS,gCAAgC,EAGhF,IAAMC,EAAM,IAAI,WAAWD,CAAM,EACjC,cAAO,eAAeC,EAAKR,EAAO,SAAS,EACpCQ,CACT,CAYA,SAASR,EAAQS,EAAKC,EAAkBH,EAAQ,CAE9C,GAAI,OAAOE,GAAQ,SAAU,CAC3B,GAAI,OAAOC,GAAqB,SAC9B,MAAM,IAAI,UACR,oEACF,EAEF,OAAOC,GAAYF,CAAG,CACxB,CACA,OAAOG,GAAKH,EAAKC,EAAkBH,CAAM,CAC3C,CAEAP,EAAO,SAAW,KAElB,SAASY,GAAMC,EAAOH,EAAkBH,EAAQ,CAC9C,GAAI,OAAOM,GAAU,SACnB,OAAOC,GAAWD,EAAOH,CAAgB,EAG3C,GAAI,YAAY,OAAOG,CAAK,EAC1B,OAAOE,GAAcF,CAAK,EAG5B,GAAIA,GAAS,KACX,MAAM,IAAI,UACR,kHAC0C,OAAOA,CACnD,EAQF,GALIG,GAAWH,EAAO,WAAW,GAC5BA,GAASG,GAAWH,EAAM,OAAQ,WAAW,GAI9C,OAAO,kBAAsB,MAC5BG,GAAWH,EAAO,iBAAiB,GACnCA,GAASG,GAAWH,EAAM,OAAQ,iBAAiB,GACtD,OAAOI,GAAgBJ,EAAOH,EAAkBH,CAAM,EAGxD,GAAI,OAAOM,GAAU,SACnB,MAAM,IAAI,UACR,uEACF,EAGF,IAAMK,EAAUL,EAAM,SAAWA,EAAM,QAAQ,EAC/C,GAAIK,GAAW,MAAQA,IAAYL,EACjC,OAAOb,EAAO,KAAKkB,EAASR,EAAkBH,CAAM,EAGtD,IAAMY,EAAIC,GAAWP,CAAK,EAC1B,GAAIM,EAAG,OAAOA,EAEd,GAAI,OAAO,OAAW,KAAe,OAAO,aAAe,MACvD,OAAON,EAAM,OAAO,WAAW,GAAM,WACvC,OAAOb,EAAO,KAAKa,EAAM,OAAO,WAAW,EAAE,QAAQ,EAAGH,EAAkBH,CAAM,EAGlF,MAAM,IAAI,UACR,kHAC0C,OAAOM,CACnD,CACF,CAUAb,EAAO,KAAO,SAAUa,EAAOH,EAAkBH,EAAQ,CACvD,OAAOK,GAAKC,EAAOH,EAAkBH,CAAM,CAC7C,EAIA,OAAO,eAAeP,EAAO,UAAW,WAAW,SAAS,EAC5D,OAAO,eAAeA,EAAQ,UAAU,EAExC,SAASqB,GAAYC,EAAM,CACzB,GAAI,OAAOA,GAAS,SAClB,MAAM,IAAI,UAAU,wCAAwC,EACvD,GAAIA,EAAO,EAChB,MAAM,IAAI,WAAW,cAAgBA,EAAO,gCAAgC,CAEhF,CAEA,SAASC,GAAOD,EAAME,EAAMC,EAAU,CAEpC,OADAJ,GAAWC,CAAI,EACXA,GAAQ,EACHhB,GAAagB,CAAI,EAEtBE,IAAS,OAIJ,OAAOC,GAAa,SACvBnB,GAAagB,CAAI,EAAE,KAAKE,EAAMC,CAAQ,EACtCnB,GAAagB,CAAI,EAAE,KAAKE,CAAI,EAE3BlB,GAAagB,CAAI,CAC1B,CAMAtB,EAAO,MAAQ,SAAUsB,EAAME,EAAMC,EAAU,CAC7C,OAAOF,GAAMD,EAAME,EAAMC,CAAQ,CACnC,EAEA,SAASd,GAAaW,EAAM,CAC1B,OAAAD,GAAWC,CAAI,EACRhB,GAAagB,EAAO,EAAI,EAAII,GAAQJ,CAAI,EAAI,CAAC,CACtD,CAKAtB,EAAO,YAAc,SAAUsB,EAAM,CACnC,OAAOX,GAAYW,CAAI,CACzB,EAIAtB,EAAO,gBAAkB,SAAUsB,EAAM,CACvC,OAAOX,GAAYW,CAAI,CACzB,EAEA,SAASR,GAAYa,EAAQF,EAAU,CAKrC,IAJI,OAAOA,GAAa,UAAYA,IAAa,MAC/CA,EAAW,QAGT,CAACzB,EAAO,WAAWyB,CAAQ,EAC7B,MAAM,IAAI,UAAU,qBAAuBA,CAAQ,EAGrD,IAAMlB,EAASqB,GAAWD,EAAQF,CAAQ,EAAI,EAC1CjB,EAAMF,GAAaC,CAAM,EAEvBsB,EAASrB,EAAI,MAAMmB,EAAQF,CAAQ,EAEzC,OAAII,IAAWtB,IAIbC,EAAMA,EAAI,MAAM,EAAGqB,CAAM,GAGpBrB,CACT,CAEA,SAASsB,GAAeC,EAAO,CAC7B,IAAMxB,EAASwB,EAAM,OAAS,EAAI,EAAIL,GAAQK,EAAM,MAAM,EAAI,EACxDvB,EAAMF,GAAaC,CAAM,EAC/B,QAASyB,EAAI,EAAGA,EAAIzB,EAAQyB,GAAK,EAC/BxB,EAAIwB,CAAC,EAAID,EAAMC,CAAC,EAAI,IAEtB,OAAOxB,CACT,CAEA,SAASO,GAAekB,EAAW,CACjC,GAAIjB,GAAWiB,EAAW,UAAU,EAAG,CACrC,IAAMC,EAAO,IAAI,WAAWD,CAAS,EACrC,OAAOhB,GAAgBiB,EAAK,OAAQA,EAAK,WAAYA,EAAK,UAAU,CACtE,CACA,OAAOJ,GAAcG,CAAS,CAChC,CAEA,SAAShB,GAAiBc,EAAOI,EAAY5B,EAAQ,CACnD,GAAI4B,EAAa,GAAKJ,EAAM,WAAaI,EACvC,MAAM,IAAI,WAAW,sCAAsC,EAG7D,GAAIJ,EAAM,WAAaI,GAAc5B,GAAU,GAC7C,MAAM,IAAI,WAAW,sCAAsC,EAG7D,IAAIC,EACJ,OAAI2B,IAAe,QAAa5B,IAAW,OACzCC,EAAM,IAAI,WAAWuB,CAAK,EACjBxB,IAAW,OACpBC,EAAM,IAAI,WAAWuB,EAAOI,CAAU,EAEtC3B,EAAM,IAAI,WAAWuB,EAAOI,EAAY5B,CAAM,EAIhD,OAAO,eAAeC,EAAKR,EAAO,SAAS,EAEpCQ,CACT,CAEA,SAASY,GAAYgB,EAAK,CACxB,GAAIpC,EAAO,SAASoC,CAAG,EAAG,CACxB,IAAMC,EAAMX,GAAQU,EAAI,MAAM,EAAI,EAC5B5B,EAAMF,GAAa+B,CAAG,EAE5B,OAAI7B,EAAI,SAAW,GAInB4B,EAAI,KAAK5B,EAAK,EAAG,EAAG6B,CAAG,EAChB7B,CACT,CAEA,GAAI4B,EAAI,SAAW,OACjB,OAAI,OAAOA,EAAI,QAAW,UAAYE,GAAYF,EAAI,MAAM,EACnD9B,GAAa,CAAC,EAEhBwB,GAAcM,CAAG,EAG1B,GAAIA,EAAI,OAAS,UAAY,MAAM,QAAQA,EAAI,IAAI,EACjD,OAAON,GAAcM,EAAI,IAAI,CAEjC,CAEA,SAASV,GAASnB,EAAQ,CAGxB,GAAIA,GAAUL,GACZ,MAAM,IAAI,WAAW,0DACaA,GAAa,SAAS,EAAE,EAAI,QAAQ,EAExE,OAAOK,EAAS,CAClB,CAEA,SAASN,GAAYM,EAAQ,CAC3B,MAAI,CAACA,GAAUA,IACbA,EAAS,GAEJP,EAAO,MAAM,CAACO,CAAM,CAC7B,CAEAP,EAAO,SAAW,SAAmBmB,EAAG,CACtC,OAAOA,GAAK,MAAQA,EAAE,YAAc,IAClCA,IAAMnB,EAAO,SACjB,EAEAA,EAAO,QAAU,SAAkBuC,EAAGpB,EAAG,CAGvC,GAFIH,GAAWuB,EAAG,UAAU,IAAGA,EAAIvC,EAAO,KAAKuC,EAAGA,EAAE,OAAQA,EAAE,UAAU,GACpEvB,GAAWG,EAAG,UAAU,IAAGA,EAAInB,EAAO,KAAKmB,EAAGA,EAAE,OAAQA,EAAE,UAAU,GACpE,CAACnB,EAAO,SAASuC,CAAC,GAAK,CAACvC,EAAO,SAASmB,CAAC,EAC3C,MAAM,IAAI,UACR,uEACF,EAGF,GAAIoB,IAAMpB,EAAG,MAAO,GAEpB,IAAIqB,EAAID,EAAE,OACNE,EAAItB,EAAE,OAEV,QAAS,EAAI,EAAGkB,EAAM,KAAK,IAAIG,EAAGC,CAAC,EAAG,EAAIJ,EAAK,EAAE,EAC/C,GAAIE,EAAE,CAAC,IAAMpB,EAAE,CAAC,EAAG,CACjBqB,EAAID,EAAE,CAAC,EACPE,EAAItB,EAAE,CAAC,EACP,KACF,CAGF,OAAIqB,EAAIC,EAAU,GACdA,EAAID,EAAU,EACX,CACT,EAEAxC,EAAO,WAAa,SAAqByB,EAAU,CACjD,OAAQ,OAAOA,CAAQ,EAAE,YAAY,EAAG,CACtC,IAAK,MACL,IAAK,OACL,IAAK,QACL,IAAK,QACL,IAAK,SACL,IAAK,SACL,IAAK,SACL,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,MAAO,GACT,QACE,MAAO,EACX,CACF,EAEAzB,EAAO,OAAS,SAAiB0C,EAAMnC,EAAQ,CAC7C,GAAI,CAAC,MAAM,QAAQmC,CAAI,EACrB,MAAM,IAAI,UAAU,6CAA6C,EAGnE,GAAIA,EAAK,SAAW,EAClB,OAAO1C,EAAO,MAAM,CAAC,EAGvB,IAAIgC,EACJ,GAAIzB,IAAW,OAEb,IADAA,EAAS,EACJyB,EAAI,EAAGA,EAAIU,EAAK,OAAQ,EAAEV,EAC7BzB,GAAUmC,EAAKV,CAAC,EAAE,OAItB,IAAMW,EAAS3C,EAAO,YAAYO,CAAM,EACpCqC,EAAM,EACV,IAAKZ,EAAI,EAAGA,EAAIU,EAAK,OAAQ,EAAEV,EAAG,CAChC,IAAIxB,EAAMkC,EAAKV,CAAC,EAChB,GAAIhB,GAAWR,EAAK,UAAU,EACxBoC,EAAMpC,EAAI,OAASmC,EAAO,QACvB3C,EAAO,SAASQ,CAAG,IAAGA,EAAMR,EAAO,KAAKQ,CAAG,GAChDA,EAAI,KAAKmC,EAAQC,CAAG,GAEpB,WAAW,UAAU,IAAI,KACvBD,EACAnC,EACAoC,CACF,UAEQ5C,EAAO,SAASQ,CAAG,EAG7BA,EAAI,KAAKmC,EAAQC,CAAG,MAFpB,OAAM,IAAI,UAAU,6CAA6C,EAInEA,GAAOpC,EAAI,MACb,CACA,OAAOmC,CACT,EAEA,SAASf,GAAYD,EAAQF,EAAU,CACrC,GAAIzB,EAAO,SAAS2B,CAAM,EACxB,OAAOA,EAAO,OAEhB,GAAI,YAAY,OAAOA,CAAM,GAAKX,GAAWW,EAAQ,WAAW,EAC9D,OAAOA,EAAO,WAEhB,GAAI,OAAOA,GAAW,SACpB,MAAM,IAAI,UACR,2FACmB,OAAOA,CAC5B,EAGF,IAAMU,EAAMV,EAAO,OACbkB,EAAa,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,GAC5D,GAAI,CAACA,GAAaR,IAAQ,EAAG,MAAO,GAGpC,IAAIS,EAAc,GAClB,OACE,OAAQrB,EAAU,CAChB,IAAK,QACL,IAAK,SACL,IAAK,SACH,OAAOY,EACT,IAAK,OACL,IAAK,QACH,OAAOU,GAAYpB,CAAM,EAAE,OAC7B,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAOU,EAAM,EACf,IAAK,MACH,OAAOA,IAAQ,EACjB,IAAK,SACH,OAAOW,GAAcrB,CAAM,EAAE,OAC/B,QACE,GAAImB,EACF,OAAOD,EAAY,GAAKE,GAAYpB,CAAM,EAAE,OAE9CF,GAAY,GAAKA,GAAU,YAAY,EACvCqB,EAAc,EAClB,CAEJ,CACA9C,EAAO,WAAa4B,GAEpB,SAASqB,GAAcxB,EAAUyB,EAAOC,EAAK,CAC3C,IAAIL,EAAc,GA8BlB,IArBII,IAAU,QAAaA,EAAQ,KACjCA,EAAQ,GAINA,EAAQ,KAAK,UAIbC,IAAQ,QAAaA,EAAM,KAAK,UAClCA,EAAM,KAAK,QAGTA,GAAO,KAKXA,KAAS,EACTD,KAAW,EAEPC,GAAOD,GACT,MAAO,GAKT,IAFKzB,IAAUA,EAAW,UAGxB,OAAQA,EAAU,CAChB,IAAK,MACH,OAAO2B,GAAS,KAAMF,EAAOC,CAAG,EAElC,IAAK,OACL,IAAK,QACH,OAAOE,GAAU,KAAMH,EAAOC,CAAG,EAEnC,IAAK,QACH,OAAOG,GAAW,KAAMJ,EAAOC,CAAG,EAEpC,IAAK,SACL,IAAK,SACH,OAAOI,GAAY,KAAML,EAAOC,CAAG,EAErC,IAAK,SACH,OAAOK,GAAY,KAAMN,EAAOC,CAAG,EAErC,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAOM,GAAa,KAAMP,EAAOC,CAAG,EAEtC,QACE,GAAIL,EAAa,MAAM,IAAI,UAAU,qBAAuBrB,CAAQ,EACpEA,GAAYA,EAAW,IAAI,YAAY,EACvCqB,EAAc,EAClB,CAEJ,CAQA9C,EAAO,UAAU,UAAY,GAE7B,SAAS0D,GAAMvC,EAAGwC,EAAGC,EAAG,CACtB,IAAM5B,EAAIb,EAAEwC,CAAC,EACbxC,EAAEwC,CAAC,EAAIxC,EAAEyC,CAAC,EACVzC,EAAEyC,CAAC,EAAI5B,CACT,CAEAhC,EAAO,UAAU,OAAS,UAAmB,CAC3C,IAAMqC,EAAM,KAAK,OACjB,GAAIA,EAAM,IAAM,EACd,MAAM,IAAI,WAAW,2CAA2C,EAElE,QAASL,EAAI,EAAGA,EAAIK,EAAKL,GAAK,EAC5B0B,GAAK,KAAM1B,EAAGA,EAAI,CAAC,EAErB,OAAO,IACT,EAEAhC,EAAO,UAAU,OAAS,UAAmB,CAC3C,IAAMqC,EAAM,KAAK,OACjB,GAAIA,EAAM,IAAM,EACd,MAAM,IAAI,WAAW,2CAA2C,EAElE,QAASL,EAAI,EAAGA,EAAIK,EAAKL,GAAK,EAC5B0B,GAAK,KAAM1B,EAAGA,EAAI,CAAC,EACnB0B,GAAK,KAAM1B,EAAI,EAAGA,EAAI,CAAC,EAEzB,OAAO,IACT,EAEAhC,EAAO,UAAU,OAAS,UAAmB,CAC3C,IAAMqC,EAAM,KAAK,OACjB,GAAIA,EAAM,IAAM,EACd,MAAM,IAAI,WAAW,2CAA2C,EAElE,QAASL,EAAI,EAAGA,EAAIK,EAAKL,GAAK,EAC5B0B,GAAK,KAAM1B,EAAGA,EAAI,CAAC,EACnB0B,GAAK,KAAM1B,EAAI,EAAGA,EAAI,CAAC,EACvB0B,GAAK,KAAM1B,EAAI,EAAGA,EAAI,CAAC,EACvB0B,GAAK,KAAM1B,EAAI,EAAGA,EAAI,CAAC,EAEzB,OAAO,IACT,EAEAhC,EAAO,UAAU,SAAW,UAAqB,CAC/C,IAAMO,EAAS,KAAK,OACpB,OAAIA,IAAW,EAAU,GACrB,UAAU,SAAW,EAAU8C,GAAU,KAAM,EAAG9C,CAAM,EACrD0C,GAAa,MAAM,KAAM,SAAS,CAC3C,EAEAjD,EAAO,UAAU,eAAiBA,EAAO,UAAU,SAEnDA,EAAO,UAAU,OAAS,SAAiBmB,EAAG,CAC5C,GAAI,CAACnB,EAAO,SAASmB,CAAC,EAAG,MAAM,IAAI,UAAU,2BAA2B,EACxE,OAAI,OAASA,EAAU,GAChBnB,EAAO,QAAQ,KAAMmB,CAAC,IAAM,CACrC,EAEAnB,EAAO,UAAU,QAAU,UAAoB,CAC7C,IAAI6D,EAAM,GACJC,EAAMlE,GAAQ,kBACpB,OAAAiE,EAAM,KAAK,SAAS,MAAO,EAAGC,CAAG,EAAE,QAAQ,UAAW,KAAK,EAAE,KAAK,EAC9D,KAAK,OAASA,IAAKD,GAAO,SACvB,WAAaA,EAAM,GAC5B,EACI9D,KACFC,EAAO,UAAUD,EAAmB,EAAIC,EAAO,UAAU,SAG3DA,EAAO,UAAU,QAAU,SAAkB+D,EAAQb,EAAOC,EAAKa,EAAWC,EAAS,CAInF,GAHIjD,GAAW+C,EAAQ,UAAU,IAC/BA,EAAS/D,EAAO,KAAK+D,EAAQA,EAAO,OAAQA,EAAO,UAAU,GAE3D,CAAC/D,EAAO,SAAS+D,CAAM,EACzB,MAAM,IAAI,UACR,iFACoB,OAAOA,CAC7B,EAgBF,GAbIb,IAAU,SACZA,EAAQ,GAENC,IAAQ,SACVA,EAAMY,EAASA,EAAO,OAAS,GAE7BC,IAAc,SAChBA,EAAY,GAEVC,IAAY,SACdA,EAAU,KAAK,QAGbf,EAAQ,GAAKC,EAAMY,EAAO,QAAUC,EAAY,GAAKC,EAAU,KAAK,OACtE,MAAM,IAAI,WAAW,oBAAoB,EAG3C,GAAID,GAAaC,GAAWf,GAASC,EACnC,MAAO,GAET,GAAIa,GAAaC,EACf,MAAO,GAET,GAAIf,GAASC,EACX,MAAO,GAQT,GALAD,KAAW,EACXC,KAAS,EACTa,KAAe,EACfC,KAAa,EAET,OAASF,EAAQ,MAAO,GAE5B,IAAIvB,EAAIyB,EAAUD,EACdvB,EAAIU,EAAMD,EACRb,EAAM,KAAK,IAAIG,EAAGC,CAAC,EAEnByB,EAAW,KAAK,MAAMF,EAAWC,CAAO,EACxCE,EAAaJ,EAAO,MAAMb,EAAOC,CAAG,EAE1C,QAASnB,EAAI,EAAGA,EAAIK,EAAK,EAAEL,EACzB,GAAIkC,EAASlC,CAAC,IAAMmC,EAAWnC,CAAC,EAAG,CACjCQ,EAAI0B,EAASlC,CAAC,EACdS,EAAI0B,EAAWnC,CAAC,EAChB,KACF,CAGF,OAAIQ,EAAIC,EAAU,GACdA,EAAID,EAAU,EACX,CACT,EAWA,SAAS4B,GAAsBzB,EAAQ0B,EAAKlC,EAAYV,EAAU6C,EAAK,CAErE,GAAI3B,EAAO,SAAW,EAAG,MAAO,GAmBhC,GAhBI,OAAOR,GAAe,UACxBV,EAAWU,EACXA,EAAa,GACJA,EAAa,WACtBA,EAAa,WACJA,EAAa,cACtBA,EAAa,aAEfA,EAAa,CAACA,EACVG,GAAYH,CAAU,IAExBA,EAAamC,EAAM,EAAK3B,EAAO,OAAS,GAItCR,EAAa,IAAGA,EAAaQ,EAAO,OAASR,GAC7CA,GAAcQ,EAAO,OAAQ,CAC/B,GAAI2B,EAAK,MAAO,GACXnC,EAAaQ,EAAO,OAAS,CACpC,SAAWR,EAAa,EACtB,GAAImC,EAAKnC,EAAa,MACjB,OAAO,GASd,GALI,OAAOkC,GAAQ,WACjBA,EAAMrE,EAAO,KAAKqE,EAAK5C,CAAQ,GAI7BzB,EAAO,SAASqE,CAAG,EAErB,OAAIA,EAAI,SAAW,EACV,GAEFE,GAAa5B,EAAQ0B,EAAKlC,EAAYV,EAAU6C,CAAG,EACrD,GAAI,OAAOD,GAAQ,SAExB,OADAA,EAAMA,EAAM,IACR,OAAO,WAAW,UAAU,SAAY,WACtCC,EACK,WAAW,UAAU,QAAQ,KAAK3B,EAAQ0B,EAAKlC,CAAU,EAEzD,WAAW,UAAU,YAAY,KAAKQ,EAAQ0B,EAAKlC,CAAU,EAGjEoC,GAAa5B,EAAQ,CAAC0B,CAAG,EAAGlC,EAAYV,EAAU6C,CAAG,EAG9D,MAAM,IAAI,UAAU,sCAAsC,CAC5D,CAEA,SAASC,GAAcnE,EAAKiE,EAAKlC,EAAYV,EAAU6C,EAAK,CAC1D,IAAIE,EAAY,EACZC,EAAYrE,EAAI,OAChBsE,EAAYL,EAAI,OAEpB,GAAI5C,IAAa,SACfA,EAAW,OAAOA,CAAQ,EAAE,YAAY,EACpCA,IAAa,QAAUA,IAAa,SACpCA,IAAa,WAAaA,IAAa,YAAY,CACrD,GAAIrB,EAAI,OAAS,GAAKiE,EAAI,OAAS,EACjC,MAAO,GAETG,EAAY,EACZC,GAAa,EACbC,GAAa,EACbvC,GAAc,CAChB,CAGF,SAASwC,EAAMnE,EAAKwB,EAAG,CACrB,OAAIwC,IAAc,EACThE,EAAIwB,CAAC,EAELxB,EAAI,aAAawB,EAAIwC,CAAS,CAEzC,CAEA,IAAIxC,EACJ,GAAIsC,EAAK,CACP,IAAIM,EAAa,GACjB,IAAK5C,EAAIG,EAAYH,EAAIyC,EAAWzC,IAClC,GAAI2C,EAAKvE,EAAK4B,CAAC,IAAM2C,EAAKN,EAAKO,IAAe,GAAK,EAAI5C,EAAI4C,CAAU,GAEnE,GADIA,IAAe,KAAIA,EAAa5C,GAChCA,EAAI4C,EAAa,IAAMF,EAAW,OAAOE,EAAaJ,OAEtDI,IAAe,KAAI5C,GAAKA,EAAI4C,GAChCA,EAAa,EAGnB,KAEE,KADIzC,EAAauC,EAAYD,IAAWtC,EAAasC,EAAYC,GAC5D1C,EAAIG,EAAYH,GAAK,EAAGA,IAAK,CAChC,IAAI6C,EAAQ,GACZ,QAASC,EAAI,EAAGA,EAAIJ,EAAWI,IAC7B,GAAIH,EAAKvE,EAAK4B,EAAI8C,CAAC,IAAMH,EAAKN,EAAKS,CAAC,EAAG,CACrCD,EAAQ,GACR,KACF,CAEF,GAAIA,EAAO,OAAO7C,CACpB,CAGF,MAAO,EACT,CAEAhC,EAAO,UAAU,SAAW,SAAmBqE,EAAKlC,EAAYV,EAAU,CACxE,OAAO,KAAK,QAAQ4C,EAAKlC,EAAYV,CAAQ,IAAM,EACrD,EAEAzB,EAAO,UAAU,QAAU,SAAkBqE,EAAKlC,EAAYV,EAAU,CACtE,OAAO2C,GAAqB,KAAMC,EAAKlC,EAAYV,EAAU,EAAI,CACnE,EAEAzB,EAAO,UAAU,YAAc,SAAsBqE,EAAKlC,EAAYV,EAAU,CAC9E,OAAO2C,GAAqB,KAAMC,EAAKlC,EAAYV,EAAU,EAAK,CACpE,EAEA,SAASsD,GAAUvE,EAAKmB,EAAQqD,EAAQzE,EAAQ,CAC9CyE,EAAS,OAAOA,CAAM,GAAK,EAC3B,IAAMC,EAAYzE,EAAI,OAASwE,EAC1BzE,GAGHA,EAAS,OAAOA,CAAM,EAClBA,EAAS0E,IACX1E,EAAS0E,IAJX1E,EAAS0E,EAQX,IAAMC,EAASvD,EAAO,OAElBpB,EAAS2E,EAAS,IACpB3E,EAAS2E,EAAS,GAEpB,IAAIlD,EACJ,IAAKA,EAAI,EAAGA,EAAIzB,EAAQ,EAAEyB,EAAG,CAC3B,IAAMmD,EAAS,SAASxD,EAAO,OAAOK,EAAI,EAAG,CAAC,EAAG,EAAE,EACnD,GAAIM,GAAY6C,CAAM,EAAG,OAAOnD,EAChCxB,EAAIwE,EAAShD,CAAC,EAAImD,CACpB,CACA,OAAOnD,CACT,CAEA,SAASoD,GAAW5E,EAAKmB,EAAQqD,EAAQzE,EAAQ,CAC/C,OAAO8E,GAAWtC,GAAYpB,EAAQnB,EAAI,OAASwE,CAAM,EAAGxE,EAAKwE,EAAQzE,CAAM,CACjF,CAEA,SAAS+E,GAAY9E,EAAKmB,EAAQqD,EAAQzE,EAAQ,CAChD,OAAO8E,GAAWE,GAAa5D,CAAM,EAAGnB,EAAKwE,EAAQzE,CAAM,CAC7D,CAEA,SAASiF,GAAahF,EAAKmB,EAAQqD,EAAQzE,EAAQ,CACjD,OAAO8E,GAAWrC,GAAcrB,CAAM,EAAGnB,EAAKwE,EAAQzE,CAAM,CAC9D,CAEA,SAASkF,GAAWjF,EAAKmB,EAAQqD,EAAQzE,EAAQ,CAC/C,OAAO8E,GAAWK,GAAe/D,EAAQnB,EAAI,OAASwE,CAAM,EAAGxE,EAAKwE,EAAQzE,CAAM,CACpF,CAEAP,EAAO,UAAU,MAAQ,SAAgB2B,EAAQqD,EAAQzE,EAAQkB,EAAU,CAEzE,GAAIuD,IAAW,OACbvD,EAAW,OACXlB,EAAS,KAAK,OACdyE,EAAS,UAEAzE,IAAW,QAAa,OAAOyE,GAAW,SACnDvD,EAAWuD,EACXzE,EAAS,KAAK,OACdyE,EAAS,UAEA,SAASA,CAAM,EACxBA,EAASA,IAAW,EAChB,SAASzE,CAAM,GACjBA,EAASA,IAAW,EAChBkB,IAAa,SAAWA,EAAW,UAEvCA,EAAWlB,EACXA,EAAS,YAGX,OAAM,IAAI,MACR,yEACF,EAGF,IAAM0E,EAAY,KAAK,OAASD,EAGhC,IAFIzE,IAAW,QAAaA,EAAS0E,KAAW1E,EAAS0E,GAEpDtD,EAAO,OAAS,IAAMpB,EAAS,GAAKyE,EAAS,IAAOA,EAAS,KAAK,OACrE,MAAM,IAAI,WAAW,wCAAwC,EAG1DvD,IAAUA,EAAW,QAE1B,IAAIqB,EAAc,GAClB,OACE,OAAQrB,EAAU,CAChB,IAAK,MACH,OAAOsD,GAAS,KAAMpD,EAAQqD,EAAQzE,CAAM,EAE9C,IAAK,OACL,IAAK,QACH,OAAO6E,GAAU,KAAMzD,EAAQqD,EAAQzE,CAAM,EAE/C,IAAK,QACL,IAAK,SACL,IAAK,SACH,OAAO+E,GAAW,KAAM3D,EAAQqD,EAAQzE,CAAM,EAEhD,IAAK,SAEH,OAAOiF,GAAY,KAAM7D,EAAQqD,EAAQzE,CAAM,EAEjD,IAAK,OACL,IAAK,QACL,IAAK,UACL,IAAK,WACH,OAAOkF,GAAU,KAAM9D,EAAQqD,EAAQzE,CAAM,EAE/C,QACE,GAAIuC,EAAa,MAAM,IAAI,UAAU,qBAAuBrB,CAAQ,EACpEA,GAAY,GAAKA,GAAU,YAAY,EACvCqB,EAAc,EAClB,CAEJ,EAEA9C,EAAO,UAAU,OAAS,UAAmB,CAC3C,MAAO,CACL,KAAM,SACN,KAAM,MAAM,UAAU,MAAM,KAAK,KAAK,MAAQ,KAAM,CAAC,CACvD,CACF,EAEA,SAASwD,GAAahD,EAAK0C,EAAOC,EAAK,CACrC,OAAID,IAAU,GAAKC,IAAQ3C,EAAI,OACtBX,GAAO,cAAcW,CAAG,EAExBX,GAAO,cAAcW,EAAI,MAAM0C,EAAOC,CAAG,CAAC,CAErD,CAEA,SAASE,GAAW7C,EAAK0C,EAAOC,EAAK,CACnCA,EAAM,KAAK,IAAI3C,EAAI,OAAQ2C,CAAG,EAC9B,IAAMwC,EAAM,CAAC,EAET3D,EAAIkB,EACR,KAAOlB,EAAImB,GAAK,CACd,IAAMyC,EAAYpF,EAAIwB,CAAC,EACnB6D,EAAY,KACZC,EAAoBF,EAAY,IAChC,EACCA,EAAY,IACT,EACCA,EAAY,IACT,EACA,EAEZ,GAAI5D,EAAI8D,GAAoB3C,EAAK,CAC/B,IAAI4C,EAAYC,EAAWC,EAAYC,EAEvC,OAAQJ,EAAkB,CACxB,IAAK,GACCF,EAAY,MACdC,EAAYD,GAEd,MACF,IAAK,GACHG,EAAavF,EAAIwB,EAAI,CAAC,GACjB+D,EAAa,OAAU,MAC1BG,GAAiBN,EAAY,KAAS,EAAOG,EAAa,GACtDG,EAAgB,MAClBL,EAAYK,IAGhB,MACF,IAAK,GACHH,EAAavF,EAAIwB,EAAI,CAAC,EACtBgE,EAAYxF,EAAIwB,EAAI,CAAC,GAChB+D,EAAa,OAAU,MAASC,EAAY,OAAU,MACzDE,GAAiBN,EAAY,KAAQ,IAAOG,EAAa,KAAS,EAAOC,EAAY,GACjFE,EAAgB,OAAUA,EAAgB,OAAUA,EAAgB,SACtEL,EAAYK,IAGhB,MACF,IAAK,GACHH,EAAavF,EAAIwB,EAAI,CAAC,EACtBgE,EAAYxF,EAAIwB,EAAI,CAAC,EACrBiE,EAAazF,EAAIwB,EAAI,CAAC,GACjB+D,EAAa,OAAU,MAASC,EAAY,OAAU,MAASC,EAAa,OAAU,MACzFC,GAAiBN,EAAY,KAAQ,IAAQG,EAAa,KAAS,IAAOC,EAAY,KAAS,EAAOC,EAAa,GAC/GC,EAAgB,OAAUA,EAAgB,UAC5CL,EAAYK,GAGpB,CACF,CAEIL,IAAc,MAGhBA,EAAY,MACZC,EAAmB,GACVD,EAAY,QAErBA,GAAa,MACbF,EAAI,KAAKE,IAAc,GAAK,KAAQ,KAAM,EAC1CA,EAAY,MAASA,EAAY,MAGnCF,EAAI,KAAKE,CAAS,EAClB7D,GAAK8D,CACP,CAEA,OAAOK,GAAsBR,CAAG,CAClC,CAKA,IAAMS,GAAuB,KAE7B,SAASD,GAAuBE,EAAY,CAC1C,IAAMhE,EAAMgE,EAAW,OACvB,GAAIhE,GAAO+D,GACT,OAAO,OAAO,aAAa,MAAM,OAAQC,CAAU,EAIrD,IAAIV,EAAM,GACN3D,EAAI,EACR,KAAOA,EAAIK,GACTsD,GAAO,OAAO,aAAa,MACzB,OACAU,EAAW,MAAMrE,EAAGA,GAAKoE,EAAoB,CAC/C,EAEF,OAAOT,CACT,CAEA,SAASrC,GAAY9C,EAAK0C,EAAOC,EAAK,CACpC,IAAImD,EAAM,GACVnD,EAAM,KAAK,IAAI3C,EAAI,OAAQ2C,CAAG,EAE9B,QAASnB,EAAIkB,EAAOlB,EAAImB,EAAK,EAAEnB,EAC7BsE,GAAO,OAAO,aAAa9F,EAAIwB,CAAC,EAAI,GAAI,EAE1C,OAAOsE,CACT,CAEA,SAAS/C,GAAa/C,EAAK0C,EAAOC,EAAK,CACrC,IAAImD,EAAM,GACVnD,EAAM,KAAK,IAAI3C,EAAI,OAAQ2C,CAAG,EAE9B,QAASnB,EAAIkB,EAAOlB,EAAImB,EAAK,EAAEnB,EAC7BsE,GAAO,OAAO,aAAa9F,EAAIwB,CAAC,CAAC,EAEnC,OAAOsE,CACT,CAEA,SAASlD,GAAU5C,EAAK0C,EAAOC,EAAK,CAClC,IAAMd,EAAM7B,EAAI,QAEZ,CAAC0C,GAASA,EAAQ,KAAGA,EAAQ,IAC7B,CAACC,GAAOA,EAAM,GAAKA,EAAMd,KAAKc,EAAMd,GAExC,IAAIkE,EAAM,GACV,QAAS,EAAIrD,EAAO,EAAIC,EAAK,EAAE,EAC7BoD,GAAOC,GAAoBhG,EAAI,CAAC,CAAC,EAEnC,OAAO+F,CACT,CAEA,SAAS9C,GAAcjD,EAAK0C,EAAOC,EAAK,CACtC,IAAMsD,EAAQjG,EAAI,MAAM0C,EAAOC,CAAG,EAC9BwC,EAAM,GAEV,QAAS,EAAI,EAAG,EAAIc,EAAM,OAAS,EAAG,GAAK,EACzCd,GAAO,OAAO,aAAac,EAAM,CAAC,EAAKA,EAAM,EAAI,CAAC,EAAI,GAAI,EAE5D,OAAOd,CACT,CAEA3F,EAAO,UAAU,MAAQ,SAAgBkD,EAAOC,EAAK,CACnD,IAAMd,EAAM,KAAK,OACjBa,EAAQ,CAAC,CAACA,EACVC,EAAMA,IAAQ,OAAYd,EAAM,CAAC,CAACc,EAE9BD,EAAQ,GACVA,GAASb,EACLa,EAAQ,IAAGA,EAAQ,IACdA,EAAQb,IACjBa,EAAQb,GAGNc,EAAM,GACRA,GAAOd,EACHc,EAAM,IAAGA,EAAM,IACVA,EAAMd,IACfc,EAAMd,GAGJc,EAAMD,IAAOC,EAAMD,GAEvB,IAAMwD,EAAS,KAAK,SAASxD,EAAOC,CAAG,EAEvC,cAAO,eAAeuD,EAAQ1G,EAAO,SAAS,EAEvC0G,CACT,EAKA,SAASC,GAAa3B,EAAQ4B,EAAKrG,EAAQ,CACzC,GAAKyE,EAAS,IAAO,GAAKA,EAAS,EAAG,MAAM,IAAI,WAAW,oBAAoB,EAC/E,GAAIA,EAAS4B,EAAMrG,EAAQ,MAAM,IAAI,WAAW,uCAAuC,CACzF,CAEAP,EAAO,UAAU,WACjBA,EAAO,UAAU,WAAa,SAAqBgF,EAAQpD,EAAYiF,EAAU,CAC/E7B,EAASA,IAAW,EACpBpD,EAAaA,IAAe,EACvBiF,GAAUF,GAAY3B,EAAQpD,EAAY,KAAK,MAAM,EAE1D,IAAIyC,EAAM,KAAKW,CAAM,EACjB8B,EAAM,EACN9E,EAAI,EACR,KAAO,EAAEA,EAAIJ,IAAekF,GAAO,MACjCzC,GAAO,KAAKW,EAAShD,CAAC,EAAI8E,EAG5B,OAAOzC,CACT,EAEArE,EAAO,UAAU,WACjBA,EAAO,UAAU,WAAa,SAAqBgF,EAAQpD,EAAYiF,EAAU,CAC/E7B,EAASA,IAAW,EACpBpD,EAAaA,IAAe,EACvBiF,GACHF,GAAY3B,EAAQpD,EAAY,KAAK,MAAM,EAG7C,IAAIyC,EAAM,KAAKW,EAAS,EAAEpD,CAAU,EAChCkF,EAAM,EACV,KAAOlF,EAAa,IAAMkF,GAAO,MAC/BzC,GAAO,KAAKW,EAAS,EAAEpD,CAAU,EAAIkF,EAGvC,OAAOzC,CACT,EAEArE,EAAO,UAAU,UACjBA,EAAO,UAAU,UAAY,SAAoBgF,EAAQ6B,EAAU,CACjE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAC1C,KAAKA,CAAM,CACpB,EAEAhF,EAAO,UAAU,aACjBA,EAAO,UAAU,aAAe,SAAuBgF,EAAQ6B,EAAU,CACvE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAC1C,KAAKA,CAAM,EAAK,KAAKA,EAAS,CAAC,GAAK,CAC7C,EAEAhF,EAAO,UAAU,aACjBA,EAAO,UAAU,aAAe,SAAuBgF,EAAQ6B,EAAU,CACvE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EACzC,KAAKA,CAAM,GAAK,EAAK,KAAKA,EAAS,CAAC,CAC9C,EAEAhF,EAAO,UAAU,aACjBA,EAAO,UAAU,aAAe,SAAuBgF,EAAQ6B,EAAU,CACvE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,GAExC,KAAKA,CAAM,EACf,KAAKA,EAAS,CAAC,GAAK,EACpB,KAAKA,EAAS,CAAC,GAAK,IACpB,KAAKA,EAAS,CAAC,EAAI,QAC1B,EAEAhF,EAAO,UAAU,aACjBA,EAAO,UAAU,aAAe,SAAuBgF,EAAQ6B,EAAU,CACvE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAEzC,KAAKA,CAAM,EAAI,UACnB,KAAKA,EAAS,CAAC,GAAK,GACrB,KAAKA,EAAS,CAAC,GAAK,EACrB,KAAKA,EAAS,CAAC,EACnB,EAEAhF,EAAO,UAAU,gBAAkB+G,GAAmB,SAA0B/B,EAAQ,CACtFA,EAASA,IAAW,EACpBgC,GAAehC,EAAQ,QAAQ,EAC/B,IAAMiC,EAAQ,KAAKjC,CAAM,EACnBkC,EAAO,KAAKlC,EAAS,CAAC,GACxBiC,IAAU,QAAaC,IAAS,SAClCC,GAAYnC,EAAQ,KAAK,OAAS,CAAC,EAGrC,IAAMoC,EAAKH,EACT,KAAK,EAAEjC,CAAM,EAAI,GAAK,EACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,GACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,GAElBqC,EAAK,KAAK,EAAErC,CAAM,EACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,EACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,GACtBkC,EAAO,GAAK,GAEd,OAAO,OAAOE,CAAE,GAAK,OAAOC,CAAE,GAAK,OAAO,EAAE,EAC9C,CAAC,EAEDrH,EAAO,UAAU,gBAAkB+G,GAAmB,SAA0B/B,EAAQ,CACtFA,EAASA,IAAW,EACpBgC,GAAehC,EAAQ,QAAQ,EAC/B,IAAMiC,EAAQ,KAAKjC,CAAM,EACnBkC,EAAO,KAAKlC,EAAS,CAAC,GACxBiC,IAAU,QAAaC,IAAS,SAClCC,GAAYnC,EAAQ,KAAK,OAAS,CAAC,EAGrC,IAAMqC,EAAKJ,EAAQ,GAAK,GACtB,KAAK,EAAEjC,CAAM,EAAI,GAAK,GACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,EACtB,KAAK,EAAEA,CAAM,EAEToC,EAAK,KAAK,EAAEpC,CAAM,EAAI,GAAK,GAC/B,KAAK,EAAEA,CAAM,EAAI,GAAK,GACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,EACtBkC,EAEF,OAAQ,OAAOG,CAAE,GAAK,OAAO,EAAE,GAAK,OAAOD,CAAE,CAC/C,CAAC,EAEDpH,EAAO,UAAU,UAAY,SAAoBgF,EAAQpD,EAAYiF,EAAU,CAC7E7B,EAASA,IAAW,EACpBpD,EAAaA,IAAe,EACvBiF,GAAUF,GAAY3B,EAAQpD,EAAY,KAAK,MAAM,EAE1D,IAAIyC,EAAM,KAAKW,CAAM,EACjB8B,EAAM,EACN9E,EAAI,EACR,KAAO,EAAEA,EAAIJ,IAAekF,GAAO,MACjCzC,GAAO,KAAKW,EAAShD,CAAC,EAAI8E,EAE5B,OAAAA,GAAO,IAEHzC,GAAOyC,IAAKzC,GAAO,KAAK,IAAI,EAAG,EAAIzC,CAAU,GAE1CyC,CACT,EAEArE,EAAO,UAAU,UAAY,SAAoBgF,EAAQpD,EAAYiF,EAAU,CAC7E7B,EAASA,IAAW,EACpBpD,EAAaA,IAAe,EACvBiF,GAAUF,GAAY3B,EAAQpD,EAAY,KAAK,MAAM,EAE1D,IAAII,EAAIJ,EACJkF,EAAM,EACNzC,EAAM,KAAKW,EAAS,EAAEhD,CAAC,EAC3B,KAAOA,EAAI,IAAM8E,GAAO,MACtBzC,GAAO,KAAKW,EAAS,EAAEhD,CAAC,EAAI8E,EAE9B,OAAAA,GAAO,IAEHzC,GAAOyC,IAAKzC,GAAO,KAAK,IAAI,EAAG,EAAIzC,CAAU,GAE1CyC,CACT,EAEArE,EAAO,UAAU,SAAW,SAAmBgF,EAAQ6B,EAAU,CAG/D,OAFA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAC3C,KAAKA,CAAM,EAAI,KACZ,IAAO,KAAKA,CAAM,EAAI,GAAK,GADA,KAAKA,CAAM,CAEjD,EAEAhF,EAAO,UAAU,YAAc,SAAsBgF,EAAQ6B,EAAU,CACrE7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EACjD,IAAMX,EAAM,KAAKW,CAAM,EAAK,KAAKA,EAAS,CAAC,GAAK,EAChD,OAAQX,EAAM,MAAUA,EAAM,WAAaA,CAC7C,EAEArE,EAAO,UAAU,YAAc,SAAsBgF,EAAQ6B,EAAU,CACrE7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EACjD,IAAMX,EAAM,KAAKW,EAAS,CAAC,EAAK,KAAKA,CAAM,GAAK,EAChD,OAAQX,EAAM,MAAUA,EAAM,WAAaA,CAC7C,EAEArE,EAAO,UAAU,YAAc,SAAsBgF,EAAQ6B,EAAU,CACrE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAEzC,KAAKA,CAAM,EAChB,KAAKA,EAAS,CAAC,GAAK,EACpB,KAAKA,EAAS,CAAC,GAAK,GACpB,KAAKA,EAAS,CAAC,GAAK,EACzB,EAEAhF,EAAO,UAAU,YAAc,SAAsBgF,EAAQ6B,EAAU,CACrE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAEzC,KAAKA,CAAM,GAAK,GACrB,KAAKA,EAAS,CAAC,GAAK,GACpB,KAAKA,EAAS,CAAC,GAAK,EACpB,KAAKA,EAAS,CAAC,CACpB,EAEAhF,EAAO,UAAU,eAAiB+G,GAAmB,SAAyB/B,EAAQ,CACpFA,EAASA,IAAW,EACpBgC,GAAehC,EAAQ,QAAQ,EAC/B,IAAMiC,EAAQ,KAAKjC,CAAM,EACnBkC,EAAO,KAAKlC,EAAS,CAAC,GACxBiC,IAAU,QAAaC,IAAS,SAClCC,GAAYnC,EAAQ,KAAK,OAAS,CAAC,EAGrC,IAAMX,EAAM,KAAKW,EAAS,CAAC,EACzB,KAAKA,EAAS,CAAC,EAAI,GAAK,EACxB,KAAKA,EAAS,CAAC,EAAI,GAAK,IACvBkC,GAAQ,IAEX,OAAQ,OAAO7C,CAAG,GAAK,OAAO,EAAE,GAC9B,OAAO4C,EACP,KAAK,EAAEjC,CAAM,EAAI,GAAK,EACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,GACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,EAAE,CAC5B,CAAC,EAEDhF,EAAO,UAAU,eAAiB+G,GAAmB,SAAyB/B,EAAQ,CACpFA,EAASA,IAAW,EACpBgC,GAAehC,EAAQ,QAAQ,EAC/B,IAAMiC,EAAQ,KAAKjC,CAAM,EACnBkC,EAAO,KAAKlC,EAAS,CAAC,GACxBiC,IAAU,QAAaC,IAAS,SAClCC,GAAYnC,EAAQ,KAAK,OAAS,CAAC,EAGrC,IAAMX,GAAO4C,GAAS,IACpB,KAAK,EAAEjC,CAAM,EAAI,GAAK,GACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,EACtB,KAAK,EAAEA,CAAM,EAEf,OAAQ,OAAOX,CAAG,GAAK,OAAO,EAAE,GAC9B,OAAO,KAAK,EAAEW,CAAM,EAAI,GAAK,GAC7B,KAAK,EAAEA,CAAM,EAAI,GAAK,GACtB,KAAK,EAAEA,CAAM,EAAI,GAAK,EACtBkC,CAAI,CACR,CAAC,EAEDlH,EAAO,UAAU,YAAc,SAAsBgF,EAAQ6B,EAAU,CACrE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAC1ClF,GAAQ,KAAK,KAAMkF,EAAQ,GAAM,GAAI,CAAC,CAC/C,EAEAhF,EAAO,UAAU,YAAc,SAAsBgF,EAAQ6B,EAAU,CACrE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAC1ClF,GAAQ,KAAK,KAAMkF,EAAQ,GAAO,GAAI,CAAC,CAChD,EAEAhF,EAAO,UAAU,aAAe,SAAuBgF,EAAQ6B,EAAU,CACvE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAC1ClF,GAAQ,KAAK,KAAMkF,EAAQ,GAAM,GAAI,CAAC,CAC/C,EAEAhF,EAAO,UAAU,aAAe,SAAuBgF,EAAQ6B,EAAU,CACvE,OAAA7B,EAASA,IAAW,EACf6B,GAAUF,GAAY3B,EAAQ,EAAG,KAAK,MAAM,EAC1ClF,GAAQ,KAAK,KAAMkF,EAAQ,GAAO,GAAI,CAAC,CAChD,EAEA,SAASsC,GAAU9G,EAAKK,EAAOmE,EAAQ4B,EAAK9C,EAAKyD,EAAK,CACpD,GAAI,CAACvH,EAAO,SAASQ,CAAG,EAAG,MAAM,IAAI,UAAU,6CAA6C,EAC5F,GAAIK,EAAQiD,GAAOjD,EAAQ0G,EAAK,MAAM,IAAI,WAAW,mCAAmC,EACxF,GAAIvC,EAAS4B,EAAMpG,EAAI,OAAQ,MAAM,IAAI,WAAW,oBAAoB,CAC1E,CAEAR,EAAO,UAAU,YACjBA,EAAO,UAAU,YAAc,SAAsBa,EAAOmE,EAAQpD,EAAYiF,EAAU,CAIxF,GAHAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACpBpD,EAAaA,IAAe,EACxB,CAACiF,EAAU,CACb,IAAMW,EAAW,KAAK,IAAI,EAAG,EAAI5F,CAAU,EAAI,EAC/C0F,GAAS,KAAMzG,EAAOmE,EAAQpD,EAAY4F,EAAU,CAAC,CACvD,CAEA,IAAIV,EAAM,EACN9E,EAAI,EAER,IADA,KAAKgD,CAAM,EAAInE,EAAQ,IAChB,EAAEmB,EAAIJ,IAAekF,GAAO,MACjC,KAAK9B,EAAShD,CAAC,EAAKnB,EAAQiG,EAAO,IAGrC,OAAO9B,EAASpD,CAClB,EAEA5B,EAAO,UAAU,YACjBA,EAAO,UAAU,YAAc,SAAsBa,EAAOmE,EAAQpD,EAAYiF,EAAU,CAIxF,GAHAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACpBpD,EAAaA,IAAe,EACxB,CAACiF,EAAU,CACb,IAAMW,EAAW,KAAK,IAAI,EAAG,EAAI5F,CAAU,EAAI,EAC/C0F,GAAS,KAAMzG,EAAOmE,EAAQpD,EAAY4F,EAAU,CAAC,CACvD,CAEA,IAAI,EAAI5F,EAAa,EACjBkF,EAAM,EAEV,IADA,KAAK9B,EAAS,CAAC,EAAInE,EAAQ,IACpB,EAAE,GAAK,IAAMiG,GAAO,MACzB,KAAK9B,EAAS,CAAC,EAAKnE,EAAQiG,EAAO,IAGrC,OAAO9B,EAASpD,CAClB,EAEA5B,EAAO,UAAU,WACjBA,EAAO,UAAU,WAAa,SAAqBa,EAAOmE,EAAQ6B,EAAU,CAC1E,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,IAAM,CAAC,EACvD,KAAKA,CAAM,EAAKnE,EAAQ,IACjBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,cACjBA,EAAO,UAAU,cAAgB,SAAwBa,EAAOmE,EAAQ6B,EAAU,CAChF,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,MAAQ,CAAC,EACzD,KAAKA,CAAM,EAAKnE,EAAQ,IACxB,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,EACvBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,cACjBA,EAAO,UAAU,cAAgB,SAAwBa,EAAOmE,EAAQ6B,EAAU,CAChF,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,MAAQ,CAAC,EACzD,KAAKA,CAAM,EAAKnE,IAAU,EAC1B,KAAKmE,EAAS,CAAC,EAAKnE,EAAQ,IACrBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,cACjBA,EAAO,UAAU,cAAgB,SAAwBa,EAAOmE,EAAQ6B,EAAU,CAChF,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,WAAY,CAAC,EAC7D,KAAKA,EAAS,CAAC,EAAKnE,IAAU,GAC9B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,GAC9B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,EAC9B,KAAKmE,CAAM,EAAKnE,EAAQ,IACjBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,cACjBA,EAAO,UAAU,cAAgB,SAAwBa,EAAOmE,EAAQ6B,EAAU,CAChF,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,WAAY,CAAC,EAC7D,KAAKA,CAAM,EAAKnE,IAAU,GAC1B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,GAC9B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,EAC9B,KAAKmE,EAAS,CAAC,EAAKnE,EAAQ,IACrBmE,EAAS,CAClB,EAEA,SAASyC,GAAgBjH,EAAKK,EAAOmE,EAAQuC,EAAKzD,EAAK,CACrD4D,GAAW7G,EAAO0G,EAAKzD,EAAKtD,EAAKwE,EAAQ,CAAC,EAE1C,IAAIoC,EAAK,OAAOvG,EAAQ,OAAO,UAAU,CAAC,EAC1CL,EAAIwE,GAAQ,EAAIoC,EAChBA,EAAKA,GAAM,EACX5G,EAAIwE,GAAQ,EAAIoC,EAChBA,EAAKA,GAAM,EACX5G,EAAIwE,GAAQ,EAAIoC,EAChBA,EAAKA,GAAM,EACX5G,EAAIwE,GAAQ,EAAIoC,EAChB,IAAIC,EAAK,OAAOxG,GAAS,OAAO,EAAE,EAAI,OAAO,UAAU,CAAC,EACxD,OAAAL,EAAIwE,GAAQ,EAAIqC,EAChBA,EAAKA,GAAM,EACX7G,EAAIwE,GAAQ,EAAIqC,EAChBA,EAAKA,GAAM,EACX7G,EAAIwE,GAAQ,EAAIqC,EAChBA,EAAKA,GAAM,EACX7G,EAAIwE,GAAQ,EAAIqC,EACTrC,CACT,CAEA,SAAS2C,GAAgBnH,EAAKK,EAAOmE,EAAQuC,EAAKzD,EAAK,CACrD4D,GAAW7G,EAAO0G,EAAKzD,EAAKtD,EAAKwE,EAAQ,CAAC,EAE1C,IAAIoC,EAAK,OAAOvG,EAAQ,OAAO,UAAU,CAAC,EAC1CL,EAAIwE,EAAS,CAAC,EAAIoC,EAClBA,EAAKA,GAAM,EACX5G,EAAIwE,EAAS,CAAC,EAAIoC,EAClBA,EAAKA,GAAM,EACX5G,EAAIwE,EAAS,CAAC,EAAIoC,EAClBA,EAAKA,GAAM,EACX5G,EAAIwE,EAAS,CAAC,EAAIoC,EAClB,IAAIC,EAAK,OAAOxG,GAAS,OAAO,EAAE,EAAI,OAAO,UAAU,CAAC,EACxD,OAAAL,EAAIwE,EAAS,CAAC,EAAIqC,EAClBA,EAAKA,GAAM,EACX7G,EAAIwE,EAAS,CAAC,EAAIqC,EAClBA,EAAKA,GAAM,EACX7G,EAAIwE,EAAS,CAAC,EAAIqC,EAClBA,EAAKA,GAAM,EACX7G,EAAIwE,CAAM,EAAIqC,EACPrC,EAAS,CAClB,CAEAhF,EAAO,UAAU,iBAAmB+G,GAAmB,SAA2BlG,EAAOmE,EAAS,EAAG,CACnG,OAAOyC,GAAe,KAAM5G,EAAOmE,EAAQ,OAAO,CAAC,EAAG,OAAO,oBAAoB,CAAC,CACpF,CAAC,EAEDhF,EAAO,UAAU,iBAAmB+G,GAAmB,SAA2BlG,EAAOmE,EAAS,EAAG,CACnG,OAAO2C,GAAe,KAAM9G,EAAOmE,EAAQ,OAAO,CAAC,EAAG,OAAO,oBAAoB,CAAC,CACpF,CAAC,EAEDhF,EAAO,UAAU,WAAa,SAAqBa,EAAOmE,EAAQpD,EAAYiF,EAAU,CAGtF,GAFAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EAChB,CAAC6B,EAAU,CACb,IAAMe,EAAQ,KAAK,IAAI,EAAI,EAAIhG,EAAc,CAAC,EAE9C0F,GAAS,KAAMzG,EAAOmE,EAAQpD,EAAYgG,EAAQ,EAAG,CAACA,CAAK,CAC7D,CAEA,IAAI,EAAI,EACJd,EAAM,EACNe,EAAM,EAEV,IADA,KAAK7C,CAAM,EAAInE,EAAQ,IAChB,EAAE,EAAIe,IAAekF,GAAO,MAC7BjG,EAAQ,GAAKgH,IAAQ,GAAK,KAAK7C,EAAS,EAAI,CAAC,IAAM,IACrD6C,EAAM,GAER,KAAK7C,EAAS,CAAC,GAAMnE,EAAQiG,GAAQ,GAAKe,EAAM,IAGlD,OAAO7C,EAASpD,CAClB,EAEA5B,EAAO,UAAU,WAAa,SAAqBa,EAAOmE,EAAQpD,EAAYiF,EAAU,CAGtF,GAFAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EAChB,CAAC6B,EAAU,CACb,IAAMe,EAAQ,KAAK,IAAI,EAAI,EAAIhG,EAAc,CAAC,EAE9C0F,GAAS,KAAMzG,EAAOmE,EAAQpD,EAAYgG,EAAQ,EAAG,CAACA,CAAK,CAC7D,CAEA,IAAI,EAAIhG,EAAa,EACjBkF,EAAM,EACNe,EAAM,EAEV,IADA,KAAK7C,EAAS,CAAC,EAAInE,EAAQ,IACpB,EAAE,GAAK,IAAMiG,GAAO,MACrBjG,EAAQ,GAAKgH,IAAQ,GAAK,KAAK7C,EAAS,EAAI,CAAC,IAAM,IACrD6C,EAAM,GAER,KAAK7C,EAAS,CAAC,GAAMnE,EAAQiG,GAAQ,GAAKe,EAAM,IAGlD,OAAO7C,EAASpD,CAClB,EAEA5B,EAAO,UAAU,UAAY,SAAoBa,EAAOmE,EAAQ6B,EAAU,CACxE,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,IAAM,IAAK,EACvDnE,EAAQ,IAAGA,EAAQ,IAAOA,EAAQ,GACtC,KAAKmE,CAAM,EAAKnE,EAAQ,IACjBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,aAAe,SAAuBa,EAAOmE,EAAQ6B,EAAU,CAC9E,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,MAAQ,MAAO,EAC/D,KAAKA,CAAM,EAAKnE,EAAQ,IACxB,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,EACvBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,aAAe,SAAuBa,EAAOmE,EAAQ6B,EAAU,CAC9E,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,MAAQ,MAAO,EAC/D,KAAKA,CAAM,EAAKnE,IAAU,EAC1B,KAAKmE,EAAS,CAAC,EAAKnE,EAAQ,IACrBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,aAAe,SAAuBa,EAAOmE,EAAQ6B,EAAU,CAC9E,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,WAAY,WAAW,EACvE,KAAKA,CAAM,EAAKnE,EAAQ,IACxB,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,EAC9B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,GAC9B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,GACvBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,aAAe,SAAuBa,EAAOmE,EAAQ6B,EAAU,CAC9E,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GAAUS,GAAS,KAAMzG,EAAOmE,EAAQ,EAAG,WAAY,WAAW,EACnEnE,EAAQ,IAAGA,EAAQ,WAAaA,EAAQ,GAC5C,KAAKmE,CAAM,EAAKnE,IAAU,GAC1B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,GAC9B,KAAKmE,EAAS,CAAC,EAAKnE,IAAU,EAC9B,KAAKmE,EAAS,CAAC,EAAKnE,EAAQ,IACrBmE,EAAS,CAClB,EAEAhF,EAAO,UAAU,gBAAkB+G,GAAmB,SAA0BlG,EAAOmE,EAAS,EAAG,CACjG,OAAOyC,GAAe,KAAM5G,EAAOmE,EAAQ,CAAC,OAAO,oBAAoB,EAAG,OAAO,oBAAoB,CAAC,CACxG,CAAC,EAEDhF,EAAO,UAAU,gBAAkB+G,GAAmB,SAA0BlG,EAAOmE,EAAS,EAAG,CACjG,OAAO2C,GAAe,KAAM9G,EAAOmE,EAAQ,CAAC,OAAO,oBAAoB,EAAG,OAAO,oBAAoB,CAAC,CACxG,CAAC,EAED,SAAS8C,GAActH,EAAKK,EAAOmE,EAAQ4B,EAAK9C,EAAKyD,EAAK,CACxD,GAAIvC,EAAS4B,EAAMpG,EAAI,OAAQ,MAAM,IAAI,WAAW,oBAAoB,EACxE,GAAIwE,EAAS,EAAG,MAAM,IAAI,WAAW,oBAAoB,CAC3D,CAEA,SAAS+C,GAAYvH,EAAKK,EAAOmE,EAAQgD,EAAcnB,EAAU,CAC/D,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GACHiB,GAAatH,EAAKK,EAAOmE,EAAQ,EAAG,qBAAwB,qBAAuB,EAErFlF,GAAQ,MAAMU,EAAKK,EAAOmE,EAAQgD,EAAc,GAAI,CAAC,EAC9ChD,EAAS,CAClB,CAEAhF,EAAO,UAAU,aAAe,SAAuBa,EAAOmE,EAAQ6B,EAAU,CAC9E,OAAOkB,GAAW,KAAMlH,EAAOmE,EAAQ,GAAM6B,CAAQ,CACvD,EAEA7G,EAAO,UAAU,aAAe,SAAuBa,EAAOmE,EAAQ6B,EAAU,CAC9E,OAAOkB,GAAW,KAAMlH,EAAOmE,EAAQ,GAAO6B,CAAQ,CACxD,EAEA,SAASoB,GAAazH,EAAKK,EAAOmE,EAAQgD,EAAcnB,EAAU,CAChE,OAAAhG,EAAQ,CAACA,EACTmE,EAASA,IAAW,EACf6B,GACHiB,GAAatH,EAAKK,EAAOmE,EAAQ,EAAG,sBAAyB,sBAAwB,EAEvFlF,GAAQ,MAAMU,EAAKK,EAAOmE,EAAQgD,EAAc,GAAI,CAAC,EAC9ChD,EAAS,CAClB,CAEAhF,EAAO,UAAU,cAAgB,SAAwBa,EAAOmE,EAAQ6B,EAAU,CAChF,OAAOoB,GAAY,KAAMpH,EAAOmE,EAAQ,GAAM6B,CAAQ,CACxD,EAEA7G,EAAO,UAAU,cAAgB,SAAwBa,EAAOmE,EAAQ6B,EAAU,CAChF,OAAOoB,GAAY,KAAMpH,EAAOmE,EAAQ,GAAO6B,CAAQ,CACzD,EAGA7G,EAAO,UAAU,KAAO,SAAe+D,EAAQmE,EAAahF,EAAOC,EAAK,CACtE,GAAI,CAACnD,EAAO,SAAS+D,CAAM,EAAG,MAAM,IAAI,UAAU,6BAA6B,EAS/E,GARKb,IAAOA,EAAQ,GAChB,CAACC,GAAOA,IAAQ,IAAGA,EAAM,KAAK,QAC9B+E,GAAenE,EAAO,SAAQmE,EAAcnE,EAAO,QAClDmE,IAAaA,EAAc,GAC5B/E,EAAM,GAAKA,EAAMD,IAAOC,EAAMD,GAG9BC,IAAQD,GACRa,EAAO,SAAW,GAAK,KAAK,SAAW,EAAG,MAAO,GAGrD,GAAImE,EAAc,EAChB,MAAM,IAAI,WAAW,2BAA2B,EAElD,GAAIhF,EAAQ,GAAKA,GAAS,KAAK,OAAQ,MAAM,IAAI,WAAW,oBAAoB,EAChF,GAAIC,EAAM,EAAG,MAAM,IAAI,WAAW,yBAAyB,EAGvDA,EAAM,KAAK,SAAQA,EAAM,KAAK,QAC9BY,EAAO,OAASmE,EAAc/E,EAAMD,IACtCC,EAAMY,EAAO,OAASmE,EAAchF,GAGtC,IAAMb,EAAMc,EAAMD,EAElB,OAAI,OAASa,GAAU,OAAO,WAAW,UAAU,YAAe,WAEhE,KAAK,WAAWmE,EAAahF,EAAOC,CAAG,EAEvC,WAAW,UAAU,IAAI,KACvBY,EACA,KAAK,SAASb,EAAOC,CAAG,EACxB+E,CACF,EAGK7F,CACT,EAMArC,EAAO,UAAU,KAAO,SAAeqE,EAAKnB,EAAOC,EAAK1B,EAAU,CAEhE,GAAI,OAAO4C,GAAQ,SAAU,CAS3B,GARI,OAAOnB,GAAU,UACnBzB,EAAWyB,EACXA,EAAQ,EACRC,EAAM,KAAK,QACF,OAAOA,GAAQ,WACxB1B,EAAW0B,EACXA,EAAM,KAAK,QAET1B,IAAa,QAAa,OAAOA,GAAa,SAChD,MAAM,IAAI,UAAU,2BAA2B,EAEjD,GAAI,OAAOA,GAAa,UAAY,CAACzB,EAAO,WAAWyB,CAAQ,EAC7D,MAAM,IAAI,UAAU,qBAAuBA,CAAQ,EAErD,GAAI4C,EAAI,SAAW,EAAG,CACpB,IAAM8D,EAAO9D,EAAI,WAAW,CAAC,GACxB5C,IAAa,QAAU0G,EAAO,KAC/B1G,IAAa,YAEf4C,EAAM8D,EAEV,CACF,MAAW,OAAO9D,GAAQ,SACxBA,EAAMA,EAAM,IACH,OAAOA,GAAQ,YACxBA,EAAM,OAAOA,CAAG,GAIlB,GAAInB,EAAQ,GAAK,KAAK,OAASA,GAAS,KAAK,OAASC,EACpD,MAAM,IAAI,WAAW,oBAAoB,EAG3C,GAAIA,GAAOD,EACT,OAAO,KAGTA,EAAQA,IAAU,EAClBC,EAAMA,IAAQ,OAAY,KAAK,OAASA,IAAQ,EAE3CkB,IAAKA,EAAM,GAEhB,IAAI,EACJ,GAAI,OAAOA,GAAQ,SACjB,IAAK,EAAInB,EAAO,EAAIC,EAAK,EAAE,EACzB,KAAK,CAAC,EAAIkB,MAEP,CACL,IAAMoC,EAAQzG,EAAO,SAASqE,CAAG,EAC7BA,EACArE,EAAO,KAAKqE,EAAK5C,CAAQ,EACvBY,EAAMoE,EAAM,OAClB,GAAIpE,IAAQ,EACV,MAAM,IAAI,UAAU,cAAgBgC,EAClC,mCAAmC,EAEvC,IAAK,EAAI,EAAG,EAAIlB,EAAMD,EAAO,EAAE,EAC7B,KAAK,EAAIA,CAAK,EAAIuD,EAAM,EAAIpE,CAAG,CAEnC,CAEA,OAAO,IACT,EAMA,IAAM+F,GAAS,CAAC,EAChB,SAASC,GAAGC,EAAKC,EAAYC,EAAM,CACjCJ,GAAOE,CAAG,EAAI,cAAwBE,CAAK,CACzC,aAAe,CACb,MAAM,EAEN,OAAO,eAAe,KAAM,UAAW,CACrC,MAAOD,EAAW,MAAM,KAAM,SAAS,EACvC,SAAU,GACV,aAAc,EAChB,CAAC,EAGD,KAAK,KAAO,GAAG,KAAK,IAAI,KAAKD,CAAG,IAGhC,KAAK,MAEL,OAAO,KAAK,IACd,CAEA,IAAI,MAAQ,CACV,OAAOA,CACT,CAEA,IAAI,KAAMzH,EAAO,CACf,OAAO,eAAe,KAAM,OAAQ,CAClC,aAAc,GACd,WAAY,GACZ,MAAAA,EACA,SAAU,EACZ,CAAC,CACH,CAEA,UAAY,CACV,MAAO,GAAG,KAAK,IAAI,KAAKyH,CAAG,MAAM,KAAK,OAAO,EAC/C,CACF,CACF,CAEAD,GAAE,2BACA,SAAUI,EAAM,CACd,OAAIA,EACK,GAAGA,CAAI,+BAGT,gDACT,EAAG,UAAU,EACfJ,GAAE,uBACA,SAAUI,EAAM5G,EAAQ,CACtB,MAAO,QAAQ4G,CAAI,oDAAoD,OAAO5G,CAAM,EACtF,EAAG,SAAS,EACdwG,GAAE,mBACA,SAAUxE,EAAK6E,EAAOC,EAAO,CAC3B,IAAIC,EAAM,iBAAiB/E,CAAG,qBAC1BgF,EAAWF,EACf,OAAI,OAAO,UAAUA,CAAK,GAAK,KAAK,IAAIA,CAAK,EAAI,GAAK,GACpDE,EAAWC,GAAsB,OAAOH,CAAK,CAAC,EACrC,OAAOA,GAAU,WAC1BE,EAAW,OAAOF,CAAK,GACnBA,EAAQ,OAAO,CAAC,GAAK,OAAO,EAAE,GAAKA,EAAQ,EAAE,OAAO,CAAC,GAAK,OAAO,EAAE,MACrEE,EAAWC,GAAsBD,CAAQ,GAE3CA,GAAY,KAEdD,GAAO,eAAeF,CAAK,cAAcG,CAAQ,GAC1CD,CACT,EAAG,UAAU,EAEf,SAASE,GAAuBzE,EAAK,CACnC,IAAIsB,EAAM,GACN3D,EAAIqC,EAAI,OACNnB,EAAQmB,EAAI,CAAC,IAAM,IAAM,EAAI,EACnC,KAAOrC,GAAKkB,EAAQ,EAAGlB,GAAK,EAC1B2D,EAAM,IAAItB,EAAI,MAAMrC,EAAI,EAAGA,CAAC,CAAC,GAAG2D,CAAG,GAErC,MAAO,GAAGtB,EAAI,MAAM,EAAGrC,CAAC,CAAC,GAAG2D,CAAG,EACjC,CAKA,SAASoD,GAAavI,EAAKwE,EAAQpD,EAAY,CAC7CoF,GAAehC,EAAQ,QAAQ,GAC3BxE,EAAIwE,CAAM,IAAM,QAAaxE,EAAIwE,EAASpD,CAAU,IAAM,SAC5DuF,GAAYnC,EAAQxE,EAAI,QAAUoB,EAAa,EAAE,CAErD,CAEA,SAAS8F,GAAY7G,EAAO0G,EAAKzD,EAAKtD,EAAKwE,EAAQpD,EAAY,CAC7D,GAAIf,EAAQiD,GAAOjD,EAAQ0G,EAAK,CAC9B,IAAM5D,EAAI,OAAO4D,GAAQ,SAAW,IAAM,GACtCmB,EACJ,MAAI9G,EAAa,EACX2F,IAAQ,GAAKA,IAAQ,OAAO,CAAC,EAC/BmB,EAAQ,OAAO/E,CAAC,WAAWA,CAAC,QAAQ/B,EAAa,GAAK,CAAC,GAAG+B,CAAC,GAE3D+E,EAAQ,SAAS/E,CAAC,QAAQ/B,EAAa,GAAK,EAAI,CAAC,GAAG+B,CAAC,iBACzC/B,EAAa,GAAK,EAAI,CAAC,GAAG+B,CAAC,GAGzC+E,EAAQ,MAAMnB,CAAG,GAAG5D,CAAC,WAAWG,CAAG,GAAGH,CAAC,GAEnC,IAAIyE,GAAO,iBAAiB,QAASM,EAAO7H,CAAK,CACzD,CACAkI,GAAYvI,EAAKwE,EAAQpD,CAAU,CACrC,CAEA,SAASoF,GAAgBnG,EAAO4H,EAAM,CACpC,GAAI,OAAO5H,GAAU,SACnB,MAAM,IAAIuH,GAAO,qBAAqBK,EAAM,SAAU5H,CAAK,CAE/D,CAEA,SAASsG,GAAatG,EAAON,EAAQyI,EAAM,CACzC,MAAI,KAAK,MAAMnI,CAAK,IAAMA,GACxBmG,GAAenG,EAAOmI,CAAI,EACpB,IAAIZ,GAAO,iBAAiBY,GAAQ,SAAU,aAAcnI,CAAK,GAGrEN,EAAS,EACL,IAAI6H,GAAO,yBAGb,IAAIA,GAAO,iBAAiBY,GAAQ,SACR,MAAMA,EAAO,EAAI,CAAC,WAAWzI,CAAM,GACnCM,CAAK,CACzC,CAKA,IAAMoI,GAAoB,oBAE1B,SAASC,GAAarF,EAAK,CAMzB,GAJAA,EAAMA,EAAI,MAAM,GAAG,EAAE,CAAC,EAEtBA,EAAMA,EAAI,KAAK,EAAE,QAAQoF,GAAmB,EAAE,EAE1CpF,EAAI,OAAS,EAAG,MAAO,GAE3B,KAAOA,EAAI,OAAS,IAAM,GACxBA,EAAMA,EAAM,IAEd,OAAOA,CACT,CAEA,SAASd,GAAapB,EAAQwH,EAAO,CACnCA,EAAQA,GAAS,IACjB,IAAItD,EACEtF,EAASoB,EAAO,OAClByH,EAAgB,KACd3C,EAAQ,CAAC,EAEf,QAASzE,EAAI,EAAGA,EAAIzB,EAAQ,EAAEyB,EAAG,CAI/B,GAHA6D,EAAYlE,EAAO,WAAWK,CAAC,EAG3B6D,EAAY,OAAUA,EAAY,MAAQ,CAE5C,GAAI,CAACuD,EAAe,CAElB,GAAIvD,EAAY,MAAQ,EAEjBsD,GAAS,GAAK,IAAI1C,EAAM,KAAK,IAAM,IAAM,GAAI,EAClD,QACF,SAAWzE,EAAI,IAAMzB,EAAQ,EAEtB4I,GAAS,GAAK,IAAI1C,EAAM,KAAK,IAAM,IAAM,GAAI,EAClD,QACF,CAGA2C,EAAgBvD,EAEhB,QACF,CAGA,GAAIA,EAAY,MAAQ,EACjBsD,GAAS,GAAK,IAAI1C,EAAM,KAAK,IAAM,IAAM,GAAI,EAClD2C,EAAgBvD,EAChB,QACF,CAGAA,GAAauD,EAAgB,OAAU,GAAKvD,EAAY,OAAU,KACpE,MAAWuD,IAEJD,GAAS,GAAK,IAAI1C,EAAM,KAAK,IAAM,IAAM,GAAI,EAMpD,GAHA2C,EAAgB,KAGZvD,EAAY,IAAM,CACpB,IAAKsD,GAAS,GAAK,EAAG,MACtB1C,EAAM,KAAKZ,CAAS,CACtB,SAAWA,EAAY,KAAO,CAC5B,IAAKsD,GAAS,GAAK,EAAG,MACtB1C,EAAM,KACJZ,GAAa,EAAM,IACnBA,EAAY,GAAO,GACrB,CACF,SAAWA,EAAY,MAAS,CAC9B,IAAKsD,GAAS,GAAK,EAAG,MACtB1C,EAAM,KACJZ,GAAa,GAAM,IACnBA,GAAa,EAAM,GAAO,IAC1BA,EAAY,GAAO,GACrB,CACF,SAAWA,EAAY,QAAU,CAC/B,IAAKsD,GAAS,GAAK,EAAG,MACtB1C,EAAM,KACJZ,GAAa,GAAO,IACpBA,GAAa,GAAM,GAAO,IAC1BA,GAAa,EAAM,GAAO,IAC1BA,EAAY,GAAO,GACrB,CACF,KACE,OAAM,IAAI,MAAM,oBAAoB,CAExC,CAEA,OAAOY,CACT,CAEA,SAASlB,GAAc1B,EAAK,CAC1B,IAAMwF,EAAY,CAAC,EACnB,QAASrH,EAAI,EAAGA,EAAI6B,EAAI,OAAQ,EAAE7B,EAEhCqH,EAAU,KAAKxF,EAAI,WAAW7B,CAAC,EAAI,GAAI,EAEzC,OAAOqH,CACT,CAEA,SAAS3D,GAAgB7B,EAAKsF,EAAO,CACnC,IAAIG,EAAGjC,EAAID,EACLiC,EAAY,CAAC,EACnB,QAASrH,EAAI,EAAGA,EAAI6B,EAAI,QACjB,GAAAsF,GAAS,GAAK,GADW,EAAEnH,EAGhCsH,EAAIzF,EAAI,WAAW7B,CAAC,EACpBqF,EAAKiC,GAAK,EACVlC,EAAKkC,EAAI,IACTD,EAAU,KAAKjC,CAAE,EACjBiC,EAAU,KAAKhC,CAAE,EAGnB,OAAOgC,CACT,CAEA,SAASrG,GAAea,EAAK,CAC3B,OAAOhE,GAAO,YAAYqJ,GAAYrF,CAAG,CAAC,CAC5C,CAEA,SAASwB,GAAYkE,EAAKC,EAAKxE,EAAQzE,EAAQ,CAC7C,IAAIyB,EACJ,IAAKA,EAAI,EAAGA,EAAIzB,GACT,EAAAyB,EAAIgD,GAAUwE,EAAI,QAAYxH,GAAKuH,EAAI,QADtB,EAAEvH,EAExBwH,EAAIxH,EAAIgD,CAAM,EAAIuE,EAAIvH,CAAC,EAEzB,OAAOA,CACT,CAKA,SAAShB,GAAYoB,EAAK4G,EAAM,CAC9B,OAAO5G,aAAe4G,GACnB5G,GAAO,MAAQA,EAAI,aAAe,MAAQA,EAAI,YAAY,MAAQ,MACjEA,EAAI,YAAY,OAAS4G,EAAK,IACpC,CACA,SAAS1G,GAAaF,EAAK,CAEzB,OAAOA,IAAQA,CACjB,CAIA,IAAMoE,GAAuB,UAAY,CACvC,IAAMiD,EAAW,mBACXC,EAAQ,IAAI,MAAM,GAAG,EAC3B,QAAS1H,EAAI,EAAGA,EAAI,GAAI,EAAEA,EAAG,CAC3B,IAAM2H,EAAM3H,EAAI,GAChB,QAAS8C,EAAI,EAAGA,EAAI,GAAI,EAAEA,EACxB4E,EAAMC,EAAM7E,CAAC,EAAI2E,EAASzH,CAAC,EAAIyH,EAAS3E,CAAC,CAE7C,CACA,OAAO4E,CACT,EAAG,EAGH,SAAS3C,GAAoB6C,EAAI,CAC/B,OAAO,OAAO,OAAW,IAAcC,GAAyBD,CAClE,CAEA,SAASC,IAA0B,CACjC,MAAM,IAAI,MAAM,sBAAsB,CACxC,ICzjEA,IAAAC,GAAAC,GAAA,CAAAC,GAAAC,KAAA,CA2CA,SAASC,GAAOC,EAAUC,EAAMC,EAAMC,EAAGC,EAAOC,EAAeC,EAAUC,EAAU,CACjF,aAEA,SAASC,EAAOC,EAAG,CACH,IAAIC,EAAI,CACpB,WAAY,WAAY,WAAY,WAAY,UAChD,WAAY,WAAY,WAAY,WAAY,UAChD,UAAY,WAAY,WAAY,WAAY,WAChD,WAAY,WAAY,WAAY,UAAY,UAChD,UAAY,WAAY,WAAY,WAAY,WAChD,WAAY,WAAY,WAAY,WAAY,WAChD,UAAY,UAAY,UAAY,UAAY,WAChD,WAAY,WAAY,WAAY,WAAY,WAChD,WAAY,WAAY,WAAY,WAAY,WAChD,WAAY,WAAY,UAAY,UAAY,UAChD,UAAY,UAAY,UAAY,WAAY,WAChD,WAAY,WAAY,WAAY,WAAY,WAChD,WAAY,WAAY,WAAY,UACtC,EAEIC,EAAK,WAAYC,EAAK,WAAYC,GAAK,WAAYC,GAAK,WACxDC,GAAK,WAAYC,GAAK,WAAYC,GAAK,UAAYC,GAAK,WACxDC,GAAI,IAAI,MAAM,EAAE,EAEpB,SAASC,GAAOC,GAAG,CAEjB,QADIC,GAAM,EAAGC,EAAMF,GAAE,OACdE,GAAO,IAAI,CAChB,IAAIC,GAAIb,EAAIc,GAAIb,EAAIc,GAAIb,GAAIc,GAAIb,GAAIc,GAAIb,GAAIc,GAAIb,GAAIc,GAAIb,GAAIc,GAAIb,GAC5Dc,GAAGC,GAAGC,GAAGC,GAAIC,GAEjB,IAAKH,GAAI,EAAGA,GAAI,GAAIA,KAClBC,GAAIZ,GAAMW,GAAE,EACZd,GAAEc,EAAC,GAAMZ,GAAEa,EAAC,EAAI,MAAO,IAAQb,GAAEa,GAAE,CAAC,EAAI,MAAO,IACtCb,GAAEa,GAAE,CAAC,EAAI,MAAO,EAAMb,GAAEa,GAAE,CAAC,EAAI,IAG1C,IAAKD,GAAI,GAAIA,GAAI,GAAIA,KACnBD,GAAIb,GAAEc,GAAE,CAAC,EACTE,IAAOH,KAAI,GAAOA,IAAI,KAAaA,KAAI,GAAOA,IAAI,IAAYA,KAAI,GAElEA,GAAIb,GAAEc,GAAE,EAAE,EACVG,IAAOJ,KAAI,EAAMA,IAAI,KAAYA,KAAI,GAAOA,IAAI,IAAYA,KAAI,EAEhEb,GAAEc,EAAC,GAAOE,GAAKhB,GAAEc,GAAE,CAAC,EAAK,IAAOG,GAAKjB,GAAEc,GAAE,EAAE,EAAK,GAAM,EAGxD,IAAKA,GAAI,EAAGA,GAAI,GAAIA,KAClBE,MAAWP,KAAI,EAAMA,IAAI,KAAYA,KAAI,GAAOA,IAAI,KAC7CA,KAAI,GAAOA,IAAI,KAAcA,GAAIC,GAAM,CAACD,GAAIE,IAAO,IACnDC,IAAMrB,EAAEuB,EAAC,EAAId,GAAEc,EAAC,EAAK,GAAM,GAAM,EAExCG,KAASZ,KAAI,EAAMA,IAAI,KAAYA,KAAI,GAAOA,IAAI,KAC3CA,KAAI,GAAOA,IAAI,MAAcA,GAAIC,GAAMD,GAAIE,GAAMD,GAAIC,IAAO,EAEnEK,GAAID,GACJA,GAAID,GACJA,GAAID,GACJA,GAAKD,GAAIQ,GAAM,EACfR,GAAID,GACJA,GAAID,GACJA,GAAID,GACJA,GAAKW,GAAKC,GAAM,EAGlBzB,EAAMA,EAAKa,GAAK,EAChBZ,EAAMA,EAAKa,GAAK,EAChBZ,GAAMA,GAAKa,GAAK,EAChBZ,GAAMA,GAAKa,GAAK,EAChBZ,GAAMA,GAAKa,GAAK,EAChBZ,GAAMA,GAAKa,GAAK,EAChBZ,GAAMA,GAAKa,GAAK,EAChBZ,GAAMA,GAAKa,GAAK,EAEhBT,IAAO,GACPC,GAAO,EACT,CACF,CAEAH,GAAOX,CAAC,EAER,IAAIwB,GAAGI,GAAY5B,EAAE,OAAS,GAC1B6B,GAAY7B,EAAE,OAAS,UAAc,EACrC8B,GAAW9B,EAAE,QAAU,EACvB+B,GAAYH,GAAY,GAAM,GAAK,IACnChB,GAAIZ,EAAE,MAAMA,EAAE,OAAS4B,GAAW5B,EAAE,MAAM,EAG9C,IADAY,GAAE,KAAK,GAAI,EACNY,GAAII,GAAY,EAAGJ,GAAIO,GAAUP,KAAKZ,GAAE,KAAK,CAAC,EACnD,OAAAA,GAAE,KAAMiB,KAAW,GAAM,GAAI,EAC7BjB,GAAE,KAAMiB,KAAW,GAAM,GAAI,EAC7BjB,GAAE,KAAMiB,KAAW,EAAM,GAAI,EAC7BjB,GAAE,KAAMiB,KAAW,EAAM,GAAI,EAC7BjB,GAAE,KAAMkB,KAAW,GAAM,GAAI,EAC7BlB,GAAE,KAAMkB,KAAW,GAAM,GAAI,EAC7BlB,GAAE,KAAMkB,KAAW,EAAM,GAAI,EAC7BlB,GAAE,KAAMkB,KAAW,EAAM,GAAI,EAE7BnB,GAAOC,EAAC,EAED,CACJV,IAAK,GAAM,IAAOA,IAAK,GAAM,IAAOA,IAAK,EAAK,IAAOA,IAAK,EAAK,IAC/DC,IAAK,GAAM,IAAOA,IAAK,GAAM,IAAOA,IAAK,EAAK,IAAOA,IAAK,EAAK,IAC/DC,KAAK,GAAM,IAAOA,KAAK,GAAM,IAAOA,KAAK,EAAK,IAAOA,KAAK,EAAK,IAC/DC,KAAK,GAAM,IAAOA,KAAK,GAAM,IAAOA,KAAK,EAAK,IAAOA,KAAK,EAAK,IAC/DC,KAAK,GAAM,IAAOA,KAAK,GAAM,IAAOA,KAAK,EAAK,IAAOA,KAAK,EAAK,IAC/DC,KAAK,GAAM,IAAOA,KAAK,GAAM,IAAOA,KAAK,EAAK,IAAOA,KAAK,EAAK,IAC/DC,KAAK,GAAM,IAAOA,KAAK,GAAM,IAAOA,KAAK,EAAK,IAAOA,KAAK,EAAK,IAC/DC,KAAK,GAAM,IAAOA,KAAK,GAAM,IAAOA,KAAK,EAAK,IAAOA,KAAK,EAAK,GAClE,CACF,CAEA,SAASuB,EAA2BzC,EAAUC,EAAMG,EAAO,CAEtDJ,EAAS,OAAS,KAGnBA,EAAWQ,EAAOR,EAAS,KAAOA,EAAW,MAAM,UAAU,MAAM,KAAKA,EAAU,CAAC,CAAC,GAGtF,IAAIiC,EAAGS,GAAW,GAAKzC,EAAK,OAAS,EACjC0C,GAAQ,IAAI,MAAMD,EAAQ,EAC1BE,GAAW,IAAI,MAAM,EAAE,EACvBC,GAAK,CAAC,EAGV,IAAKZ,EAAI,EAAGA,EAAI,GAAIA,IAAKU,GAAMV,CAAC,EAAI,GACpC,IAAKA,EAAI,EAAGA,EAAIjC,EAAS,OAAQiC,IAAKU,GAAMV,CAAC,GAAKjC,EAASiC,CAAC,EAC5D,IAAKA,EAAI,EAAGA,EAAIhC,EAAK,OAAQgC,IAAKU,GAAM,GAAGV,CAAC,EAAIhC,EAAKgC,CAAC,EACtD,IAAKA,EAAIS,GAAW,EAAGT,EAAIS,GAAUT,IAAKU,GAAMV,CAAC,EAAI,EAGrD,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKW,GAASX,CAAC,EAAI,GACvC,IAAKA,EAAI,EAAGA,EAAIjC,EAAS,OAAQiC,IAAKW,GAASX,CAAC,GAAKjC,EAASiC,CAAC,EAG/D,SAASa,IAAmB,CAC1B,QAASb,GAAIS,GAAS,EAAGT,IAAKS,GAAS,EAAGT,KAAK,CAE7C,GADAU,GAAMV,EAAC,IACHU,GAAMV,EAAC,GAAK,IAAM,OACtBU,GAAMV,EAAC,EAAI,CACb,CACF,CAGA,KAAO7B,GAAS,IACd0C,GAAiB,EACjBD,GAAKA,GAAG,OAAOrC,EAAOoC,GAAS,OAAOpC,EAAOmC,EAAK,CAAC,CAAC,CAAC,EACrDvC,GAAS,GAEX,OAAIA,EAAQ,IACV0C,GAAiB,EACjBD,GAAKA,GAAG,OAAOrC,EAAOoC,GAAS,OAAOpC,EAAOmC,EAAK,CAAC,CAAC,EAAE,MAAM,EAAGvC,CAAK,CAAC,GAEhEyC,EACT,CAEA,SAASE,EAASC,EAAKC,EAAGC,EAAKC,EAAM,CACnC,IAAIC,GAAMJ,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBG,GAAML,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBI,GAAMN,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBK,GAAMP,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBM,GAAMR,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBO,GAAMT,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBQ,GAAMV,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBS,GAAMX,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBU,GAAMZ,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBW,GAAMb,EAAI,CAAC,EAAKC,EAAEC,GAAK,EACvBY,GAAMd,EAAI,EAAE,EAAIC,EAAEC,GAAK,EACvBa,GAAMf,EAAI,EAAE,EAAIC,EAAEC,GAAK,EACvBc,GAAMhB,EAAI,EAAE,EAAIC,EAAEC,GAAK,EACvBe,GAAMjB,EAAI,EAAE,EAAIC,EAAEC,GAAK,EACvBgB,GAAMlB,EAAI,EAAE,EAAIC,EAAEC,GAAK,EACvBiB,GAAMnB,EAAI,EAAE,EAAIC,EAAEC,GAAK,EACvBlB,EAAGC,GAEHmC,GAAKhB,GAAIiB,GAAKhB,GAAIiB,GAAKhB,GAAIiB,GAAKhB,GAAIiB,GAAKhB,GAAIiB,GAAKhB,GAAIiB,GAAKhB,GAAIiB,GAAKhB,GACpEiB,GAAKhB,GAAIiB,GAAKhB,GAAIiB,GAAMhB,GAAKiB,GAAMhB,GAAKiB,GAAMhB,GAAKiB,GAAMhB,GAAKiB,GAAMhB,GACpEiB,GAAMhB,GAEV,IAAKlC,GAAI,EAAGA,GAAI,EAAGA,IAAK,EACtBD,EAAKoC,GAAKY,GAAOR,IAAMxC,GAAG,EAAKA,IAAK,GACpCA,EAAKwC,GAAMJ,GAAMQ,IAAM5C,GAAG,EAAKA,IAAK,GACpCA,EAAK4C,GAAMJ,GAAKQ,IAAOhD,GAAG,GAAKA,IAAK,GACpCA,EAAIgD,GAAOJ,GAAMR,IAAMpC,GAAG,GAAKA,IAAK,GAEpCA,EAAKyC,GAAMJ,GAAMQ,IAAM7C,GAAG,EAAKA,IAAK,GACpCA,EAAK6C,GAAMJ,GAAKQ,IAAOjD,GAAG,EAAKA,IAAK,GACpCA,EAAIiD,GAAOJ,GAAMR,IAAMrC,GAAG,GAAKA,IAAK,GACpCA,EAAKqC,GAAKY,GAAOR,IAAMzC,GAAG,GAAKA,IAAK,GAEpCA,EAAI8C,GAAOJ,GAAKQ,IAAOlD,GAAG,EAAKA,IAAK,GACpCA,EAAIkD,GAAMJ,GAAOR,IAAMtC,GAAG,EAAKA,IAAK,GACpCA,EAAKsC,GAAKY,GAAOR,IAAM1C,GAAG,GAAKA,IAAK,GACpCA,EAAK0C,GAAMJ,GAAKQ,IAAO9C,GAAG,GAAKA,IAAK,GAEpCA,EAAImD,GAAMJ,GAAOR,IAAMvC,GAAG,EAAKA,IAAK,GACpCA,EAAKuC,GAAKY,GAAOR,IAAM3C,GAAG,EAAKA,IAAK,GACpCA,EAAK2C,GAAMJ,GAAKQ,IAAO/C,GAAG,GAAKA,IAAK,GACpCA,EAAI+C,GAAOJ,GAAKQ,IAAOnD,GAAG,GAAKA,IAAK,GAEpCA,EAAKoC,GAAMG,GAAMF,IAAMrC,GAAG,EAAKA,IAAK,GACpCA,EAAKqC,GAAMD,GAAME,IAAMtC,GAAG,EAAKA,IAAK,GACpCA,EAAKsC,GAAMD,GAAME,IAAMvC,GAAG,GAAKA,IAAK,GACpCA,EAAKuC,GAAMD,GAAMF,IAAMpC,GAAG,GAAKA,IAAK,GAEpCA,EAAKyC,GAAMD,GAAME,IAAM1C,GAAG,EAAKA,IAAK,GACpCA,EAAK0C,GAAMD,GAAME,IAAM3C,GAAG,EAAKA,IAAK,GACpCA,EAAK2C,GAAMD,GAAMF,IAAMxC,GAAG,GAAKA,IAAK,GACpCA,EAAKwC,GAAMG,GAAMF,IAAMzC,GAAG,GAAKA,IAAK,GAEpCA,EAAI8C,GAAOD,GAAKE,IAAO/C,GAAG,EAAKA,IAAK,GACpCA,EAAI+C,GAAMD,GAAOF,IAAM5C,GAAG,EAAKA,IAAK,GACpCA,EAAK4C,GAAKG,GAAOF,IAAM7C,GAAG,GAAKA,IAAK,GACpCA,EAAK6C,GAAMD,GAAKE,IAAO9C,GAAG,GAAKA,IAAK,GAEpCA,EAAImD,GAAMD,GAAMF,IAAOhD,GAAG,EAAKA,IAAK,GACpCA,EAAIgD,GAAMG,GAAMF,IAAOjD,GAAG,EAAKA,IAAK,GACpCA,EAAIiD,GAAMD,GAAME,IAAOlD,GAAG,GAAKA,IAAK,GACpCA,EAAIkD,GAAMD,GAAME,IAAOnD,GAAG,GAAKA,IAAK,GAGtCiB,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAMoB,GAAMhB,GAAO,EACpCH,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAMqB,GAAMhB,GAAO,EACpCJ,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAMsB,GAAMhB,GAAO,EACpCL,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAMuB,GAAMhB,GAAO,EACpCN,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAMwB,GAAMhB,GAAO,EACpCP,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAMyB,GAAMhB,GAAO,EACpCR,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAM0B,GAAMhB,GAAO,EACpCT,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAM2B,GAAMhB,GAAO,EACpCV,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAM4B,GAAMhB,GAAO,EACpCX,EAAEE,GAAM,EAAIH,EAAI,CAAC,EAAM6B,GAAMhB,GAAO,EACpCZ,EAAEE,GAAM,EAAIH,EAAI,EAAE,EAAK8B,GAAMhB,GAAO,EACpCb,EAAEE,GAAM,EAAIH,EAAI,EAAE,EAAK+B,GAAMhB,GAAO,EACpCd,EAAEE,GAAM,EAAIH,EAAI,EAAE,EAAKgC,GAAMhB,GAAO,EACpCf,EAAEE,GAAM,EAAIH,EAAI,EAAE,EAAKiC,GAAMhB,GAAO,EACpChB,EAAEE,GAAM,EAAIH,EAAI,EAAE,EAAKkC,GAAMhB,GAAO,EACpCjB,EAAEE,GAAM,EAAIH,EAAI,EAAE,EAAKmC,GAAMhB,GAAO,CACtC,CAEA,SAASiB,EAAUC,EAAKC,EAAIC,EAAKC,EAAIjE,GAAK,CACxC,KAAOA,MAAO8D,EAAIC,GAAI,EAAIC,EAAIC,GAAI,CACpC,CAEA,SAASC,EAASJ,EAAKC,EAAIC,EAAKC,EAAIjE,GAAK,CACvC,KAAOA,MAAO8D,EAAIC,GAAI,GAAKC,EAAIC,GAAI,CACrC,CAEA,SAASE,EAAS1C,EAAKC,EAAGC,EAAKC,EAAMhD,GAAG,CACtCiF,EAAUpC,EAAK,EAAGC,EAAGC,GAAO,EAAE/C,GAAE,GAAG,GAAI,EAAE,EACzC,QAAS8B,GAAI,EAAGA,GAAI,EAAE9B,GAAG8B,IAAK,EAC5Bc,EAASC,EAAKC,EAAGC,EAAMjB,GAAE,GAASkB,EAAOlB,GAAE,CAAC,EAC5Cc,EAASC,EAAKC,EAAGC,EAAMjB,GAAE,GAAK,GAAIkB,EAAOlB,GAAE,EAAI9B,GAAE,EAAE,CAEvD,CAEA,SAASwF,EAAW,EAAGC,EAAIzF,EAAG,CAC5B,OAAO,EAAEyF,GAAI,EAAEzF,EAAE,GAAG,EAAE,CACxB,CAEA,SAAS0F,EAAkBC,EAAG,CAE5B,QADIC,EAAM,CAAC,EACF9D,EAAI,EAAGA,EAAI6D,EAAE,OAAQ7D,IAAK,CACjC,IAAIP,EAAIoE,EAAE,WAAW7D,CAAC,EACtB,GAAIP,EAAI,IACNqE,EAAI,KAAKrE,CAAC,UACDA,EAAI,KACbqE,EAAI,KAAK,IAAOrE,GAAK,CAAC,EACtBqE,EAAI,KAAK,IAAOrE,EAAI,EAAI,UACfA,EAAI,MACbqE,EAAI,KAAK,IAAOrE,GAAK,EAAE,EACvBqE,EAAI,KAAK,IAAQrE,GAAK,EAAK,EAAI,EAC/BqE,EAAI,KAAK,IAAOrE,EAAI,EAAI,MACnB,CACL,GAAIO,GAAK6D,EAAE,OAAS,EAClB,MAAM,IAAI,MAAM,gBAAgB,EAElC7D,IACAP,GAAKA,EAAI,OAAU,GACnBA,GAAKoE,EAAE,WAAW7D,CAAC,EAAI,KACvBP,GAAK,MAELqE,EAAI,KAAK,IAAOrE,GAAK,EAAE,EACvBqE,EAAI,KAAK,IAAQrE,GAAK,GAAM,EAAI,EAChCqE,EAAI,KAAK,IAAQrE,GAAK,EAAK,EAAI,EAC/BqE,EAAI,KAAK,IAAOrE,EAAI,EAAI,CAC1B,CACF,CACA,OAAOqE,CACT,CAEA,SAASC,EAAW3E,EAAG,CAQrB,QANI4E,EAAM,mBAAmB,MAAM,EAAE,EAEjC1E,EAAMF,EAAE,OACR0E,EAAM,CAAC,EACP9D,GAAI,EAEDA,GAAIV,EAAKU,KACZ8D,EAAI,KAAKE,EAAK5E,EAAEY,EAAC,IAAI,EAAK,EAAE,CAAC,EAC7B8D,EAAI,KAAKE,EAAK5E,EAAEY,EAAC,IAAI,EAAK,EAAE,CAAC,EAEjC,OAAO8D,EAAI,KAAK,EAAE,CACpB,CAEA,SAASG,EAAc7E,EAAG,CAUxB,QARI4E,EAAO,mEACe,MAAM,EAAE,EAE9B1E,EAAMF,EAAE,OACR0E,EAAM,CAAC,EACP9D,GAAI,EACJT,GAAGC,GAAGC,GAAGyE,GAENlE,GAAIV,GACTC,GAAIS,GAAIV,EAAMF,EAAEY,IAAG,EAAI,EACvBR,GAAIQ,GAAIV,EAAMF,EAAEY,IAAG,EAAI,EACvBP,GAAIO,GAAIV,EAAMF,EAAEY,IAAG,EAAI,EACvBkE,IAAK3E,IAAK,KAAOC,IAAK,GAAKC,GAC3BqE,EAAI,KAAKE,EAAKE,KAAM,EAAI,EAAK,EAAE,CAAC,EAChCJ,EAAI,KAAKE,EAAKE,KAAM,EAAI,EAAK,EAAE,CAAC,EAChCJ,EAAI,KAAKE,EAAKE,KAAM,EAAI,EAAK,EAAE,CAAC,EAChCJ,EAAI,KAAKE,EAAKE,KAAM,EAAI,EAAK,EAAE,CAAC,EAElC,OAAI5E,EAAM,EAAI,IACZwE,EAAIA,EAAI,OAAO,CAAC,EAAI,IAChBxE,EAAM,IAAM,IAAGwE,EAAIA,EAAI,OAAO,CAAC,EAAI,MAElCA,EAAI,KAAK,EAAE,CACpB,CAKA,IAAIK,EAAY,KAAM,EAClB/E,EAAI,EAER,GAAI,OAAOnB,GAAS,SAAU,CAE5B,GAAI,UAAU,OAAS,EACrB,MAAM,IAAI,MAAM,uCAAuC,EAGzD,IAAImG,EAAOnG,EAIX,GAFAI,EAAWH,EACXD,EAAOmG,EAAK,KACR,OAAOnG,EAAS,IAClB,GAAI,OAAOmG,EAAK,EAAM,IAAa,CACjC,GAAIA,EAAK,EAAI,GAAKA,EAAK,EAAID,EACzB,MAAM,IAAI,MAAM,2BAA2B,EAE7C,GAAKC,EAAK,EAAKA,EAAK,EAAI,EACtB,MAAM,IAAI,MAAM,+BAA+B,EAEjDnG,EAAO,KAAK,IAAImG,EAAK,CAAC,EAAI,KAAK,GACjC,KACE,OAAM,IAAI,MAAM,6BAA6B,EAOjDhF,EAAIgF,EAAK,GAAK,EACdlG,EAAIkG,EAAK,EACTjG,EAAQiG,EAAK,OAAS,GACtBhG,EAAgBgG,EAAK,eAAiB,EACtC9F,EAAW8F,EAAK,QAClB,CAEA,GAAIhF,EAAI,EACN,MAAM,IAAI,MAAM,mBAAmB,EAErC,GAAIlB,GAAK,EACP,MAAM,IAAI,MAAM,mBAAmB,EAErC,GAAID,EAAO,GAAKA,EAAO,GACrB,MAAM,IAAI,MAAM,uCAAuC,EAGzD,IAAIoG,EAAK,GAAGpG,IAAQ,EAChBqG,EAAIC,EAAGvD,GAAGD,GAEd,GAAI7C,EAAEkB,GAAK,GAAG,IAAMlB,EAAIiG,EAAS,IAAI/E,GAAKlB,EAAIiG,EAAS,KAAOE,EAAIF,EAAS,IAAIjG,EAC7E,MAAM,IAAI,MAAM,kCAAkC,EAGhD,OAAOH,GAAa,WACtBA,EAAW6F,EAAkB7F,CAAQ,GACnC,OAAOC,GAAS,WAClBA,EAAO4F,EAAkB5F,CAAI,GAE3B,OAAO,WAAe,KAExBsG,EAAK,IAAI,WAAW,GAAGpG,CAAC,EACxBqG,EAAI,IAAI,WAAW,GAAGF,EAAEnG,CAAC,EACzB6C,GAAM,IAAI,WAAW,EAAE,IAEvBuD,EAAK,CAAC,EACNC,EAAI,CAAC,EACLxD,GAAM,IAAI,MAAM,EAAE,GAEpBC,GAAIR,EAA2BzC,EAAUC,EAAMoB,EAAE,IAAIlB,CAAC,EAEtD,IAAIsG,GAAK,EAAGC,GAAK,GAAKvG,EAEtB,SAASwG,GAAUC,EAAK,CACtB,QAAS3E,EAAI,EAAGA,EAAI,GAAG9B,EAAG8B,IAAK,CAC7B,IAAIC,EAAI0E,EAAM3E,EAAE,EAChBsE,EAAGE,GAAGxE,CAAC,GAAMgB,GAAEf,EAAE,CAAC,EAAI,MAAO,IAAQe,GAAEf,EAAE,CAAC,EAAI,MAAO,IACxCe,GAAEf,EAAE,CAAC,EAAI,MAAO,GAAQe,GAAEf,EAAE,CAAC,EAAI,MAAO,CACvD,CACF,CAEA,SAAS2E,GAAUC,EAAOC,EAAK,CAC7B,QAAS9E,EAAI6E,EAAO7E,EAAI8E,EAAK9E,GAAK,EAChCmD,EAAUoB,EAAGvE,GAAG,GAAG9B,GAAIoG,EAAIE,GAAI,GAAGtG,CAAC,EACnCuF,EAAS1C,GAAKuD,EAAIE,GAAIC,GAAIvG,CAAC,EAE3BiF,EAAUoB,GAAIvE,EAAE,IAAI,GAAG9B,GAAIoG,EAAIG,GAAI,GAAGvG,CAAC,EACvCuF,EAAS1C,GAAKuD,EAAIG,GAAID,GAAItG,CAAC,CAE/B,CAEA,SAAS6G,GAAUF,EAAOC,EAAK,CAC7B,QAAS9E,EAAI6E,EAAO7E,EAAI8E,EAAK9E,GAAK,EAAG,CACnC,IAAIC,EAAIyD,EAAWY,EAAIE,GAAItG,CAAC,EAAKmG,EAAE,EACnCb,EAASc,EAAIE,GAAID,EAAGtE,GAAG,GAAG/B,GAAI,GAAGA,CAAC,EAClCuF,EAAS1C,GAAKuD,EAAIE,GAAIC,GAAIvG,CAAC,EAE3B+B,EAAIyD,EAAWY,EAAIG,GAAIvG,CAAC,EAAKmG,EAAE,EAC/Bb,EAASc,EAAIG,GAAIF,EAAGtE,GAAG,GAAG/B,GAAI,GAAGA,CAAC,EAClCuF,EAAS1C,GAAKuD,EAAIG,GAAID,GAAItG,CAAC,CAC7B,CACF,CAEA,SAAS8G,GAAWL,EAAK,CACvB,QAAS3E,EAAI,EAAGA,EAAI,GAAG9B,EAAG8B,IAAK,CAC7B,IAAIC,EAAIqE,EAAGE,GAAGxE,CAAC,EACfgB,GAAE2D,EAAM3E,EAAE,EAAI,CAAC,EAAKC,IAAI,EAAM,IAC9Be,GAAE2D,EAAM3E,EAAE,EAAI,CAAC,EAAKC,IAAI,EAAM,IAC9Be,GAAE2D,EAAM3E,EAAE,EAAI,CAAC,EAAKC,IAAI,GAAM,IAC9Be,GAAE2D,EAAM3E,EAAE,EAAI,CAAC,EAAKC,IAAI,GAAM,GAChC,CACF,CAEA,IAAIgF,GAAY,OAAO,aAAiB,IAAe,aAAe,WAEtE,SAASC,GAAeL,EAAOC,EAAKK,EAAMC,EAAIC,GAAQ,EACnD,SAASC,IAAc,CACtBL,GAAS,UAAW,CAClBG,EAAGP,EAAOA,EAAQM,EAAOL,EAAMD,EAAQM,EAAOL,CAAG,EACjDD,GAASM,EACLN,EAAQC,EACVQ,GAAY,EAEZD,GAAO,CACT,CAAC,CACL,GAAG,CACL,CAEA,SAASE,GAAUvB,EAAK,CACpB,IAAIwB,EAAShF,EAA2BzC,EAAUiD,GAAG7C,CAAK,EAC1D,OAAI6F,IAAQ,SACHC,EAAcuB,CAAM,EACpBxB,IAAQ,MACRD,EAAWyB,CAAM,EACjBxB,IAAQ,SACR,IAAI,WAAWwB,CAAM,EAErBA,CACb,CAGA,SAASC,IAAgB,CACvB,QAASzF,EAAI,EAAGA,EAAIZ,EAAGY,IACrB0E,GAAU1E,EAAE,IAAI9B,CAAC,EACjB0G,GAAU,EAAGP,CAAC,EACdU,GAAU,EAAGV,CAAC,EACdW,GAAWhF,EAAE,IAAI9B,CAAC,EAEpBG,EAASkH,GAAUjH,CAAQ,CAAC,CAC9B,CAGA,SAASoH,GAAe1F,EAAG,CACvB0E,GAAU1E,EAAE,IAAI9B,CAAC,EACjBgH,GAAe,EAAGb,EAAGjG,EAAc,EAAGwG,GAAW,UAAW,CAC1DM,GAAe,EAAGb,EAAGjG,EAAc,EAAG2G,GAAW,UAAY,CAC3DC,GAAWhF,EAAE,IAAI9B,CAAC,EACd8B,EAAI,EAAIZ,EACV6F,GAAS,UAAW,CAAES,GAAe1F,EAAI,CAAC,CAAG,CAAC,EAE9C3B,EAASkH,GAAUjH,CAAQ,CAAC,CAEhC,CAAC,CACH,CAAC,CACL,CAEI,OAAOF,GAAkB,aAG3BE,EAAWD,EACXA,EAAWD,EACXA,EAAgB,KAGdA,GAAiB,EACnBqH,GAAc,EAEdC,GAAe,CAAC,CAEpB,CAEI,OAAO7H,GAAW,MAAaA,GAAO,QAAUC,MC/iBpD,IAAA6H,GAAAC,GAAA,CAAAC,GAAAC,KAAA,EAAC,SAASC,EAAM,CAChB,aAQA,IAAIC,EAAK,SAASC,EAAM,CACtB,IAAIC,EAAGC,EAAI,IAAI,aAAa,EAAE,EAC9B,GAAIF,EAAM,IAAKC,EAAI,EAAGA,EAAID,EAAK,OAAQC,IAAKC,EAAED,CAAC,EAAID,EAAKC,CAAC,EACzD,OAAOC,CACT,EAGIC,EAAc,UAAqB,CAAE,MAAM,IAAI,MAAM,SAAS,CAAG,EAEjEC,EAAK,IAAI,WAAW,EAAE,EACtBC,EAAK,IAAI,WAAW,EAAE,EAAGA,EAAG,CAAC,EAAI,EAErC,IAAIC,EAAMP,EAAG,EACTQ,EAAMR,EAAG,CAAC,CAAC,CAAC,EACZS,EAAUT,EAAG,CAAC,MAAQ,CAAC,CAAC,EACxBU,EAAIV,EAAG,CAAC,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,IAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAM,CAAC,EACvIW,EAAKX,EAAG,CAAC,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAQ,IAAQ,MAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,IAAM,CAAC,EACxIY,EAAIZ,EAAG,CAAC,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,IAAM,CAAC,EACvIa,EAAIb,EAAG,CAAC,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,KAAM,CAAC,EACvIc,EAAId,EAAG,CAAC,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,KAAQ,MAAQ,MAAQ,MAAQ,IAAQ,MAAQ,MAAQ,MAAQ,KAAQ,KAAM,CAAC,EAE3I,SAASe,EAAKC,EAAGd,EAAGe,EAAG,EAAG,CACxBD,EAAEd,CAAC,EAAOe,GAAK,GAAM,IACrBD,EAAEd,EAAE,CAAC,EAAKe,GAAK,GAAM,IACrBD,EAAEd,EAAE,CAAC,EAAKe,GAAM,EAAK,IACrBD,EAAEd,EAAE,CAAC,EAAIe,EAAI,IACbD,EAAEd,EAAE,CAAC,EAAK,GAAK,GAAO,IACtBc,EAAEd,EAAE,CAAC,EAAK,GAAK,GAAO,IACtBc,EAAEd,EAAE,CAAC,EAAK,GAAM,EAAM,IACtBc,EAAEd,EAAE,CAAC,EAAI,EAAI,GACf,CAEA,SAASgB,EAAGF,EAAGG,EAAI,EAAGC,EAAIC,EAAG,CAC3B,IAAInB,EAAEoB,EAAI,EACV,IAAKpB,EAAI,EAAGA,EAAImB,EAAGnB,IAAKoB,GAAKN,EAAEG,EAAGjB,CAAC,EAAE,EAAEkB,EAAGlB,CAAC,EAC3C,OAAQ,EAAMoB,EAAI,IAAO,GAAM,CACjC,CAEA,SAASC,EAAiBP,EAAGG,EAAI,EAAGC,EAAI,CACtC,OAAOF,EAAGF,EAAEG,EAAG,EAAEC,EAAG,EAAE,CACxB,CAEA,SAASI,EAAiBR,EAAGG,EAAI,EAAGC,EAAI,CACtC,OAAOF,EAAGF,EAAEG,EAAG,EAAEC,EAAG,EAAE,CACxB,CAEA,SAASK,EAAaC,EAAGC,EAAGC,EAAGC,EAAG,CAsBhC,QArBIC,EAAMD,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EE,EAAMH,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EI,EAAMJ,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EK,EAAML,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EM,EAAMN,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EO,GAAMN,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EO,EAAMT,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EU,GAAMV,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EW,GAAMX,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EY,GAAMZ,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9Ea,GAAMX,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EY,GAAMb,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9Ec,GAAMd,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9Ee,GAAMf,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EgB,GAAMhB,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EiB,GAAMhB,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAE9EiB,GAAKhB,EAAIiB,GAAKhB,EAAIiB,EAAKhB,EAAIiB,GAAKhB,EAAIiB,GAAKhB,EAAIiB,EAAKhB,GAAIiB,EAAKhB,EAAIiB,EAAKhB,GACpEiB,EAAKhB,GAAIiB,EAAKhB,GAAIiB,EAAMhB,GAAKiB,EAAMhB,GAAKiB,GAAMhB,GAAKiB,GAAMhB,GAAKiB,GAAMhB,GACpEiB,GAAMhB,GAAKiB,EAEN5D,GAAI,EAAGA,GAAI,GAAIA,IAAK,EAC3B4D,EAAIhB,GAAKY,GAAM,EACfR,IAAMY,GAAG,EAAIA,IAAK,GAClBA,EAAIZ,GAAKJ,GAAK,EACdQ,GAAMQ,GAAG,EAAIA,IAAK,GAClBA,EAAIR,EAAKJ,GAAK,EACdQ,IAAOI,GAAG,GAAKA,IAAK,GACpBA,EAAIJ,GAAMJ,EAAK,EACfR,IAAMgB,GAAG,GAAKA,IAAK,GAEnBA,EAAIX,EAAKJ,GAAK,EACdQ,GAAMO,GAAG,EAAIA,IAAK,GAClBA,EAAIP,EAAKJ,EAAK,EACdQ,IAAOG,GAAG,EAAIA,IAAK,GACnBA,EAAIH,GAAMJ,EAAK,EACfR,IAAMe,GAAG,GAAKA,IAAK,GACnBA,EAAIf,GAAKY,GAAM,EACfR,GAAMW,GAAG,GAAKA,IAAK,GAEnBA,EAAIN,EAAMJ,EAAK,EACfQ,IAAOE,GAAG,EAAIA,IAAK,GACnBA,EAAIF,GAAMJ,EAAM,EAChBR,GAAMc,GAAG,EAAIA,IAAK,GAClBA,EAAId,EAAKY,GAAM,EACfR,GAAMU,GAAG,GAAKA,IAAK,GACnBA,EAAIV,EAAKJ,EAAK,EACdQ,GAAOM,GAAG,GAAKA,IAAK,GAEpBA,EAAID,GAAMJ,EAAM,EAChBR,IAAMa,GAAG,EAAIA,IAAK,GAClBA,EAAIb,GAAKY,GAAM,EACfR,GAAMS,GAAG,EAAIA,IAAK,GAClBA,EAAIT,EAAKJ,GAAK,EACdQ,GAAOK,GAAG,GAAKA,IAAK,GACpBA,EAAIL,EAAMJ,EAAK,EACfQ,IAAOC,GAAG,GAAKA,IAAK,GAEpBA,EAAIhB,GAAKG,GAAK,EACdF,IAAMe,GAAG,EAAIA,IAAK,GAClBA,EAAIf,GAAKD,GAAK,EACdE,GAAMc,GAAG,EAAIA,IAAK,GAClBA,EAAId,EAAKD,GAAK,EACdE,IAAMa,GAAG,GAAKA,IAAK,GACnBA,EAAIb,GAAKD,EAAK,EACdF,IAAMgB,GAAG,GAAKA,IAAK,GAEnBA,EAAIX,EAAKD,GAAK,EACdE,GAAMU,GAAG,EAAIA,IAAK,GAClBA,EAAIV,EAAKD,EAAK,EACdE,GAAMS,GAAG,EAAIA,IAAK,GAClBA,EAAIT,EAAKD,EAAK,EACdF,IAAMY,GAAG,GAAKA,IAAK,GACnBA,EAAIZ,GAAKG,EAAK,EACdF,GAAMW,GAAG,GAAKA,IAAK,GAEnBA,EAAIN,EAAMD,EAAK,EACfE,GAAOK,GAAG,EAAIA,IAAK,GACnBA,EAAIL,EAAMD,EAAM,EAChBF,GAAMQ,GAAG,EAAIA,IAAK,GAClBA,EAAIR,EAAKG,EAAM,EACfF,GAAMO,GAAG,GAAKA,IAAK,GACnBA,EAAIP,EAAKD,EAAK,EACdE,GAAOM,GAAG,GAAKA,IAAK,GAEpBA,EAAID,GAAMD,GAAM,EAChBF,IAAOI,GAAG,EAAIA,IAAK,GACnBA,EAAIJ,GAAMG,GAAM,EAChBF,IAAOG,GAAG,EAAIA,IAAK,GACnBA,EAAIH,GAAMD,GAAM,EAChBE,IAAOE,GAAG,GAAKA,IAAK,GACpBA,EAAIF,GAAMD,GAAM,EAChBE,IAAOC,GAAG,GAAKA,IAAK,GAErBhB,GAAMA,GAAMhB,EAAK,EACjBiB,GAAMA,GAAMhB,EAAK,EACjBiB,EAAMA,EAAMhB,EAAK,EACjBiB,GAAMA,GAAMhB,EAAK,EACjBiB,GAAMA,GAAMhB,EAAK,EACjBiB,EAAMA,EAAMhB,GAAK,EACjBiB,EAAMA,EAAMhB,EAAK,EACjBiB,EAAMA,EAAMhB,GAAK,EACjBiB,EAAMA,EAAMhB,GAAK,EACjBiB,EAAMA,EAAMhB,GAAK,EAClBiB,EAAMA,EAAMhB,GAAM,EAClBiB,EAAMA,EAAMhB,GAAM,EAClBiB,GAAMA,GAAMhB,GAAM,EAClBiB,GAAMA,GAAMhB,GAAM,EAClBiB,GAAMA,GAAMhB,GAAM,EAClBiB,GAAMA,GAAMhB,GAAM,EAElBnB,EAAG,CAAC,EAAIoB,KAAQ,EAAI,IACpBpB,EAAG,CAAC,EAAIoB,KAAQ,EAAI,IACpBpB,EAAG,CAAC,EAAIoB,KAAO,GAAK,IACpBpB,EAAG,CAAC,EAAIoB,KAAO,GAAK,IAEpBpB,EAAG,CAAC,EAAIqB,KAAQ,EAAI,IACpBrB,EAAG,CAAC,EAAIqB,KAAQ,EAAI,IACpBrB,EAAG,CAAC,EAAIqB,KAAO,GAAK,IACpBrB,EAAG,CAAC,EAAIqB,KAAO,GAAK,IAEpBrB,EAAG,CAAC,EAAIsB,IAAQ,EAAI,IACpBtB,EAAG,CAAC,EAAIsB,IAAQ,EAAI,IACpBtB,EAAE,EAAE,EAAIsB,IAAO,GAAK,IACpBtB,EAAE,EAAE,EAAIsB,IAAO,GAAK,IAEpBtB,EAAE,EAAE,EAAIuB,KAAQ,EAAI,IACpBvB,EAAE,EAAE,EAAIuB,KAAQ,EAAI,IACpBvB,EAAE,EAAE,EAAIuB,KAAO,GAAK,IACpBvB,EAAE,EAAE,EAAIuB,KAAO,GAAK,IAEpBvB,EAAE,EAAE,EAAIwB,KAAQ,EAAI,IACpBxB,EAAE,EAAE,EAAIwB,KAAQ,EAAI,IACpBxB,EAAE,EAAE,EAAIwB,KAAO,GAAK,IACpBxB,EAAE,EAAE,EAAIwB,KAAO,GAAK,IAEpBxB,EAAE,EAAE,EAAIyB,IAAQ,EAAI,IACpBzB,EAAE,EAAE,EAAIyB,IAAQ,EAAI,IACpBzB,EAAE,EAAE,EAAIyB,IAAO,GAAK,IACpBzB,EAAE,EAAE,EAAIyB,IAAO,GAAK,IAEpBzB,EAAE,EAAE,EAAI0B,IAAQ,EAAI,IACpB1B,EAAE,EAAE,EAAI0B,IAAQ,EAAI,IACpB1B,EAAE,EAAE,EAAI0B,IAAO,GAAK,IACpB1B,EAAE,EAAE,EAAI0B,IAAO,GAAK,IAEpB1B,EAAE,EAAE,EAAI2B,IAAQ,EAAI,IACpB3B,EAAE,EAAE,EAAI2B,IAAQ,EAAI,IACpB3B,EAAE,EAAE,EAAI2B,IAAO,GAAK,IACpB3B,EAAE,EAAE,EAAI2B,IAAO,GAAK,IAEpB3B,EAAE,EAAE,EAAI4B,IAAQ,EAAI,IACpB5B,EAAE,EAAE,EAAI4B,IAAQ,EAAI,IACpB5B,EAAE,EAAE,EAAI4B,IAAO,GAAK,IACpB5B,EAAE,EAAE,EAAI4B,IAAO,GAAK,IAEpB5B,EAAE,EAAE,EAAI6B,IAAQ,EAAI,IACpB7B,EAAE,EAAE,EAAI6B,IAAQ,EAAI,IACpB7B,EAAE,EAAE,EAAI6B,IAAO,GAAK,IACpB7B,EAAE,EAAE,EAAI6B,IAAO,GAAK,IAEpB7B,EAAE,EAAE,EAAI8B,IAAS,EAAI,IACrB9B,EAAE,EAAE,EAAI8B,IAAS,EAAI,IACrB9B,EAAE,EAAE,EAAI8B,IAAQ,GAAK,IACrB9B,EAAE,EAAE,EAAI8B,IAAQ,GAAK,IAErB9B,EAAE,EAAE,EAAI+B,IAAS,EAAI,IACrB/B,EAAE,EAAE,EAAI+B,IAAS,EAAI,IACrB/B,EAAE,EAAE,EAAI+B,IAAQ,GAAK,IACrB/B,EAAE,EAAE,EAAI+B,IAAQ,GAAK,IAErB/B,EAAE,EAAE,EAAIgC,KAAS,EAAI,IACrBhC,EAAE,EAAE,EAAIgC,KAAS,EAAI,IACrBhC,EAAE,EAAE,EAAIgC,KAAQ,GAAK,IACrBhC,EAAE,EAAE,EAAIgC,KAAQ,GAAK,IAErBhC,EAAE,EAAE,EAAIiC,KAAS,EAAI,IACrBjC,EAAE,EAAE,EAAIiC,KAAS,EAAI,IACrBjC,EAAE,EAAE,EAAIiC,KAAQ,GAAK,IACrBjC,EAAE,EAAE,EAAIiC,KAAQ,GAAK,IAErBjC,EAAE,EAAE,EAAIkC,KAAS,EAAI,IACrBlC,EAAE,EAAE,EAAIkC,KAAS,EAAI,IACrBlC,EAAE,EAAE,EAAIkC,KAAQ,GAAK,IACrBlC,EAAE,EAAE,EAAIkC,KAAQ,GAAK,IAErBlC,EAAE,EAAE,EAAImC,KAAS,EAAI,IACrBnC,EAAE,EAAE,EAAImC,KAAS,EAAI,IACrBnC,EAAE,EAAE,EAAImC,KAAQ,GAAK,IACrBnC,EAAE,EAAE,EAAImC,KAAQ,GAAK,GACvB,CAEA,SAASE,EAAcrC,EAAEC,EAAEC,EAAEC,EAAG,CAsB9B,QArBIC,EAAMD,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EE,EAAMH,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EI,EAAMJ,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EK,EAAML,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EM,EAAMN,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EO,GAAMN,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EO,EAAMT,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EU,GAAMV,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAG,CAAC,EAAI,MAAO,IAAMA,EAAG,CAAC,EAAI,MAAO,GAC9EW,GAAMX,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EY,GAAMZ,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9Ea,GAAMX,EAAG,CAAC,EAAI,KAAQA,EAAG,CAAC,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EY,GAAMb,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9Ec,GAAMd,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9Ee,GAAMf,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EgB,GAAMhB,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAC9EiB,GAAMhB,EAAE,EAAE,EAAI,KAAQA,EAAE,EAAE,EAAI,MAAO,GAAKA,EAAE,EAAE,EAAI,MAAO,IAAMA,EAAE,EAAE,EAAI,MAAO,GAE9EiB,GAAKhB,EAAIiB,GAAKhB,EAAIiB,EAAKhB,EAAIiB,GAAKhB,EAAIiB,GAAKhB,EAAIiB,EAAKhB,GAAIiB,EAAKhB,EAAIiB,EAAKhB,GACpEiB,EAAKhB,GAAIiB,EAAKhB,GAAIiB,EAAMhB,GAAKiB,EAAMhB,GAAKiB,GAAMhB,GAAKiB,GAAMhB,GAAKiB,GAAMhB,GACpEiB,GAAMhB,GAAKiB,EAEN5D,GAAI,EAAGA,GAAI,GAAIA,IAAK,EAC3B4D,EAAIhB,GAAKY,GAAM,EACfR,IAAMY,GAAG,EAAIA,IAAK,GAClBA,EAAIZ,GAAKJ,GAAK,EACdQ,GAAMQ,GAAG,EAAIA,IAAK,GAClBA,EAAIR,EAAKJ,GAAK,EACdQ,IAAOI,GAAG,GAAKA,IAAK,GACpBA,EAAIJ,GAAMJ,EAAK,EACfR,IAAMgB,GAAG,GAAKA,IAAK,GAEnBA,EAAIX,EAAKJ,GAAK,EACdQ,GAAMO,GAAG,EAAIA,IAAK,GAClBA,EAAIP,EAAKJ,EAAK,EACdQ,IAAOG,GAAG,EAAIA,IAAK,GACnBA,EAAIH,GAAMJ,EAAK,EACfR,IAAMe,GAAG,GAAKA,IAAK,GACnBA,EAAIf,GAAKY,GAAM,EACfR,GAAMW,GAAG,GAAKA,IAAK,GAEnBA,EAAIN,EAAMJ,EAAK,EACfQ,IAAOE,GAAG,EAAIA,IAAK,GACnBA,EAAIF,GAAMJ,EAAM,EAChBR,GAAMc,GAAG,EAAIA,IAAK,GAClBA,EAAId,EAAKY,GAAM,EACfR,GAAMU,GAAG,GAAKA,IAAK,GACnBA,EAAIV,EAAKJ,EAAK,EACdQ,GAAOM,GAAG,GAAKA,IAAK,GAEpBA,EAAID,GAAMJ,EAAM,EAChBR,IAAMa,GAAG,EAAIA,IAAK,GAClBA,EAAIb,GAAKY,GAAM,EACfR,GAAMS,GAAG,EAAIA,IAAK,GAClBA,EAAIT,EAAKJ,GAAK,EACdQ,GAAOK,GAAG,GAAKA,IAAK,GACpBA,EAAIL,EAAMJ,EAAK,EACfQ,IAAOC,GAAG,GAAKA,IAAK,GAEpBA,EAAIhB,GAAKG,GAAK,EACdF,IAAMe,GAAG,EAAIA,IAAK,GAClBA,EAAIf,GAAKD,GAAK,EACdE,GAAMc,GAAG,EAAIA,IAAK,GAClBA,EAAId,EAAKD,GAAK,EACdE,IAAMa,GAAG,GAAKA,IAAK,GACnBA,EAAIb,GAAKD,EAAK,EACdF,IAAMgB,GAAG,GAAKA,IAAK,GAEnBA,EAAIX,EAAKD,GAAK,EACdE,GAAMU,GAAG,EAAIA,IAAK,GAClBA,EAAIV,EAAKD,EAAK,EACdE,GAAMS,GAAG,EAAIA,IAAK,GAClBA,EAAIT,EAAKD,EAAK,EACdF,IAAMY,GAAG,GAAKA,IAAK,GACnBA,EAAIZ,GAAKG,EAAK,EACdF,GAAMW,GAAG,GAAKA,IAAK,GAEnBA,EAAIN,EAAMD,EAAK,EACfE,GAAOK,GAAG,EAAIA,IAAK,GACnBA,EAAIL,EAAMD,EAAM,EAChBF,GAAMQ,GAAG,EAAIA,IAAK,GAClBA,EAAIR,EAAKG,EAAM,EACfF,GAAMO,GAAG,GAAKA,IAAK,GACnBA,EAAIP,EAAKD,EAAK,EACdE,GAAOM,GAAG,GAAKA,IAAK,GAEpBA,EAAID,GAAMD,GAAM,EAChBF,IAAOI,GAAG,EAAIA,IAAK,GACnBA,EAAIJ,GAAMG,GAAM,EAChBF,IAAOG,GAAG,EAAIA,IAAK,GACnBA,EAAIH,GAAMD,GAAM,EAChBE,IAAOE,GAAG,GAAKA,IAAK,GACpBA,EAAIF,GAAMD,GAAM,EAChBE,IAAOC,GAAG,GAAKA,IAAK,GAGtBpC,EAAG,CAAC,EAAIoB,KAAQ,EAAI,IACpBpB,EAAG,CAAC,EAAIoB,KAAQ,EAAI,IACpBpB,EAAG,CAAC,EAAIoB,KAAO,GAAK,IACpBpB,EAAG,CAAC,EAAIoB,KAAO,GAAK,IAEpBpB,EAAG,CAAC,EAAIyB,IAAQ,EAAI,IACpBzB,EAAG,CAAC,EAAIyB,IAAQ,EAAI,IACpBzB,EAAG,CAAC,EAAIyB,IAAO,GAAK,IACpBzB,EAAG,CAAC,EAAIyB,IAAO,GAAK,IAEpBzB,EAAG,CAAC,EAAI8B,IAAS,EAAI,IACrB9B,EAAG,CAAC,EAAI8B,IAAS,EAAI,IACrB9B,EAAE,EAAE,EAAI8B,IAAQ,GAAK,IACrB9B,EAAE,EAAE,EAAI8B,IAAQ,GAAK,IAErB9B,EAAE,EAAE,EAAImC,KAAS,EAAI,IACrBnC,EAAE,EAAE,EAAImC,KAAS,EAAI,IACrBnC,EAAE,EAAE,EAAImC,KAAQ,GAAK,IACrBnC,EAAE,EAAE,EAAImC,KAAQ,GAAK,IAErBnC,EAAE,EAAE,EAAI0B,IAAQ,EAAI,IACpB1B,EAAE,EAAE,EAAI0B,IAAQ,EAAI,IACpB1B,EAAE,EAAE,EAAI0B,IAAO,GAAK,IACpB1B,EAAE,EAAE,EAAI0B,IAAO,GAAK,IAEpB1B,EAAE,EAAE,EAAI2B,IAAQ,EAAI,IACpB3B,EAAE,EAAE,EAAI2B,IAAQ,EAAI,IACpB3B,EAAE,EAAE,EAAI2B,IAAO,GAAK,IACpB3B,EAAE,EAAE,EAAI2B,IAAO,GAAK,IAEpB3B,EAAE,EAAE,EAAI4B,IAAQ,EAAI,IACpB5B,EAAE,EAAE,EAAI4B,IAAQ,EAAI,IACpB5B,EAAE,EAAE,EAAI4B,IAAO,GAAK,IACpB5B,EAAE,EAAE,EAAI4B,IAAO,GAAK,IAEpB5B,EAAE,EAAE,EAAI6B,IAAQ,EAAI,IACpB7B,EAAE,EAAE,EAAI6B,IAAQ,EAAI,IACpB7B,EAAE,EAAE,EAAI6B,IAAO,GAAK,IACpB7B,EAAE,EAAE,EAAI6B,IAAO,GAAK,GACtB,CAEA,SAASS,EAAoBC,EAAIC,EAAItC,EAAEC,EAAG,CACxCJ,EAAawC,EAAIC,EAAItC,EAAEC,CAAC,CAC1B,CAEA,SAASsC,EAAqBF,EAAIC,EAAItC,EAAEC,EAAG,CACzCkC,EAAcE,EAAIC,EAAItC,EAAEC,CAAC,CAC3B,CAEA,IAAIuC,EAAQ,IAAI,WAAW,CAAC,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,GAAG,CAAC,EAGpG,SAASC,EAA0BxC,EAAEyC,EAAKC,EAAEC,EAAK,EAAEnD,EAAEO,EAAG,CACtD,IAAI6C,EAAI,IAAI,WAAW,EAAE,EAAGzD,EAAI,IAAI,WAAW,EAAE,EAC7C8C,GAAG5D,EACP,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKuE,EAAEvE,CAAC,EAAI,EAChC,IAAKA,EAAI,EAAGA,EAAI,EAAGA,IAAKuE,EAAEvE,CAAC,EAAImB,EAAEnB,CAAC,EAClC,KAAO,GAAK,IAAI,CAEd,IADA8D,EAAoBhD,EAAEyD,EAAE7C,EAAEwC,CAAK,EAC1BlE,EAAI,EAAGA,EAAI,GAAIA,IAAK2B,EAAEyC,EAAKpE,CAAC,EAAIqE,EAAEC,EAAKtE,CAAC,EAAIc,EAAEd,CAAC,EAEpD,IADA4D,GAAI,EACC5D,EAAI,EAAGA,EAAI,GAAIA,IAClB4D,GAAIA,IAAKW,EAAEvE,CAAC,EAAI,KAAQ,EACxBuE,EAAEvE,CAAC,EAAI4D,GAAI,IACXA,MAAO,EAET,GAAK,GACLQ,GAAQ,GACRE,GAAQ,EACV,CACA,GAAI,EAAI,EAEN,IADAR,EAAoBhD,EAAEyD,EAAE7C,EAAEwC,CAAK,EAC1BlE,EAAI,EAAGA,EAAI,EAAGA,IAAK2B,EAAEyC,EAAKpE,CAAC,EAAIqE,EAAEC,EAAKtE,CAAC,EAAIc,EAAEd,CAAC,EAErD,MAAO,EACT,CAEA,SAASwE,EAAsB7C,EAAEyC,EAAKK,EAAEtD,EAAEO,EAAG,CAC3C,IAAI6C,EAAI,IAAI,WAAW,EAAE,EAAGzD,EAAI,IAAI,WAAW,EAAE,EAC7C8C,EAAG5D,EACP,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKuE,EAAEvE,CAAC,EAAI,EAChC,IAAKA,EAAI,EAAGA,EAAI,EAAGA,IAAKuE,EAAEvE,CAAC,EAAImB,EAAEnB,CAAC,EAClC,KAAOyE,GAAK,IAAI,CAEd,IADAX,EAAoBhD,EAAEyD,EAAE7C,EAAEwC,CAAK,EAC1BlE,EAAI,EAAGA,EAAI,GAAIA,IAAK2B,EAAEyC,EAAKpE,CAAC,EAAIc,EAAEd,CAAC,EAExC,IADA4D,EAAI,EACC5D,EAAI,EAAGA,EAAI,GAAIA,IAClB4D,EAAIA,GAAKW,EAAEvE,CAAC,EAAI,KAAQ,EACxBuE,EAAEvE,CAAC,EAAI4D,EAAI,IACXA,KAAO,EAETa,GAAK,GACLL,GAAQ,EACV,CACA,GAAIK,EAAI,EAEN,IADAX,EAAoBhD,EAAEyD,EAAE7C,EAAEwC,CAAK,EAC1BlE,EAAI,EAAGA,EAAIyE,EAAGzE,IAAK2B,EAAEyC,EAAKpE,CAAC,EAAIc,EAAEd,CAAC,EAEzC,MAAO,EACT,CAEA,SAAS0E,GAAc/C,EAAEyC,EAAKhD,EAAED,EAAEO,EAAG,CACnC,IAAIiD,EAAI,IAAI,WAAW,EAAE,EACzBV,EAAqBU,EAAExD,EAAEO,EAAEwC,CAAK,EAEhC,QADIU,EAAK,IAAI,WAAW,CAAC,EAChB5E,EAAI,EAAGA,EAAI,EAAGA,IAAK4E,EAAG5E,CAAC,EAAImB,EAAEnB,EAAE,EAAE,EAC1C,OAAOwE,EAAsB7C,EAAEyC,EAAKhD,EAAEwD,EAAGD,CAAC,CAC5C,CAEA,SAASE,GAAkBlD,EAAEyC,EAAKC,EAAEC,EAAKlD,EAAED,EAAEO,EAAG,CAC9C,IAAIiD,EAAI,IAAI,WAAW,EAAE,EACzBV,EAAqBU,EAAExD,EAAEO,EAAEwC,CAAK,EAEhC,QADIU,EAAK,IAAI,WAAW,CAAC,EAChB5E,GAAI,EAAGA,GAAI,EAAGA,KAAK4E,EAAG5E,EAAC,EAAImB,EAAEnB,GAAE,EAAE,EAC1C,OAAOmE,EAA0BxC,EAAEyC,EAAKC,EAAEC,EAAKlD,EAAEwD,EAAGD,CAAC,CACvD,CAOA,IAAIG,GAAW,SAASC,EAAK,CAC3B,KAAK,OAAS,IAAI,WAAW,EAAE,EAC/B,KAAK,EAAI,IAAI,YAAY,EAAE,EAC3B,KAAK,EAAI,IAAI,YAAY,EAAE,EAC3B,KAAK,IAAM,IAAI,YAAY,CAAC,EAC5B,KAAK,SAAW,EAChB,KAAK,IAAM,EAEX,IAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAEhCP,EAAKD,EAAK,CAAC,EAAI,KAAQA,EAAK,CAAC,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,EAAMC,EAA2B,KACtFC,EAAKF,EAAK,CAAC,EAAI,KAAQA,EAAK,CAAC,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,GAAMC,IAAO,GAAOC,GAAO,GAAM,KACtFC,EAAKH,EAAK,CAAC,EAAI,KAAQA,EAAK,CAAC,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,GAAME,IAAO,GAAOC,GAAO,GAAM,KACtFC,EAAKJ,EAAK,CAAC,EAAI,KAAQA,EAAK,CAAC,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,GAAMG,IAAQ,EAAMC,GAAO,GAAM,KACtFC,EAAKL,EAAK,CAAC,EAAI,KAAQA,EAAK,CAAC,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,GAAMI,IAAQ,EAAMC,GAAM,IAAO,IACtF,KAAK,EAAE,CAAC,EAAMA,IAAQ,EAAM,KAC5BC,EAAKN,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,GAAMK,IAAO,GAAOC,GAAO,GAAM,KACtFC,EAAKP,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,GAAMM,IAAO,GAAOC,GAAO,GAAM,KACtFC,EAAKR,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EAAG,KAAK,EAAE,CAAC,GAAMO,IAAQ,EAAMC,GAAO,GAAM,KACtF,KAAK,EAAE,CAAC,EAAMA,IAAQ,EAAM,IAE5B,KAAK,IAAI,CAAC,EAAIR,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EACnD,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EACnD,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EACnD,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EACnD,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EACnD,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EACnD,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,EACnD,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAE,EAAI,KAAQA,EAAI,EAAE,EAAI,MAAS,CACrD,EAEAD,GAAS,UAAU,OAAS,SAAST,EAAGC,EAAMkB,EAAO,CA2BnD,QA1BIC,EAAQ,KAAK,IAAM,EAAK,KACxBT,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GAAIC,EAAIC,GAAI5D,GAChC+D,GAAIC,GAAIC,GAAIC,GAAIC,GAAIC,GAAIC,GAAIC,GAAIC,GAAIC,EAEpCC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EAEbC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,EAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EACbC,GAAK,KAAK,EAAE,CAAC,EAEV/B,GAAS,IACdR,EAAKX,EAAEC,EAAM,CAAC,EAAI,KAAQD,EAAEC,EAAM,CAAC,EAAI,MAAS,EAAG8B,IAAQpB,EAA2B,KACtFC,EAAKZ,EAAEC,EAAM,CAAC,EAAI,KAAQD,EAAEC,EAAM,CAAC,EAAI,MAAS,EAAG+B,KAAQrB,IAAO,GAAOC,GAAO,GAAM,KACtFC,EAAKb,EAAEC,EAAM,CAAC,EAAI,KAAQD,EAAEC,EAAM,CAAC,EAAI,MAAS,EAAGgC,IAAQrB,IAAO,GAAOC,GAAO,GAAM,KACtFC,EAAKd,EAAEC,EAAM,CAAC,EAAI,KAAQD,EAAEC,EAAM,CAAC,EAAI,MAAS,EAAGiC,IAAQrB,IAAQ,EAAMC,GAAO,GAAM,KACtFC,EAAKf,EAAEC,EAAM,CAAC,EAAI,KAAQD,EAAEC,EAAM,CAAC,EAAI,MAAS,EAAGkC,IAAQrB,IAAQ,EAAMC,GAAM,IAAO,KACtFqB,GAAQrB,IAAQ,EAAM,KACtBC,GAAKhB,EAAEC,EAAK,EAAE,EAAI,KAAQD,EAAEC,EAAK,EAAE,EAAI,MAAS,EAAGoC,IAAQtB,IAAO,GAAOC,IAAO,GAAM,KACtFC,EAAKjB,EAAEC,EAAK,EAAE,EAAI,KAAQD,EAAEC,EAAK,EAAE,EAAI,MAAS,EAAGqC,IAAQtB,KAAO,GAAOC,GAAO,GAAM,KACtFC,GAAKlB,EAAEC,EAAK,EAAE,EAAI,KAAQD,EAAEC,EAAK,EAAE,EAAI,MAAS,EAAGsC,IAAQtB,IAAQ,EAAMC,IAAO,GAAM,KACtFsB,IAAQtB,KAAO,EAAME,EAErB9D,GAAI,EAEJ+D,GAAK/D,GACL+D,IAAMU,GAAKU,GACXpB,IAAMW,IAAM,EAAIkB,IAChB7B,IAAMY,GAAM,EAAIgB,IAChB5B,IAAMa,GAAM,EAAIc,IAChB3B,IAAMc,GAAM,EAAIY,IAChBzF,GAAK+D,KAAO,GAAKA,IAAM,KACvBA,IAAMe,GAAM,EAAIU,IAChBzB,IAAMgB,GAAM,EAAIQ,IAChBxB,IAAMiB,GAAM,EAAIM,GAChBvB,IAAMkB,GAAM,EAAII,IAChBtB,IAAMmB,IAAM,EAAIE,IAChBpF,IAAM+D,KAAO,GAAKA,IAAM,KAExBC,GAAKhE,GACLgE,IAAMS,GAAKW,GACXpB,IAAMU,GAAKS,GACXnB,IAAMW,GAAM,EAAIiB,IAChB5B,IAAMY,GAAM,EAAIe,IAChB3B,IAAMa,GAAM,EAAIa,IAChB1F,GAAKgE,KAAO,GAAKA,IAAM,KACvBA,IAAMc,GAAM,EAAIW,IAChBzB,IAAMe,GAAM,EAAIS,IAChBxB,IAAMgB,GAAM,EAAIO,IAChBvB,IAAMiB,GAAM,EAAIK,GAChBtB,IAAMkB,IAAM,EAAIG,IAChBrF,IAAMgE,KAAO,GAAKA,IAAM,KAExBC,GAAKjE,GACLiE,IAAMQ,GAAKY,GACXpB,IAAMS,GAAKU,GACXnB,IAAMU,EAAKQ,GACXlB,IAAMW,GAAM,EAAIgB,IAChB3B,IAAMY,GAAM,EAAIc,IAChB3F,GAAKiE,KAAO,GAAKA,IAAM,KACvBA,IAAMa,GAAM,EAAIY,IAChBzB,IAAMc,GAAM,EAAIU,IAChBxB,IAAMe,GAAM,EAAIQ,IAChBvB,IAAMgB,GAAM,EAAIM,IAChBtB,IAAMiB,IAAM,EAAII,GAChBtF,IAAMiE,KAAO,GAAKA,IAAM,KAExBC,GAAKlE,GACLkE,IAAMO,GAAKa,EACXpB,IAAMQ,GAAKW,GACXnB,IAAMS,EAAKS,GACXlB,IAAMU,EAAKO,GACXjB,IAAMW,GAAM,EAAIe,IAChB5F,GAAKkE,KAAO,GAAKA,IAAM,KACvBA,IAAMY,GAAM,EAAIa,IAChBzB,IAAMa,GAAM,EAAIW,IAChBxB,IAAMc,GAAM,EAAIS,IAChBvB,IAAMe,GAAM,EAAIO,IAChBtB,IAAMgB,IAAM,EAAIK,IAChBvF,IAAMkE,KAAO,GAAKA,IAAM,KAExBC,GAAKnE,GACLmE,IAAMM,GAAKc,GACXpB,IAAMO,GAAKY,EACXnB,IAAMQ,EAAKU,GACXlB,IAAMS,EAAKQ,GACXjB,IAAMU,EAAKM,GACXnF,GAAKmE,KAAO,GAAKA,IAAM,KACvBA,IAAMW,GAAM,EAAIc,IAChBzB,IAAMY,GAAM,EAAIY,IAChBxB,IAAMa,GAAM,EAAIU,IAChBvB,IAAMc,GAAM,EAAIQ,IAChBtB,IAAMe,IAAM,EAAIM,IAChBxF,IAAMmE,KAAO,GAAKA,IAAM,KAExBC,GAAKpE,GACLoE,IAAMK,GAAKe,GACXpB,IAAMM,GAAKa,GACXnB,IAAMO,EAAKW,EACXlB,IAAMQ,EAAKS,GACXjB,IAAMS,EAAKO,GACXpF,GAAKoE,KAAO,GAAKA,IAAM,KACvBA,IAAMU,EAAKK,GACXf,IAAMW,GAAM,EAAIa,IAChBxB,IAAMY,GAAM,EAAIW,IAChBvB,IAAMa,GAAM,EAAIS,IAChBtB,IAAMc,IAAM,EAAIO,IAChBzF,IAAMoE,KAAO,GAAKA,IAAM,KAExBC,GAAKrE,GACLqE,IAAMI,GAAKgB,GACXpB,IAAMK,GAAKc,GACXnB,IAAMM,EAAKY,GACXlB,IAAMO,EAAKU,EACXjB,IAAMQ,EAAKQ,GACXrF,GAAKqE,KAAO,GAAKA,IAAM,KACvBA,IAAMS,EAAKM,GACXf,IAAMU,EAAKI,GACXd,IAAMW,GAAM,EAAIY,IAChBvB,IAAMY,GAAM,EAAIU,IAChBtB,IAAMa,IAAM,EAAIQ,IAChB1F,IAAMqE,KAAO,GAAKA,IAAM,KAExBC,GAAKtE,GACLsE,IAAMG,GAAKiB,GACXpB,IAAMI,GAAKe,GACXnB,IAAMK,EAAKa,GACXlB,IAAMM,EAAKW,GACXjB,IAAMO,EAAKS,EACXtF,GAAKsE,KAAO,GAAKA,IAAM,KACvBA,IAAMQ,EAAKO,GACXf,IAAMS,EAAKK,GACXd,IAAMU,EAAKG,GACXb,IAAMW,GAAM,EAAIW,IAChBtB,IAAMY,IAAM,EAAIS,IAChB3F,IAAMsE,KAAO,GAAKA,IAAM,KAExBC,GAAKvE,GACLuE,IAAME,GAAKkB,GACXpB,IAAMG,GAAKgB,GACXnB,IAAMI,EAAKc,GACXlB,IAAMK,EAAKY,GACXjB,IAAMM,EAAKU,GACXvF,GAAKuE,KAAO,GAAKA,IAAM,KACvBA,IAAMO,EAAKQ,EACXf,IAAMQ,EAAKM,GACXd,IAAMS,EAAKI,GACXb,IAAMU,EAAKE,GACXZ,IAAMW,IAAM,EAAIU,IAChB5F,IAAMuE,KAAO,GAAKA,IAAM,KAExBC,EAAKxE,GACLwE,GAAMC,GAAKmB,GACXpB,GAAME,GAAKiB,GACXnB,GAAMG,EAAKe,GACXlB,GAAMI,EAAKa,GACXjB,GAAMK,EAAKW,GACXxF,GAAKwE,IAAO,GAAKA,GAAM,KACvBA,GAAMM,EAAKS,GACXf,GAAMO,EAAKO,EACXd,GAAMQ,EAAKK,GACXb,GAAMS,EAAKG,GACXZ,GAAMU,GAAKC,GACXnF,IAAMwE,IAAO,GAAKA,GAAM,KAExBxE,IAAOA,IAAK,GAAKA,GAAM,EACvBA,GAAKA,GAAI+D,GAAM,EACfA,GAAK/D,GAAI,KACTA,GAAKA,KAAM,GACXgE,IAAMhE,GAENyE,GAAKV,GACLW,GAAKV,GACLW,EAAKV,GACLW,EAAKV,GACLW,EAAKV,GACLW,EAAKV,GACLW,EAAKV,GACLW,EAAKV,GACLW,EAAKV,GACLW,GAAKV,EAEL7B,GAAQ,GACRkB,GAAS,GAEX,KAAK,EAAE,CAAC,EAAIY,GACZ,KAAK,EAAE,CAAC,EAAIC,GACZ,KAAK,EAAE,CAAC,EAAIC,EACZ,KAAK,EAAE,CAAC,EAAIC,EACZ,KAAK,EAAE,CAAC,EAAIC,EACZ,KAAK,EAAE,CAAC,EAAIC,EACZ,KAAK,EAAE,CAAC,EAAIC,EACZ,KAAK,EAAE,CAAC,EAAIC,EACZ,KAAK,EAAE,CAAC,EAAIC,EACZ,KAAK,EAAE,CAAC,EAAIC,EACd,EAEA/B,GAAS,UAAU,OAAS,SAAS0C,EAAKC,EAAQ,CAChD,IAAIC,EAAI,IAAI,YAAY,EAAE,EACtB/F,EAAGgG,EAAMC,EAAG5H,EAEhB,GAAI,KAAK,SAAU,CAGjB,IAFAA,EAAI,KAAK,SACT,KAAK,OAAOA,GAAG,EAAI,EACZA,EAAI,GAAIA,IAAK,KAAK,OAAOA,CAAC,EAAI,EACrC,KAAK,IAAM,EACX,KAAK,OAAO,KAAK,OAAQ,EAAG,EAAE,CAChC,CAIA,IAFA2B,EAAI,KAAK,EAAE,CAAC,IAAM,GAClB,KAAK,EAAE,CAAC,GAAK,KACR3B,EAAI,EAAGA,EAAI,GAAIA,IAClB,KAAK,EAAEA,CAAC,GAAK2B,EACbA,EAAI,KAAK,EAAE3B,CAAC,IAAM,GAClB,KAAK,EAAEA,CAAC,GAAK,KAaf,IAXA,KAAK,EAAE,CAAC,GAAM2B,EAAI,EAClBA,EAAI,KAAK,EAAE,CAAC,IAAM,GAClB,KAAK,EAAE,CAAC,GAAK,KACb,KAAK,EAAE,CAAC,GAAKA,EACbA,EAAI,KAAK,EAAE,CAAC,IAAM,GAClB,KAAK,EAAE,CAAC,GAAK,KACb,KAAK,EAAE,CAAC,GAAKA,EAEb+F,EAAE,CAAC,EAAI,KAAK,EAAE,CAAC,EAAI,EACnB/F,EAAI+F,EAAE,CAAC,IAAM,GACbA,EAAE,CAAC,GAAK,KACH1H,EAAI,EAAGA,EAAI,GAAIA,IAClB0H,EAAE1H,CAAC,EAAI,KAAK,EAAEA,CAAC,EAAI2B,EACnBA,EAAI+F,EAAE1H,CAAC,IAAM,GACb0H,EAAE1H,CAAC,GAAK,KAKV,IAHA0H,EAAE,CAAC,GAAM,KAETC,GAAQhG,EAAI,GAAK,EACZ3B,EAAI,EAAGA,EAAI,GAAIA,IAAK0H,EAAE1H,CAAC,GAAK2H,EAEjC,IADAA,EAAO,CAACA,EACH3H,EAAI,EAAGA,EAAI,GAAIA,IAAK,KAAK,EAAEA,CAAC,EAAK,KAAK,EAAEA,CAAC,EAAI2H,EAAQD,EAAE1H,CAAC,EAa7D,IAXA,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,EAAa,KAAK,EAAE,CAAC,GAAK,IAA2B,MAC3E,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,IAAO,EAAM,KAAK,EAAE,CAAC,GAAK,IAA2B,MAC3E,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,IAAO,EAAM,KAAK,EAAE,CAAC,GAAM,GAA0B,MAC3E,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,IAAO,EAAM,KAAK,EAAE,CAAC,GAAM,GAA0B,MAC3E,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,IAAM,GAAO,KAAK,EAAE,CAAC,GAAM,EAAM,KAAK,EAAE,CAAC,GAAK,IAAO,MAC3E,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,IAAO,EAAM,KAAK,EAAE,CAAC,GAAK,IAA2B,MAC3E,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,IAAO,EAAM,KAAK,EAAE,CAAC,GAAM,GAA0B,MAC3E,KAAK,EAAE,CAAC,GAAM,KAAK,EAAE,CAAC,IAAO,EAAM,KAAK,EAAE,CAAC,GAAM,GAA0B,MAE3E4H,EAAI,KAAK,EAAE,CAAC,EAAI,KAAK,IAAI,CAAC,EAC1B,KAAK,EAAE,CAAC,EAAIA,EAAI,MACX5H,EAAI,EAAGA,EAAI,EAAGA,IACjB4H,GAAO,KAAK,EAAE5H,CAAC,EAAI,KAAK,IAAIA,CAAC,EAAK,IAAM4H,IAAM,IAAO,EACrD,KAAK,EAAE5H,CAAC,EAAI4H,EAAI,MAGlBJ,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAQ,CAAC,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAO,EAAE,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAO,EAAE,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAO,EAAE,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAO,EAAE,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAO,EAAE,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,IACrCD,EAAIC,EAAO,EAAE,EAAK,KAAK,EAAE,CAAC,IAAM,EAAK,GACvC,EAEA3C,GAAS,UAAU,OAAS,SAAST,EAAGC,EAAMkB,EAAO,CACnD,IAAIxF,EAAG6H,EAEP,GAAI,KAAK,SAAU,CAIjB,IAHAA,EAAQ,GAAK,KAAK,SACdA,EAAOrC,IACTqC,EAAOrC,GACJxF,EAAI,EAAGA,EAAI6H,EAAM7H,IACpB,KAAK,OAAO,KAAK,SAAWA,CAAC,EAAIqE,EAAEC,EAAKtE,CAAC,EAI3C,GAHAwF,GAASqC,EACTvD,GAAQuD,EACR,KAAK,UAAYA,EACb,KAAK,SAAW,GAClB,OACF,KAAK,OAAO,KAAK,OAAQ,EAAG,EAAE,EAC9B,KAAK,SAAW,CAClB,CASA,GAPIrC,GAAS,KACXqC,EAAOrC,EAASA,EAAQ,GACxB,KAAK,OAAOnB,EAAGC,EAAMuD,CAAI,EACzBvD,GAAQuD,EACRrC,GAASqC,GAGPrC,EAAO,CACT,IAAKxF,EAAI,EAAGA,EAAIwF,EAAOxF,IACrB,KAAK,OAAO,KAAK,SAAWA,CAAC,EAAIqE,EAAEC,EAAKtE,CAAC,EAC3C,KAAK,UAAYwF,CACnB,CACF,EAEA,SAASsC,GAAmB/D,EAAKgE,EAAQ1D,EAAGC,EAAMnD,EAAGO,EAAG,CACtD,IAAIiD,EAAI,IAAIG,GAASpD,CAAC,EACtB,OAAAiD,EAAE,OAAON,EAAGC,EAAMnD,CAAC,EACnBwD,EAAE,OAAOZ,EAAKgE,CAAM,EACb,CACT,CAEA,SAASC,GAA0BjH,EAAGkH,EAAM5D,EAAGC,EAAMnD,EAAGO,EAAG,CACzD,IAAIZ,EAAI,IAAI,WAAW,EAAE,EACzB,OAAAgH,GAAmBhH,EAAE,EAAEuD,EAAEC,EAAKnD,EAAEO,CAAC,EAC1BL,EAAiBN,EAAEkH,EAAKnH,EAAE,CAAC,CACpC,CAEA,SAASoH,GAAiBvG,EAAE,EAAEP,EAAED,EAAEO,EAAG,CACnC,IAAI1B,EACJ,GAAIoB,EAAI,GAAI,MAAO,GAGnB,IAFAyD,GAAkBlD,EAAE,EAAE,EAAE,EAAEP,EAAED,EAAEO,CAAC,EAC/BoG,GAAmBnG,EAAG,GAAIA,EAAG,GAAIP,EAAI,GAAIO,CAAC,EACrC3B,EAAI,EAAGA,EAAI,GAAIA,IAAK2B,EAAE3B,CAAC,EAAI,EAChC,MAAO,EACT,CAEA,SAASmI,GAAsB9D,EAAE1C,EAAEP,EAAED,EAAEO,EAAG,CACxC,IAAI1B,EACAc,EAAI,IAAI,WAAW,EAAE,EAGzB,GAFIM,EAAI,KACRsD,GAAc5D,EAAE,EAAE,GAAGK,EAAEO,CAAC,EACpBsG,GAA0BrG,EAAG,GAAGA,EAAG,GAAGP,EAAI,GAAGN,CAAC,IAAM,GAAG,MAAO,GAElE,IADA+D,GAAkBR,EAAE,EAAE1C,EAAE,EAAEP,EAAED,EAAEO,CAAC,EAC1B1B,EAAI,EAAGA,EAAI,GAAIA,IAAKqE,EAAErE,CAAC,EAAI,EAChC,MAAO,EACT,CAEA,SAASoI,GAASnI,EAAGoI,EAAG,CACtB,IAAIrI,EACJ,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKC,EAAED,CAAC,EAAIqI,EAAErI,CAAC,EAAE,CACvC,CAEA,SAASsI,GAAS9G,EAAG,CACnB,IAAIxB,EAAGuI,EAAG5G,EAAI,EACd,IAAK3B,EAAI,EAAGA,EAAI,GAAIA,IAClBuI,EAAI/G,EAAExB,CAAC,EAAI2B,EAAI,MACfA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EACxB/G,EAAExB,CAAC,EAAIuI,EAAI5G,EAAI,MAEjBH,EAAE,CAAC,GAAKG,EAAE,EAAI,IAAMA,EAAE,EACxB,CAEA,SAAS6G,GAAS,EAAGC,EAAGhE,EAAG,CAEzB,QADIiE,EAAG/G,EAAI,EAAE8C,EAAE,GACNzE,EAAI,EAAGA,EAAI,GAAIA,IACtB0I,EAAI/G,GAAK,EAAE3B,CAAC,EAAIyI,EAAEzI,CAAC,GACnB,EAAEA,CAAC,GAAK0I,EACRD,EAAEzI,CAAC,GAAK0I,CAEZ,CAEA,SAASC,GAAUnH,EAAGL,EAAG,CACvB,IAAInB,EAAG4I,EAAG,EACNvE,EAAIvE,EAAG,EAAG4I,EAAI5I,EAAG,EACrB,IAAKE,EAAI,EAAGA,EAAI,GAAIA,IAAK0I,EAAE1I,CAAC,EAAImB,EAAEnB,CAAC,EAInC,IAHAsI,GAASI,CAAC,EACVJ,GAASI,CAAC,EACVJ,GAASI,CAAC,EACLE,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAEtB,IADAvE,EAAE,CAAC,EAAIqE,EAAE,CAAC,EAAI,MACT1I,EAAI,EAAGA,EAAI,GAAIA,IAClBqE,EAAErE,CAAC,EAAI0I,EAAE1I,CAAC,EAAI,OAAWqE,EAAErE,EAAE,CAAC,GAAG,GAAM,GACvCqE,EAAErE,EAAE,CAAC,GAAK,MAEZqE,EAAE,EAAE,EAAIqE,EAAE,EAAE,EAAI,OAAWrE,EAAE,EAAE,GAAG,GAAM,GACxC,EAAKA,EAAE,EAAE,GAAG,GAAM,EAClBA,EAAE,EAAE,GAAK,MACTmE,GAASE,EAAGrE,EAAG,EAAE,CAAC,CACpB,CACA,IAAKrE,EAAI,EAAGA,EAAI,GAAIA,IAClBwB,EAAE,EAAExB,CAAC,EAAI0I,EAAE1I,CAAC,EAAI,IAChBwB,EAAE,EAAExB,EAAE,CAAC,EAAI0I,EAAE1I,CAAC,GAAG,CAErB,CAEA,SAAS6I,GAASR,EAAG5D,EAAG,CACtB,IAAI9C,EAAI,IAAI,WAAW,EAAE,EAAGP,EAAI,IAAI,WAAW,EAAE,EACjD,OAAAuH,GAAUhH,EAAG0G,CAAC,EACdM,GAAUvH,EAAGqD,CAAC,EACPnD,EAAiBK,EAAG,EAAGP,EAAG,CAAC,CACpC,CAEA,SAAS0H,GAAST,EAAG,CACnB,IAAIjH,EAAI,IAAI,WAAW,EAAE,EACzB,OAAAuH,GAAUvH,EAAGiH,CAAC,EACPjH,EAAE,CAAC,EAAI,CAChB,CAEA,SAAS2H,EAAYvH,EAAGL,EAAG,CACzB,IAAInB,EACJ,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKwB,EAAExB,CAAC,EAAImB,EAAE,EAAEnB,CAAC,GAAKmB,EAAE,EAAEnB,EAAE,CAAC,GAAK,GACtDwB,EAAE,EAAE,GAAK,KACX,CAEA,SAASwH,EAAExH,EAAG6G,EAAG5D,EAAG,CAClB,QAASzE,EAAI,EAAGA,EAAI,GAAIA,IAAKwB,EAAExB,CAAC,EAAIqI,EAAErI,CAAC,EAAIyE,EAAEzE,CAAC,CAChD,CAEA,SAASiJ,EAAEzH,EAAG6G,EAAG5D,EAAG,CAClB,QAASzE,EAAI,EAAGA,EAAI,GAAIA,IAAKwB,EAAExB,CAAC,EAAIqI,EAAErI,CAAC,EAAIyE,EAAEzE,CAAC,CAChD,CAEA,SAASkJ,EAAE1H,EAAG6G,EAAG5D,EAAG,CAClB,IAAI8D,EAAG5G,EACJqD,EAAK,EAAIC,EAAK,EAAIC,EAAK,EAAIC,EAAK,EAAIC,GAAK,EAAIC,EAAK,EAAIC,GAAK,EAAIC,GAAK,EACpE4D,GAAK,EAAIC,GAAK,EAAGC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EACrEC,GAAM,EAAGC,EAAM,EAAGC,GAAM,EAAGC,GAAM,EAAGC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EACrEC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EAAGC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EAC5DC,EAAKjG,EAAE,CAAC,EACRkG,GAAKlG,EAAE,CAAC,EACRmG,GAAKnG,EAAE,CAAC,EACRoG,GAAKpG,EAAE,CAAC,EACRqG,GAAKrG,EAAE,CAAC,EACRsG,GAAKtG,EAAE,CAAC,EACRuG,GAAKvG,EAAE,CAAC,EACRwG,GAAKxG,EAAE,CAAC,EACRyG,GAAKzG,EAAE,CAAC,EACR0G,GAAK1G,EAAE,CAAC,EACR2G,GAAM3G,EAAE,EAAE,EACV4G,GAAM5G,EAAE,EAAE,EACV6G,GAAM7G,EAAE,EAAE,EACV8G,GAAM9G,EAAE,EAAE,EACV+G,GAAM/G,EAAE,EAAE,EACVgH,GAAMhH,EAAE,EAAE,EAEZ8D,EAAIF,EAAE,CAAC,EACPrD,GAAMuD,EAAImC,EACVzF,GAAMsD,EAAIoC,GACVzF,GAAMqD,EAAIqC,GACVzF,GAAMoD,EAAIsC,GACVzF,IAAMmD,EAAIuC,GACVzF,GAAMkD,EAAIwC,GACVzF,IAAMiD,EAAIyC,GACVzF,IAAMgD,EAAI0C,GACV9B,IAAMZ,EAAI2C,GACV9B,IAAMb,EAAI4C,GACV9B,IAAOd,EAAI6C,GACX9B,IAAOf,EAAI8C,GACX9B,IAAOhB,EAAI+C,GACX9B,IAAOjB,EAAIgD,GACX9B,IAAOlB,EAAIiD,GACX9B,IAAOnB,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACPpD,GAAMsD,EAAImC,EACVxF,GAAMqD,EAAIoC,GACVxF,GAAMoD,EAAIqC,GACVxF,IAAMmD,EAAIsC,GACVxF,GAAMkD,EAAIuC,GACVxF,IAAMiD,EAAIwC,GACVxF,IAAMgD,EAAIyC,GACV7B,IAAMZ,EAAI0C,GACV7B,IAAMb,EAAI2C,GACV7B,IAAOd,EAAI4C,GACX7B,IAAOf,EAAI6C,GACX7B,IAAOhB,EAAI8C,GACX7B,IAAOjB,EAAI+C,GACX7B,IAAOlB,EAAIgD,GACX7B,IAAOnB,EAAIiD,GACX7B,IAAOpB,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACPnD,GAAMqD,EAAImC,EACVvF,GAAMoD,EAAIoC,GACVvF,IAAMmD,EAAIqC,GACVvF,GAAMkD,EAAIsC,GACVvF,IAAMiD,EAAIuC,GACVvF,IAAMgD,EAAIwC,GACV5B,IAAMZ,EAAIyC,GACV5B,IAAMb,EAAI0C,GACV5B,IAAOd,EAAI2C,GACX5B,IAAOf,EAAI4C,GACX5B,IAAOhB,EAAI6C,GACX5B,IAAOjB,EAAI8C,GACX5B,IAAOlB,EAAI+C,GACX5B,IAAOnB,EAAIgD,GACX5B,IAAOpB,EAAIiD,GACX5B,GAAOrB,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACPlD,GAAMoD,EAAImC,EACVtF,IAAMmD,EAAIoC,GACVtF,GAAMkD,EAAIqC,GACVtF,IAAMiD,EAAIsC,GACVtF,IAAMgD,EAAIuC,GACV3B,IAAMZ,EAAIwC,GACV3B,IAAMb,EAAIyC,GACV3B,IAAOd,EAAI0C,GACX3B,IAAOf,EAAI2C,GACX3B,IAAOhB,EAAI4C,GACX3B,IAAOjB,EAAI6C,GACX3B,IAAOlB,EAAI8C,GACX3B,IAAOnB,EAAI+C,GACX3B,IAAOpB,EAAIgD,GACX3B,GAAOrB,EAAIiD,GACX3B,IAAOtB,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACPjD,IAAMmD,EAAImC,EACVrF,GAAMkD,EAAIoC,GACVrF,IAAMiD,EAAIqC,GACVrF,IAAMgD,EAAIsC,GACV1B,IAAMZ,EAAIuC,GACV1B,IAAMb,EAAIwC,GACV1B,IAAOd,EAAIyC,GACX1B,IAAOf,EAAI0C,GACX1B,IAAOhB,EAAI2C,GACX1B,IAAOjB,EAAI4C,GACX1B,IAAOlB,EAAI6C,GACX1B,IAAOnB,EAAI8C,GACX1B,IAAOpB,EAAI+C,GACX1B,GAAOrB,EAAIgD,GACX1B,IAAOtB,EAAIiD,GACX1B,IAAOvB,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACPhD,GAAMkD,EAAImC,EACVpF,IAAMiD,EAAIoC,GACVpF,IAAMgD,EAAIqC,GACVzB,IAAMZ,EAAIsC,GACVzB,IAAMb,EAAIuC,GACVzB,IAAOd,EAAIwC,GACXzB,IAAOf,EAAIyC,GACXzB,IAAOhB,EAAI0C,GACXzB,IAAOjB,EAAI2C,GACXzB,IAAOlB,EAAI4C,GACXzB,IAAOnB,EAAI6C,GACXzB,IAAOpB,EAAI8C,GACXzB,GAAOrB,EAAI+C,GACXzB,IAAOtB,EAAIgD,GACXzB,IAAOvB,EAAIiD,GACXzB,GAAOxB,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACP/C,IAAMiD,EAAImC,EACVnF,IAAMgD,EAAIoC,GACVxB,IAAMZ,EAAIqC,GACVxB,IAAMb,EAAIsC,GACVxB,IAAOd,EAAIuC,GACXxB,IAAOf,EAAIwC,GACXxB,IAAOhB,EAAIyC,GACXxB,IAAOjB,EAAI0C,GACXxB,IAAOlB,EAAI2C,GACXxB,IAAOnB,EAAI4C,GACXxB,IAAOpB,EAAI6C,GACXxB,GAAOrB,EAAI8C,GACXxB,IAAOtB,EAAI+C,GACXxB,IAAOvB,EAAIgD,GACXxB,GAAOxB,EAAIiD,GACXxB,GAAOzB,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACP9C,IAAMgD,EAAImC,EACVvB,IAAMZ,EAAIoC,GACVvB,IAAMb,EAAIqC,GACVvB,IAAOd,EAAIsC,GACXvB,IAAOf,EAAIuC,GACXvB,IAAOhB,EAAIwC,GACXvB,IAAOjB,EAAIyC,GACXvB,IAAOlB,EAAI0C,GACXvB,IAAOnB,EAAI2C,GACXvB,IAAOpB,EAAI4C,GACXvB,GAAOrB,EAAI6C,GACXvB,IAAOtB,EAAI8C,GACXvB,IAAOvB,EAAI+C,GACXvB,GAAOxB,EAAIgD,GACXvB,GAAOzB,EAAIiD,GACXvB,GAAO1B,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACPc,IAAMZ,EAAImC,EACVtB,IAAMb,EAAIoC,GACVtB,IAAOd,EAAIqC,GACXtB,IAAOf,EAAIsC,GACXtB,IAAOhB,EAAIuC,GACXtB,IAAOjB,EAAIwC,GACXtB,IAAOlB,EAAIyC,GACXtB,IAAOnB,EAAI0C,GACXtB,IAAOpB,EAAI2C,GACXtB,GAAOrB,EAAI4C,GACXtB,IAAOtB,EAAI6C,GACXtB,IAAOvB,EAAI8C,GACXtB,GAAOxB,EAAI+C,GACXtB,GAAOzB,EAAIgD,GACXtB,GAAO1B,EAAIiD,GACXtB,GAAO3B,EAAIkD,GACXlD,EAAIF,EAAE,CAAC,EACPe,IAAMb,EAAImC,EACVrB,IAAOd,EAAIoC,GACXrB,IAAOf,EAAIqC,GACXrB,IAAOhB,EAAIsC,GACXrB,IAAOjB,EAAIuC,GACXrB,IAAOlB,EAAIwC,GACXrB,IAAOnB,EAAIyC,GACXrB,IAAOpB,EAAI0C,GACXrB,GAAOrB,EAAI2C,GACXrB,IAAOtB,EAAI4C,GACXrB,IAAOvB,EAAI6C,GACXrB,GAAOxB,EAAI8C,GACXrB,GAAOzB,EAAI+C,GACXrB,GAAO1B,EAAIgD,GACXrB,GAAO3B,EAAIiD,GACXrB,GAAO5B,EAAIkD,GACXlD,EAAIF,EAAE,EAAE,EACRgB,IAAOd,EAAImC,EACXpB,IAAOf,EAAIoC,GACXpB,IAAOhB,EAAIqC,GACXpB,IAAOjB,EAAIsC,GACXpB,IAAOlB,EAAIuC,GACXpB,IAAOnB,EAAIwC,GACXpB,IAAOpB,EAAIyC,GACXpB,GAAOrB,EAAI0C,GACXpB,IAAOtB,EAAI2C,GACXpB,IAAOvB,EAAI4C,GACXpB,GAAOxB,EAAI6C,GACXpB,GAAOzB,EAAI8C,GACXpB,GAAO1B,EAAI+C,GACXpB,GAAO3B,EAAIgD,GACXpB,GAAO5B,EAAIiD,GACXpB,GAAO7B,EAAIkD,GACXlD,EAAIF,EAAE,EAAE,EACRiB,IAAOf,EAAImC,EACXnB,IAAOhB,EAAIoC,GACXnB,IAAOjB,EAAIqC,GACXnB,IAAOlB,EAAIsC,GACXnB,IAAOnB,EAAIuC,GACXnB,IAAOpB,EAAIwC,GACXnB,GAAOrB,EAAIyC,GACXnB,IAAOtB,EAAI0C,GACXnB,IAAOvB,EAAI2C,GACXnB,GAAOxB,EAAI4C,GACXnB,GAAOzB,EAAI6C,GACXnB,GAAO1B,EAAI8C,GACXnB,GAAO3B,EAAI+C,GACXnB,GAAO5B,EAAIgD,GACXnB,GAAO7B,EAAIiD,GACXnB,GAAO9B,EAAIkD,GACXlD,EAAIF,EAAE,EAAE,EACRkB,IAAOhB,EAAImC,EACXlB,IAAOjB,EAAIoC,GACXlB,IAAOlB,EAAIqC,GACXlB,IAAOnB,EAAIsC,GACXlB,IAAOpB,EAAIuC,GACXlB,GAAOrB,EAAIwC,GACXlB,IAAOtB,EAAIyC,GACXlB,IAAOvB,EAAI0C,GACXlB,GAAOxB,EAAI2C,GACXlB,GAAOzB,EAAI4C,GACXlB,GAAO1B,EAAI6C,GACXlB,GAAO3B,EAAI8C,GACXlB,GAAO5B,EAAI+C,GACXlB,GAAO7B,EAAIgD,GACXlB,GAAO9B,EAAIiD,GACXlB,IAAO/B,EAAIkD,GACXlD,EAAIF,EAAE,EAAE,EACRmB,IAAOjB,EAAImC,EACXjB,IAAOlB,EAAIoC,GACXjB,IAAOnB,EAAIqC,GACXjB,IAAOpB,EAAIsC,GACXjB,GAAOrB,EAAIuC,GACXjB,IAAOtB,EAAIwC,GACXjB,IAAOvB,EAAIyC,GACXjB,GAAOxB,EAAI0C,GACXjB,GAAOzB,EAAI2C,GACXjB,GAAO1B,EAAI4C,GACXjB,GAAO3B,EAAI6C,GACXjB,GAAO5B,EAAI8C,GACXjB,GAAO7B,EAAI+C,GACXjB,GAAO9B,EAAIgD,GACXjB,IAAO/B,EAAIiD,GACXjB,IAAOhC,EAAIkD,GACXlD,EAAIF,EAAE,EAAE,EACRoB,IAAOlB,EAAImC,EACXhB,IAAOnB,EAAIoC,GACXhB,IAAOpB,EAAIqC,GACXhB,GAAOrB,EAAIsC,GACXhB,IAAOtB,EAAIuC,GACXhB,IAAOvB,EAAIwC,GACXhB,GAAOxB,EAAIyC,GACXhB,GAAOzB,EAAI0C,GACXhB,GAAO1B,EAAI2C,GACXhB,GAAO3B,EAAI4C,GACXhB,GAAO5B,EAAI6C,GACXhB,GAAO7B,EAAI8C,GACXhB,GAAO9B,EAAI+C,GACXhB,IAAO/B,EAAIgD,GACXhB,IAAOhC,EAAIiD,GACXhB,IAAOjC,EAAIkD,GACXlD,EAAIF,EAAE,EAAE,EACRqB,IAAOnB,EAAImC,EACXf,IAAOpB,EAAIoC,GACXf,GAAOrB,EAAIqC,GACXf,IAAOtB,EAAIsC,GACXf,IAAOvB,EAAIuC,GACXf,GAAOxB,EAAIwC,GACXf,GAAOzB,EAAIyC,GACXf,GAAO1B,EAAI0C,GACXf,GAAO3B,EAAI2C,GACXf,GAAO5B,EAAI4C,GACXf,GAAO7B,EAAI6C,GACXf,GAAO9B,EAAI8C,GACXf,IAAO/B,EAAI+C,GACXf,IAAOhC,EAAIgD,GACXf,IAAOjC,EAAIiD,GACXf,IAAOlC,EAAIkD,GAEXzG,GAAO,GAAK2E,GACZ1E,GAAO,GAAK2E,EACZ1E,GAAO,GAAK2E,GACZ1E,GAAO,GAAK2E,GACZ1E,IAAO,GAAK2E,EACZ1E,GAAO,GAAK2E,EACZ1E,IAAO,GAAK2E,EACZ1E,IAAO,GAAK2E,EACZf,IAAO,GAAKgB,EACZf,IAAO,GAAKgB,EACZf,IAAO,GAAKgB,EACZf,IAAO,GAAKgB,GACZf,IAAO,GAAKgB,GACZf,IAAO,GAAKgB,GACZf,IAAO,GAAKgB,GAIZ9I,EAAI,EACJ4G,EAAKvD,EAAKrD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIvD,EAAKuD,EAAI5G,EAAI,MAC9D4G,EAAKtD,EAAKtD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAItD,EAAKsD,EAAI5G,EAAI,MAC9D4G,EAAKrD,EAAKvD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIrD,EAAKqD,EAAI5G,EAAI,MAC9D4G,EAAKpD,EAAKxD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIpD,EAAKoD,EAAI5G,EAAI,MAC9D4G,EAAKnD,GAAKzD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAInD,GAAKmD,EAAI5G,EAAI,MAC9D4G,EAAKlD,EAAK1D,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIlD,EAAKkD,EAAI5G,EAAI,MAC9D4G,EAAKjD,GAAK3D,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIjD,GAAKiD,EAAI5G,EAAI,MAC9D4G,EAAKhD,GAAK5D,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIhD,GAAKgD,EAAI5G,EAAI,MAC9D4G,EAAKY,GAAKxH,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIY,GAAKZ,EAAI5G,EAAI,MAC9D4G,EAAKa,GAAKzH,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIa,GAAKb,EAAI5G,EAAI,MAC9D4G,EAAIc,GAAM1H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGc,GAAMd,EAAI5G,EAAI,MAC9D4G,EAAIe,GAAM3H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGe,GAAMf,EAAI5G,EAAI,MAC9D4G,EAAIgB,GAAM5H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGgB,GAAMhB,EAAI5G,EAAI,MAC9D4G,EAAIiB,GAAM7H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGiB,GAAMjB,EAAI5G,EAAI,MAC9D4G,EAAIkB,GAAM9H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGkB,GAAMlB,EAAI5G,EAAI,MAC9D4G,EAAImB,GAAM/H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGmB,GAAMnB,EAAI5G,EAAI,MAC9DqD,GAAMrD,EAAE,EAAI,IAAMA,EAAE,GAGpBA,EAAI,EACJ4G,EAAKvD,EAAKrD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIvD,EAAKuD,EAAI5G,EAAI,MAC9D4G,EAAKtD,EAAKtD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAItD,EAAKsD,EAAI5G,EAAI,MAC9D4G,EAAKrD,EAAKvD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIrD,EAAKqD,EAAI5G,EAAI,MAC9D4G,EAAKpD,EAAKxD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIpD,EAAKoD,EAAI5G,EAAI,MAC9D4G,EAAKnD,GAAKzD,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAInD,GAAKmD,EAAI5G,EAAI,MAC9D4G,EAAKlD,EAAK1D,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIlD,EAAKkD,EAAI5G,EAAI,MAC9D4G,EAAKjD,GAAK3D,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIjD,GAAKiD,EAAI5G,EAAI,MAC9D4G,EAAKhD,GAAK5D,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIhD,GAAKgD,EAAI5G,EAAI,MAC9D4G,EAAKY,GAAKxH,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIY,GAAKZ,EAAI5G,EAAI,MAC9D4G,EAAKa,GAAKzH,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAIa,GAAKb,EAAI5G,EAAI,MAC9D4G,EAAIc,GAAM1H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGc,GAAMd,EAAI5G,EAAI,MAC9D4G,EAAIe,GAAM3H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGe,GAAMf,EAAI5G,EAAI,MAC9D4G,EAAIgB,GAAM5H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGgB,GAAMhB,EAAI5G,EAAI,MAC9D4G,EAAIiB,GAAM7H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGiB,GAAMjB,EAAI5G,EAAI,MAC9D4G,EAAIkB,GAAM9H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGkB,GAAMlB,EAAI5G,EAAI,MAC9D4G,EAAImB,GAAM/H,EAAI,MAAOA,EAAI,KAAK,MAAM4G,EAAI,KAAK,EAAGmB,GAAMnB,EAAI5G,EAAI,MAC9DqD,GAAMrD,EAAE,EAAI,IAAMA,EAAE,GAEpBH,EAAG,CAAC,EAAIwD,EACRxD,EAAG,CAAC,EAAIyD,EACRzD,EAAG,CAAC,EAAI0D,EACR1D,EAAG,CAAC,EAAI2D,EACR3D,EAAG,CAAC,EAAI4D,GACR5D,EAAG,CAAC,EAAI6D,EACR7D,EAAG,CAAC,EAAI8D,GACR9D,EAAG,CAAC,EAAI+D,GACR/D,EAAG,CAAC,EAAI2H,GACR3H,EAAG,CAAC,EAAI4H,GACR5H,EAAE,EAAE,EAAI6H,GACR7H,EAAE,EAAE,EAAI8H,GACR9H,EAAE,EAAE,EAAI+H,GACR/H,EAAE,EAAE,EAAIgI,GACRhI,EAAE,EAAE,EAAIiI,GACRjI,EAAE,EAAE,EAAIkI,EACV,CAEA,SAASgC,GAAElK,EAAG6G,EAAG,CACfa,EAAE1H,EAAG6G,EAAGA,CAAC,CACX,CAEA,SAASsD,GAASnK,EAAGxB,EAAG,CACtB,IAAI2B,EAAI7B,EAAG,EACPuI,EACJ,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAK1G,EAAE0G,CAAC,EAAIrI,EAAEqI,CAAC,EACnC,IAAKA,EAAI,IAAKA,GAAK,EAAGA,IACpBqD,GAAE/J,EAAGA,CAAC,EACH0G,IAAM,GAAKA,IAAM,GAAGa,EAAEvH,EAAGA,EAAG3B,CAAC,EAElC,IAAKqI,EAAI,EAAGA,EAAI,GAAIA,IAAK7G,EAAE6G,CAAC,EAAI1G,EAAE0G,CAAC,CACrC,CAEA,SAASuD,GAAQpK,EAAGxB,EAAG,CACrB,IAAI2B,EAAI7B,EAAG,EACPuI,EACJ,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAK1G,EAAE0G,CAAC,EAAIrI,EAAEqI,CAAC,EACnC,IAAKA,EAAI,IAAKA,GAAK,EAAGA,IAClBqD,GAAE/J,EAAGA,CAAC,EACH0G,IAAM,GAAGa,EAAEvH,EAAGA,EAAG3B,CAAC,EAEzB,IAAKqI,EAAI,EAAGA,EAAI,GAAIA,IAAK7G,EAAE6G,CAAC,EAAI1G,EAAE0G,CAAC,CACrC,CAEA,SAASwD,GAAkBpD,EAAGtH,EAAGM,EAAG,CAClC,IAAI8C,EAAI,IAAI,WAAW,EAAE,EACrBzD,EAAI,IAAI,aAAa,EAAE,EAAGb,EAAGD,EAC7BqI,EAAIvI,EAAG,EAAG2E,EAAI3E,EAAG,EAAG6B,GAAI7B,EAAG,EAC3BsB,EAAItB,EAAG,EAAGgM,GAAIhM,EAAG,EAAG8H,GAAI9H,EAAG,EAC/B,IAAKE,EAAI,EAAGA,EAAI,GAAIA,IAAKuE,EAAEvE,CAAC,EAAImB,EAAEnB,CAAC,EAInC,IAHAuE,EAAE,EAAE,EAAGpD,EAAE,EAAE,EAAE,IAAK,GAClBoD,EAAE,CAAC,GAAG,IACNwE,EAAYjI,EAAEW,CAAC,EACVzB,EAAI,EAAGA,EAAI,GAAIA,IAClByE,EAAEzE,CAAC,EAAEc,EAAEd,CAAC,EACRoB,EAAEpB,CAAC,EAAEqI,EAAErI,CAAC,EAAE2B,GAAE3B,CAAC,EAAE,EAGjB,IADAqI,EAAE,CAAC,EAAEjH,EAAE,CAAC,EAAE,EACLpB,EAAE,IAAKA,GAAG,EAAG,EAAEA,EAClBC,EAAGsE,EAAEvE,IAAI,CAAC,KAAKA,EAAE,GAAI,EACrBwI,GAASH,EAAE5D,EAAExE,CAAC,EACduI,GAAS7G,GAAEP,EAAEnB,CAAC,EACd+I,EAAE8C,GAAEzD,EAAE1G,EAAC,EACPsH,EAAEZ,EAAEA,EAAE1G,EAAC,EACPqH,EAAErH,GAAE8C,EAAErD,CAAC,EACP6H,EAAExE,EAAEA,EAAErD,CAAC,EACPsK,GAAEtK,EAAE0K,EAAC,EACLJ,GAAE9D,GAAES,CAAC,EACLa,EAAEb,EAAE1G,GAAE0G,CAAC,EACPa,EAAEvH,GAAE8C,EAAEqH,EAAC,EACP9C,EAAE8C,GAAEzD,EAAE1G,EAAC,EACPsH,EAAEZ,EAAEA,EAAE1G,EAAC,EACP+J,GAAEjH,EAAE4D,CAAC,EACLY,EAAEtH,GAAEP,EAAEwG,EAAC,EACPsB,EAAEb,EAAE1G,GAAEpB,CAAO,EACbyI,EAAEX,EAAEA,EAAEjH,CAAC,EACP8H,EAAEvH,GAAEA,GAAE0G,CAAC,EACPa,EAAEb,EAAEjH,EAAEwG,EAAC,EACPsB,EAAE9H,EAAEqD,EAAE3D,CAAC,EACP4K,GAAEjH,EAAEqH,EAAC,EACLtD,GAASH,EAAE5D,EAAExE,CAAC,EACduI,GAAS7G,GAAEP,EAAEnB,CAAC,EAEhB,IAAKD,EAAI,EAAGA,EAAI,GAAIA,IAClBc,EAAEd,EAAE,EAAE,EAAEqI,EAAErI,CAAC,EACXc,EAAEd,EAAE,EAAE,EAAE2B,GAAE3B,CAAC,EACXc,EAAEd,EAAE,EAAE,EAAEyE,EAAEzE,CAAC,EACXc,EAAEd,EAAE,EAAE,EAAEoB,EAAEpB,CAAC,EAEb,IAAI+L,GAAMjL,EAAE,SAAS,EAAE,EACnBkL,GAAMlL,EAAE,SAAS,EAAE,EACvB,OAAA6K,GAASI,GAAIA,EAAG,EAChB7C,EAAE8C,GAAIA,GAAID,EAAG,EACbpD,GAAUF,EAAEuD,EAAG,EACR,CACT,CAEA,SAASC,GAAuBxD,EAAGtH,EAAG,CACpC,OAAO0K,GAAkBpD,EAAGtH,EAAGf,CAAE,CACnC,CAEA,SAAS8L,GAAmBC,EAAGrL,EAAG,CAChC,OAAAZ,EAAYY,EAAG,EAAE,EACVmL,GAAuBE,EAAGrL,CAAC,CACpC,CAEA,SAASsL,GAAoB1K,EAAGyK,EAAGrL,EAAG,CACpC,IAAI6D,EAAI,IAAI,WAAW,EAAE,EACzB,OAAAkH,GAAkBlH,EAAG7D,EAAGqL,CAAC,EAClBlI,EAAqBvC,EAAGvB,EAAIwE,EAAGT,CAAK,CAC7C,CAEA,IAAImI,GAAqBnE,GACrBoE,GAA0BnE,GAE9B,SAASoE,GAAW5K,EAAG,EAAGP,EAAGD,EAAGgL,EAAGrL,EAAG,CACpC,IAAIY,EAAI,IAAI,WAAW,EAAE,EACzB,OAAA0K,GAAoB1K,EAAGyK,EAAGrL,CAAC,EACpBuL,GAAmB1K,EAAG,EAAGP,EAAGD,EAAGO,CAAC,CACzC,CAEA,SAAS8K,GAAgBnI,EAAG1C,EAAGP,EAAGD,EAAGgL,EAAGrL,EAAG,CACzC,IAAIY,EAAI,IAAI,WAAW,EAAE,EACzB,OAAA0K,GAAoB1K,EAAGyK,EAAGrL,CAAC,EACpBwL,GAAwBjI,EAAG1C,EAAGP,EAAGD,EAAGO,CAAC,CAC9C,CAEA,IAAI+K,GAAI,CACN,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,WACpC,UAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,UAAY,WACpC,UAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,UAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,UAAY,WAAY,UAAY,WACpC,UAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,UAAY,WAAY,UAAY,UACpC,UAAY,WAAY,UAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,UAAY,UACpC,UAAY,WAAY,UAAY,WACpC,UAAY,WAAY,UAAY,WACpC,UAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,UAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,WAAY,WAAY,UACpC,WAAY,WAAY,WAAY,WACpC,UAAY,WAAY,UAAY,WACpC,UAAY,WAAY,UAAY,UACpC,UAAY,UAAY,UAAY,WACpC,WAAY,UAAY,WAAY,WACpC,WAAY,WAAY,WAAY,WACpC,WAAY,UAAY,WAAY,UACtC,EAEA,SAASC,GAAqBC,EAAIC,EAAIvI,EAAGlD,EAAG,CAyB1C,QAxBI0L,EAAK,IAAI,WAAW,EAAE,EAAGC,EAAK,IAAI,WAAW,EAAE,EAC/CC,EAAKC,EAAKC,EAAKC,GAAKC,EAAKC,GAAKC,GAAKC,GACnCC,GAAKC,GAAKC,GAAKC,GAAKC,GAAKC,GAAKC,GAAKC,GACnCC,EAAIC,GAAIhO,GAAG4I,EAAG7H,EAAGkN,EAAG5F,EAAG5D,EAAG9C,EAAGP,EAE7B8M,GAAMvB,EAAG,CAAC,EACVwB,GAAMxB,EAAG,CAAC,EACVyB,GAAMzB,EAAG,CAAC,EACV0B,GAAM1B,EAAG,CAAC,EACV2B,EAAM3B,EAAG,CAAC,EACV4B,GAAM5B,EAAG,CAAC,EACV6B,GAAM7B,EAAG,CAAC,EACV8B,GAAM9B,EAAG,CAAC,EAEV+B,GAAM9B,EAAG,CAAC,EACV+B,GAAM/B,EAAG,CAAC,EACVgC,GAAMhC,EAAG,CAAC,EACViC,GAAMjC,EAAG,CAAC,EACVkC,GAAMlC,EAAG,CAAC,EACVmC,GAAMnC,EAAG,CAAC,EACVoC,GAAMpC,EAAG,CAAC,EACVqC,GAAMrC,EAAG,CAAC,EAEVsC,GAAM,EACH/N,GAAK,KAAK,CACf,IAAKnB,GAAI,EAAGA,GAAI,GAAIA,KAClB4I,EAAI,EAAI5I,GAAIkP,GACZrC,EAAG7M,EAAC,EAAKqE,EAAEuE,EAAE,CAAC,GAAK,GAAOvE,EAAEuE,EAAE,CAAC,GAAK,GAAOvE,EAAEuE,EAAE,CAAC,GAAK,EAAKvE,EAAEuE,EAAE,CAAC,EAC/DkE,EAAG9M,EAAC,EAAKqE,EAAEuE,EAAE,CAAC,GAAK,GAAOvE,EAAEuE,EAAE,CAAC,GAAK,GAAOvE,EAAEuE,EAAE,CAAC,GAAK,EAAKvE,EAAEuE,EAAE,CAAC,EAEjE,IAAK5I,GAAI,EAAGA,GAAI,GAAIA,KA+HlB,GA9HA+M,EAAMmB,GACNlB,EAAMmB,GACNlB,EAAMmB,GACNlB,GAAMmB,GACNlB,EAAMmB,EACNlB,GAAMmB,GACNlB,GAAMmB,GACNlB,GAAMmB,GAENlB,GAAMmB,GACNlB,GAAMmB,GACNlB,GAAMmB,GACNlB,GAAMmB,GACNlB,GAAMmB,GACNlB,GAAMmB,GACNlB,GAAMmB,GACNlB,GAAMmB,GAGNlO,EAAI0N,GACJR,EAAIgB,GAEJ5G,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAG1BA,GAAMuN,IAAQ,GAAOQ,IAAQ,KAAaR,IAAQ,GAAOQ,IAAQ,KAAaA,KAAS,EAAWR,GAAQ,IAC1GL,GAAMa,KAAQ,GAAOR,GAAQ,KAAaQ,KAAQ,GAAOR,GAAQ,KAAaA,IAAS,EAAWQ,IAAQ,IAE1GzG,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAG5BA,EAAKuN,EAAMC,GAAQ,CAACD,EAAME,GAC1BP,EAAKa,GAAMC,GAAQ,CAACD,GAAME,GAE1B3G,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAG5BA,EAAI0L,GAAEzM,GAAE,CAAC,EACTiO,EAAIxB,GAAEzM,GAAE,EAAE,CAAC,EAEXqI,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAG5BA,EAAI8L,EAAG7M,GAAE,EAAE,EACXiO,EAAInB,EAAG9M,GAAE,EAAE,EAEXqI,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXoM,EAAKpM,EAAI,MAASP,GAAK,GACvB4M,GAAK3F,EAAI,MAAS5D,GAAK,GAGvB1D,EAAIgN,EACJE,EAAID,GAEJ3F,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAG1BA,GAAMmN,KAAQ,GAAOQ,IAAQ,IAAaA,KAAS,EAAWR,IAAQ,KAAkBQ,KAAS,EAAWR,IAAQ,IACpHD,GAAMS,KAAQ,GAAOR,IAAQ,IAAaA,KAAS,EAAWQ,IAAQ,KAAkBR,KAAS,EAAWQ,IAAQ,IAEpHrG,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAG5BA,EAAKmN,GAAMC,GAAQD,GAAME,GAAQD,GAAMC,GACvCH,EAAKS,GAAMC,GAAQD,GAAME,GAAQD,GAAMC,GAEvCvG,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEX2L,GAAO3L,EAAI,MAAWP,GAAK,GAC3B0M,GAAOzF,EAAI,MAAW5D,GAAK,GAG3B1D,EAAImM,GACJe,EAAIP,GAEJrF,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAIgN,EACJE,EAAID,GAEJ3F,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXuL,GAAOvL,EAAI,MAAWP,GAAK,GAC3BsM,GAAOrF,EAAI,MAAW5D,GAAK,GAE3B0J,GAAMpB,EACNqB,GAAMpB,EACNqB,GAAMpB,EACNqB,EAAMpB,GACNqB,GAAMpB,EACNqB,GAAMpB,GACNqB,GAAMpB,GACNa,GAAMZ,GAENqB,GAAMpB,GACNqB,GAAMpB,GACNqB,GAAMpB,GACNqB,GAAMpB,GACNqB,GAAMpB,GACNqB,GAAMpB,GACNqB,GAAMpB,GACNa,GAAMZ,GAEF9N,GAAE,KAAO,GACX,IAAK4I,EAAI,EAAGA,EAAI,GAAIA,IAElB7H,EAAI8L,EAAGjE,CAAC,EACRqF,EAAInB,EAAGlE,CAAC,EAERP,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI8L,GAAIjE,EAAE,GAAG,EAAE,EACfqF,EAAInB,GAAIlE,EAAE,GAAG,EAAE,EAEfP,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAG5BgN,EAAKlB,GAAIjE,EAAE,GAAG,EAAE,EAChBoF,GAAKlB,GAAIlE,EAAE,GAAG,EAAE,EAChB7H,GAAMgN,IAAO,EAAMC,IAAO,KAAYD,IAAO,EAAMC,IAAO,IAAWD,IAAO,EAC5EE,GAAMD,KAAO,EAAMD,GAAO,KAAYC,KAAO,EAAMD,GAAO,KAAYC,KAAO,EAAMD,GAAO,IAE1F1F,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAG5BgN,EAAKlB,GAAIjE,EAAE,IAAI,EAAE,EACjBoF,GAAKlB,GAAIlE,EAAE,IAAI,EAAE,EACjB7H,GAAMgN,IAAO,GAAOC,IAAO,KAAaA,KAAQ,GAAWD,GAAO,GAAiBA,IAAO,EAC1FE,GAAMD,KAAO,GAAOD,GAAO,KAAaA,IAAQ,GAAWC,IAAO,IAAkBA,KAAO,EAAMD,GAAO,IAExG1F,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXkL,EAAGjE,CAAC,EAAKjH,EAAI,MAAWP,GAAK,GAC7B0L,EAAGlE,CAAC,EAAKP,EAAI,MAAW5D,GAAK,GAMnC1D,EAAImN,GACJD,EAAIS,GAEJrG,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAIuB,GAAOvM,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAI8B,GAAOrG,EAAI,MAAW5D,GAAK,GAEnC1D,EAAIoN,GACJF,EAAIU,GAEJtG,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAIwB,GAAOxM,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAI+B,GAAOtG,EAAI,MAAW5D,GAAK,GAEnC1D,EAAIqN,GACJH,EAAIW,GAEJvG,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAIyB,GAAOzM,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAIgC,GAAOvG,EAAI,MAAW5D,GAAK,GAEnC1D,EAAIsN,GACJJ,EAAIY,GAEJxG,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAI0B,GAAO1M,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAIiC,GAAOxG,EAAI,MAAW5D,GAAK,GAEnC1D,EAAIuN,EACJL,EAAIa,GAEJzG,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAI2B,EAAO3M,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAIkC,GAAOzG,EAAI,MAAW5D,GAAK,GAEnC1D,EAAIwN,GACJN,EAAIc,GAEJ1G,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAI4B,GAAO5M,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAImC,GAAO1G,EAAI,MAAW5D,GAAK,GAEnC1D,EAAIyN,GACJP,EAAIe,GAEJ3G,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAI6B,GAAO7M,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAIoC,GAAO3G,EAAI,MAAW5D,GAAK,GAEnC1D,EAAI0N,GACJR,EAAIgB,GAEJ5G,EAAI4F,EAAI,MAAQxJ,EAAIwJ,IAAM,GAC1BtM,EAAIZ,EAAI,MAAQK,EAAIL,IAAM,GAE1BA,EAAI4L,EAAG,CAAC,EACRsB,EAAIrB,EAAG,CAAC,EAERvE,GAAK4F,EAAI,MAAQxJ,GAAKwJ,IAAM,GAC5BtM,GAAKZ,EAAI,MAAQK,GAAKL,IAAM,GAE5B0D,GAAK4D,IAAM,GACX1G,GAAK8C,IAAM,GACXrD,GAAKO,IAAM,GAEXgL,EAAG,CAAC,EAAI8B,GAAO9M,EAAI,MAAWP,GAAK,GACnCwL,EAAG,CAAC,EAAIqC,GAAO5G,EAAI,MAAW5D,GAAK,GAEnCyK,IAAO,IACP/N,GAAK,GACP,CAEA,OAAOA,CACT,CAEA,SAASgO,GAAYpL,EAAK,EAAG5C,EAAG,CAC9B,IAAIwL,EAAK,IAAI,WAAW,CAAC,EACrBC,EAAK,IAAI,WAAW,CAAC,EACrB9L,EAAI,IAAI,WAAW,GAAG,EACtBd,EAAGyE,EAAItD,EAuBX,IArBAwL,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,UACRA,EAAG,CAAC,EAAI,WAERC,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,UACRA,EAAG,CAAC,EAAI,WACRA,EAAG,CAAC,EAAI,UAERF,GAAqBC,EAAIC,EAAI,EAAGzL,CAAC,EACjCA,GAAK,IAEAnB,EAAI,EAAGA,EAAImB,EAAGnB,IAAKc,EAAEd,CAAC,EAAI,EAAEyE,EAAEtD,EAAEnB,CAAC,EAQtC,IAPAc,EAAEK,CAAC,EAAI,IAEPA,EAAI,IAAI,KAAKA,EAAE,IAAI,EAAE,GACrBL,EAAEK,EAAE,CAAC,EAAI,EACTN,EAAKC,EAAGK,EAAE,EAAKsD,EAAI,UAAc,EAAGA,GAAK,CAAC,EAC1CiI,GAAqBC,EAAIC,EAAI9L,EAAGK,CAAC,EAE5BnB,EAAI,EAAGA,EAAI,EAAGA,IAAKa,EAAKkD,EAAK,EAAE/D,EAAG2M,EAAG3M,CAAC,EAAG4M,EAAG5M,CAAC,CAAC,EAEnD,MAAO,EACT,CAEA,SAASoP,GAAI,EAAG3G,EAAG,CACjB,IAAIJ,EAAIvI,EAAG,EAAG2E,EAAI3E,EAAG,EAAG6B,EAAI7B,EAAG,EAC3BsB,EAAItB,EAAG,EAAGgM,EAAIhM,EAAG,EAAG8H,EAAI9H,EAAG,EAC3B4H,EAAI5H,EAAG,EAAGiB,GAAIjB,EAAG,EAAG4I,EAAI5I,EAAG,EAE/BmJ,EAAEZ,EAAG,EAAE,CAAC,EAAG,EAAE,CAAC,CAAC,EACfY,EAAEP,EAAGD,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EACfS,EAAEb,EAAGA,EAAGK,CAAC,EACTM,EAAEvE,EAAG,EAAE,CAAC,EAAG,EAAE,CAAC,CAAC,EACfuE,EAAEN,EAAGD,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EACfS,EAAEzE,EAAGA,EAAGiE,CAAC,EACTQ,EAAEvH,EAAG,EAAE,CAAC,EAAG8G,EAAE,CAAC,CAAC,EACfS,EAAEvH,EAAGA,EAAGlB,CAAE,EACVyI,EAAE9H,EAAG,EAAE,CAAC,EAAGqH,EAAE,CAAC,CAAC,EACfO,EAAE5H,EAAGA,EAAGA,CAAC,EACT6H,EAAE6C,EAAGrH,EAAG4D,CAAC,EACTY,EAAErB,EAAGxG,EAAGO,CAAC,EACTqH,EAAEtB,EAAGtG,EAAGO,CAAC,EACTqH,EAAEjI,GAAG0D,EAAG4D,CAAC,EAETa,EAAE,EAAE,CAAC,EAAG4C,EAAGlE,CAAC,EACZsB,EAAE,EAAE,CAAC,EAAGnI,GAAG2G,CAAC,EACZwB,EAAE,EAAE,CAAC,EAAGxB,EAAGE,CAAC,EACZsB,EAAE,EAAE,CAAC,EAAG4C,EAAG/K,EAAC,CACd,CAEA,SAASsO,GAAM,EAAG5G,EAAGhE,EAAG,CACtB,IAAIzE,EACJ,IAAKA,EAAI,EAAGA,EAAI,EAAGA,IACjBwI,GAAS,EAAExI,CAAC,EAAGyI,EAAEzI,CAAC,EAAGyE,CAAC,CAE1B,CAEA,SAAS6K,EAAKrP,EAAGwB,EAAG,CAClB,IAAI8N,EAAKzP,EAAG,EAAG0P,EAAK1P,EAAG,EAAG2P,EAAK3P,EAAG,EAClC6L,GAAS8D,EAAIhO,EAAE,CAAC,CAAC,EACjByH,EAAEqG,EAAI9N,EAAE,CAAC,EAAGgO,CAAE,EACdvG,EAAEsG,EAAI/N,EAAE,CAAC,EAAGgO,CAAE,EACd9G,GAAU1I,EAAGuP,CAAE,EACfvP,EAAE,EAAE,GAAK6I,GAASyG,CAAE,GAAK,CAC3B,CAEA,SAASG,GAAW,EAAGjH,EAAG9D,EAAG,CAC3B,IAAIF,EAAGzE,EAKP,IAJAoI,GAAS,EAAE,CAAC,EAAG/H,CAAG,EAClB+H,GAAS,EAAE,CAAC,EAAG9H,CAAG,EAClB8H,GAAS,EAAE,CAAC,EAAG9H,CAAG,EAClB8H,GAAS,EAAE,CAAC,EAAG/H,CAAG,EACbL,EAAI,IAAKA,GAAK,EAAG,EAAEA,EACtByE,EAAKE,EAAG3E,EAAE,EAAG,CAAC,IAAMA,EAAE,GAAM,EAC5BqP,GAAM,EAAG5G,EAAGhE,CAAC,EACb2K,GAAI3G,EAAG,CAAC,EACR2G,GAAI,EAAG,CAAC,EACRC,GAAM,EAAG5G,EAAGhE,CAAC,CAEjB,CAEA,SAASkL,GAAW,EAAGhL,EAAG,CACxB,IAAI8D,EAAI,CAAC3I,EAAG,EAAGA,EAAG,EAAGA,EAAG,EAAGA,EAAG,CAAC,EAC/BsI,GAASK,EAAE,CAAC,EAAG/H,CAAC,EAChB0H,GAASK,EAAE,CAAC,EAAG9H,CAAC,EAChByH,GAASK,EAAE,CAAC,EAAGnI,CAAG,EAClB4I,EAAET,EAAE,CAAC,EAAG/H,EAAGC,CAAC,EACZ+O,GAAW,EAAGjH,EAAG9D,CAAC,CACpB,CAEA,SAASiL,GAAoBC,EAAIC,EAAIC,EAAQ,CAC3C,IAAI3O,EAAI,IAAI,WAAW,EAAE,EACrBK,EAAI,CAAC3B,EAAG,EAAGA,EAAG,EAAGA,EAAG,EAAGA,EAAG,CAAC,EAC3BE,EAWJ,IATK+P,GAAQ7P,EAAY4P,EAAI,EAAE,EAC/BX,GAAY/N,EAAG0O,EAAI,EAAE,EACrB1O,EAAE,CAAC,GAAK,IACRA,EAAE,EAAE,GAAK,IACTA,EAAE,EAAE,GAAK,GAETuO,GAAWlO,EAAGL,CAAC,EACfkO,EAAKO,EAAIpO,CAAC,EAELzB,EAAI,EAAGA,EAAI,GAAIA,IAAK8P,EAAG9P,EAAE,EAAE,EAAI6P,EAAG7P,CAAC,EACxC,MAAO,EACT,CAEA,IAAIgQ,GAAI,IAAI,aAAa,CAAC,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAI,CAAC,EAE5K,SAASC,GAAKhQ,EAAGa,EAAG,CAClB,IAAIoP,EAAOlQ,EAAG4I,EAAGlH,EACjB,IAAK1B,EAAI,GAAIA,GAAK,GAAI,EAAEA,EAAG,CAEzB,IADAkQ,EAAQ,EACHtH,EAAI5I,EAAI,GAAI0B,EAAI1B,EAAI,GAAI4I,EAAIlH,EAAG,EAAEkH,EACpC9H,EAAE8H,CAAC,GAAKsH,EAAQ,GAAKpP,EAAEd,CAAC,EAAIgQ,GAAEpH,GAAK5I,EAAI,GAAG,EAC1CkQ,EAAQ,KAAK,OAAOpP,EAAE8H,CAAC,EAAI,KAAO,GAAG,EACrC9H,EAAE8H,CAAC,GAAKsH,EAAQ,IAElBpP,EAAE8H,CAAC,GAAKsH,EACRpP,EAAEd,CAAC,EAAI,CACT,CAEA,IADAkQ,EAAQ,EACHtH,EAAI,EAAGA,EAAI,GAAIA,IAClB9H,EAAE8H,CAAC,GAAKsH,GAASpP,EAAE,EAAE,GAAK,GAAKkP,GAAEpH,CAAC,EAClCsH,EAAQpP,EAAE8H,CAAC,GAAK,EAChB9H,EAAE8H,CAAC,GAAK,IAEV,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAK9H,EAAE8H,CAAC,GAAKsH,EAAQF,GAAEpH,CAAC,EAC5C,IAAK5I,EAAI,EAAGA,EAAI,GAAIA,IAClBc,EAAEd,EAAE,CAAC,GAAKc,EAAEd,CAAC,GAAK,EAClBC,EAAED,CAAC,EAAIc,EAAEd,CAAC,EAAI,GAElB,CAEA,SAASmQ,GAAOlQ,EAAG,CACjB,IAAIa,EAAI,IAAI,aAAa,EAAE,EAAGd,EAC9B,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKc,EAAEd,CAAC,EAAIC,EAAED,CAAC,EACnC,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKC,EAAED,CAAC,EAAI,EAChCiQ,GAAKhQ,EAAGa,CAAC,CACX,CAGA,SAASsP,GAAYC,EAAI,EAAGlP,EAAG2O,EAAI,CACjC,IAAI1O,EAAI,IAAI,WAAW,EAAE,EAAGL,EAAI,IAAI,WAAW,EAAE,EAAGd,EAAI,IAAI,WAAW,EAAE,EACrED,EAAG4I,EAAG9H,GAAI,IAAI,aAAa,EAAE,EAC7BW,EAAI,CAAC3B,EAAG,EAAGA,EAAG,EAAGA,EAAG,EAAGA,EAAG,CAAC,EAE/BqP,GAAY/N,EAAG0O,EAAI,EAAE,EACrB1O,EAAE,CAAC,GAAK,IACRA,EAAE,EAAE,GAAK,IACTA,EAAE,EAAE,GAAK,GAET,IAAIkP,GAAQnP,EAAI,GAChB,IAAKnB,EAAI,EAAGA,EAAImB,EAAGnB,IAAKqQ,EAAG,GAAKrQ,CAAC,EAAI,EAAEA,CAAC,EACxC,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKqQ,EAAG,GAAKrQ,CAAC,EAAIoB,EAAE,GAAKpB,CAAC,EAO9C,IALAmP,GAAYlP,EAAGoQ,EAAG,SAAS,EAAE,EAAGlP,EAAE,EAAE,EACpCgP,GAAOlQ,CAAC,EACR0P,GAAWlO,EAAGxB,CAAC,EACfqP,EAAKe,EAAI5O,CAAC,EAELzB,EAAI,GAAIA,EAAI,GAAIA,IAAKqQ,EAAGrQ,CAAC,EAAI8P,EAAG9P,CAAC,EAItC,IAHAmP,GAAYpO,EAAGsP,EAAIlP,EAAI,EAAE,EACzBgP,GAAOpP,CAAC,EAEHf,EAAI,EAAGA,EAAI,GAAIA,IAAKc,GAAEd,CAAC,EAAI,EAChC,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKc,GAAEd,CAAC,EAAIC,EAAED,CAAC,EACnC,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAClB,IAAK4I,EAAI,EAAGA,EAAI,GAAIA,IAClB9H,GAAEd,EAAE4I,CAAC,GAAK7H,EAAEf,CAAC,EAAIoB,EAAEwH,CAAC,EAIxB,OAAAqH,GAAKI,EAAG,SAAS,EAAE,EAAGvP,EAAC,EAChBwP,EACT,CAEA,SAASC,GAAUtQ,EAAGwB,EAAG,CACvB,IAAIiH,EAAI5I,EAAG,EAAG0Q,EAAM1Q,EAAG,EAAG2Q,EAAM3Q,EAAG,EAC/B4Q,EAAM5Q,EAAG,EAAG6Q,EAAO7Q,EAAG,EAAG8Q,EAAO9Q,EAAG,EACnC+Q,EAAO/Q,EAAG,EA2Bd,OAzBAsI,GAASnI,EAAE,CAAC,EAAGK,CAAG,EAClByI,EAAY9I,EAAE,CAAC,EAAGwB,CAAC,EACnBiK,GAAE+E,EAAKxQ,EAAE,CAAC,CAAC,EACXiJ,EAAEwH,EAAKD,EAAKjQ,CAAC,EACbyI,EAAEwH,EAAKA,EAAKxQ,EAAE,CAAC,CAAC,EAChB+I,EAAE0H,EAAKzQ,EAAE,CAAC,EAAGyQ,CAAG,EAEhBhF,GAAEiF,EAAMD,CAAG,EACXhF,GAAEkF,EAAMD,CAAI,EACZzH,EAAE2H,EAAMD,EAAMD,CAAI,EAClBzH,EAAER,EAAGmI,EAAMJ,CAAG,EACdvH,EAAER,EAAGA,EAAGgI,CAAG,EAEX9E,GAAQlD,EAAGA,CAAC,EACZQ,EAAER,EAAGA,EAAG+H,CAAG,EACXvH,EAAER,EAAGA,EAAGgI,CAAG,EACXxH,EAAER,EAAGA,EAAGgI,CAAG,EACXxH,EAAEjJ,EAAE,CAAC,EAAGyI,EAAGgI,CAAG,EAEdhF,GAAE8E,EAAKvQ,EAAE,CAAC,CAAC,EACXiJ,EAAEsH,EAAKA,EAAKE,CAAG,EACX7H,GAAS2H,EAAKC,CAAG,GAAGvH,EAAEjJ,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGW,CAAC,EAEvC8K,GAAE8E,EAAKvQ,EAAE,CAAC,CAAC,EACXiJ,EAAEsH,EAAKA,EAAKE,CAAG,EACX7H,GAAS2H,EAAKC,CAAG,EAAU,IAE3B3H,GAAS7I,EAAE,CAAC,CAAC,IAAOwB,EAAE,EAAE,GAAG,GAAIwH,EAAEhJ,EAAE,CAAC,EAAGI,EAAKJ,EAAE,CAAC,CAAC,EAEpDiJ,EAAEjJ,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EACX,EACT,CAEA,SAAS6Q,GAAiBzM,EAAGgM,EAAIlP,EAAG0O,EAAI,CACtC,IAAI7P,EACA0I,EAAI,IAAI,WAAW,EAAE,EAAG3H,EAAI,IAAI,WAAW,EAAE,EAC7CU,EAAI,CAAC3B,EAAG,EAAGA,EAAG,EAAGA,EAAG,EAAGA,EAAG,CAAC,EAC3B2I,EAAI,CAAC3I,EAAG,EAAGA,EAAG,EAAGA,EAAG,EAAGA,EAAG,CAAC,EAI/B,GAFIqB,EAAI,IAEJoP,GAAU9H,EAAGoH,CAAE,EAAG,MAAO,GAE7B,IAAK7P,EAAI,EAAGA,EAAImB,EAAGnB,IAAKqE,EAAErE,CAAC,EAAIqQ,EAAGrQ,CAAC,EACnC,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKqE,EAAErE,EAAE,EAAE,EAAI6P,EAAG7P,CAAC,EAUvC,GATAmP,GAAYpO,EAAGsD,EAAGlD,CAAC,EACnBgP,GAAOpP,CAAC,EACR2O,GAAWjO,EAAGgH,EAAG1H,CAAC,EAElB4O,GAAWlH,EAAG4H,EAAG,SAAS,EAAE,CAAC,EAC7BjB,GAAI3N,EAAGgH,CAAC,EACR6G,EAAK5G,EAAGjH,CAAC,EAETN,GAAK,GACDG,EAAiB+O,EAAI,EAAG3H,EAAG,CAAC,EAAG,CACjC,IAAK1I,EAAI,EAAGA,EAAImB,EAAGnB,IAAKqE,EAAErE,CAAC,EAAI,EAC/B,MAAO,EACT,CAEA,IAAKA,EAAI,EAAGA,EAAImB,EAAGnB,IAAKqE,EAAErE,CAAC,EAAIqQ,EAAGrQ,EAAI,EAAE,EACxC,OAAOmB,CACT,CAEA,IAAI4P,GAA4B,GAC5BC,GAA8B,GAC9BC,GAA6B,GAC7BC,GAAgC,GAChCC,GAA0B,GAC1BC,GAAgC,GAChCC,GAA4B,GAC5BC,GAA4B,GAC5BC,GAA2B,GAC3BC,GAAwBR,GACxBS,GAAuBR,GACvBS,GAA0BR,GAC1BS,GAAoB,GACpBC,GAA6B,GAC7BC,GAA6B,GAC7BC,GAAwB,GACxBC,GAAoB,GAExBlS,EAAK,SAAW,CACd,qBAAsBoE,EACtB,kBAAmBY,GACnB,cAAeH,GACf,0BAA2BP,EAC3B,sBAAuBK,EACvB,mBAAoBsD,GACpB,0BAA2BE,GAC3B,iBAAkB3G,EAClB,iBAAkBC,EAClB,iBAAkB4G,GAClB,sBAAuBC,GACvB,kBAAmB0D,GACnB,uBAAwBI,GACxB,oBAAqBG,GACrB,mBAAoBC,GACpB,WAAYE,GACZ,gBAAiBC,GACjB,mBAAoBN,GACpB,YAAaiD,GACb,YAAaiB,GACb,oBAAqBR,GACrB,iBAAkBkB,GAElB,0BAA2BC,GAC3B,4BAA6BC,GAC7B,2BAA4BC,GAC5B,8BAA+BC,GAC/B,wBAAyBC,GACzB,8BAA+BC,GAC/B,0BAA2BC,GAC3B,0BAA2BC,GAC3B,yBAA0BC,GAC1B,sBAAuBC,GACvB,qBAAsBC,GACtB,wBAAyBC,GACzB,kBAAmBC,GACnB,2BAA4BC,GAC5B,2BAA4BC,GAC5B,sBAAuBC,GACvB,kBAAmBC,GAEnB,GAAIjS,EACJ,EAAGU,EACH,EAAGwP,GACH,UAAWrH,GACX,YAAaI,EACb,EAAGG,EACH,EAAGF,EACH,EAAG0C,GACH,EAAGzC,EACH,QAAS2C,GACT,IAAKwD,GACL,SAAUhH,GACV,KAAM6H,GACN,WAAYP,GACZ,WAAYC,EACd,EAIA,SAASqC,GAAatQ,EAAGP,EAAG,CAC1B,GAAIO,EAAE,SAAWqP,GAA2B,MAAM,IAAI,MAAM,cAAc,EAC1E,GAAI5P,EAAE,SAAW6P,GAA6B,MAAM,IAAI,MAAM,gBAAgB,CAChF,CAEA,SAASiB,GAAgBpC,EAAIC,EAAI,CAC/B,GAAID,EAAG,SAAWwB,GAA2B,MAAM,IAAI,MAAM,qBAAqB,EAClF,GAAIvB,EAAG,SAAWwB,GAA2B,MAAM,IAAI,MAAM,qBAAqB,CACpF,CAEA,SAASY,IAAkB,CACzB,QAASlS,EAAI,EAAGA,EAAI,UAAU,OAAQA,IACpC,GAAI,EAAE,UAAUA,CAAC,YAAa,YAC5B,MAAM,IAAI,UAAU,iCAAiC,CAE3D,CAEA,SAASmS,GAAQC,EAAK,CACpB,QAASpS,EAAI,EAAGA,EAAIoS,EAAI,OAAQpS,IAAKoS,EAAIpS,CAAC,EAAI,CAChD,CAEAH,EAAK,YAAc,SAASsB,EAAG,CAC7B,IAAIsD,EAAI,IAAI,WAAWtD,CAAC,EACxB,OAAAjB,EAAYuE,EAAGtD,CAAC,EACTsD,CACT,EAEA5E,EAAK,UAAY,SAASwS,EAAKC,EAAOvN,EAAK,CACzCmN,GAAgBG,EAAKC,EAAOvN,CAAG,EAC/BiN,GAAajN,EAAKuN,CAAK,EAGvB,QAFIjO,EAAI,IAAI,WAAW4M,GAA6BoB,EAAI,MAAM,EAC1D1Q,EAAI,IAAI,WAAW0C,EAAE,MAAM,EACtBrE,EAAI,EAAGA,EAAIqS,EAAI,OAAQrS,IAAKqE,EAAErE,EAAEiR,EAA0B,EAAIoB,EAAIrS,CAAC,EAC5E,OAAAkI,GAAiBvG,EAAG0C,EAAGA,EAAE,OAAQiO,EAAOvN,CAAG,EACpCpD,EAAE,SAASuP,EAA6B,CACjD,EAEArR,EAAK,UAAU,KAAO,SAAS0S,EAAKD,EAAOvN,EAAK,CAC9CmN,GAAgBK,EAAKD,EAAOvN,CAAG,EAC/BiN,GAAajN,EAAKuN,CAAK,EAGvB,QAFI3Q,EAAI,IAAI,WAAWuP,GAAgCqB,EAAI,MAAM,EAC7DlO,EAAI,IAAI,WAAW1C,EAAE,MAAM,EACtB3B,EAAI,EAAGA,EAAIuS,EAAI,OAAQvS,IAAK2B,EAAE3B,EAAEkR,EAA6B,EAAIqB,EAAIvS,CAAC,EAE/E,OADI2B,EAAE,OAAS,IACXwG,GAAsB9D,EAAG1C,EAAGA,EAAE,OAAQ2Q,EAAOvN,CAAG,IAAM,EAAU,KAC7DV,EAAE,SAAS4M,EAA0B,CAC9C,EAEApR,EAAK,UAAU,UAAYkR,GAC3BlR,EAAK,UAAU,YAAcmR,GAC7BnR,EAAK,UAAU,eAAiBqR,GAEhCrR,EAAK,WAAa,SAASsB,EAAGM,EAAG,CAE/B,GADAyQ,GAAgB/Q,EAAGM,CAAC,EAChBN,EAAE,SAAWiQ,GAA+B,MAAM,IAAI,MAAM,YAAY,EAC5E,GAAI3P,EAAE,SAAW0P,GAAyB,MAAM,IAAI,MAAM,YAAY,EACtE,IAAI1I,EAAI,IAAI,WAAW0I,EAAuB,EAC9C,OAAAtF,GAAkBpD,EAAGtH,EAAGM,CAAC,EAClBgH,CACT,EAEA5I,EAAK,WAAW,KAAO,SAASsB,EAAG,CAEjC,GADA+Q,GAAgB/Q,CAAC,EACbA,EAAE,SAAWiQ,GAA+B,MAAM,IAAI,MAAM,YAAY,EAC5E,IAAI3I,EAAI,IAAI,WAAW0I,EAAuB,EAC9C,OAAAlF,GAAuBxD,EAAGtH,CAAC,EACpBsH,CACT,EAEA5I,EAAK,WAAW,aAAeuR,GAC/BvR,EAAK,WAAW,mBAAqBsR,GAErCtR,EAAK,IAAM,SAASwS,EAAKC,EAAOE,EAAWC,EAAW,CACpD,IAAI/Q,EAAI7B,EAAK,IAAI,OAAO2S,EAAWC,CAAS,EAC5C,OAAO5S,EAAK,UAAUwS,EAAKC,EAAO5Q,CAAC,CACrC,EAEA7B,EAAK,IAAI,OAAS,SAAS2S,EAAWC,EAAW,CAC/CP,GAAgBM,EAAWC,CAAS,EACpCR,GAAgBO,EAAWC,CAAS,EACpC,IAAI/Q,EAAI,IAAI,WAAW6P,EAAwB,EAC/C,OAAAnF,GAAoB1K,EAAG8Q,EAAWC,CAAS,EACpC/Q,CACT,EAEA7B,EAAK,IAAI,MAAQA,EAAK,UAEtBA,EAAK,IAAI,KAAO,SAASwS,EAAKC,EAAOE,EAAWC,EAAW,CACzD,IAAI/Q,EAAI7B,EAAK,IAAI,OAAO2S,EAAWC,CAAS,EAC5C,OAAO5S,EAAK,UAAU,KAAKwS,EAAKC,EAAO5Q,CAAC,CAC1C,EAEA7B,EAAK,IAAI,KAAK,MAAQA,EAAK,UAAU,KAErCA,EAAK,IAAI,QAAU,UAAW,CAC5B,IAAIgQ,EAAK,IAAI,WAAWwB,EAAyB,EAC7CvB,EAAK,IAAI,WAAWwB,EAAyB,EACjD,OAAApF,GAAmB2D,EAAIC,CAAE,EAClB,CAAC,UAAWD,EAAI,UAAWC,CAAE,CACtC,EAEAjQ,EAAK,IAAI,QAAQ,cAAgB,SAAS4S,EAAW,CAEnD,GADAP,GAAgBO,CAAS,EACrBA,EAAU,SAAWnB,GACvB,MAAM,IAAI,MAAM,qBAAqB,EACvC,IAAIzB,EAAK,IAAI,WAAWwB,EAAyB,EACjD,OAAApF,GAAuB4D,EAAI4C,CAAS,EAC7B,CAAC,UAAW5C,EAAI,UAAW,IAAI,WAAW4C,CAAS,CAAC,CAC7D,EAEA5S,EAAK,IAAI,gBAAkBwR,GAC3BxR,EAAK,IAAI,gBAAkByR,GAC3BzR,EAAK,IAAI,gBAAkB0R,GAC3B1R,EAAK,IAAI,YAAc2R,GACvB3R,EAAK,IAAI,eAAiBA,EAAK,UAAU,eAEzCA,EAAK,KAAO,SAASwS,EAAKI,EAAW,CAEnC,GADAP,GAAgBG,EAAKI,CAAS,EAC1BA,EAAU,SAAWZ,GACvB,MAAM,IAAI,MAAM,qBAAqB,EACvC,IAAIa,EAAY,IAAI,WAAWf,GAAkBU,EAAI,MAAM,EAC3D,OAAAjC,GAAYsC,EAAWL,EAAKA,EAAI,OAAQI,CAAS,EAC1CC,CACT,EAEA7S,EAAK,KAAK,KAAO,SAAS6S,EAAWF,EAAW,CAE9C,GADAN,GAAgBQ,EAAWF,CAAS,EAChCA,EAAU,SAAWZ,GACvB,MAAM,IAAI,MAAM,qBAAqB,EACvC,IAAIe,EAAM,IAAI,WAAWD,EAAU,MAAM,EACrCE,EAAO9B,GAAiB6B,EAAKD,EAAWA,EAAU,OAAQF,CAAS,EACvE,GAAII,EAAO,EAAG,OAAO,KAErB,QADIvO,EAAI,IAAI,WAAWuO,CAAI,EAClB5S,EAAI,EAAGA,EAAIqE,EAAE,OAAQrE,IAAKqE,EAAErE,CAAC,EAAI2S,EAAI3S,CAAC,EAC/C,OAAOqE,CACT,EAEAxE,EAAK,KAAK,SAAW,SAASwS,EAAKI,EAAW,CAG5C,QAFIC,EAAY7S,EAAK,KAAKwS,EAAKI,CAAS,EACpCI,EAAM,IAAI,WAAWlB,EAAiB,EACjC3R,EAAI,EAAGA,EAAI6S,EAAI,OAAQ7S,IAAK6S,EAAI7S,CAAC,EAAI0S,EAAU1S,CAAC,EACzD,OAAO6S,CACT,EAEAhT,EAAK,KAAK,SAAS,OAAS,SAASwS,EAAKQ,EAAKL,EAAW,CAExD,GADAN,GAAgBG,EAAKQ,EAAKL,CAAS,EAC/BK,EAAI,SAAWlB,GACjB,MAAM,IAAI,MAAM,oBAAoB,EACtC,GAAIa,EAAU,SAAWZ,GACvB,MAAM,IAAI,MAAM,qBAAqB,EACvC,IAAIvB,EAAK,IAAI,WAAWsB,GAAoBU,EAAI,MAAM,EAClDhO,EAAI,IAAI,WAAWsN,GAAoBU,EAAI,MAAM,EACjDrS,EACJ,IAAKA,EAAI,EAAGA,EAAI2R,GAAmB3R,IAAKqQ,EAAGrQ,CAAC,EAAI6S,EAAI7S,CAAC,EACrD,IAAKA,EAAI,EAAGA,EAAIqS,EAAI,OAAQrS,IAAKqQ,EAAGrQ,EAAE2R,EAAiB,EAAIU,EAAIrS,CAAC,EAChE,OAAQ8Q,GAAiBzM,EAAGgM,EAAIA,EAAG,OAAQmC,CAAS,GAAK,CAC3D,EAEA3S,EAAK,KAAK,QAAU,UAAW,CAC7B,IAAIgQ,EAAK,IAAI,WAAW+B,EAA0B,EAC9C9B,EAAK,IAAI,WAAW+B,EAA0B,EAClD,OAAAjC,GAAoBC,EAAIC,CAAE,EACnB,CAAC,UAAWD,EAAI,UAAWC,CAAE,CACtC,EAEAjQ,EAAK,KAAK,QAAQ,cAAgB,SAAS4S,EAAW,CAEpD,GADAP,GAAgBO,CAAS,EACrBA,EAAU,SAAWZ,GACvB,MAAM,IAAI,MAAM,qBAAqB,EAEvC,QADIhC,EAAK,IAAI,WAAW+B,EAA0B,EACzC5R,EAAI,EAAGA,EAAI6P,EAAG,OAAQ7P,IAAK6P,EAAG7P,CAAC,EAAIyS,EAAU,GAAGzS,CAAC,EAC1D,MAAO,CAAC,UAAW6P,EAAI,UAAW,IAAI,WAAW4C,CAAS,CAAC,CAC7D,EAEA5S,EAAK,KAAK,QAAQ,SAAW,SAASiT,EAAM,CAE1C,GADAZ,GAAgBY,CAAI,EAChBA,EAAK,SAAWhB,GAClB,MAAM,IAAI,MAAM,eAAe,EAGjC,QAFIjC,EAAK,IAAI,WAAW+B,EAA0B,EAC9C9B,EAAK,IAAI,WAAW+B,EAA0B,EACzC7R,EAAI,EAAGA,EAAI,GAAIA,IAAK8P,EAAG9P,CAAC,EAAI8S,EAAK9S,CAAC,EAC3C,OAAA4P,GAAoBC,EAAIC,EAAI,EAAI,EACzB,CAAC,UAAWD,EAAI,UAAWC,CAAE,CACtC,EAEAjQ,EAAK,KAAK,gBAAkB+R,GAC5B/R,EAAK,KAAK,gBAAkBgS,GAC5BhS,EAAK,KAAK,WAAaiS,GACvBjS,EAAK,KAAK,gBAAkB8R,GAE5B9R,EAAK,KAAO,SAASwS,EAAK,CACxBH,GAAgBG,CAAG,EACnB,IAAItR,EAAI,IAAI,WAAWgR,EAAiB,EACxC,OAAA5C,GAAYpO,EAAGsR,EAAKA,EAAI,MAAM,EACvBtR,CACT,EAEAlB,EAAK,KAAK,WAAakS,GAEvBlS,EAAK,OAAS,SAASiB,EAAGqL,EAAG,CAI3B,OAHA+F,GAAgBpR,EAAGqL,CAAC,EAEhBrL,EAAE,SAAW,GAAKqL,EAAE,SAAW,GAC/BrL,EAAE,SAAWqL,EAAE,OAAe,GAC1BnL,EAAGF,EAAG,EAAGqL,EAAG,EAAGrL,EAAE,MAAM,IAAM,CACvC,EAEAjB,EAAK,QAAU,SAASkT,EAAI,CAC1B7S,EAAc6S,CAChB,EAEC,UAAW,CAGV,IAAIC,EAAS,OAAO,KAAS,IAAe,KAAK,QAAU,KAAK,SAAY,KAC5E,GAAIA,GAAUA,EAAO,gBAAiB,CAEpC,IAAIC,EAAQ,MACZpT,EAAK,QAAQ,SAASiB,EAAGK,EAAG,CAC1B,IAAInB,EAAGuI,EAAI,IAAI,WAAWpH,CAAC,EAC3B,IAAKnB,EAAI,EAAGA,EAAImB,EAAGnB,GAAKiT,EACtBD,EAAO,gBAAgBzK,EAAE,SAASvI,EAAGA,EAAI,KAAK,IAAImB,EAAInB,EAAGiT,CAAK,CAAC,CAAC,EAElE,IAAKjT,EAAI,EAAGA,EAAImB,EAAGnB,IAAKc,EAAEd,CAAC,EAAIuI,EAAEvI,CAAC,EAClCmS,GAAQ5J,CAAC,CACX,CAAC,CACH,MAAW,OAAO2K,GAAY,MAE5BF,EAAS,GAAQ,QAAQ,EACrBA,GAAUA,EAAO,aACnBnT,EAAK,QAAQ,SAASiB,EAAGK,EAAG,CAC1B,IAAInB,EAAGuI,EAAIyK,EAAO,YAAY7R,CAAC,EAC/B,IAAKnB,EAAI,EAAGA,EAAImB,EAAGnB,IAAKc,EAAEd,CAAC,EAAIuI,EAAEvI,CAAC,EAClCmS,GAAQ5J,CAAC,CACX,CAAC,EAGP,EAAG,CAEH,GAAG,OAAO3I,GAAW,KAAeA,GAAO,QAAUA,GAAO,QAAW,KAAK,KAAO,KAAK,MAAQ,CAAC,CAAE,ICt1E5F,IAAMuT,GAAkB,OAAO,KAAK,EAC9BC,GAAwB,OAAO,WAAW,EAC1CC,GAA0B,OAAO,aAAa,EAoBrDC,GAAY,CAACC,EAAcC,KAC7BD,EAAa,IAAIC,CAAG,EACbA,GAGEC,GAAcC,GAAS,CAChC,IAAMH,EAAe,IAAI,QACnBI,EAAW,CAAC,EACZC,EAAgB,IAAI,IACpBC,EAAa,IAAI,IAiGvB,MAAO,CACH,KA/FW,KAAK,MAAM,KAAK,UAAUH,EAAM,CAACI,EAAMC,IAAU,CAE5D,GAAIA,GAAS,OAAOA,GAAU,UAAYR,EAAa,IAAIQ,CAAK,EAC5D,OAAOA,EAEX,GAAIA,IAAU,OACV,OAAOT,GAAUC,EAAc,CAAC,IAAK,GAAG,CAAC,EAG7C,GAAI,CAACQ,EACD,OAAOA,EAIX,GAAI,MAAM,QAAQA,CAAK,GAAKA,EAAM,CAAC,IAAM,IACrC,OAAOT,GAAUC,EAAc,CAAC,IAAK,IAAK,GAAGQ,CAAK,CAAC,EAIvD,GAAIA,aAAiB,IACjB,OAAOT,GAAUC,EAAc,CAAC,IAAK,MAAO,MAAM,KAAKQ,EAAM,QAAQ,CAAC,CAAC,CAAC,EAG5E,GAAIA,aAAiB,IACjB,OAAOT,GAAUC,EAAc,CAAC,IAAK,MAAO,MAAM,KAAKQ,EAAM,OAAO,CAAC,CAAC,CAAC,EAI3E,GAAIA,aAAiB,MAAQA,aAAiB,KAAM,CAChD,IAAMC,EAAML,EAAS,OACrB,OAAAA,EAASA,EAAS,MAAM,EAAII,EACrBT,GAAUC,EAAc,CAAC,IAAK,OAAQS,CAAG,CAAC,CACrD,CAEA,GAAID,aAAiB,MAAO,CACxB,IAAMC,EAAML,EAAS,OACrB,OAAAA,EAASA,EAAS,MAAM,EAAII,EAExBA,EAAM,QACNA,EAAM,MAAQN,GAAWM,EAAM,KAAK,EAAE,MAEnCT,GAAUC,EAAc,CAAC,IAAK,OAAQD,GAAUC,EAAc,CAAC,IAAK,OAAQS,CAAG,CAAC,EAAGD,EAAM,IAAI,CAAC,CACzG,CAEA,GAAIA,aAAiB,aAAeA,aAAiB,gBAAkBA,aAAiB,gBAAkBA,aAAiB,YAAa,CACpI,IAAMC,EAAML,EAAS,OACrB,OAAAA,EAASA,EAAS,MAAM,EAAII,EAC5BH,EAAc,IAAIG,CAAK,EAChBT,GAAUC,EAAc,CAAC,IAAK,OAAQS,CAAG,CAAC,CACrD,CACA,GAAI,YAAY,OAAOD,CAAK,EAAG,CAC3B,IAAMC,EAAML,EAAS,OACrB,OAAAA,EAASA,EAAS,MAAM,EAAII,EAC5BH,EAAc,IAAIG,EAAM,MAAM,EACvBT,GAAUC,EAAc,CAAC,IAAK,OAAQS,CAAG,CAAC,CACrD,CAGA,GAAI,OAAOD,GAAU,WAAY,CAC7B,IAAME,EAAK,IAAI,eACf,OAAAA,EAAG,MAAM,UAAY,MAAOC,GAAO,CAC/B,GAAI,CACA,GAAI,CACA,IAAMC,EAAS,MAAMJ,EAAM,GAAGK,GAAaF,EAAG,KAAK,CAAC,CAAC,CAAC,EAChD,CAAE,KAAAR,EAAM,cAAAE,CAAc,EAAIH,GAAWU,CAAM,EACjDD,EAAG,KAAK,CAAC,EAAE,YAAY,CAAC,GAAMR,CAAI,EAAGE,CAAa,CACtD,OACOS,EAAG,CACN,GAAM,CAAE,KAAAX,EAAM,cAAAE,CAAc,EAAIH,GAAWY,CAAC,EAC5CH,EAAG,KAAK,CAAC,EAAE,YAAY,CAAC,GAAOR,CAAI,EAAGE,CAAa,CACvD,CACJ,OACOS,EAAG,CACN,QAAQ,MAAM,mCAAoCA,CAAC,CACvD,CACJ,EACAT,EAAc,IAAIK,EAAG,KAAK,EAC1BJ,EAAW,IAAII,EAAG,KAAK,EAChBX,GAAUC,EAAc,CAAC,IAAK,MAAOU,EAAG,KAAK,CAAC,CACzD,CACA,IAAMK,EAAQ,OAAO,eAAeP,CAAK,EAEzC,OAAIO,GAAO,cAAcnB,EAAe,GAAKmB,EAAM,YAAYlB,EAAqB,EACzEE,GAAUC,EAAc,CAAC,IAAK,UAAWe,EAAM,YAAYnB,EAAe,EAAGmB,EAAM,YAAYlB,EAAqB,EAAEW,CAAK,CAAC,CAAC,EAEjIA,CACX,CAAC,EAAG,CAACD,EAAMC,IAGH,MAAM,QAAQA,CAAK,GAAKA,EAAM,CAAC,IAAM,KAAOA,EAAM,CAAC,IAAM,OAClDJ,EAASI,EAAM,CAAC,CAAC,EAErBA,CACV,EAGG,cAAe,MAAM,KAAKH,CAAa,EACvC,WAAY,MAAM,KAAKC,CAAU,CACrC,CACJ,EAEMU,GAAoB,OAAO,OAAO,IAAI,EAE/BH,GAAgBV,GAAS,CAClC,IAAMH,EAAe,IAAI,QACnBI,EAAW,CAAC,EAGlB,OAAO,KAAK,MAAM,KAAK,UAAUD,EAAM,CAACI,EAAMC,IAAU,CACpD,GAAIA,GAAS,OAAOA,GAAU,UAAY,CAACR,EAAa,IAAIQ,CAAK,GAAK,CAAC,MAAM,QAAQA,CAAK,GAAK,OAAO,eAAeA,CAAK,IAAM,OAAO,UAAW,CAC9I,IAAMC,EAAML,EAAS,OACrB,OAAAA,EAASA,EAAS,MAAM,EAAII,EACrBT,GAAUC,EAAc,CAAC,IAAK,OAAQS,CAAG,CAAC,CACrD,CACA,OAAOD,CACX,CAAC,EAAG,CAACD,EAAMC,IAAU,CACjB,GAAI,MAAM,QAAQA,CAAK,GAAKA,EAAM,CAAC,IAAM,IACrC,OAAQA,EAAM,CAAC,EAAG,CACd,IAAK,IACD,OAAIA,EAAM,QAAU,EAETA,EAAM,MAAM,CAAC,EAIpB,OAGR,IAAK,MACD,OAAO,IAAI,IAAIA,EAAM,CAAC,CAAC,EAE3B,IAAK,MACD,OAAO,IAAI,IAAIA,EAAM,CAAC,CAAC,EAE3B,IAAK,UACD,GAAIQ,GAAkBR,EAAM,CAAC,CAAC,EAC1B,OAAOQ,GAAkBR,EAAM,CAAC,CAAC,EAAEA,EAAM,CAAC,CAAC,EAG3C,MAAM,IAAI,MAAM,2BAA6BA,EAAM,CAAC,CAAC,EAG7D,IAAK,OACD,OAAOJ,EAASI,EAAM,CAAC,CAAC,EAC5B,IAAK,OACD,OAAIA,EAAM,CAAC,EAAE,OAASA,EAAM,CAAC,IACzBA,EAAM,CAAC,EAAE,KAAOA,EAAM,CAAC,GAEvBA,EAAM,CAAC,EAAE,QACTA,EAAM,CAAC,EAAE,MAAQK,GAAaL,EAAM,CAAC,EAAE,KAAK,GAEzCA,EAAM,CAAC,EAIlB,IAAK,MAAO,CACR,IAAMS,EAAKT,EAAM,CAAC,EAClB,MAAO,IAAIU,IACA,IAAI,QAAQ,CAACC,EAASC,IAAW,CACpC,IAAMV,EAAK,IAAI,eACT,CAAE,KAAAP,EAAM,cAAAE,CAAc,EAAIH,GAAWgB,CAAI,EAC/CR,EAAG,MAAM,UAAaC,GAAO,CACrBA,EAAG,KAAK,CAAC,EACTQ,EAAQN,GAAaF,EAAG,KAAK,CAAC,CAAC,CAAC,EAGhCS,EAAOP,GAAaF,EAAG,KAAK,CAAC,CAAC,CAAC,CAEvC,EACAM,EAAG,YAAY,CAACP,EAAG,MAAOP,CAAI,EAAG,CAACO,EAAG,MAAO,GAAGL,CAAa,CAAC,CACjE,CAAC,CAET,CACJ,CAEJ,OAAOG,CACX,CAAC,CACL,EAGAK,GAAa,SAAYQ,GAAS,CAC1B,OAAOA,GAAS,YAAc,OAAOA,EAAKzB,EAAe,GAAM,UAAY,OAAOyB,EAAKvB,EAAuB,GAAM,aACpHkB,GAAkBK,EAAKzB,EAAe,CAAC,EAAIyB,EAAKvB,EAAuB,EAAE,KAAKuB,CAAI,EAE1F,EC3MO,IAAMC,GAAyB,yBACzBC,GAAiB,CAC5B,OAAQ,SACR,QAAS,UACT,QAAS,SACX,EAYO,IAAMC,GAAkB,kBAClBC,GAAyB,gBACzBC,GAAyB,gBACzBC,GAAgC,uBAChCC,GAAmC,0BACnCC,GAAmB,UAEnBC,GAAoB,oBAI1B,IAAMC,GAAoB,EAE1B,IAAMC,GAAyB,IAI/B,IAAMC,GAAc,OACdC,GAAgB,SAChBC,GAAgB,SAChBC,GAAkB,WAClBC,GAAiB,UACjBC,GAAmB,YAkBzB,IAAMC,GAAoB,CAC/B,iBAAkB,mBAClB,iBAAkB,mBAClB,qBAAsB,uBACtB,cAAe,gBACf,cAAe,gBACf,eAAgB,gBAClB,EACMC,GAAKD,GAEEE,GAA2B,CACtC,MAAO,CACLD,GAAG,iBACHA,GAAG,iBACHA,GAAG,qBACHA,GAAG,cACHA,GAAG,cACHA,GAAG,cACL,EACA,oBAAqB,CACnBA,GAAG,iBACHA,GAAG,qBACHA,GAAG,cACHA,GAAG,cACHA,GAAG,cACL,EACA,UAAW,CACTA,GAAG,iBACHA,GAAG,cACHA,GAAG,cACHA,GAAG,cACL,CACF,EAYO,IAAME,GAAuC,IACvCC,GAAwC,IAGxCC,GAAsB,sBACtBC,GAAkB,kBAClBC,GAAe,eAEfC,GAAiB,CAC5B,eAAgB,iBAChB,MAAO,OACT,EAEaC,GAAyB,CACpC,MAAO,QACP,QAAS,UACT,OAAQ,QACV,EAEaC,GAAgB,CAC3B,KAAM,OACN,KAAM,OACN,YAAa,cACb,aAAc,cAChB,EAEaC,GAAyB,CACpC,YAAa,KACb,SAAU,CACZ,EAkBO,IAAMC,GAA0B,CACrC,aAAc,eACd,gBAAiB,kBACjB,QAAS,SACX,ECvKA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,YAAAE,GAAA,wBAAAC,GAAA,kCAAAC,GAAA,0BAAAC,GAAA,MAAAC,EAAA,WAAAC,GAAA,UAAAC,KCAA,IAAMC,GAAY,OAAO,OAAO,IAAI,EAC9BC,GAAU,OAAO,OAAO,IAAI,EAC5BC,GAAgB,CAAC,EACjBC,GAAgB,OAAO,OAAO,IAAI,EAClCC,GAAkB,OAAO,OAAO,IAAI,EACpCC,GAAkB,OAAO,OAAO,IAAI,EACpCC,GAAe,SAErB,SAASC,GAAIC,KAAaC,EAAM,CAC5B,IAAMC,EAASC,GAAmBH,CAAQ,EACpCI,EAAe,GAAGF,CAAM,KACxBG,EAAY,CAAC,CAACb,GAAUQ,CAAQ,EAElCM,EAAMN,EACV,GAAI,CAACK,EAGD,GAAIb,GAAUY,CAAY,EACtBE,EAAMF,MAGN,OAAM,IAAI,MAAM,iCAAiCJ,CAAQ,EAAE,EAKnE,QAAWO,IAAW,CAACX,GAAgBI,CAAQ,EAAGL,GAAcO,CAAM,EAAGR,EAAa,EAClF,GAAIa,GACA,QAAWC,KAAUD,EACjB,GAAIC,EAAON,EAAQF,EAAUC,CAAI,IAAM,GACnC,OAIhB,OAAKI,GAGDJ,EAAK,QAAQD,CAAQ,EAElBR,GAAUc,CAAG,EAAE,MAAMb,GAAQS,CAAM,EAAE,MAAOD,CAAI,CAC3D,CACO,SAASE,GAAmBH,EAAU,CACzC,IAAMS,EAAeX,GAAa,KAAKE,CAAQ,EAC/C,GAAIS,IAAiB,KACjB,MAAM,IAAI,MAAM,iCAAiCT,CAAQ,EAAE,EAE/D,OAAOS,EAAa,CAAC,CACzB,CACA,IAAMC,GAAqB,CACvB,yBAA2BC,GAAS,CAChC,IAAMC,EAAa,CAAC,EACpB,QAAWZ,KAAYW,EAAM,CACzB,IAAME,EAAaV,GAAmBH,CAAQ,EAExCE,EAASW,KAAcpB,GAAUA,GAAQoB,CAAU,EAAKpB,GAAQoB,CAAU,EAAI,CAAE,MAAO,OAAO,OAAO,IAAI,EAAG,OAAQ,EAAM,EAChI,GAAIX,EAAO,QACN,QAAQ,MAAQ,QAAQ,KAAK,2DAA2DF,CAAQ,GAAG,UAE/FR,GAAUQ,CAAQ,GACtB,QAAQ,MAAQ,QAAQ,KAAK,6DAA6DA,CAAQ,GAAG,UAEjG,OAAOW,EAAKX,CAAQ,GAAM,WAAY,CACvCH,GAAgBG,CAAQ,IAEvB,QAAQ,MAAQ,QAAQ,KAAK,6CAA6CA,CAAQ,wCAAwC,EAE/H,IAAMc,EAAKtB,GAAUQ,CAAQ,EAAIW,EAAKX,CAAQ,EAC9CY,EAAW,KAAKZ,CAAQ,EAEpBA,IAAa,GAAGa,CAAU,UAC1BC,EAAG,KAAKZ,EAAO,KAAK,CAE5B,CACJ,CACA,OAAOU,CACX,EACA,2BAA6BD,GAAS,CAClC,IAAII,EACJ,QAAWf,KAAYW,EAAM,CACzB,GAAI,CAACd,GAAgBG,CAAQ,EACzB,MAAM,IAAI,MAAM,0CAA0CA,CAAQ,EAAE,EAExE,GAAK,GAAAe,EAAKtB,GAAQU,GAAmBH,CAAQ,CAAC,KAAO,MAAQe,IAAO,SAAkBA,EAAG,OACrF,MAAM,IAAI,MAAM,uDAAuDf,CAAQ,GAAG,EAEtF,OAAOR,GAAUQ,CAAQ,CAC7B,CACJ,EACA,0BAA4BW,IACxBZ,GAAI,2BAA4B,OAAO,KAAKY,CAAI,CAAC,EAC1CZ,GAAI,yBAA0BY,CAAI,GAE7C,uBAAyBA,GAAS,CAC9B,QAAWX,KAAYW,EAAM,CACzB,GAAInB,GAAUQ,CAAQ,EAClB,MAAM,IAAI,MAAM,mDAAmD,EAEvEH,GAAgBG,CAAQ,EAAI,EAChC,CACJ,EACA,qBAAuBW,GAAS,CAC5B,QAAWX,KAAYW,EACnB,OAAOd,GAAgBG,CAAQ,CAEvC,EACA,mBAAqBM,GACVd,GAAUc,CAAG,EAExB,yBAA2BE,GAAW,CAClCd,GAAc,KAAKc,CAAM,CAC7B,EACA,yBAA0B,CAACN,EAAQM,IAAW,CACrCb,GAAcO,CAAM,IACrBP,GAAcO,CAAM,EAAI,CAAC,GAC7BP,GAAcO,CAAM,EAAE,KAAKM,CAAM,CACrC,EACA,2BAA4B,CAACR,EAAUQ,IAAW,CACzCZ,GAAgBI,CAAQ,IACzBJ,GAAgBI,CAAQ,EAAI,CAAC,GACjCJ,GAAgBI,CAAQ,EAAE,KAAKQ,CAAM,CACzC,EACA,mBAAqBQ,GAAgB,CAEjC,GAAKA,EAMD,QAAWC,KAAQD,EAAa,CAC5B,GAAI,CAACvB,GAAQwB,CAAI,EACb,MAAM,IAAI,MAAM,yCAAyCA,CAAI,EAAE,EAEnExB,GAAQwB,CAAI,EAAE,OAAS,EAC3B,KAVA,SAAWA,KAAQxB,GACfA,GAAQwB,CAAI,EAAE,OAAS,EAWnC,CACJ,EACAP,GAAmB,wBAAwB,EAAEA,EAAkB,EAC/D,IAAOQ,EAAQnB,GC3If,IAAMoB,GAAQ,uBAEC,SAARC,GAA2BC,KAAmBC,EAAqB,CACxE,IAAMC,EAAWD,EAAK,CAAC,EAGjBE,EACH,OAAOD,GAAa,UAAYA,IAAa,KAC1CA,EACAD,EAGN,OAAOD,EAAO,QAAQF,GAAO,SAAqBM,EAAOC,EAASC,EAAO,CAEvE,GAAIN,EAAOM,EAAQ,CAAC,IAAM,KAAON,EAAOM,EAAQF,EAAM,MAAM,IAAM,IAChE,OAAOC,EAGT,IAAME,EAGJ,OAAO,UAAU,eAAe,KAAKJ,EAAmBE,CAAO,EAC3DF,EAAkBE,CAAO,EACzB,OAGN,OAAIE,GAAqB,KAChB,GAEF,OAAOA,CAAgB,CAChC,CAAC,CACH,CCzBA,IAAMC,GAAkB,QAClBC,GAAsB,KACtBC,GAAgD,CAAC,EAEnDC,GAAkBH,GAClBI,GAAsBJ,GAAgB,MAAM,GAAG,EAAE,CAAC,EAClDK,GAA0BH,GAYvBI,GAASC,EAAI,yBAA0B,CAC5C,oBAAqB,eAAqBC,EAAiC,CAEzE,GAAM,CAACC,CAAY,EAAID,EAAS,YAAY,EAAE,MAAM,GAAG,EAGvD,GAAIA,EAAS,YAAY,IAAML,GAAgB,YAAY,GAIvDM,IAAiBL,GAGrB,IAAIK,IAAiBR,GAAqB,CACxCE,GAAkBH,GAClBI,GAAsBH,GACtBI,GAA0BH,GAC1B,MACF,CACA,GAAI,CACFG,GAA2B,MAAME,EAAI,2BAA4BC,CAAQ,GAAMN,GAG/EC,GAAkBK,EAClBJ,GAAsBK,CACxB,OAASC,EAAO,CACd,QAAQ,MAAMA,CAAK,CACrB,EACF,CACF,CAAC,EA0CM,SAASC,MAAUC,EAAiC,CACzD,IAAMC,EAAI,CACR,IAAO,OACT,EACA,QAAWC,KAAOF,EAChBC,EAAE,GAAGC,CAAG,GAAG,EAAI,IAAIA,CAAG,IACtBD,EAAE,IAAIC,CAAG,EAAE,EAAI,KAAKA,CAAG,IAEzB,OAAOD,CACT,CAEO,SAASE,EACdC,EACAC,EACQ,CACR,OAAOC,GAASb,GAAwBW,CAAG,GAAKA,EAAKC,CAAI,EAKtD,QAAQ,gBAAiB,MAAQ,CACtC,CAEO,SAASE,GAAQT,EAAcU,EAA0C,CAC9E,IAAIC,EAAM,mDACV,MAAI,CAACD,GAAYb,EAAI,kBAAkB,EAAE,WAEvCc,EAAM,GADYd,EAAI,mBAAmB,EAAE,QAAQ,IACjC,0DAA0D,mBAAmBG,EAAM,OAAO,CAAC,IAExG,CACL,YAAaK,EAAE,kDAAmD,CAChE,SAAUL,EAAM,QAChB,GAAM,yCAAyCW,CAAG,KAClD,GAAM,MACR,CAAC,CACH,CACF,CCnIA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,yBAAAE,GAAA,kCAAAC,GAAA,0BAAAC,KCIO,IAAMC,GAAqB,CAChCC,EACAC,EAAqB,QAEnB,cAAcA,CAAK,CACnB,eAAgBC,EAAe,CAC7B,MAAM,GAAGA,CAAM,EACf,KAAK,KAAOF,EAGRE,EAAO,CAAC,GAAG,QAAU,KAAK,OAE5B,OAAO,eAAe,KAAM,QAAS,CAAE,aAAc,GAAM,SAAU,GAAM,MAAOA,EAAO,CAAC,GAAG,KAAM,CAAC,EAElG,MAAM,mBACR,MAAM,kBAAkB,KAAM,KAAK,WAAW,CAElD,CACF,EAEWC,GAAiCJ,GAAmB,kBAAkB,EACtEK,GAA0CL,GAAmB,2BAA2B,EACxFM,GAA2CN,GAAmB,4BAA4B,EAC1FO,GAAsCP,GAAmB,uBAAuB,EAChFQ,GAAoCR,GAAmB,qBAAqB,EAC5ES,GAA0CT,GAAmB,2BAA2B,EACxFU,GAAuCV,GAAmB,wBAAwB,EAClFW,GAAqCX,GAAmB,sBAAsB,EAC9EY,GAAyCZ,GAAmB,0BAA0B,EACtFa,GAA+Cb,GAAmB,iCAAkCY,EAAwB,EAC5HE,GAAwCd,GAAmB,yBAAyB,EACpFe,GAAkDf,GAAmB,oCAAqCc,EAAuB,EACjIE,GAA8ChB,GAAmB,gCAAiCc,EAAuB,EACzHG,GAA+CjB,GAAmB,gCAAgC,EAClGkB,GAAoDlB,GAAmB,qCAAqC,EAC5GmB,GAAsCnB,GAAmB,wBAAyBkB,EAAmC,EDnC3H,IAAME,GAAoCC,GAAmB,qBAAqB,EAG5EC,GAAsCD,GAAmB,uBAAuB,EAEhFE,GAA8CF,GAAmB,+BAA+B,EELtG,IAAMG,GAAc,IACdC,GAAe,GAAKD,GACpBE,GAAc,GAAKD,GACnBE,GAAgB,GAAKD,GACrBE,GAAe,IAAMF,GAErBG,GAAsB,CAACC,EAAmBC,IACrDC,GAAkBC,GAAcH,EAAWC,CAAY,CAAC,EAG7CG,GAAuB,CAACJ,EAAmBC,IACtDC,GAAkBC,GAAcH,EAAW,CAACC,CAAY,CAAC,EASpD,SAASI,GACdC,EACA,CAAE,kBAAAC,EAAmB,aAAAN,EAAc,MAAAO,CAAM,EACjC,CAER,GAAI,EAAEC,GAAYH,CAAI,GAAK,OAAO,UAAU,SAAS,KAAKA,CAAI,IAAM,iBAClE,MAAM,IAAI,UAAU,mCAAmC,EAEzD,IAAMN,EAAY,OAAOM,GAAS,SAAWA,EAAOA,EAAK,YAAY,EACjEI,EAAUC,EAASC,EACvB,GAAIL,EAAkB,OAAQ,CAC5B,IAAMM,EAASN,EAAkBA,EAAkB,OAAS,CAAC,EACvDO,EAAWP,EAAkB,CAAC,EACpC,GAAIP,GAAaa,EACfF,EAAUI,GAAqB,CAAE,WAAYf,EAAW,YAAaa,EAAQ,aAAAZ,CAAa,CAAC,EAC3FW,EAAOb,GAAoBY,EAASV,CAAY,EAChDS,EAAWC,EAAUE,EACjBT,GAAqBO,EAASV,CAAY,EAC1CM,EAAkBA,EAAkB,OAAS,CAAC,UACzCC,GAASR,EAAYc,EAE9BH,EAAUI,GAAqB,CAAE,WAAYf,EAAW,YAAac,EAAU,aAAAb,CAAa,CAAC,EAC7FW,EAAOb,GAAoBY,EAASV,CAAY,EAChDS,EAAWN,GAAqBO,EAASV,CAAY,MAErD,SAASe,EAAIT,EAAkB,OAAS,EAAGS,GAAK,EAAGA,IACjD,GAAIhB,GAAaO,EAAkBS,CAAC,EAAG,CACrCL,EAAUJ,EAAkBS,CAAC,EAE7BJ,EAAOL,EAAkBS,EAAI,CAAC,EAC9BN,EAAWM,EAAI,EACXT,EAAkBS,EAAI,CAAC,EACtBR,EAAQJ,GAAqBO,EAASV,CAAY,EAAI,OAC3D,KACF,CAGN,CACA,MAAO,CAAE,SAAAS,EAAU,QAAAC,EAAS,KAAAC,CAAK,CACnC,CAaO,SAASK,GAAmBC,EAA6B,CAC9D,OAAO,IAAI,KAAKA,CAAI,EAAE,YAAY,CACpC,CAEO,SAASC,GAAqBC,EAAwB,CAC3D,OAAO,IAAI,KAAKA,CAAQ,CAC1B,CAEO,SAASC,GAAsB,CAAE,WAAAC,EAAY,YAAAC,EAAa,aAAAC,CAAa,EAEnE,CACT,IAAMC,EAAkBN,GAAoBI,CAAW,EACnDG,EAAaC,GAAcF,EAAiBD,CAAY,EACtDI,EAAU,IAAI,KAAKN,CAAU,EAC/BO,EACJ,GAAID,EAAUF,EAAY,CACxB,GAAIE,GAAWH,EACb,OAAOF,EAGPM,EAAYJ,EACZ,GACEI,EAAYF,GAAcE,EAAW,CAACL,CAAY,QAC3CI,EAAUC,EAEvB,KAEE,IACEA,EAAYH,EACZA,EAAaC,GAAcD,EAAYF,CAAY,QAC5CI,GAAWF,GAGtB,OAAOT,GAAkBY,CAAS,CACpC,CAEO,SAASC,GAAoB,CAAE,KAAAZ,EAAM,YAAAK,EAAa,aAAAC,CAAa,EAE1D,CACV,IAAMO,EAAU,IAAI,KAAKb,CAAI,EACvBc,EAAQb,GAAoBI,CAAW,EAC7C,OAAOQ,EAAUC,GAASD,EAAUJ,GAAcK,EAAOR,CAAY,CACvE,CAEO,SAASG,GAAeT,EAAqBe,EAA0B,CAC5E,IAAMC,EAAI,IAAI,KAAKhB,CAAI,EACvB,OAAAgB,EAAE,QAAQA,EAAE,QAAQ,EAAID,CAAU,EAC3BC,CACT,CA0BO,SAASC,GAAqBC,EAAiBC,EAAyB,CAC7E,OAAOC,GAAoBF,CAAO,EAAE,QAAQ,EAAIE,GAAoBD,CAAO,EAAE,QAAQ,CACvF,CAqBO,SAASE,IAAqB,CACnC,IAAMC,EAAW,cAEjB,OAAO,OAAO,UAAc,IAExBA,EAIC,UAAU,WAAmB,UAAU,UAAYA,CAC1D,CAEO,SAASC,GACdC,EACAC,EAAuC,CAAE,MAAO,QAAS,IAAK,SAAU,EAChE,CACR,IAAMC,EAAU,IAAI,KAAKF,CAAI,EAGvBG,EAASN,GAAU,EAGzB,OAAK,MAAMK,EAAQ,QAAQ,CAAC,EACrB,GAD+BA,EAAQ,mBAAmBC,EAAQF,CAAO,CAElF,CAkBO,SAASG,GAAaC,EAAmB,CAC9C,OAAO,OAAOA,GAAQ,UAAY,6CAA6C,KAAKA,CAAG,CACzF,CCtKO,IAAMC,GAAc,OAAO,SAAS,EAC9BC,GAAUC,GAAKA,IAAMF,GACrBG,GAAQD,GAAKA,IAAM,KACnBE,GAAUF,GAAK,OAAOA,EAAM,IAC5BG,GAAYH,GAAK,OAAOA,GAAM,UAC9BI,GAAWJ,GAAK,OAAOA,GAAM,SAC7BK,GAAWL,GAAK,OAAOA,GAAM,SAC7BM,GAAWN,GAAK,CAACC,GAAMD,CAAC,GAAK,OAAOA,GAAM,SAC1CO,GAAaP,GAAK,OAAOA,GAAM,WAcrC,IAAMQ,GAAU,CAACC,EAAQC,IAC1BC,GAAWF,EAAO,IAAI,EAAUA,EAAO,KAAKC,CAAQ,EACjDD,EAAO,MAAQ,IAIXG,GAAN,MAAMC,UAA2B,KAAM,CAC5C,aACA,UACA,MACA,UACA,WAEA,YACEC,EACAC,EACAC,EACAC,EACAC,EAAmB,GACnBC,EAAqB,GACrB,CACA,IAAMC,EAAaN,GACjB,YAAYE,CAAS,iBAAiBE,GAAYH,CAAY,iBAChE,MAAMK,CAAU,EAChB,KAAK,aAAeL,EACpB,KAAK,UAAYC,EACjB,KAAK,MAAQC,EACb,KAAK,UAAYE,GAAa,GAC9B,KAAK,WAAa,KAAK,cAAc,EACrC,KAAK,QAAU,GAAGC,CAAU;AAAA,EAAK,KAAK,aAAa,CAAC,GACpD,KAAK,KAAO,KAAK,YAAY,KACzB,MAAM,mBACR,MAAM,kBAAkB,KAAMP,CAAkB,CAEpD,CAEA,eAAyB,CAEvB,OADkB,KAAK,MAAM,MAAM,gCAAgC,GAAK,CAAC,GACxD,KAAKQ,GAAYA,EAAS,QAAQ,qBAAqB,IAAM,EAAE,GAAK,EACvF,CAEA,cAAwB,CACtB,MAAO;AAAA,eACI,KAAK,UAAU;AAAA,eACf,KAAK,SAAS;AAAA,eACd,KAAK,aAAa,QAAQ,MAAO,EAAE,CAAC;AAAA,eACpC,KAAK,SAAS;AAAA,eACd,KAAK,KAAK;AAAA,CAEvB,CACF,EAKMC,GAAoB,CACxBb,EACAQ,EACAM,EACAT,EACAC,EACAC,IAEO,IAAIJ,GACTE,EACAC,GAAgBP,GAAQC,CAAM,EAC9BO,GAAa,OAAOC,EACpB,KAAK,UAAUA,CAAK,EACpBR,EAAO,KACPc,CACF,EAiBK,IAAMC,GACOC,GAAmC,CACnD,SAASC,EAASC,EAAOC,EAAS,GAAI,CACpC,GAAIC,GAAQF,CAAK,GAAMA,IAAUF,EAAY,OAAOA,EACpD,MAAMK,GAAeJ,EAASC,EAAOC,CAAM,CAC7C,CACA,OAAAF,EAAQ,KAAO,IACTK,GAAUN,CAAS,EAAU,GAAGA,EAAY,OAAS,OAAO,GACpD,IAAIA,CAAS,IAEpBC,CACT,EAyCK,IAAMM,GACX,SAAUC,EAAO,CACf,GAAIC,GAAQD,CAAK,EAAG,MAAO,CAAC,EAC5B,GAAIE,GAASF,CAAK,GAAK,CAAC,MAAM,QAAQA,CAAK,EACzC,OAAO,OAAO,OAAO,CAAC,EAAGA,CAAK,EAEhC,MAAMG,GAAeJ,GAAQC,CAAK,CACpC,EAGWI,GACX,CAACC,EAAYC,EAAkB,WAAoE,CACnG,SAASC,EAASP,EAAO,CACvB,IAAM,EAAID,GAAOC,CAAK,EAChBQ,EAAY,OAAO,KAAKH,CAAO,EAC/BI,EAAc,OAAO,KAAK,CAAC,EAAE,KAAKC,GAAQ,CAACF,EAAU,SAASE,CAAI,CAAC,EACzE,GAAID,EACF,MAAMN,GACJI,EACAP,EACAM,EACA,4BAA4BG,CAAW,QAAQH,CAAM,OACvD,EAKF,IAAMK,EAAYH,EAAU,KAAKI,GACRP,EAAQO,CAAQ,EAChB,KAAK,SAAS,OAAO,GAAK,CAAC,EAAE,eAAeA,CAAQ,CAC5E,EACD,GAAID,EACF,MAAMR,GACJI,EACA,EAAEI,CAAS,EACX,GAAGL,CAAM,IAAIK,CAAS,GACtB,0BAA0BA,CAAS,SAASL,CAAM,QAClD,iBAAiBO,GAAQR,EAAQM,CAAS,CAAC,EAAE,OAAO,CAAC,CAAC,GACtD,GACF,EAGF,IAAMG,EAAUb,GAAQD,CAAK,EACzB,CAACe,EAAKC,IAAQ,OAAO,OAAOD,EAAK,CAAE,CAACC,CAAG,EAAGX,EAAQW,CAAG,EAAEhB,CAAK,CAAE,CAAC,EAC/D,CAACe,EAAKC,IAAQ,CACd,IAAMC,EAASZ,EAAQW,CAAG,EAC1B,OAAIC,EAAO,KAAK,SAAS,UAAU,GAAK,CAAC,EAAE,eAAeD,CAAG,EACpD,OAAO,OAAOD,EAAK,CAAC,CAAC,EAErB,OAAO,OAAOA,EAAK,CAAE,CAACC,CAAG,EAAGC,EAAO,EAAED,CAAG,EAAG,GAAGV,CAAM,IAAIU,CAAG,EAAE,CAAE,CAAC,CAE3E,EACF,OAAOR,EAAU,OAAOM,EAAS,CAAC,CAAC,CACrC,CACA,OAAAP,EAAQ,KAAO,IASN;AAAA,GARO,OAAO,KAAKF,CAAO,EAAE,IAChCW,GACaX,EAAQW,CAAG,EAAE,KAAK,SAAS,UAAU,EAC/C,GAAGA,CAAG,MAAMH,GAAQR,EAAQW,CAAG,EAAG,CAAE,OAAQ,EAAK,CAAC,CAAC,GACnD,GAAGA,CAAG,KAAKH,GAAQR,EAAQW,CAAG,CAAC,CAAC,EAGtC,EACqB,KAAK;AAAA,GAAO,CAAC;AAAA,IAE7BT,CACT,EA+BO,SAASW,GAAOC,EAAOC,EAAS,GAAI,CACzC,GAAI,EAAAC,GAAQF,CAAK,GAAKG,GAAQH,CAAK,GACnC,MAAMI,GAAeL,GAAOC,EAAOC,CAAM,CAC3C,CACAF,GAAM,KAAO,IAAM,OAYZ,IAAMM,GACX,SAASA,EAAQC,EAAOC,EAAS,GAAI,CACnC,GAAIC,GAAQF,CAAK,EAAG,MAAO,GAC3B,GAAIG,GAASH,CAAK,EAAG,OAAOA,EAC5B,MAAMI,GAAeL,EAAQC,EAAOC,CAAM,CAC5C,EAwBK,IAAMI,GACX,SAASA,EAAQC,EAAOC,EAAS,GAAI,CACnC,GAAIC,GAAQF,CAAK,EAAG,MAAO,GAC3B,GAAIG,GAASH,CAAK,EAAG,OAAOA,EAC5B,MAAMI,GAAeL,EAAQC,EAAOC,CAAM,CAC5C,EAqEF,SAASI,MAAaC,EAAW,CAC/B,SAASC,EAAOC,EAAcC,EAAS,GAAI,CACzC,QAAWC,KAAUJ,EACnB,GAAI,CACF,OAAOI,EAAOF,EAAOC,CAAM,CAC7B,MAAY,CAAC,CAEf,MAAME,GAAeJ,EAAOC,EAAOC,CAAM,CAC3C,CACA,OAAAF,EAAM,KAAO,IAAM,IAAID,EAAU,IAAIM,GAAMC,GAAQD,CAAE,CAAC,EAAE,KAAK,KAAK,CAAC,IAC5DL,CACT,CAGO,IAAMO,GAAUT,GC7avB,IAAIU,GACSC,GAA6B,CACxC,KAAM,OACN,KAAM,OACN,MAAO,QACP,MAAO,OACT,EAEMC,GAEF,CACF,cAAe,CAAC,EAAG,UAAW,OAAO,OAAO,IAAI,CAClD,EAEMC,GAAiB,CACrB,CAACF,GAA2B,IAAI,EAAG,EAAIG,GACvC,CAACH,GAA2B,IAAI,EAAG,EAAIG,GACvC,CAACH,GAA2B,KAAK,EAAG,GAAKG,GACzC,CAACH,GAA2B,KAAK,EAAG,GAAKG,EAC3C,EAEMC,GAA2BC,GAAS,CACxC,SAAWC,GAAU,CAEnB,GADAA,EAAQC,GAAOD,CAAK,EAChBA,EAAM,SAAW,EACnB,MAAM,IAAI,UAAU,mCAAmC,EAEzD,OAAOA,CACT,EACA,cAAeE,GACf,KAAMA,GACN,oBAAqBA,EACvB,CAAC,EAsBD,eAAeC,IAAgC,CAC7C,IAAMC,EAAYC,EAAI,kBAAkB,EAClCC,EAAcD,EAAI,oBAAoB,EACtCE,EAAWH,EAAU,oCAAoC,aACzDI,EAAaJ,EAAU,oCAAoC,QAC3DK,EAAiB,CAACC,EAAMC,IAAaD,EAAK,KAAKf,GAA2B,UAAUgB,CAAQ,EAAG,CAAE,UAAAP,EAAW,YAAAE,CAAY,CAAC,EAG/H,GAAIX,GAA2B,aAAc,OAQ7C,IAAIiB,EAAmB,GACjBC,EAAQ,IAAM,CAAED,EAAU,EAAK,EACrCjB,GAA2B,aAAekB,EAQ1C,MAAM,QAAQ,IACV,OAAO,QAAQR,EAAI,wCAAwC,CAAC,EAC3D,IAAI,CAAC,CAACS,EAAOC,CAAW,IAChB,CAAC,CAACA,EAAY,QAAUV,EAAI,kCAAmCS,EAAO,IAAM,CAAC,CAAC,EAAE,MAAM,IAAM,CAAC,CAAC,CACtG,CACL,EAGA,QAAWE,KAASrB,GAA2B,cAAe,CAC5D,GAAIiB,EAAS,MACb,IAAMD,EAAWK,EAAM,SACjBC,EAAUT,EAAWG,CAAQ,GAAK,EAElCO,EAAQF,EAAM,MACpB,GAAK,KAAK,IAAI,EAAIC,GAAYC,EAAO,CACnC,GAAI,CACE,CAACX,EAASI,CAAQ,GAAKF,EAAeO,EAAM,cAAeL,CAAQ,IACrE,MAAMF,EAAeO,EAAM,KAAML,CAAQ,EACzCJ,EAASI,CAAQ,EAAI,IAGnBJ,EAASI,CAAQ,GAAKF,EAAeO,EAAM,oBAAqBL,CAAQ,GAC1E,OAAOJ,EAASI,CAAQ,CAE5B,OAASQ,EAAG,CACV,QAAQ,MAAM,2DAA4DR,EAAUQ,CAAC,CACvF,CAGAX,EAAWG,CAAQ,EAAI,KAAK,IAAI,CAClC,CACF,CAIIhB,GAA2B,eAAiBkB,IAChDlB,GAA2B,cAAgB,IAAM,CAC/C,IAAMyB,EAAY,WAChB,IAAM,CACJ,OAAOzB,GAA2B,aAClCQ,GAA6B,CAC/B,EACAV,EACF,EACA,MAAO,IAAM,aAAa2B,CAAS,CACrC,GAAG,EACL,CAEA,SAASC,IAAsB,CACzB1B,GAA2B,eAC7BA,GAA2B,aAAa,EACxC,OAAOA,GAA2B,cAGpCA,GAA2B,cAAc,QAAQ,CAAC,CAAE,SAAAgB,CAAS,IAAM,CACjEhB,GAA2B,UAAUgB,CAAQ,EAAI,OAAO,OAAO,IAAI,CACrE,CAAC,CACH,CAEAN,EAAI,yBAA0B,CAC5B,gCAAiC,UAAY,CAC3C,OAAOF,GAA6B,EAAE,MAAO,GAAM,CACjD,QAAQ,MAAM,wCAAyC,CAAC,CAC1D,CAAC,CACH,EACA,oDAAqD,UAAY,CAC/D,IAAMC,EAAYC,EAAI,kBAAkB,EAExCD,EAAU,oCAAsC,CAC9C,aAAc,OAAO,OAAO,IAAI,EAChC,QAAS,OAAO,OAAO,IAAI,CAC7B,EACAiB,GAAmB,CACrB,EACA,+CAAgD,SAAUC,EAAS,CACjE,IAAMC,EAAS,IAAI,IACnB,OAAW,CAAE,KAAAC,EAAM,iBAAAC,CAAiB,IAAKH,EAAS,CAChD,GAAI,CAACE,GAAQ,CAACC,EAAkB,MAAM,IAAI,MAAM,+DAA+D,EAE/G,IAAMP,EAAQtB,GAAe4B,CAAI,EACjC,GAAI,CAACN,EACH,MAAM,IAAI,WAAW,eAAe,EAOtC,GAHMzB,IAAiByB,IAAQzB,GAAgByB,GAE/CpB,GAAyB2B,CAAgB,EACrCF,EAAO,IAAIE,EAAiB,QAAQ,EACtC,MAAM,IAAI,MAAM,8CAAgDA,EAAiB,QAAQ,EAE3FF,EAAO,IAAIE,EAAiB,QAAQ,EAEpC9B,GAA2B,UAAU8B,EAAiB,QAAQ,EAAI,OAAO,OAAO,IAAI,EACpF9B,GAA2B,cAAc,KAAK,CAC5C,GAAG8B,EACH,MAAAP,CACF,CAAC,CACH,CACF,CACF,CAAC,EC5LM,IAAMQ,GAAe,GAAKC,GAEpBC,GAAiB,IAAMD,GCP7B,IAAME,GAAQ,IAAI,WAAW,CAAC,EAQ9B,SAASC,GAAOC,EAAIC,EAAI,CAC3B,GAAID,IAAOC,EACP,MAAO,GAEX,GAAID,EAAG,aAAeC,EAAG,WACrB,MAAO,GAEX,QAASC,EAAK,EAAGA,EAAKF,EAAG,WAAYE,IACjC,GAAIF,EAAGE,CAAE,IAAMD,EAAGC,CAAE,EAChB,MAAO,GAGf,MAAO,EACX,CACO,SAASC,EAAOC,EAAG,CACtB,GAAIA,aAAa,YAAcA,EAAE,YAAY,OAAS,aAClD,OAAOA,EAEX,GAAIA,aAAa,YACb,OAAO,IAAI,WAAWA,CAAC,EAE3B,GAAI,YAAY,OAAOA,CAAC,EACpB,OAAO,IAAI,WAAWA,EAAE,OAAQA,EAAE,WAAYA,EAAE,UAAU,EAE9D,MAAM,IAAI,MAAM,mCAAmC,CACvD,CCvBA,SAASC,GAAKC,EAAUC,EAAM,CAC1B,GAAID,EAAS,QAAU,IACnB,MAAM,IAAI,UAAU,mBAAmB,EAG3C,QADIE,EAAW,IAAI,WAAW,GAAG,EACxBC,EAAI,EAAGA,EAAID,EAAS,OAAQC,IACjCD,EAASC,CAAC,EAAI,IAElB,QAASC,EAAI,EAAGA,EAAIJ,EAAS,OAAQI,IAAK,CACtC,IAAIC,EAAIL,EAAS,OAAOI,CAAC,EACrBE,EAAKD,EAAE,WAAW,CAAC,EACvB,GAAIH,EAASI,CAAE,IAAM,IACjB,MAAM,IAAI,UAAUD,EAAI,eAAe,EAE3CH,EAASI,CAAE,EAAIF,CACnB,CACA,IAAIG,EAAOP,EAAS,OAChBQ,EAASR,EAAS,OAAO,CAAC,EAC1BS,EAAS,KAAK,IAAIF,CAAI,EAAI,KAAK,IAAI,GAAG,EACtCG,EAAU,KAAK,IAAI,GAAG,EAAI,KAAK,IAAIH,CAAI,EAI3C,SAASI,EAAOC,EAAQ,CASpB,GAPIA,aAAkB,aACb,YAAY,OAAOA,CAAM,EAC9BA,EAAS,IAAI,WAAWA,EAAO,OAAQA,EAAO,WAAYA,EAAO,UAAU,EAEtE,MAAM,QAAQA,CAAM,IACzBA,EAAS,WAAW,KAAKA,CAAM,IAE/B,EAAEA,aAAkB,YACpB,MAAM,IAAI,UAAU,qBAAqB,EAE7C,GAAIA,EAAO,SAAW,EAClB,MAAO,GAOX,QAJIC,EAAS,EACTC,EAAS,EACTC,EAAS,EACTC,EAAOJ,EAAO,OACXG,IAAWC,GAAQJ,EAAOG,CAAM,IAAM,GACzCA,IACAF,IAMJ,QAHII,GAASD,EAAOD,GAAUL,EAAU,IAAO,EAC3CQ,EAAM,IAAI,WAAWD,CAAI,EAEtBF,IAAWC,GAAM,CAIpB,QAHIG,EAAQP,EAAOG,CAAM,EAErBX,EAAI,EACCgB,EAAMH,EAAO,GAAIE,IAAU,GAAKf,EAAIU,IAAYM,IAAQ,GAAKA,IAAOhB,IACzEe,GAAU,IAAMD,EAAIE,CAAG,IAAO,EAC9BF,EAAIE,CAAG,EAAKD,EAAQZ,IAAU,EAC9BY,EAASA,EAAQZ,IAAU,EAE/B,GAAIY,IAAU,EACV,MAAM,IAAI,MAAM,gBAAgB,EAEpCL,EAASV,EACTW,GACJ,CAGA,QADIM,GAAMJ,EAAOH,EACVO,KAAQJ,GAAQC,EAAIG,EAAG,IAAM,GAChCA,KAIJ,QADIC,GAAMd,EAAO,OAAOK,CAAM,EACvBQ,GAAMJ,EAAM,EAAEI,GACjBC,IAAOtB,EAAS,OAAOkB,EAAIG,EAAG,CAAC,EAEnC,OAAOC,EACX,CAIA,SAASC,EAAaX,EAAQ,CAC1B,GAAI,OAAOA,GAAW,SAClB,MAAM,IAAI,UAAU,iBAAiB,EAEzC,GAAIA,EAAO,SAAW,EAClB,OAAO,IAAI,WAEf,IAAIY,EAAM,EAEV,GAAIZ,EAAOY,CAAG,IAAM,IAMpB,SAFIX,EAAS,EACTC,EAAS,EACNF,EAAOY,CAAG,IAAMhB,GACnBK,IACAW,IAMJ,QAHIP,GAAUL,EAAO,OAASY,GAAOf,EAAU,IAAO,EAClDgB,EAAO,IAAI,WAAWR,CAAI,EAEvBL,EAAOY,CAAG,GAAG,CAEhB,IAAIL,EAAQjB,EAASU,EAAO,WAAWY,CAAG,CAAC,EAE3C,GAAIL,IAAU,IACV,OAGJ,QADIf,EAAI,EACCsB,EAAMT,EAAO,GAAIE,IAAU,GAAKf,EAAIU,IAAYY,IAAQ,GAAKA,IAAOtB,IACzEe,GAAUZ,EAAOkB,EAAKC,CAAG,IAAO,EAChCD,EAAKC,CAAG,EAAKP,EAAQ,MAAS,EAC9BA,EAASA,EAAQ,MAAS,EAE9B,GAAIA,IAAU,EACV,MAAM,IAAI,MAAM,gBAAgB,EAEpCL,EAASV,EACToB,GACJ,CAEA,GAAIZ,EAAOY,CAAG,IAAM,IAKpB,SADIG,EAAMV,EAAOH,EACVa,IAAQV,GAAQQ,EAAKE,CAAG,IAAM,GACjCA,IAIJ,QAFIC,GAAM,IAAI,WAAWf,GAAUI,EAAOU,EAAI,EAC1CxB,GAAIU,EACDc,IAAQV,GACXW,GAAIzB,IAAG,EAAIsB,EAAKE,GAAK,EAEzB,OAAOC,IACX,CAIA,SAASC,EAAOC,EAAQ,CACpB,IAAIC,EAASR,EAAaO,CAAM,EAChC,GAAIC,EACA,OAAOA,EAEX,MAAM,IAAI,MAAM,OAAO9B,CAAI,YAAY,CAC3C,CACA,MAAO,CACH,OAAQU,EACR,aAAcY,EACd,OAAQM,CACZ,CACJ,CACA,IAAIG,GAAMjC,GACNkC,GAAkCD,GAC/BE,GAAQD,GChKf,IAAME,GAAN,KAAc,CACV,YAAYC,EAAMC,EAAQC,EAAY,CAClC,KAAK,KAAOF,EACZ,KAAK,OAASC,EACd,KAAK,WAAaC,CACtB,CACA,OAAOC,EAAO,CACV,GAAIA,aAAiB,WACjB,MAAO,GAAG,KAAK,MAAM,GAAG,KAAK,WAAWA,CAAK,CAAC,GAG9C,MAAM,MAAM,mCAAmC,CAEvD,CACJ,EAMMC,GAAN,KAAc,CACV,YAAYJ,EAAMC,EAAQI,EAAY,CAIlC,GAHA,KAAK,KAAOL,EACZ,KAAK,OAASC,EAEVA,EAAO,YAAY,CAAC,IAAM,OAC1B,MAAM,IAAI,MAAM,0BAA0B,EAE9C,KAAK,gBAAkBA,EAAO,YAAY,CAAC,EAC3C,KAAK,WAAaI,CACtB,CACA,OAAOC,EAAM,CACT,GAAI,OAAOA,GAAS,SAAU,CAC1B,GAAIA,EAAK,YAAY,CAAC,IAAM,KAAK,gBAC7B,MAAM,MAAM,qCAAqC,KAAK,UAAUA,CAAI,CAAC,KAAK,KAAK,IAAI,+CAA+C,KAAK,MAAM,EAAE,EAEnJ,OAAO,KAAK,WAAWA,EAAK,MAAM,KAAK,OAAO,MAAM,CAAC,CACzD,KAEI,OAAM,MAAM,mCAAmC,CAEvD,CACA,GAAGC,EAAS,CACR,OAAOC,GAAG,KAAMD,CAAO,CAC3B,CACJ,EACME,GAAN,KAAsB,CAClB,YAAYC,EAAU,CAClB,KAAK,SAAWA,CACpB,CACA,GAAGH,EAAS,CACR,OAAOC,GAAG,KAAMD,CAAO,CAC3B,CACA,OAAOI,EAAO,CACV,IAAMV,EAASU,EAAM,CAAC,EAChBJ,EAAU,KAAK,SAASN,CAAM,EACpC,GAAIM,GAAW,KACX,OAAOA,EAAQ,OAAOI,CAAK,EAG3B,MAAM,WAAW,qCAAqC,KAAK,UAAUA,CAAK,CAAC,+BAA+B,OAAO,KAAK,KAAK,QAAQ,CAAC,gBAAgB,CAE5J,CACJ,EACO,SAASH,GAAGI,EAAMC,EAAO,CAC5B,IAAIC,EAAIC,EACR,OAAO,IAAIN,GAAgB,OAAO,OAAO,OAAO,OAAO,CAAC,GAAKK,EAAKF,EAAK,YAAc,MAAQE,IAAO,OAASA,EAAK,CAAE,CAACF,EAAK,MAAM,EAAGA,CAAK,CAAE,GAAKG,EAAKF,EAAM,YAAc,MAAQE,IAAO,OAASA,EAAK,CAAE,CAACF,EAAM,MAAM,EAAGA,CAAM,CAAE,CAAC,CACpO,CACO,IAAMG,GAAN,KAAY,CACf,YAAYhB,EAAMC,EAAQC,EAAYG,EAAY,CAC9C,KAAK,KAAOL,EACZ,KAAK,OAASC,EACd,KAAK,WAAaC,EAClB,KAAK,WAAaG,EAClB,KAAK,QAAU,IAAIN,GAAQC,EAAMC,EAAQC,CAAU,EACnD,KAAK,QAAU,IAAIE,GAAQJ,EAAMC,EAAQI,CAAU,CACvD,CACA,OAAOM,EAAO,CACV,OAAO,KAAK,QAAQ,OAAOA,CAAK,CACpC,CACA,OAAOA,EAAO,CACV,OAAO,KAAK,QAAQ,OAAOA,CAAK,CACpC,CACJ,EACO,SAASM,GAAK,CAAE,KAAAjB,EAAM,OAAAC,EAAQ,OAAAiB,EAAQ,OAAAC,CAAO,EAAG,CACnD,OAAO,IAAIH,GAAMhB,EAAMC,EAAQiB,EAAQC,CAAM,CACjD,CACO,SAASC,GAAM,CAAE,KAAApB,EAAM,OAAAC,EAAQ,SAAAoB,CAAS,EAAG,CAC9C,GAAM,CAAE,OAAAH,EAAQ,OAAAC,CAAO,EAAIG,GAAMD,EAAUrB,CAAI,EAC/C,OAAOiB,GAAK,CACR,OAAAhB,EACA,KAAAD,EACA,OAAAkB,EACA,OAASZ,GAASiB,EAAOJ,EAAOb,CAAI,CAAC,CACzC,CAAC,CACL,CACA,SAASa,GAAOK,EAAQH,EAAUI,EAAazB,EAAM,CAEjD,IAAM0B,EAAQ,CAAC,EACf,QAASC,EAAI,EAAGA,EAAIN,EAAS,OAAQ,EAAEM,EACnCD,EAAML,EAASM,CAAC,CAAC,EAAIA,EAGzB,IAAIC,EAAMJ,EAAO,OACjB,KAAOA,EAAOI,EAAM,CAAC,IAAM,KACvB,EAAEA,EAGN,IAAMC,EAAM,IAAI,WAAYD,EAAMH,EAAc,EAAK,CAAC,EAElDK,EAAO,EACPC,EAAS,EACTC,EAAU,EACd,QAASL,EAAI,EAAGA,EAAIC,EAAK,EAAED,EAAG,CAE1B,IAAMM,EAAQP,EAAMF,EAAOG,CAAC,CAAC,EAC7B,GAAIM,IAAU,OACV,MAAM,IAAI,YAAY,OAAOjC,CAAI,YAAY,EAGjD+B,EAAUA,GAAUN,EAAeQ,EACnCH,GAAQL,EAEJK,GAAQ,IACRA,GAAQ,EACRD,EAAIG,GAAS,EAAI,IAAQD,GAAUD,EAE3C,CAEA,GAAIA,GAAQL,GAAgB,IAAQM,GAAW,EAAID,EAC/C,MAAM,IAAI,YAAY,wBAAwB,EAElD,OAAOD,CACX,CACA,SAASX,GAAOgB,EAAMb,EAAUI,EAAa,CACzC,IAAMU,EAAMd,EAASA,EAAS,OAAS,CAAC,IAAM,IACxCe,GAAQ,GAAKX,GAAe,EAC9BI,EAAM,GACNC,EAAO,EACPC,EAAS,EACb,QAASJ,EAAI,EAAGA,EAAIO,EAAK,OAAQ,EAAEP,EAK/B,IAHAI,EAAUA,GAAU,EAAKG,EAAKP,CAAC,EAC/BG,GAAQ,EAEDA,EAAOL,GACVK,GAAQL,EACRI,GAAOR,EAASe,EAAQL,GAAUD,CAAK,EAQ/C,GAJIA,IAAS,IACTD,GAAOR,EAASe,EAAQL,GAAWN,EAAcK,CAAM,GAGvDK,EACA,KAASN,EAAI,OAASJ,EAAe,GACjCI,GAAO,IAGf,OAAOA,CACX,CAIO,SAASQ,GAAQ,CAAE,KAAArC,EAAM,OAAAC,EAAQ,YAAAwB,EAAa,SAAAJ,CAAS,EAAG,CAC7D,OAAOJ,GAAK,CACR,OAAAhB,EACA,KAAAD,EACA,OAAOW,EAAO,CACV,OAAOO,GAAOP,EAAOU,EAAUI,CAAW,CAC9C,EACA,OAAOd,EAAO,CACV,OAAOQ,GAAOR,EAAOU,EAAUI,EAAazB,CAAI,CACpD,CACJ,CAAC,CACL,CCtLO,IAAMsC,GAAYC,GAAM,CAC3B,KAAM,YACN,OAAQ,IACR,SAAU,4DACd,CAAC,EACYC,GAAeD,GAAM,CAC9B,KAAM,eACN,OAAQ,IACR,SAAU,4DACd,CAAC,ECTD,IAAAE,GAAoB,WCApB,IAAIC,GAAWC,GACXC,GAAM,IAAMC,GAAO,IAAMC,GAAS,CAACD,GAAME,GAAM,KAAK,IAAI,EAAG,EAAE,EAMjE,SAASJ,GAAOK,EAAKC,EAAKC,EAAQ,CAC9BD,EAAMA,GAAO,CAAC,EACdC,EAASA,GAAU,EAEnB,QADIC,EAAYD,EACTF,GAAOD,IACVE,EAAIC,GAAQ,EAAKF,EAAM,IAAQJ,GAC/BI,GAAO,IAEX,KAAOA,EAAMF,IACTG,EAAIC,GAAQ,EAAKF,EAAM,IAAQJ,GAC/BI,KAAS,EAEb,OAAAC,EAAIC,CAAM,EAAIF,EAAM,EAEpBL,GAAO,MAAQO,EAASC,EAAY,EAC7BF,CACX,CACA,IAAIG,GAASC,GACTC,GAAQ,IAAMC,GAAS,IAK3B,SAASF,GAAKG,EAAKN,EAAQ,CACvB,IAAIO,EAAM,EAAGP,EAASA,GAAU,EAAGQ,EAAQ,EAAGC,EAAUT,EAAQU,EAAGC,EAAIL,EAAI,OAC3E,EAAG,CACC,GAAIG,GAAWE,EAEX,MAAAR,GAAK,MAAQ,EACP,IAAI,WAAW,yBAAyB,EAElDO,EAAIJ,EAAIG,GAAS,EACjBF,GAAOC,EAAQ,IACRE,EAAIL,KAAWG,GACfE,EAAIL,IAAU,KAAK,IAAI,EAAGG,CAAK,EACtCA,GAAS,CACb,OAASE,GAAKN,IAEd,OAAAD,GAAK,MAAQM,EAAUT,EAChBO,CACX,CACA,IAAIK,GAAK,KAAK,IAAI,EAAG,CAAC,EAClBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAK,KAAK,IAAI,EAAG,EAAE,EACnBC,GAAS,SAAgCC,EAAO,CAChD,OAAQA,EAAQV,GAAK,EACfU,EAAQT,GAAK,EACTS,EAAQR,GAAK,EACTQ,EAAQP,GAAK,EACTO,EAAQN,GAAK,EACTM,EAAQL,GAAK,EACTK,EAAQJ,GAAK,EACTI,EAAQH,GAAK,EACTG,EAAQF,GAAK,EACT,EAC1C,EACIG,GAAS,CACT,OAAQ/B,GACR,OAAQU,GACR,eAAgBmB,EACpB,EACIG,GAAeD,GACZE,GAAQD,GC1ER,SAASE,GAAOC,EAAMC,EAAS,EAAG,CAErC,MAAO,CADMC,GAAO,OAAOF,EAAMC,CAAM,EACzBC,GAAO,OAAO,KAAK,CACrC,CACO,SAASC,GAASC,EAAKC,EAAQJ,EAAS,EAAG,CAC9C,OAAAC,GAAO,OAAOE,EAAKC,EAAQJ,CAAM,EAC1BI,CACX,CACO,SAASC,GAAeF,EAAK,CAChC,OAAOF,GAAO,eAAeE,CAAG,CACpC,CCNO,SAASG,GAAOC,EAAMC,EAAQ,CACjC,IAAMC,EAAOD,EAAO,WACdE,EAAoBC,GAAeJ,CAAI,EACvCK,EAAeF,EAAoBC,GAAeF,CAAI,EACtDI,EAAQ,IAAI,WAAWD,EAAeH,CAAI,EAChD,OAAOK,GAASP,EAAMM,EAAO,CAAC,EACvBC,GAASL,EAAMI,EAAOH,CAAU,EACvCG,EAAM,IAAIL,EAAQI,CAAY,EACvB,IAAIG,GAAOR,EAAME,EAAMD,EAAQK,CAAK,CAC/C,CAIO,SAASG,GAAOC,EAAW,CAC9B,IAAMJ,EAAQK,EAAOD,CAAS,EACxB,CAACV,EAAMG,CAAU,EAAWM,GAAOH,CAAK,EACxC,CAACJ,EAAMG,CAAY,EAAWI,GAAOH,EAAM,SAASH,CAAU,CAAC,EAC/DF,EAASK,EAAM,SAASH,EAAaE,CAAY,EACvD,GAAIJ,EAAO,aAAeC,EACtB,MAAM,IAAI,MAAM,kBAAkB,EAEtC,OAAO,IAAIM,GAAOR,EAAME,EAAMD,EAAQK,CAAK,CAC/C,CACO,SAASM,GAAOC,EAAGC,EAAG,CACzB,GAAID,IAAMC,EACN,MAAO,GAEN,CACD,IAAMC,EAAOD,EACb,OAAQD,EAAE,OAASE,EAAK,MACpBF,EAAE,OAASE,EAAK,MAChBA,EAAK,iBAAiB,YACtBH,GAAWC,EAAE,MAAOE,EAAK,KAAK,CACtC,CACJ,CAKO,IAAMP,GAAN,KAAa,CAIhB,YAAYR,EAAME,EAAMD,EAAQK,EAAO,CACnC,KAAK,KAAON,EACZ,KAAK,KAAOE,EACZ,KAAK,OAASD,EACd,KAAK,MAAQK,CACjB,CACJ,ECrDO,SAASU,GAAK,CAAE,KAAAC,EAAM,KAAAC,EAAM,OAAAC,CAAO,EAAG,CACzC,OAAO,IAAIC,GAAOH,EAAMC,EAAMC,CAAM,CACxC,CAKO,IAAMC,GAAN,KAAa,CAChB,YAAYH,EAAMC,EAAMC,EAAQ,CAC5B,KAAK,KAAOF,EACZ,KAAK,KAAOC,EACZ,KAAK,OAASC,CAClB,CACA,OAAOE,EAAO,CACV,GAAIA,aAAiB,YAAcA,aAAiB,eAAgB,CAChE,IAAMC,EAAS,KAAK,OAAOD,CAAK,EAChC,OAAOC,aAAkB,WACZC,GAAO,KAAK,KAAMD,CAAM,EAE/BA,EAAO,KAAKE,GAAiBD,GAAO,KAAK,KAAMC,CAAM,CAAC,CAChE,KAEI,OAAM,MAAM,mCAAmC,CAGvD,CACJ,EJxBA,GAAM,CAAE,QAAAC,EAAQ,EAAI,GAAAC,QACPC,GAAWC,GAAK,CACzB,KAAM,YACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYE,GAAYH,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYG,GAAYJ,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYI,GAAYL,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYK,GAAYN,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYM,GAAYP,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYO,GAAYR,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYQ,GAAYT,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYS,GAAYV,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,CAAC,CAAC,CAChE,CAAC,EACYU,GAAYX,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYW,GAAYZ,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYY,GAAYb,GAAK,CAC1B,KAAM,aACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYa,GAAad,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYc,GAAaf,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYe,GAAahB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYgB,GAAajB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYiB,GAAalB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYkB,GAAanB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYmB,GAAapB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYoB,GAAarB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYqB,GAAatB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYsB,GAAavB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYuB,GAAaxB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYwB,GAAazB,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYyB,GAAa1B,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY0B,GAAa3B,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY2B,GAAa5B,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY4B,GAAa7B,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY6B,GAAa9B,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY8B,GAAa/B,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY+B,GAAahC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYgC,GAAajC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYiC,GAAalC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYkC,GAAanC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYmC,GAAapC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYoC,GAAarC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYqC,GAAatC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYsC,GAAavC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYuC,GAAaxC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYwC,GAAazC,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYyC,GAAa1C,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY0C,GAAa3C,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY2C,GAAa5C,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY4C,GAAa7C,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY6C,GAAa9C,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY8C,GAAa/C,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY+C,GAAahD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYgD,GAAajD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYiD,GAAalD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYkD,GAAanD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYmD,GAAapD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYoD,GAAarD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYqD,GAAatD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYsD,GAAavD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYuD,GAAaxD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYwD,GAAazD,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYyD,GAAa1D,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY0D,GAAa3D,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY2D,GAAa5D,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY4D,GAAa7D,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY6D,GAAa9D,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY8D,GAAa/D,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACY+D,GAAahE,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EACYgE,GAAajE,GAAK,CAC3B,KAAM,cACN,KAAM,MACN,OAASC,GAAgBC,EAAOL,GAAQI,EAAO,OAAW,EAAE,CAAC,CACjE,CAAC,EK3TD,IAAAiE,GAAoB,WATpB,IAAIC,GAAwC,SAAUC,EAASC,EAAYC,EAAGC,EAAW,CACrF,SAASC,EAAMC,EAAO,CAAE,OAAOA,aAAiBH,EAAIG,EAAQ,IAAIH,EAAE,SAAUI,EAAS,CAAEA,EAAQD,CAAK,CAAG,CAAC,CAAG,CAC3G,OAAO,IAAKH,IAAMA,EAAI,UAAU,SAAUI,EAASC,EAAQ,CACvD,SAASC,EAAUH,EAAO,CAAE,GAAI,CAAEI,EAAKN,EAAU,KAAKE,CAAK,CAAC,CAAG,OAASK,EAAG,CAAEH,EAAOG,CAAC,CAAG,CAAE,CAC1F,SAASC,EAASN,EAAO,CAAE,GAAI,CAAEI,EAAKN,EAAU,MAASE,CAAK,CAAC,CAAG,OAASK,EAAG,CAAEH,EAAOG,CAAC,CAAG,CAAE,CAC7F,SAASD,EAAKG,EAAQ,CAAEA,EAAO,KAAON,EAAQM,EAAO,KAAK,EAAIR,EAAMQ,EAAO,KAAK,EAAE,KAAKJ,EAAWG,CAAQ,CAAG,CAC7GF,GAAMN,EAAYA,EAAU,MAAMH,EAASC,GAAc,CAAC,CAAC,GAAG,KAAK,CAAC,CACxE,CAAC,CACL,EAIM,CAAE,QAAAY,GAAS,YAAAC,GAAa,cAAAC,GAAe,aAAAC,EAAa,EAAI,GAAAC,QACjDC,GAAmBC,GAAK,CACjC,KAAM,cACN,KAAM,MACN,OAASC,GAAUrB,GAAU,OAAQ,OAAQ,OAAQ,WAAa,CAC9D,GAAIqB,aAAiB,eAAgB,CACjC,IAAMC,EAAMP,GAAY,EAAE,EACpBQ,EAASF,EAAM,UAAU,EAC/B,OAAS,CACL,IAAMR,EAAS,MAAMU,EAAO,KAAK,EACjC,GAAIV,EAAO,KACP,MACJG,GAAcM,EAAWE,EAAOX,EAAO,KAAK,CAAC,CACjD,CACA,OAAOI,GAAaK,CAAG,CAC3B,KAEI,QAAaE,EAAOV,GAAQO,EAAO,OAAW,EAAE,CAAC,CAEzD,CAAC,CACL,CAAC,EC9BM,IAAMI,GAASC,GAAQ,CAC1B,OAAQ,IACR,KAAM,SACN,SAAU,mCACV,YAAa,CACjB,CAAC,EACYC,GAAcD,GAAQ,CAC/B,OAAQ,IACR,KAAM,cACN,SAAU,mCACV,YAAa,CACjB,CAAC,EACYE,GAAYF,GAAQ,CAC7B,OAAQ,IACR,KAAM,YACN,SAAU,oCACV,YAAa,CACjB,CAAC,EACYG,GAAiBH,GAAQ,CAClC,OAAQ,IACR,KAAM,iBACN,SAAU,oCACV,YAAa,CACjB,CAAC,EACYI,GAAYJ,GAAQ,CAC7B,OAAQ,IACR,KAAM,YACN,SAAU,mCACV,YAAa,CACjB,CAAC,EACYK,GAAiBL,GAAQ,CAClC,OAAQ,IACR,KAAM,iBACN,SAAU,mCACV,YAAa,CACjB,CAAC,EACYM,GAAeN,GAAQ,CAChC,OAAQ,IACR,KAAM,eACN,SAAU,oCACV,YAAa,CACjB,CAAC,EACYO,GAAoBP,GAAQ,CACrC,OAAQ,IACR,KAAM,oBACN,SAAU,oCACV,YAAa,CACjB,CAAC,EACYQ,GAAUR,GAAQ,CAC3B,OAAQ,IACR,KAAM,UACN,SAAU,mCACV,YAAa,CACjB,CAAC,ECvDD,IAAIS,GAQG,SAASC,GAAOC,EAAMC,EAAM,CAC/B,GAAM,CAAE,MAAAC,EAAO,QAAAC,CAAQ,EAAIH,EAC3B,OAAQG,EAAS,CACb,IAAK,GACD,OAAOC,GAAWF,EAAOG,GAAUL,CAAI,EAAGC,GAA0CK,GAAU,OAAO,EACzG,QACI,OAAOC,GAAWL,EAAOG,GAAUL,CAAI,EAAIC,GAA0CO,GAAO,OAAQ,CAC5G,CACJ,CASA,IAAMC,GAAQ,IAAI,QAClB,SAASC,GAAUC,EAAK,CACpB,IAAMD,EAAYD,GAAM,IAAIE,CAAG,EAC/B,GAAID,GAAa,KAAM,CACnB,IAAMA,EAAY,IAAI,IACtB,OAAAD,GAAM,IAAIE,EAAKD,CAAS,EACjBA,CACX,CACA,OAAOA,CACX,CACO,IAAME,GAAN,MAAMC,CAAI,CAMb,YAAYC,EAASC,EAAMC,EAAWC,EAAO,CACzC,KAAKC,EAAE,EAAI,MACX,KAAK,KAAOH,EACZ,KAAK,QAAUD,EACf,KAAK,UAAYE,EACjB,KAAK,MAAQC,EAGb,KAAK,GAAG,EAAIA,CAChB,CAOA,IAAI,OAAQ,CACR,OAAO,IACX,CAEA,IAAI,YAAa,CACb,OAAO,KAAK,MAAM,UACtB,CAEA,IAAI,YAAa,CACb,OAAO,KAAK,MAAM,UACtB,CACA,MAAO,CACH,OAAQ,KAAK,QAAS,CAClB,IAAK,GACD,OAAO,KAEX,IAAK,GAAG,CACJ,GAAM,CAAE,KAAAF,EAAM,UAAAC,CAAU,EAAI,KAC5B,GAAID,IAASI,GACT,MAAM,IAAI,MAAM,0CAA0C,EAG9D,GAAIH,EAAU,OAASI,GACnB,MAAM,IAAI,MAAM,oDAAoD,EAExE,OAAQP,EAAI,SAASG,CAAS,CAClC,CACA,QACI,MAAM,MAAM,+BAA+B,KAAK,OAAO,4CAA4C,CAE3G,CACJ,CACA,MAAO,CACH,OAAQ,KAAK,QAAS,CAClB,IAAK,GAAG,CACJ,GAAM,CAAE,KAAAD,EAAM,OAAAM,CAAO,EAAI,KAAK,UACxBL,EAAmBM,GAAOP,EAAMM,CAAM,EAC5C,OAAQR,EAAI,SAAS,KAAK,KAAMG,CAAS,CAC7C,CACA,IAAK,GACD,OAAO,KAEX,QACI,MAAM,MAAM,+BAA+B,KAAK,OAAO,4CAA4C,CAE3G,CACJ,CACA,OAAOO,EAAO,CACV,OAAOV,EAAI,OAAO,KAAMU,CAAK,CACjC,CACA,OAAO,OAAOC,EAAMD,EAAO,CACvB,IAAME,EAAUF,EAChB,OAAQE,GAAW,MACfD,EAAK,OAASC,EAAQ,MACtBD,EAAK,UAAYC,EAAQ,SAClBC,GAAOF,EAAK,UAAWC,EAAQ,SAAS,CACvD,CACA,SAASE,EAAM,CACX,OAAOC,GAAO,KAAMD,CAAI,CAC5B,CACA,QAAS,CACL,MAAO,CAAE,IAAKC,GAAO,IAAI,CAAE,CAC/B,CACA,MAAO,CACH,OAAO,IACX,CAEA,EAAEV,GAAK,OAAO,YAAa,OAAO,IAAI,4BAA4B,EAAE,GAAI,CACpE,MAAO,OAAO,KAAK,SAAS,CAAC,GACjC,CAWA,OAAO,MAAMW,EAAO,CAChB,GAAIA,GAAS,KACT,OAAO,KAEX,IAAMC,EAAQD,EACd,GAAIC,aAAiBjB,EAEjB,OAAOiB,EAEN,GAAKA,EAAM,GAAG,GAAK,MAAQA,EAAM,GAAG,IAAMA,EAAM,OAAUA,EAAM,QAAUA,EAAO,CAMlF,GAAM,CAAE,QAAAhB,EAAS,KAAAC,EAAM,UAAAC,EAAW,MAAAC,CAAM,EAAIa,EAC5C,OAAO,IAAIjB,EAAIC,EAASC,EAAMC,EAAWC,GAA6Cc,GAAUjB,EAASC,EAAMC,EAAU,KAAK,CAAC,CACnI,SACSc,EAAME,EAAS,IAAM,GAAM,CAIhC,GAAM,CAAE,QAAAlB,EAAS,UAAAE,EAAW,KAAAD,CAAK,EAAIe,EAC/BT,EAAgBY,GAAOjB,CAAS,EACtC,OAAOH,EAAI,OAAOC,EAASC,EAAMM,CAAM,CAC3C,KAII,QAAO,IAEf,CAMA,OAAO,OAAOP,EAASC,EAAMM,EAAQ,CACjC,GAAI,OAAON,GAAS,SAChB,MAAM,IAAI,MAAM,uCAAuC,EAE3D,GAAI,EAAEM,EAAO,iBAAiB,YAC1B,MAAM,IAAI,MAAM,gBAAgB,EAEpC,OAAQP,EAAS,CACb,IAAK,GAAG,CACJ,GAAIC,IAASI,GACT,MAAM,IAAI,MAAM,wCAAwCA,EAAW,kBAAkB,EAGrF,OAAO,IAAIN,EAAIC,EAASC,EAAMM,EAAQA,EAAO,KAAK,CAE1D,CACA,IAAK,GAAG,CACJ,IAAMJ,EAAQc,GAAUjB,EAASC,EAAMM,EAAO,KAAK,EACnD,OAAO,IAAIR,EAAIC,EAASC,EAAMM,EAAQJ,CAAK,CAC/C,CACA,QACI,MAAM,IAAI,MAAM,iBAAiB,CAEzC,CACJ,CAIA,OAAO,SAASI,EAAQ,CACpB,OAAOR,EAAI,OAAO,EAAGM,GAAaE,CAAM,CAC5C,CAOA,OAAO,SAASN,EAAMM,EAAQ,CAC1B,OAAOR,EAAI,OAAO,EAAGE,EAAMM,CAAM,CACrC,CAQA,OAAO,OAAOJ,EAAO,CACjB,GAAM,CAACN,EAAKuB,CAAS,EAAIrB,EAAI,YAAYI,CAAK,EAC9C,GAAIiB,EAAU,SAAW,EACrB,MAAM,IAAI,MAAM,kBAAkB,EAEtC,OAAOvB,CACX,CAUA,OAAO,YAAYM,EAAO,CACtB,IAAMkB,EAAQtB,EAAI,aAAaI,CAAK,EAC9BmB,EAAaD,EAAM,KAAOA,EAAM,cAChCE,EAAiBC,EAAOrB,EAAM,SAASmB,EAAYA,EAAaD,EAAM,aAAa,CAAC,EAC1F,GAAIE,EAAe,aAAeF,EAAM,cACpC,MAAM,IAAI,MAAM,kBAAkB,EAEtC,IAAMI,EAAcF,EAAe,SAASF,EAAM,cAAgBA,EAAM,UAAU,EAC5Ed,EAAS,IAAWmB,GAAOL,EAAM,cAAeA,EAAM,WAAYI,EAAaF,CAAc,EAInG,MAAO,CAHKF,EAAM,UAAY,EACxBtB,EAAI,SAASQ,CAAM,EACnBR,EAAI,SAASsB,EAAM,MAAOd,CAAM,EACzBJ,EAAM,SAASkB,EAAM,IAAI,CAAC,CAC3C,CAUA,OAAO,aAAaM,EAAc,CAC9B,IAAIC,EAAS,EACPC,EAAO,IAAM,CACf,GAAM,CAACC,EAAGC,CAAM,EAAWZ,GAAOQ,EAAa,SAASC,CAAM,CAAC,EAC/D,OAAAA,GAAUG,EACHD,CACX,EACI9B,EAAU6B,EAAK,EACfG,EAAQ3B,GASZ,GARIL,IAAY,IAEZA,EAAU,EACV4B,EAAS,GAGTI,EAAQH,EAAK,EAEb7B,IAAY,GAAKA,IAAY,EAC7B,MAAM,IAAI,WAAW,uBAAuBA,CAAO,EAAE,EAEzD,IAAMsB,EAAaM,EACbK,EAAgBJ,EAAK,EACrBK,EAAaL,EAAK,EAClBM,EAAOP,EAASM,EAChBE,EAAgBD,EAAOb,EAC7B,MAAO,CAAE,QAAAtB,EAAS,MAAAgC,EAAO,cAAAC,EAAe,WAAAC,EAAY,cAAAE,EAAe,KAAAD,CAAK,CAC5E,CAOA,OAAO,MAAME,EAAQxB,EAAM,CACvB,GAAM,CAACyB,EAAQnC,CAAK,EAAIoC,GAAgBF,EAAQxB,CAAI,EAC9ChB,EAAME,EAAI,OAAOI,CAAK,EAC5B,GAAIN,EAAI,UAAY,GAAKwC,EAAO,CAAC,IAAM,IACnC,MAAM,MAAM,wDAAwD,EAGxE,OAAAzC,GAAUC,CAAG,EAAE,IAAIyC,EAAQD,CAAM,EAC1BxC,CACX,CACJ,EACA,SAAS0C,GAAgBF,EAAQxB,EAAM,CACnC,OAAQwB,EAAO,CAAC,EAAG,CAEf,IAAK,IAAK,CACN,IAAMG,EAAU3B,GAA0C4B,GAC1D,MAAO,CACHA,GAAU,OACVD,EAAQ,OAAO,GAAGC,GAAU,MAAM,GAAGJ,CAAM,EAAE,CACjD,CACJ,CACA,KAAKI,GAAU,OAAQ,CACnB,IAAMD,EAAU3B,GAA0C4B,GAC1D,MAAO,CAACA,GAAU,OAAQD,EAAQ,OAAOH,CAAM,CAAC,CACpD,CACA,KAAKK,GAAO,OAAQ,CAChB,IAAMF,EAAU3B,GAA0C6B,GAC1D,MAAO,CAACA,GAAO,OAAQF,EAAQ,OAAOH,CAAM,CAAC,CACjD,CACA,QAAS,CACL,GAAIxB,GAAQ,KACR,MAAM,MAAM,iFAAiF,EAEjG,MAAO,CAACwB,EAAO,CAAC,EAAGxB,EAAK,OAAOwB,CAAM,CAAC,CAC1C,CACJ,CACJ,CACA,SAASM,GAAWxC,EAAOR,EAAOkB,EAAM,CACpC,GAAM,CAAE,OAAAyB,CAAO,EAAIzB,EACnB,GAAIyB,IAAWG,GAAU,OACrB,MAAM,MAAM,8BAA8B5B,EAAK,IAAI,WAAW,EAElE,IAAMhB,EAAMF,EAAM,IAAI2C,CAAM,EAC5B,GAAIzC,GAAO,KAAM,CACb,IAAMA,EAAMgB,EAAK,OAAOV,CAAK,EAAE,MAAM,CAAC,EACtC,OAAAR,EAAM,IAAI2C,EAAQzC,CAAG,EACdA,CACX,KAEI,QAAOA,CAEf,CACA,SAAS+C,GAAWzC,EAAOR,EAAOkB,EAAM,CACpC,GAAM,CAAE,OAAAyB,CAAO,EAAIzB,EACbhB,EAAMF,EAAM,IAAI2C,CAAM,EAC5B,GAAIzC,GAAO,KAAM,CACb,IAAMA,EAAMgB,EAAK,OAAOV,CAAK,EAC7B,OAAAR,EAAM,IAAI2C,EAAQzC,CAAG,EACdA,CACX,KAEI,QAAOA,CAEf,CACA,IAAMQ,GAAc,IACdC,GAAe,GACrB,SAASW,GAAUjB,EAASC,EAAMC,EAAW,CACzC,IAAM2C,EAAoBC,GAAe9C,CAAO,EAC1C+C,EAAaF,EAAoBC,GAAe7C,CAAI,EACpDE,EAAQ,IAAI,WAAW4C,EAAa7C,EAAU,UAAU,EAC9D,OAAO8C,GAAShD,EAASG,EAAO,CAAC,EAC1B6C,GAAS/C,EAAME,EAAO0C,CAAU,EACvC1C,EAAM,IAAID,EAAW6C,CAAU,EACxB5C,CACX,CACA,IAAMe,GAAY,OAAO,IAAI,kBAAkB,EC1W/C,IAAA+B,GAAuB,SCMhB,SAASC,GAAKC,EAAGC,EAAO,CAC3B,IAAMC,EAAI,OAAO,OAAO,IAAI,EAC5B,QAAWC,KAAKF,EACRG,EAAIJ,EAAGG,CAAC,IACRD,EAAEC,CAAC,EAAIH,EAAEG,CAAC,GAGlB,OAAOD,CACX,CAiBO,SAASG,GAAKC,EAAGC,EAAO,CAC3B,IAAMC,EAAI,OAAO,OAAO,IAAI,EAC5B,QAAWC,KAAKH,EACPC,EAAM,SAASE,CAAC,IACjBD,EAAEC,CAAC,EAAIH,EAAEG,CAAC,GAGlB,OAAOD,CACX,CACO,SAASE,GAAUC,EAAK,CAC3B,OAAO,KAAK,MAAM,KAAK,UAAUA,CAAG,CAAC,CACzC,CACA,SAASC,GAAkBC,EAAK,CAE5B,OADsBA,GAAO,OAAOA,GAAQ,UAExC,OAAO,UAAU,SAAS,KAAKA,CAAG,IAAM,mBACxC,OAAO,UAAU,SAAS,KAAKA,CAAG,IAAM,eAChD,CACO,SAASC,GAAMH,EAAKI,EAAK,CAC5B,IAAMC,EAAML,EACZ,QAAWM,KAAOF,EAAK,CACnB,IAAMG,EAAQN,GAAkBG,EAAIE,CAAG,CAAC,EAAIP,GAAUK,EAAIE,CAAG,CAAC,EAAI,OAC9DT,EAGJ,GAAIU,GAASC,EAAIR,EAAKM,CAAG,GAAKL,GAAmBJ,EAAIQ,EAAIC,CAAG,CAAE,EAAG,CAC7DH,GAAMN,EAAGU,CAAK,EACd,QACJ,CAKA,OAAO,eAAeF,EAAKC,EAAK,CAC5B,aAAc,GACd,WAAY,GACZ,MAAOC,GAASH,EAAIE,CAAG,EACvB,SAAU,EACd,CAAC,CACL,CACA,OAAOD,CACX,CACO,SAASI,GAAMC,EAAM,CACxB,OAAO,IAAI,QAASC,GAAY,CAC5B,WAAWA,EAASD,CAAI,CAC5B,CAAC,CACL,CAkBO,SAASE,GAAmBC,EAAKC,EAAK,CACzC,OAAO,KAAK,MAAM,KAAK,OAAO,GAAKA,EAAMD,EAAM,GAAKA,CAAG,CAC3D,CA6CO,SAASE,GAAKC,EAAO,CACxB,OAAO,MAAM,KAAK,IAAI,IAAIA,CAAK,CAAC,CACpC,CACO,SAASC,MAASC,EAAQ,CAC7B,OAAOH,GAAK,MAAM,UAAU,OAAO,MAAM,CAAC,EAAGG,CAAM,CAAC,CACxD,CACO,SAASC,GAAaC,KAAOF,EAAQ,CACxC,OAAOH,GAAKK,CAAE,EAAE,OAAOC,GAAMH,EAAO,MAAMI,GAAMA,EAAG,QAAQD,CAAE,GAAK,CAAC,CAAC,CACxE,CACO,SAASE,GAAWH,KAAOF,EAAQ,CACtC,IAAMM,EAAK,MAAM,UAAU,OAAO,MAAM,CAAC,EAAGN,CAAM,EAClD,OAAOE,EAAG,OAAOK,GAAKD,EAAG,QAAQC,CAAC,IAAM,EAAE,CAC9C,CAqBO,SAASC,GAAuBC,EAAU,CAC7C,MAAI,CAACA,GAAY,OAAOA,GAAa,SAC1BA,EAEP,MAAM,QAAQA,CAAQ,EACfA,EAAS,IAAIC,GAAKF,GAAuBE,CAAC,CAAC,EAG3C,OAAO,KAAKD,CAAQ,EAAE,KAAK,EAAE,OAAO,CAACE,EAAKC,KAC7CD,EAAI,KAAK,CACLC,EACAJ,GAAuBC,EAASG,CAAM,CAAC,CAC3C,CAAC,EACMD,GACR,CAAC,CAAC,CAEb,CAgBO,SAASE,GAASC,EAAMC,EAAMC,EAAW,CAC5C,IAAIC,EAASC,EAAMC,EAASC,EAAWC,EACnCN,GAAQ,OACRA,EAAO,KACX,SAASO,GAAQ,CACb,IAAMC,EAAO,YAAY,IAAI,EAAIH,EAC7BG,EAAOR,GAAQQ,GAAQ,EACvBN,EAAU,WAAWK,EAAOP,EAAOQ,CAAI,GAGvCN,EAAU,OACLD,IACDK,EAASP,EAAK,MAAMK,EAASD,CAAI,EACjCA,EAAO,OACPC,EAAU,QAGtB,CACA,IAAMK,EAAY,YAAaC,EAAO,CAClCP,EAAOO,EAEPN,EAAU,KACVC,EAAY,YAAY,IAAI,EAC5B,IAAMM,EAAUV,GAAa,CAACC,EAC9B,OAAKA,IACDA,EAAU,WAAWK,EAAOP,CAAI,GAChCW,IACAL,EAASP,EAAK,MAAMK,EAASD,CAAI,EACjCA,EAAO,OACPC,EAAU,QAEPE,CACX,EACA,OAAAG,EAAU,MAAQ,UAAY,CACtBP,IACA,aAAaA,CAAO,EACpBA,EAAU,OAElB,EACAO,EAAU,MAAQ,UAAY,CACtBP,IACAI,EAASP,EAAK,MAAMK,EAASD,CAAI,EACjCA,EAAO,OACPC,EAAU,OACV,aAAaF,CAAO,EACpBA,EAAU,OAElB,EACOO,CACX,CACO,SAASG,GAASb,EAAMc,EAAO,CAGlC,IAAIC,EAAO,EACX,MAAO,IAAIX,IAAS,CAEhB,IAAMY,EAAM,IAAI,KAAK,EAAE,QAAQ,EAE/B,GAAIA,EAAMD,EAAOD,EACb,OAAAC,EAAOC,EACAhB,EAAK,GAAGI,CAAI,CAE3B,CACJ,CAqBO,IAAMa,EAAM,SAAS,UAAU,KAAK,KAAK,OAAO,UAAU,cAAc,ED/RxE,IAAMC,GAAsC,CACjD,IAAK,EACL,KAAM,IACN,0BAA2B,QAC3B,sBAAuB,QACvB,sBAAuB,QACvB,sBAAuB,QACvB,mBAAoB,OACtB,EAEaC,GAAYC,GAAwB,CAC/C,GAAI,CAACA,GAAOA,EAAI,OAAS,IAAMA,EAAI,OAAS,GAC1C,MAAM,IAAI,WAAW,kCAAkC,EAEzD,IAAMC,EAASC,GAAI,MAAMF,EAAKG,EAAS,EACvC,GACEF,EAAO,UAAY,GACnBA,EAAO,UAAU,OAASG,GAAW,MACrC,CAAC,OAAO,OAAON,EAAU,EAAE,SAASG,EAAO,IAAI,EAE/C,MAAM,IAAI,MAAM,aAAa,EAG/B,OAAOA,CACT,EAaI,OAAO,YAAe,UAAY,CAACI,EAAI,WAAY,QAAQ,IAC7D,WAAW,OAAS,WAGtB,eAAsBC,GAAqBC,EAA4CC,EAAoBC,GAAW,IAAsB,CAC1I,IAAMC,EAAa,OAAOH,GAAS,SAAW,IAAI,YAAY,EAAE,OAAOA,CAAI,EAAIA,EACzEI,EAAS,MAAMC,GAAiB,OAAOF,CAAU,EACvD,OAAOG,GAAI,OAAO,EAAGL,EAAWG,CAAM,EAAE,SAASG,EAAS,CAC5D,CAIO,SAASC,GAAWR,EAA2BC,EAAoBC,GAAW,IAAa,CAChG,IAAMC,EAAa,OAAOH,GAAS,SAAW,IAAI,YAAY,EAAE,OAAOA,CAAI,EAAIA,EACzEI,EAASK,GAAW,OAAON,CAAU,EAC3C,OAAOG,GAAI,OAAO,EAAGL,EAAWG,CAAM,EAAE,SAASG,EAAS,CAC5D,CAEO,SAASG,GAAaV,EAAmC,CAC9D,IAAMG,EAAa,OAAOH,GAAS,SAAW,IAAI,YAAY,EAAE,OAAOA,CAAI,EAAIA,EACzEI,EAASK,GAAW,OAAON,CAAU,EAG3C,OAAOI,GAAU,OAAOH,EAAO,KAAK,CACtC,CAQO,IAAMO,GAAYC,GAAwB,UAAO,KAAKA,EAAK,QAAQ,EAC7DC,GAAYD,GAAwBD,GAASC,CAAG,EAAE,SAAS,MAAM,EAOvE,IAAME,GAAoB,MAAOC,GAA8C,CACpF,IAAMC,EAAc,IAAI,YAElBC,EAAWD,EAAY,OAAOD,EAAiB,QAAQ,EAEvDG,EAASF,EAAY,OAAOD,EAAiB,KAAK,MAAM,EACxDI,EAAOH,EAAY,OAAOD,EAAiB,KAAK,IAAI,EAEpDK,EAAgB,IAAI,YACxB,GACG,EAAIH,EAAS,aAAe,EAAIC,EAAO,aACvC,EAAIC,EAAK,WACd,EACME,EAAkB,IAAI,WAAWD,CAAa,EAC9CE,EAAkB,IAAI,SAASF,CAAa,EAC9CG,EAAS,EACbD,EAAgB,WACdC,EACAR,EAAiB,gBAAkB,KAC/B,IACAA,EAAiB,eACrB,EACF,EACAQ,GAAU,EACVD,EAAgB,UAAUC,EAAQN,EAAS,WAAY,EAAK,EAC5DM,GAAU,EACVF,EAAgB,IAAIJ,EAAUM,CAAM,EACpCA,GAAUN,EAAS,WACnBK,EAAgB,UAAUC,EAAQL,EAAO,WAAY,EAAK,EAC1DK,GAAU,EACVF,EAAgB,IAAIH,EAAQK,CAAM,EAClCA,GAAUL,EAAO,WACjBI,EAAgB,UAAUC,EAAQJ,EAAK,WAAY,EAAK,EACxDI,GAAU,EACVF,EAAgB,IAAIF,EAAMI,CAAM,EAEhC,IAAMC,EAAS,MAAM,OAAO,OAAO,OAAO,UAAWJ,CAAa,EAC5DK,EAAK,UAAO,KAAKD,EAAO,MAAM,EAAG,EAAE,CAAC,EAC1C,OAAAC,EAAG,CAAC,EAAI,IAAQA,EAAG,CAAC,EAAI,GACxBA,EAAG,CAAC,EAAI,IAAQA,EAAG,CAAC,EAAI,GAEjB,CACLA,EAAG,MAAM,EAAG,CAAC,EACbA,EAAG,MAAM,EAAG,CAAC,EACbA,EAAG,MAAM,EAAG,CAAC,EACbA,EAAG,MAAM,EAAG,EAAE,EACdA,EAAG,MAAM,GAAI,EAAE,CACjB,EAAE,IAAKC,GAAMA,EAAE,SAAS,KAAK,CAAC,EAAE,KAAK,GAAG,CAC1C,EE1HO,IAAMC,GAAsB,EAAIC,GAEhC,SAASC,GAAKC,EAAoC,CACvD,OAAO,KAAK,IAAI,EAAIA,EAAa,SACnC,CA8FO,SAASC,GAAWC,EAAqC,CAC9D,OAAOC,GAAID,CAAY,EAAIE,GAAOF,CAAY,CAChD,CAEO,SAASG,GAAOH,EAAqC,CAC1D,OAAOC,GAAID,CAAY,EAAII,EAC7B,CAEO,SAASC,GAASL,EAAqC,CAC5D,MAAO,CAACG,GAAMH,CAAY,CAC5B,CAEO,SAASE,GAAQF,EAAoC,CAC1D,OAAOA,EAAa,KAAOM,GAAeC,EAC5C,CAEO,SAASC,GAAsBR,EAA8B,CAClE,OAAOS,GAAY,KAAK,UAAUC,GAAuBV,CAAY,CAAC,CAAC,CACzE,CAEO,SAASW,GAAqBC,EAAkBC,EAAsB,CAAC,EAAW,CACvF,MAAO,CACL,aAAcD,EAAS,KAAK,aAC5B,aAAcA,EAAS,KAAK,aAC5B,gBAAiBA,EAAS,KAAK,gBAC/B,YAAaA,EAAS,KAAK,YAC3B,UAAWA,EAAS,UACpB,GAAGC,CACL,CACF,CCrIA,IAAMC,GAAoB,CAACC,EAAWC,EAAU,MACtBA,EACpBC,EAAI,oBAAoB,EAAE,qBAAqBD,CAAO,EACtDC,EAAI,oBAAoB,EAAE,sBAEP,KAAKC,GAAQH,EAAUG,CAAI,CAAC,EAG/CC,GAQA,CACJ,CACE,KAAMC,GAA2B,MACjC,iBAAkB,CAChB,SAAU,sBACV,cAAe,CAAE,UAAAC,EAAW,YAAAC,CAAY,EAAG,CACzC,IAAMC,EAAWD,EAAY,UAE7B,YAAK,oBAAsBC,EAAS,IAAKC,GAAQ,CAC/C,IAAMC,EAAgBH,EAAY,sBAAsBD,EAAUG,CAAG,CAAC,EAAE,iBACxE,GAAI,CAACC,EAAiB,OAAO,KAE7B,IAAMC,EAAaJ,EAAY,0BAA0BD,EAAUG,CAAG,EAAGC,CAAa,EAChFE,EAAMC,GAAkB,IAAI,IAAM,EAClCC,EAAaC,GAAoBJ,EAAYC,CAAG,EAEtD,OACEL,EAAY,wBAAwBD,EAAUG,CAAG,CAAC,GAAG,oBAAsB,gBACxEK,EAAa,GAAKA,EAAaE,GAAc,GAC7CT,EAAY,oBAAoBD,EAAUG,CAAG,CAAC,GAAG,KAAK,OAAS,GAChE,CAACV,GAAkBI,GAAQA,EAAK,OAAS,yBAA2BA,EAAK,KAAK,SAAWO,EAAeD,CAAG,EAE3G,CAACA,EAAKC,CAAa,EACnB,IACN,CAAC,EAAE,OAAO,OAAO,EAET,KAAK,oBAAoB,OAAS,CAC5C,EACA,MAAQ,CACN,KAAK,oBAAoB,QAAQ,CAAC,CAACO,EAASC,CAAM,IAAM,CACtDhB,EAAI,wBAAyB,wBAAyB,CACpD,QAAAe,EACA,OAAAC,CACF,CAAC,CACH,CAAC,CACH,EACA,oBAAqB,CAAE,YAAAX,CAAY,EAAG,CACpC,IAAMC,EAAWD,EAAY,UAEvBY,EAAuBZ,EAAY,cAAc,OAAOJ,GAAQA,EAAK,OAAS,uBAAuB,EAAE,OAAO,CAACiB,EAAKjB,KACnHA,EAAK,UACLiB,EAAIjB,EAAK,OAAO,IAAGiB,EAAIjB,EAAK,OAAO,EAAI,CAAC,GAC7CiB,EAAIjB,EAAK,OAAO,EAAE,KAAKA,EAAK,KAAK,MAAM,GAEhCiB,GACN,OAAO,OAAO,IAAI,CAAC,EAEtB,OAAOZ,EAAS,MAAOP,GAAY,CACjC,IAAMS,EAAgBH,EAAY,sBAAsBN,CAAO,EAAE,iBACjE,MAAO,CAAC,CAACkB,EAAqBlB,CAAO,GAAG,MAAMiB,GAAUA,IAAWR,CAAa,CAClF,CAAC,CACH,CACF,CACF,EACA,CACE,KAAML,GAA2B,KACjC,iBAAkB,CAChB,SAAU,yBACV,cAAe,CAAE,UAAAC,EAAW,YAAAC,CAAY,EAAG,CACzC,IAAMC,EAAWD,EAAY,UAE7B,YAAK,uBAAyBC,EAAS,IAAKC,GAAQ,CAClD,IAAMY,EAAUd,EAAY,wBAAwBD,EAAUG,CAAG,CAAC,EAClE,GAAI,CAACY,GAAS,kBAEZ,OAAO,KAET,IAAMX,EAAgBH,EAAY,sBAAsBD,EAAUG,CAAG,CAAC,EAAE,iBACxE,OAAKC,GAGHK,GAAoBF,GAAkB,IAAI,IAAM,EAAGH,CAAa,EAAI,GAClE,CAACX,GAAkBI,GAAQA,EAAK,OAAS,2BAA6BA,EAAK,KAAK,SAAWO,EAAeD,CAAG,EAE7G,CAACA,EAAKC,EAAeW,EAAQ,iBAAiB,EANrB,IAQ/B,CAAC,EAAE,OAAO,OAAO,EAET,KAAK,uBAAuB,OAAS,CAC/C,EACA,KAAM,CAAE,YAAAd,CAAY,EAAG,CACrB,IAAMe,EAAYf,EAAY,sBAC9B,KAAK,uBAAuB,QAAQ,CAAC,CAACU,EAASC,EAAQK,CAAiB,IAAM,CAC5ErB,EAAI,wBAAyB,0BAA2B,CACtD,QAAAe,EACA,OAAAC,EACA,UAAAI,EACA,WAAYC,IAAsB,eAAiB,UAAY,UACjE,CAAC,CACH,CAAC,CACH,EACA,oBAAqB,CAAE,UAAAjB,EAAW,YAAAC,CAAY,EAAG,CAG/C,OAFiBA,EAAY,UAEb,MAAON,GACdc,GAAoBF,GAAkB,IAAI,IAAM,EAAGN,EAAY,sBAAsBD,EAAUL,CAAO,CAAC,EAAE,gBAAgB,EAAI,CACrI,CACH,CACF,CACF,EACA,CACE,KAAMI,GAA2B,KACjC,iBAAkB,CAChB,SAAU,6BACV,cAAe,CAAE,YAAAE,CAAY,EAAG,CAC9B,YAAK,kCAAoCA,EAAY,aAAa,IAAIiB,GAAS,CAC7E,GAAM,CAAE,WAAAC,CAAW,EAAID,EACjBE,EAAqB,CAAC,EACtBC,EAAoB,CAAC,EACrBC,EAAyB,CAAC,EAC1BC,EAAiBtB,EAAY,eAAekB,CAAU,GAAK,CAAC,EAElE,QAAWK,KAAcD,EAAgB,CACvC,IAAME,EAAWF,EAAeC,CAAU,EACtCC,EAAS,SAAWC,KAEpBD,EAAS,KAAK,gBAAkB,KAAK,IAAI,EAC3CL,EAAmB,KAAKI,CAAU,EACzBC,EAAS,KAAK,gBAAmB,KAAK,IAAI,EAAIf,KAClDe,EAAS,sBACZJ,EAAkB,KAAKM,GAAoBF,EAAU,CAAE,WAAAD,CAAW,CAAC,CAAC,EAGlE,CAAC,OAAO,KAAKC,EAAS,KAAK,EAAE,SAASxB,EAAY,qBAAqB,GACvE,CAACR,GAAkBI,GAAQA,EAAK,OAAS,qBAAuBA,EAAK,KAAK,aAAe2B,EAAYL,CAAU,GAEjHG,EAAuB,KAAK,CAC1B,WAAAE,EACA,UAAWC,EAAS,UACpB,aAAcA,EAAS,KAAK,aAC5B,aAAcA,EAAS,KAAK,YAC9B,CAAC,GAGP,CAEA,MAAO,CAAE,WAAAN,EAAY,kBAAAE,EAAmB,uBAAAC,EAAwB,mBAAAF,CAAmB,CACrF,CAAC,EAAE,OAAOQ,GAASA,EAAM,kBAAkB,QAAUA,EAAM,uBAAuB,QAAUA,EAAM,mBAAmB,MAAM,EAEpH,KAAK,kCAAkC,MAChD,EACA,MAAM,MAAQ,CACZ,OAAW,CAAE,WAAAT,EAAY,kBAAAE,EAAmB,uBAAAC,EAAwB,mBAAAF,CAAmB,IAAK,KAAK,kCAC3FC,EAAkB,QACpB,MAAMzB,EAAI,2CAA4C,CACpD,WAAAuB,EACA,KAAM,CAAE,UAAWE,CAAkB,CACvC,CAAC,EAGCC,EAAuB,QACzBA,EAAuB,QAAQG,GAAY,CACzC7B,EAAI,wBAAyB,oBAAqB,CAChD,QAASuB,EACT,UAAWM,EAAS,UACpB,WAAYA,EAAS,WACrB,aAAcA,EAAS,aACvB,aAAcA,EAAS,aACvB,MAAOA,EAAS,eAAiBI,GAAmBJ,EAAS,aAAa,KAAO,EACnF,CAAC,CACH,CAAC,EAGCL,EAAmB,QACrBxB,EAAI,wCAAyC,CAC3C,WAAAuB,EACA,KAAM,CAAE,YAAaC,CAAmB,CAC1C,CAAC,EACE,MAAOU,GAAM,CACZ,QAAQ,MAAM,8DAA+DA,CAAC,CAChF,CAAC,CAGT,EACA,oBAAqB,IAAM,EAC7B,CACF,EACA,CACE,KAAM/B,GAA2B,KACjC,iBAAkB,CAChB,SAAU,eACV,cAAe,CAAE,YAAAE,CAAY,EAAG,CAC9B,MAAO,CAAC,CAACA,EAAY,qBACvB,EACA,KAAM,CAAE,UAAAD,EAAW,YAAAC,CAAY,EAAG,CAChC,QAAQ,IACNA,EAAY,aAAa,OAAO,CAAC,CAAE,OAAA8B,CAAO,IAAMA,CAAM,EAAE,IAAI,CAAC,CAAE,WAAAZ,CAAW,IACjEvB,EAAI,yCAA0C,CACnD,WAAAuB,EACA,SAAU,EACZ,CAAC,CACF,CACH,EAAE,MAAOW,GAAM,CACb,QAAQ,MAAM,8BAA+BA,CAAC,CAChD,CAAC,CACH,EACA,oBAAqB,IAAM,EAC7B,CACF,CACF,EAEOE,GAAQlC,GCxNf,IAAMmC,GAAUC,GAAUC,GAAmB,CAG3C,IAAMC,EAAUD,IAAW,WAAcA,IAAW,UAAY,aAAa,aAAe,UAEtF,CAAE,oBAAAE,CAAoB,EAAIC,EAAI,kBAAkB,EAAE,SACxD,QAAQ,KAAK,oCAAoCF,EAAU,UAAY,UAAU,yBAAyBC,CAAmB,EAAE,GAG3H,CAACD,GAAWC,IACdC,EAAI,wCAAwC,EAAE,MAAMC,GAAK,CACvD,QAAQ,MAAM,iEAAkEA,CAAC,CACnF,CAAC,CAEL,EAAG,GAAG,EA8EN,eAAsBC,GAAkB,CAAE,MAAAC,EAAO,KAAAC,EAAM,KAAAC,EAAM,KAAAC,EAAM,QAAAC,EAAS,cAAAC,CAAc,EAGxE,CAChB,GAAI,OAAO,cAAiB,WAC5B,IAAI,OAAOH,GAAS,UAAYA,EAAK,YAAa,CAEhD,IAAMI,EAAoB,MAAMC,EAAI,wBAAyBL,EAAK,WAAW,EAAE,MAAOM,GAAM,CAC1F,QAAQ,MAAM,6CAA8CA,CAAC,CAC/D,CAAC,EACGF,IAEFJ,EAAO,gBAAkB,mBAAmB,OAAO,KAAKI,CAAiB,EAAE,SAAS,QAAQ,CAAC,EAEjG,CAGA,GAAI,OAAO,mBAAsB,WAC/B,GAAI,CAEF,GAAI,UAAU,SAAW,uBACvB,MAAM,IAAI,MAAM,uEAAuE,EAEzF,IAAMG,EAAe,IAAI,aAAaT,EAAO,CAAE,KAAAC,EAAM,KAAAC,CAAK,CAAC,EACvDC,IACFM,EAAa,QAAWC,GAAU,CAChCH,EAAI,mBAAmB,EAAE,KAAK,CAAE,KAAAJ,CAAK,CAAC,EAAE,MAAM,QAAQ,IAAI,CAC5D,EAEJ,MAAY,CACV,OAAO,UAAU,eAAe,MAAM,KAAKQ,GAElCA,EAAa,iBAAiBX,EAAO,CAAE,KAAAC,EAAM,KAAAC,EAAM,KAAM,CAAE,QAAAE,EAAS,KAAAD,EAAM,cAAAE,CAAc,CAAE,CAAC,CACnG,EAAE,MAAM,QAAQ,IAAI,CACvB,KAGA,QAAO,KAAK,QAAQ,SAAS,CAAE,KAAM,QAAS,CAAC,EAAE,KAAMO,GAAe,CAEpE,GAAI,CAAAA,EAAW,KAAKC,GAAUA,EAAO,OAAO,EAG5C,OAAO,KAAK,aAAa,iBAAiBb,EACxC,CAAE,KAAAC,EAAM,KAAAC,EAAM,KAAM,CAAE,QAAAE,EAAS,KAAAD,EAAM,cAAAE,CAAc,CAAE,CACvD,EAAE,MAAM,QAAQ,IAAI,CACtB,CAAC,EAEL,CC5IO,IAAMS,GAAQ,QACRC,GAAc,cACdC,GAAiB,iBACjBC,GAAc,cACdC,GAAS,SAETC,GAAS,SACTC,GAAU,UACVC,GAAe,eACfC,GAAsB,sBAEtBC,GAAW,WAEXC,GAAiB,iBACjBC,GAAe,eACfC,GAAe,eACfC,GAAa,aACbC,GAA8C,oCAE9CC,GAAkB,kBAClBC,GAAgB,gBAChBC,GAAmB,mBAGzB,IAAMC,GAAyB,yBAgB/B,IAAMC,GAAgB,gBAChBC,GAAsB,sBAW5B,IAAMC,GAAuB,uBACvBC,GAA4B,4BAE5BC,GAAyB,yBAEzBC,GAAW,WAIjB,IAAMC,GAA0B,0BAE1BC,GAAuB,uBACvBC,GAAuB,uBACvBC,GAA6B,6BAE7BC,GAA+B,+BAC/BC,GAAqB,qBACrBC,GAAsB,sBACtBC,GAAkB,kBAElBC,GAAqC,qCAI3C,IAAMC,GAAgB,gBCjDtB,IAAMC,GAAU,CACrB,gBAAiB,iBACjB,eAAgB,eAChB,YAAa,cACb,cAAe,eACjB,EAEaC,GAAkB,IAElBC,GAAiC,GAAK,IAEtCC,GAAkB,CAC7B,sBAAuB,sBACzB,EC5CA,IAAqBC,GAArB,KAAkC,CAChCC,GACAC,GAAY,EACZC,GAAgB,GAChBC,GAAU,GACVC,GAAU,EAEV,YAAaC,EAAkBC,EAAoB,GAAI,CACrD,KAAKN,GAAU,IAAI,MAAMK,CAAQ,EAAE,KAAKC,CAAY,EACpD,KAAKL,GAAYI,EACjB,KAAKH,GAAgBI,CACvB,CAEA,IAAKC,EAAY,CACf,IAAMF,EAAW,KAAKJ,GAChBO,EAAS,KAAKJ,GACpB,KAAKJ,GAAQQ,CAAM,EAAID,EACnBC,IAAWH,EAAW,IACxB,KAAKF,GAAU,IAEjB,KAAKC,IAAWI,EAAS,GAAKH,CAChC,CAEA,OAAQI,EAAmB,CACzB,QAAWF,KAASE,EAClB,KAAK,IAAIF,CAAK,CAElB,CAEA,OAAS,CACP,KAAKP,GAAQ,KAAK,KAAKE,EAAa,EACpC,KAAKC,GAAU,GACf,KAAKC,GAAU,CACjB,CAEA,SAAqB,CACnB,IAAMM,EAAS,KAAKV,GACdQ,EAAS,KAAKJ,GACpB,OACE,KAAKD,GACD,CAAC,GAAGO,EAAO,MAAMF,CAAM,EAAG,GAAGE,EAAO,MAAM,EAAGF,CAAM,CAAC,EACpDE,EAAO,MAAM,EAAGF,CAAM,CAE9B,CACF,EC3CA,IAAMG,GAAgB,CAAC,QAAS,QAAS,OAAQ,MAAO,MAAM,EACxDC,GAAkB,QAClBC,GAAO,IAAIC,IAAW,GAE5B,eAAsBC,GAAcC,EAAgB,CAAE,QAAAC,EAAS,WAAAC,EAAY,QAAAC,CAAQ,EAA2E,CAC5J,IAAMC,EAAU,IAAIC,GAAaL,EAAO,UAAU,EAC5CM,EAAU,OAAO,YAAYX,GAAc,IAAKY,GACpD,CAACA,EAAM,IAAIT,IAAS,CAClBF,GAAgBW,CAAI,EAAE,GAAGT,CAAI,EAC7BU,GAAgBC,EAAQF,EAAMP,EAAO,OAAQ,GAAGF,CAAI,CACtD,CAAC,CACH,CAAC,EACKY,EAA0B,CAAC,EAE3BC,EAAe,IAAI,MAAM,CAAE,GAAGL,CAAQ,EAAG,CAC7C,IAAKM,EAAGC,EAAGC,EAAG,CACZ,OAAO,QAAQ,IAAIF,EAAGC,CAAC,EAAI,QAAQ,IAAID,EAAGC,EAAGC,CAAC,EAAI,QAAQ,IAAIlB,GAAiBiB,EAAGC,CAAC,CACrF,EACA,IAAKF,EAAGC,EAAG,CACT,OAAO,QAAQ,IAAIjB,GAAiBiB,CAAC,CACvC,CACF,CAAC,EACKJ,EAAS,CACb,IAAI,eAAiB,CACnB,MAAO,CAAC,GAAGC,CAAa,CAC1B,EACA,QAASC,EACT,QAAAP,EACA,MAAM,OAAS,CACb,MAAMF,EAAW,SAAS,EAC1BE,EAAQ,MAAM,CAChB,EACA,MAAM,MAAQ,CACZ,GAAI,CACF,MAAMD,EAAQ,UAAW,KAAK,QAAQ,QAAQ,CAAC,CACjD,OAASY,EAAO,CACdJ,EAAa,MAAMI,CAAK,CAC1B,CACF,EACA,iBAAkBC,EAAuB,CACvCN,EAAc,OAAO,EAAGA,EAAc,OAAQ,GAAGM,CAAM,EAIvD,QAAWC,KAAStB,GAElBgB,EAAaM,CAAK,EAAIP,EAAc,SAASO,CAAK,EAAIX,EAAQW,CAAK,EAAIpB,EAE3E,CACF,EAGMqB,EAAkB,MAAO,SAAY,CACzC,GAAI,CACF,IAAMC,EAAS,MAAMlB,EAAQ,SAAS,EACtC,OAAOkB,EAAS,KAAK,MAAMA,CAAM,EAAI,CAAC,CACxC,OAASJ,EAAO,CACd,OAAAJ,EAAa,MAAM,kCAAmCI,CAAK,EACpD,CAAC,CACV,CACF,GAAG,EAGH,OAAIf,EAAO,WAAakB,EAAgB,QACtCA,EAAgB,OAAO,EAAGA,EAAgB,OAASlB,EAAO,UAAU,EAGlEkB,EAAgB,QAClBT,EAAO,QAAQ,OAAOS,CAAe,EAGhCT,CACT,CAEA,SAASD,GAAiBC,EAAgBW,EAAcC,KAAmBvB,EAAM,CAC/E,IAAMwB,EAAQ,CACZ,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,OAAAD,EACA,KAAAD,EAGA,IAAKtB,EAAK,IAAKyB,GAAQ,CACrB,GAAI,CACF,IAAMC,EAAO,IAAI,QACjB,OAAO,KAAK,MACV,KAAK,UAAUD,EAAK,CAACE,EAAGC,IAAM,CAC5B,GAAIA,aAAa,MACf,MAAO,CACL,KAAMA,EAAE,KACR,QAASA,EAAE,QACX,MAAOA,EAAE,KACX,EAGF,GAAI,OAAOA,GAAM,UAAYA,IAAM,KAAM,CACvC,GAAIF,EAAK,IAAIE,CAAC,EACZ,MAAO,uBAETF,EAAK,IAAIE,CAAC,CACZ,CACA,OAAOA,CACT,CAAC,CACH,CACF,OAASC,EAAG,CACV,MAAO,sDAAsD,OAAOJ,CAAG,WAAWI,EAAE,OAAO,GAC7F,CACF,CAAC,CACH,EACAlB,EAAO,QAAQ,IAAIa,CAAK,EAKxBM,EAAI,mBAAoB,uBAAuB,EAAEC,GAAeP,CAAK,CACvE,CC5GA,IAAMQ,GAAS,IAAI,IAEZC,GAASC,EAAI,yBAA0B,CAC5C,qBAAsB,SAAUC,EAAK,CACnC,OAAOH,GAAO,IAAIG,CAAG,CACvB,EACA,qBAAsB,SAAUA,EAAKC,EAAM,CACzC,OAAAJ,GAAO,IAAIG,EAAKC,CAAI,EACbA,CACT,EACA,wBAAyB,SAAUD,EAAK,CACtC,OAAOH,GAAO,OAAOG,CAAG,CAC1B,EACA,qBAAsB,SAAUA,EAAKC,EAAM,CACzC,IAAMC,EAAQL,GAAO,IAAIG,CAAG,EACxBE,EACFA,EAAM,KAAKD,CAAI,EAEfJ,GAAO,IAAIG,EAAK,CAACC,CAAI,CAAC,CAE1B,EACA,wBAAyB,SAAUD,EAAKC,EAAM,CAC5C,IAAMC,EAAQL,GAAO,IAAIG,CAAG,EAC5B,GAAIE,EAAO,CACT,IAAMC,EAAOD,EAAM,OACbE,EAAWF,EAAM,OAAOG,GAAKA,IAAMJ,CAAI,EAC7C,OAAAJ,GAAO,IAAIG,EAAKI,CAAQ,EACjBD,EAAOC,EAAS,MACzB,CACF,EACA,uBAAwB,SAAUJ,EAAKM,EAAI,CACzC,OAAOA,EAAGT,GAAO,IAAIG,CAAG,CAAC,CAC3B,CACF,CAAC,ECtCD,IAAMO,GAAaC,GAAQ,UAAUA,CAAG,aACjCC,GAAQA,EAAI,yBAA0B,CACzC,yBAA0B,UAAY,CAClC,KAAK,aAAe,CAACC,EAAOC,IAAM,CAC9B,QAAQ,MAAM,2CAA2CD,CAAK,GAAIC,CAAC,CACvE,CACJ,EACA,sBAAuB,SAAUD,EAAOE,EAAS,CAC7C,OAAAH,EAAI,qBAAsBF,GAAUG,CAAK,EAAGE,CAAO,EAC5C,IAAMH,EAAI,uBAAwBC,EAAOE,CAAO,CAC3D,EACA,wBAAyB,SAAUF,EAAOE,EAAS,CAC/C,IAAMC,EAAY,IAAIC,IAAS,CAC3BF,EAAQ,GAAGE,CAAI,EACfL,EAAI,uBAAwBC,EAAOG,CAAS,CAChD,EACA,OAAOJ,EAAI,sBAAuBC,EAAOG,CAAS,CACtD,EACA,wBAAyB,SAAUH,KAAUK,EAAM,CAC/C,IAAIC,EACJ,QAAWC,KAAYR,EAAI,qBAAsBF,GAAUG,CAAK,CAAC,GAAK,CAAC,EACnE,GAAI,CACAO,EAAS,GAAGF,CAAI,CACpB,OACOJ,EAAG,EACLK,EAAK,KAAK,gBAAkB,MAAQA,IAAO,QAAkBA,EAAG,KAAK,KAAMN,EAAOC,CAAC,CACxF,CAER,EAEA,uBAAwB,SAAUD,EAAOE,EAAS,CAC1CA,EACAH,EAAI,wBAAyBF,GAAUG,CAAK,EAAGE,CAAO,EAGtDH,EAAI,wBAAyBF,GAAUG,CAAK,CAAC,CAErD,EACA,mCAAoC,SAAUQ,EAAc,CACxD,KAAK,aAAeA,CACxB,CACJ,CAAC,EC1CD,IAAOC,GAASC,GAA8B,CAuB9C,ECfA,IAAMC,GAAS,CACb,WAAYC,GACZ,OAAQ,IACV,EACMC,GAAkB,KAAK,QAGzBC,GAAiB,KACjBC,GAA6B,GAG3BC,GAAWC,GAAkCC,EAAI,kBAAmB,aAAaH,EAAkB,IAAIE,CAAG,EAAE,EAC5GE,GAAcF,GAA+BC,EAAI,oBAAqB,aAAaH,EAAkB,IAAIE,CAAG,EAAE,EAC9GG,GAAU,CAACH,EAAaI,IACrBH,EAAI,kBAAmB,aAAaH,EAAkB,IAAIE,CAAG,GAAI,OAAOI,GAAU,SAAWA,EAAQ,KAAK,UAAUA,CAAK,CAAC,EAGnI,eAAeC,GAAkBC,EAAoB,CACnDR,GAAqBQ,EAErBT,GAAS,MAAMU,GAAab,GAAQ,CAAE,QAAAK,GAAS,WAAAG,GAAY,QAAAC,EAAQ,CAAC,EAGpE,MAAMA,GAAQ,SAAUT,EAAM,EAG9BG,GAAO,iBAA8D,IAAI,gBAAgB,SAAS,MAAM,EAAE,IAAI,OAAO,EACjH,CAAC,QAAS,OAAQ,OAAQ,QAAS,KAAK,EACxC,CAAC,QAAS,OAAQ,MAAM,CAAa,EAGzCI,EAAI,sBAAuBO,GAAqBX,GAAO,gBAAgB,EAGvE,KAAK,QAAUA,GAAO,QAEtBD,GAAgB,IAAI,oCAAqCC,GAAO,YAAY,CAC9E,CAEA,eAAeY,GAAkB,CAAE,QAAAC,CAAQ,EAAwC,CAC7EA,GAAW,MAAMC,GAAU,EAC/BV,EAAI,uBAAwBO,EAAmB,EAC/C,QAAQ,IAAI,oBAAoB,EAEhC,KAAK,QAAUZ,EACjB,CAEA,eAAee,IAAa,CAC1B,MAAMd,IAAQ,MAAM,CACtB,CAKAI,EAAI,sBAAuBW,GAAeC,GAAS,IAAM,CACvDhB,IAAQ,KAAK,EAAE,MAAM,GAAK,CACxB,QAAQ,MAAM,uDAAwD,CAAC,CACzE,CAAC,CACH,EAAG,GAAI,CAAC,EAGRiB,GAAUlB,EAAe,EAEzB,IAAOmB,GAASd,EAAI,yBAA0B,CAC5C,cAAgB,CAAE,OAAOJ,IAAQ,QAAQ,QAAQ,GAAK,CAAC,CAAE,EACzD,KAAM,eAAiB,CAAE,MAAMA,IAAQ,KAAK,CAAE,EAC9C,sBAAuBY,GACvB,sBAAuBJ,GACvB,KAAM,mBAAoBW,EAAQ,CAChC,IAAMC,EAAUnB,GAChBA,GAAqBkB,EACrB,GAAI,CAAE,MAAML,GAAU,CAAE,MAAQ,CAAC,CACjCb,GAAqBmB,CACvB,CACF,CAAC,EC/ED,IAAMC,GAAwB,GACnB,OAAO,UAAU,eAAe,KAAK,EAAG,eAAe,EAE3DC,GAAQA,EAAI,yBAA0B,CACzC,6BAA8B,UAAY,CACtC,KAAK,YAAc,OAAO,OAAO,IAAI,CACzC,EACA,iCAAkC,SAAUC,EAAM,CAC9C,IAAIC,EACJ,MAAO,CAAC,EAAG,GAAAA,EAAK,KAAK,YAAYD,CAAI,KAAO,MAAQC,IAAO,SAAkBA,EAAG,OACpF,EACA,yCAA0C,SAAUD,EAAM,CACtD,IAAIC,EAAIC,EACR,OAAIF,GAAQ,KACD,OAAO,YAAY,OAAO,QAAQ,KAAK,WAAW,EAAE,IAAI,CAAC,CAACA,EAAMG,CAAM,IAAM,CAACH,EAAMG,EAAO,IAAKC,GAC1FN,GAAqBM,CAAK,EACnBA,EAAM,cAGNA,EAAM,EAEpB,CAAC,CAAC,CAAC,GAEJF,GAAMD,EAAK,KAAK,YAAYD,CAAI,KAAO,MAAQC,IAAO,OAAS,OAASA,EAAG,IAAKG,GAChFN,GAAqBM,CAAK,EACnBA,EAAM,cAGNA,EAAM,EAEpB,KAAO,MAAQF,IAAO,OAASA,EAAK,CAAC,CAC1C,EACA,kCAAmC,eAAgBF,EAAMK,EAAY,CAC5D,OAAO,UAAU,eAAe,KAAK,KAAK,YAAaL,CAAI,IAC5D,KAAK,YAAYA,CAAI,EAAI,CAAC,GAE9B,IAAMG,EAAS,KAAK,YAAYH,CAAI,EAChCM,EACEC,EAAU,IAAI,QAASC,GAAY,CAAEF,EAASE,CAAS,CAAC,EACxDC,EAAY,OAAOJ,GAAe,WAClC,CACE,GAAIA,EACJ,QAAAE,CACJ,EACE,CACE,cAAeF,EACf,QAAAE,CACJ,EAEJ,IADAJ,EAAO,KAAKM,CAAS,EACdN,EAAO,OAAS,GAAG,CACtB,IAAMC,EAAQD,EAAO,CAAC,EACtB,GAAIC,IAAUK,EACV,GAAI,CACA,OAAI,OAAOJ,GAAe,WACf,MAAMA,EAAW,EAGjB,MAAMN,EAAI,GAAGM,CAAU,CAEtC,QACA,CAGIC,EAAO,EACPH,EAAO,MAAM,CACjB,MAIA,MAAMC,EAAM,OAEpB,CACJ,CACJ,CAAC,EC/ED,IAAAM,GAAmB,WACnBC,GAAiB,WACXC,GAAYC,GACM,IAAI,YAAY,EACjB,OAAOA,CAAG,EAE3BC,GAAeC,GAAS,CAC1B,IAAMC,EAAa,OAAOD,GAAS,SAAWH,GAASG,CAAI,EAAIA,EACzDE,EAASC,GAAW,OAAOF,CAAU,EAG3C,OAAOG,GAAU,OAAOF,EAAO,KAAK,CACxC,EACMG,GAAYL,GAAS,IAAI,WAAW,KAAKA,CAAI,EAC9C,MAAM,EAAE,EACR,IAAKM,GAAMA,EAAE,WAAW,CAAC,CAAC,CAAC,EAOzB,IAAMC,GAA0B,0BAC1BC,GAA6B,6BAC7BC,GAAmB,mBAEnBC,GAAe,eAItBC,GAAsBC,GAAQ,CAChC,GAAI,EAAEA,aAAe,YACjB,MAAM,UAAU,kBAAkB,EAEtC,OAAO,KAAK,MAAM,KAAKA,CAAG,EACrB,IAAKC,GAAM,OAAO,aAAaA,CAAC,CAAC,EACjC,KAAK,EAAE,CAAC,CACjB,EACaC,GAAUC,GAAS,CAS5B,GAAIA,IAASR,GAAyB,CAClC,IAAMS,EAAM,GAAAC,QAAK,KAAK,QAAQ,EACxBC,EAAM,CACR,KAAAH,EACA,UAAWC,EAAI,SACnB,EAEA,cAAO,eAAeE,EAAK,YAAa,CAAE,MAAOF,EAAI,SAAU,CAAC,EACzDE,CACX,SACSH,IAASP,GAA4B,CAC1C,IAAMQ,EAAM,GAAAC,QAAK,IAAI,QAAQ,EACvBC,EAAM,CACR,KAAAH,EACA,UAAWC,EAAI,SACnB,EACA,cAAO,eAAeE,EAAK,YAAa,CAAE,MAAOF,EAAI,SAAU,CAAC,EACzDE,CACX,SACSH,IAASN,GAAkB,CAChC,IAAMS,EAAM,CACR,KAAAH,CACJ,EACA,cAAO,eAAeG,EAAK,YAAa,CAAE,MAAO,GAAAD,QAAK,YAAY,GAAAA,QAAK,UAAU,SAAS,CAAE,CAAC,EACtFC,CACX,SACSH,IAASL,GAAc,CAC5B,IAAMQ,EAAM,CACR,KAAAH,CACJ,EACA,cAAO,eAAeG,EAAK,YAAa,CAAE,MAAO,GAAAD,QAAK,YAAY,EAAE,CAAE,CAAC,EAChEC,CACX,CACA,MAAM,IAAI,MAAM,sBAAsB,CAC1C,EACaC,GAAe,IACjBR,GAAmB,GAAAM,QAAK,YAAY,EAAE,CAAC,EAmD3C,IAAMG,GAAe,CAACC,EAAKC,IAAkB,CAQhD,GAAID,EAAI,OAASE,IAA2BF,EAAI,OAASG,GAA4B,CACjF,GAAI,CAACF,EAAe,CAChB,GAAI,CAACD,EAAI,UACL,MAAM,IAAI,MAAM,gDAAgD,EAEpE,OAAO,KAAK,UAAU,CAClBA,EAAI,KACJI,GAAmBJ,EAAI,SAAS,EAChC,IACJ,EAAG,OAAW,CAAC,CACnB,CACA,GAAI,CAACA,EAAI,UACL,MAAM,IAAI,MAAM,gDAAgD,EAEpE,OAAO,KAAK,UAAU,CAClBA,EAAI,KACJ,KACAI,GAAmBJ,EAAI,SAAS,CACpC,EAAG,OAAW,CAAC,CACnB,SACSA,EAAI,OAASK,GAAkB,CACpC,GAAI,CAACJ,EACD,MAAM,IAAI,MAAM,gDAAgD,EAEpE,GAAI,CAACD,EAAI,UACL,MAAM,IAAI,MAAM,gDAAgD,EAEpE,OAAO,KAAK,UAAU,CAClBA,EAAI,KACJ,KACAI,GAAmBJ,EAAI,SAAS,CACpC,EAAG,OAAW,CAAC,CACnB,CACA,MAAM,IAAI,MAAM,sBAAsB,CAC1C,EACaM,GAAkBC,GAAS,CACpC,IAAMC,EAAU,KAAK,MAAMD,CAAI,EAC/B,GAAI,CAACC,GAAWA,EAAQ,SAAW,EAC/B,MAAM,IAAI,MAAM,oBAAoB,EAexC,GAAIA,EAAQ,CAAC,IAAMN,GAAyB,CACxC,GAAIM,EAAQ,CAAC,EAAG,CACZ,IAAMR,EAAM,GAAAS,QAAK,KAAK,QAAQ,cAAcC,GAASF,EAAQ,CAAC,CAAC,CAAC,EAC1DG,EAAM,CACR,KAAMH,EAAQ,CAAC,EACf,UAAWR,EAAI,SACnB,EACA,cAAO,eAAeW,EAAK,YAAa,CAAE,MAAOX,EAAI,SAAU,CAAC,EACzDW,CACX,SACSH,EAAQ,CAAC,EACd,MAAO,CACH,KAAMA,EAAQ,CAAC,EACf,UAAW,IAAI,WAAWE,GAASF,EAAQ,CAAC,CAAC,CAAC,CAClD,EAEJ,MAAM,IAAI,MAAM,8BAA8B,CAClD,SACSA,EAAQ,CAAC,IAAML,GAA4B,CAChD,GAAIK,EAAQ,CAAC,EAAG,CACZ,IAAMR,EAAM,GAAAS,QAAK,IAAI,QAAQ,cAAcC,GAASF,EAAQ,CAAC,CAAC,CAAC,EACzDG,EAAM,CACR,KAAMH,EAAQ,CAAC,EACf,UAAWR,EAAI,SACnB,EACA,cAAO,eAAeW,EAAK,YAAa,CAAE,MAAOX,EAAI,SAAU,CAAC,EACzDW,CACX,SACSH,EAAQ,CAAC,EACd,MAAO,CACH,KAAMA,EAAQ,CAAC,EACf,UAAW,IAAI,WAAWE,GAASF,EAAQ,CAAC,CAAC,CAAC,CAClD,EAEJ,MAAM,IAAI,MAAM,8BAA8B,CAClD,SACSA,EAAQ,CAAC,IAAMH,GAAkB,CACtC,GAAI,CAACG,EAAQ,CAAC,EACV,MAAM,IAAI,MAAM,oBAAoB,EAExC,IAAMG,EAAM,CACR,KAAMH,EAAQ,CAAC,CACnB,EACA,cAAO,eAAeG,EAAK,YAAa,CAAE,MAAO,IAAI,WAAWD,GAASF,EAAQ,CAAC,CAAC,CAAC,CAAE,CAAC,EAChFG,CACX,CACA,MAAM,IAAI,MAAM,sBAAsB,CAC1C,EACaC,GAAoBC,GAAU,CACvC,IAAMb,EAAM,OAAOa,GAAU,SAAWP,GAAeO,CAAK,EAAIA,EAChE,OAAOC,GAAOd,EAAI,IAAI,CAC1B,EACae,GAASF,GAAU,CAC5B,IAAMb,EAAM,OAAOa,GAAU,SAAWP,GAAeO,CAAK,EAAIA,EAC1DG,EAAgBjB,GAAaC,EAAK,CAACA,EAAI,SAAS,EACtD,OAAOiB,GAAYD,CAAa,CACpC,EACaE,GAAO,CAACL,EAAON,IAAS,CACjC,IAAMP,EAAM,OAAOa,GAAU,SAAWP,GAAeO,CAAK,EAAIA,EAOhE,GAAIb,EAAI,OAASE,GACb,MAAM,IAAI,MAAM,uBAAuB,EAE3C,GAAI,CAACF,EAAI,UACL,MAAM,IAAI,MAAM,oBAAoB,EAExC,IAAMmB,EAAeC,GAASb,CAAI,EAC5Bc,EAAY,GAAAZ,QAAK,KAAK,SAASU,EAAcnB,EAAI,SAAS,EAEhE,OADwBI,GAAmBiB,CAAS,CAExD,EACaC,GAAkB,CAACT,EAAON,EAAMc,IAAc,CACvD,IAAMrB,EAAM,OAAOa,GAAU,SAAWP,GAAeO,CAAK,EAAIA,EAUhE,GAAIb,EAAI,OAASE,GACb,MAAM,IAAI,MAAM,uBAAuB,EAE3C,GAAI,CAACF,EAAI,UACL,MAAM,IAAI,MAAM,oBAAoB,EAExC,IAAMuB,EAAmBb,GAASW,CAAS,EACrCF,EAAeC,GAASb,CAAI,EAElC,GAAI,CADW,GAAAE,QAAK,KAAK,SAAS,OAAOU,EAAcI,EAAkBvB,EAAI,SAAS,EAElF,MAAM,IAAI,MAAM,mBAAmB,CAE3C,EAMawB,GAAU,CAACX,EAAON,EAAMkB,IAAO,CACxC,IAAMzB,EAAM,OAAOa,GAAU,SAAWP,GAAeO,CAAK,EAAIA,EAOhE,GAAIb,EAAI,OAASK,GAAkB,CAC/B,GAAI,CAACL,EAAI,UACL,MAAM,IAAI,MAAM,oBAAoB,EAExC,IAAM0B,EAAQ,GAAAjB,QAAK,YAAY,GAAAA,QAAK,UAAU,WAAW,EACrDkB,EACJ,GAAIF,EAAI,CACJE,EAAkB,IAAI,WAAWD,CAAK,EACtC,IAAME,EAAS,GAAAnB,QAAK,KAAKW,GAASK,CAAE,CAAC,EAC/BI,EAAM,KAAK,IAAID,EAAO,OAAQF,EAAM,MAAM,EAChD,QAASI,EAAI,EAAGA,EAAID,EAAKC,IACrBH,EAAgBG,CAAC,GAAKF,EAAOE,CAAC,CAEtC,MAEIH,EAAkBD,EAEtB,IAAMP,EAAeC,GAASb,CAAI,EAC5BwB,EAAM,GAAAtB,QAAK,UAAUU,EAAcQ,EAAiB3B,EAAI,SAAS,EACjEgC,EAAc,IAAI,WAAWN,EAAM,OAASK,EAAI,MAAM,EAC5D,OAAAC,EAAY,IAAIN,CAAK,EACrBM,EAAY,IAAID,EAAKL,EAAM,MAAM,EACPtB,GAAmB4B,CAAW,CAE5D,SACShC,EAAI,OAASG,GAA4B,CAC9C,GAAI,CAACH,EAAI,UACL,MAAM,IAAI,MAAM,oBAAoB,EAExC,IAAM0B,EAAQ,GAAAjB,QAAK,YAAY,GAAAA,QAAK,IAAI,WAAW,EAC/CkB,EACJ,GAAIF,EAAI,CACJE,EAAkB,IAAI,WAAWD,CAAK,EACtC,IAAME,EAAS,GAAAnB,QAAK,KAAKW,GAASK,CAAE,CAAC,EAC/BI,EAAM,KAAK,IAAID,EAAO,OAAQF,EAAM,MAAM,EAChD,QAASI,EAAI,EAAGA,EAAID,EAAKC,IACrBH,EAAgBG,CAAC,GAAKF,EAAOE,CAAC,CAEtC,MAEIH,EAAkBD,EAEtB,IAAMP,EAAeC,GAASb,CAAI,EAC5B0B,EAAe,GAAAxB,QAAK,IAAI,QAAQ,EAChCsB,EAAM,GAAAtB,QAAK,IAAIU,EAAcQ,EAAiB3B,EAAI,UAAWiC,EAAa,SAAS,EAEzF,OAAO,gBAAgBA,EAAa,SAAS,EAC7CA,EAAa,UAAU,KAAK,CAAC,EAC7B,IAAMD,EAAc,IAAI,WAAW,GAAAvB,QAAK,IAAI,gBAAkBiB,EAAM,OAASK,EAAI,MAAM,EACvF,OAAAC,EAAY,IAAIC,EAAa,SAAS,EACtCD,EAAY,IAAIN,EAAO,GAAAjB,QAAK,IAAI,eAAe,EAC/CuB,EAAY,IAAID,EAAK,GAAAtB,QAAK,IAAI,gBAAkBiB,EAAM,MAAM,EAClCtB,GAAmB4B,CAAW,CAE5D,CACA,MAAM,IAAI,MAAM,uBAAuB,CAC3C,EACaE,GAAU,CAACrB,EAAON,EAAMkB,IAAO,CACxC,IAAMzB,EAAM,OAAOa,GAAU,SAAWP,GAAeO,CAAK,EAAIA,EAUhE,GAAIb,EAAI,OAASK,GAAkB,CAC/B,GAAI,CAACL,EAAI,UACL,MAAM,IAAI,MAAM,oBAAoB,EAExC,IAAMmC,EAA+BzB,GAASH,CAAI,EAC5CmB,EAAQS,EAA6B,MAAM,EAAG,GAAA1B,QAAK,UAAU,WAAW,EACxE2B,EAAUD,EAA6B,MAAM,GAAA1B,QAAK,UAAU,YAAa0B,EAA6B,MAAM,EAClH,GAAIV,EAAI,CACJ,IAAMG,EAAS,GAAAnB,QAAK,KAAKW,GAASK,CAAE,CAAC,EAC/BI,EAAM,KAAK,IAAID,EAAO,OAAQF,EAAM,MAAM,EAChD,QAASI,EAAI,EAAGA,EAAID,EAAKC,IACrBJ,EAAMI,CAAC,GAAKF,EAAOE,CAAC,CAE5B,CACA,IAAMO,EAAY,GAAA5B,QAAK,UAAU,KAAK2B,EAASV,EAAO1B,EAAI,SAAS,EACnE,GAAI,CAACqC,EACD,MAAM,IAAI,MAAM,2BAA2B,EAE/C,OAAO,OAAO,KAAKA,CAAS,EAAE,SAAS,OAAO,CAClD,SACSrC,EAAI,OAASG,GAA4B,CAC9C,GAAI,CAACH,EAAI,UACL,MAAM,IAAI,MAAM,oBAAoB,EAExC,IAAMmC,EAA+BzB,GAASH,CAAI,EAC5C+B,EAAqBH,EAA6B,MAAM,EAAG,GAAA1B,QAAK,IAAI,eAAe,EACnFiB,EAAQS,EAA6B,MAAM,GAAA1B,QAAK,IAAI,gBAAiB,GAAAA,QAAK,IAAI,gBAAkB,GAAAA,QAAK,IAAI,WAAW,EACpH2B,EAAUD,EAA6B,MAAM,GAAA1B,QAAK,IAAI,gBAAkB,GAAAA,QAAK,IAAI,WAAW,EAClG,GAAIgB,EAAI,CACJ,IAAMG,EAAS,GAAAnB,QAAK,KAAKW,GAASK,CAAE,CAAC,EAC/BI,EAAM,KAAK,IAAID,EAAO,OAAQF,EAAM,MAAM,EAChD,QAASI,EAAI,EAAGA,EAAID,EAAKC,IACrBJ,EAAMI,CAAC,GAAKF,EAAOE,CAAC,CAE5B,CACA,IAAMO,EAAY,GAAA5B,QAAK,IAAI,KAAK2B,EAASV,EAAOY,EAAoBtC,EAAI,SAAS,EACjF,GAAI,CAACqC,EACD,MAAM,IAAI,MAAM,2BAA2B,EAE/C,OAAO,OAAO,KAAKA,CAAS,EAAE,SAAS,OAAO,CAClD,CACA,MAAM,IAAI,MAAM,uBAAuB,CAC3C,EC5ZA,IAAME,GAAc,IAAMC,EAAI,oBAAoB,EA8B5CC,GAAgB,OAAO,OAAO,KAAM,CACxC,cAAe,CACb,MAAO,EACT,CACF,CAAC,EAEKC,GAAcC,GACX,OAAO,eAAeA,EAAGF,EAAK,EAM1BG,GAAgBD,GACpB,CAAC,CAACA,GAAK,CAAC,CAAC,OAAO,eAAeA,CAAC,GAAG,cAKtCE,GAAW,SAAUC,EAAoCC,EAAgBC,EAAWC,EAAqBC,EAAwBC,EAAwB,CAC7J,IAAMC,EAAQ,OAAON,GAAsB,SAAWP,GAAY,EAAEO,CAAiB,EAAIA,EACzF,GAAI,CAACK,EACH,MAAM,IAAIE,GAAwB,4CAA4C,EAIhF,IAAMC,EAAgBF,GAAO,KAAK,iBAAiBL,CAAM,EACzD,GAAI,CAACO,GAAe,QAAQ,SAC1B,KACF,EACE,MAAM,IAAIC,GAA8B,kBAAkBR,CAAM,2CAA2C,EAE7G,GAAIO,EAAc,iBAAmB,KAAM,CACzC,IAAME,EAAQJ,EAAM,IAAU,eAAeL,CAAM,EAAE,KAC/CU,EAAY,OAAO,OAAOL,EAAM,KAAK,cAAc,EAAE,KAAMM,GAAWA,EAAE,iBAAmB,MAAQA,EAAE,OAASF,GAAQE,EAAE,QAAQ,SAAS,KAAK,CAAC,GAAS,GAE9J,GAAI,CAACD,EACH,MAAM,IAAIF,GAA8B,kBAAkBR,CAAM,6DAA6DS,CAAI,GAAG,EAGtIT,EAASU,CACX,CAEA,IAAME,EAAMT,EAAeH,CAAM,EAEjC,GAAI,CAACY,EACH,MAAM,IAAIJ,GAA8B,uBAAuBR,CAAM,EAAE,EAGzE,IAAMa,EAAkB,OAAOD,GAAQ,SAAWE,GAAeF,CAAG,EAAIA,EAElEG,EAAiB,KAAK,UAAUd,EAAM,CAACe,EAAGL,IAC1CA,GAAKM,EAAIN,EAAG,WAAW,GAAK,OAAOA,EAAE,WAAc,WACjDA,EAAE,UAAU,SAAW,EAClBA,EAAE,UAAUP,CAAc,EAE1BO,EAAE,UAAU,EAGhBA,CACR,EAEKO,EAAgBC,GAAY,GAAGA,GAAYf,CAAc,CAAC,GAAGe,GAAYJ,CAAc,CAAC,EAAE,EAEhG,MAAO,CACL,GAAGb,EACH,YAAa,CACXa,EACAK,GAAMP,CAAe,EACrBQ,GAAKR,EAAiBK,CAAa,CACrC,CACF,CACF,EAIMI,GAAsB,SAAUjB,EAAekB,EAAgBtB,EAAWG,EAAwB,CACtG,GAAI,CAACC,EACH,MAAM,IAAIC,GAAwB,wBAAwB,EAG5D,GAAI,CAACkB,GAAgBvB,CAAI,EACvB,MAAM,IAAIK,GAAwB,wBAAwB,EAG5D,GAAI,CAAC,OAAO,cAAciB,CAAM,GAAKA,EAAS,EAC5C,MAAM,IAAIjB,GAAwB,UAAUiB,CAAM,6BAA6B,EAGjF,GAAM,CAACE,EAAmBzB,EAAQ0B,CAAS,EAAIzB,EAAK,YAC9CM,EAAgBF,EAAM,KAAK,iBAAiBL,CAAM,EAExD,GAAI,CAACO,GAAkBgB,EAAShB,EAAc,iBAAqBgB,EAAShB,EAAc,kBAAqB,CAACA,EAAc,QAAQ,SACpI,KACF,EAWE,MAAM,IAAIoB,GACR,OAAO3B,CAAM,sDACf,EAIF,IAAMa,EAAkBN,EAAc,KAEhCW,EAAgBC,GAAY,GAAGA,GAAYf,CAAc,CAAC,GAAGe,GAAYM,CAAiB,CAAC,EAAE,EAEnG,GAAI,CACFG,GAAgBf,EAAiBK,EAAeQ,CAAS,EAEzD,IAAMG,EAAU,KAAK,MAAMJ,CAAiB,EAE5C,MAAO,CAACzB,EAAQ6B,CAAO,CACzB,OAASC,EAAG,CACV,MAAM,IAAIxB,GAAwBwB,GAAG,SAAWA,CAAC,CACnD,CACF,EAEaC,GAAwB,CAAChC,EAAoCC,EAAgBC,EAASE,IAA2C,CAC5I,GAAI,CAACJ,GAAqBE,IAAS,QAAa,CAACD,EAAQ,MAAM,IAAI,UAAU,oBAAoB,EAE5FG,IACHA,EAAiBX,GAAY,EAAE,YAGjC,IAAMU,EAAc,OAAO,OAAO,IAAI,EAEhC8B,EAAqBlC,GAAS,KAAK,KAAMC,EAAmBC,EAAQC,EAAMC,EAAaC,CAAc,EACrG8B,EAAe7B,GAA4B4B,EAAmB5B,GAAkB,EAAE,EAExF,OAAOT,GAAQ,CACb,IAAI,cAAgB,CAClB,OAAOK,CACT,EACA,IAAI,WAAa,CACf,OAAOiC,CACT,EACA,IAAI,UAAY,CACd,OAAQ7B,GAA4B,KAAK,UAAU,KAAK,UAAUA,CAAc,CAAC,CACnF,EACA,IAAI,SAAW,CACb,MAAO,IAAMH,CACf,EACA,IAAI,UAAY,CACd,OAAQA,GAAY8B,GAAmBhC,EAAmBC,EAAQC,EAAME,CAAc,CACxF,EACA,IAAI,KAAO,CACT,OAAQ+B,GAAchC,EAAYgC,CAAC,CACrC,EACA,IAAI,KAAO,CACT,MAAO,CAACA,EAAWvB,IAAW,CAC5BT,EAAYgC,CAAC,EAAIvB,CACnB,CACF,CACF,CAAC,CACH,EAGawB,GAAkC,CAACvB,EAAUX,IAA2B,CACnF,IAAMD,EAASoB,GAAMR,CAAG,EAClBP,EAAQ,CACZ,IAAK,CACH,eAAgB,CACd,CAACL,CAAM,EAAG,CACR,QAAS,CAAC,KAAK,EACf,KAAMoC,GAAaxB,EAAK,EAAK,EAC7B,iBAAkB,EAClB,gBAAiB,MACnB,CACF,CACF,CACF,EAEMV,EAAc,OAAO,OAAO,IAAI,EAEhC8B,EAAqBlC,GAAS,KAAK,KAAMO,EAAOL,EAAQC,EAAMC,EAAa,CAAE,CAACF,CAAM,EAAGY,CAAI,CAAC,EAC5FqB,EAAe7B,GAA4B4B,EAAmB5B,GAAkB,EAAE,EAExF,OAAOT,GAAQ,CACb,IAAI,cAAgB,CAClB,OAAOK,CACT,EACA,IAAI,WAAa,CACf,OAAOiC,CACT,EACA,IAAI,UAAY,CACd,OAAQ7B,GAA4B,KAAK,UAAU,KAAK,UAAUA,CAAc,CAAC,CACnF,EACA,IAAI,SAAW,CACb,MAAO,IAAMH,CACf,EACA,IAAI,UAAY,CACd,OAAQA,GAAYkC,GAA6BvB,EAAKX,CAAI,CAC5D,EACA,IAAI,KAAO,CACT,OAAQiC,GAAchC,EAAYgC,CAAC,CACrC,EACA,IAAI,KAAO,CACT,MAAO,CAACA,EAAWvB,IAAW,CAC5BT,EAAYgC,CAAC,EAAIvB,CACnB,CACF,CACF,CAAC,CACH,EAEa0B,GAAqB,CAACC,EAAoBjC,EAAgBJ,EAAWsB,EAAgBnB,EAAwBmC,IAAyC,CACjK,IAAMC,EAAgB,IAAMvC,EACxBwC,EACEC,EAAsB,KACtBD,IAGJA,EAAoBnB,GAAoBjB,GAASb,GAAY,EAAE8C,CAAU,EAAGf,EAAQtB,EAAMG,CAAc,EACpGmC,IAAUE,EAAkB,CAAC,EAAIF,EAASE,EAAkB,CAAC,CAAC,IAC3DA,EAAkB,CAAC,GAG5B,OAAO9C,GAAQ,CACb,IAAI,cAAgB,CAClB,OAAI8C,EAA0BA,EAAkB,CAAC,EAC1CE,GAAgB1C,CAAI,CAC7B,EACA,IAAI,WAAa,CACf,OAAOuC,CACT,EACA,IAAI,SAAW,CACb,MAAO,CAACF,EAAYrC,EAAMsB,EAAQnB,CAAc,CAClD,EACA,IAAI,UAAY,CACd,MAAO,IAAM,KAAK,UAAU,KAAK,UAAU,CAAC,CAC9C,EACA,IAAI,SAAW,CACb,OAAOsC,CACT,EACA,IAAI,QAAU,CACZ,OAAO,KAAK,SACd,EACA,IAAI,KAAO,CACT,OAAQR,GAAcA,IAAM,cAAgBjC,EAAKiC,CAAC,EAAI,MACxD,CACF,CAAC,CACH,EAEaS,GAAmB1C,GAAsB,CACpD,GAAI,CAACuB,GAAgBvB,CAAI,EACvB,MAAM,IAAIK,GAAwB,wBAAwB,EAG5D,OAAOL,EAAK,YAAY,CAAC,CAC3B,EAEauB,GAAmBvB,GAC1B,GAACA,GAAQ,OAAOA,GAAS,UAAY,CAACgB,EAAIhB,EAAM,aAAa,GAAK,CAAC,MAAM,QAAQA,EAAK,WAAW,GAAKA,EAAK,YAAY,SAAW,GAAKA,EAAK,YAAY,IAAIU,GAAK,OAAOA,CAAC,EAAE,OAAOA,GAAKA,IAAM,QAAQ,EAAE,SAAW,GAQ3MiC,GAAyB3C,GAA+B,CACnE,GAAI,CAACuB,GAAgBvB,CAAI,EACvB,MAAM,IAAIK,GAAwB,wBAAwB,EAG5D,IAAMkC,EAAgB,IAAMvC,EACxBwC,EACEC,EAAsB,KACtBD,IAGJA,EAAoB,CAACxC,EAAK,YAAY,CAAC,EAAG,KAAK,MAAMA,EAAK,YAAY,CAAC,CAAC,CAAC,GAClEwC,EAAkB,CAAC,GAG5B,OAAO9C,GAAQ,CACb,IAAI,cAAgB,CAClB,OAAI8C,EAA0BA,EAAkB,CAAC,EAC1CE,GAAgB1C,CAAI,CAC7B,EACA,IAAI,WAAa,CACf,OAAOuC,CACT,EACA,IAAI,UAAY,CACd,MAAO,IAAM,KAAK,UAAU,KAAK,UAAU,CAAC,CAC9C,EACA,IAAI,SAAW,CACb,OAAOE,CACT,EACA,IAAI,QAAU,CACZ,OAAO,KAAK,SACd,EACA,IAAI,KAAO,CACT,OAAQR,GAAcA,IAAM,cAAgBjC,EAAKiC,CAAC,EAAI,MACxD,CACF,CAAC,CACH,EC9UA,IAAMW,GAAc,IAAMC,EAAI,oBAAoB,EAqB5CC,GAAgB,OAAO,OAAO,KAAM,CACxC,iBAAkB,CAChB,MAAO,EACT,CACF,CAAC,EAEKC,GAAcC,GACX,OAAO,eAAeA,EAAGF,EAAK,EAM1BG,GAAmBD,GACvB,CAAC,CAACA,GAAK,CAAC,CAAC,OAAO,eAAeA,CAAC,GAAG,iBAKtCE,GAAc,SAAUC,EAAoCC,EAAgBC,EAAWC,EAAwB,CACnH,IAAMC,EAAQ,OAAOJ,GAAsB,SAAWP,GAAY,EAAEO,CAAiB,EAAIA,EAInFK,EAAgBD,GAAO,KAAK,iBAAiBH,CAAM,EACzD,GAAI,CAACI,GAAe,QAAQ,SAC1B,KACF,EACE,MAAM,IAAI,MAAM,qBAAqBJ,CAAM,8CAA8C,EAE3F,GAAII,EAAc,iBAAmB,KAAM,CACzC,IAAMC,EAAQF,EAAM,IAAU,eAAeH,CAAM,EAAE,KAC/CM,EAAY,OAAO,OAAOH,EAAM,KAAK,cAAc,EAAE,KAAMI,GAAWA,EAAE,iBAAmB,MAAQA,EAAE,OAASF,GAAQE,EAAE,QAAQ,SAAS,KAAK,CAAC,GAAS,GAE9J,GAAI,CAACD,EACH,MAAM,IAAI,MAAM,qBAAqBN,CAAM,6DAA6DK,CAAI,GAAG,EAGjHL,EAASM,CACX,CAEA,IAAME,EAAML,EAAM,KAAK,iBAAiBH,CAAM,EAAE,KAEhD,GAAI,CAACQ,EACH,MAAM,IAAI,MAAM,0BAA0BR,CAAM,EAAE,EAGpD,IAAMS,EAAkB,OAAOD,GAAQ,SAAWE,GAAeF,CAAG,EAAIA,EAExE,MAAO,CACLG,GAAMF,CAAe,EACrBG,GAAQH,EAAiB,KAAK,UAAUR,EAAM,CAACY,EAAGN,IAC5CA,GAAKO,EAAIP,EAAG,WAAW,GAAK,OAAOA,EAAE,WAAc,WACjDA,EAAE,UAAU,SAAW,EAClBA,EAAE,UAAUL,CAAc,EAE1BK,EAAE,UAAU,EAGhBA,CACR,EAAGL,CAAc,CACpB,CACF,EAIMa,GAAc,SAAUZ,EAAea,EAAgBf,EAAWgB,EAAwBf,EAAwBgB,EAA4C,CAClK,GAAI,CAACf,EACH,MAAM,IAAIgB,GAAyB,wBAAwB,EAM7D,GAFI,OAAOlB,EAAK,SAAY,aAAYA,EAAOA,EAAK,QAAQ,GAExD,CAACmB,GAAmBnB,CAAI,EAC1B,MAAM,IAAIkB,GAAyB,wBAAwB,EAG7D,GAAM,CAACnB,EAAQqB,CAAO,EAAIpB,EACpBO,EAAMS,EAAejB,CAAM,EAEjC,GAAI,CAACQ,EAEH,MAAM,IAAIc,GAA+B,OAAOtB,CAAM,aAAc,CAAE,MAAOA,CAAO,CAAC,EA2BvF,IAAMI,EAAgBD,EAAM,KAAK,iBAAiBH,CAAM,EACxD,GAAI,CAACI,GAAkBY,EAASZ,EAAc,iBAAqBY,EAASZ,EAAc,kBAAqB,CAACA,EAAc,QAAQ,SACpI,KACF,EACE,MAAM,IAAImB,GACR,OAAOvB,CAAM,sDACf,EAGF,IAAMS,EAAkB,OAAOD,GAAQ,SAAWE,GAAeF,CAAG,EAAIA,EAExE,GAAI,CACF,IAAMgB,EAAS,KAAK,MAAMC,GAAQhB,EAAiBY,EAASnB,CAAc,CAAC,EAC3E,OAAI,OAAOgB,GAAgB,YAAYA,EAAYM,EAAQxB,CAAM,EAC1DwB,CACT,OAASE,EAAG,CACV,MAAM,IAAIP,GAAyBO,GAAG,SAAWA,CAAC,CACpD,CACF,EAEaC,GAA2B,CAAC5B,EAAoCC,EAAgBC,IAA8B,CACzH,GAAI,CAACF,GAAqBE,IAAS,QAAa,CAACD,EAAQ,MAAM,IAAI,UAAU,oBAAoB,EAEjG,IAAM4B,EAAqB9B,GAAY,KAAK,KAAMC,EAAmBC,EAAQC,CAAI,EAEjF,OAAON,GAAQ,CACb,IAAI,iBAAmB,CACrB,OAAOK,CACT,EACA,IAAI,WAAa,CACf,OAAQE,GAA4B0B,EAAmB1B,GAAkB,EAAE,CAC7E,EACA,IAAI,UAAY,CACd,OAAQA,GAA4B,KAAK,UAAU,KAAK,UAAUA,CAAc,CAAC,CACnF,EACA,IAAI,SAAW,CACb,MAAO,IAAMD,CACf,CACF,CAAC,CACH,EAGa4B,GAAqC,CAACrB,EAAUP,IAA8B,CACzF,GAAIA,IAAS,QAAa,CAACO,EAAK,MAAM,IAAI,UAAU,oBAAoB,EAExE,IAAMR,EAASW,GAAMH,CAAG,EAClBL,EAAQ,CACZ,IAAK,CACH,eAAgB,CACd,CAACH,CAAM,EAAG,CACR,QAAS,CAAC,KAAK,EACf,KAAM8B,GAAatB,EAAK,EAAK,EAC7B,iBAAkB,EAClB,gBAAiB,MACnB,CACF,CACF,CACF,EACMoB,EAAqB9B,GAAY,KAAK,KAAMK,EAAOH,EAAQC,CAAI,EAErE,OAAON,GAAQ,CACb,IAAI,iBAAmB,CACrB,OAAOK,CACT,EACA,IAAI,WAAa,CACf,OAAQE,GAA4B0B,EAAmB1B,GAAkB,EAAE,CAC7E,EACA,IAAI,UAAY,CACd,OAAQA,GAA4B,KAAK,UAAU,KAAK,UAAUA,CAAc,CAAC,CACnF,EACA,IAAI,SAAW,CACb,MAAO,IAAMD,CACf,CACF,CAAC,CACH,EAEa8B,GAA2B,CAACC,EAAoB7B,EAAeF,EAAWe,EAAgBC,EAAyBf,EAAyBgB,IAAiE,CACxN,IAAIe,EACEC,EAAmB,IAAW,CAClC,GAAID,EACF,OAAOA,EAET,GAAI,CAAC9B,GAAS,CAACc,EAAgB,CAC7B,IAAMkB,EAAY3C,GAAY,EAC9BW,EAAQA,GAASgC,EAAUH,CAAU,EACrCf,EAAiBA,GAAkBkB,EAAU,UAC/C,CACA,OAAAF,EAAiBlB,GAAYZ,EAAOa,EAAQf,EAAMgB,EAAgBf,GAAkB,GAAIgB,CAAW,EAE/FkB,GAAgBH,CAAc,IAChCA,EAAiBI,GAAmBL,EAAY7B,EAAO8B,EAAgBjB,EAAQd,GAAkB,EAAE,GAG9F+B,CACT,EAEA,OAAOtC,GAAQ,CACb,IAAI,iBAAmB,CACrB,OAAO2C,GAAmBrC,CAAI,CAChC,EACA,IAAI,WAAa,CACf,MAAO,IAAMA,CACf,EACA,IAAI,UAAY,CACd,MAAO,IAAM,KAAK,UAAU,KAAK,UAAU,CAAC,CAC9C,EACA,IAAI,SAAW,CACb,OAAOiC,CACT,EACA,IAAI,QAAU,CACZ,OAAO,KAAK,SACd,CACF,CAAC,CACH,EAEaK,GAAkC,CAACP,EAAoBQ,EAASvC,EAAWwC,EAASxB,EAAyBf,EAAyBgB,IAAqD,CACtM,IAAIe,EACEC,EAAmB,IAAW,CAClC,GAAID,EACF,OAAOA,EAET,IAAME,EAAY3C,GAAY,EACxBW,EAAQgC,EAAUH,CAAU,EAGlC,OAFAC,EAAiBlB,GAAYZ,EAAO,IAAKF,EAAMgB,GAAkBkB,EAAU,WAAYjC,GAAkB,GAAIgB,CAAW,EAEpHkB,GAAgBH,CAAc,EAEzBI,GAAmBL,EAAY7B,EAAO8B,EAAgB,IAAK/B,GAAkB,EAAE,EAGjF+B,CACT,EAEA,OAAOtC,GAAQ,CACb,IAAI,iBAAmB,CACrB,OAAO2C,GAAmBrC,CAAI,CAChC,EACA,IAAI,WAAa,CACf,MAAO,IAAMA,CACf,EACA,IAAI,UAAY,CACd,MAAO,IAAM,KAAK,UAAU,KAAK,UAAU,CAAC,CAC9C,EACA,IAAI,SAAW,CACb,OAAOiC,CACT,EACA,IAAI,QAAU,CACZ,OAAO,KAAK,SACd,CACF,CAAC,CACH,EAEaQ,GAAqC,CAAClC,EAAUP,EAAWC,IAA8C,CACpH,GAAID,IAAS,QAAa,CAACO,EAAK,MAAM,IAAI,UAAU,oBAAoB,EAExE,IAAIyB,EACEjC,EAASW,GAAMH,CAAG,EAClB0B,EAAmB,IAAW,CAClC,GAAID,EACF,OAAOA,EAET,IAAM9B,EAAQ,CACZ,IAAK,CACH,eAAgB,CACd,CAACH,CAAM,EAAG,CACR,QAAS,CAAC,KAAK,EACf,KAAM8B,GAAatB,EAAK,EAAK,EAC7B,iBAAkB,EAClB,gBAAiB,MACnB,CACF,CACF,CACF,EACA,OAAAyB,EAAiBlB,GAAYZ,EAAO,IAAKF,EAAM,CAAE,CAACD,CAAM,EAAGQ,CAAI,EAAGN,GAAkB,EAAE,EAE/E+B,CACT,EAEA,OAAOtC,GAAQ,CACb,IAAI,iBAAmB,CACrB,OAAO2C,GAAmBrC,CAAI,CAChC,EACA,IAAI,WAAa,CACf,MAAO,IAAMA,CACf,EACA,IAAI,UAAY,CACd,MAAO,IAAM,KAAK,UAAU,KAAK,UAAU,CAAC,CAC9C,EACA,IAAI,SAAW,CACb,OAAOiC,CACT,EACA,IAAI,QAAU,CACZ,OAAO,KAAK,SACd,CACF,CAAC,CACH,EAEaI,GAAsBrC,GAAsB,CACvD,GAAI,CAACmB,GAAmBnB,CAAI,EAC1B,MAAM,IAAIkB,GAAyB,wBAAwB,EAG7D,OAAOlB,EAAK,CAAC,CACf,EAEamB,GAAsBnB,GAC7B,GAAC,MAAM,QAAQA,CAAI,GAAKA,EAAK,SAAW,GAAKA,EAAK,IAAIM,GAAK,OAAOA,CAAC,EAAE,OAAOA,GAAKA,IAAM,QAAQ,EAAE,SAAW,GAOrGoC,GAA4B1C,GAAoE,CAC3G,GAAIA,GAAQ,KACZ,GAAIJ,GAAgBI,CAAI,EACtB,GAAI,CACF,MAAO,CACL,gBAAiBA,EAAK,gBACtB,KAAMA,EAAK,QAAQ,CACrB,CACF,OAASyB,EAAG,CACV,QAAQ,KAAK,8CAA+CA,CAAC,CAC/D,KAEA,OAAO,CACL,gBAAiB,KACjB,KAAAzB,CACF,CAEJ,EAEa2C,GAAgC,CAACZ,EAAoB7B,EAAeF,EAAWe,EAAgBC,EAAyBf,EAAyBgB,IACxJE,GAAmBnB,CAAI,EAClB8B,GAAsBC,EAAY7B,EAAOF,EAAMe,EAAQC,EAAgBf,EAAgBgB,CAAW,GAEzGA,IAAcjB,EAAM,EAAE,EACfA,GCzSX,IAAM4C,GAA0C,CAACC,EAAcC,EAAkBC,EAAoBC,EAA0BC,EAAyBC,IAA6B,CACnL,IAAMC,EAAKN,EAAK,GACVO,EAASP,EAAK,OAEdQ,EAAqBF,IAAOG,EAAU,oBAExCC,GAA6CR,EAAYG,EAAQF,EAAqBI,EAAQH,EAAgBH,EAAU,MAAS,EACjIE,EAIJ,MAAI,CAACM,EAAU,WAAYA,EAAU,aAAa,EAAE,SAASH,CAAE,EACpDE,EAAsB,IAAKG,GAC3BC,GAA2BV,EAAYG,EAAOM,EAAKJ,EAAQH,EAAgBH,EAAWU,GAAQ,CAWnG,GAVIA,EAAI,MAAM,SAAS,UACrBA,EAAI,KAAK,QAAQ,QAAUD,GAAsBR,EAAYG,EAAOM,EAAI,KAAK,QAAQ,QAASJ,EAAQH,EAAgBH,EAAWY,GAAU,CAEzI,IAAMC,EAAgBC,GAAMF,CAAK,EACjC,GAAIC,IAAkBH,EAAI,GACxB,MAAM,IAAI,MAAM,+CAA+CA,EAAI,EAAE,YAAYG,CAAa,EAAE,CAEpG,CAAC,GAGCH,EAAI,MAAM,YAAY,UACxB,GAAI,CACFA,EAAI,KAAK,WAAW,UAAYC,GAA2BV,EAAYG,EAAOM,EAAI,KAAK,WAAW,UAAWJ,EAAQH,EAAgBH,CAAQ,GAAG,QAAQ,CAC1J,MAAQ,CAGN,OAAOU,EAAI,KAAK,WAAW,SAC7B,CAGF,GAAIA,EAAI,MAAM,YAAY,WACxB,GAAI,CACFA,EAAI,KAAK,WAAW,WAAaC,GAA2BV,EAAYG,EAAOM,EAAI,KAAK,WAAW,WAAYJ,EAAQH,EAAgBH,CAAQ,GAAG,QAAQ,CAC5J,MAAQ,CAGN,OAAOU,EAAI,KAAK,WAAW,UAC7B,CAEJ,CAAC,CACF,GAKCL,IAAOG,EAAU,cAClBD,EAAc,KAAQA,EAAc,MAAM,IAAKG,GACvCC,GAA2BV,EAAYG,EAAOM,EAAKJ,EAAQH,EAAgBH,EAAWU,GAAQ,CACnG,GAAI,CAACA,EAAI,MAAM,SAAS,QAAS,OAMjC,IAAMK,EAAeN,GACfO,EAAqBf,EAC3BS,EAAI,KAAK,QAAQ,QAAUK,EAAaC,EAAoBZ,EAAOM,EAAI,KAAK,QAAQ,QAASJ,EAAQH,EAAgBH,EAAWY,GAAU,CACxI,IAAMC,EAAgBC,GAAMF,CAAK,EACjC,GAAIC,IAAkBH,EAAI,GACxB,MAAM,IAAI,MAAM,+CAA+CA,EAAI,EAAE,YAAYG,CAAa,EAAE,CAEpG,CAAC,CACH,CAAC,CACF,GAKCR,IAAOG,EAAU,aACZG,GAA2BV,EAAYG,EAAQG,EAAeD,EAAQH,EAAgBH,EAAWO,GAAY,CACjHA,EAAc,MAAM,QAASG,GAAQ,CACpC,GAAI,CAACA,EAAI,MAAM,SAAS,QAAS,OACjC,IAAMK,EAAeR,EAAQ,kBAAoBU,GAA+BR,GAC1EO,EAAqBT,EAAQ,mBAAqBN,EACxDS,EAAI,KAAK,QAAQ,QAAUK,EAAaC,EAAoBZ,EAAOM,EAAI,KAAK,QAAQ,QAASJ,EAAQH,EAAgBH,EAAWY,GAAU,CACxI,IAAMC,EAAgBC,GAAMF,CAAK,EACjC,GAAIC,IAAkBH,EAAI,GACxB,MAAM,IAAI,MAAM,+CAA+CA,EAAI,EAAE,YAAYG,CAAa,EAAE,CAEpG,CAAC,CACH,CAAC,CACH,CAAC,EAKCR,IAAOG,EAAU,eACZG,GAA2BV,EAAYG,EAAQG,EAAeD,EAAQH,EAAgBH,EAAWkB,GAAQ,CAC9GA,EAAI,UAAYC,GAAmBD,EAAI,WAAY,OAAWA,EAAI,UAAWA,EAAI,OAAQlB,CAAQ,CACnG,CAAC,EAMCK,IAAOG,EAAU,uBAAyBY,GAAgBb,CAAO,EAC5DY,GAAmBlB,EAAYG,EAAOG,EAASD,EAAQN,CAAQ,EAIpEK,IAAOG,EAAU,oBACZD,EAGLF,IAAOG,EAAU,WACVD,EAAsB,IAAKG,GAC3BC,GAA2BV,EAAYG,EAAQM,EAAWJ,EAAQH,EAAgBH,EAAU,MAAS,CAC7G,EAGCK,IAAOG,EAAU,oBACZG,GAA2BV,EAAYG,EAAQF,EAAqBI,EAAQH,EAAgBH,EAAU,MAAS,EAIpHK,IAAOG,EAAU,UACRD,EACR,IAAI,CAAC,CAACc,EAAKC,CAAG,IACb,CACED,EACAvB,GAAwC,CAAE,GAAGC,EAAM,GAAIsB,CAAI,EAAGrB,EAAUC,EAAaqB,EAAWnB,EAAgBC,CAAK,CACvH,CACF,EAGGG,EACT,EAEaC,EAAN,MAAMe,CAAU,CAErB,SACA,MACA,SACA,mBACA,WACA,gBACA,mBAEA,OAAO,YAAmB,IAC1B,OAAO,oBAA4B,KACnC,OAAO,sBAA8B,KACrC,OAAO,WAAmB,KAC1B,OAAO,WAAmB,KAC1B,OAAO,cAAsB,KAC7B,OAAO,oBAA4B,KACnC,OAAO,YAAoB,KAC3B,OAAO,YAAoB,KAC3B,OAAO,iBAAyB,KAChC,OAAO,mBAA2B,KAClC,OAAO,UAAiB,IACxB,OAAO,aAAqB,KAC5B,OAAO,eAAuB,KAC9B,OAAO,oBAA6B,MAGpC,OAAO,WACL,CACE,WAAAtB,EACA,aAAAuB,EAAe,KACf,cAAAC,EAAgB,KAKhB,OAAAnB,EAAS,OAAO,iBAChB,GAAAD,EACA,SAAAqB,CACF,EAQM,CACN,IAAM3B,EAAO,CACX,QAAS,QACT,aAAAyB,EACA,cAAAC,EACA,OAAAnB,EACA,WAAAL,EACA,GAAII,EAAG,CAAC,EACR,SAAAqB,CACF,EACA,OAAO,IAAI,KAAKC,GAAgB5B,EAAMM,EAAG,CAAC,CAAC,CAAC,CAC9C,CAIA,OAAO,UACLuB,EACAC,EACAC,EACM,CACN,IAAM/B,EAAO,OAAO,OAAO,CAAC,EAAG6B,EAAYE,CAAO,EAClD,OAAO,IAAI,KAAKH,GAAgB5B,EAAM8B,EAAS,CAAC,CAAC,CAAC,CACpD,CAEA,OAAO,YAAajB,EAAeT,EAAyBC,EAAgB2B,EAAwCC,GAAgC,CAClJ,GAAI,CAACpB,EAAO,MAAM,IAAI,MAAM,0BAA0BA,CAAK,EAAE,EAC7D,GAAM,CAAE,KAAMZ,EAAU,GAAGiC,CAAY,EAAI,KAAK,MAAMrB,CAAK,EACrDb,EAAO,KAAK,MAAMC,CAAQ,EAC1BC,EAAaF,EAAK,KAAOwB,EAAU,YAAcW,GAAUtB,EAAOuB,GAAW,qBAAqB,EAAIpC,EAAK,WAIjH,GAAI,CAACK,GAAO,KAAK,gBAAkBL,EAAK,KAAOwB,EAAU,YAAa,CACpE,IAAMX,EAAQwB,GAAsBH,CAAW,EACzCI,EAAiB,OAAO,YAAYzB,EAAM,QAAQ,GAAG,KAAK,IAAI0B,GAAM,CACxE,IAAMC,EAAIR,EAA2BO,CAAE,EACvC,OAAKC,EACE,CAACA,EAAE,KAAK,GAAIA,EAAE,IAAI,EADV,IAEjB,CAAC,EAAE,OAAO,OAAO,CAAC,EAClBnC,EAAQ,CACN,IAAK,CACH,KAAML,EAAK,KACX,eAAAsC,CACF,CACF,CACF,CAEA,IAAMG,EAAoBrB,GACxBlB,EAAYG,EAAO6B,EAAalC,EAAK,OAAQC,EAC5CO,GAAYT,GAAwCC,EAAMC,EAAUC,EAAYM,EAASJ,EAAgBC,CAAK,CACjH,EAEA,OAAO,IAAI,KAAK,CACd,UAAW,WACX,QAAS,CAAE,IAAK8B,GAAUtB,EAAOuB,GAAW,qBAAqB,EAAG,MAAAvB,CAAM,EAC1E,KAAAb,EACA,kBAAAyC,CACF,CAAC,CACH,CAEA,OAAO,gBAAiB5B,EAAuH,CAC7I,GAAI,CAACA,EAAO,MAAM,IAAI,MAAM,0BAA0BA,CAAK,EAAE,EAC7D,IAAIb,EAAM0C,EACJC,EAAS,CACb,IAAI,MAAQ,CACV,OAAI3C,IAAS,SACXA,EAAO,KAAK,MAAM,KAAK,MAAMa,CAAK,EAAE,IAAI,GAEnCb,CACT,EACA,IAAI,MAAQ,CACV,OAAK0C,IACHA,EAAOP,GAAUtB,EAAOuB,GAAW,qBAAqB,GAEnDM,CACT,EACA,IAAI,YAAc,CAChB,OAAOC,EAAO,MAAM,YAAcA,EAAO,IAC3C,EAGA,aAAuB,CAErB,MAAO,OADM,KAAK,KAAK,EACL,IAAI,KAAK,IAAI,OAAO,KAAK,UAAU,GACvD,EACA,IAAI,gBAA2B,CAC7B,MAAO,CAACA,EAAO,MAAM,UACvB,CACF,EACA,OAAOA,CACT,CAEA,YAAaC,EAAqB,CAChC,KAAK,WAAaA,EAAO,UACzB,KAAK,SAAWA,EAAO,QACvB,KAAK,MAAQA,EAAO,KACpB,KAAK,mBAAuBA,EAAO,kBAGnC,IAAMC,EAAO,KAAK,OAAO,EACrBC,EAAiB,GACfC,EAAW,CAACF,EAAMrC,IAAY,CAClC,OAAQqC,EAAM,CACZ,KAAKrB,EAAU,YACb,GAAI,CAAC,KAAK,eAAe,GAAK,CAACsB,EAAgB,MAAM,IAAI,MAAM,oCAAoC,EACnG,MACF,KAAKtB,EAAU,UACb,GAAI,CAACsB,EACH,MAAM,IAAI,MAAM,2CAA2C,EAE7D,GAAI,CAAC,MAAM,QAAQtC,CAAO,EACxB,MAAM,IAAI,UAAU,oCAAoC,EAE1DsC,EAAiB,GAChBtC,EAAgB,QAAQ,CAAC,CAACwC,EAAGC,CAAC,IAAMF,EAASC,EAAGC,CAAC,CAAC,EACnD,MACF,KAAKzB,EAAU,WACf,KAAKA,EAAU,WACf,KAAKA,EAAU,cACb,GAAI,CAAC,MAAM,QAAQhB,CAAO,EAAG,MAAM,IAAI,UAAU,kDAAkD,EACnG,MACF,KAAKgB,EAAU,aACf,KAAKA,EAAU,eACf,KAAKA,EAAU,oBACf,KAAKA,EAAU,oBACf,KAAKA,EAAU,sBAEb,MACF,QACE,MAAM,IAAI,MAAM,mBAAmBqB,CAAI,EAAE,CAC7C,CACF,EAIA,OAAO,eAAe,KAAM,WAAY,CACtC,KAAOK,GAAwB,IAAM,CACnC,IAAM1C,EAAU,KAAK,mBAAmB,QAAQ,EAEhD,OAAK0C,IACHH,EAASF,EAAMrC,CAAO,EACtB0C,EAAY,IAEP1C,CACT,GAAG,CACL,CAAC,CACH,CAEA,gBAAuB,CACrB,GAAI,KAAK,gBAAiB,OAAO,KAAK,gBACtC,GAAI,CACF,IAAMK,EAAQ,KAAK,QAAQ,EAKrBsC,EAAOlB,GAAyBpB,CAAK,EAG3C,OAAIsC,GAAM,OAGJC,GAAaD,EAAK,IAAI,GACxB,KAAK,mBAAqBA,EAAK,KAAK,aACpC,KAAK,gBAAkBA,EAAK,KAAK,QAAQ,GAEzC,KAAK,gBAAkBA,EAAK,MAGzB,KAAK,eACd,MAAQ,CAIN,MACF,CACF,CAEA,mBAA0B,CACxB,OAAK,KAAK,iBACR,KAAK,eAAe,EAEf,KAAK,kBACd,CAEA,MAAgB,CAAE,OAAO,KAAK,KAAM,CAEpC,SAAsB,CAAE,OAAO,KAAK,QAAS,CAE7C,IAAY,CAAE,MAAO,CAAC,KAAK,KAAK,EAAE,GAAI,KAAK,QAAQ,CAAC,CAAE,CAEtD,OAAkB,CAAE,MAAO,CAAC,KAAK,KAAK,EAAE,GAAI,KAAK,kBAAkB,CAAE,CAErE,QAAoB,CAAE,OAAO,KAAK,KAAK,EAAE,EAAG,CAE5C,SAAsB,CAAE,OAAO,KAAK,QAAQ,CAAE,CAE9C,cAAwB,CAAE,OAAO,KAAK,mBAAmB,YAAa,CAEtE,UAAoB,CAAE,OAAO,KAAK,KAAK,EAAE,QAAS,CAElD,aAAuB,CACrB,IAAMN,EAAO,KAAK,OAAO,EACrBQ,EAAO,OAAOR,CAAI,GACtB,GAAIA,IAASrB,EAAU,sBACrB,GAAI,CACF,IAAMX,EAAQ,KAAK,QAAQ,EAAE,QAAQ,EAEjC,OAAOA,EAAM,QAAW,WAC1BwC,GAAQ,IAAIxC,EAAM,MAAM,GAE5B,OAASyC,EAAG,CACV,QAAQ,KAAK,0BAA2B,KAAK,KAAK,EAAGA,CAAC,CACxD,CAEF,MAAO,GAAGD,CAAI,IAAI,KAAK,KAAK,CAAC,OAAO,KAAK,WAAW,CAAC,GACvD,CAEA,gBAA2B,CAAE,MAAO,CAAC,KAAK,KAAK,EAAE,UAAW,CAE5D,YAAsB,CAAE,OAAO,KAAK,KAAK,EAAE,YAAc,KAAK,KAAK,CAAE,CAErE,WAAqB,CAAE,OAAO,KAAK,SAAS,KAAM,CAElD,MAAgB,CAAE,OAAO,KAAK,SAAS,GAAI,CAE3C,eAA0B,CAAE,OAAO,KAAK,MAAM,aAAc,CAE5D,QAAkB,CAAE,OAAO,KAAK,MAAM,MAAO,CAE7C,IAAc,CAEZ,MAAM,IAAI,MAAM,mDAAmD,CACrE,CAEA,WAAsC,CACpC,OAAO,KAAK,UACd,CAIA,SAAoB,CAClB,IAAIxC,EACJ,MAAO,CAAC,EACN0C,GAAO,SAAS,KAAK,OAAO,CAAC,GAE5B,KAAK,OAAO,IAAM/B,EAAU,WAAa,MAAM,QAAQX,EAAQ,KAAK,QAAQ,CAAC,GAAMA,EAAc,KAAK,CAAC,CAACS,CAAG,IAClGiC,GAAoB,SAASjC,CAAG,CACzC,EAEL,CAGA,WAAYkC,EAAe,GAAK,CAC9B,MAAO,WACT,CAGA,OAAQC,EAAqB,EAAGR,EAAc,CAC5C,MAAO,CAACA,EAAE,UAAU,EAAGA,EAAE,UAAU,EAAGA,EAAE,eAAe,EAAGA,EAAE,kBAAkB,CAAC,CACjF,CAGA,OAAQS,EAAuB,EAAG,CAACC,EAAYC,EAAWC,EAAgBC,CAAiB,EAAG,CAC5F,IAAMb,EAAIzB,EAAU,YAAYmC,CAAU,EAC1C,OAAAV,EAAE,WAAaW,EACfX,EAAE,gBAAkBY,EACpBZ,EAAE,mBAAqBa,EAChBb,CACT,CACF,EAEA,SAASrB,GAAiB5B,EAAcQ,EAA6C,CAUnF,IAAIuD,EACJ,MAAO,CACL,UAAWC,EAAIxD,EAAS,UAAU,EAAI,WAAa,WAGnD,IAAI,SAAW,CACb,GAAI,CAACuD,EAAS,CACZ,IAAM9D,EAAW,KAAK,UAAUD,CAAI,EAC9BiE,EAAc,CAAE,GAAGzD,EAAQ,UAAUP,CAAQ,EAAG,KAAMA,CAAS,EAC/DY,EAAQ,KAAK,UAAUoD,CAAW,EAExCF,EAAU,CACR,IAAK5B,GAAUtB,EAAOuB,GAAW,qBAAqB,EACtD,MAAAvB,CACF,CACF,CACA,OAAOkD,CACT,EACA,KAAA/D,EACA,kBAAmBQ,CACrB,CACF,CAGA,IAAM+C,GAAS,CAAC9C,EAAU,YAAaA,EAAU,WAAYA,EAAU,WAAYA,EAAU,aAAa,ECxiB1G,IAAMyD,GAAK,IAAI,QACFC,GAAN,KAAgB,CAErB,OAAQC,EAAuB,EAAGC,EAAQ,CACxC,OAAO,IAAI,KAAKA,CAAM,CACxB,CAGA,OAAQC,EAAqB,EAAGD,EAAgB,CAC9C,OAAOH,GAAG,IAAIG,CAAM,CACtB,CAGA,WAAYE,EAAe,GAAK,CAC9B,MAAO,mBACT,CAEA,YAAaC,EAAU,CAErBN,GAAG,IAAI,KAAMM,CAAK,CACpB,CAEA,SAAc,CAGZ,OAAON,GAAG,IAAI,IAAI,CACpB,CACF,ECtCO,IAAMO,GAAgB,CAC3B,QAAS,UACT,MAAO,QACP,KAAM,MACR,ECFO,IAAMC,GAAiB,iBACjBC,GAAsB,sBACtBC,GAAqB,qBAE3B,IAAMC,GAAgB,gBAChBC,GAAkB,kBAClBC,GAAyB,yBAE/B,IAAMC,GAAsB,sBAE5B,IAAMC,GAAmC,mCACnCC,GAA6B,6BCC1C,IAAMC,GAAmB,OAAO,SAAyC,GAAI,EAAE,GAAK,IAEvEC,GAAkB,CAACC,EAAeC,IAA0BD,EAAM,KAAK,gBAAoB,OAAO,OAAQA,EAAM,IAAI,cAAoB,EAAkB,KAAME,GAAMA,EAAE,OAASD,GAAQC,EAAE,iBAAmB,IAAI,GAAG,GAErNC,GAA8B,CAACH,EAAeI,IAAkCJ,EAAM,KAAK,gBAAoB,OAAO,OAAQA,EAAM,IAAI,cAAoB,EAAkB,OAAQE,GAAMA,EAAE,iBAAmB,MAAQA,EAAE,YAAY,SAASE,CAAU,CAAC,EAAE,IAAIF,GAAKA,EAAE,EAAE,EAE1QG,GAA0B,CAACL,EAAeC,IAA2BD,EAAM,KAAK,gBAAoB,OAAO,OAAQA,EAAM,IAAI,gBAAwB,CAAC,CAAC,EAAkB,OAAQE,GAAMA,EAAE,OAASD,GAAQC,EAAE,iBAAmB,IAAI,EAAE,IAAIA,GAAKA,EAAE,EAAE,EAElPI,GAA0B,CAACN,EAAeO,EAA6BC,EAA0BC,EAAoBC,IACzHV,EAAM,KAAK,gBACd,OAAO,OAAQA,EAAM,IAAI,cAAoB,EAC5C,OAAQE,GACAA,EAAE,iBAAmB,MAC3BA,EAAE,YAAcO,GAAa,OAAO,oBACrCE,EAAI,yBAA0BT,EAAE,EAAE,IACjC,MAAM,QAAQK,CAAW,EACtBA,EAAY,OAAO,CAACK,EAAKC,IACzBD,IAAQV,EAAE,cAAgB,KAAOA,EAAE,YAAY,SAASW,CAAU,GAAI,EACxE,EACEN,IAAgBL,EAAE,cAExBM,EAAS,OAAO,CAACI,EAAKE,IAAYF,GAAOV,EAAE,QAAQ,SAASY,CAAO,EAAG,EAAI,IACzE,MAAM,QAAQJ,CAAc,EACzBA,EAAe,OAAO,CAACE,EAAKG,IAC5BH,IAAQV,EAAE,iBAAmB,KAAO,CAAC,CAACA,EAAE,gBAAgB,SAASa,CAAM,GAAI,EAC7E,EACEL,EAAiBA,IAAmBR,EAAE,eAAiB,GAE1D,EACA,KAAK,CAACc,EAAGC,IAAMA,EAAE,UAAYD,EAAE,SAAS,EAAE,CAAC,GAAG,GAGxCE,GAA+B,CAAClB,EAAemB,IAA2B,CACrF,IAAIC,EACJ,GAAI,GAACD,GAAS,EAAEC,EAAKpB,GAAO,KAAK,iBAAiBmB,CAAK,GAAG,aAE1D,GAAI,CAEF,OADc,IAAI,IAAIC,CAAE,EACX,QACf,MAAQ,CAAC,CACX,EAGaC,GAA2B,CAACrB,EAAeO,EAA6BC,EAA0BC,IACtGT,EAAM,KAAK,gBACd,OAAO,OAAQA,EAAM,IAAI,cAAoB,EAAkB,OAAQE,GACtEA,EAAE,iBAAmB,MACrBA,EAAE,YAAcO,GAAa,OAAO,qBACpC,MAAM,QAAQF,CAAW,EACtBA,EAAY,OAAO,CAACK,EAAKC,IAAeD,IAAQV,EAAE,cAAgB,KAAOA,EAAE,YAAY,SAASW,CAAU,GAAI,EAAI,EAClHN,IAAgBL,EAAE,cAEtBM,EAAS,OAAO,CAACI,EAAKE,IAAYF,GAAOV,EAAE,QAAQ,SAASY,CAAO,EAAG,EAAI,CAAC,EAC1E,KAAK,CAACE,EAAGC,IAAMA,EAAE,UAAYD,EAAE,SAAS,EACxC,IAAKd,GAAMA,EAAE,EAAE,EAGhBoB,GAA4B,CAACC,EAAgBC,EAAmBxB,EAAeyB,EAAaC,IAA+B,CAC/H,IAAMC,EAAmCC,GAAaF,CAAG,EACpDA,EAAU,QAAQ,EAClBA,EAEL,GACEF,EAAW,iBAAmB,MAC5B,CAAC,MAAM,QAAQA,EAAW,cAAc,GACxC,CAACA,EAAW,eAAe,SAASG,EAAK,MAAM,GAGjD,OAAAE,GAAYN,EAAK,eAAeC,EAAW,EAAE,8BAA8BG,EAAK,MAAM,EAAE,EACjF,GAGT,GAAIC,GAAaF,CAAG,EAAG,CACrB,IAAM,EAAMA,EACNI,EAAkB9B,EAAM,KAAK,iBAAiB,EAAE,YAAY,EAMlE,GAAI,CAAC8B,GAAmBP,EAAI,aAAe,WAAY,MAAO,GAE9D,GACE,CAACO,GACD,CAAC,MAAM,QAAQA,EAAgB,OAAO,GACpC,CAACA,EAAgB,QAAQ,SAAS,KAAK,GACtCA,EAAgB,cAAgB,MAE7B,CAAC,MAAM,QAAQA,EAAgB,WAAW,GAC1C,CAACA,EAAgB,YAAY,SAASL,EAAM,QAAQ,GAI1D,OAAAI,GAAYN,EAAK,eAAe,EAAE,YAAY,yCAAyCE,CAAG,EAAE,EACrF,GAGT,GACEK,EAAgB,iBAAmB,MACjC,CAAC,MAAM,QAAQA,EAAgB,cAAc,GAC7C,CAACA,EAAgB,eAAe,SAASH,EAAK,OAAS,QAAQ,GAGjE,OAAAE,GAAYN,EAAK,eAAeO,EAAgB,EAAE,8BAA8BH,EAAK,MAAM,EAAE,EACtF,EAEX,CAEA,MAAO,EACT,EAEaI,GAAyB,CAACR,EAAgBS,EAAgBhC,EAAeiC,EAAsBR,EAAaC,IAA4B,CACnJ,IAAMF,EAAaxB,EAAM,KAAK,iBAAiBiC,CAAY,EAC3D,MACE,CAACT,GACD,CAAC,MAAM,QAAQA,EAAW,OAAO,GAC/B,CAACA,EAAW,QAAQ,SAAS,KAAK,GACjCA,EAAW,cAAgB,MAExB,CAAC,MAAM,QAAQA,EAAW,WAAW,GACrC,CAACA,EAAW,YAAY,SAASC,CAAG,IAI1CI,GAAYN,EAAK,eAAeU,CAAY,yCAAyCR,CAAG,EAAE,EACnF,IAIP,EAAAA,IAAQS,EAAU,uBAClB,CAACZ,GAA0BC,EAAKC,EAAYxB,EAAOyB,EAAMC,CAAS,GAMlE,CAACM,EAAO,sBACRP,IAAQS,EAAU,qBAClB,CAACZ,GAA0BC,EAAKC,EAAYxB,EAAOyB,EAAMC,EAAU,QAAQ,CAAC,EAMhF,EAEaS,GAA4B,SAAU/B,EAAoBoB,EAAmBxB,EAAeoC,EAAqCC,EAA4B,CACxK,IAAMC,EAAwB,MAAM,QAAQd,EAAW,WAAW,EAAI,IAAI,IAAIA,EAAW,WAAW,EAAIA,EAAW,YAC7Ge,EAA2B,MAAM,QAAQf,EAAW,cAAc,EAAI,IAAI,IAAIA,EAAW,cAAc,EAAIA,EAAW,eAC5H,GAAI,CAACxB,EAAM,KAAK,iBAAiBwB,EAAW,EAAE,EAAG,MAAM,IAAI,MAAM,4FAA8FpB,EAAa,iBAAmBoB,EAAW,EAAE,EAC5M,IAAMgB,EAAkBxC,EAAM,IAAI,eAAewB,EAAW,EAAE,EAC9DY,EAAE,QAAQK,GAAM,CAEd,IAAMd,EAAO,KAAK,OAAO,yBAAyBc,CAAE,EACpD,GAAI,CAACd,EAAM,OACX,IAAMzB,EAAKyB,EAAK,KAChB,GAAI,CAACU,GAAoBb,EAAW,UAAY,CAACG,EAAK,gBACpD,MAAM,IAAI,MAAM,yDAAyD,EAE3E,GAAI,CAAC,OAAO,cAAczB,EAAE,SAAS,GAAKA,EAAE,UAAYsC,EAAgB,UACtE,MAAM,IAAI,MAAM,6BAA+BA,EAAgB,UAAY,wDAA0DtC,EAAE,SAAS,EAElJ,GAAIoC,IAA0B,MACxB,CAAC,MAAM,QAAQpC,EAAE,WAAW,GAAK,CAACA,EAAE,YAAY,OAAO,CAACU,EAAK8B,IAAO9B,GAAO0B,EAAsB,IAAII,CAAE,EAAG,EAAI,GAChH,MAAM,IAAI,MAAM,qGAAuG,OAAOlB,GAAY,WAAW,EAAI,0BAA4B,OAAOtB,EAAE,WAAW,CAAC,EAG9M,GAAIqC,IAA6B,KAAOrC,EAAE,iBACpC,CAACqC,GAA4B,CAAC,MAAM,QAAQrC,EAAE,cAAc,GAAK,CAACA,EAAE,eAAe,OAAO,CAACU,EAAK8B,IAAO9B,GAAO2B,EAAyB,IAAIG,CAAE,EAAG,EAAI,GACtJ,MAAM,IAAI,MAAM,6GAA+G,OAAOlB,GAAY,cAAc,EAAI,8BAAgC,OAAOtB,EAAE,cAAc,CAAC,CAGlO,CAAC,CACH,EAEayC,GAA4B,SAAUvC,EAAoBoB,EAAmBxB,EAAeoC,EAAuC,CAC9I,GAAI,CAACpC,EAAM,KAAK,iBAAiBwB,EAAW,EAAE,EAAG,MAAM,IAAI,MAAM,2EAA6EpB,EAAa,iBAAmBoB,EAAW,EAAE,EAC3L,IAAMgB,EAAkBxC,EAAM,IAAI,eAAewB,EAAW,EAAE,EAC9DY,EACG,QAASQ,GAAQ,CAChB,IAAMjB,EAAO,KAAK,OAAO,yBAAyBiB,CAAG,EACrD,GAAI,CAACjB,EAAM,OACX,IAAMkB,EAAKlB,EAAK,KACVzB,EAAIF,EAAM,IAAI,eAAe6C,CAAE,EACrC,GAAI,CAAC3C,EACH,MAAM,IAAI,MAAM,sBAAwB2C,CAAE,EAE5C,GAAIrB,EAAW,SACb,MAAM,IAAI,MAAM,wBAAwB,EAE1C,GAAI,CAACtB,EAAE,UAAa,CAACyB,EAAK,gBACxB,MAAM,IAAI,MAAM,sCAAsC,EAExD,GAAI,CAAC,OAAO,cAAczB,EAAE,SAAS,GAAKA,EAAE,UAAYsC,EAAgB,UACtE,MAAM,IAAI,MAAM,6BAA+BA,EAAgB,UAAY,iDAAmDtC,EAAE,SAAS,CAE7I,CAAC,CACL,EAEa4C,GAA+B,SAAU1C,EAAoBoB,EAAmBxB,EAAeoC,EAAqF,CAC/L,IAAMW,EAAe,OAAO,OAAO,IAAI,EACjCC,EAAOZ,EAAE,IAAKa,GAAsB,CACxC,IAAMtB,EAAO,KAAK,OAAO,yBAAyBsB,CAAG,EACrD,GAAI,CAACtB,EAAM,OACX,IAAMuB,EAAMvB,EAAK,KAEXwB,EAAcnD,EAAM,IAAI,eAAekD,EAAG,QAAQ,EACxD,GAAI,CAACC,EACH,MAAM,IAAIC,GAAiB,sBAAwBF,EAAG,QAAQ,EAEhE,GAAI,CAACC,EAAY,UAAa,CAACxB,EAAK,gBAClC,MAAM,IAAI,MAAM,sCAAsC,EAExD,GAAIuB,EAAG,OAASC,EAAY,KAC1B,MAAM,IAAI,MAAM,wBAAwB,EAE1C,GAAI,CAACD,EAAG,IAAO,CAACA,EAAG,KACjB,MAAM,IAAI,MAAM,4EAA8EA,EAAG,QAAQ,EAE3G,GAAIA,EAAG,MAAQC,EAAY,MAAM,SAAW,CAAED,EAAG,MAAM,QACrD,MAAM,IAAI,MAAM,oCAAsCA,EAAG,QAAQ,EAE/DA,EAAG,IAAMA,EAAG,KAAOA,EAAG,WACxBH,EAAWG,EAAG,EAAE,EAAIA,EAAG,UAQzB,IAAMG,EAAaC,GAAKH,EAAa,CAAC,kBAAmB,kBAAkB,CAAC,EAE5E,OAAID,EAAG,cACLG,EAAW,YAAcH,EAAG,aAE1BA,EAAG,iBACLG,EAAW,eAAiBH,EAAG,gBAE7BA,EAAG,UACLG,EAAW,QAAUH,EAAG,SAEtBA,EAAG,OACLG,EAAW,KAAOH,EAAG,MAEnBA,EAAG,KACLG,EAAW,GAAKH,EAAG,IAEjBA,EAAG,OACLG,EAAW,KAAOH,EAAG,MAEhBG,CACT,CAAC,EAAE,OAAO,OAAO,EACjB,OAAAlB,GAA0B,KAAK,KAAM/B,EAAYoB,EAAYxB,EAAOgD,EAAM,EAAI,EACvE,CAAGA,EAAsBD,CAAU,CAC5C,EAEaQ,GAAuB,SAAUC,EAAiBC,EAAcT,EAAwChD,EAAeI,EAAoBsD,EAAoBC,EAAsC,CAChN,IAAMC,EAAgB,CAAC,EACjBC,EAAgB,CAAC,EAEjBC,EAAiB,CAACC,EAAKC,IAAiB,CAC5C,IAAMC,EAA2BC,GAAeF,CAAY,EACtDG,EAAY,CAAC,CAACJ,EAAI,MAAM,SAAS,UACvCpD,EAAI,2BAA4B,IAAIyD,GAAO,CAAC,CAC1C,IAAKH,EAGL,UAAW,EACb,CAAC,CAAC,CAAC,EACEE,GACHN,EAAc,KAAK,CAAE,IAAKI,EAA0B,UAAAE,CAAU,CAAC,CAEnE,EAEA,QAAWE,KAAQrB,EAAM,CACvB,IAAMrB,EAAO,KAAK,OAAO,yBAAyB0C,CAAI,EACtD,GAAI,CAAC1C,EAAM,SACX,IAAMoC,EAAMpC,EAAK,KACbqC,EAEJ,GAAID,EAAI,MAAM,SAAWA,EAAI,KAAK,QAAQ,SAEtCA,EAAI,IACJA,EAAI,KAAK,QAAQ,SACjB,CAACpD,EAAI,yBAA0BoD,EAAI,GAAI,CAACA,EAAI,KAAK,QAAQ,SAAS,EAClE,CACA,IAAMO,EAAqB,KAAK,OAAO,yBAAyBP,EAAI,KAAK,QAAQ,OAAO,EAExF,GAAIO,EAAoB,CAEtB,GAAIA,EAAmB,iBAAmB,KACxC,MAAM,IAAI,MAAM,qEAAuEP,EAAI,EAAE,EAE/FC,EAAeM,EAAmB,KAClCV,EAAc,KAAK,CAACG,EAAI,GAAIC,CAAY,CAAC,EACzCF,EAAeC,EAAKC,CAAY,CAClC,CACF,CAIF,GAAID,EAAI,OAAS,OAAQ,CACvB,GAAIpC,EAAK,gBACP,MAAM,IAAI,MAAM,2BAA2B,EAE7C,GAAIoC,EAAI,cAAgB,CAAC,MAAM,QAAQA,EAAI,WAAW,GAAKA,EAAI,YAAY,SAAW,GACpF,MAAM,IAAI,MAAM,+BAA+B,EAEjD,GAAI,CAAC,MAAM,QAAQA,EAAI,OAAO,GAAKA,EAAI,QAAQ,SAAW,GAAKA,EAAI,QAAQ,CAAC,IAAM,MAChF,MAAM,IAAI,MAAM,2CAA2C,EAE7D,GAAIA,EAAI,YAAc,EACpB,MAAM,IAAI,MAAM,4BAA4B,CAEhD,CAIA,GAAIA,EAAI,KAAK,WAAW,aAAa,EAAG,CACjC/D,EAAM,IAAI,UAASA,EAAM,IAAI,QAAU,OAAO,OAAO,IAAI,GAC9D,IAAMuE,EAAeP,IACnBQ,EAAI,KAAK,oBAAqBT,EAAI,EAAE,EAChCU,GAAa,KAAK,oBAAoBV,EAAI,EAAE,EAAG,EAAI,EACnD,QAEN/D,EAAM,IAAI,QAAQ+D,EAAI,EAAE,EAAI,CAC1B,OAAQW,GAAc,MACtB,gBAAiBX,EAAI,KAAK,SAC1B,SAAUA,EAAI,KAAK,SACnB,QAASA,EAAI,KAAK,QAClB,aAAAQ,EACA,UAAW,CAAC,CACd,CACF,CAGA,GAAIR,EAAI,MAAM,YAAY,YAAczD,GAAwBN,EAAO,CAACkC,EAAU,UAAU,EAAG,CAAC,KAAK,CAAC,EAAG,CACvG,IAAMP,EAAO,KAAK,OAAO,yBAAyBoC,EAAI,KAAK,WAAW,UAAU,EAMhF,GAAIpC,GAAQgC,EAAyB,CACnC,IAAMgB,EAAuBhD,EAAK,KAC5BiD,EAAY,KAAK,OAAO,yBAAyBb,EAAI,KAAK,WAAW,SAAS,EAKpFJ,EAAwB,KAAK,IAAM,CACjChD,EAAI,8BAA+BgE,EAAsB,IAAM,CAC7D,IAAME,EAAYlE,EAAI,KAAK,OAAO,aAAa,EAEzCmE,EAA2BD,EAAUzE,CAAU,EACrD,GAAIO,EAAI,+CAAgDmE,EAA0BH,EAAsBC,CAAS,EAG/G,OAGGJ,EAAIK,EAAWF,CAAoB,GAAG,KAAK,OAAO,YAAYE,EAAWF,EAAsB,OAAO,OAAO,IAAI,CAAC,EACvH,IAAMI,EAAcF,EAAUF,CAAoB,EAE7CI,EAAY,WACf,KAAK,OAAO,YAAYA,EAAa,YAAa,OAAO,OAAO,IAAI,CAAC,EAElEA,EAAY,UAAU,oBACzB,KAAK,OAAO,YAAYF,EAAUF,CAAoB,EAAE,UAAW,qBAAsB,CAAC,CAAC,EAGzF,CAAAI,EAAY,UAAU,mBAAmB,KAAMC,GAC1CA,GAAOA,EAAI,aAAe5E,GAAc4E,EAAI,OAASvB,CAC7D,IASDsB,EAAY,UAAU,mBAAmB,KAAK,CAAE,WAAA3E,EAAY,KAAM2D,EAAI,KAAM,KAAAN,EAAM,UAAWmB,GAAW,IAAK,CAAC,EAE9G,KAAK,cAAcxE,EAAY,oBAAsBuE,EAAsB,CAAC,wBAAyBM,GAAkC,CAAE,WAAYN,CAAqB,CAAC,CAAC,EAC9K,CAAC,EAAE,MAAOO,GAAM,CAGd,QAAQ,MAAM,qDAAsD,CAAE,WAAA9E,EAAY,qBAAAuE,EAAsB,UAAAC,CAAU,EAAGM,CAAC,CACxH,CAAC,CACH,CAAC,CACH,CACF,CACF,CAGIrB,EAAc,QAChBF,GAAyB,KAAK,IAAM,CAClChD,EAAI,2BAA4B,IAAIyD,GAAOP,CAAa,CAAC,CAC3D,CAAC,EAEHF,GAAyB,KAAK,IAAMwB,GAA+B,KAAK,KAAM/E,EAAYJ,CAAK,CAAC,CAClG,EAEamF,GAAiC,SAAU/E,EAAoBJ,EAAe,CACzF,GAAI,CAEF,OAAO,OAAQA,EAAM,IAAI,cAAuC,EAAE,OAAQ+D,GAAQ,CAAC,CAAGA,EAAkB,YAAchE,GAAgBC,EAAS+D,EAAkB,IAAI,GAAK,IAAI,EAAE,QAASA,GAAe,CACtM,IAAMqB,EAAa,OAAOrB,EAAI,UAAU,EAClCsB,EAAQ,IAAI,IAAID,CAAU,EAC1BE,EAAkBD,EAAM,SACxBE,EAAiBF,EAAM,aAAa,IAAI,SAAS,EAEvD,GAAI,CAACC,GAAmB,CAACC,EAAgB,CACvC,QAAQ,KAAK,oDAAqD,CAAE,WAAAnF,EAAY,MAAO2D,EAAI,EAAG,CAAC,EAC/F,MACF,CAEA,IAAMc,EAAYlE,EAAI,KAAK,OAAO,aAAa,EAE5BL,GAAwBN,EAAO,CAACkC,EAAU,UAAU,EAAG,CAAC,KAAK,EAAG6B,EAAI,SAAS,IAO5F,MAAM,QAAQc,IAAYS,CAAe,GAAG,WAAW,KAAK,GAC1DT,EAAUS,CAAe,EAAE,UAAU,MAAM,KAAMlD,GACnDA,EAAE,CAAC,IAAM2B,EAAI,MAAQ3B,EAAE,CAAC,IAAMhC,CAChC,IAGGoE,EAAIxE,EAAM,IAAK,cAAc,GAAG,KAAK,OAAO,YAAYA,EAAM,IAAK,eAAgB,OAAO,OAAO,IAAI,CAAC,EACtGwE,EAAIxE,EAAM,IAAI,aAAcsF,CAAe,GAAG,KAAK,OAAO,YAAYtF,EAAM,IAAI,aAAcsF,EAAiB,CAAC,CAAC,EACjHtF,EAAM,IAAI,aAAasF,CAAe,EAAE,KAAK,CAAC,CAACE,CAAC,IAAMA,IAAMD,CAAc,GAC7EvF,EAAM,IAAI,aAAasF,CAAe,EAAE,KAAK,CAACC,EAAgBxB,EAAI,EAAE,CAAC,EAGvE,KAAK,cAAc3D,EAAY,oBAAoBA,CAAU,GAAI,CAAC,oCAAqCA,CAAU,CAAC,GACpH,CAAC,CACH,OAAS8E,EAAG,CACV,QAAQ,KAAK,6CAA+CA,EAAE,SAAWA,EAAE,CAC7E,CACF,EAYaO,GAAgB,CAACC,EAAkB1F,EAAe2F,IAAyD,CACtH,GAAM,CAAE,KAAMC,EAAc,OAAQC,EAAgB,cAAAC,CAAc,EAAIH,GAAkB,CAAC,EACzF,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,gEAAgE,EAElF,IAAMG,EAAOL,EAAM,KAAK,EAElB,CAACjE,EAAKuE,CAAM,EAAIN,EAAM,MAAM,EAyE5BO,GAvEoB,CAACxE,EAAauE,IAAkC,CACxE,IAAMtE,EAAMsE,EAAO,QAAQ,EACrBE,EAA4B,CAACzE,EAAaC,IAAiD,CAC/F,IAAIyE,EACJ,GAAI1E,IAAQS,EAAU,WAAY,CAChC,GAAI,CAAC,MAAM,QAAQR,CAAG,EAAG,MAAM,IAAI,MAAM,wBAAwB,EAMjE,GALAyE,EAAWzE,EAAuB,OAAQxB,GAAM,CAC9C,IAAMkG,EAAOlG,EAAE,QAAQ,EAAQ,GAC/B,MAAO,CAACsE,EAAIxE,EAAM,IAAI,eAAgBoG,CAAG,GAAKpG,EAAM,IAAI,eAAeoG,CAAG,EAAE,iBAAmB,IACjG,CAAC,EAEGD,EAAO,SAAW,EACpB,QAAQ,KAAK,4BAA6B,CAAE,KAAAJ,CAAK,CAAC,UACzCI,EAAO,SAAWzE,EAAI,OAC/B,OAAOA,CAEX,SAAWD,IAAQS,EAAU,WAAY,CACvC,GAAI,CAAC,MAAM,QAAQR,CAAG,EAAG,MAAM,IAAI,MAAM,wBAAwB,EAMjE,GAJAyE,EAASzE,EAAI,OAAQP,GAAU,CAC7B,IAAMiF,EAAO,OAAOjF,CAAK,EAAE,QAAQ,EACnC,OAAOqD,EAAIxE,EAAM,IAAI,eAAgBoG,CAAG,GAAKpG,EAAM,IAAI,eAAeoG,CAAG,EAAE,iBAAmB,IAChG,CAAC,EACGD,EAAO,SAAW,EACpB,QAAQ,KAAK,4BAA6B,CAAE,KAAAJ,CAAK,CAAC,UACzCI,EAAO,SAAWzE,EAAI,OAC/B,OAAOA,CAEX,SAAWD,IAAQS,EAAU,cAAe,CAC1C,GAAI,CAAC,MAAM,QAAQR,CAAG,EAAG,MAAM,IAAI,MAAM,wBAAwB,EAOjE,GALAyE,EAAWzE,EAA0B,OAAQxB,GAAM,CACjD,IAAMmG,EAAQnG,EAAE,QAAQ,EAAQ,SAEhC,OADcA,EAAE,QAAQ,EAAQ,IACjB,MAASsE,EAAIxE,EAAM,IAAI,eAAgBqG,CAAI,GAAKrG,EAAM,IAAI,eAAeqG,CAAI,EAAE,iBAAmB,IACnH,CAAC,EACGF,EAAO,SAAW,EACpB,QAAQ,KAAK,+BAAgC,CAAE,KAAAJ,CAAK,CAAC,UAC5CI,EAAO,SAAWzE,EAAI,OAC/B,OAAOA,CAEX,SAAWD,IAAQS,EAAU,UAAW,CACtC,GAAI,CAAC,MAAM,QAAQR,CAAG,EAAG,MAAM,IAAI,MAAM,wBAAwB,EAEjE,GADAyE,EAAazE,EAAuB,IAAI,CAAC,CAAC4E,EAAGlE,CAAC,IAAM,CAACkE,EAAGJ,EAA0BI,EAAGlE,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAEA,CAAC,IAAM,CAAC,CAACA,CAAC,EAC3G+D,EAAO,SAAW,EACpB,QAAQ,KAAK,2BAA4B,CAAE,KAAAJ,CAAK,CAAC,MAC5C,QAAII,EAAO,SAAWzE,EAAI,QAAUyE,EAAO,OAAO,CAACvF,EAAK8B,EAAI6D,IAAM3F,GAAO8B,IAAOhB,EAAI6E,CAAC,EAAG,EAAI,EAC1F7E,EAEAyE,CAEX,KACE,QAAOzE,CAEX,EAEMyE,EAASD,EAA0BzE,EAAKC,CAAG,EAEjD,GAAIyE,IAAWzE,EACb,OAAOsE,EACF,GAAIG,IAAW,OACpB,OAGF,GAAI,OAAOH,EAAO,UAAa,WAC7B,MAAM,IAAI,MAAM,8BAA8B,EAGhD,OAAOA,EAAO,SAASG,CAAM,CAC/B,GAEoC1E,EAAKuE,CAAM,EAE/C,GAAI,CAACC,EAAW,OAEhB,IAAMO,EAAQ,CAAC/E,EAAKwE,CAAS,EAE7B,OAAAP,EAAQxD,EAAU,UAChB6D,EAAMS,EAAO,CAAE,cAAAV,EAAe,aAAAF,EAAc,OAAQC,EAAiB,CAAE,CACzE,EAEOH,CACT,EAEae,GAAyB,CAACrG,EAAoB6B,EAAuBjC,IAA2B,CAC3G,GAAKiC,EACL,OAAOA,GAAgBjC,EAAM,KAAK,iBAAiBiC,CAAY,GAAG,WAC9D,IAAI,IAAIjC,EAAM,IAAI,eAAeiC,CAAY,EAAE,UAAU,EAAE,SAC3D7B,CACN,EAEO,SAASsG,GAAatG,EAAoBuG,EAAqBC,EAAgBC,EAAoB,CAAE,OAAAC,CAAO,EAAyB,CAAE,OAAQ,EAAK,EAAoC,CAC7L,GAAI,CAAC1G,EAEH,MAAM,IAAI,MAAM,qBAAqB,EAGvC,IAAI2G,EACEC,EAA0B,SAAY,CAC1CC,EAAe,KAAK,IAAIL,GAAS9G,GAAkBoH,CAAe,EAClEH,EAAU,GAAG,KAAK,OAAO,aAAa,gBAAgB3G,CAAU,IAAIuG,CAAW,GAAG,OAAO,UAAUM,CAAY,EAAI,IAAIA,CAAY,GAAK,EAAE,GAC1I,IAAME,EAAiB,MAAM,KAAK,OAAO,MAAMJ,EAAS,CAAE,OAAAK,CAAO,CAAC,EAClE,GAAI,CAACD,EAAe,GAAI,CACtB,IAAM5F,EAAM,GAAG4F,EAAe,MAAM,KAAKA,EAAe,UAAU,GAElE,MAAIA,EAAe,SAAW,KAAOA,EAAe,SAAW,IAAW,IAAIE,GAAsB9F,EAAK,CAAE,MAAO4F,EAAe,MAAO,CAAC,EAEnI,IAAIG,GAAoC/F,EAAK,CAAE,MAAO4F,EAAe,MAAO,CAAC,CACrF,CACA,GAAI,CAACA,EAAe,KAAM,MAAM,IAAI,MAAM,cAAc,EAExD,GADAI,EAAe,SAASJ,EAAe,QAAQ,IAAI,yBAAyB,EAAG,EAAE,EAC7E,CAAC,OAAO,cAAcI,CAAY,EAAG,MAAM,IAAI,MAAM,uBAAuB,EAChF,OAAAC,IAEOL,EAAe,KAAK,UAAU,CACvC,EACA,GAAI,CAAC,OAAO,cAAcR,CAAW,GAAKA,EAAc,EACtD,MAAM,IAAI,UAAU,wDAAwD,EAE9E,IAAMS,EAAS,KAAK,gBAAgB,OAChCI,EAAe,EACfN,EAAkBN,GAAS,OAAO,kBAClCa,EACAF,EACAvH,EAAgF,QAChFiH,EACAS,EACAC,EAAiB,GACjBC,EAEEC,EAAI,IAAI,eAAe,CAG3B,MAAM,KAAMC,EAAY,CACtB,GAAI,CACF,OAEE,OAAQ9H,EAAO,CAGb,IAAK,QAAS,CACZyH,EAAqB,MAAMT,EAAwB,EAGnDhH,EAAQ,oBACR0H,EAAQ,EACR,KACF,CACA,IAAK,WACL,IAAK,oBACL,IAAK,OAAQ,CACX,GAAM,CAAE,KAAAK,EAAM,MAAAC,CAAM,EAAI,MAAMP,EAAmB,KAAK,EAGtD,GAAIM,EAIF,GAAIb,IAAoB,GAAKP,GAAeY,EAAc,CACxDO,EAAW,MAAM,EACjB,MACF,KAAO,IAAI9H,IAAU,qBAAuB2H,EAE1C,MAAM,IAAI,MAAM,kCAAkC,EAGlD3H,EAAQ,QACR,MAGJ,GAAI,CAACgI,EAEH,MAAM,IAAI,MAAM,gCAAgC,EAOlD,GAFAL,EAASA,EAAS,OAAO,KAAKK,CAAK,EAAE,SAAS,EAAE,KAAK,EAEjD,CAACL,EAAQ,MACb,GAAI3H,IAAU,oBAAqB,CAGjC,GAAI2H,EAAO,CAAC,IAAM,IAChB,MAAM,IAAI,MAAM,4CAA4C,EAG9DA,EAASA,EAAO,MAAM,CAAC,CACzB,SAAW3H,IAAU,WAInB,MAAM,IAAI,MAAM,qCAAqC,EAIvDA,EAAQ,SACR,KACF,CACA,IAAK,SAAU,CAGb,IAAMiI,EAAUN,EAAO,OAAO,eAAe,EAG7C,GAAIM,EAAU,EAAG,CACfjI,EAAQ,OACR,KACF,CACA,IAAIkI,EAAW,GACf,GAAI,CAEF,IAAMC,EAAaR,EAAO,MAAM,EAAGM,CAAO,EAAE,KAAK,EACjD,GAAIE,EAAY,CAEd,GAAIT,IAAUT,EACZ,MAAM,IAAI,MAAM,0BAA0B,EAG5C,GADAW,EAAe,KAAK,MAAMQ,GAAS,KAAK,MAAMD,CAAU,CAAC,CAAC,EAAE,QACxDT,IAAU,EAAG,CACf,IAAMjE,EAAOvB,EAAU,gBAAgB0F,CAAY,EAAE,KAC/CS,EAASnG,EAAU,gBAAgB0F,CAAY,EAAE,KAAK,OAC5D,GAAIS,IAAW1B,GAAgBE,GAAaA,IAAcpD,EACxD,MAAI4E,IAAW1B,GAAeE,GAAaA,IAAcpD,EACjD,IAAI6E,GAAqB,sBAAsB7E,CAAI,eAAeoD,CAAS,GAAG,EAE9E,IAAI,MAAM,yBAAyBpD,CAAI,eAAeoD,GAAa,EAAE,eAAewB,CAAM,eAAe1B,CAAW,GAAG,CAGnI,EAIIe,MAAY,GAAKF,IAAiB,KACpCM,EAAW,QAAQF,CAAY,EAC/BM,EAAW,GACXhB,IAEJ,CAIA,GAAIS,EAAOM,CAAO,IAAM,IAAK,CAC3B,GAAIL,EAAc,CAChB,IAAMW,EAAerG,EAAU,gBAAgB0F,CAAY,EAC3DjB,EAAc4B,EAAa,KAAK,OAChC1B,EAAY0B,EAAa,KACzBvI,EAAQ,UACV,MAKEA,EAAQ,MAGV2H,EAASA,EAAO,MAAMM,EAAU,CAAC,EAAE,KAAK,CAC1C,SAAWL,EAETD,EAASA,EAAO,MAAMM,EAAU,CAAC,EAAE,UAAU,MAG7C,OAAM,IAAI,MAAM,uBAAuB,EAIzC,GAAIC,EACF,MAEJ,OAAShD,EAAG,CACV,cAAQ,MAAM,wCAAyCA,CAAC,EAClDA,CACR,CACA,KACF,CACA,IAAK,MAAO,CACV,GAAIgC,IAAoB,GAAKP,GAAeY,EAC1CO,EAAW,MAAM,MAEjB,OAAM,IAAI,MAAM,wBAAwB,EAE1C,MACF,CACF,CAEJ,OAAS5C,EAAG,CACV,cAAQ,MAAM,sBAAuB,CAAE,QAAA6B,CAAQ,EAAG7B,CAAC,EAEnDuC,GAAoB,OAAO,mBAAmB,EAAE,MAAMe,GAAM,CAC1D,QAAQ,MAAM,0DAA2DtD,EAAGsD,CAAE,CAChF,CAAC,EACKtD,CACR,CACF,CACF,CAAC,EACD,OAAI4B,EAAee,EAEZY,GAAmBZ,CAAC,CAC7B,CAEO,SAASa,GAAiCtI,EAAoBJ,EAAwB,CACtFA,IAAOA,EAAQW,EAAI,KAAK,OAAO,aAAa,EAAEP,CAAU,GAC7D,IAAMuI,EAAQ5I,GAAgBC,EAAO,MAAM,EAC3C,GAAI,CAAC2I,EACH,MAAM,IAAI,MAAM,mBAAmBvI,CAAU,EAAE,EAEjD,IAAMwI,EAAM,KAAK,oBAAoBD,CAAK,EAC1C,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,wBAAwBD,CAAK,QAAQvI,CAAU,EAAE,EAEnE,IAAMyI,EAAkB,OAAOD,GAAQ,SAAW1E,GAAe0E,CAAG,EAAIA,EAElEE,EAAa,IAAI,WAAW,EAAE,EAEpC,WAAW,OAAO,gBAAgBA,CAAU,EAG5C,IAAMnH,EAAO,GAAGvB,CAAU,IAAIO,EAAI,eAAe,CAAC,IAAI,OAAO,KAAKmI,CAAU,EAAE,SAAS,QAAQ,CAAC,GAGhG,MAAO,WAAWnH,CAAI,IAAIoH,GAAKF,EAAiBlH,CAAI,CAAC,EACvD,CAmCO,IAAMqH,GAAeC,GAAc,CACxC,OAAO,KAAKA,CAAC,EAAE,QAASC,GAAM,OAAOD,EAAEC,CAAC,CAAC,CAC3C,EAEaC,GAAsB,CAACF,EAAWG,IAA+C,CAC5F,OAAO,KAAKH,CAAC,EAAE,QAASC,GAAME,EAAGH,EAAGC,CAAC,CAAC,CACxC,EAEaG,GAA6B,SAAUC,EAAqB,CACvE,IAAMC,EAAYC,EAAI,KAAK,OAAO,aAAa,EAC/C,OAEG,CAACC,EAAIF,EAAU,UAAWD,CAAE,GAAK,CAACC,EAAU,UAAUD,CAAE,GAAK,CAACG,EAAIF,EAAU,UAAUD,CAAE,EAAG,YAAY,IAExG,CAACG,EAAI,KAAK,wBAAyBH,CAAE,IAEpC,CAACG,EAAIF,EAAWD,CAAE,GAAK,CAACG,EAAIF,EAAUD,CAAE,EAAG,WAAW,GAAK,CAACG,EAAIF,EAAUD,CAAE,EAAE,UAAW,OAAO,GAAKC,EAAUD,CAAE,EAAE,UAAU,MAAM,SAAW,GAAKC,EAAUD,CAAE,EAAE,UAAU,MAAM,OAAO,CAAC,CAAC,CAAEI,CAAG,IAAM,KAAK,gBAAgB,IAAIA,CAAG,CAAC,EAAE,SAAW,EACpP,EAEaC,GAAqB,MAAOC,GAAsC,CAC7E,IAAMC,EAASD,EAAE,UAAU,EACrB,EAAI,CAAC,EACX,OAAS,CACP,GAAM,CAAE,KAAAE,EAAM,MAAAC,CAAM,EAAI,MAAMF,EAAO,KAAK,EAC1C,GAAIC,EAAM,MACV,EAAE,KAAKC,CAAK,CACd,CACA,OAAO,CACT,EAIaC,GAAc,CAACC,KAAmBC,IAAgB,CACzDD,EAAI,aAAe,WACrB,QAAQ,KAAK,GAAGC,CAAI,EAEpB,QAAQ,MAAM,GAAGA,CAAI,CAEzB,EC/1BA,IAAMC,GAA0BC,GAAU,CACxC,IAAIC,EAAsB,QACpBC,EAAkB,IAAI,QAAcC,GAAY,CACpDF,EAAWE,CACb,CAAC,EACD,OAAAC,EAAI,kCAAmCJ,EAAO,IAAME,CAAe,EAE5DD,CACT,EAUaI,GAAkB,CAC7BC,EACAC,EACAC,EACAC,EACAC,EACAC,IACW,CACX,IAAMC,EAAqB,CAACC,EAA6BC,EAAsBC,EAA4BC,EAAyBC,IAAoCC,GAAgE,CACtO,IAAMC,EAASD,GAAeL,EACxBO,EAAa,CACjB,+BACA,CACE,GAAGD,EACH,aAAAL,EACA,kBAAAC,EACA,gBAAAC,EACA,OAAQV,EAAO,QAAQ,aAAc,cAAc,EACnD,sBAAAW,CACF,CACF,EAEA,OAAIE,EAAO,iBACFC,EAEAhB,EAAI,GAAGgB,CAAU,CAE5B,EACA,MAAO,CACL,CAACd,CAAM,EAAG,eAAgBa,EAAwB,CAChD,IAAME,EAAaF,EAAO,WAC1B,GAAI,CAACE,EACH,MAAM,IAAI,MAAM,qBAAqB,EAGvC,GADkBjB,EAAI,oBAAoB,EAC5B,UAAUiB,CAAU,IAAM,KACtC,cAAQ,KAAK,IAAIf,CAAM,wDAAyDe,CAAU,EACpF,IAAI,MAAM,iCAAmCA,CAAU,EAK/D,IAAMpB,EAAWF,GAAuB,kBAAkB,EAEtDuB,EAAe,GACnB,GAAI,CAKF,MAAMlB,EAAI,2BAA4BiB,EAAY,CAAE,UAAW,EAAK,CAAC,EAAE,MAAME,GAAK,CAKhF,MAAAD,EAAe,GACTC,CACR,CAAC,EACD,IAAMC,EAAQ,CACZ,CAACH,CAAU,EAAG,MAAMjB,EAAI,+BAAgCiB,CAAU,CACpE,EACMI,EAAYrB,EAAI,oBAAoB,EAGpCsB,EAAoBP,EAAO,mBAAqBE,EACjDG,EAAME,CAAiB,IAC1BF,EAAME,CAAiB,EAAI,MAAMtB,EAAI,+BAAgCsB,CAAiB,GAOxF,IAAMC,EAAyBR,EAAO,yBAA2B,OAC7DA,EAAO,uBACPE,IAAeI,EAAU,SAAS,mBAChC,KACAA,EAAU,SAAS,mBAErBE,GAA0B,CAACH,EAAMG,CAAsB,IACzDH,EAAMG,CAAsB,EAAI,MAAMvB,EAAI,+BAAgCuB,CAAsB,GAGlG,IAAMb,EAAeK,EAAO,cAAgBS,GAAgBJ,EAAME,CAAiB,EAAGhB,GAAkB,KAAK,EAWvGK,EAAoBI,EAAO,mBAC/BA,EAAO,oBAAsB,MAC7BQ,GACAC,GAAgBJ,EAAMG,CAAsB,EAAGhB,GAAuB,KAAK,EAEvEK,EAAkBG,EAAO,iBAAmBS,GAAgBJ,EAAMH,CAAU,EAAGZ,GAAqB,KAAK,EAE/G,GAAI,CAACK,GAAgB,CAACE,GAAmB,CAAC,MAAMZ,EAAI,yBAA0BU,CAAY,EACxF,cAAQ,KAAK,2BAA2BR,CAAM,6BAA8B,CAAE,WAAAe,EAAY,OAAAf,EAAQ,eAAAI,EAAgB,kBAAAD,EAAmB,aAAAK,EAAc,gBAAAE,EAAiB,kBAAmBG,EAAO,kBAAmB,sBAAuBA,EAAO,qBAAsB,CAAC,EAChQ,IAAIU,GAA8B,wBAAwBvB,CAAM,iBAAiBe,CAAU,EAAE,EAGrG,GAAIM,IAA2B,CAACZ,GAAqB,CAAC,MAAMX,EAAI,yBAA0BW,CAAiB,GACzG,cAAQ,KAAK,2BAA2BT,CAAM,uCAAwC,CAAE,WAAAe,EAAY,OAAAf,EAAQ,eAAAI,EAAgB,kBAAAD,EAAmB,aAAAK,EAAc,gBAAAE,EAAiB,kBAAmBG,EAAO,kBAAmB,sBAAuBA,EAAO,sBAAuB,kBAAAJ,CAAkB,CAAC,EAC7R,IAAIc,GAA8B,wBAAwBvB,CAAM,iBAAiBe,CAAU,EAAE,EAGrG,IAAMS,EAAKlB,EAAmBO,EAAQL,EAAcC,GAAqB,KAAMC,EAAiBG,EAAO,qBAAqB,EAG5H,OAAIX,EACK,MAAMA,EAAQsB,EAAIX,EAAQL,EAAcE,EAAiBG,EAAO,qBAAqB,EAErF,MAAMW,EAAG,CAEpB,OAASP,EAAG,CACV,IAAMQ,EAAmB,OAAOxB,GAAe,SAC3C,GAAGA,CAAU,IAAIyB,GAAOT,CAAC,EAAE,WAAW,GACtChB,EAAWY,EAAQI,CAAC,EACxB,MAAM,IAAIU,GAAsBF,EAAkB,CAAE,MAAOR,CAAE,CAAC,CAChE,QAAE,CACAtB,EAAS,EACJqB,GACH,MAAMlB,EAAI,4BAA6BiB,EAAY,CAAE,UAAW,EAAK,CAAC,CAE1E,CACF,CACF,CACF,EAEaa,GAAwB,CACnC5B,EACAC,EACAC,EACAC,EACAC,EACAC,IACW,CACX,IAAMC,EAAqB,CAACC,EAA6BC,EAAsBC,EAA4BC,EAAyBC,IAAoCC,GAAgE,CACtO,IAAMC,EAASD,GAAeL,EAExBsB,EAAiB7B,EAAO,QAAQ,aAAc,cAAc,EAElE,OAAOF,EAAI,gDAAiD,CAC1D,WAAYe,EAAO,WACnB,aAAcgB,EAAe,MAAM,IAAK,CAAC,EAAE,KAAK,GAAG,EACnD,kBAAApB,EACA,gBAAAC,EACA,aAAAF,EACA,KAAM,CAACqB,EAAgBhB,EAAO,IAAI,CACpC,CAAC,CACH,EACA,MAAO,CACL,CAACb,CAAM,EAAG,eAAgBa,EAAwB,CAChD,IAAME,EAAaF,EAAO,WAC1B,GAAI,CAACE,EACH,MAAM,IAAI,MAAM,qBAAqB,EAGvC,GAAI,CAEF,MAAMjB,EAAI,2BAA4BiB,EAAY,CAAE,UAAW,EAAK,CAAC,EACrE,IAAMG,EAAQ,CACZ,CAACH,CAAU,EAAG,MAAMjB,EAAI,+BAAgCiB,CAAU,CACpE,EACMI,EAAYrB,EAAI,oBAAoB,EAGpCsB,EAAoBP,EAAO,mBAAqBE,EACjDG,EAAME,CAAiB,IAC1BF,EAAME,CAAiB,EAAI,MAAMtB,EAAI,+BAAgCsB,CAAiB,GAOxF,IAAMC,EAAyBR,EAAO,yBAA2B,OAC7DA,EAAO,uBACPE,IAAeI,EAAU,SAAS,mBAChC,KACAA,EAAU,SAAS,mBAErBE,GAA0B,CAACH,EAAMG,CAAsB,IACzDH,EAAMG,CAAsB,EAAI,MAAMvB,EAAI,+BAAgCuB,CAAsB,GAGlG,IAAMb,EAAeK,EAAO,cAAgBS,GAAgBJ,EAAME,CAAiB,EAAGhB,GAAkB,KAAK,EAWvGK,EAAoBI,EAAO,mBAC/BA,EAAO,oBAAsB,MAC7BQ,GACAC,GAAgBJ,EAAMG,CAAsB,EAAGhB,GAAuB,KAAK,EAEvEK,EAAkBG,EAAO,iBAAmBS,GAAgBJ,EAAMH,CAAU,EAAGZ,GAAqB,KAAK,EAE/G,GAAI,CAACK,GAAgB,CAACE,GAAmB,CAAC,MAAMZ,EAAI,yBAA0BU,CAAY,EACxF,cAAQ,KAAK,2BAA2BR,CAAM,6BAA8B,CAAE,WAAAe,EAAY,OAAAf,EAAQ,eAAAI,EAAgB,kBAAAD,EAAmB,aAAAK,EAAc,gBAAAE,EAAiB,kBAAmBG,EAAO,kBAAmB,sBAAuBA,EAAO,qBAAsB,CAAC,EAChQ,IAAIU,GAA8B,wBAAwBvB,CAAM,iBAAiBe,CAAU,EAAE,EAGrG,GAAIM,IAA2B,CAACZ,GAAqB,CAAC,MAAMX,EAAI,yBAA0BW,CAAiB,GACzG,cAAQ,KAAK,2BAA2BT,CAAM,uCAAwC,CAAE,WAAAe,EAAY,OAAAf,EAAQ,eAAAI,EAAgB,kBAAAD,EAAmB,aAAAK,EAAc,gBAAAE,EAAiB,kBAAmBG,EAAO,kBAAmB,sBAAuBA,EAAO,sBAAuB,kBAAAJ,CAAkB,CAAC,EAC7R,IAAIc,GAA8B,wBAAwBvB,CAAM,iBAAiBe,CAAU,EAAE,EAGrG,IAAMS,EAAKlB,EAAmBO,EAAQL,EAAcC,GAAqB,KAAMC,EAAiBG,EAAO,qBAAqB,EAG5H,OAAIX,EACK,MAAMA,EAAQsB,EAAIX,EAAQL,EAAcE,EAAiBG,EAAO,qBAAqB,EAErF,MAAMW,EAAG,CAEpB,OAASP,EAAG,CACV,IAAMQ,EAAmB,OAAOxB,GAAe,SAC3C,GAAGA,CAAU,IAAIyB,GAAOT,CAAC,EAAE,WAAW,GACtChB,EAAWY,EAAQI,CAAC,EACxB,MAAM,IAAIU,GAAsBF,EAAkB,CAAE,MAAOR,CAAE,CAAC,CAChE,QAAE,CACA,MAAMnB,EAAI,4BAA6BiB,EAAY,CAAE,UAAW,EAAK,CAAC,CACxE,CACF,CACF,CACF,EAEA,eAAsBe,GAAc,CAAE,WAAAf,EAAY,SAAAgB,EAAW,EAAG,UAAAC,EAAW,QAAAC,EAAS,QAAAC,CAAQ,EAElB,CACxE,IAAMhB,EAAQ,MAAMpB,EAAI,0BAA2BiB,CAAU,EAE7D,GACE,CAACG,GACD,CAACA,EAAM,KACP,CAACiB,GAAwBjB,EAAO,IAAK,CAAC,KAAK,CAAC,GAC5CA,EAAM,WAAW,oBAAoB,OAErC,MAAM,IAAI,MAAM,wCAAwC,EAG1D,IAAMkB,EAAQd,GAAgBJ,EAAO,KAAK,EACpCmB,EAAQf,GAAgBJ,EAAO,KAAK,EAE1C,GAAI,CAACkB,GAAS,CAACC,EACb,MAAM,IAAI,MAAM,kCAAkC,EAGpD,IAAMC,EAAYC,GAAOC,EAAuB,EAC1CC,EAAcC,GAAMJ,CAAS,EAC7BK,EAAaC,GAAaN,EAAW,EAAK,EAC1CO,EAAaC,GAAsB5B,EAAOkB,EAAOQ,GAAaN,EAAW,EAAI,CAAC,EAEpF,aAAMxC,EAAI,sBAAuB,CAC/B,WAAAiB,EACA,aAAc,qBACd,KAAM,CAAC,CACL,GAAI0B,EACJ,KAAM,cAAgBA,EACtB,QAAS,CAAC,KAAK,EACf,UAAW,OAAO,iBAClB,YAAa,CAACM,EAAU,cAAc,EACtC,KAAM,CACJ,SAAAhB,EACA,QAAS,KAAK,IAAI,EAAIiB,GAAcf,EACpC,QAAS,CACP,QAASY,CACX,CACF,EACA,KAAMF,CACR,CAAC,EACD,aAAcN,CAChB,CAAC,EAEM,CACL,YAAAI,EACA,UAAAT,EACA,QAAAE,CACF,CACF,CAEO,SAASe,GAAsBC,EAA4B,CAChE,IAAMC,EAAc,OAAO,OAAO,IAAI,EACtC,OAAID,GAQF,OAAO,QAAQA,CAAS,EACrB,OAAO,CAAC,CAACE,EAAIC,CAAK,IAAM,CAAC,CAACA,CAAK,EAE/B,QAAQ,CAAC,CAACD,EAAI,CAAE,WAAAE,EAAY,KAAAC,CAAK,CAAC,IAAM,CAKlCD,IACAH,EAAYI,CAAI,IACnBJ,EAAYI,CAAI,EAAI,CAAC,GAEvBJ,EAAYI,CAAI,EAAE,KAAKH,CAAE,EAC3B,CAAC,EAEED,CACT,CAEA,eAAsBK,GAAsBC,EAA0C,CAOpF,IAAMC,EAA2B,CAC/B,wBACA,qBACA,uBACF,EACMC,EAA2BC,GAAQ,CACvC,IAAMC,EAAQH,EAAyB,QAAQE,CAAG,EAClD,OAAOC,IAAU,GAAKH,EAAyB,OAASG,CAC1D,EACMC,EAAc,CAAC,EACrB,GAAI,CACF,IAAMC,EAAsB,OAAO,QAAQN,CAAkB,EAAE,KAAK,CAAC,CAACO,CAAC,EAAG,CAACC,CAAC,IACnEN,EAAwBK,CAAC,EAAIL,EAAwBM,CAAC,CAC9D,EACD,OAAW,CAACV,EAAMJ,CAAW,IAAKY,EAIhC,QAAWhD,KAAcoC,EAAa,CACpC,GAAM,CAAE,UAAAD,CAAU,EAAIpD,EAAI,oBAAoB,EAC9C,GAAIiB,KAAcmC,EAChB,GAAI,CACF,MAAMpD,EAAI,yBAA0BiB,CAAU,CAChD,OAASE,EAAG,CACV,QAAQ,MAAM,wCAAwCsC,CAAI,IAAIxC,CAAU,KAAME,CAAC,EAC3EA,EAAE,OAAS,yBACb,QAAQ,KAAK,sCAAwCF,EAAa,mBAAmB,EACrFjB,EAAI,2BAA4BiB,EAAY,CAAE,UAAW,EAAK,CAAC,EAAE,MAAME,GAAK,CAC1E,QAAQ,MAAM,0DAA2DA,CAAC,CAC5E,CAAC,GAED6C,EAAY,KAAK,GAAGP,CAAI,UAAKxC,EAAW,MAAM,EAAE,CAAC,uBAAuBE,EAAE,OAAO,GAAG,CAExF,MAEA,QAAQ,KAAK,kCAAkCsC,CAAI,IAAIxC,CAAU,sDAAsD,CAE3H,CAEF,GAAI+C,EAAY,OAAS,EAAG,MAAM,IAAI,MAAMA,EAAY,KAAK,IAAI,CAAC,CACpE,OAASI,EAAK,CACZ,cAAQ,MAAM,uDAAwDA,CAAG,EACnEA,CACR,CACF,CC/WO,SAASC,GAAgCC,EAAkC,CAChF,IAAIC,EAAS,CAAC,EACd,GAAID,EAAgB,CAClB,GAAM,CAAE,aAAAE,CAAa,EAAIF,EACzB,QAAWG,KAAgBD,EACzB,QAAWE,KAAcF,EAAaC,CAAY,EAChDF,EAASA,EAAO,OAAOC,EAAaC,CAAY,EAAEC,CAAU,CAAC,CAGnE,CAEA,OAAOH,CACT,CAEO,SAASI,GAAmBC,EAAqBC,EAEtD,CACA,MAAO,CACL,aAAcA,EAAQ,KAAK,aAC3B,WAAYA,EAAQ,KAAK,WACzB,KAAMD,EACN,OAAQC,EAAQ,KAAK,OACrB,OAAQ,CAAC,CAACA,EAAQ,KAAK,OACvB,KAAMA,EAAQ,KAAK,aACrB,CACF,CAEO,SAASC,GAAoBC,EAA0B,CAC5D,GAAM,CAAE,UAAAC,EAAW,OAAAC,CAAO,EAAIF,EACxB,CAAE,aAAAG,EAAc,aAAAC,CAAa,EAAIJ,EAAS,KAE1CK,EAAyB,CAC7B,cAAiBC,EAAE,SAAS,EAC5B,iBAAoBA,EAAE,mBAAmB,EACzC,aAAgBA,EAAE,eAAe,EACjC,WAAcA,EAAE,cAAc,CAChC,EACMC,EAAU,CAAC,EACbJ,IAAiBK,GACfJ,EAAa,WAAaA,EAAa,QAAQ,SACjDG,EAAQ,YAAiB,eAChBH,EAAa,gBAAkBA,EAAa,QAAQ,gBAC7DG,EAAQ,YAAiB,cAElBJ,IAAiBM,GAC1BF,EAAQ,YAAiBH,EAAa,QAC7BD,IAAiBO,GAC1BH,EAAQ,MAAWH,EAAa,KACvBD,IAAiBQ,GAC1BJ,EAAQ,OAAYH,EAAa,WACxBD,IAAiBS,KAC1BL,EAAQ,SAAcH,EAAa,UAMrC,GAAM,CAAE,cAAAS,CAAc,EAAIT,EAC1B,OAAIS,IACEN,EAAQ,cAAgB,mBAC1BA,EAAQ,MAAWO,GAAUD,EAAe,CAAE,MAAO,OAAQ,KAAM,UAAW,IAAK,SAAU,CAAC,EAE9FN,EAAQ,MAAWM,GAGnBN,EAAQ,cACVA,EAAQ,QAAaF,EAAuBE,EAAQ,WAAW,GAG1D,CAAE,UAAAN,EAAW,OAAAC,EAAQ,KAAMC,EAAc,QAAAI,CAAQ,CAC1D,CAiFO,SAASQ,GAAuBC,EAErC,CACA,MAAO,CACL,GAAIA,EAAS,GAAGC,EAAoC,GAAGD,CAAM,GAAK,GAClE,IAAK,GAAGC,EAAoC,KAC9C,CACF,CCxLO,SAASC,GAAoBC,EAAaC,EAAkB,GAAe,CAChF,MAAO,GAAGC,EAAqC,GAAGD,EAAS,WAAa,EAAE,GAAGD,CAAG,EAClF,CAEO,SAASG,GAAyBH,EAAqB,CAC5D,OAAOA,EAAI,SAAS,UAAU,EAC1BA,EAAI,MAAM,UAAU,EAAE,CAAC,EACvB,EACN,CAEO,SAASI,GACdC,EACAC,EAAkB,CAChB,QAAS,GACT,QAAS,EACX,EACQ,CACR,GAAM,CACJ,oBAAAC,EACA,eAAAC,EACA,sBAAAC,CACF,EAAIC,EAAI,oBAAoB,EACtB,CAAE,wBAAAC,CAAwB,EAAID,EAAI,kBAAkB,EACpDE,EAAmB,CACvB,GAAG,OAAO,KAAKD,CAAuB,EAAE,IAAIE,GAAKC,GAAsBD,CAAC,EAAE,EAAE,EAAE,OAAOE,GAAK,CAAC,CAACA,CAAC,EAC7FhB,GAAmB,UAAW,EAAI,CACpC,EAEM,CAAE,QAAAiB,EAAS,QAAAC,CAAQ,EAAIX,EACvBY,EAAQF,EACV,IAAI,OAAO,cAAcJ,EAAiB,KAAK,GAAG,CAAC,kBAAkB,EACrE,IAAI,OAAO,IAAIA,EAAiB,KAAK,GAAG,CAAC,GAAG,EAE1CO,EAAQC,GAAM,CAClB,GAAIA,EAAE,WAAWC,EAAoC,EAAG,CAEtD,IAAMC,EAASF,EAAE,MAAM,CAAC,EAClBG,EAASN,EAAUI,GAAuC,GAC1DG,EAAOP,EAAUT,EAAec,CAAM,EAAIb,EAAsBa,CAAM,EAC5E,OAAOC,EAASC,CAClB,SAAWJ,EAAE,WAAWlB,EAAqC,EAAG,CAE9D,IAAMuB,EAAYtB,GAAwBiB,CAAC,EAE3C,OADeH,EAAUf,GAAwC,IACjDK,EAAoBkB,CAAS,CAC/C,CACA,OAAOL,CACT,EAEA,OAAOf,EACJ,MAAMa,CAAK,EACX,IAAIE,GAAKF,EAAM,KAAKE,CAAC,EAAID,EAAKC,CAAC,EAAIA,CAAC,EACpC,KAAK,EAAE,CACZ,CC9CA,eAAeM,GAA0B,CACvC,WAAAC,EAAY,YAAAC,EAAa,OAAAC,EAAQ,KAAAC,EACjC,cAAAC,EAAe,YAAAC,EAAa,SAAAC,EAAU,aAAAC,CACxC,EASoB,CAClB,IAAMC,EAAc,MAAMC,EAAI,oBAAoB,EAC5CC,EAAY,MAAMD,EAAI,kBAAkB,EACxCE,EAAqBD,EAAU,UAAU,mBAC/C,GAAI,CAACC,EAAoB,OACzB,IAAMC,EAAOF,EAAUC,CAAkB,EAAE,UAAUX,CAAU,EACzDa,EAA4BT,GAAiB,CAACU,GAAc,YAAaA,GAAc,IAAI,EAAE,SAAST,CAAW,EAEvH,MAAMI,EAAI,2BAA4BT,EAAY,CAAE,UAAW,EAAK,CAAC,EACrE,GAAI,CACEa,GACFJ,EAAI,kDAAmD,CAAE,WAAAT,EAAY,YAAAC,EAAa,cAAeC,CAAO,CAAC,EAAE,MAAMa,GAAK,CACpH,QAAQ,MAAM,oEAAqEA,CAAC,CACtF,CAAC,EAYH,IAAIC,EAAQ,KAAKT,CAAY,GACzBU,EACJ,GAAIL,EAAM,CAER,IAAMM,EAAUR,EAAUV,CAAU,EAAE,QAChCmB,GAAc,OAAO,KAAKD,CAAO,EACjCE,GAAeD,GAAY,SAAW,GAAKA,GAAY,CAAC,IAAMR,EAC9DU,GAAeF,GAClB,OAAOb,IAAYA,KAAaK,CAAkB,EAClD,KAAK,CAACW,GAAIC,KAAO,CAChB,IAAMC,GAAe,IAAI,KAAKN,EAAQI,EAAE,EAAE,UAAU,EAAE,QAAQ,EACxDG,GAAe,IAAI,KAAKP,EAAQK,EAAE,EAAE,UAAU,EAAE,QAAQ,EAC9D,OAAOC,GAAeC,EACxB,CAAC,EACGC,GAAoBN,GAAeT,EAAqBU,GAAaA,GAAa,OAAS,CAAC,EAElGL,EAAQI,GACJZ,EAAY,sBAAsBG,CAAkB,EACpDU,GAAa,IAAIM,IAAOnB,EAAY,sBAAsBmB,EAAG,CAAC,EAAE,KAAK,IAAI,EAC7EV,EAAOT,EAAY,uBAAuBkB,EAAiB,GAAG,OAChE,MACET,EAAOT,EAAY,uBAAuBF,CAAQ,GAAG,QAEvD,IAAMsB,EAAO,eAAe5B,CAAU,GAEhC6B,EAAsBnB,EAAUV,CAAU,GAAG,YAAY,eAAiB8B,GAAuB,QACjGC,EAA2BvB,EAAY,yBAAyBR,CAAU,IAAM6B,EAClFrB,EAAY,yBAAyB,eACrCA,EAAY,yBAAyB,eAEnC,CAAE,oBAAAwB,EAAqB,aAAAC,CAAa,EAAIF,EAa9C,GANkBtB,EAAI,8BAA+BT,EAAY,CAAE,UAAW,EAAK,CAAC,EAMrE,OAEf,IAAMkC,EAAsBF,IAAwBG,GAAwB,cACzEH,IAAwBG,GAAwB,iBAAmB/B,EAChEgC,EAAqBH,IAAiBE,GAAwB,cACjEF,IAAiBE,GAAwB,iBAAmB/B,EAE/D8B,GAAuBG,GAAiB,CACtC,MAAArB,EACA,KAAMX,IAAgBS,GAAc,KAAOwB,GAA4BnC,CAAI,EAAIoC,EAAE,aAAa,EAC9F,KAAAtB,EACA,KAAAW,CACF,CAAC,EAEDQ,GAAsB3B,EAAI,wBAAyB+B,GAAiB,CAClE,WAAAxC,EACA,YAAAC,EACA,YAAAI,CACF,CAAC,CACH,QAAE,CACA,MAAMI,EAAI,4BAA6BT,EAAY,CAAE,UAAW,EAAK,CAAC,CACxE,CACF,CAEA,IAAOyC,GAAQ1C,GCxGf2C,EAAI,sBAAuBC,GAAqB,CAAC,CAC/C,WAAAC,EACA,KAAAC,EACA,uBAAAC,EAEA,WAAAC,CACF,IAAM,CACJ,IAAMC,EAAQN,EAAI,0BAA2BE,CAAU,EACjDK,EAAYP,EAAI,oBAAoB,EACpCQ,EAAUR,EAAI,oBAAoB,EAClCS,EAAWC,GAAsBH,EAAU,UAAU,kBAAkB,EACvEI,EAAUN,GAAcF,EACxBS,GAAiB,CAAC,CAACP,GAAcF,EAAK,OAASU,GAAc,OAASF,EAAQ,OACnFA,EAAQ,KAAK,SAASF,EAAS,EAAE,GAAKE,EAAQ,KAAK,SAASF,EAAS,GAAG,GAEzE,GAAI,CAACJ,EAAY,CACf,IAAMS,EAAiB,CAAC,CAACN,EACtB,uBAAuBN,CAAU,EAAE,KAAKa,GAAKA,EAAE,cAAgBZ,EAAK,IAAI,EAO3E,GALIW,GAAkB,CAACF,GACrBZ,EAAI,qDAAsD,CAAE,WAAAE,EAAY,YAAaC,EAAK,IAAK,CAAC,EAAE,MAAMa,GAAK,CAC3G,QAAQ,MAAM,0EAA2EA,CAAC,CAC5F,CAAC,EAECF,EAAgB,MACtB,CAEAG,GAAyB,CACvB,WAAAf,EACA,YAAaS,EAAQ,KACrB,OAAQA,EAAQ,OAChB,KAAMA,EAAQ,KACd,cAAeC,GAAiBN,EAAM,YAAY,OAASY,GAAe,eAC1E,YAAcb,EAAkCF,EAAK,KAA1BU,GAAc,KACzC,SAAUT,EACV,aAAcE,EAAM,YAAY,IAClC,CAAC,EAAE,MAAMU,GAAK,CACZ,QAAQ,MAAM,yDAA0DA,CAAC,CAC3E,CAAC,CACH,CAAC,EAED,IAAOG,GAASnB,EAAI,yBAA0B,CAC5C,6BAA8B,eAAgBoB,EAAqBC,EAA4B,CAE7F,IAAMC,EADYtB,EAAI,kBAAkB,EACf,SAAS,mBAClC,MAAMA,EAAI,2BAA4BsB,EAAQ,CAAE,UAAW,EAAK,CAAC,EACjE,GAAI,CACF,IAAIC,EAAUH,EAAO,SAAS,IAC1BI,EAAUJ,EAAO,SAAS,IAE9B,GAAI,CAACI,EAAS,CACZ,IAAMC,EAAMC,GAAOC,EAA0B,EACvCC,EAAQC,GAAMJ,CAAG,EACjBK,EAAOC,GAAaN,EAAK,EAAK,EAC9BO,EAAOC,GAAgCR,EAAKM,GAAaN,EAAK,EAAI,CAAC,EAEzED,EAAU,CACR,GAAII,EACJ,WAAY,OACZ,KAAM,CACJ,QAAS,CACP,QAASI,EACT,UAAW,EACb,CACF,EACA,KAAMF,EACN,QAASL,CACX,CACF,CAEA,IAAMA,EAAMD,EAAQ,QAAUA,EAAQ,QAAUU,GAAeV,EAAQ,IAAI,EAE3E,GAAI,CAACD,EAAS,CACZ,IAAMY,EAAMT,GAAOU,EAAuB,EACpCC,EAAQR,GAAMM,CAAG,EACjBG,EAAOP,GAAaI,EAAK,EAAK,EAC9BI,EAAON,GAAgCR,EAAKM,GAAaI,EAAK,EAAI,CAAC,EAEzEZ,EAAU,CACR,GAAIc,EACJ,WAAY,OACZ,KAAM,CACJ,QAAS,CACP,QAASE,EACT,UAAW,EACb,CACF,EACA,KAAMD,EACN,QAASH,CACX,CACF,CASA,GANA,MAAMnC,EAAI,2BAER,IAAIwC,GAAO,CAAChB,EAAQ,QAASD,EAAQ,OAAO,EAAE,IAAIkB,IAAQ,CAAE,IAAAA,EAAK,UAAW,EAAK,EAAE,CAAC,CACtF,EAGI,CADc,MAAMzC,EAAI,uCAAwCsB,EAAQ,KAAK,EACjE,MAAM,IAAI,MAAM,uBAAuB,EAEvD,IAAMoB,EAAMhB,GAAOU,EAAuB,EACpCO,EAAQd,GAAMa,CAAG,EACjBE,EAAOb,GAAaW,EAAK,EAAK,EAC9BG,EAAOZ,GAAgCR,EAAKM,GAAaW,EAAK,EAAI,CAAC,EAEnEI,EAAW,MAAM9C,EAAI,gCAAiC,CAC1D,GAAG+C,GAAK3B,EAAQ,CAAC,SAAS,CAAC,EAC3B,eAAgB,CACd,mBAAAC,EACA,GAAGD,EAAO,cACZ,EACA,aAAcG,EAAQ,GACtB,mBAAoBA,EAAQ,GAC5B,sBAAuBC,EAAQ,GAC/B,KAAM,CACJ,CACE,GAAID,EAAQ,GACZ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,IACb,eAAgB,IAChB,WAAYA,EAAQ,WACpB,KAAMA,EAAQ,KACd,KAAMA,EAAQ,IAChB,EACA,CACE,GAAIC,EAAQ,GACZ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAACwB,EAAU,mBAAmB,EAC3C,eAAgB,IAChB,WAAYxB,EAAQ,WACpB,KAAMA,EAAQ,KACd,KAAMA,EAAQ,IAChB,EACA,GAAIJ,EAAO,SAAS,UAChB,CACE,CACE,GAAIA,EAAO,QAAQ,UAAU,CAAC,EAAE,GAChC,KAAM,YACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAAC4B,EAAU,UAAWA,EAAU,WAAYA,EAAU,mBAAmB,EACtF,eAAgB,CAAC,6BAA6B,EAC9C,WAAY5B,EAAO,QAAQ,UAAU,CAAC,EAAE,WACxC,KAAMA,EAAO,QAAQ,UAAU,CAAC,EAAE,KAClC,KAAMA,EAAO,QAAQ,UAAU,CAAC,EAAE,IACpC,EACA,CACE,GAAIA,EAAO,QAAQ,UAAU,CAAC,EAAE,GAChC,KAAM,YACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAAC4B,EAAU,UAAWA,EAAU,WAAYA,EAAU,WAAYA,EAAU,mBAAmB,EAC5G,eAAgB,CAAC,6BAA8B,6BAA6B,EAC5E,WAAY5B,EAAO,QAAQ,UAAU,CAAC,EAAE,WACxC,KAAMA,EAAO,QAAQ,UAAU,CAAC,EAAE,KAClC,KAAMA,EAAO,QAAQ,UAAU,CAAC,EAAE,IACpC,CACF,EACA,CAAC,EACL,CACE,GAAIuB,EACJ,KAAM,OACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAAC,EACd,eAAgB,CAAC,EACjB,KAAM,CACJ,QAAS,CACP,QAASE,CACX,CACF,EACA,KAAMD,CACR,CACF,EACA,KAAM,CACJ,GAAGxB,EAAO,KACV,WAAY,CACV,GAAGA,EAAO,MAAM,WAChB,UAAWE,CACb,CACF,EACA,aAAc,uBAChB,CAAC,EAGD,aAAMtB,EAAI,2BAER,IAAIwC,GAAO,CAAChB,EAAQ,QAASD,EAAQ,OAAO,EAAE,IAAIkB,IAAQ,CAAE,IAAAA,CAAI,EAAE,CAAC,CACrE,EAEOK,CACT,OAAS9B,EAAG,CACV,cAAQ,MAAM,uCAAwCA,CAAC,EACjD,IAAIiC,GAAsBC,EAAE,gCAAgC,CAAC,CACrE,QAAE,CACA,MAAMlD,EAAI,4BAA6BsB,EAAQ,CAAE,UAAW,EAAK,CAAC,CACpE,CACF,EACA,mCAAoC,MAAOpB,EAAoBiD,IAAY,CACzE,IAAM7C,EAAQN,EAAI,0BAA2BE,CAAU,EACjDkD,EAAY,MAAMpD,EAAI,uCAAwCM,EAAO,KAAK,EAE1E+C,EAAwB/C,EAAM,WAAW,gBAAkBA,EAAM,WAAW,gBAAkBJ,EAGpG,OAAO,QAAQ,IAAI,OAAO,KAAKI,EAAM,OAAO,EAAE,IAAI,MAAOgD,GAAgB,CACvE,IAAM1B,EAAQ,MAAM5B,EAAI,uCAAwCsD,EAAa,KAAK,EAClF,GAAI,CAAC1B,EAAO,CACV,QAAQ,KAAK,oCAAoCyB,CAAqB,SAASC,CAAW,eAAe,EACzG,MACF,CACA,MAAO,CACL,wBACA,CACE,KAAMC,GAAsBrD,EAAYkD,EAAW,CACjD,WAAAlD,EACA,kBAAmBoD,EAEnB,KAAM,OAAO,OAAOH,CAAO,EAAE,IAAI,CAAC,CAAC,CAAEK,EAAQC,CAAK,KAA2B,CAC3E,GAAIA,EACJ,KAAM,CACJ,QAAS,CACP,QAASF,GAAsBD,EAAa1B,EAAOG,GAAayB,EAAQ,EAAI,CAAC,CAC/E,CACF,CACF,EAAE,CACJ,CAAC,CACH,CACF,CACF,CAAC,CAAC,EAAE,KAAME,GAAS,CAACA,EAAK,OAAO,OAAO,CAAC,CAAC,CAC3C,EACA,iCAAkC,MAAOxD,EAAoBI,IAAkB,CAC7E,IAAMqD,EAAc3D,EAAI,oBAAoB,EACtC4D,EAAgBD,EAAY,qBAClC,GAAIC,EAAc,YAAY1D,CAAU,EAAG,CACzC,IAAM2D,EAAqBF,EAAY,sBAEvC,MAAM3D,EAAI,0CAA2C,CAAE,WAAY6D,EAAoB,KAAM,CAAE,WAAA3D,CAAW,CAAE,CAAC,EAAE,MAAMc,GAAK,CACxH,QAAQ,KAAK,2BAA2BA,EAAE,IAAI,sDAAsD6C,CAAkB,QAAQ3D,CAAU,IAAKc,CAAC,CAChJ,CAAC,CACH,KAAO,CAIL,IAAM8C,EAAO,OAAO,QAAQF,EAAc,QAAU,CAAC,CAAC,EAAE,OAAO,CAAC,CAACG,EAAKzD,CAAK,IAClE,CAAGA,EAAqB,OAChC,EAAE,IAAI,CAAC,CAACyD,CAAG,IACHA,CACR,EAED,QAAWA,KAAOD,EAAM,CACtB,IAAME,EAAahE,EAAI,0BAA2B+D,CAAG,EAErD,GAAKC,GAAY,YAAY9D,CAAU,EAEvC,CAAK8D,EAAW,UAAU9D,CAAU,EAAE,aAGpC,MAAMF,EAAI,kCAAmC,CAC3C,WAAY+D,EACZ,KAAM,CAAE,WAAY7D,CAAW,CACjC,CAAC,EAAE,MAAMc,GAAK,CACZ,QAAQ,KAAK,2BAA2BA,EAAE,IAAI,8CAA8C+C,CAAG,QAAQ7D,CAAU,IAAKc,CAAC,CACzH,CAAC,EAKH,MACF,CACF,CACF,EACA,GAAGiD,GAAsB,wCAAyCf,EAAE,oCAAoC,CAAC,EACzG,GAAGe,GAAsB,6CAA8Cf,EAAE,4CAA4C,CAAC,EACtH,GAAGgB,GAAgB,iCAAkChB,EAAE,wBAAwB,CAAC,EAChF,GAAGgB,GAAgB,kCAAmChB,EAAE,yBAAyB,CAAC,EAClF,GAAGgB,GAAgB,oCAAqChB,EAAE,2BAA2B,CAAC,EACtF,GAAGgB,GAAgB,uCAAwChB,EAAE,yCAAyC,CAAC,EACvG,GAAGgB,GAAgB,kCAAmChB,EAAE,yBAAyB,CAAC,EAClF,GAAGgB,GAAgB,iCAAkChB,EAAE,wBAAwB,CAAC,EAChF,GAAGgB,GAAgB,mCAAoChB,EAAE,0BAA0B,CAAC,EACpF,GAAGgB,GAAgB,2BAA4BhB,EAAE,8BAA8B,EAAG,MAAOiB,EAAa/C,EAAQgD,IAAiB,CAC7H,IAAM7D,EAAYP,EAAI,kBAAkB,EAClC6D,EAAqBtD,EAAU,SAAS,mBAExC8D,GACJ,MAAM,QAAQjD,EAAO,KAAK,QAAQ,EAAIA,EAAO,KAAK,SAAW,CAACA,EAAO,KAAK,QAAQ,GAGlF,IAAIkD,GAAYA,GAAmBT,CAA6B,EAKlE,MAAM7D,EAAI,2BAA4BqE,EAAS,CAAE,UAAW,EAAK,CAAC,EAClE,GAAI,CACF,MAAMrE,EAAI,yBAA0BoB,EAAO,UAAU,EAErDiD,EAAQ,QAAQN,GAAO,CACrB,GAAI,CAACA,GAAO,CAACQ,EAAIhE,EAAU,UAAWwD,CAAG,GAAK,CAACQ,EAAIhE,EAAWwD,CAAG,EAC/D,MAAM,IAAI,MAAM,8CAA8C3C,EAAO,UAAU,6BAA6B2C,CAAG,aAAa,CAEhI,CAAC,EAED,IAAMnC,EAAQR,EAAO,iBAAmB,MAAMpB,EAAI,uCAAwCoB,EAAO,WAAY,KAAK,EAE5GoD,EAAa,MAAM,QAAQ,IAAIH,EAAQ,IAAI,MAAON,GACtD,CAACA,EAAK,MAAM/D,EAAI,uCAAwC+D,EAAK,KAAK,CAAC,CACrE,CAAC,EACD,OAAO,MAAM/D,EAAI,sBAAuB,CACtC,GAAGoB,EACH,aAAc,wBACd,KAAM,CAEJ,CACE,sBAAuB,CAErB,KAAMoD,EAAW,IAAI,CAAC,CAACT,EAAKU,CAAK,IAAwBlB,GAAsBnC,EAAO,WAAYQ,EAAO,CACvG,WAAY,WAAW,mBAAmBmC,CAAG,CAAC,YAAY,mBAAmB,KAAK,CAAC,GACnF,GAAIU,EACJ,KAAMlE,EAAUwD,CAAG,EAAE,IAAI,eAAeU,CAAK,EAAE,KAC/C,YAAa,CAACzB,EAAU,oBAAsB,QAAQ,EACtD,eAAgB,IAChB,QAAS,CAAC,KAAK,EACf,UAAW,OAAO,iBAClB,KAAM,GAAGe,CAAG,IAAIU,CAAK,EACvB,CAAC,CAAC,CACJ,CACF,EACA,GAAGJ,EAAQ,IAAIN,GAAOI,EAAY,CAChC,GAAG/C,EACH,KAAM2C,IAAQF,EACV,CAAC,EACD,CAAE,SAAUE,CAAI,EACpB,iBAAkB,EACpB,CAAC,CAAC,CACJ,EACA,aAAAK,CACF,CAAC,CACH,QAAE,CACA,MAAMpE,EAAI,4BAA6BqE,EAAS,CAAE,UAAW,EAAK,CAAC,CACrE,CACF,CAAC,EACD,GAAGH,GAAgB,6BAA8BhB,EAAE,gCAAgC,CAAC,EACpF,GAAGgB,GAAgB,wCAAyChB,EAAE,4CAA4C,CAAC,EAC3G,GAAGgB,GAAgB,4BAA6BhB,EAAE,+BAA+B,EAAG,MAAOiB,EAAa/C,EAAQgD,IAAiB,CAC/H,IAAM9C,EAASF,EAAO,KAAK,SACrBsD,EAASpD,GAAU,MAAMtB,EAAI,4CAA6CoB,EAAO,WAAYE,CAAM,EAEzG,OAAIoD,GAAQ,OACH,MAAM1E,EAAI,sBAAuB,CACtC,GAAGoB,EACH,aAAc,wBACd,KAAM,CACJ+C,EAAY,CAAE,GAAG/C,EAAQ,iBAAkB,EAAK,CAAC,EAEjD,CACE,sBAAuB,CACrB,KAAMsD,CACR,CACF,CACF,EACA,aAAAN,CACF,CAAC,EAGI,MAAMD,EAAY/C,CAAM,CACjC,CAAC,EACD,GAAG8C,GAAgB,6BAA8BhB,EAAE,gCAAgC,CAAC,EACpF,GAAGgB,GAAgB,iCAAkChB,EAAE,2BAA2B,CAAC,EACnF,GAAGgB,GAAgB,uCAAwChB,EAAE,kCAAkC,CAAC,EAChG,GAAGgB,GAAgB,gCAAiChB,EAAE,yBAAyB,CAAC,CAClF,CAAC,EChYM,IAAMyB,GAAe,WACfC,GAAmB,eACnBC,GAAiB,aACjBC,GAAW,OAEXC,GAAkB,aAClBC,GAAoB,eACpBC,GAAoB,eAe3BC,GAAiBC,GAAU,OAAO,KAAKA,EAAM,QAAQ,EAAE,OAAOC,GAAKD,EAAM,SAASC,CAAC,EAAE,SAAWC,GAAe,MAAM,EAAE,OAEvHC,GAAgB,CACpB,CAACP,EAAe,EAAG,SAAUI,EAAOI,EAAcC,EAAO,CACvDA,EAAQ,OAAO,OAAOA,CAAK,EAC3B,IAAIC,EAAaP,GAAcC,CAAK,EAChCI,IAAiBG,KAAwBD,GAAc,GAC3D,IAAME,EAAmBR,EAAM,SAAS,UAAUI,CAAY,EAAE,aAAaR,EAAe,EAAE,UACxFa,EAAYC,GAAqBd,GAAiBY,EAAkBF,CAAU,EAC9EK,EAAmBN,EAAM,OAAOO,GAAKA,IAAMnB,EAAgB,EAAE,OAC7DoB,EAAWR,EAAM,OAAOO,GAAKA,IAAMjB,EAAQ,EAAE,OAC7CmB,EAAeT,EAAM,OAAOO,GAAKA,IAAMpB,EAAY,EAAE,OAErDuB,EADoBF,EAAWC,EACDH,EAC9BK,EAASV,EAAaS,EAKtBE,EAAe,KAAK,KAAKR,GAAaH,EAAaK,EAAiB,EAE1E,OADA,QAAQ,MAAM,cAAcf,EAAe,QAAQQ,CAAY,IAAK,CAAE,aAAAa,EAAc,SAAAJ,EAAU,aAAAC,EAAc,iBAAAH,EAAkB,UAAAF,EAAW,OAAAO,EAAQ,QAAAD,EAAS,WAAAT,CAAW,CAAC,EAClKO,GAAYI,EACPtB,GAEFkB,EAAWG,EAASC,EAAezB,GAAeE,EAC3D,EACA,CAACG,EAAiB,EAAG,SAAUG,EAAOI,EAAcC,EAAO,CACzDA,EAAQ,OAAO,OAAOA,CAAK,EAC3B,IAAMC,EAAaP,GAAcC,CAAK,EAChCkB,EAAad,IAAiBG,GAAyB,EAAI,EAC3DY,EAAoB,KAAK,IAAInB,EAAM,SAAS,UAAUI,CAAY,EAAE,aAAaP,EAAiB,EAAE,UAAWqB,CAAU,EACzHT,EAAYC,GAAqBb,GAAmBsB,EAAmBb,CAAU,EACjFO,EAAWR,EAAM,OAAOO,GAAKA,IAAMjB,EAAQ,EAAE,OAC7CmB,EAAeT,EAAM,OAAOO,GAAKA,IAAMpB,EAAY,EAAE,OACrDuB,EAAUV,EAAM,OAChBW,EAASV,EAAaS,EAG5B,OADA,QAAQ,MAAM,cAAclB,EAAiB,QAAQO,CAAY,IAAK,CAAE,SAAAS,EAAU,aAAAC,EAAc,UAAAL,EAAW,QAAAM,EAAS,WAAAT,EAAY,OAAAU,CAAO,CAAC,EACpIF,GAAgBL,EACXjB,GAIFsB,EAAeE,EAASP,EAAYd,GAAWD,EACxD,EACA,CAACI,EAAiB,EAAG,SAAUE,EAAOI,EAAcC,EAAO,CACzD,MAAM,IAAI,MAAM,gBAAgB,CAMlC,CACF,EAEOe,GAAQjB,GAEFkB,GAAgBC,GAAQ,GAAG,OAAO,KAAKnB,EAAK,EAAE,IAAIoB,GAAKC,GAAUD,CAAC,CAAC,CAAC,EACpEE,GAAgBH,GAAQ,GAAG,CAAC9B,GAAcC,GAAkBC,GAAgBC,EAAQ,EAAE,IAAI+B,GAAKF,GAAUE,CAAC,CAAC,CAAC,EAc5GhB,GAAuB,CAACiB,EAAclB,EAAmBmB,IAA8B,CAClG,IAAMC,EAAkB,KAAK,IAAI,EAAGD,CAAS,EAE7C,MAAO,CACL,CAAC/B,EAAiB,EAAG,IAEZ,KAAK,IAAIgC,EAAkB,EAAGpB,CAAS,EAEhD,CAACb,EAAe,EAAG,IAAM,CAEvB,IAAMkC,EAAe,EAAID,EACzB,OAAO,KAAK,IAAIC,EAAcrB,CAAS,CACzC,CACF,EAAEkB,CAAI,EAAE,CACV,EChGO,SAASI,GAA0B,CAAE,MAAAC,EAAO,aAAAC,EAAc,SAAAC,EAAU,WAAAC,EAAY,KAAAC,EAAM,OAAAC,CAAO,EAOjG,CACD,OAAOL,EAAM,UAAUC,CAAY,EAMnCK,EAAI,oCAAqCH,EACvC,CAAC,wDAAyDH,EAAOG,EAAYC,EAAMC,EAAQJ,EAAcC,CAAQ,CACnH,EACAI,EAAI,oCAAqCH,EACvC,CAAC,qCAAsCA,EAAYF,EAAcC,CAAQ,CAC3E,CACF,CAEO,IAAMK,GAA4BC,GAAS,CAChD,KAAMC,GACN,WAAYC,GACZ,aAAcF,GAAS,CACrB,CAACG,EAAe,EAAGH,GAAS,CAAE,UAAWE,EAAO,CAAC,EACjD,CAACE,EAAiB,EAAGJ,GAAS,CAAE,UAAWE,EAAO,CAAC,CACrD,CAAC,CACH,CAAC,EAEM,SAASG,GAAoBb,EAAeC,EAAsBa,EAAiC,CACxG,IAAMZ,EAAWF,EAAM,UAAUC,CAAY,EACvCc,EAAQ,OAAO,OAAO,CAAC,EAAGb,EAAS,KAAK,EACxCc,EAAgBC,GAAMf,EAAS,KAAK,UAAU,EAAEF,EAAOE,EAAS,KAAK,aAAca,CAAK,EAC9FA,EAAM,OAAO,KAAK,OAAO,CAAC,CAAC,EAAID,EAC/B,IAAMI,EAAYD,GAAMf,EAAS,KAAK,UAAU,EAAEF,EAAOE,EAAS,KAAK,aAAca,CAAK,EAC1F,eAAQ,MAAM,oCAAoCC,CAAa,eAAeE,CAAS,GAAG,EAKnFA,IAAcJ,CACvB,CAGO,SAASK,GAAenB,EAAeC,EAA+B,CAC3E,OAAOY,GAAmBb,EAAOC,EAAcmB,EAAQ,CACzD,CAGO,SAASC,GAAerB,EAAeC,EAA+B,CAC3E,OAAOY,GAAmBb,EAAOC,EAAcqB,EAAY,CAC7D,CAEA,SAASC,GAAavB,EAAY,CAAE,KAAAI,EAAM,KAAAoB,EAAM,WAAArB,EAAY,OAAAE,CAAO,EAAQ,CACzE,GAAM,CAAE,aAAAJ,CAAa,EAAIuB,EACnBtB,EAAWF,EAAM,UAAUC,CAAY,EAC7CC,EAAS,OAASuB,GAClBnB,EAAI,wBAAyBoB,GAAiB1B,EAAOsB,GAAcE,CAAI,EACvEzB,GAAyB,CAAE,MAAAC,EAAO,aAAAC,EAAc,SAAAC,EAAU,WAAAC,EAAY,KAAAC,EAAM,OAAAC,CAAO,CAAC,CACtF,CAIO,IAAMsB,GAAmB,CAC9B,KAAMhB,GACN,WAAY,GAAKiB,GACjB,aAAe,CACb,CAACjB,EAAe,EAAG,CAAE,UAAW,GAAK,EACrC,CAACC,EAAiB,EAAG,CAAE,UAAW,CAAE,CACtC,CACF,EAEMiB,GAAoB,CACxB,CAACC,EAAsB,EAAG,CACxB,SAAUH,GACV,CAACP,EAAQ,EAAG,eAAgBpB,EAAO+B,EAAS,CAC1C,GAAM,CAAE,KAAAP,EAAM,WAAArB,EAAY,KAAAC,EAAM,OAAAC,CAAO,EAAI0B,EACrC,CAAE,aAAA9B,CAAa,EAAIuB,EACnBtB,EAAWF,EAAM,UAAUC,CAAY,EAC7CC,EAAS,QAAUsB,EAAK,YACxBtB,EAAS,OAAS8B,GAGlB,IAAMC,EAAa,CAAE,GAAGF,EAAS,KAAMP,EAAK,WAAY,EACxD,MAAMlB,EAAI,oCAAqC2B,EAAYjC,CAAK,EAChEM,EAAI,wBAAyBoB,GAAiB1B,EAAOoB,GAAUI,CAAI,EACnEzB,GAAyB,CAAE,MAAAC,EAAO,aAAAC,EAAc,SAAAC,EAAU,WAAAC,EAAY,KAAAC,EAAM,OAAAC,CAAO,CAAC,CA+BtF,EACA,CAACiB,EAAY,EAAGC,EAClB,EACA,CAACW,EAAsB,EAAG,CACxB,SAAUP,GACV,CAACP,EAAQ,EAAG,eAAgBpB,EAAO+B,EAAS,CAC1C,GAAM,CAAE,KAAAP,EAAM,WAAArB,EAAY,KAAAC,EAAM,OAAAC,CAAO,EAAI0B,EACrC,CAAE,aAAA9B,EAAc,YAAAkC,CAAY,EAAIX,EAChCtB,EAAWF,EAAM,UAAUC,CAAY,EAC7CC,EAAS,OAAS8B,GAClB9B,EAAS,QAAUiC,EACnB,IAAMC,EAAclC,EAAS,KAAK,aAC5B+B,EAAa,CAAE,GAAGF,EAAS,KAAMK,EAAa,aAAAnC,CAAa,EACjE,MAAMK,EAAI,0CAA2C2B,EAAYjC,CAAK,EACtEM,EAAI,oCAAqCH,EACvC,CAAC,6CAA8C8B,CAAU,CAC3D,EACAlC,GAAyB,CAAE,MAAAC,EAAO,aAAAC,EAAc,SAAAC,EAAU,WAAAC,EAAY,KAAAC,EAAM,OAAAC,CAAO,CAAC,CACtF,EACA,CAACiB,EAAY,EAAGC,EAClB,EACA,CAACc,EAA6B,EAAG,CAC/B,SAAUV,GACV,CAACP,EAAQ,EAAG,eAAgBpB,EAAO+B,EAAS,CAC1C,GAAM,CAAE,KAAAP,EAAM,WAAArB,EAAY,KAAAC,EAAM,OAAAC,CAAO,EAAI0B,EACrC,CAAE,aAAA9B,CAAa,EAAIuB,EACnBtB,EAAWF,EAAM,UAAUC,CAAY,EAC7CC,EAAS,OAAS8B,GAClB,GAAM,CAAE,QAAAM,EAAS,cAAAC,CAAc,EAAIrC,EAAS,KAAK,aAG3C+B,EAAa,CACjB,GAAGF,EACH,KAAM,CAAE,CAACO,CAAO,EAAGC,CAAc,EACjC,aAAAtC,CACF,EACA,MAAMK,EAAI,4CAA6C2B,EAAYjC,CAAK,EACxEM,EAAI,oCAAqCH,EACvC,CAAC,+CAAgD8B,CAAU,CAAC,EAC9DlC,GAAyB,CAAE,MAAAC,EAAO,aAAAC,EAAc,SAAAC,EAAU,WAAAC,EAAY,KAAAC,EAAM,OAAAC,CAAO,CAAC,CACtF,EACA,CAACiB,EAAY,EAAGC,EAClB,EACA,CAACiB,EAAgC,EAAG,CAClC,SAAUb,GACV,CAACP,EAAQ,EAAG,eAAgBpB,EAAO+B,EAAS,CAC1C,GAAM,CAAE,KAAAP,EAAM,WAAArB,EAAY,KAAAC,EAAM,OAAAC,CAAO,EAAI0B,EACrC,CAAE,aAAA9B,CAAa,EAAIuB,EACnBtB,EAAWF,EAAM,UAAUC,CAAY,EAC7CC,EAAS,OAAS8B,GAClB,IAAMC,EAAa,CACjB,GAAGF,EACH,KAAM7B,EAAS,KAAK,aACpB,aAAAD,CACF,EACA,MAAMK,EAAI,kDAAmD2B,EAAYjC,CAAK,EAC9ED,GAAyB,CAAE,MAAAC,EAAO,aAAAC,EAAc,SAAAC,EAAU,WAAAC,EAAY,KAAAC,EAAM,OAAAC,CAAO,CAAC,CACtF,EACA,CAACiB,EAAY,EAAGC,EAClB,EACA,CAACkB,EAAgB,EAAG,CAClB,SAAUd,GACV,CAACP,EAAQ,EAAG,SAAUpB,EAAO,CAAE,KAAAwB,EAAM,WAAArB,EAAY,KAAAC,EAAM,OAAAC,CAAO,EAAG,CAC/D,GAAM,CAAE,aAAAJ,CAAa,EAAIuB,EACnBtB,EAAWF,EAAM,UAAUC,CAAY,EAC7CC,EAAS,OAAS8B,GAClB1B,EAAI,wBAAyBoB,GAAiB1B,EAAOoB,GAAUI,CAAI,EACnEzB,GAAyB,CAAE,MAAAC,EAAO,aAAAC,EAAc,SAAAC,EAAU,WAAAC,EAAY,KAAAC,EAAM,OAAAC,CAAO,CAAC,CACtF,EACA,CAACiB,EAAY,EAAGC,EAClB,CACF,EAEOmB,GAAQb,GAEFc,GAAoBC,GAAQ,GAAG,OAAO,KAAKf,EAAS,EAAE,IAAIgB,GAAKC,GAAUD,CAAC,CAAC,CAAC,EChNlF,SAASE,GAAiBC,EAA4B,CAC3D,OAAO,MAAMA,CAAG,EAAE,KAAKC,GAAKA,EAAE,KAAK,CAAC,CACtC,CAiBO,IAAMC,GAAc,MAAOC,EAAiBC,IAAqC,CACtF,IAAMC,EAAOF,EACb,QAAQ,MAAM,iCAAkCE,EAAK,IAAI,EACzD,GAAM,CAAE,SAAAC,CAAS,EAAI,MAAMC,EAAI,sBAAuBJ,EAAW,CAAE,KAAME,EAAK,KAAM,OAAQ,WAAY,EAAGD,CAAM,EACjH,OAAOE,CACT,ECgBAE,EAAI,sBAAuBC,GAAY,CAAC,CAAE,mBAAAC,EAAoB,gBAAAC,CAAgB,IAAM,CAClF,IAAMC,EAAYJ,EAAI,oBAAoB,EAC1C,GAAI,CAACI,EAAU,eAAiBA,EAAU,UAAU,qBAAuBF,EAAoB,OAC/F,IAAMG,EAAqBD,EAAU,cAAc,MAAM,OAAOE,GAAQA,EAAK,UAAYH,CAAe,EAAE,IAAIG,GAAQA,EAAK,IAAI,EAC/HN,EAAI,0BAA2BK,CAAkB,CACnD,CAAC,EAED,IAAME,GAAoB,+BACtBC,GAEJR,EAAI,sBAAuBS,GAAgB,IAAM,CAC/CT,EAAI,wBAAyBO,EAAiB,CAChD,CAAC,EAED,IAAOG,GAASV,EAAI,yBAA0B,CAC5C,0BAA2B,eAAgB,CACzC,KAAM,CACJ,KAAAW,EACA,QAAAC,EACA,aAAAC,EACA,cAAAC,EACA,gBAAAC,EACA,SAAAC,EACA,cAAAC,EACA,iBAAAC,CACF,EACA,eAAAC,CACF,EAAG,CACD,IAAIC,EAAe,GAAG,KAAK,SAAS,MAAM,0CAGpCC,EADYrB,EAAI,oBAAoB,EACjB,SAAS,mBAElC,GAAIY,EACF,GAAI,CACFQ,EAAe,MAAME,GAAYV,EAAS,CAAE,mBAAoBS,CAAO,CAAC,CAC1E,OAASE,GAAG,CACV,cAAQ,MAAM,sDAAuDA,EAAC,EAChE,IAAIC,GAAsBC,EAAE,kDAAmD,CAAE,UAAWF,GAAE,OAAQ,CAAC,CAAC,CAChH,CAKF,IAAMG,EAAMC,GAAOC,EAAuB,EACpCC,EAAMF,GAAOG,EAA0B,EACvCC,EAAYJ,GAAOC,EAAuB,EAC1CI,EAAML,GAAOC,EAAuB,EAGpCK,EAAQC,GAAMR,CAAG,EACjBS,EAAQD,GAAML,CAAG,EACjBO,EAAcF,GAAMH,CAAS,EAC7BM,EAAQH,GAAMF,CAAG,EAGjBM,EAAOC,GAAab,EAAK,EAAK,EAC9Bc,EAAOD,GAAaV,EAAK,EAAK,EAC9BY,EAAaF,GAAaR,EAAW,EAAK,EAC1CW,EAAOH,GAAaP,EAAK,EAAK,EAG9BW,GAAOC,GAAgCf,EAAKU,GAAab,EAAK,EAAI,CAAC,EACnEmB,GAAOD,GAAgCf,EAAKU,GAAaV,EAAK,EAAI,CAAC,EACnEiB,GAAaF,GAAgCf,EAAKU,GAAaR,EAAW,EAAI,CAAC,EAC/EgB,GAAOH,GAAgCf,EAAKU,GAAaP,EAAK,EAAI,CAAC,EAEzE,GAAI,CACF,IAAMgB,GAAmB,CACvB,KAAMhC,EACN,aAAc,CACZ,CAACA,CAAQ,EAAG,CACV,UAAW,CAACC,CACd,CACF,CACF,EAeA,GAdKC,IAKHA,EAAmB+B,GAAkBC,GAAc,IAAI,KAAQ,EAAIC,EAAW,CAAC,GAIjF,MAAMnD,EAAI,2BACR,IAAIoD,GAAO,CAACvB,EAAKH,CAAG,EAAE,IAAI2B,KAAQ,CAAE,IAAAA,GAAK,UAAW,EAAK,EAAE,CAAC,CAC9D,EAGI,CADc,MAAMrD,EAAI,uCAAwCqB,EAAQ,KAAK,EACjE,MAAM,IAAI,MAAM,uBAAuB,EAGvD,GAAI,CADc,MAAMrB,EAAI,uCAAwCqB,EAAQ,KAAK,EACjE,MAAM,IAAI,MAAM,uBAAuB,EAEvD,IAAMiC,GAAU,MAAMtD,EAAI,gCAAiC,CACzD,aAAc,qBACd,eAAgB,CACd,mBAAoBqB,EACpB,GAAGF,CACL,EACA,aAAcc,EACd,mBAAoBA,EACpB,sBAAuBE,EACvB,KAAM,CACJ,CACE,GAAIF,EACJ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,IACb,eAAgB,IAChB,KAAM,CACJ,QAAS,CACP,QAASU,GACT,UAAW,EACb,CACF,EACA,KAAML,CACR,EACA,CACE,GAAIH,EACJ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,IACb,eAAgB,IAChB,KAAM,CACJ,QAAS,CACP,QAASU,GACT,UAAW,EACb,CACF,EACA,KAAML,CACR,EACA,CACE,GAAIJ,EACJ,KAAM,cAAgBA,EACtB,QAAS,CAAC,KAAK,EACf,UAAW,OAAO,iBAClB,YAAa,CAACmB,EAAU,cAAc,EACtC,KAAM,CACJ,SAAUC,GACV,GAAIC,GAAuB,aAAe,CACxC,QACA,MAAMzD,EAAI,eAAe,EAAImD,GAAcM,GAAuB,WACpE,EACA,QAAS,CACP,QAASX,EACX,CACF,EACA,KAAML,CACR,EACA,CACE,GAAIJ,EACJ,KAAM,OACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAAC,EACd,eAAgB,CAAC,EACjB,KAAM,CACJ,QAAS,CACP,QAASU,EACX,CACF,EACA,KAAML,CACR,CACF,EACA,KAAM,CACJ,QAAS,CACP,CAACN,CAAW,EAAG,CACb,UAAWsB,GACX,YAAAtB,CACF,CACF,EACA,SAAU,CAER,UAAWzB,EACX,aAAcS,EACd,aAAAP,EACA,cAAe,CAACC,EAChB,gBAAiBC,EACjB,iBAAAG,EACA,qBAAsB,GACtB,UAAW,CACT,CAACyC,EAA6B,EAAGC,GAC/BA,GAAM,CAAC,EAAGC,GAAUF,EAA6B,EAAE,QAAQ,EAC3DX,EACF,EACA,CAACc,EAAsB,EAAGF,GACxBA,GAAM,CAAC,EAAGC,GAAUC,EAAsB,EAAE,QAAQ,EACpDd,EACF,EACA,CAACe,EAAsB,EAAGH,GACxBA,GAAM,CAAC,EAAGC,GAAUE,EAAsB,EAAE,QAAQ,EACpDf,EACF,EACA,CAACgB,EAAgC,EAAGJ,GAClCA,GAAM,CAAC,EAAGC,GAAUG,EAAgC,EAAE,QAAQ,EAC9DhB,EACF,EACA,CAACiB,EAAgB,EAAGL,GAClBA,GAAM,CAAC,EAAGC,GAAUI,EAAgB,EAAE,QAAQ,EAC9CjB,EACF,CACF,CACF,EACA,aAAc3B,CAChB,CACF,CAAC,EAEK6C,GAAaZ,GAAQ,WAAW,EAGtC,MAAMtD,EAAI,2BACR,IAAIoD,GAAO,CAACvB,EAAKH,EAAKK,CAAS,EAAE,IAAIsB,KAAQ,CAAE,IAAAA,EAAI,EAAE,CAAC,CACxD,EAIA,MAAMrD,EAAI,2BAA4BkE,GAAY,CAAE,UAAW,EAAK,CAAC,EAGrE,MAAM,QAAQ,KAAK,EAChB,SAAY,CACX,QAASC,GAAI,EAAGA,GAAI,GAAIA,KAAK,CAM3B,GAHA,MAAMnE,EAAI,kCAAmC,mBAAoB,IAAM,CAAC,CAAC,EACzE,MAAMA,EAAI,yBAA0BkE,EAAU,EAC5BlE,EAAI,oBAAoB,EAC5BkE,EAAU,GAAG,kBACzB,OAGF,MAAM,IAAI,QAAQE,IAAW,WAAWA,GAAS,EAAE,CAAC,CACtD,CACA,MAAM,IAAI,MAAM,0BAA0B,CAC5C,GAAG,EACH,IAAI,QAAQ,CAACA,GAASC,KAAW,CAC/B,WAAW,IAAMA,GAAO,IAAI,MAAM,kDAAkD,CAAC,EAAG,GAAI,CAC9F,CAAC,CACH,CAAC,EAAE,MAAO9C,IAAM,CACd,QAAQ,MAAM,mDAAoDA,EAAC,CACrE,CAAC,EACD,GAAI,CACF,MAAMvB,EAAI,gCAAiC,CACzC,WAAYqB,EACZ,KAAM,CACJ,gBAAiB6C,GACjB,aAAc3B,GAAab,EAAK,EAAI,EACpC,UAAW,EACb,CACF,CAAC,CACH,QAAE,CACA,MAAM1B,EAAI,4BAA6BkE,GAAY,CAAE,UAAW,EAAK,CAAC,CACxE,CAEA,OAAOZ,GAAQ,WAAW,CAC5B,OAAS/B,GAAG,CACV,cAAQ,MAAM,kCAAmCA,EAAC,EAC5C,IAAIC,GAAsBC,EAAE,4CAA6C6C,GAAO/C,EAAC,CAAC,CAAC,CAC3F,CACF,EAkBA,wBAAyB,SAAUgD,EAAsC,CAKvE,OAAOvE,EAAI,kCAAmC,cAAcuE,EAAO,UAAU,GAAI,SAAY,CAC3F,QAAQ,MAAM,kDAAmDA,EAAO,WAAYA,CAAM,EAC1F,GAAM,CAAE,SAAAC,CAAS,EAAIxE,EAAI,oBAAoB,EAC7C,GAAI,CAACwE,EAAU,MAAM,IAAI,MAAM,uCAAuC,EACtE,GAAM,CAAE,mBAAoBnD,CAAO,EAAImD,EAIvC,MAAMxE,EAAI,yBAA0B,CAACuE,EAAO,sBAAuBA,EAAO,UAAU,CAAC,EAQrF,IAAME,EAAoB,CAAC,GAAG,IAAI,IAAI,CAACF,EAAO,WAAYA,EAAO,qBAAqB,CAAC,CAAC,EACxF,MAAMvE,EAAI,2BAA4ByE,EAAmB,CAAE,UAAW,EAAK,CAAC,EAC5E,GAAI,CACF,IAAMrE,EAAYJ,EAAI,oBAAoB,EAC1C,GAAI,CAACI,EAAU,UAAUmE,EAAO,UAAU,EAAG,CAC3C,QAAQ,KAAK,0KAA2K,CAAE,WAAYA,EAAO,UAAW,CAAC,EACzN,MACF,CAEA,GAAInE,EAAU,UAAUmE,EAAO,UAAU,EAAE,OAAS,qBAClD,MAAM,MAAM,YAAYA,EAAO,UAAU,iBAAiB,EAY5D,IAAMG,EAA6B,MAAM1E,EAAI,+CAAgDqB,EAAQkD,EAAO,WAAYA,EAAO,SAAS,EAElII,EAAQvE,EAAUmE,EAAO,UAAU,EAMnCK,EAAgB,MAAM5E,EAAI,mDAAoDqB,EAAQsD,EAAO,GAAG,EAOhGE,EAAkB,CAACH,GAA8B,CAACE,GAAiB,CAAC,CAACL,EAAO,sBAC5EO,EAAmB,MAAM9E,EAAI,yCAA0C2E,EAAOtD,EAAQkD,EAAO,SAAS,EAM5G,GAAIM,GAAkBC,EAAkB,CAGtC,IAAMC,EAAe,CAAC,CAAE,WAAAb,EAAY,qBAAAc,EAAsB,eAAAC,CAAe,IAAM,CACzEf,IAAeK,EAAO,YAAcS,IAAyB3D,GAAWyD,GAAoB,CAACA,EAAiB,SAASG,CAAc,IAIzIC,EAAmB,EACnBC,EAAoB,EAKpBnF,EAAI,wBAAyBuE,CAAM,EAAE,MAAOhD,GAAM,CAChD,QAAQ,MAAM,8FAA+FA,CAAC,CAChH,CAAC,EACH,EAOM4D,EAAsBnF,EAAI,wBAAyBoF,GANnC,IAAM,CAC1BF,EAAmB,CACrB,CAI8E,EACxEA,EAAqBlF,EAAI,sBAAuBqF,GAA4BN,CAAY,CAChG,CAKA,GAAIF,EAgBF,MAAM7E,EAAI,0BAA2B,CACnC,GAAGsF,GAAKf,EAAQ,CAAC,SAAS,CAAC,EAC3B,qBAAsB,MAAMvE,EAAI,uCAAwCuE,EAAO,WAAY,KAAK,EAChG,YAAa,CAAChB,EAAU,mBAAmB,EAC3C,eAAgB,CAAC,yCAAyC,EAC1D,UAAWgB,EAAO,UAClB,0BAA2B,GAC3B,MAAO,CACL,WAAYA,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,CAAC,EAAE,MAAOhD,GAAM,CACd,cAAQ,MAAM,+DAA+DgD,EAAO,UAAU,IAAKhD,GAAG,SAAWA,EAAGA,CAAC,EAC/GA,CACR,CAAC,UAUQqD,GAAiB,CAACE,EAAkB,CAI7C,GAAIH,EAAM,WAAWtD,CAAM,GAAG,SAAWkE,GAAe,OAAQ,CAK9D,IAAMpD,EAAQ,MAAMnC,EAAI,uCAAwCuE,EAAO,WAAY,KAAK,EAClFiB,EAAQ,MAAMxF,EAAI,uCAAwCqB,EAAQ,KAAK,EACvEY,EAAQ,MAAMjC,EAAI,uCAAwCuE,EAAO,WAAY,KAAK,EAClFkB,EAAY,MAAMzF,EAAI,uCAAwCqB,EAAQ,KAAK,EAC3EqE,EAActF,EAAUiB,CAAM,EAAE,IAAI,eAAeoE,CAAS,EAAE,KAEpE,GAAI,CACF,IAAME,EAAsB,MAAM3F,EAAI,4CAA6CuE,EAAO,WAAYlD,CAAM,EAE5G,MAAMrB,EAAI,sBAAuB,CAC/B,GAAGsF,GAAKf,EAAQ,CAAC,UAAW,SAAU,QAAS,kBAAmB,cAAc,CAAC,EACjF,KAAM,CAGJiB,GAAS,MAAMxF,EAAI,mCAAoC,CACrD,WAAYuE,EAAO,WACnB,aAAc,qBACd,kBAAmBlD,EACnB,OAAQ,CAACmE,CAAK,EACd,iBAAkB,EACpB,CAAC,EAED,CAACG,GAAqB,SAASF,CAAS,GAAK,CAAC,sBAAuB,CACnE,WAAYlB,EAAO,WACnB,aAAc,qBACd,KAAM,CAACqB,GAAsBrB,EAAO,WAAYpC,EAAO,CACrD,WAAY,WAAW,mBAAmBd,CAAM,CAAC,YAAY,mBAAmB,KAAK,CAAC,GACtF,GAAIoE,EACJ,KAAMC,EACN,YAAa,CAACnC,EAAU,oBAAsB,QAAQ,EACtD,eAAgB,IAChB,QAAS,CAAC,KAAK,EACf,UAAW,OAAO,iBAClB,KAAM,GAAGlC,CAAM,IAAIoE,CAAS,EAC9B,CAAC,CAAC,EACF,aAAcxD,CAChB,CAAC,EAED,MAAMjC,EAAI,gCAAiC,CACzC,GAAGsF,GAAKf,EAAQ,CAAC,UAAW,SAAU,QAAS,kBAAmB,cAAc,CAAC,EACjF,KAAM,CAKJ,UAAWnE,EAAUiB,CAAM,EAAE,OAAOkD,EAAO,UAAU,EAAE,IACzD,EACA,iBAAkB,EACpB,CAAC,CACH,EAAE,OAAO,OAAO,EAChB,aAActC,EACd,MAAO,CACL,WAAYsC,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,CAAC,CAIH,OAAShD,EAAG,CACV,cAAQ,MAAM,wDAAwDgD,EAAO,UAAU,IAAKhD,CAAC,EACvFA,CACR,CACF,CAEA,MAAMvB,EAAI,yBAA0BuE,EAAO,UAAU,EACrDvE,EAAI,wBAAyB6F,GAAc,CAAE,mBAAoBxE,EAAQ,gBAAiBkD,EAAO,UAAW,CAAC,CAG/G,KAAW,CAACK,GAAiB,CAACE,IAKnBA,EACT,QAAQ,KAAK,4EAA8EP,EAAO,UAAU,EAE5G,QAAQ,MAAM,iGAAmGA,EAAO,WAAY,CAAE,eAAAM,EAAgB,cAAAD,EAAe,iBAAAE,CAAiB,CAAC,EAE3L,OAASvD,EAAG,CACV,cAAQ,MAAM,gCAAiCA,CAAC,EAC1CA,CACR,QAAE,CAKA,MAAMvB,EAAI,4BAA6ByE,EAAmB,CAAE,UAAW,EAAK,CAAC,CAC/E,CACF,CAAC,EAAE,KAAK,IAAM,CACkBzE,EAAI,qBAAsBO,EAAiB,GACpE,OAAOgE,EAAO,UAAU,CAC/B,CAAC,EAAE,MAAMhD,GAAK,CACZ,IAAIuE,EAAwB9F,EAAI,qBAAsBO,EAAiB,EAClEuF,IACHA,EAAM,IAAI,IACV9F,EAAI,qBAAsBO,GAAmBuF,CAAG,GAGlDA,EAAI,IAAIvB,EAAO,WAAYA,CAAM,EAEjC,IAAMwB,EAAoB,IAAM,CAC1BvF,KAAuB,SACzBA,GAAqB,WAAW,IAAM,CACpCA,GAAqB,OACjBsF,EAAI,OAAS,GAEjB9F,EAAI,uCAAuC,EAAE,MAAMuB,GAAK,CACtD,QAAQ,MAAM,qCAAsCA,CAAC,EACrDwE,EAAkB,CACpB,CAAC,CACH,EAAG,GAAI,EAEX,EACA,MAAAA,EAAkB,EAEZxE,CACR,CAAC,CACH,EACA,wCAAyC,eAAgByE,EAAiBC,EAAgB,CACxF,IAAM/F,EAAqBF,EAAI,kBAAkB,EAAE,SAAS,mBAY5D,MAAMA,EAAI,yBAA0B,CAACgG,EAAS9F,CAAkB,CAAC,EACjE,GAAI,CASF,MAAMF,EAAI,2BAA4BgG,EAAS,CAAE,UAAW,EAAK,CAAC,EAClE,MAAMhG,EAAI,gCAAiC,CACzC,WAAYE,EACZ,aAAc,wBACd,KAAM,CACJ,gBAAiB8F,EACjB,aAAcC,CAChB,CACF,CAAC,CACH,QAAE,CACA,MAAMjG,EAAI,4BAA6BgG,EAAS,CAAE,UAAW,EAAK,CAAC,CACrE,CACF,EACA,wCAAyC,gBAAkB,CACzD,IAAME,EAAYlG,EAAI,oBAAoB,EAAE,UACtC8F,EAAwB9F,EAAI,qBAAsBO,EAAiB,EACzE,GAAKuF,EAEL,OAAO,MAAM,QAAQ,WAAW,CAAC,GAAGA,EAAI,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC5B,EAAYK,CAAM,IAAM,CAC/E,GAAI,CAAC2B,EAAU,SAAShC,CAAU,EAAG,CACnC4B,EAAI,OAAO5B,CAAU,EACrB,MACF,CAEA,OAAOlE,EAAI,wBAAyBuE,CAAM,EAAE,MAAMhD,GAAK,CACrD,cAAQ,MAAM,iCAAkCgD,EAAQhD,CAAC,EAEnDA,CACR,CAAC,CACH,CAAC,CAAC,EAAE,KAAM4E,GAAY,CACpB,GAAIA,EAAQ,KAAKC,GAAUA,EAAO,SAAW,UAAU,EACrD,MAAM,IAAI,MAAM,gCAAgC,CAEpD,CAAC,CACH,EACA,gCAAiC,MAAOlC,EAAoBmC,IAAY,CACtE,IAAMjG,EAAYJ,EAAI,oBAAoB,EACpC2E,EAAQvE,EAAU8D,CAAU,EAC5BoC,EAAY,MAAMtG,EAAI,uCAAwC2E,EAAO,KAAK,EAGhF,OAAO,QAAQ,IACb,OAAO,QAAQA,EAAM,QAAQ,EAC1B,OAAO,CAAC,CAAC4B,EAAGC,CAAC,IAAOA,EAAQ,SAAWjB,GAAe,MAAM,EAC5D,IAAI,MAAO,CAACkB,CAAW,IAAM,CAC5B,IAAMtE,EAAQ,MAAMnC,EAAI,uCAAwCI,EAAUqG,CAAW,EAAG,KAAK,EAC7F,GAAI,CAACtE,EAAO,CACV,QAAQ,KAAK,oCAAoC+B,CAAU,SAASuC,CAAW,eAAe,EAC9F,MACF,CACA,MAAO,CACL,wBACA,CACE,KAAMb,GAAsB1B,EAAYoC,EAAW,CACjD,WAAApC,EACA,kBAAmBuC,EAEnB,KAAM,OAAO,OAAOJ,CAAO,EAAE,IAAI,CAAC,CAAC,CAAEK,EAAQC,CAAK,KAA2B,CAC3E,GAAIA,EACJ,KAAM,CACJ,QAAS,CACP,QAASf,GAAsBa,EAAatE,EAAOI,GAAamE,EAAQ,EAAI,CAAC,CAC/E,CACF,CACF,EAAE,CACJ,CAAC,CACH,CAAC,CACL,CAAC,CAAC,EAAE,KAAME,GAAS,CAACA,EAAK,OAAO,OAAO,CAAC,CAAC,CAC/C,EACA,GAAGC,GAAgB,+BAAgCpF,EAAE,4BAA4B,EAAG,eAAgBqF,EAAavC,EAAQ,CACvH,IAAMnE,EAAYJ,EAAI,oBAAoB,EACpC+G,EAAgB3G,EAAUmE,EAAO,UAAU,EAC3ClD,EAASjB,EAAU,SAAS,mBAClC,QAAW4G,KAAcD,EAAc,UACrC,GAAIxC,EAAO,KAAK,WAAW,KAAK,YAAY,EAAE,UAAU,IAAMwC,EAAc,UAAUC,CAAU,EAAE,KAAK,YAAY,EAAE,UAAU,EAC7H,MAAM,IAAIxF,GAAsBC,EAAE,wBAAwB,CAAC,EAI/D,IAAMwF,EAAQ,MAAMjH,EAAI,uCAAwC+G,EAAe,KAAK,EAC9EG,EAAM,CACV,GAAID,EACJ,WAAY,WAAW,mBAAmB1C,EAAO,UAAU,CAAC,YAAY,mBAAmB,KAAK,CAAC,GACjG,KAAMwC,EAAc,IAAI,eAAeE,CAAK,EAAE,IAChD,EAEME,EAAQ,MAAMnH,EAAI,uCAAwC+G,EAAe,KAAK,EAC9EK,EAAM,CACV,GAAID,EACJ,WAAY,WAAW,mBAAmB5C,EAAO,UAAU,CAAC,YAAY,mBAAmB,KAAK,CAAC,GACjG,KAAMwC,EAAc,IAAI,eAAeI,CAAK,EAAE,IAChD,EAGME,EAAkB,CAAC,CAACC,GAAuB,MAAOA,GAAuB,MAAM,EAAE,SAAS/C,EAAO,KAAK,WAAW,YAAY,EAE7HjB,EAAU,MAAMtD,EAAI,6BAA8B,CACtD,KAAM,CACJ,GAAGuE,EAAO,KACV,WAAY,CACV,SAAU,CAACwC,EAAc,YAAY,EACrC,GAAGxC,EAAO,MAAM,UAClB,CACF,EACA,QAAS,CACP,GAAGA,EAAO,QAIV,GAAK8C,EAID,CACE,UAAW,CAACH,EAAKE,CAAG,CACtB,EALA,CACE,IAAAF,EAAK,IAAAE,CACP,CAIN,EACA,MAAO,CACL,WAAY7C,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,EAAGA,EAAO,UAAU,EAMpB,OAAI8C,GACF,MAAMrH,EAAI,mCAAoC,CAC5C,WAAYqB,EACZ,aAAc,wBACd,kBAAmBiC,EAAQ,WAAW,EACtC,OAAQ,GACV,CAAC,EAGH,MAAMwD,EAAY,CAChB,GAAGxB,GAAKf,EAAQ,CAAC,UAAW,SAAU,OAAQ,OAAO,CAAC,EACtD,KAAM,CACJ,GAAGA,EAAO,KACV,WAAYjB,EAAQ,WAAW,CACjC,EACA,MAAO,CACL,WAAY,KACZ,YAAaiB,EAAO,OAAO,WAC7B,CACF,CAAC,EAEMjB,CACT,CAAC,EACD,GAAGuD,GAAgB,gCAAiCpF,EAAE,8BAA8B,EAAG,eAAgBqF,EAAavC,EAAQ,CAC1H,IAAMnE,EAAYJ,EAAI,oBAAoB,EACpC,CAAE,mBAAAE,CAAmB,EAAIE,EAAU,SACnCmH,EAAWhD,EAAO,KAAK,UAAYrE,EACnCsH,EAAajD,EAAO,KAAK,WACzBpE,EAAkBoE,EAAO,WAI3BgD,IAAarH,GAAsBE,EAAUoH,CAAU,EAAE,WAAW,eAAiBF,GAAuB,SAC9G,MAAMtH,EAAI,mCAAoC,CAC5C,WAAYuH,EACZ,aAAc,wBACd,kBAAmBC,EACnB,OAAQ,GACV,CAAC,EAGH,IAAMC,EAA4BvD,GAAuB,CACnDA,IAAesD,GACbpH,EAAUoH,CAAU,GAAG,UAAUtH,CAAkB,IACrDF,EAAI,wBAAyB0H,GAAiB,CAAE,mBAAAxH,EAAoB,gBAAAC,EAAiB,WAAAqH,CAAW,CAAC,EACjGxH,EAAI,uBAAwB2H,GAAeF,CAAwB,EAGzE,EACA,OAAAzH,EAAI,sBAAuB2H,GAAeF,CAAwB,EAE3DX,EAAY,CACjB,GAAGxB,GAAKf,EAAQ,CAAC,UAAW,QAAQ,CAAC,CACvC,CAAC,CACH,CAAC,EACD,sCAAuC,eAAgBA,EAAwB,CAE7E,MAAMvE,EAAI,2BAA4BuE,EAAO,WAAY,CAAE,UAAW,EAAK,CAAC,EAC5E,GAAI,CASF,IAAMiD,GARU,MAAMxH,EAAI,+BAAgC,CACxD,GAAGsF,GAAKf,EAAQ,CAAC,UAAW,OAAO,CAAC,EACpC,MAAO,CACL,WAAYA,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,CAAC,GAE0B,WAAW,EAItC,aAAMvE,EAAI,yBAA0BuE,EAAO,UAAU,EACrD,MAAMvE,EAAI,gCAAiC,CACzC,GAAGsF,GAAKf,EAAQ,CAAC,UAAW,OAAQ,OAAO,CAAC,EAC5C,KAAM,CAAE,WAAAiD,CAAW,EACnB,MAAO,CACL,YAAajD,EAAO,OAAO,WAC7B,CACF,CAAC,EAEMiD,CACT,QAAE,CACAxH,EAAI,4BAA6BuE,EAAO,WAAY,CAAE,UAAW,EAAK,CAAC,EAAE,MAAMhD,GAC7E,QAAQ,MAAM,uEAAwEA,CAAC,CACzF,CACF,CACF,EACA,GAAGsF,GAAgB,kCAAmCpF,EAAE,gCAAgC,EAAG,eAAgBqF,EAAavC,EAAQ,CAC9H,aAAMvE,EAAI,6BAA8B,CACtC,GAAGsF,GAAKf,EAAQ,CAAC,UAAW,aAAc,OAAQ,OAAO,CAAC,EAC1D,WAAYA,EAAO,KAAK,WACxB,KAAM,CACJ,KAAMA,EAAO,KAAK,IACpB,EACA,MAAO,CACL,WAAYA,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,CAAC,EAEM,MAAMuC,EAAY,CACvB,GAAGxB,GAAKf,EAAQ,CAAC,UAAW,SAAU,OAAO,CAAC,EAC9C,MAAO,CACL,WAAY,KACZ,YAAaA,EAAO,OAAO,WAC7B,CACF,CAAC,CACH,CAAC,EACD,mCAAqCA,GAC5BvE,EAAI,gCAAiC,CAC1C,GAAGsF,GAAKf,EAAQ,CAAC,UAAW,QAAQ,CAAC,EACrC,KAAM,CAAC,CACT,CAAC,EAEH,GAAGsC,GAAgB,gCACjB,CAACtC,EAAQhD,IAAMgD,EAAO,KAAK,SAAW9C,EAAE,6CAA8C,CAAE,SAAU8C,EAAO,KAAK,SAAU,GAAGD,GAAO/C,CAAC,CAAE,CAAC,EAAIE,EAAE,qCAAsC,CAAE,UAAWF,EAAE,OAAQ,CAAC,EAC1M,eAAgBuF,EAAavC,EAAQqD,EAAc,CACjD,MAAMd,EAAY,CAChB,GAAGxB,GAAKf,EAAQ,CAAC,UAAW,QAAQ,CAAC,CACvC,CAAC,CACH,CAAC,EACH,GAAGsC,GAAgB,6CACjBpF,EAAE,+CAA+C,EACjD,eAAgBqF,EAAavC,EAAwB,CACnD,aAAMvE,EAAI,wCAAyC,CACjD,GAAGsF,GAAKf,EAAQ,CAAC,UAAW,aAAc,OAAQ,OAAO,CAAC,EAC1D,WAAYA,EAAO,KAAK,WACxB,KAAM,CACJ,YAAaA,EAAO,KAAK,WAC3B,EACA,MAAO,CACL,WAAYA,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,CAAC,EAIMuC,EAAY,CACjB,GAAGxB,GAAKf,EAAQ,CAAC,UAAW,SAAU,OAAO,CAAC,EAC9C,MAAO,CACL,WAAY,KACZ,YAAaA,EAAO,OAAO,WAC7B,CACF,CAAC,CACH,CAAC,EACH,+BAAgC,eAAgBjB,EAAoBuE,EAAeC,EAAyHC,EAAU,EAAG,CACvN,GAAI,CACF,GAAIA,IAAY,EAAG,CAGjB,WAAW,IAAM,CACf/H,EAAI,+BAAgCsD,EAASuE,EAAOC,EAASC,EAAU,CAAC,EACrE,MAAOxG,GAAM,CACZ,QAAQ,MAAM,8EAA+EA,CAAC,CAChG,CAAC,CACL,EAAGyG,GAAmB,EAAG,GAAI,CAAC,EAC9B,MACF,CAOA,IAAMT,EAAWO,GAAWA,EAAQ,uBAC9BG,EAAU3E,EAAQ,WAAW,EAC7BlD,EAAYJ,EAAI,oBAAoB,EACpC+G,EAAgB3G,EAAU6H,CAAO,EACvC,GAAIV,GAAYnH,EAAU,UAAU6H,CAAO,GAAG,OAAS,sBAAwBlB,GAAe,WAAWQ,CAAQ,GAAG,SAAWhC,GAAe,OAAQ,CAEpJ,IAAM2C,EADclI,EAAI,oBAAoB,EACf,eAAeuH,CAAQ,EACpD,QAAQ,KAAK,uCAAuCA,CAAQ,cAAcW,CAAQ,UAAUD,CAAO,EAAE,EAErG,GAAI,CAACE,EAAcC,CAAQ,EAAuB,OAAO,QAAQrB,EAAc,SAAS,EACrF,KAAK,CAAC,CAACsB,EAAMC,CAAI,IAChBA,EAAK,SAAWC,IAChBD,EAAK,KAAK,eAAiBvE,IAC3BuE,EAAK,KAAK,aAAa,WAAaf,CACrC,GAAK,CAAC,GAAI,MAAS,EACtB,GAAIa,EAEGA,EAAS,MAAMhI,EAAU,SAAS,kBAAkB,GACvD,MAAMJ,EAAI,gCAAiC,CACzC,WAAYiI,EACZ,KAAM,CAAE,aAAAE,EAAc,KAAMK,GAAU,YAAa,CAAE,OAAQ,EAAG,CAAE,EAClE,eAAgB,CAAE,YAAa,CAAE,CACnC,CAAC,MAIH,IAAI,CACFJ,EAAW,MAAMpI,EAAI,4BAA6B,CAChD,WAAYiI,EACZ,KAAM,CACJ,aAAclE,GACd,aAAc,CACZ,SAAAwD,EACA,OAAQ9F,EAAE,iFAAkF,CAAE,MAAOoG,EAAM,OAAQ,CAAC,EACpH,UAAW,EACb,EACA,WAAYd,EAAc,SAAS,UAAUhD,EAAsB,EAAE,KACrE,gBAAiB,KAAK,IAAI,EAAIgD,EAAc,SAAS,UAAUhD,EAAsB,EAAE,UACzF,EACA,eAAgB,CAAE,YAAa,CAAE,CACnC,CAAC,CACH,OAASxC,EAAG,CACV,GAAIwG,EAAU,EACZ,QAAQ,MAAM,uDAAuDxG,EAAE,OAAO,sBAAsBgG,CAAQ,GAAIjE,EAAS/B,CAAC,MACrH,CACL,IAAMkH,EAAYT,GAAmB,EAAG,IAAI,EAC5C,QAAQ,KAAK,2BAA2BzG,EAAE,OAAO,sBAAsBgG,CAAQ,iBAAiBkB,CAAS,SAAUlH,CAAC,EACpH,WAAW,IAAM,CACfvB,EAAI,+BAAgCsD,EAASuE,EAAOC,EAASC,EAAU,CAAC,EACrE,MAAOxG,GAAM,CACZ,QAAQ,MAAM,gFAAiFA,CAAC,CAClG,CAAC,CACL,EAAGkH,CAAS,CACd,CACF,CAEJ,CACF,OAASlH,EAAG,CACV,QAAQ,MAAM,GAAGA,EAAE,IAAI,kCAAmC+B,EAAS/B,CAAC,CAGtE,CACF,EACA,wDAAyD,eAAgB,CAAE,QAAA0G,EAAS,SAAAG,CAAS,EAA0C,CACrI,GAAM,CAAE,kBAAAM,CAAkB,EAAI,MAAM1I,EAAI,0BAA2BiI,CAAO,EAC1E,OAAOjI,EAAI,iCAAkC,CAC3C,WAAY0I,EACZ,KAAM,CAAE,KAAMC,GAAc,YAAa,SAAAP,CAAS,CACpD,CAAC,CACH,EACA,GAAGvB,GAAgB,2CAA4CpF,EAAE,sCAAsC,EAAG,eAAgBqF,EAAavC,EAAQ,CAC7I,GAAM,CAAE,UAAAqE,CAAU,EAAIrE,EAAO,KAC7B,MAAMuC,EAAY,CAChB,GAAGxB,GAAKf,EAAQ,CAAC,UAAW,OAAQ,SAAU,OAAO,CAAC,EACtD,KAAM,CAAE,YAAaqE,EAAU,IAAIpC,GAAKA,EAAE,UAAU,CAAE,EACtD,MAAO,CACL,WAAYjC,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,CAAC,EAED,QAASJ,EAAI,EAAGA,EAAIyE,EAAU,OAAQzE,IACpC,MAAMnE,EAAI,wDAAyD,CACjE,QAASuE,EAAO,WAChB,SAAU,CAAE,GAAGqE,EAAUzE,CAAC,EAAG,OAAQ0E,EAAgB,CACvD,CAAC,CAEL,CAAC,EACD,GAAGhC,GAAgB,iCAAkCpF,EAAE,+BAA+B,EAAG,MAAOqF,EAAavC,IAAW,CACtH,IAAMI,EAAQ,MAAM3E,EAAI,0BAA2BuE,EAAO,UAAU,EAC9DgD,EAAWhD,EAAO,KAAK,UAAYvE,EAAI,kBAAkB,EAAE,SAAS,mBACpE8I,EAAenE,EAAM,UAAUJ,EAAO,KAAK,UAAU,EAAE,QAAQgD,CAAQ,EAAE,aAM/E,MAAMT,EAAY,CAChB,GAAGvC,EACH,KAAM,CACJ,GAAGA,EAAO,KACV,aAAAuE,CACF,CACF,CAAC,CACH,CAAC,EACD,GAAGjC,GAAgB,kCAAmCpF,EAAE,gCAAgC,CAAC,EACzF,GAAGoF,GAAgB,0BAA2BpF,EAAE,0BAA0B,CAAC,EAC3E,GAAGoF,GAAgB,gCAAiCpF,EAAE,0BAA0B,EAAG,eAAgBqF,EAAavC,EAAQ,CACtH,IAAMwE,EAAW,MAAMjC,EAAYvC,CAAM,EACzC,OAAAvE,EAAI,wBAAyBgJ,GAAgB,CAAE,WAAYzE,EAAO,UAAW,CAAC,EACvEwE,CACT,CAAC,EACD,GAAGlC,GAAgB,gCAAiCpF,EAAE,0BAA0B,EAAG,eAAgBqF,EAAavC,EAAQqD,EAAc,CACpI,aAAM5H,EAAI,sBAAuB,CAC/B,WAAYuE,EAAO,WACnB,aAAc,qBACd,KAAM,CAACA,EAAO,KAAK,WAAW,EAC9B,aAAAqD,CACF,CAAC,EAEMd,EAAYvC,CAAM,CAC3B,CAAC,EACD,GAAGsC,GAAgB,2BAA4BpF,EAAE,2BAA2B,CAAC,EAC7E,GAAGoF,GAAgB,iCAAkCpF,EAAE,2BAA2B,CAAC,EACnF,GAAGoF,GAAgB,uCAAwCpF,EAAE,0CAA0C,CAAC,EACxG,GAAGoF,GAAgB,sCAAuCpF,EAAE,iCAAiC,CAAC,EAC9F,GAAGoF,GAAgB,4BAA6BpF,EAAE,4BAA4B,EAAG,CAACqF,EAAavC,IAAW,CACxG,GAAM,CAAE,WAAAL,CAAW,EAAIK,EACvB,OAAOuC,EAAY,CACjB,GAAGvC,EACH,MAAO,CACL,YAAa,MAAOjB,GAAY,CAC9B,GAAI,CACF,IAAM2F,EAAa3F,EAAQ,KAAK,EAE1B8E,GADQ,MAAMpI,EAAI,0BAA2BkE,CAAU,GACtC,UAAU+E,CAAU,EACrCC,EAAiBC,GAAoBf,EAAU,CAAE,WAAAa,EAAY,OAAQV,EAAY,CAAC,EAExF,MAAMvI,EAAI,wDAAyD,CAAE,QAASkE,EAAY,SAAUgF,CAAe,CAAC,CACtH,OAAS3H,EAAG,CACV,cAAQ,MAAM,2FAA2F2C,CAAU,IAAK3C,CAAC,EACnHA,CACR,CACF,CACF,CACF,CAAC,CACH,CAAC,EACD,GAAGsF,GAAgB,gCAAiCpF,EAAE,6BAA6B,EAAG,MAAOqF,EAAavC,IAAW,CACnH,GAAM,CAAE,WAAAL,EAAY,KAAAkF,CAAK,EAAI7E,EACvBI,EAAQ,MAAM3E,EAAI,0BAA2BkE,CAAU,EACvDiE,EAAeiB,EAAK,aACpBhB,EAAWzD,EAAM,UAAUwD,CAAY,EACvCkB,EAAOjB,EAAS,KAAK,aAErBkB,EAAeC,GAAc5E,EAAOwD,CAAY,EAChDqB,EAAeC,GAAc9E,EAAOwD,CAAY,EAChDuB,EAAYN,EAAK,OAASZ,GAC1BmB,EAAgB,CAACD,EACnBE,EAAcF,EAAY,CAAC,EAAI,OAC/BR,EAEAI,GAAgBI,GACdL,IAASvF,KACX8F,EAAc,MAAMC,GAAa,CAC/B,WAAA3F,EACA,QAASkE,EAAS,KAAK,aAAa,WACpC,UAAWA,EAAS,UACpB,QAASzD,EAAM,SAAS,oBAC1B,CAAC,GAGHuE,EAAiBC,GAAoBf,EAAU,CAAE,WAAYD,EAAc,OAAQ2B,EAAc,CAAC,GACzFN,GAAgBG,IACzBT,EAAiBC,GAAoBf,EAAU,CAAE,WAAYD,EAAc,OAAQ4B,EAAc,CAAC,GAGpG,IAAMhB,EAAW,MAAMjC,EAAY,CAAE,GAAGvC,EAAQ,KAAM,CAAE,GAAG6E,EAAM,YAAAQ,CAAY,CAAE,CAAC,EAEhF,OAAIV,GASF,MAAMlJ,EAAI,wDAAyD,CACjE,QAASkE,EACT,SAAUgF,CACZ,CAAC,EAGIH,CACT,CAAC,EACD,GAAGlC,GAAgB,kCAAmCpF,EAAE,4BAA4B,EAAG,eAAgBqF,EAAavC,EAAQ,CAC1H,GAAM,CAAE,WAAAL,EAAY,KAAAkF,CAAK,EAAI7E,EAEvB6D,GADQ,MAAMpI,EAAI,0BAA2BkE,CAAU,GACtC,UAAUkF,EAAK,YAAY,EAC5CF,EAAiBC,GAAoBf,EAAU,CAAE,WAAYgB,EAAK,aAAc,OAAQY,EAAiB,CAAC,EAE1GjB,EAAW,MAAMjC,EAAYvC,CAAM,EAEzC,aAAMvE,EAAI,wDAAyD,CAAE,QAASkE,EAAY,SAAUgF,CAAe,CAAC,EAE7GH,CACT,CAAC,EACD,GAAGlC,GAAgB,wCAAyCpF,EAAE,mCAAmC,EAAG,eAAgBqF,EAAavC,EAAQ,CACvI,GAAM,CAAE,WAAAL,EAAY,KAAAkF,CAAK,EAAI7E,EACvBI,EAAQ,MAAM3E,EAAI,0BAA2BkE,CAAU,EAE7D,QAAWiE,KAAgBiB,EAAK,YAAa,CAC3C,IAAMhB,EAAWzD,EAAM,UAAUwD,CAAY,EACvCe,EAAiBC,GAAoBf,EAAU,CAAE,WAAYD,EAAc,OAAQ8B,EAAe,CAAC,EAEzG,MAAMjK,EAAI,wDAAyD,CAAE,QAASkE,EAAY,SAAUgF,CAAe,CAAC,CACtH,CAGA,OADiB,MAAMpC,EAAYvC,CAAM,CAE3C,CAAC,EACD,8BAA+B,MAAOL,EAAoBS,IAAkB,CAC1E,IAAMuF,EAAclK,EAAI,oBAAoB,EACtCE,EAAqBgK,EAAY,sBACjCC,EAAuBD,EAAY,qBAEnCC,EAAqB,SAASjG,CAAU,GAAK,CAACiG,EAAqB,OAAOjG,CAAU,EAAE,SAC1F,MAAMlE,EAAI,iCAAkC,CAC1C,WAAYE,EACZ,KAAM,CACJ,gBAAiBgE,EACjB,UAAWS,EAAM,WAAWzE,CAAkB,GAAG,SACnD,CACF,CAAC,EAAE,MAAMqB,GAAK,CACZ,QAAQ,KAAK,2BAA2BA,EAAE,IAAI,6CAA6CrB,CAAkB,QAAQgE,CAAU,IAAK3C,CAAC,CACvI,CAAC,CAEL,EACA,GAAGsF,GAAgB,kCAAmCpF,EAAE,kCAAkC,CAAC,EAC3F,GAAGoF,GAAgB,wCAAyC,CAACtC,EAAQhD,IAAME,EAAE,6CAA8C,CAAE,UAAWF,EAAE,OAAQ,CAAC,CAAC,EACpJ,GAAGsF,GAAgB,0CAA2CpF,EAAE,2CAA2C,CAAC,EAC5G,GAAGoF,GAAgB,2CAA4CpF,EAAE,uCAAuC,CAAC,EACzG,GAA+C,EAGjD,CAAC,EC1nCD2I,EAAI,sBAAuBC,GAAQ,IAAM,CAClCD,EAAI,kBAAkB,EAAE,UAAU,oBAGvCA,EAAI,0BAA0B,EAAE,MAAM,GAAK,CACzC,QAAQ,MAAM,wEAAyE,CAAC,CAC1F,CAAC,CACH,CAAC,EAED,IAAOE,GAASF,EAAI,yBAA0B,CAC5C,2BAA4B,SAAY,CACtC,QAAQ,KAAK,4CAA4C,EACzD,IAAMG,EAAgB,MAAMH,EAAI,oBAAoB,EAC9CI,EAAqBD,EAAc,UAAU,mBACnD,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,sDAAsD,EAExE,MAAM,QAAQ,IACZ,OAAO,QAAQD,EAAcC,CAAkB,EAAE,QAAU,CAAC,CAAC,EAAE,IAAI,CAAC,CAACC,EAAYC,CAAK,IAAM,CAE1F,GAAI,CAAAA,EAAM,QACV,OAAON,EAAI,2BAA4BK,EAAY,CAAC,uCAAwC,CAAE,WAAAA,CAAW,CAAC,CAAC,CAC7G,CAAC,CACH,EACA,QAAQ,KAAK,oCAAoC,CACnD,EACA,wCAAyC,MAAO,CAAE,WAAAA,CAAW,IAA8B,CACzF,IAAME,EAAS,MAAMP,EAAI,kBAAmBK,EAAYG,GAAQ,cAAc,EAE9E,OAAID,EAGKA,EAAO,KAET,OAAO,OAAO,IAAI,CAC3B,EACA,uCAAwC,CAAC,CAAE,WAAAF,CAAW,IAC7CL,EAAI,kCAAmCS,GAAU,SAAY,CAClE,IAAMC,EAAO,MAAMV,EAAI,wCAAyC,CAAE,WAAAK,CAAW,CAAC,EAC9EL,EAAI,wBAAyBW,GAAoB,CAACN,EAAYK,CAAI,CAAC,CACrE,CAAC,EAAE,MAAME,GAAK,CACZ,QAAQ,MAAM,sEAAuEA,CAAC,CACxF,CAAC,EAEH,yCAA0C,CAAC,CAAE,WAAAP,EAAY,SAAAQ,CAAS,IAAiD,CACjH,IAAMT,EAAqBJ,EAAI,kBAAkB,EAAE,UAAU,mBAC7D,GAAI,CAACI,EACH,MAAM,IAAI,MAAM,yDAAyD,EAG3E,IAAMU,EAAMd,EAAI,eAAe,EAC/B,GAAIa,EAAU,CAEZ,IAAME,EADQf,EAAI,kBAAkB,EACQ,eAAeK,CAAU,IAAID,CAAkB,EAC3F,GAAIW,EAAsB,CACxB,IAAMC,EAAe,IAAI,KAAKD,CAAoB,EAAE,QAAQ,EAE5D,GAAKD,EAAME,EAAgBC,GAAgC,MAC7D,CACF,CAEA,IAAMC,EAAY,IAAI,KAAKJ,CAAG,EAAE,YAAY,EAC5C,OAAOd,EAAI,kCAAmCS,GAAU,SAAY,CAClE,IAAMU,EAA+B,CAAC,CAAE,KAAAC,EAAM,YAAAC,EAAc,CAAC,CAAE,EAAI,CAAC,IAC3D,CAAC,CAAE,GAAGA,EAAa,CAACjB,CAAkB,EAAGc,CAAU,EAAGE,CAAI,EAG7DV,EAAOS,EAA6B,EAAE,CAAC,EAC7C,MAAMnB,EAAI,kBAAmBK,EAAYG,GAAQ,eAAgBE,EAAM,CACrE,gBAAiB,MAAMV,EAAI,uCAAwCK,EAAY,KAAK,EACpF,aAAc,MAAML,EAAI,uCAAwCK,EAAY,KAAK,EACjF,WAAYc,CACd,CAAC,CACH,CAAC,CACH,CACF,CAAC,EC3ED,IAAMG,GAAmC,CAAC,EAEpCC,GAAc,CAClB,MAAM,OAAS,CACb,MAAM,QAAQ,IAAID,GAAW,IAAKE,GAAeA,EAAW,CAAC,CAAC,CAChE,EACA,eAAgB,CAAE,KAAAC,EAAM,UAAAC,CAAU,EAAwC,CAQxE,IAAMF,GAAc,IAAM,CACxB,IAAIG,EACJ,MAAO,KACAA,IACHA,EAAU,IAAI,QAAQ,CAACC,EAASC,IAAW,CACzC,GAAIJ,EAAK,SAAS,GAAG,GAAKC,EAAU,SAAS,GAAG,EAAG,CACjDG,EAAO,IAAI,MAAM,mCAAmC,CAAC,EACrD,MACF,CAEA,IAAMC,EAAUC,GAAqB,CAOnC,IAAMC,EAAU,KAAK,UAAU,KAAKP,EAAO,KAAOC,EAAWK,CAAO,EAGpEC,EAAQ,gBAAmBC,GAAU,CACxBA,EAAM,OAAO,OACrB,kBAAkBP,CAAS,CAChC,EAEAM,EAAQ,UAAaC,GAAU,CAC7B,IAAMC,EAAKD,EAAM,OAAO,OACxB,GAAI,CAACC,EAAG,iBAAiB,SAASR,CAAS,EACzC,OAAOI,EAAOI,EAAG,QAAU,CAAC,EAG9BN,EAAQM,CAAE,CACZ,EAEAF,EAAQ,QAAWG,GAAU,CAC3BN,EAAOM,CAAK,CACd,EAIAH,EAAQ,UAAaC,GAAU,CAC7BJ,EAAO,IAAI,MAAM,eAAe,CAAC,CACnC,CACF,EAEAC,EAAO,CACT,CAAC,GAEIH,EAEX,GAAG,EAEH,OAAAL,GAAW,KAAKE,CAAU,EAEnB,CACL,MAAM,OAAS,CAIb,IAAMQ,GAHK,MAAMR,EAAW,GACL,YAAY,CAACE,CAAS,EAAG,WAAW,EAC3B,YAAYA,CAAS,EACzB,MAAM,EAClC,OAAO,IAAI,QAAQ,CAACE,EAASC,IAAW,CACtCG,EAAQ,UAAY,IAAM,CACxBJ,EAAQ,CACV,EACAI,EAAQ,QAAWI,GAAM,CACvBP,EAAOO,CAAC,CACV,CACF,CAAC,CACH,EACA,MAAM,QAASC,EAAa,CAI1B,IAAML,GAHK,MAAMR,EAAW,GACL,YAAY,CAACE,CAAS,EAAG,UAAU,EAC1B,YAAYA,CAAS,EACzB,IAAIW,CAAG,EACnC,OAAO,IAAI,QAAQ,CAACT,EAASC,IAAW,CACtCG,EAAQ,UAAaC,GAAU,CAC7BL,EAAQK,EAAM,OAAO,MAAM,CAC7B,EACAD,EAAQ,QAAWI,GAAM,CACvBP,EAAOO,CAAC,CACV,CACF,CAAC,CACH,EACA,MAAM,WAAYC,EAAa,CAI7B,IAAML,GAHK,MAAMR,EAAW,GACL,YAAY,CAACE,CAAS,EAAG,WAAW,EAC3B,YAAYA,CAAS,EACzB,OAAOW,CAAG,EACtC,OAAO,IAAI,QAAQ,CAACT,EAASC,IAAW,CACtCG,EAAQ,UAAY,IAAM,CACxBJ,EAAQ,CACV,EACAI,EAAQ,QAAWI,GAAM,CACvBP,EAAOO,EAAE,OAAO,KAAK,CACvB,CACF,CAAC,CACH,EACA,MAAM,QAASC,EAAaC,EAAY,CAItC,IAAMN,GAHK,MAAMR,EAAW,GACL,YAAY,CAACE,CAAS,EAAG,WAAW,EAC3B,YAAYA,CAAS,EACzB,IAAIY,EAAOD,CAAG,EAC1C,OAAO,IAAI,QAAQ,CAACT,EAASC,IAAW,CACtCG,EAAQ,UAAY,IAAM,CACxBJ,EAAQ,CACV,EACAI,EAAQ,QAAWI,GAAM,CACvBP,EAAOO,EAAE,OAAO,KAAK,CACvB,CACF,CAAC,CACH,CACF,CACF,CACF,EAEaG,GAA2B,MAAOC,GAIV,CAGnC,IAAMC,EAAqBC,GAAOC,EAA0B,EACtDC,EAAuBC,GAAMJ,CAAkB,EAC/CK,EAAsBC,GAAaN,EAAoB,EAAI,EAC3DO,EAAsBD,GAAaN,EAAoB,EAAK,EAG5DQ,EAAOC,GAAa,EAMpBC,EAAwB,MAAMX,EAAwBI,EAAsBK,CAAI,EAGhFG,EAA8BC,GAAQF,EAAuBL,EAAqBF,CAAoB,EAE5G,MAAO,CACL,iBAAkB,CAChB,qBAAAA,EACA,KAAAK,EACA,4BAAAG,CACF,EACA,oBAAAJ,CACF,CACF,EAqBMM,GAAc/B,GAAY,eAAe,CAC7C,KAAM,eACN,UAAW,UACb,CAAC,EAGKgC,GAAN,cAAyB,KAAM,CAAC,EAEnBC,GAAuB,wBACvBC,GAAyB,iBAEtCC,EAAI,yBAA0B,CAC5B,cAAe,UAAY,CACzB,OAAOnC,GAAY,MAAM,CAC3B,EACA,sBAAuB,SAAUc,EAAaC,EAAwB,CAMpE,OAAOgB,GAAY,QAAQ,IAAMjB,EAAKC,CAAK,CAC7C,EACA,sBAAuB,SAAUD,EAA2B,CAC1D,OAAOiB,GAAY,QAAQ,IAAMjB,CAAG,CACtC,EACA,wBAAyB,SAAUA,EAA8B,CAC/D,OAAOiB,GAAY,WAAW,IAAMjB,CAAG,CACzC,EACA,+BAAgC,eAAgBA,EAAaC,EAAYqB,EAAmC,CAC1G,GAAM,CACJ,qBAAAf,EACA,KAAAK,EACA,4BAAAG,CACF,EAAIO,EAEEX,EAAsB,MAAMM,GAAY,QAAQ,IAAMV,CAAoB,EAChF,GAAI,CAACI,EAAqB,MAAM,IAAI,MAAM,sDAAsDJ,CAAoB,EAAE,EAEtH,IAAMgB,EAAiBP,GAAQL,EAAqB,KAAK,UAAUV,CAAK,EAAGD,CAAG,EAO9E,OAAOiB,GAAY,QAAQ,IAAMjB,EAAK,GAAG,KAAKO,CAAoB,CAAC,IAAI,KAAKK,CAAI,CAAC,IAAI,KAAKG,CAA2B,CAAC,IAAI,KAAKQ,CAAc,CAAC,EAAE,EAAE,QAAQ,IAAM,CAE9JF,EAAI,wBAAyBrB,CAAG,EAAE,MAAMD,GAAK,CAC3C,QAAQ,MAAM,yEAA0EC,EAAKD,CAAC,CAChG,CAAC,CACH,CAAC,CACH,EACA,+BAAgC,SAAUC,EAAaG,EAAiG,CACtJ,OAAOc,GAAY,QAAQ,IAAMjB,CAAG,EAAE,KAAK,MAAOwB,GAAmB,CACnE,GAAI,CAACA,GAAkB,OAAOA,GAAmB,SAC/C,MAAM,IAAIN,GAAW,+BAA+BlB,GAAO,EAAE,EAAE,EAGjE,GAAM,CAACO,EAAsBK,EAAMG,EAA6BU,CAAI,EAAID,EAAe,MAAM,GAAG,EAAE,IAAIE,GAAK,KAAKA,CAAC,CAAC,EAI5GZ,EAAwB,MAAMX,EAAwBI,EAAsBK,CAAI,EAGhFH,EAAsBkB,GAAQb,EAAuBC,EAA6BR,CAAoB,EAItGqB,EAA6BpB,GAAMC,CAAmB,EAC5D,GAAImB,IAA+BrB,EACjC,MAAM,IAAI,MAAM,kCAAkCA,CAAoB,YAAYqB,CAA0B,EAAE,EAIhH,IAAM3B,EAAQ,KAAK,MAAM0B,GAAQlB,EAAqBgB,EAAMzB,GAAO,EAAE,CAAC,EAItE,aAAMiB,GAAY,QAAQ,IAAMV,EAAsBE,CAAmB,EAElE,CACL,iBAAkB,CAChB,qBAAAF,EACA,KAAAK,EACA,4BAAAG,CACF,EACA,MAAAd,CACF,CACF,CAAC,EAAE,MAAM,MAAOF,GAAM,CAGpB,GAAI,CAACI,EAA2B,MAAMJ,EAGhCA,aAAamB,IACjB,QAAQ,KAAK,qCAAsCnB,CAAC,EAGtD,GAAM,CAAE,iBAAAuB,EAAkB,oBAAAX,CAAoB,EAAI,MAAMT,GAAyBC,CAAuB,EAGxG,aAAMc,GAAY,QAAQ,IAAMK,EAAiB,qBAAsBX,CAAmB,EAEnF,CACL,iBAAAW,EACA,MAAO,IACT,CACF,CAAC,CACH,EACA,0CAA2C,SAAU,CAAE,qBAAAf,CAAqB,EAAoB,CAC9F,OAAOU,GAAY,WAAW,IAAMV,CAAoB,CAC1D,EACA,iCAAkC,SAAUP,EAA8B,CACxE,OAAOiB,GAAY,WAAW,IAAMjB,CAAG,CACzC,CACF,CAAC,EASD,IAAM6B,GAAa3C,GAAY,eAAe,CAC5C,KAAM,eACN,UAAW,aACb,CAAC,EAEK4C,GAAiB,IAEvBT,EAAI,yBAA0B,CAC5B,wBAAyB,eAAgBU,EAAkBC,EAAwB,CACjF,GAAID,EAAS,WAAW,IAAI,EAAG,MAAM,IAAI,MAAM,aAAa,EAC5D,IAAME,EAAO,MAAMJ,GAAW,QAAQ,MAAM,GAAK,CAAC,EAQlD,OAAOR,EAAI,kCAAmC,cAAe,IACpDQ,GAAW,QAAQE,EAAUC,CAAI,EAAE,KAAK,MAAME,GAAK,CACxD,QAAQ,IAAI,sBAAuBH,CAAQ,EAC3C,IAAMI,EAAMF,EAAK,QAAQF,CAAQ,EAQjC,GAPII,IAAQ,IAEVF,EAAK,OAAOE,EAAK,CAAC,EAGpBF,EAAK,KAAKF,CAAQ,EAEdE,EAAK,OAASH,GAAgB,CAChC,IAAMM,EAAOH,EAAK,OAAO,EAAGA,EAAK,OAASH,EAAc,EACxD,MAAM,QAAQ,IAAIM,EAAK,IAAKrC,GAAM8B,GAAW,WAAW9B,CAAC,CAAC,CAAC,CAC7D,CAEA,MAAM8B,GAAW,QAAQ,OAAQI,CAAI,CACvC,CAAC,EAAE,MAAMlC,GAAK,CACZ,QAAQ,MAAM,gBAAiBgC,EAAUhC,CAAC,CAC5C,CAAC,CACF,CACH,EACA,wBAAyB,eAAgBgC,EAAiC,CACxE,GAAIA,EAAS,WAAW,IAAI,EAAG,MAAM,IAAI,MAAM,aAAa,EAC5D,IAAMM,EAAO,MAAMR,GAAW,QAAQE,CAAQ,EAC9C,OAAIM,GAEFhB,EAAI,kCAAmC,cAAe,SAAY,CAChE,IAAMY,EAAO,MAAMJ,GAAW,QAAQ,MAAM,GAAK,CAAC,EAC5CM,EAAMF,EAAK,QAAQF,CAAQ,EAC7BI,IAAQ,KAEVF,EAAK,OAAOE,EAAK,CAAC,EAClBF,EAAK,KAAKF,CAAQ,EAClB,MAAMF,GAAW,QAAQ,OAAQI,CAAI,EAEzC,CAAC,EAAE,MAAMlC,GAAK,CACZ,QAAQ,MAAM,6CAA6C,CAC7D,CAAC,EAEMsC,CACX,EACA,0BAA2B,eAAgBN,EAAiC,CAC1E,GAAIA,EAAS,WAAW,IAAI,EAAG,MAAM,IAAI,MAAM,aAAa,EAC5D,MAAMF,GAAW,WAAWE,CAAQ,EAEpCV,EAAI,kCAAmC,cAAe,SAAY,CAChE,IAAMY,EAAO,MAAMJ,GAAW,QAAQ,MAAM,GAAK,CAAC,EAC5CM,EAAMF,EAAK,QAAQF,CAAQ,EAC7BI,IAAQ,KACVF,EAAK,OAAOE,EAAK,CAAC,EAClB,MAAMN,GAAW,QAAQ,OAAQI,CAAI,EAEzC,CAAC,EAAE,MAAMlC,GAAK,CACZ,QAAQ,MAAM,+CAA+C,CAC/D,CAAC,CACH,EACA,yBAA0B,gBAAiC,CACzD,MAAM8B,GAAW,MAAM,CACzB,CACF,CAAC,EAMD,IAAMS,GAAUpD,GAAY,eAAe,CACzC,KAAM,eACN,UAAW,SACb,CAAC,EAEDmC,EAAI,yBAA0B,CAC5B,qBAAsB,SAAUrB,EAAaC,EAAwB,CACnE,OAAOqC,GAAQ,QAAQtC,EAAKC,CAAK,CACnC,EACA,qBAAsB,SAAUD,EAA2B,CACzD,OAAOsC,GAAQ,QAAQtC,CAAG,CAC5B,EACA,uBAAwB,SAAUA,EAA8B,CAC9D,OAAOsC,GAAQ,WAAWtC,CAAG,CAC/B,EACA,sBAAuB,UAA0B,CAC/C,OAAOsC,GAAQ,MAAM,CACvB,CACF,CAAC,EAMD,IAAMC,GAAOrD,GAAY,eAAe,CACtC,KAAM,eACN,UAAW,MACb,CAAC,EAEDmC,EAAI,yBAA0B,CAC5B,kBAAmB,SAAUrB,EAAaC,EAAwB,CAChE,OAAOsC,GAAK,QAAQvC,EAAKC,CAAK,CAChC,EACA,kBAAmB,SAAUD,EAA2B,CACtD,OAAOuC,GAAK,QAAQvC,CAAG,CACzB,EACA,oBAAqB,SAAUA,EAA8B,CAC3D,OAAOuC,GAAK,WAAWvC,CAAG,CAC5B,EACA,mBAAoB,UAA0B,CAC5C,OAAOuC,GAAK,MAAM,CACpB,CACF,CAAC,ECnbM,SAASC,GAAmBC,EAAiC,CAClE,OAAO,SAAUC,EAAW,CAC1B,GAAI,CAACA,EAAE,GAAI,CACT,IAAMC,EAAM,GAAGD,EAAE,MAAM,KAAKA,EAAE,UAAU,GAIxC,MAAIA,EAAE,SAAW,KAAOA,EAAE,SAAW,IAAW,IAAIE,GAAsBD,EAAK,CAAE,MAAOD,EAAE,MAAO,CAAC,EAC5F,IAAIG,GAAoCF,CAAG,CACnD,CACA,OAAOD,EAAED,CAAI,EAAE,CACjB,CACF,CCkBA,IAAMK,GAAoB,CAACC,EAAoBC,EAAUC,IAA2B,CAElF,GAAI,CAACA,EAAe,MAAO,CAAC,EAE5B,GAAI,CAEF,IAAMC,EAAa,KAAK,MAAMD,CAAa,EAGrCE,EAAgBC,GAAgCJ,EAAKE,EAAY,wBAAwBH,CAAU,EAAE,EAK3G,OAFoB,KAAK,MAAMI,EAAc,QAAQ,CAAC,CAGxD,OAASE,EAAO,CAEd,QAAQ,MAAM,8CAA+CA,CAAK,CACpE,CAGF,EAUMC,GAAoB,MAAOC,EAA4BC,EAA0BR,IAAa,CAClG,GAAI,CAEF,IAAMS,EAAS,MAAM,MAAM,GAAGC,EAAI,qBAAsB,SAAS,CAAC,SAASF,CAAgB,EAAE,EAAE,KAAKG,GAAkB,MAAM,CAAC,EAGvHC,GAAW,IAAM,CACrB,IAAMC,EAAOC,GAAsBL,CAAM,EACnCM,EAAO,KAAK,MAAMF,EAAK,IAAI,MAAM,CAAC,EACxC,GAAIE,EAAK,aAAeR,EACtB,MAAM,IAAI,MAAM,yBAAyB,EAE3C,GAAI,CAAC,CAACS,EAAU,UAAWA,EAAU,aAAa,EAAE,SAASD,EAAK,EAAE,EAClE,MAAM,IAAI,MAAM,uBAAyBA,EAAK,EAAE,EAUlD,OANiBA,EAAK,KAAOC,EAAU,cACnC,CAAC,CAACA,EAAU,cAAeH,EAAK,QAAQ,CAAC,CAAC,EAC1CA,EAAK,QAAQ,GAKd,OAAO,CAAC,CAACI,CAAE,IAAMA,IAAOD,EAAU,aAAa,EAC/C,QAAQ,CAAC,CAAC,CAAEE,CAAI,IAAMA,CAAI,EAC1B,KAAMC,GAAQA,EAAI,OAAS,OAASA,EAAI,MAAM,SAAS,OAAO,GAC7D,KAAK,QAAQ,OACnB,GAAG,EAGEP,GACH,QAAQ,MAAM,+FAA+F,EAI/G,IAAMQ,EAAgBtB,GAAkBS,EAAoBP,EAAKY,CAAO,EAGxE,GAAI,CAACQ,EACH,QAAQ,MAAM,kGAAkG,MAC3G,CAEL,IAAMC,EAAaD,EAAc,IAAID,IAAQ,CAAE,IAAKG,GAAeH,CAAG,EAAG,UAAW,EAAK,EAAE,EAG3F,MAAMT,EAAI,2BAA4B,IAAIa,GAAOF,CAAU,CAAC,CAC9D,CACF,OAAShB,EAAO,CACd,QAAQ,MAAM,6DAA8DA,CAAK,CACnF,CACF,EAYMmB,GAAkB,CAACzB,EAAoBC,EAAayB,EAAgBxB,IAA2B,CAEnG,IAAMW,EAAUd,GAAkBC,EAAY0B,EAAQxB,CAAa,EAGnE,GAAI,CAACW,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,IAAMc,EAAU,IAAI,IAAId,CAAO,EAGzBe,EAAmBC,GAAaH,EAAQ,EAAI,EAClD,OAAAC,EAAQ,IAAIC,CAAgB,EAGJE,GACtB7B,EAEA,KAAK,UAAU,MAAM,KAAK0B,CAAO,CAAC,CACpC,EAAE,SAAS,wBAAwB3B,CAAU,EAAE,CAGjD,EAGAW,EAAI,sBAAuBoB,GAAe,CAAC/B,EAAYgC,IAAY,CACjE,IAAMxB,EAAqBG,EAAI,kBAAkB,EAAE,UAAU,mBAGzDX,IAAeQ,GAAsB,CAAC,CAACS,EAAU,UAAWA,EAAU,aAAa,EAAE,SAASe,EAAQ,OAAO,CAAC,GAIhGrB,EAAI,uCAAwCH,EAAoB,MAAO,EAAI,IAK7F,QAAQ,KAAK,gEAAiEA,CAAkB,EAChGG,EAAI,4BAA4B,EAAE,MAAMsB,GAAK,CAC3C,QAAQ,MAAM,wCAAyCA,CAAC,CAC1D,CAAC,EACH,CAAC,EAED,IAAOC,GAASvB,EAAI,yBAA0B,CAC5C,6BAA8B,eAAgB,CAC5C,IAAKwB,EACL,IAAKC,EACL,eAAAC,EACA,SAAAC,EACA,MAAAC,EACA,QAAAC,EACA,MAAAC,CACF,EAAG,CACD,IAAIC,EAAe,GAAG,KAAK,SAAS,MAAM,yCAG1CP,EAAOA,EAAK,QAAQ,EACpBC,EAAOA,EAAK,QAAQ,EAEpB,IAAMO,EAAM,OAAOR,GAAS,SAAWZ,GAAeY,CAAI,EAAIA,EACxDlC,EAAM,OAAOmC,GAAS,SAAWb,GAAea,CAAI,EAAIA,EAExDQ,EAAgB,gBAAkBC,GAAa,EAC/CC,EAAoBC,GAAYH,CAAa,EAG7CI,EAAMC,GAAOC,EAAuB,EACpCC,EAAMF,GAAOG,EAA0B,EACvCC,EAAMJ,GAAOG,EAA0B,EACvCE,EAAML,GAAOC,EAAuB,EAGpCK,EAAQC,GAAMb,CAAG,EACjBc,EAAQD,GAAMvD,CAAG,EACjByD,EAAQF,GAAMR,CAAG,EACjBW,EAAQH,GAAML,CAAG,EACjBS,EAAQJ,GAAMH,CAAG,EACjBQ,EAAQL,GAAMF,CAAG,EAGjBQ,EAAOjC,GAAac,EAAK,EAAK,EAC9BoB,EAAOlC,GAAa5B,EAAK,EAAK,EAC9B+D,GAAOnC,GAAamB,EAAK,EAAK,EAC9BiB,GAAOpC,GAAasB,EAAK,EAAK,EAC9Be,GAAOrC,GAAawB,EAAK,EAAK,EAC9Bc,GAAOtC,GAAayB,EAAK,EAAK,EAG9Bc,GAAOtC,GAAgC7B,EAAK4B,GAAamB,EAAK,EAAI,CAAC,EACnEqB,GAAOvC,GAAgC7B,EAAK4B,GAAasB,EAAK,EAAI,CAAC,EACnEmB,GAAOxC,GAAgCqB,EAAKtB,GAAawB,EAAK,EAAI,CAAC,EACnEkB,GAAOzC,GAAgC7B,EAAK4B,GAAayB,EAAK,EAAI,CAAC,EACnEkB,GAAyB1C,GAAgC7B,EAAK2C,CAAa,EAGjF,MAAMjC,EAAI,2BACR,IAAIa,GAAO,CAACmB,EAAK1C,EAAKkD,EAAKH,EAAKK,EAAKC,CAAG,EAAE,IAAIlC,KAAQ,CAAE,IAAAA,GAAK,UAAW,EAAK,EAAE,CAAC,CAClF,EAEA,IAAIqD,GAEJ,GAAI,CACF,MAAM9D,EAAI,gCAAiC,CACzC,aAAc,wBACd,eAAgB,CACd,GAAG0B,EACH,QAAS,CACP,GAAGA,GAAgB,QACnB,gCAAiCS,EACjC,iCAAkCR,EAClC,kCAAmCG,EAAM,QAAQ,CACnD,CACF,EACA,aAAcc,EACd,mBAAoBG,EACpB,sBAAuBE,EACvB,KAAM,CACJ,CACE,GAAIL,EACJ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,IACb,eAAgB,IAChB,KAAM,CACJ,QAAS,CACP,UAAW,EACb,CACF,EACA,KAAMO,CACR,EACA,CACE,GAAIL,EACJ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EAIX,YAAa,CAAC,+BAA+B,EAC7C,KAAM,CACJ,QAAS,CACP,UAAW,EACb,CACF,EACA,KAAMM,CACR,EACA,CACE,GAAIL,EACJ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAACzC,EAAU,WAAYA,EAAU,WAAYA,EAAU,sBAAuBA,EAAU,oBAAqBA,EAAU,UAAWA,EAAU,iBAAkBA,EAAU,mBAAoBA,EAAU,aAAcA,EAAU,cAAeA,EAAU,oBAAsB,QAAQ,EAClS,eAAgB,IAChB,KAAM,CACJ,QAAS,CACP,QAASmD,EACX,CACF,EACA,KAAMJ,EACR,EACA,CACE,GAAIL,EACJ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAAC1C,EAAU,oBAAqBA,EAAU,WAAYA,EAAU,WAAYA,EAAU,eAAgBA,EAAU,oBAAqBA,EAAU,aAAcA,EAAU,aAAa,EACjM,eAAgB,IAChB,KAAM,CACJ,QAAS,CACP,QAASoD,EACX,CACF,EACA,KAAMJ,EACR,EACA,CACE,GAAIL,EACJ,KAAM,MACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAAC3C,EAAU,mBAAmB,EAC3C,eAAgB,CAAC,mCAAmC,EACpD,KAAM,CACJ,QAAS,CACP,QAASqD,EACX,CACF,EACA,KAAMJ,EACR,EACA,CACE,GAAIL,EACJ,KAAM,OACN,QAAS,CAAC,KAAK,EACf,UAAW,EACX,YAAa,CAAC,EACd,eAAgB,CAAC,EACjB,KAAM,CACJ,QAAS,CACP,QAASU,EACX,CACF,EACA,KAAMJ,EACR,CACF,EACA,MAAO,CACL,oBAAqB,MAAOnC,IAAY,CAEtC,MAAMrB,EAAI,2BAA4BqB,GAAQ,WAAW,EAAG,CAAE,UAAW,EAAK,CAAC,EAE/E,GAAI,CAEF,GADAyC,GAASzC,GAAQ,WAAW,EACxBQ,EACF,GAAI,CACFE,EAAe,MAAMgC,GAAYlC,EAAS,CAAE,mBAAoBiC,EAAO,CAAC,CAC1E,OAASxC,GAAG,CACV,cAAQ,MAAM,4CAA6CA,EAAC,EACtD,IAAI0C,GAAsBC,EAAE,oDAAqD,CAAE,UAAW3C,GAAE,OAAQ,CAAC,EAAG,CAAE,MAAOA,EAAE,CAAC,CAChI,CAEJ,QAAE,CACA,MAAMtB,EAAI,4BAA6BqB,GAAQ,WAAW,EAAG,CAAE,UAAW,EAAK,CAAC,CAClF,CACF,CACF,EACA,KAAM,CAIJ,WAAY,CACV,SAAAM,EACA,MAAAC,EACA,IAAI,SAAW,CAAE,OAAOG,CAAa,EACrC,uBAAwB8B,GAAuB,UAAU,wBAAwB,CACnF,CACF,CACF,CAAC,EAGD,MAAM7D,EAAI,2BACR,IAAIa,GAAO,CAAC2B,EAAKH,EAAKK,EAAKC,CAAG,EAAE,IAAIlC,KAAQ,CAAE,IAAAA,EAAI,EAAE,CAAC,CACvD,EAEAT,EAAI,oCAAqC,CAAC8C,EAAOF,CAAK,CAAC,CACzD,OAAStB,GAAG,CACV,cAAQ,MAAM,qCAAsCA,EAAC,EAC/C,IAAI0C,GAAsBC,EAAE,gDAAiDC,GAAO5C,EAAC,CAAC,EAAG,CAAE,MAAOA,EAAE,CAAC,CAC7G,QAAE,CAEA,MAAMtB,EAAI,oCAAqC,CAAC8C,EAAOF,CAAK,CAAC,CAC/D,CACA,OAAOkB,EACT,EACA,4BAA6B,SAAU,CAAE,mBAAAjE,EAAoB,iBAAAsE,EAAkB,cAAAC,EAAe,MAAAC,EAAO,oBAAAC,EAAqB,iBAAAxE,CAAiB,EAAG,CAS5I,OAAOE,EAAI,kCAAmC,gBAAiB,SAAY,CACzE,QAAQ,MAAM,sDAAuDH,CAAkB,EACvFyE,EAAsBA,EAAoB,QAAQ,EAAE,IAAIC,IAAM,CAAE,IAAK3D,GAAe2D,CAAC,EAAG,UAAW,EAAK,EAAE,EAGtG,OAAO,mBAAsB,YAC/B,MAAMvE,EAAI,sBAAuBH,CAAkB,EAErD,MAAMG,EAAI,iBAAkB,CAAE,GAAGoE,EAAe,SAAU,CAAE,mBAAAvE,CAAmB,CAAE,CAAC,EAClF,MAAMG,EAAI,2BAA4B,IAAIa,GAAOyD,CAAmB,CAAC,EAEjExE,GACF,MAAMF,GAAkBC,EAAoBC,EAAkBwE,EAAoB,CAAC,EAAE,GAAG,EAG1F,GAAI,CAeGF,GAAe,UAAUvE,CAAkB,GAAG,WAUjD,MAAMG,EAAI,yBAA0BH,CAAkB,EAJtD,MAAMG,EAAI,2BAA4BH,CAAkB,CAM5D,OAASyB,EAAG,CACV,cAAQ,MAAM,yDAA0DA,CAAC,EACnE,IAAI0C,GAAsBC,EAAE,kCAAkC,EAAG,CAAE,MAAO3C,CAAE,CAAC,CACrF,CAEA,GAAI,CACF,MAAMtB,EAAI,sBAAuBwE,GAAsB3E,CAAkB,EACzEG,EAAI,wBAAyByE,GAAO,CAAE,mBAAA5E,EAAoB,iBAAAsE,EAAkB,MAAAE,CAAM,CAAC,EAEnF,IAAMK,EAAcC,GAAqBP,GAAe,SAAS,EACjE,MAAMQ,GAAqBF,CAAW,EAEtC,GAAI,CAEF,IAAMN,EAAgBpE,EAAI,oBAAoB,EAGxC6E,EAAW,OAAO,KAAKT,EAAcvE,CAAkB,EAAE,MAAM,EAKrE,MAAMG,EAAI,yBAA0B,MAAM,KAAK,IAAI,IAAI,CAAC,GAAG6E,EAAU,GAAG,OAAO,OAAOH,CAAW,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,EAG5G,MAAM,QAAQ,WACZG,EAAS,IAAI,MAAMC,GAGjBC,EAAIX,EAAc,UAAWU,CAAO,GACpCC,EAAIX,EAAcvE,CAAkB,EAAE,OAAQiF,CAAO,GAOrDV,EAAcU,CAAO,GAAG,WAAWjF,CAAkB,GAAG,SAAWmF,GAAe,QAElFhF,EAAI,wBAAyB,CAC3B,sBAAuBH,EACvB,wBAAyB,wBACzB,WAAYiF,EACZ,aAAc,qBACd,UAAWV,EAAcvE,CAAkB,EAAE,OAAOiF,CAAO,EAAE,KAC7D,aAAcV,EAAcvE,CAAkB,EAAE,OAAOiF,CAAO,EAAE,eAChE,kBAAmB,MAAM9E,EAAI,uCAAwCH,EAAoB,KAAK,EAC9F,gBAAiB,MAAMG,EAAI,uCAAwCH,EAAoB,KAAK,CAC9F,CAAC,EAAE,MAAOyB,GAAM,CACd,QAAQ,MAAM,0CAA0CwD,CAAO,YAAaxD,CAAC,EAC7E,IAAM2D,EAAWhB,EAAE,uCAAwC,CAAE,IAAK3C,GAAG,SAAW,eAAgB,CAAC,EACjG,MAAM,IAAI0C,GAAsBiB,CAAQ,CAC1C,CAAC,CACF,CACH,EAIA,OAAO,QAAQb,EAAcvE,CAAkB,EAAE,MAAM,EAEpD,OAAO,CAAC,CAAC,CAAE,CAAE,QAAAqF,CAAQ,CAAC,IAAM,CAACA,CAAO,EACpC,QAAQ,CAAC,CAACC,CAAG,IAAM,CAGdf,EAAce,CAAG,GAAG,WAAWtF,CAAkB,GAAG,SAAWmF,GAAe,QAChFhF,EAAI,yCAA0C,CAAE,WAAYmF,EAAK,SAAU,EAAM,CAAC,EAAE,MAAO7D,GAAM,QAAQ,MAAM,mCAAoCA,CAAC,CAAC,CAEzJ,CAAC,CACL,OAASA,EAAG,CACV,cAAQ,MAAM,kEAAmEA,CAAC,EAC5EA,CACR,CAEA,OAAOzB,CACT,OAASyB,EAAG,CACVtB,EAAI,oCAAqCsE,EAAoB,IAAI,CAAC,CAAE,IAAA7D,CAAI,IAAMoC,GAAMpC,CAAG,CAAC,CAAC,EACzF,QAAQ,MAAM,oCAAqCa,CAAC,EACpD,IAAM2D,EAAWhB,EAAE,kCAAmCC,GAAO5C,CAAC,CAAC,EAC/D,YAAMtB,EAAI,qCAAqC,EAC5C,MAAOsB,GAAM,CACZ,QAAQ,MAAM,4EAA6EA,CAAC,CAC9F,CAAC,EACG,IAAI0C,GAAsBiB,EAAU,CAAE,MAAO3D,CAAE,CAAC,CACxD,CACF,CAAC,CACH,EAIA,sCAAuC,gBAAkB,CACvD,IAAI8C,EACJpE,EAAI,wBAAyBoF,EAAW,EACxC,GAAI,CACF,QAAQ,KAAK,kDAAkD,EAW/D,MAAMpF,EAAI,kCAAmC,mBAAoB,IAAM,CAAC,CAAC,EAEzEoE,EAAgB,MAAMpE,EAAI,iBAAkB,SAAY,CAStD,MAAMA,EAAI,kCAAmC,mBAAoB,IAAM,CAAC,CAAC,EAGzE,MAAMA,EAAI,kCAAmCqF,GAAU,IAAM,CAAC,CAAC,EAG/D,IAAMjB,EAAgB,MAAMpE,EAAI,kCAAmCsF,GAAwB,SAAY,CACrG,IAAMlB,EAAgBmB,GAAUvF,EAAI,oBAAoB,CAAC,EACzD,aAAMA,EAAI,wBAAyBsF,EAAsB,EAClDlB,CACT,CAAC,EACD,aAAMpE,EAAI,sBAAuBwE,GAAsB,IAAI,EAEpDJ,CACT,CAAC,EAAE,KAAMA,IACP,QAAQ,KAAK,yBAAyB,EAE/BA,EACR,CACH,OAAS9C,EAAG,CACV,QAAQ,MAAM,GAAGA,EAAE,IAAI,mBAAmBA,EAAE,OAAO,GAAIA,CAAC,CAC1D,CAEA,OAAAtB,EAAI,wBAAwB,EAAE,MAAOsB,GAAM,CAAE,QAAQ,MAAM,4BAA6BA,CAAC,CAAE,CAAC,EAExF,OAAO,mBAAsB,YAE/BtB,EAAI,sBAAuB,CAAE,QAAS,EAAK,CAAC,EAAE,MAAOsB,GAAM,CAAE,QAAQ,MAAM,4BAA6BA,CAAC,CAAE,CAAC,EAE9GtB,EAAI,wBAAyBwF,EAAM,EAC5BpB,CACT,EACA,8CAA+C,MAAO/E,EAAYoG,EAAmBC,IAAY,CAC/F,IAAM7C,EAAQ,MAAM7C,EAAI,uCAAwCyF,EAAmBC,CAAO,EACpF1C,EAAQ,MAAMhD,EAAI,uCAAwCX,EAAY,KAAK,EAC3EsG,EAAuB3F,EAAI,0BAA2ByF,CAAiB,EAI7E,GAAI,EAFwB,MAAMzF,EAAI,4CAA6CX,EAAYoG,CAAiB,IAEvF,SAAS5C,CAAK,EAIvC,OAAO,MAAM7C,EAAI,sBAAuB,CACtC,WAAAX,EACA,aAAc,wBACd,KAAM,CAACuG,GAAsBvG,EAAY2D,EAAO,CAC9C,WAAY,WAAW,mBAAmByC,CAAiB,CAAC,YAAY,mBAAmBC,CAAO,CAAC,GACnG,GAAI7C,EACJ,KAAM8C,EAAqB,IAAI,eAAe9C,CAAK,EAAE,KAGrD,YAAa,CAACvC,EAAU,oBAAsB,QAAQ,EACtD,eAAgB,CAAC,+CAA+C,EAChE,QAAS,CAAC,KAAK,EACf,UAAW,OAAO,iBAClB,KAAM,GAAGmF,CAAiB,IAAI5C,CAAK,EACrC,CAAC,CAAC,EACF,aAAc7C,EAAI,uCAAwCX,EAAY,CAACiB,EAAU,UAAU,EAAG,CAAC,KAAK,CAAC,CACvG,CAAC,CACH,EACA,kCAAmC,MAAOjB,EAAoBwG,IAAY,CACxE,IAAMC,EAAY9F,EAAI,oBAAoB,EACpCqE,EAAQyB,EAAUzG,CAAU,EA+ClC,GA7CA,MAAM,QAAQ,IAAI,OAAO,KAAKgF,EAAM,QAAU,CAAC,CAAC,EAAE,OAAO0B,GAAW,CAAC1B,EAAM,OAAO0B,CAAO,EAAE,SAAW,CAAC,CAACD,EAAU,UAAUC,CAAO,CAAC,EAAE,IAAI,MAAMA,GAAW,CACzJ,IAAM/C,EAAQ,MAAMhD,EAAI,uCAAwC+F,EAAS,KAAK,EACxEhD,EAAQ,MAAM/C,EAAI,uCAAwC+F,EAAS,KAAK,EAE9E,GAAI,CAAC/C,GAAS,CAACD,EAAO,CACpB,QAAQ,KAAK,oCAAoC1D,CAAU,SAAS0G,CAAO,sBAAsB,EAGjG,MACF,CACA,OAAO/F,EAAI,wBAAyB,CAClC,WAAY+F,EACZ,aAAcD,EAAU,UAAUC,CAAO,EAAE,KAC3C,KAAMH,GAAsBG,EAAS/C,EAAO,CAC1C,WAAY+C,EAEZ,KAAM,OAAO,OAAOF,CAAO,EAAE,IAAI,CAAC,CAAC,CAAEG,EAAQC,CAAK,KAA2B,CAC3E,GAAIA,EACJ,KAAM,CACJ,QAAS,CACP,QAASL,GAAsBG,EAAS/C,EAAO9B,GAAa8E,EAAQ,EAAI,CAAC,CAC3E,CACF,CACF,EAAE,CACJ,CAAC,EACD,aAAcjD,EACd,MAAO,CACL,aAAc,CAACmD,EAAG7B,IAETA,GAAO,WAAWhF,CAAU,GAAG,SAAW2F,GAAe,MAEpE,CACF,CAAC,EAAE,MAAM1D,GAAK,CAGZ,GAAIA,EAAE,OAAS,gCACb,MAAMA,CAEV,CAAC,CACH,CAAC,CAAC,EAME,EAACuE,EAAQ,IACb,MAAO,CACL,OACA,CAEE,MAAM7F,EAAI,oCAAqC,CAC7C,WAAAX,EACA,KAAMgF,EAAM,WACZ,cAAewB,EAAQ,IAAI,CAAC,EAC5B,gBAAiBA,EAAQ,IAAI,CAAC,EAC9B,iBAAkB,EACpB,CAAC,CACH,CACF,CACF,EACA,GAAGM,GAAgB,oCAAqClC,EAAE,mCAAmC,EAAG,OAAW,KAAK,EAChH,GAAGkC,GAAgB,qCAAsClC,EAAE,oCAAoC,CAAC,EAChG,GAAGkC,GAAgB,0CAA2ClC,EAAE,gDAAgD,EAAG,eAAgBmC,EAAaC,EAAQ,CACtJ,IAAMC,EAActG,EAAI,oBAAoB,EACtCuG,EAAaF,EAAO,KAAK,UAC5B,OAAOG,GAAYA,IAAaF,EAAY,qBAAqB,EACjE,IAAIE,GAAYF,EAAY,uBAAuBE,CAAQ,EAAE,UAAU,EACpEC,EAAiBJ,EAAO,KAAK,eAC7BxG,EAAqByG,EAAY,sBAEjCjF,EAAU,MAAMrB,EAAI,6BAA8B,CACtD,KAAM,CACJ,WAAY,CACV,KAAM,GACN,YAAa,GACb,aAAc0G,GAAuB,QACrC,KAAMC,GAAe,cACvB,CACF,EACA,MAAO,CACL,WAAYN,EAAO,OAAO,WAC1B,YAAa,IACf,CACF,EAAGxG,CAAkB,EAGrB,MAAMG,EAAI,mCAAoC,CAC5C,WAAYH,EACZ,aAAc,wBACd,kBAAmBwB,EAAQ,WAAW,EACtC,OAAQ,GACV,CAAC,EAED,MAAMrB,EAAI,2BAA4B,CACpC,GAAG4G,GAAKP,EAAQ,CAAC,UAAW,aAAc,OAAQ,OAAO,CAAC,EAC1D,WAAYhF,EAAQ,WAAW,EAC/B,KAAM,CAAE,SAAU,CAACxB,EAAoB,GAAG0G,CAAU,CAAE,CACxD,CAAC,EAED,IAAMM,EAA4BxH,GAAuB,CACnDA,IAAegC,EAAQ,WAAW,GAChCrB,EAAI,0BAA2BqB,EAAQ,WAAW,CAAC,GAAG,UAAUxB,CAAkB,IACpFG,EAAI,wBAAyB8G,GAAiB,CAAE,mBAAAjH,EAAoB,gBAAiB4G,EAAgB,WAAYpF,EAAQ,WAAW,CAAE,CAAC,EACvIrB,EAAI,uBAAwBoB,GAAeyF,CAAwB,EAGzE,EACA7G,EAAI,sBAAuBoB,GAAeyF,CAAwB,EAElE,MAAMT,EAAY,CAChB,GAAGQ,GAAKP,EAAQ,CAAC,UAAW,OAAQ,SAAU,OAAO,CAAC,EACtD,KAAM,CACJ,WAAYhF,EAAQ,WAAW,CACjC,EACA,MAAO,CACL,YAAagF,EAAO,OAAO,WAC7B,CACF,CAAC,EAED,QAASU,EAAQ,EAAGA,EAAQR,EAAW,OAAQQ,IAAS,CACtD,IAAMC,EAAQD,EAAQR,EAAW,OAAS,EAAI,OAAY,CAAE,WAAY,KAAM,YAAaF,EAAO,OAAO,WAAY,EAKrH,MAAMrG,EAAI,mCAAoC,CAC5C,WAAYuG,EAAWQ,CAAK,EAC5B,aAAc,wBACd,kBAAmB1F,EAAQ,WAAW,EACtC,OAAQ,GACV,CAAC,EAED,MAAMrB,EAAI,wCAAyC,CACjD,GAAG4G,GAAKP,EAAQ,CAAC,UAAW,aAAc,OAAQ,OAAO,CAAC,EAC1D,WAAYE,EAAWQ,CAAK,EAC5B,KAAM,CAGJ,WAAY1F,EAAQ,WAAW,CACjC,EAGA,aAAc,MAAMrB,EAAI,uCAAwCuG,EAAWQ,CAAK,EAAG,CAACzG,EAAU,mBAAmB,EAAG,CAAC,KAAK,EAAG,OAAW,CAAC,yCAAyC,CAAC,EACnL,uBAAwBmG,EACxB,MAAAO,CACF,CAAC,CACH,CAEA,OAAO3F,EAAQ,WAAW,CAC5B,CAAC,EACD,GAAG8E,GAAgB,wCAAyClC,EAAE,kCAAkC,CAAC,EACjG,GAAGkC,GAAgB,gCAAiClC,EAAE,yBAAyB,CAAC,EAChF,GAAGkC,GAAgB,iCAAkClC,EAAE,0BAA0B,CAAC,EAClF,GAAGkC,GAAgB,iDAAkDlC,EAAE,0CAA0C,CAAC,EAClH,kCAAmC,MAAO,CAAE,YAAAgD,EAAa,mBAAAC,CAAmB,IAEtE,CACJ,GAAM,CAAE,mBAAArH,CAAmB,EAAIG,EAAI,kBAAkB,EAAE,SACvD,GAAI,CACF,IAAMmH,EAAkB,MAAM,QAAQ,IAAIF,EAAY,IAAI,MAAOG,GAAe,CAC9E,GAAM,CAAE,IAAAC,EAAK,eAAAC,CAAe,EAAIF,EAE1BG,EAAiBD,GAAkB,MAAME,GAAgBH,CAAG,EAE5DI,EAAW,MAAMzH,EAAI,sBAAuBuH,EAAgB,CAChE,KAAMH,EAAW,SACjB,OAAQ,WACV,EAAG,CAAE,mBAAAF,CAAmB,CAAC,EACnB,CAAE,OAAQpF,EAAO,SAAU4F,CAAa,EAAID,EAClD,MAAO,CACL,WAAYb,GAAKQ,EAAY,CAAC,MAAO,iBAAkB,uBAAuB,CAAC,EAC/E,aAAAM,EACA,WAAY,CAAE,MAAA5F,CAAM,CACtB,CACF,CAAC,CAAC,EAEI6F,EAAsBR,EAAgB,IAAI,CAAC,CAAE,aAAAO,EAAc,WAAAE,CAAW,KAAO,CACjF,YAAaF,EAAa,YAC1B,MAAOE,EAAW,KACpB,EAAE,EAEF,aAAM5H,EAAI,0CAA2C,CACnD,WAAYH,EACZ,KAAM,CAAE,mBAAAqH,EAAoB,oBAAAS,CAAoB,CAClD,CAAC,EAEMR,EAAgB,IAAI,CAAC,CAAE,WAAAU,EAAY,aAAAH,CAAa,KAAO,CAAE,GAAGG,EAAY,aAAAH,CAAa,EAAE,CAChG,OAASI,EAAK,CACZ,IAAM7C,EAAWhB,EAAE,wCAAyCC,GAAO4D,CAAG,CAAC,EACvE,MAAM,IAAI9D,GAAsBiB,CAAQ,CAC1C,CACF,EACA,kCAAmC,MAAO,CAAE,aAAA8C,EAAc,OAAAC,CAAO,IAE3D,CACJ,GAAM,CAAE,mBAAAnI,CAAmB,EAAIG,EAAI,kBAAkB,EAAE,SACjD,CAAE,iBAAAiI,EAAkB,kBAAAC,EAAmB,oBAAAC,CAAoB,EAAIH,EACjEI,EAAcC,EAEZC,EAAuB,MAAMtI,EAAI,0BAA2BH,CAAkB,EAEpF,GAAIoI,EAAkB,CACpB,IAAMM,EAAc,OAAO,YAAYR,EAAa,IAAIS,GAAO,CAG7D,GAAI,CAACL,GAAuBD,GAAqB,CAACI,EAAqB,iBAAiBE,CAAG,EACzF,eAAQ,KAAK,sEAAuEA,CAAG,EAChF,CAACA,EAAK,IAAI,EAEnB,IAAMC,EAAaP,EACf,CAAE,MAAOI,EAAqB,iBAAiBE,CAAG,EAAE,KAAM,EAC1D,CAAE,mBAAoB3I,CAAmB,EAC7C,MAAO,CAAC2I,EAAKC,CAAU,CACzB,CAAC,CAAC,EACFJ,EAAYF,EAAyEJ,EAAnDA,EAAa,OAAQS,GAAQ,CAAC,CAACD,EAAYC,CAAG,CAAC,EACjFJ,EAAe,MAAMpI,EAAI,sBAAuBqI,EAAUE,CAAW,CACvE,MACEF,EAAWN,EAgBb,GAbIG,GACF,MAAMlI,EAAI,4CAA6C,CACrD,WAAYH,EACZ,KAAM,CACJ,aAAcuI,EACVC,EAAS,OAAO,CAACnC,EAAGwC,IACbN,EAAaM,CAAC,EAAE,SAAW,WACnC,EACCL,CACN,CACF,CAAC,EAGCD,GAAc,KAAKO,GAAKA,EAAE,SAAW,UAAU,EACjD,cAAQ,MAAM,mEACZP,GAAc,IAAI,CAACO,EAAGD,IAAMC,EAAE,SAAW,YAAcN,EAASK,CAAC,CAAC,EAAE,OAAO,OAAO,CAAC,EAC/E,IAAI,MAAM,gCAAgC,CAEpD,EACA,6BAA8B,IAAIrC,IACzBrG,EAAI,kCAAmC,gBAAiB,CAAC,sCAAuC,GAAGqG,CAAM,CAAC,EAEnH,qCAAsC,MAAO,CAC3C,mBAAAxG,EACA,SAAA8B,EACA,OAAAiH,EACA,OAAA7H,EACA,OAAQiB,EACR,OAAQ1C,EACR,YAAAuJ,EACA,MAAA7B,CACF,IAAM,CACJ4B,EAASA,EAAO,QAAQ,EACxB7H,EAASA,EAAO,QAAQ,EACxBiB,EAAMA,EAAI,QAAQ,EAClB1C,EAAMA,EAAI,QAAQ,EAClBuJ,EAAcA,EAAY,QAAQ,EAGlC,IAAMxG,EAAMC,GAAOC,EAAuB,EACpCC,EAAMF,GAAOG,EAA0B,EACvCE,EAAML,GAAOC,EAAuB,EAGpCuG,EAAWjG,GAAM+F,CAAM,EACvBG,EAAWlG,GAAM9B,CAAM,EACvB6B,EAAQC,GAAMb,CAAG,EACjBc,EAAQD,GAAMvD,CAAG,EACjByD,EAAQF,GAAMR,CAAG,EACjBW,EAAQH,GAAML,CAAG,EACjBU,EAAQL,GAAMF,CAAG,EAGjBQ,EAAOjC,GAAac,EAAK,EAAK,EAC9BoB,EAAOlC,GAAa5B,EAAK,EAAK,EAC9B+D,EAAOnC,GAAamB,EAAK,EAAK,EAC9BiB,EAAOpC,GAAasB,EAAK,EAAK,EAC9BgB,EAAOtC,GAAayB,EAAK,EAAK,EAG9Bc,EAAOtC,GAAgC7B,EAAK4B,GAAamB,EAAK,EAAI,CAAC,EACnEqB,GAAOvC,GAAgC7B,EAAK4B,GAAasB,EAAK,EAAI,CAAC,EACnEoB,GAAOzC,GAAgC7B,EAAK4B,GAAayB,EAAK,EAAI,CAAC,EAEnE0B,GAAQrE,EAAI,0BAA2BH,CAAkB,EAG/D,MAAMG,EAAI,2BACR,IAAIa,GAAO,CAAC+H,EAAQ7H,EAAQiB,EAAK1C,EAAKkD,EAAKH,EAAKM,CAAG,EAAE,IAAIlC,KAAQ,CAAE,IAAAA,GAAK,UAAW,EAAK,EAAE,CAAC,CAC7F,EAEA,IAAMuI,GAAclI,GAClBjB,EAAoBP,EAAKyB,EACzBsD,GAAM,IAAI,eAAe0E,CAAQ,GAAG,MAAM,SAAS,OACrD,EAEA,MAAM/I,EAAI,yBAA0B,CAClC,WAAYH,EACZ,aAAc,wBACd,KAAM,CACJ,CACE,GAAI+C,EACJ,KAAM,MACN,SAAUkG,EACV,KAAM,CACJ,QAAS,CACP,UAAW,EACb,CACF,EACA,KAAM3F,CACR,EACA,CACE,GAAIL,EACJ,KAAM,MACN,SAAUiG,EACV,KAAM,CACJ,QAAS,CACP,UAAW,GACX,QAASC,EACX,CACF,EACA,KAAM5F,CACR,EACA,CACE,GAAIL,EACJ,KAAM,MACN,SAAUkG,GAAgB5E,GAAO,KAAK,EACtC,KAAM,CACJ,QAAS,CACP,QAASZ,CACX,CACF,EACA,KAAMJ,CACR,EACA,CACE,GAAIL,EACJ,KAAM,MACN,SAAUiG,GAAgB5E,GAAO,KAAK,EACtC,KAAM,CACJ,QAAS,CACP,QAASX,EACX,CACF,EACA,KAAMJ,CACR,EACA,CACE,GAAIJ,EACJ,KAAM,OACN,SAAU+F,GAAgB5E,GAAO,MAAM,EACvC,KAAM,CACJ,QAAS,CACP,QAAST,EACX,CACF,EACA,KAAMJ,CACR,CACF,EACA,aAAcsF,EACd,eAAgB,CACd,QAAS,CACP,4BAA6BD,CAC/B,CACF,EACA,MAAA7B,CACF,CAAC,EAGD,MAAMhH,EAAI,2BACR,IAAIa,GAAO,CAAC2B,EAAKH,EAAKM,CAAG,EAAE,IAAIlC,KAAQ,CAAE,IAAAA,EAAI,EAAE,CAAC,CAClD,EAEAT,EAAI,oCAAqC,CAAC+I,EAAUD,EAAUhG,EAAOF,CAAK,CAAC,CAC7E,EACA,6BAA8B,MAAO,CACnC,WAAAvD,EACA,oBAAAiF,EACA,iBAAAxE,CACF,IAIM,CACJ,IAAMuE,EAAQrE,EAAI,0BAA2BX,CAAU,EACvD,GAAI,CAACgF,GAAO,YAAY,uBACtB,MAAM,IAAI,MAAM,kCAAkC,EAGpD,IAAM6E,EAA6B5E,EAAoB,QAAQ,EAAE,IAC/DC,GAAM,CAAC1B,GAAM0B,CAAC,EAAG3D,GAAe2D,CAAC,CAAC,CACpC,EACMV,EAAyBQ,EAAM,WAAW,uBAIhD,GAAIvE,EAAkB,CACpB,IAAMR,EAAM4J,EAA2B,CAAC,EAAE,CAAC,EAC3C,MAAMtJ,GAAkBP,EAAYS,EAAkBR,CAAG,CAC3D,CAEA,IAAMwC,EAAQqH,GAAsB9J,EAAYgF,EAAOR,EAAwB,IAAK,OAAO,YAAYqF,CAA0B,EAAG,wBAAwB,EAItJ,CAAE,kBAAAE,EAAmB,UAAAC,CAAU,EAAIrJ,EAAI,oBAAoB,EACjE,MAAM,QAAQ,IAAI,CAChB,GAAG,OAAO,KAAKoJ,CAAiB,EAAE,IAAK/J,GAC9BW,EAAI,4BAA6B,CAAE,WAAAX,EAAY,KAAM,CAAC,CAAE,CAAC,EAAE,MAAOiC,GAAM,CAG7E,QAAQ,KAAK,2DAA4DjC,EAAYiC,CAAC,CACxF,CAAC,CACF,EACD,GAAG+H,EAAU,IAAKhK,GACTW,EAAI,mCAAoC,CAAE,WAAAX,CAAW,CAAC,EAAE,MAAOiC,GAAM,CAG1E,QAAQ,KAAK,8DAA+DjC,EAAYiC,CAAC,CAC3F,CAAC,CACF,CACH,CAAC,EAED,MAAMtB,EAAI,8BAA+BX,EAAY,CACnD,CAACA,CAAU,EAAG,CAAE,MAAO,IAAIwB,GAAOiB,EAAM,QAAQ,CAAC,CAAE,CACrD,CAAC,CACH,EACA,iCAAkC,MAAOzC,EAAoBgF,IAAkB,CAC7E,IAAMiF,EAAwBtJ,EAAI,oBAAoB,EAAE,sBAEpDX,IAAeiK,GAMjB,MAAMtJ,EAAI,4BAA4B,CAE1C,EACA,GAAGmG,GAAgB,0CAA2ClC,EAAE,kCAAkC,CAAC,EACnG,GAAGkC,GAAgB,0CAA2ClC,EAAE,mDAAmD,CAAC,EACpH,GAAGkC,GAAgB,4CAA6ClC,EAAE,qDAAqD,CAAC,EACxH,GAAGkC,GAAgB,yCAA0ClC,EAAE,iCAAiC,CAAC,CACnG,CAAC,ECzhCD,IAAMsF,GAAyB,CAACC,EAAO,CAAC,KAAO,CAAE,GAAGA,EAAM,KAAM,EAAM,GAEtEC,EAAI,sBAAuBC,GAAQ,IAAM,CAClCD,EAAI,kBAAkB,EAAE,UAAU,oBAGvCA,EAAI,6BAA6B,EAAE,MAAM,GAAK,CAC5C,QAAQ,MAAM,2EAA4E,CAAC,CAC7F,CAAC,CACH,CAAC,EAED,IAAOE,GAASF,EAAI,yBAA0B,CAC5C,8BAA+B,SAAY,CACzC,QAAQ,KAAK,+CAA+C,EAC5D,MAAMA,EAAI,mDAAmD,EAC7D,MAAMA,EAAI,wCAAwC,EAClD,MAAMA,EAAI,+CAA+C,EACzD,QAAQ,KAAK,uCAAuC,CACtD,EAEA,qDAAsD,SAAY,CAIhE,IAAMG,EAAqBH,EAAI,kBAAkB,EAAE,UAAU,mBAC7D,GAAI,CAACG,EACH,MAAM,IAAI,MAAM,mEAAmE,EAErF,OAAQ,MAAMH,EAAI,kBAAmBG,EAAoBC,GAAQ,eAAe,IAAI,MAAQ,CAAC,CAC/F,EACA,oDAAqD,CAAC,CAAE,KAAAL,EAAM,WAAAM,CAAW,IAA+C,CACtH,IAAMF,EAAqBH,EAAI,kBAAkB,EAAE,UAAU,mBAC7D,GAAI,CAACG,EACH,MAAM,IAAI,MAAM,oEAAoE,EAOtF,OAAOH,EAAI,wBAAyB,CAClC,WAAYG,EACZ,IAAKC,GAAQ,gBACb,KAAAL,EACA,WAAAM,CACF,CAAC,CACH,EACA,oDAAqD,IAC5CL,EAAI,kCAAmCM,GAAU,SAAY,CAClE,IAAMC,EAAgC,MAAMP,EAAI,oDAAoD,EACpGA,EAAI,wBAAyBQ,GAAqBD,CAA6B,CACjF,CAAC,EAEH,oDAAqD,CAAC,CAAE,WAAAE,EAAY,YAAAC,EAAa,cAAAC,CAAc,IAGtFX,EAAI,kCAAmCM,GAAU,SAAY,CAClE,IAAMM,EAA2B,CAAC,CAAE,YAAAC,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IACzDD,EAAYJ,CAAU,EASpB,KARE,CAAC,CACN,GAAGI,EACH,CAACJ,CAAU,EAAG,CACZ,UAAW,CAAE,YAAAC,EAAa,cAAAC,CAAc,EACxC,eAAgB,CAAC,CACnB,CACF,EAAGG,CAAI,EAKLf,EAAOa,EAAyB,IAAI,CAAC,EAC3C,MAAMZ,EAAI,oDAAqD,CAAE,KAAAD,EAAM,WAAYa,CAAyB,CAAC,CAC/G,CAAC,EAEH,8CAA+C,CAAC,CAAE,WAAAH,EAAY,YAAAC,EAAa,cAAAC,EAAe,YAAAI,EAAc,EAAM,IAUrGf,EAAI,kCAAmCM,GAAU,SAAY,CAelE,MAAMN,EAAI,oDAAqD,CAAE,WAdhC,CAAC,CAAE,YAAAa,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IAAM,CACpE,GAAIC,GAAeF,EAAYJ,CAAU,GAAG,UAAU,cAAgBE,EAAe,CACnF,GAAM,CAAE,eAAAK,CAAe,EAAIH,EAAYJ,CAAU,EACjD,MAAO,CAAC,CACN,GAAGI,EACH,CAACJ,CAAU,EAAG,CACZ,UAAW,CAAE,YAAAC,EAAa,cAAAC,CAAc,EACxC,eAAgBK,EAAe,OAAOC,GAAOA,EAAI,cAAgBN,CAAa,CAChF,CACF,EAAGG,CAAI,CACT,CACA,OAAO,IACT,CAEsG,CAAC,CACzG,CAAC,EAEH,sCAAuC,CAAC,CAAE,WAAAL,EAAY,YAAAC,EAAa,cAAAC,EAAe,eAAAK,CAAe,IAMxFhB,EAAI,kCAAmCM,GAAU,SAAY,CAkBlE,MAAMN,EAAI,oDAAqD,CAAE,WAjBhC,CAAC,CAAE,YAAAa,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IAAM,CACpE,IAAMI,EAAoBL,EAAYJ,CAAU,GAAG,UAGnD,OAAIS,GACFA,EAAkB,kBAClBA,GAAmB,cAAgBR,EAAsB,KAEpD,CAAC,CACN,GAAGG,EACH,CAACJ,CAAU,EAAG,CACZ,UAAW,CAAE,YAAAC,EAAa,cAAAC,EAAe,iBAAkB,EAAK,EAChE,eAAAK,CACF,CACF,EAAGF,CAAI,CACT,CAEsG,CAAC,CACzG,CAAC,EAEH,kDAAmD,CAAC,CAAE,WAAAL,EAAY,YAAAC,EAAa,cAAAC,CAAc,IAGpFX,EAAI,kCAAmCM,GAAU,SAAY,CAYlE,MAAMN,EAAI,oDAAqD,CAAE,WAXhC,CAAC,CAAE,YAAAa,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IAC1DD,EAAYJ,CAAU,GAAG,UAAU,cAAgBE,GACvCE,EAAYJ,CAAU,EAAE,eAAe,UAAUQ,GAAOA,EAAI,cAAgBP,CAAW,IACvF,IACZG,EAAYJ,CAAU,EAAE,eAAe,KAAK,CAAE,YAAAC,EAAa,cAAAC,CAAc,CAAC,EACnE,CAACE,EAAaC,CAAI,GAGtB,IAG6F,CAAC,CACzG,CAAC,EAEH,qDAAsD,CAAC,CAAE,WAAAL,EAAY,YAAAC,CAAY,IAGxEV,EAAI,kCAAmCM,GAAU,SAAY,CAWlE,MAAMN,EAAI,oDAAqD,CAAE,WAVhC,CAAC,CAAE,YAAAa,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IAAM,CACpE,IAAMK,EAAQN,EAAYJ,CAAU,GAAG,eAAe,UAAUQ,GAAOA,EAAI,cAAgBP,CAAW,EAEtG,OAAI,OAAO,UAAUS,CAAK,GAAKA,GAAS,GACtCN,EAAYJ,CAAU,EAAE,eAAe,OAAOU,EAAO,CAAC,EAC/C,CAACN,EAAaC,CAAI,GAEpB,IACT,CAEsG,CAAC,CACzG,CAAC,EAEH,sDAAuD,CAAC,CAAE,WAAAL,CAAW,IAC5DT,EAAI,kCAAmCM,GAAU,SAAY,CASlE,MAAMN,EAAI,oDAAqD,CAAE,WARhC,CAAC,CAAE,YAAAa,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IAC1DD,EAAYJ,CAAU,GACxB,OAAOI,EAAYJ,CAAU,EACtB,CAACI,EAAaC,CAAI,GAEpB,IAG6F,CAAC,CACzG,CAAC,EAGH,0CAA2C,SAAY,CACrD,IAAMX,EAAqBH,EAAI,kBAAkB,EAAE,UAAU,mBAC7D,GAAI,CAACG,EACH,MAAM,IAAI,MAAM,uDAAuD,EAEzE,OAAQ,MAAMH,EAAI,kBAAmBG,EAAoBC,GAAQ,WAAW,IAAI,MAAQ,CAAC,CAC3F,EACA,yCAA0C,CAAC,CAAE,KAAAL,EAAM,WAAAM,CAAW,IAA+C,CAC3G,IAAMF,EAAqBH,EAAI,kBAAkB,EAAE,UAAU,mBAC7D,GAAI,CAACG,EACH,MAAM,IAAI,MAAM,wDAAwD,EAG1E,OAAOH,EAAI,wBAAyB,CAClC,WAAYG,EACZ,IAAKC,GAAQ,YACb,KAAAL,EACA,WAAAM,CACF,CAAC,CACH,EACA,yCAA0C,IACjCL,EAAI,kCAAmCM,GAAU,SAAY,CAClE,IAAMc,EAAc,MAAMpB,EAAI,yCAAyC,EACvEA,EAAI,wBAAyBqB,GAAiBD,CAAW,CAC3D,CAAC,EAEH,4DAA6D,CAAC,CAAE,WAAAX,EAAY,OAAAa,CAAO,IAC1EtB,EAAI,kCAAmCM,GAAU,SAAY,CAClE,IAAMiB,EAAwB,CAAC,CAAE,KAAAT,EAAM,YAAaU,EAAqB,CAAC,CAAE,EAAI,CAAC,IAAM,CACrF,IAAMC,EAAyB,CAC7B,GAAID,EAAmB,wBAA0B,CAAC,EAClD,CAACf,CAAU,EAAGa,CAChB,EACA,MAAO,CAAC,CAAE,GAAGE,EAAoB,uBAAAC,CAAuB,EAAGX,CAAI,CACjE,EAEMf,EAAOwB,EAAsB,EAAE,CAAC,EACtC,MAAMvB,EAAI,yCAA0C,CAAE,KAAAD,EAAM,WAAYwB,CAAsB,CAAC,CACjG,CAAC,EAGH,iDAAkD,SAAY,CAC5D,IAAMpB,EAAqBH,EAAI,kBAAkB,EAAE,UAAU,mBAC7D,GAAI,CAACG,EACH,MAAM,IAAI,MAAM,+DAA+D,EAEjF,OAAQ,MAAMH,EAAI,kBAAmBG,EAAoBC,GAAQ,aAAa,IAAI,MAAQ,CAAC,CAC7F,EACA,gDAAiD,CAAC,CAAE,KAAAL,EAAM,WAAAM,CAAW,IAA+C,CAClH,IAAMF,EAAqBH,EAAI,kBAAkB,EAAE,UAAU,mBAC7D,GAAI,CAACG,EACH,MAAM,IAAI,MAAM,gEAAgE,EAGlF,IAAMuB,EAAqBC,GAClB,OAAO,KAAKA,CAAkB,EAAE,OAAO,CAACC,EAAKC,KAC7CC,GAAUH,EAAmBE,CAAI,CAAC,IACrCD,EAAIC,CAAI,EAAIF,EAAmBE,CAAI,GAE9BD,GACN,CAAC,CAAC,EAGDG,EAAoB,SAAUC,IAAS,CAC3C,IAAMC,EAAS,MAAO5B,EAAsB,GAAG2B,CAAI,EACnD,GAAI,CAACC,EAAQ,OAAO,KAEpB,GAAM,CAAClC,EAAMe,CAAI,EAAImB,EACrB,MAAO,CAACP,EAAkB3B,CAAI,EAAGe,CAAI,CACvC,EAEA,OAAOd,EAAI,wBAAyB,CAClC,WAAYG,EACZ,IAAKC,GAAQ,cACb,KAAM,CAAC,CAACL,GAAQ2B,EAAkB3B,CAAI,EACtC,WAAY,OAAOM,GAAe,WAAa0B,EAAoB,IACrE,CAAC,CACH,EACA,gDAAiD,IACxC/B,EAAI,kCAAmCM,GAAU,SAAY,CAClE,IAAM4B,EAAS,MAAMlC,EAAI,gDAAgD,EACzEA,EAAI,yCAA0CkC,CAAM,CACtD,CAAC,EAEH,+CAAiDC,GAAyB,CACxE,GAAM,CAAE,KAAAN,EAAM,UAAAO,CAAU,EAAID,EAC5B,OAAOnC,EAAI,kCAAmCM,GAAU,SAAY,CAClE,IAAM+B,EAA+B,CAAC,CAAE,YAAAxB,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IAC7DD,IAAcgB,CAAI,EAMhB,KALE,CAAC,CACN,GAAGhB,EACH,CAACgB,CAAI,EAAG/B,GAAuB,CAAE,UAAAsC,CAAU,CAAC,CAC9C,EAAGtB,CAAI,EAKLf,EAAOsC,EAA6B,IAAI,CAAC,EAC/C,MAAMrC,EAAI,gDAAiD,CAAE,KAAAD,EAAM,WAAYsC,CAA6B,CAAC,CAC/G,CAAC,CACH,EACA,oDAAsDC,IAChD,OAAOA,GAAW,WACpBA,EAAS,CAACA,CAAM,GAEXtC,EAAI,kCAAmCM,GAAU,SAAY,CAClE,IAAMiC,EAAgBvC,EAAI,oBAAoB,EAAE,cAAc,MAsB9D,MAAMA,EAAI,gDAAiD,CAAE,WArBxB,CAAC,CAAE,YAAAa,EAAc,CAAC,EAAG,KAAAC,CAAK,EAAI,CAAC,IAAM,CACxE,IAAI0B,EAAY,GAChB,QAAWX,KAAQS,EAAQ,CACzB,IAAMG,EAAWF,EAAc,KAAKG,GAAKA,EAAE,OAASb,CAAI,EACnDhB,EAAYgB,CAAI,IACnBhB,EAAYgB,CAAI,EAAI/B,GAAuB,CAAE,UAAW2C,EAAS,SAAU,CAAC,GAG9E,IAAME,EAAW9B,EAAYgB,CAAI,EAAE,OAAS,GAItCe,EAAc/B,EAAYgB,CAAI,EAAE,OAASY,EAAS,MACpDE,GAAYC,KACd/B,EAAYgB,CAAI,EAAE,KAAO,GACzBW,EAAY,GAEhB,CACA,OAAOA,EAAY,CAAC3B,EAAaC,CAAI,EAAI,IAC3C,CAEsG,CAAC,CACzG,CAAC,EAEL,CAAC,EC7SD+B,EAAI,yBAA0B,CAQ5B,mCAAoC,MAAO,CACzC,WAAAC,EACA,aAAAC,EACA,kBAAAC,EACA,OAAAC,EACA,iBAAAC,CACF,IAAM,CACJ,GAAIJ,IAAeE,EACjB,OAGF,IAAMG,EAAgB,MAAMN,EAAI,+BAAgCG,CAAiB,EAEjF,GAAI,CACF,MAAMH,EAAI,2BAA4BC,EAAY,CAAE,UAAW,EAAK,CAAC,EACrE,IAAMM,EAAQ,MAAMP,EAAI,+BAAgCC,CAAU,EAE5DO,EAAQC,GAAgBF,EAAO,KAAK,EACpCG,EAAeC,GAAwBJ,EAAO,CAACK,EAAU,YAAY,EAAG,CAAC,KAAK,CAAC,EAErF,GAAI,CAACJ,GAAS,CAACD,GAAO,KAAK,iBAAiBC,CAAK,EAC/C,MAAM,IAAI,MAAM,6CAA6C,EAI/D,IAAMK,EAAa,MAAMb,EAAI,oBAAoB,EAAE,WAE7Cc,EAAc,MAAM,QAAQV,CAAM,EACpCW,GAAKF,EAAYT,CAAM,EACvBA,IAAW,IACTW,GAAKF,EAAY,OAAO,QAAQP,EAAc,IAAI,cAAc,EAC/D,OAAO,CAAC,CAAC,CAAEU,CAAG,IACN,CAAC,CAAGA,EAAkB,MAAM,SAAS,OAC7C,EACA,IAAI,CAAC,CAACC,CAAE,IAAMA,CAAE,CACnB,EACE,KAEN,GAAI,CAACH,EACH,MAAM,IAAI,UAAU,2BAA2B,EAGjD,IAAMI,EAAU,CACd,WAAYf,EACZ,KAAM,OAAO,QAAQW,CAAW,EAAE,IAAI,CAAC,CAACK,EAAOH,CAAG,KAAwB,CACxE,GAAIG,EACJ,KAAM,CACJ,QAAS,CACP,QAASC,GAAsBnB,EAAYO,EAAOQ,CAAG,CACvD,CACF,CACF,EAAE,CACJ,EAEMK,EAAa,CAAC,wBAAyB,CAC3C,WAAApB,EACA,aAAAC,EACA,KAAMkB,GAAsBnB,EAAYO,EAAOU,CAAO,EACtD,aAAAR,CACF,CAAC,EACD,GAAIL,EAAkB,OAAOgB,EAE7B,MAAMrB,EAAI,GAAGqB,CAAU,CACzB,QAAE,CACA,MAAMrB,EAAI,4BAA6BC,EAAY,CAAE,UAAW,EAAK,CAAC,CACxE,CACF,EAEA,4BAA6B,MAC3BA,EACAC,EACAoB,EAMAC,IACG,CACH,IAAMhB,EAAQP,EAAI,0BAA2BC,CAAU,EAEvD,GAAI,CAACM,EACH,MAAM,IAAI,MAAM,sDAAsDN,CAAU,mBAAmB,EAGrG,IAAIuB,EAAY,OAAO,iBAGjBC,EAAU,OAAO,YAAY,OAAO,QAAQlB,EAAM,IAAI,cAAc,EAAE,OAAO,CAAC,CAACU,EAAIS,CAAI,IACpF,CAAC,CAACA,EAAK,MAAM,SAAS,SAAWA,EAAK,iBAAmB,OAC9D,MAAM,QAAQJ,CAAY,EACtBA,EAAa,SAASI,EAAK,IAAI,EAC/BJ,IAAiB,IACf,GAEAf,EAAM,WAAW,uBAAyBoB,EAAIpB,EAAM,UAAU,sBAAuBU,CAAE,EAChG,EAAE,IAAI,CAAC,CAACA,EAAIS,CAAI,IAAuB,CACtC,IAAME,EAASC,GAAiBH,EAAK,IAAI,EACzC,MAAO,CAACA,EAAK,KAAM,CAACT,EAAIW,EAAQT,GAAMS,CAAM,EAAGE,GAAmBJ,EAAK,KAAK,QAAQ,OAAO,CAAC,CAAC,CAC/F,CAAC,CAAC,EAEF,GAAI,CAAC,OAAO,KAAKD,CAAO,EAAE,OAAQ,CAChC,QAAQ,MAAM,gCAAiC,CAAE,WAAAxB,CAAW,CAAC,EAC7D,MACF,CAGA,IAAM8B,EAAc,OAAO,OAAON,CAAO,EAAE,IAAI,CAAC,CAACR,EAAIW,EAAQI,EAAOC,CAAI,IAAM,CAC5E,IAAMC,EAAoB3B,EAAM,IAAI,eAAe0B,CAAI,EAAE,KACnDE,EAAyBR,EAAIF,EAASS,CAAiB,EACvDE,EAAgBD,EAAyBV,EAAQS,CAAiB,EAAE,CAAC,EAAI3B,EAAM,IAAI,eAAe0B,CAAI,EAAE,KAE9G,OAAI1B,EAAM,IAAI,eAAeU,CAAE,EAAE,UAAYO,IAC3CA,EAAYjB,EAAM,IAAI,eAAeU,CAAE,EAAE,WAGpC,CACL,KAAMV,EAAM,IAAI,eAAeU,CAAE,EAAE,KACnC,GAAIe,EACJ,SAAUf,EACV,KAAMoB,GAAaT,EAAQ,EAAK,EAChC,KAAM,CACJ,QAAS,CAKP,QAASO,EAMLG,GAAgCF,EAAeC,GAAaT,EAAQ,EAAI,CAAC,EAKzER,GAAsBnB,EAAYkB,GAAMiB,CAAa,EAAGC,GAAaT,EAAQ,EAAI,CAAC,EACtF,UAAWrB,EAAM,IAAI,eAAeU,CAAE,EAAE,KAAK,QAAQ,SACvD,CACF,CACF,CACF,CAAC,EAEKP,EAAeC,GAAwBJ,EAAO,CAACK,EAAU,UAAWA,EAAU,aAAcA,EAAU,aAAa,EAAG,CAAC,KAAK,EAAGY,CAAS,EAE9I,GAAI,CAACd,EACH,MAAM,IAAI,MAAM,+BAA+B,EAKjD,IAAM6B,EAAuBhB,EAA8B,MAAMvB,EAAIuB,EAA6BtB,EAAYwB,CAAO,EAAI,OAEnHe,EAAe,CAACC,EAAKlC,IACIwB,EAAY,OAAQf,GACxCT,EAAM,IAAI,eAAeS,EAAI,QAAQ,EAAE,iBAAmB,IAClE,EAEwB,SAAW,EAMlC,MAAM,QAAQuB,CAAoB,GAAKA,EAAqB,OAAS,EAEvE,MAAMvC,EAAI,sBAAuB,CAC/B,WAAAC,EACA,aAAAC,EACA,KAAM,CACJ,GAAIqC,EAAqB,CAAC,GAAK,CAAC,EAChC,CAAC,yBAA0B,CAAE,KAAMR,CAAY,CAAC,EAChD,GAAIQ,EAAqB,CAAC,GAAK,CAAC,CAClC,EACA,aAAA7B,EACA,MAAO,CACL,aAAA8B,CACF,CACF,CAAC,EAGD,MAAMxC,EAAI,yBAA0B,CAClC,WAAAC,EACA,aAAAC,EACA,KAAM6B,EACN,aAAArB,EACA,MAAO,CACL,aAAA8B,CACF,CACF,CAAC,CAEL,CACF,CAAC,ECnND,IAAME,GAAqG,CACzG,kBAAmBC,EAAOD,EAASE,EAAW,CAC5C,OAAOD,EAAM,mBAAmBC,EAAU,cAAc,GAAK,IAC/D,EACA,qBAAsBD,EAAOD,EAASE,EAAW,CAC/C,OAAOA,EAAUF,EAAQ,iBAAiB,GAAK,CAAC,CAClD,EACA,yBAA0BC,EAAO,CAC/B,OAAO,OAAO,OAAO,CACnB,cAAe,CACb,oBAAqBE,GAAwB,gBAC7C,aAAcA,GAAwB,eACxC,EACA,eAAgB,CACd,oBAAqBA,GAAwB,aAC7C,aAAcA,GAAwB,YACxC,CACF,EAAGF,EAAM,0BAA4B,CAAC,CAAC,CACzC,EACA,kBAAmBA,EAAO,CACxB,OAAOA,EAAM,gBAAkB,CAAC,CAClC,EACA,sBAAuBA,EAAOD,EAASE,EAAW,CAChD,OAAOE,GAAW,CAChB,IAAMC,EAA6B,CAAC,EAEpC,GAAI,CAACD,EAEH,OAAOC,EAGT,QAAWC,KAAc,OAAO,KAAKN,EAAQ,iBAAiB,EAAG,CAC/D,IAAMO,EAAgBL,EAAUI,CAAU,EACpCE,EAAwBR,EAAQ,kBAAkBM,CAAU,EAC5DG,EAAeT,EAAQ,sBAG7B,GAAI,CAACO,GAAiB,CAACA,EAAc,UAAUE,CAAY,EACzD,SAGF,IAAMC,EAAU,OAAO,KAAKH,EAAc,OAAO,EAC3CI,EAAeD,EAAQ,SAAW,GAAKA,EAAQ,CAAC,IAAMD,EACtDG,EAAWF,EACd,OAAOG,GAAYA,IAAaJ,CAAY,EAC5C,KAAK,CAACK,EAAIC,IAAO,CAChB,IAAMC,EAAe,IAAI,KAAKT,EAAc,QAAQO,CAAE,EAAE,UAAU,EAAE,QAAQ,EACtEG,EAAe,IAAI,KAAKV,EAAc,QAAQQ,CAAE,EAAE,UAAU,EAAE,QAAQ,EAC5E,OAAOC,EAAeC,CACxB,CAAC,EACGC,EAAkBN,EAAS,KAAKC,GAAY,OAAO,KAAKb,EAAQ,gBAAgBI,CAAO,CAAC,EAAE,SAASS,CAAQ,CAAC,EAClH,GAAIL,EAAsB,UAAYG,GAAgBO,GAAkB,CAItE,IAAMC,EAAoBR,EAAeF,EAAeG,EAASA,EAAS,OAAS,CAAC,EAC9EQ,EAAmBb,EAAc,UAAU,OAAS,EACtD,IAAI,KAAKA,EAAc,SAASA,EAAc,SAAS,OAAS,CAAC,EAAE,QAAQ,EAAE,QAAQ,EACrF,EAEJF,EAA2BC,CAAU,EAAI,CACvC,GAAGE,EACH,QAAAE,EACA,SAAUE,EAAS,IAAIC,IAAa,CAClC,WAAYA,EACZ,SAAUb,EAAQ,eAAea,CAAQ,EACzC,YAAab,EAAQ,sBAAsBa,CAAQ,CACrD,EAAE,EACF,kBAAAM,EAKA,MAAOR,EACHX,EAAQ,sBAAsBS,CAAY,EAC1CG,EAAS,IAAIS,GAAOrB,EAAQ,sBAAsBqB,CAAG,CAAC,EAAE,KAAK,IAAI,EACrE,iBAAAD,EACA,QAASpB,EAAQ,uBAAuBmB,CAAiB,GAAG,QAC5D,aAAAR,CACF,CACF,CACF,CACA,OAAON,CACT,CACF,EACA,uBAAwBJ,EAAOD,EAASE,EAAW,CACjD,OAAOF,EAAQ,sBAAsBE,EAAU,cAAc,CAC/D,EAIA,iCAAkCD,EAAOD,EAASE,EAAW,CAC3D,OAAQU,GAAa,CACf,OAAOA,GAAa,WACtBA,EAAW,CAACA,CAAQ,GAGtB,IAAMU,EAAuBV,EAAS,SAAW,GAAKA,EAAS,CAAC,IAAMV,EAAU,SAAS,mBACnFG,EAA6BL,EAAQ,uBAC3C,OAAO,OAAO,KAAKK,CAA0B,EAAE,KAAKC,GAAc,CAChE,IAAMiB,EAAmBlB,EAA2BC,CAAU,EAE9D,GAAIgB,EAAsB,OAAOC,EAAiB,aAC7C,CACH,IAAMC,EAAYD,EAAiB,SAAS,IAAIE,GAAWA,EAAQ,UAAU,EAC7E,OAAOD,EAAU,SAAWZ,EAAS,QAAUc,GAAMF,EAAaZ,CAAyB,EAAE,SAAWA,EAAS,MACnH,CACF,CAAC,CACH,CACF,EACA,qBAAsBX,EAAOD,EAAS,CAEpC,OAAOM,GAAc,CAAC,CAACN,EAAQ,uBAAuBM,GAAcN,EAAQ,iBAAiB,CAC/F,EACA,gBAAiBC,EAAOD,EAAS,CAE/B,OAAOM,GAAc,CAAC,CAACN,EAAQ,kBAAkBM,GAAcN,EAAQ,iBAAiB,CAC1F,EACA,6BAA8BC,EAAOD,EAAS,CAC5C,OAAOM,GAAc,CACnB,IAAMiB,EAAmBvB,EAAQ,uBAAuBM,GAAcN,EAAQ,iBAAiB,EAC/F,MAAO,CAAC,CAACuB,GAAoBA,GAAkB,YACjD,CACF,EACA,iBAAkBtB,EAAOD,EAASE,EAAW,CAC3C,MAAO,CAACI,EAAoBO,IAAsB,CAAC,CAACX,EAAUI,CAAU,GAAG,UAAUO,GAAYb,EAAQ,qBAAqB,CAChI,EACA,cAAeC,EAAOD,EAASE,EAAW,CACxC,OAAOA,IAAYF,EAAQ,iBAAiB,GAAG,KAAO,IACxD,EACA,8BAA+BC,EAAOD,EAAS,CAC7C,OAAOC,EAAM,yBAAyBD,EAAQ,iBAAiB,CACjE,EACA,yBAA0BC,EAAOD,EAAS,CAExC,OAAOA,EAAQ,kBAAkBA,EAAQ,iBAAiB,GAAG,SAC/D,EACA,uBAAwBC,EAAOD,EAAS,CACtC,OAAQM,GAECN,EAAQ,kBAAkBM,CAAU,GAAG,gBAAkB,CAAC,CAErE,EACA,+BAAgCL,EAAOD,EAAS,CAC9C,OAAQ2B,GACC,EAAQ3B,EAAQ,kBAAkB2B,GAAc3B,EAAQ,iBAAiB,GAAG,WAAW,gBAElG,EACA,oBAAqBC,EAAOD,EAASE,EAAW,CAC9C,OAAQE,GAAoB,CAC1B,IAAMwB,EAAuBP,GAAO,OAAO,KAAKrB,EAAQ,sBAAsBI,CAAO,CAAC,EAAE,SAASiB,CAAG,EAC9FQ,EAAkBR,GAAO,OAAO,KAAKnB,EAAUE,CAAO,GAAG,WAAa,CAAC,CAAC,EAAE,SAASiB,CAAG,EAC5F,OAAO,OAAO,KAAKrB,EAAQ,iBAAiB,EACzC,OAAOqB,GAAOO,EAAqBP,CAAG,GAAKQ,EAAgBR,CAAG,CAAC,EAC/D,IAAIA,GAAOrB,EAAQ,kBAAkBqB,CAAG,EAAE,eAAe,MAAM,EAC/D,OAAO,CAACS,EAAKC,IAAMD,EAAMC,EAAG,CAAC,CAClC,CACF,EACA,sBAAuB9B,EAAOD,EAASE,EAAW,CAChD,OAAQI,GAAuB,OAAO,KAAKJ,EAAU,SAAS,EAC3D,KAAK8B,GAAO9B,EAAU,UAAU8B,CAAG,EAAE,OAAS,sBAC7C,OAAO,KAAK9B,EAAU8B,CAAG,EAAE,SAAS,EAAE,SAAS1B,CAAU,CAAC,CAChE,EACA,kBAAmBL,EAAOD,EAASE,EAAW,CAC5C,IAAM+B,EAAoBC,GAAM,CAAC,EAAGlC,EAAQ,cAAc,EACpDS,EAAeP,EAAU,SAAS,mBACxC,QAAWiC,KAAcF,EAAmB,CAC1C,IAAMG,EAAWlC,EAAUiC,CAAU,EACrC,GAAIC,GAAYA,EAAS,YAAcA,EAAS,QAAQ3B,CAAY,EAClEwB,EAAkBE,CAAU,EAAI,CAC9B,GAAGC,EAAS,WACZ,GAAID,EACJ,oBAAqBnC,EAAQ,uBAAuBmC,CAAU,EAAE,OAChE,OAAQ,EACV,MACK,CACL,GAAM,CAAE,KAAAE,EAAM,aAAAC,CAAa,EAAIL,EAAkBE,CAAU,EAC3DF,EAAkBE,CAAU,EAAI,CAAE,GAAIA,EAAY,KAAAE,EAAM,aAAAC,EAAc,OAAQ,EAAM,CACtF,CACF,CACA,OAAOL,CACT,EACA,8BAA+BhC,EAAOD,EAAS,CAI7C,OAAO,OAAO,OAAOA,EAAQ,iBAAiB,EAAE,OAC7CuC,GAAiB,CAACC,GAAuB,MAAOA,GAAuB,MAAM,EAAE,SAASD,EAAQ,YAAY,GAC5GA,EAAQ,eAAiBC,GAAuB,SAAWD,EAAQ,MACtE,CACF,EACA,oBAAqBtC,EAAOD,EAAS,CACnC,OAAOM,GAAc,CACnB,IAAMmC,EAAa,OAAO,OAAOzC,EAAQ,iBAAiB,EAAE,KAAMuC,GAAiBA,EAAQ,KAAOjC,CAAU,EAC5G,OAAOmC,EAAQA,EAAM,KAAO,IAC9B,CACF,EACA,sBAAuBxC,EAAOD,EAAS,CACrC,OAAOA,EAAQ,mBACZ,IAAI0C,IAAW,CAAE,WAAYA,EAAO,WAAY,SAAUA,EAAO,SAAU,YAAaA,EAAO,WAAY,EAAE,EAC7G,OAAOA,GAAU,CAAC,CAAC1C,EAAQ,gBAAgB0C,EAAO,UAAU,CAAC,GAAK,CAAC,CACxE,CACF,EAEOC,GAAQ3C,GC/Lf,SAAS4C,GAAaC,EAAgC,CAEpD,OAAO,OAAOA,GAAU,SAAWA,EAAM,QAAQ,IAAK,GAAG,EAAIA,EAAM,SAAS,CAC9E,CAEA,SAASC,GAAWC,EAAqB,CACvC,MAAO,CAAC,MAAOA,EAAW,WAAWA,CAAE,CAAC,CAC1C,CAEA,SAASC,GAAmBD,EAAYE,EAAqB,CAC3D,IAAMC,EAAWH,EAAG,MAAM,GAAG,EAAE,CAAC,EAChC,MAAO,CAACG,GAAYA,EAAS,QAAUD,CACzC,CAGA,SAASE,GAAiBN,EAAeI,EAAqB,CAC5D,IAAMF,EAAKH,GAAYC,CAAK,EAC5B,OAAOC,GAAUC,CAAE,GAAKC,GAAkBD,EAAIE,CAAW,CAC3D,CAEA,SAASG,GAAeC,EAAaJ,EAA6B,CAEhE,OAAOI,EAAI,QAAQJ,CAAW,EAAE,QAAQ,QAAS,EAAE,CACrD,CAEO,SAASK,GAAYT,EAAuB,CAEjD,OAAO,WAAWA,EAAM,QAAQ,CAAY,CAAC,CAC/C,CAYA,SAASU,GAAcC,EAAmB,CACxC,GAAM,CAAE,OAAAC,EAAQ,eAAAC,EAAgB,YAAAC,EAAa,eAAAC,CAAe,EAAIJ,EAChE,MAAO,CACL,OAAAC,EACA,eAAAC,EACA,YAAAC,EACA,oBAAsBE,GAAcD,EAAeE,GAAcD,EAAGF,CAAW,CAAC,EAChF,uBAAyBE,GAAcC,GAAcD,EAAGF,CAAW,EACnE,SAAWE,GAAcE,GAAgBF,EAAGF,CAAW,CACzD,CACF,CAMA,IAAMK,GAAqC,CACzC,IAAKT,GAAa,CAChB,OAAQ,IACR,eAAgB,QAChB,YAAa,EACb,eAAgBU,GAAU,IAAMA,CAClC,CAAC,EACD,IAAKV,GAAa,CAChB,OAAQ,SACR,eAAgB,aAChB,YAAa,EACb,eAAgBU,GAAU,SAAMA,CAClC,CAAC,EACD,IAAKV,GAAa,CAChB,OAAQ,SACR,eAAgB,aAChB,YAAa,EACb,eAAgBU,GAAUA,EAAS,QACrC,CAAC,CACH,EAEOC,GAAQF,GCxFA,SAARG,GAAsCC,EAAiD,CAC5F,IAAIC,EAAY,EACZC,EAAY,EACVC,EAAS,CAAC,EACVC,EAAU,CAAC,EACjB,QAAWC,KAAYL,EACjBK,EAAS,SAAW,GACtBF,EAAO,KAAKE,CAAQ,EACpBJ,GAAaI,EAAS,UACbA,EAAS,SAAW,IAC7BD,EAAQ,KAAKC,CAAQ,EACrBH,GAAa,KAAK,IAAIG,EAAS,QAAQ,GAG3C,IAAMC,EAAe,KAAK,IAAI,EAAGJ,EAAYD,CAAS,EAChDM,EAAW,CAAC,EAClB,QAAWC,KAASL,EAAQ,CAC1B,IAAMM,EAAqBH,EAAeE,EAAM,SAChD,QAAWE,KAAUN,EAAS,CAC5B,IAAMO,EAAkB,KAAK,IAAID,EAAO,QAAQ,EAAIR,EACpDK,EAAS,KAAK,CACZ,OAAQE,EAAqBE,EAC7B,aAAcH,EAAM,SACpB,WAAYE,EAAO,QACrB,CAAC,CACH,CACF,CACA,OAAOH,CACT,CC/Be,SAARK,GACLC,EAC2E,CAC3E,IAAMC,EAAsB,CAAC,EACvBC,EAAiB,CAAC,EAClBC,EAAe,CAAC,EAChBC,EAAgB,CAAC,EACjBC,EAAwB,CAAC,EAC/B,QAAWC,KAAQN,EACjBC,EAAoBK,EAAK,UAAU,GAAKL,EAAoBK,EAAK,UAAU,GAAK,GAAKA,EAAK,OAC1FJ,EAAeI,EAAK,YAAY,GAAKJ,EAAeI,EAAK,YAAY,GAAK,GAAKA,EAAK,OAEtF,QAAWC,KAAYL,EACrBC,EAAa,KAAK,CAAE,SAAAI,EAAU,OAAQL,EAAeK,CAAQ,CAAE,CAAC,EAElE,QAAWA,KAAYN,EACrBG,EAAc,KAAK,CAAE,SAAAG,EAAU,OAAQN,EAAoBM,CAAQ,CAAE,CAAC,EAKxE,IAFAJ,EAAa,KAAK,CAACK,EAAGC,IAAMA,EAAE,OAASD,EAAE,MAAM,EAC/CJ,EAAc,KAAK,CAACI,EAAGC,IAAMA,EAAE,OAASD,EAAE,MAAM,EACzCL,EAAa,OAAS,GAAKC,EAAc,OAAS,GAAG,CAC1D,IAAMM,EAAYP,EAAa,IAAI,EAC7BQ,EAAaP,EAAc,IAAI,EAC/BQ,EAAOF,EAAU,OAASC,EAAW,OACvCC,EAAO,GAETP,EAAsB,KAAK,CAAE,OAAQK,EAAU,OAAQ,aAAcA,EAAU,SAAU,WAAYC,EAAW,QAAS,CAAC,EAC1HA,EAAW,QAAUD,EAAU,OAC/BN,EAAc,KAAKO,CAAU,GACpBC,EAAO,GAEhBP,EAAsB,KAAK,CAAE,OAAQM,EAAW,OAAQ,aAAcD,EAAU,SAAU,WAAYC,EAAW,QAAS,CAAC,EAC3HD,EAAU,QAAUC,EAAW,OAC/BR,EAAa,KAAKO,CAAS,GAG3BL,EAAsB,KAAK,CAAE,OAAQM,EAAW,OAAQ,aAAcD,EAAU,SAAU,WAAYC,EAAW,QAAS,CAAC,CAE/H,CACA,OAAON,CACT,CCpCA,IAAMQ,GAAU,EAAI,KAAK,IAAI,GAAI,CAAY,EAEtC,SAASC,GAAwB,CAAE,UAAAC,EAAY,CAAC,EAAG,SAAAC,EAAW,EAAK,EAEzD,CACf,IAAMC,EAAeC,GAAoBH,CAAS,EAClD,OAAOC,EAAWG,GAA2BF,CAAY,EAAIA,CAC/D,CAEO,SAASG,GACd,CAAE,aAAAH,EAAc,SAAAI,EAAU,MAAAC,CAAM,EAClB,CACdL,EAAeM,GAAUN,CAAY,EAErC,QAAWO,KAAQP,EACjBO,EAAK,MAAQA,EAAK,OAEpBP,EAAeQ,GAAsBR,EAAcI,CAAQ,EAGxD,OAAOG,GAAQA,EAAK,QAAUX,EAAO,EACxC,QAAWW,KAAQP,EACjBO,EAAK,OAASE,GAAWF,EAAK,MAAM,EACpCA,EAAK,MAAQE,GAAWF,EAAK,KAAK,EAClCA,EAAK,QAAUA,EAAK,QAAUA,EAAK,OACnCA,EAAK,OAAS,GACdA,EAAK,MAAQF,EAIf,OAAOL,CACT,CAGA,SAASU,GAAoBN,EAAsC,CAEjEA,EAAWE,GAAUF,CAAQ,EAC7B,QAASO,EAAI,EAAGA,EAAIP,EAAS,OAAQO,IAAK,CACxC,IAAMC,EAAWR,EAASO,CAAC,EAC3B,QAASE,EAAIF,EAAI,EAAGE,EAAIT,EAAS,OAAQS,IAAK,CAC5C,IAAMC,EAAWV,EAASS,CAAC,GAGtBD,EAAS,eAAiBE,EAAS,cAAgBF,EAAS,aAAeE,EAAS,YACtFF,EAAS,aAAeE,EAAS,cAAgBF,EAAS,eAAiBE,EAAS,cAGrFF,EAAS,SAAWA,EAAS,eAAiBE,EAAS,aAAe,EAAI,IAAMA,EAAS,OACzFF,EAAS,QAAUA,EAAS,eAAiBE,EAAS,aAAe,EAAI,IAAMA,EAAS,MAExFV,EAAS,OAAOS,EAAG,CAAC,EACpBA,IAEJ,CACF,CACA,OAAOT,CACT,CAEA,SAASW,GAAkBC,EAAyBC,EAAuC,CACzF,OAAOP,GAAmB,CAAC,GAAGM,EAAW,GAAGC,CAAS,CAAC,CACxD,CAEA,SAAST,GAAuBQ,EAAyBC,EAAuC,CAE9FA,EAAYX,GAAUW,CAAS,EAE/B,QAAWC,KAAKD,EACdC,EAAE,QAAU,GACZA,EAAE,OAAS,GAEb,OAAOH,GAAiBC,EAAWC,CAAS,CAC9C,CC5EO,IAAME,GAAkB,UAClBC,GAAoB,YACpBC,GAAgB,QAChBC,GAAuB,eACvBC,GAAoB,YACpBC,GAA4BC,GAAQ,GAAG,CAACN,GAAiBC,GAAmBC,GAAeC,GAAsBC,EAAiB,EAAE,IAAIG,GAAKC,GAAUD,CAAC,CAAC,CAAC,EAC1JE,GAAsB,SACtBC,GAAuB,UACvBC,GAAsB,SACtBC,GAAsBN,GAAQ,GAAG,CAACG,GAAqBC,GAAsBC,EAAmB,EAAE,IAAIJ,GAAKC,GAAUD,CAAC,CAAC,CAAC,ECbrI,IAAOM,GAAS,CACd,iBAAkBC,EAAOC,EAAS,CAChC,OAAOA,EAAQ,qBAAqB,UAAY,CAAC,CACnD,EACA,mBAAoBD,EAAOC,EAAS,CAClC,OAAOA,EAAQ,qBAAqB,YAAc,CAAC,CACrD,EACA,gBAAiBD,EAAOC,EAAS,CAC/B,OAAOA,EAAQ,qBAAqB,SAAW,CAAC,CAClD,EACA,uBAAwBD,EAAOC,EAAS,CACtC,OAAOA,EAAQ,qBAAqB,UAAY,CAAC,CACnD,EACA,uBAAwBD,EAAOC,EAAS,CACtC,OAAQA,EAAQ,qBAAqB,gBAAkB,CAAC,GAAG,KAAK,CAACC,EAAGC,IAAMD,EAAE,OAASC,EAAE,OAAS,EAAI,EAAE,CACxG,CACF,EC+CA,IAAOC,GAAS,CACd,oBAAqBC,EAAOC,EAAS,CACnC,OAAOA,EAAQ,kBAAkB,YACnC,EACA,sBAAuBD,EAAOC,EAAS,CACrC,OAAQD,GAAUA,EAAM,UAAY,CAAC,CACvC,EACA,cAAeA,EAAOC,EAAS,CAC7B,OAAOA,EAAQ,sBAAsBA,EAAQ,iBAAiB,CAChE,EACA,cAAeD,EAAOC,EAAS,CAC7B,OAAOC,GACYD,EAAQ,kBAAkB,WACzBC,CAAM,GAAG,SAAWC,GAAe,MAEzD,EACA,cAAeH,EAAOC,EAAS,CAC7B,OAAOC,GACYD,EAAQ,kBAAkB,WACzBC,CAAM,GAAG,SAAWC,GAAe,OAEzD,EACA,qBAAsBH,EAAOC,EAAS,CACpC,MAAO,CAACD,EAAOE,IAAW,CACxB,IAAME,EAAWJ,EAAM,SACvB,OAAOI,GAAYA,EAASF,CAAM,GAAK,CACrC,GAAGE,EAASF,CAAM,EAClB,IAAI,cAAgB,CAGlB,OAAOD,EAAQ,yBAAyBC,CAAM,GAAK,KAAK,UAC1D,CACF,CACF,CACF,EACA,aAAcF,EAAOC,EAAS,CAC5B,OAAOC,GAAUD,EAAQ,qBAAqBA,EAAQ,kBAAmBC,CAAM,CACjF,EACA,sBAAuBF,EAAOC,EAAS,CACrC,OAAQD,GAAU,CAChB,IAAMI,EAAW,CAAC,EAClB,QAAWF,KAAWF,EAAM,UAAY,CAAC,EAAI,CAC3C,IAAMK,EAAUJ,EAAQ,qBAAqBD,EAAOE,CAAM,EACtDG,EAAQ,SAAWF,GAAe,SACpCC,EAASF,CAAM,EAAIG,EAEvB,CACA,OAAOD,CACT,CACF,EACA,cAAeJ,EAAOC,EAAS,CAC7B,OAAOA,EAAQ,sBAAsBA,EAAQ,iBAAiB,CAChE,EACA,iBAAkBD,EAAOC,EAAS,CAChC,OAAOA,EAAQ,aAAaA,EAAQ,mBAAmB,EAAE,UAC3D,EACA,2BAA4BD,EAAOC,EAAS,CAC1C,OAAOD,GAASC,EAAQ,sBAAsBD,CAAK,EAAE,aACvD,EACA,mBAAoBA,EAAOC,EAAS,CAClC,OAAOA,EAAQ,2BAA2BA,EAAQ,iBAAiB,CACrE,EACA,qBAAsBD,EAAOC,EAAS,CACpC,OAAOA,EAAQ,cAAc,eAC/B,EAEA,8BAA+BD,EAAOC,EAAS,CAC7C,OAAOD,GAAS,CACd,GAAM,CAAE,iBAAAM,EAAkB,yBAAAC,CAAyB,EAAIN,EAAQ,sBAAsBD,CAAK,EAC1F,GAAI,CAACM,EAAkB,MAAO,CAAC,EAG/B,IAAME,EAAO,OAAO,KAAKP,EAAQ,4BAA4BD,CAAK,CAAC,EAAE,KAAK,EAE1E,MAAI,CAACQ,EAAK,QAAUC,GAAoB,GACtCD,EAAK,KAAKE,GAAkBC,GAAcL,EAAkB,CAACC,CAAwB,CAAC,CAAC,EAGrFC,EAAKA,EAAK,OAAS,CAAC,IAAMF,GAC5BE,EAAK,KAAKF,CAAgB,EAErBE,CACT,CACF,EACA,sBAAuBR,EAAOC,EAAS,CACrC,OAAOA,EAAQ,8BAA8BA,EAAQ,iBAAiB,CACxE,EASA,6BAA8BD,EAAOC,EAAS,CAC5C,MAAO,CAACD,EAAOY,EAAqBC,IAC3BC,GAAoBF,EAAM,CAC/B,kBAAmBC,GAAWZ,EAAQ,8BAA8BD,CAAK,EACzE,aAAcC,EAAQ,sBAAsBD,CAAK,EAAE,wBACrD,CAAC,EAAE,OAEP,EACA,qBAAsBA,EAAOC,EAAS,CACpC,MAAO,CAACW,EAAqBC,IACpBZ,EAAQ,6BAA6BA,EAAQ,kBAAmBW,EAAMC,CAAO,CAExF,EACA,2BAA4Bb,EAAOC,EAAS,CAC1C,MAAO,CAACc,EAAoBC,EAAqBH,IACxCC,GAAoBE,EAAa,CACtC,kBAAmBH,GAAWZ,EAAQ,8BAA8Bc,CAAU,EAC9E,aAAcd,EAAQ,sBAAsBc,CAAU,EAAE,wBAC1D,CAAC,EAAE,QAEP,EACA,mBAAoBf,EAAOC,EAAS,CAClC,MAAO,CAACe,EAAqBH,IAAuBZ,EAAQ,2BAA2BA,EAAQ,kBAAmBe,EAAaH,CAAO,CACxI,EACA,0BAA2Bb,EAAOC,EAAS,CACzC,MAAO,CAACc,EAAoBC,EAAqBH,IACxCC,GAAoBE,EAAa,CACtC,kBAAmBH,GAAWZ,EAAQ,8BAA8Bc,CAAU,EAC9E,aAAcd,EAAQ,sBAAsBc,CAAU,EAAE,wBAC1D,CAAC,EAAE,IAEP,EACA,kBAAmBf,EAAOC,EAAS,CACjC,MAAO,CAACe,EAAqBH,IAAuBZ,EAAQ,0BAA0BA,EAAQ,kBAAmBe,EAAaH,CAAO,CACvI,EACA,yBAA0Bb,EAAOC,EAAS,CACxC,MAAO,CAACD,EAAOgB,EAAqBH,IAI3BZ,EAAQ,0BAA0BD,EAAOgB,EAAaH,CAAO,CAExE,EACA,iBAAkBb,EAAOC,EAAS,CAChC,MAAO,CAACe,EAAqBH,IACpBZ,EAAQ,yBAAyBA,EAAQ,kBAAmBe,EAAaH,CAAO,CAE3F,EACA,+BAAgCb,EAAOC,EAAS,CAC9C,MAAO,CAACD,EAAOgB,IAAgB,CAC7B,IAAMC,EAAiBhB,EAAQ,4BAA4BD,CAAK,EAAEgB,CAAW,EAC7E,GAAIC,EACF,OAAOC,GAA+BD,CAAc,CAExD,CACF,EACA,uBAAwBjB,EAAOC,EAAS,CACtC,OAAQe,GACCf,EAAQ,+BAA+BA,EAAQ,kBAAmBe,CAAW,CAExF,EACA,yBAA0BhB,EAAOC,EAAS,CACxC,OAAO,OAAO,KAAKA,EAAQ,aAAa,CAC1C,EACA,kBAAmBD,EAAOC,EAAS,CACjC,OAAOA,EAAQ,yBAAyB,MAC1C,EACA,oBAAqBD,EAAOC,EAAS,CACnC,IAAMkB,EAAUlB,EAAQ,kBAAkB,QACpCmB,EAAYnB,EAAQ,kBAAkB,IAAI,QAC1CoB,EAAiB,OAAO,OAAO,IAAI,EACzC,QAAWC,KAAeH,EAEtBC,EAAUE,CAAW,EAAE,SAAWC,GAAc,OAC5CJ,EAAQG,CAAW,EAAE,YAAcE,KAEvCH,EAAeC,CAAW,EAAI,CAC5B,YAAaH,EAAQG,CAAW,EAAE,QAClC,UAAWH,EAAQG,CAAW,EAAE,UAChC,QAASF,EAAUE,CAAW,EAAE,OAClC,GAGJ,OAAOD,CACT,EACA,mBAAoBrB,EAAOC,EAAS,CAClC,OAAOA,EAAQ,mBAAqB,CACtC,EACA,yBAA0BD,EAAOC,EAAS,CACxC,OAAQwB,GAAwBA,GAAexB,EAAQ,eAAe,gBACxE,EACA,sBAAuBD,EAAOC,EAAS,CACrC,MAAO,CAACyB,EAAeC,KACd1B,EAAQ,cAAc,YAAYyB,CAAY,CAEzD,EACA,cAAe1B,EAAOC,EAAS,CAC7B,IAAM2B,EAAkB3B,EAAQ,qBAChC,OAAO2B,GAAmBC,GAAWD,CAAe,CACtD,EACA,sBAAuB5B,EAAOC,EAAS,CACrC,OAAOA,EAAQ,oBAAoBA,EAAQ,kBAAkB,CAC/D,EACA,2BAA4BD,EAAOC,EAAS,CAC1C,OAAOA,EAAQ,eAAe,cAChC,EACA,4BAA6BD,EAAOC,EAAiB,CAEnD,OAAQD,GACCA,EAAM,kBAAoB,CAAC,CAEtC,EACA,oBAAqBA,EAAOC,EAAiB,CAC3C,OAAOA,EAAQ,4BAA4BA,EAAQ,iBAAiB,CACtE,EACA,mBAAoBD,EAAOC,EAAiB,CAC1C,OAAOA,EAAQ,kBAAkB,eAAiB,CAAC,CACrD,EACA,aAAcD,EAAOC,EAAiB,CACpC,OAAOA,EAAQ,kBAAkB,SAAW,CAAC,CAC/C,EACA,uBAAwBD,EAAOC,EAAiB,CAC9C,OAAOA,EAAQ,kBAAkB,mBAAqB,CACxD,EACA,kBAAmBD,EAAOC,EAAS,CAKjC,OAAOA,EAAQ,eAAe,mBAChC,EACA,eAAgBD,EAAOC,EAAS,CAC9B,OAAOA,EAAQ,kBAAkB,SACnC,EACA,uBAAwBD,EAAOC,EAAS,CACtC,OAAOA,EAAQ,kBAAkB,iBACnC,EAIA,+BAAgCD,EAAOC,EAAS,CAC9C,MAAO,CAACD,EAAO8B,IAA0B,CAGvC,IAAMC,EAAgB9B,EAAQ,sBAAsBD,CAAK,EACnDgC,EAAY,CAAC,EACnB,QAAWC,KAAYF,EAAe,CACpC,GAAM,CAAE,kBAAAG,EAAmB,WAAAC,CAAW,EAAIJ,EAAcE,CAAQ,EAChE,GAAIC,EAAmB,CACrB,IAAME,EAASL,EAAcE,CAAQ,EAAEC,CAAiB,EAClDG,EAAWH,IAAsB,eAAiBE,EAASnC,EAAQ,2BAA2BD,CAAK,EAAIoC,EAEzGE,EAAOC,GAAoBT,CAAa,EAAE,YAAY,EACtDU,GAAmB,CACrB,KAAML,EACN,YAAaL,EACb,aAAc7B,EAAQ,sBAAsBD,CAAK,EAAE,wBACrD,CAAC,IACCsC,EAAOH,GAETH,EAAU,KAAK,CAAE,SAAAC,EAAU,SAAAI,EAAU,KAAAC,CAAK,CAAC,CAC7C,CACF,CACA,OAAON,CACT,CACF,EACA,uBAAwBhC,EAAOC,EAAS,CACtC,OAAQ6B,GACC7B,EAAQ,+BAA+BA,EAAQ,kBAAmB6B,CAAa,CAE1F,EACA,0BAA2B9B,EAAOC,EAAS,CACzC,MAAO,CAACD,EAAOgB,IAAgB,CAC7B,IAAMyB,EAASxC,EAAQ,+BAA+BD,EAAOgB,CAAW,EAClE0B,EAAS,CAAC,EAChB,GAAID,GAAUA,EAAO,OAAS,EAAG,CAC/B,IAAME,EAAW3C,EAAM,SACvB,QAAW4C,KAAeH,EAAQ,CAChC,IAAMI,EAAUF,EAASC,CAAW,EAChCC,EAAQ,KAAK,SAAWC,IAC1BJ,EAAO,KAAKK,GAAkBH,EAAaC,CAAO,CAAC,CAEvD,CACF,CACA,OAAOH,CACT,CACF,EACA,kBAAmB1C,EAAOC,EAAS,CACjC,OAAQe,GACCf,EAAQ,0BAA0BA,EAAQ,kBAAmBe,CAAW,CAEnF,CAWF,ECxWA,IAAOgC,GAAS,CACd,WAAYC,EAAOC,EAAS,CAC1B,OAAOA,EAAQ,qBAAqB,UACtC,EACA,kBAAmBD,EAAOC,EAAS,CACjC,OAAOA,EAAQ,qBAAqB,WAAa,CAAC,CACpD,CACF,ECEA,IAAMC,GAAkB,CAACC,EAAeC,EAAkBC,IAAmB,CAC3E,GAAID,GAAYD,EAAM,mBAAmBC,CAAQ,IAAMC,EACrD,OAAOD,CAEX,EAIME,GAAwB,CAACC,EAAiBC,IAC9C,OAAO,KAAKD,CAAO,EAAE,KAAKE,GAExBF,EAAQE,CAAM,EAAE,YAAcC,IAE9BF,EAAQ,kBAAkB,IAAI,QAAQC,CAAM,EAAE,SAAWE,GAAc,OAGvE,EAAEH,EAAQ,kBAAkB,IAAI,QAAQC,CAAM,EAAE,QAAU,KAAK,IAAI,IAEnE,EAAED,EAAQ,kBAAkB,IAAI,QAAQC,CAAM,EAAE,UAAY,EAC9D,EAIID,GAAkF,CA2BtF,kBAAmBL,EAAO,CAUxB,OAAOA,EAAMA,EAAM,cAAc,GAAK,CAAC,CACzC,EACA,qBAAsBA,EAAO,CAC3B,OAAQA,EAAM,UAAYA,EAAMA,EAAM,SAAS,kBAAkB,GAAM,CAAC,CAC1E,EACA,YAAaA,EAAOK,EAAS,CAC3B,OAAOL,EAAM,UAAYK,EAAQ,eAAeL,EAAM,SAAS,kBAAkB,CACnF,EACA,eAAgBA,EAAO,CACrB,OAAOA,EAAM,WACf,EACA,iBAAkBA,EAAOK,EAAS,CAChC,OAAOA,EAAQ,cAAcA,EAAQ,qBAAqB,CAC5D,EACA,iBAAkBL,EAAOK,EAAS,CAChC,OAAOA,EAAQ,cAAcA,EAAQ,qBAAqB,CAC5D,EACA,wBAAyBL,EAAOK,EAAS,CACvC,OAAQL,GAAUK,EAAQ,qBAAqBL,EAAOK,EAAQ,qBAAqB,CACrF,EACA,gBAAiBL,EAAOK,EAAS,CAC/B,OAAOA,EAAQ,wBAAwBA,EAAQ,iBAAiB,CAClE,EACA,mBAAoBL,EAAOK,EAAS,CAGlC,OADqBA,EAAQ,sBAAwB,CAAC,GAClC,YAAY,aAAeA,EAAQ,aAAeA,EAAQ,qBAChF,EACA,sBAAuBL,EAAO,CAC5B,OAAOA,EAAM,UAAYA,EAAM,SAAS,kBAC1C,EACA,UAAWA,EAAOK,EAAS,CACzB,IAAMI,EAAqBJ,EAAQ,sBACnC,OAAKI,EAEE,OAAO,KAAKT,EAAMS,CAAkB,GAAG,QAAU,CAAC,CAAC,EAAE,OACzDC,GAAQ,CAACV,EAAMS,CAAkB,EAAE,OAAOC,CAAG,EAAE,SAAWV,EAAMU,CAAG,CACtE,EAJgC,CAAC,CAKnC,EACA,yBAA0BV,EAAO,CAC/B,OAAOA,EAAM,aAAaA,EAAM,cAAc,GAAK,CAAC,CACtD,EAIA,uBAAwBA,EAAOK,EAAS,CACtC,IAAMM,EAAgBN,EAAQ,cACxBO,EAAwBP,EAAQ,sBAChCQ,EAAkBR,EAAQ,gBAEhC,GAAI,CAACQ,GAAmB,CAACA,EAAgB,kBACvC,MAAO,CAAC,EAGV,IAAMC,EAAiBD,EAAgB,oBAAsB,eACvDE,EAAeV,EAAQ,wBAEvBW,EAA8BC,GAAaN,EAAcM,CAAQ,EAAE,0BAA4B,CAAC,EAEtG,MAAO,CACL,gBAAiB,IAAM,CACrB,GAAIH,EAAkB,OAAO,KAC7B,IAAMI,EAAM,CAAC,EACPC,EAAS,CAAC,EACVC,EAAQL,EACX,OAAOM,GAAKA,EAAE,eAAiBT,CAAqB,EACpD,OAAO,CAACU,EAAKC,KACZL,EAAI,KAAKb,EAAQ,sBAAsBkB,EAAQ,UAAU,CAAC,EAC1DJ,EAAO,KAAKI,EAAQ,UAAU,EAEvBD,EAAMC,EAAQ,QACpB,CAAC,EAEN,MAAO,CAAE,IAAAL,EAAK,OAAAC,EAAQ,MAAAC,EAAO,QAASP,EAAgB,YAAa,CACrE,GAAG,EACH,mBAAoB,IAAM,CACxB,GAAI,CAACC,EAAkB,OAAO,KAC9B,IAAMU,EAASnB,EAAQ,cAAc,cAAgBQ,EAAgB,aAC/DK,EAAM,CAAC,EACPC,EAAS,CAAC,EACVC,EAAQL,EACX,OAAOM,GAAKA,EAAE,aAAeT,CAAqB,EAClD,OAAO,CAACU,EAAKC,KACZL,EAAI,KAAKb,EAAQ,sBAAsBkB,EAAQ,YAAY,CAAC,EAC5DJ,EAAO,KAAKI,EAAQ,YAAY,EAEzBD,EAAMC,EAAQ,QACpB,CAAC,EAEN,MAAO,CAAE,IAAAL,EAAK,OAAAC,EAAQ,MAAAC,EAAO,OAAAI,CAAO,CACtC,GAAG,EACH,sBAAuB,IAAM,CAC3B,IAAMC,EAAU,OAAO,KAAKd,CAAa,EACtC,OAAOM,GAAYA,IAAaL,GAAyBI,EAA2BC,CAAQ,EAAE,OAAS,CAAC,EACrGS,EAAWD,EAAQ,OAAO,CAACE,EAAOV,IAAa,CACnD,IAAMW,EAAcvB,EAAQ,sBAAsBY,CAAQ,EAG1D,OAF0BD,EAA2BC,CAAQ,EAE3C,QAASY,GAAS,CAClC,IAAMC,EAAoBH,EAAM,UAAUI,GAAKA,EAAE,OAASF,CAAI,EAE1DC,GAAqB,GACvBH,EAAMG,CAAiB,EAAE,IAAI,KAAKF,CAAW,EAC7CD,EAAMG,CAAiB,EAAE,OAAO,KAAKb,CAAQ,GAE7CU,EAAM,KAAK,CAAE,IAAK,CAACC,CAAW,EAAG,OAAQ,CAACX,CAAQ,EAAG,KAAAY,CAAK,CAAC,CAE/D,CAAC,EACMF,CACT,EAAG,CAAC,CAAC,EAEL,OAAOF,EAAQ,OAAS,EAAI,CAAE,KAAMC,EAAU,IAAKD,CAAQ,EAAI,IACjE,GAAG,EACH,mBAAoB,IAAM,CACxB,IAAMO,EAAgBnB,EAAgB,yBAEtC,OAAOmB,EAAc,OAAS,EAAIA,EAAgB,IACpD,GAAG,CACL,CACF,EACA,eAAgBhC,EAAOK,EAAS,CAC9B,OAAQH,GACUG,EAAQ,uBAAuBH,CAAM,GACrC,UAAYF,EAAM,wBAAwBE,CAAM,GAAKA,CAEzE,EACA,sBAAuBF,EAAOK,EAAS,CACrC,OAAQH,GAAW,CACjB,GAAIA,IAAWG,EAAQ,sBACrB,OAAOA,EAAQ,mBAEjB,IAAM4B,EAAU5B,EAAQ,uBAAuBH,CAAM,EACrD,OAAO+B,GAAS,aAAeA,GAAS,UAAYjC,EAAM,wBAAwBE,CAAM,GAAKA,CAC/F,CACF,EACA,8BAA+BF,EAAOK,EAAS,CAC7C,OAAQL,GACCK,EAAQ,4BAA4BL,CAAK,EAAEK,EAAQ,6BAA6BL,CAAK,CAAC,CAEjG,EACA,sBAAuBA,EAAOK,EAAS,CACrC,OAAOA,EAAQ,8BAA8BA,EAAQ,iBAAiB,CACxE,EACA,aAAcL,EAAOK,EAAS,CAC5B,IAAM6B,EAAiB7B,EAAQ,oBAC/B,GAAI,OAAO,KAAK6B,CAAc,EAAE,SAAW,EAAG,OAC9C,IAAMtB,EAAwBP,EAAQ,sBAChC8B,EAAU9B,EAAQ,mBAAmBA,EAAQ,oBAAoB,EACjE+B,EAAYF,EAAeC,CAAO,EACxC,GAAIC,EACF,OAAOA,EAAU,yBAAyB,OAAOC,GAAQA,EAAK,eAAiBzB,CAAqB,CAExG,EAEA,wBAAyBZ,EAAOK,EAAS,CACvC,OAAOiC,GAAuB,CAC5B,UAAWjC,EAAQ,uBAAuBA,EAAQ,oBAAoB,EACtE,SAAU,EACZ,CAAC,CACH,EAEA,wCAAyCL,EAAOK,EAAS,CACvD,OAAQL,GAAU,CAChB,IAAMuC,EAAclC,EAAQ,8BAA8BL,CAAK,EAC/D,GAAIuC,GAAeA,EAAY,yBAC7B,OAAOA,EAAY,yBACd,CACL,IAAMC,EAASnC,EAAQ,6BAA6BL,CAAK,EACzD,OAAOyC,GAAqB,CAC1B,aAAcH,GAAuB,CACnC,UAAWjC,EAAQ,+BAA+BL,EAAOwC,CAAM,EAC/D,SAAUnC,EAAQ,sBAAsBL,CAAK,EAAE,oBACjD,CAAC,EACD,SAAUK,EAAQ,0BAA0BL,EAAOwC,CAAM,EACzD,MAAOnC,EAAQ,yBAAyBL,EAAOwC,CAAM,CACvD,CAAC,CACH,CACF,CACF,EACA,gCAAiCxC,EAAOK,EAAS,CAC/C,OAAOA,EAAQ,wCAAwCA,EAAQ,iBAAiB,CAClF,EACA,gCAAiCL,EAAOK,EAAS,CAC/C,MAAO,CAACL,EAAOwC,IAAW,CACxB,IAAMN,EAAiB7B,EAAQ,4BAA4BL,CAAK,EAChE,GAAI,OAAO,KAAKkC,CAAc,EAAE,SAAW,EAAG,OAC9C,IAAMQ,EAAW,CAAC,EACZC,EAAqBT,EAAeM,CAAM,EAC1CI,EAAeD,GAAsBA,EAAmB,aAC9D,GAAIC,EAAc,CAChB,IAAMhC,EAAwBP,EAAQ,sBAChCwC,EAAc7C,EAAM,SAC1B,QAAW8C,KAAcF,EAAahC,CAAqB,EACzD,QAAWmC,KAAeH,EAAahC,CAAqB,EAAEkC,CAAU,EAAG,CACzE,GAAM,CAAE,KAAAE,EAAM,KAAAC,EAAM,OAAAC,CAAO,EAAIL,EAAYE,CAAW,EAEtDL,EAAS,KAAK,CAAE,KAAMK,EAAa,OAAAG,EAAQ,KAAAF,EAAM,KAAAC,EAAM,OAAQD,EAAK,OAAQ,OAAAR,CAAO,CAAC,CACtF,CAEJ,CACA,OAAOE,EAAS,KAAK,CAACS,EAAUC,IAAaA,EAAS,OAASD,EAAS,MAAM,CAChF,CACF,EACA,wBAAyBnD,EAAOK,EAAS,CACvC,OAAQmC,GAAWnC,EAAQ,gCAAgCA,EAAQ,kBAAmBmC,CAAM,CAC9F,EACA,oCAAqCxC,EAAOK,EAAS,CACnD,MAAO,CAACL,EAAOwC,IAAW,CACxB,IAAMN,EAAiB7B,EAAQ,4BAA4BL,CAAK,EAChE,GAAI,OAAO,KAAKkC,CAAc,EAAE,SAAW,EAAG,OAC9C,IAAMQ,EAAW,CAAC,EACZC,EAAqBT,EAAeM,CAAM,EAC1CI,EAAeD,GAAsBA,EAAmB,aAC9D,GAAIC,EAAc,CAChB,IAAMhC,EAAwBP,EAAQ,sBAChCwC,EAAc7C,EAAM,SAC1B,QAAWqD,KAAgBT,EACzB,QAAWE,KAAcF,EAAaS,CAAY,EAChD,GAAIP,IAAelC,EACjB,QAAWmC,KAAeH,EAAaS,CAAY,EAAEP,CAAU,EAAG,CAChE,GAAM,CAAE,KAAAE,EAAM,KAAAC,EAAM,OAAAC,CAAO,EAAIL,EAAYE,CAAW,EAEtDL,EAAS,KAAK,CAAE,KAAMK,EAAa,OAAAG,EAAQ,KAAAF,EAAM,KAAAC,EAAM,OAAQD,EAAK,MAAO,CAAC,CAC9E,CAIR,CACA,OAAON,EAAS,KAAK,CAACS,EAAUC,IAAaA,EAAS,OAASD,EAAS,MAAM,CAChF,CACF,EACA,4BAA6BnD,EAAOK,EAAS,CAC3C,OAAQmC,GAAWnC,EAAQ,oCAAoCA,EAAQ,kBAAmBmC,CAAM,CAClG,EACA,oBAAqBxC,EAAOK,EAAS,CACnC,OAAQL,GAAU,CAChB,IAAMkC,EAAiB7B,EAAQ,4BAA4BL,CAAK,EAChE,GAAI,OAAO,KAAKkC,CAAc,EAAE,SAAW,EAAG,OAC9C,IAAMtB,EAAwBP,EAAQ,sBAChCiD,EAAUjD,EAAQ,6BAA6BL,CAAK,EACpDmC,EAAU9B,EAAQ,2BAA2BL,EAAOsD,CAAO,EAC3DC,EAAclD,EAAQ,gCAAgCL,EAAOsD,CAAO,EACpEE,EAAenD,EAAQ,gCAAgCL,EAAOmC,CAAO,EACrEsB,EAAkBpD,EAAQ,oCAAoCL,EAAOsD,CAAO,EAC5EI,EAAmBrD,EAAQ,oCAAoCL,EAAOmC,CAAO,EAG7EE,EAAO,IACJhC,EAAQ,wCAAwCL,CAAK,EAAE,OAAOqB,GAAKA,EAAE,eAAiBT,CAAqB,EAGpH,MAAO,CACL,KAAM,CAAC,GAAG2C,EAAa,GAAGC,CAAY,EACtC,SAAU,CAAC,GAAGC,EAAiB,GAAGC,CAAgB,EAClD,KAAMrB,EAAK,CACb,CACF,CACF,EACA,YAAarC,EAAOK,EAAS,CAC3B,OAAOA,EAAQ,oBAAoBA,EAAQ,iBAAiB,CAC9D,EACA,mBAAoBL,EAAOK,EAAS,CAClC,IAAMsD,EAAWtD,EAAQ,gBAAgB,oBAAsB,eACzDO,EAAwBP,EAAQ,sBAChCuD,EAAgBrC,GACboC,EAAWpC,EAAQ,aAAeX,EAAwBW,EAAQ,eAAiBX,EAEtFiD,EAAqB,CAACvC,EAAKC,IAAYD,EAAMC,EAAQ,OACrD+B,EAAUjD,EAAQ,qBAClByD,EAAsBzD,EAAQ,gCAAgC,OAAOuD,CAAY,EACjFG,EAAiBJ,EACnBtD,EAAQ,4BAA4BiD,CAAO,EAC3CjD,EAAQ,wBAAwBiD,CAAO,EAErCU,EAAsBD,EAAe,OAAOxC,GAAWA,EAAQ,KAAK,SAAW0C,EAAoB,EACnGC,EAA2BF,EAAoB,OAAOH,EAAoB,CAAC,EAE3EM,EAAgBL,EAAoB,OAASC,EAAe,OAC5DK,EAAkBN,EAAoB,OAAQzC,GAAM,CAACA,EAAE,MAAM,EAC7DgD,EAAeF,EAAgBC,EAAgB,OAASJ,EAAoB,OAC5EM,EAAcR,EAAoB,KAAKzC,GAAKA,EAAE,OAAO,EACrDkD,EAAaR,EAAe,OAAOF,EAAoB,CAAC,EAAIK,EAC5DM,EAAaV,EAAoB,OAAO,CAACxC,EAAKC,IAAYD,EAAMC,EAAQ,OAAQ,CAAC,EAAI2C,EACrFO,EAAcF,EAAaC,EACjC,MAAO,CACL,aAAAH,EACA,YAAAC,EACA,cAAAH,EACA,WAAAI,EACA,YAAAE,CACF,CACF,EACA,qBAAsBzE,EAAOK,EAAS,CACpC,IAAMD,EAAUC,EAAQ,kBAAkB,QACpCqE,EAAWvE,GAAsBC,EAASC,CAAO,EACjDsE,EAAUtE,EAAQ,kBAAkB,IAAI,QAAQqE,CAAQ,EAAE,QAChE,MAAO,CAAE,SAAAA,EAAU,QAAAC,CAAQ,CAC7B,EAEA,aAAc3E,EAAOK,EAAS,CAC5B,IAAMI,EAAqBJ,EAAQ,sBAC7BuE,EAAS5E,EAAMS,CAAkB,GAAG,OAC1C,OAAKmE,EAKE,OAAO,QAAQA,CAAM,EAEzB,OAAO,CAAC,CAAC,CAAE,CAAE,QAAAC,CAAQ,CAAC,IAAM,CAACA,CAAO,EACpC,IAAI,CAAC,CAACC,CAAU,KAAO,CAAE,UAAW9E,EAAM8E,CAAU,GAAG,UAAU,WAAaC,EAAE,SAAS,EAAG,WAAAD,EAAY,OAAQ9E,EAAM8E,CAAU,GAAG,WAAWrE,CAAkB,GAAG,SAAWuE,GAAe,MAAO,EAAE,EARrL,CAAC,CASvB,EACA,gBAAiBhF,EAAOK,EAAS,CAC/B,OAAO4E,GAAW,CAChB,IAAMC,EAAW,CAAC,EAClB,GAAIlF,EAAM,UAAUiF,CAAO,GAAG,OAAS,qBACrC,OAAOC,EAET,IAAMvE,EAAgBX,EAAMiF,CAAO,EAAE,UAAY,CAAC,EAClD,QAAWE,KAAUxE,EAAe,CAClC,IAAMsB,EAAUtB,EAAcwE,CAAM,EAChClD,EAAQ,SAAW+C,GAAe,SACpCE,EAASC,CAAM,EAAIlD,EAEvB,CACA,OAAOiD,CACT,CACF,EACA,mBAAoBlF,EAAOK,EAAS,CAClC,IAAM6E,EAAW7E,EAAQ,kBAAkB,SAC3C,GAAI,CAAC6E,GAAY,CAACA,EAAS7E,EAAQ,qBAAqB,EAAG,MAAO,CAAC,EACnE,IAAM+E,EAAiBF,EAAS7E,EAAQ,qBAAqB,EAAE,aACzDgF,EAAepE,GAAa,CAChC,GAAIA,IAAaZ,EAAQ,sBAAyB,MAAO,GACzD,IAAMiF,EAAgBJ,EAASjE,CAAQ,EACvC,GAAI,CAACqE,EAAe,MAAO,GAC3B,IAAMC,EAAqBD,EAAc,aACnCE,EAAiB,IAAI,KAAKF,EAAc,UAAU,EAAE,QAAQ,EAElE,OADsBF,EAAiBG,GACf,KAAK,IAAI,EAAIC,EAAiB,MACxD,EAEMC,EAAsBpF,EAAQ,oBAGpC,MAAO,CAACoF,EAAqBpF,EAAQ,aAAa,EAAE,QAAQ,OAAO,IAAI,EACpE,OAAOY,GAAYZ,EAAQ,cAAcY,CAAQ,GAC9C,EAAEZ,EAAQ,oBAAoBY,CAAQ,EAAE,QAAU,KAAK,IAAI,EAAE,EAChE,IAAIA,GAAY,CACf,GAAM,CAAE,WAAA6D,EAAY,YAAAlD,EAAa,SAAA3B,CAAS,EAAII,EAAQ,cAAcY,CAAQ,GAAKwE,EAAoBxE,CAAQ,IAAMZ,EAAQ,cAAcY,CAAQ,EAAI,CAAE,WAAYA,CAAS,EAAI,CAAC,GACjL,MAAO,CACL,GAAIA,EACJ,WAAA6D,EACA,SAAA7E,EACA,YAAa2B,GAAe3B,GAAYgB,EACxC,UAAWZ,EAAQ,oBAAoBY,CAAQ,EAC/C,MAAOoE,EAAYpE,CAAQ,CAC7B,CACF,CAAC,EACA,KAAK,CAACyE,EAAOC,IAAU,CACtB,IAAMC,EAAQF,EAAM,YAAY,UAAU,EAAE,YAAY,EAClDG,EAAQF,EAAM,YAAY,UAAU,EAAE,YAAY,EAExD,OAAID,EAAM,WAAa,CAACC,EAAM,UAAoB,GAC9C,CAACD,EAAM,WAAaC,EAAM,UAAoB,EAE9CD,EAAM,OAAS,CAACC,EAAM,MAAgB,GACtC,CAACD,EAAM,OAASC,EAAM,MAAgB,EAEnCC,EAAQC,EAAQ,GAAK,CAC9B,CAAC,CACL,EACA,eAAgB7F,EAAOK,EAAS,CAC9B,OAAOyE,GAAc9E,EAAM8E,CAAU,GAAG,SAC1C,EACA,cAAe9E,EAAOK,EAAS,CAE7B,OAAOY,GACEZ,EAAQ,uBAAuBY,CAAQ,CAElD,EACA,6BAA8BjB,EAAOK,EAAS,CAC5C,IAAM6E,EAAW,CAAC,EAClB,cAAO,KAAKlF,EAAM,SAAS,EACxB,OAAO8E,GAAc9E,EAAM,UAAU8E,CAAU,GAAG,OAAS,uBAAuB,EAClF,QAAQA,GAAc,CACrB,IAAMgB,EAAa9F,EAAM8E,CAAU,EAAE,WACrC,GAAIgB,EAAY,CACd,IAAM7F,EAAWF,GAAgBC,EAAO8F,EAAW,SAAUhB,CAAU,EACvE,GAAI,CAAC7E,EAAU,OACfiF,EAASjF,CAAQ,EAAI,CACnB,GAAG6F,EACH,SAAA7F,EACA,WAAA6E,CACF,CACF,CACF,CAAC,EACII,CACT,EACA,uBAAwBlF,EAAOK,EAAS,CACtC,IAAM6E,EAAW,CAAC,EAClB,cAAO,KAAKlF,EAAM,SAAS,EACxB,OAAO8E,GAAc9E,EAAM,UAAU8E,CAAU,GAAG,OAAS,uBAAuB,EAClF,QAAQA,GAAc,CACrB,IAAMgB,EAAa9F,EAAM8E,CAAU,GAAG,WACtC,GAAIgB,EAAY,CACd,IAAM7F,EAAWF,GAAgBC,EAAO8F,EAAW,SAAUhB,CAAU,EACvEI,EAASJ,CAAU,EAAI,CACrB,GAAGgB,EACH,SAAA7F,EACA,WAAA6E,CACF,CACF,MACEI,EAASJ,CAAU,EAAI,CACrB,WAAAA,CACF,CAEJ,CAAC,EAIH,OAAO,KAAK9E,EAAM,uBAAuB,EAAE,QAAS8E,GAAe,CAC7DI,EAASJ,CAAU,GAAK9E,EAAM,UAAU8E,CAAU,IAAM,OAC5DI,EAASJ,CAAU,EAAI,CACrB,SAAU9E,EAAM,wBAAwB8E,CAAU,EAClD,WAAAA,CACF,EACF,CAAC,EACMI,CACT,EACA,gCAAiClF,EAAOK,EAAS,CAC/C,IAAM0F,EAAyB,OAAO,KAAK1F,EAAQ,kBAAkB,UAAY,CAAC,CAAC,EAC7E2F,EAAW,CAAC,EAElB,QAAWvF,KAAsBJ,EAAQ,uBACnC0F,EAAuB,SAAStF,CAAkB,IACpDuF,EAASvF,CAAkB,EAAIJ,EAAQ,uBAAuBI,CAAkB,GAGpF,OAAOuF,CACT,EACA,gBAAiBhG,EAAOK,EAAS,CAC/B,OAAO,OAAO,KAAKA,EAAQ,sBAAsB,EAC9C,KAAK,CAAC4F,EAASC,IAAY,CAC1B,IAAMN,EAAUvF,EAAQ,uBAAuB4F,CAAO,EAAE,aAAiB5F,EAAQ,uBAAuB4F,CAAO,EAAE,UAAYA,EACvHJ,EAAUxF,EAAQ,uBAAuB6F,CAAO,EAAE,aAAiB7F,EAAQ,uBAAuB6F,CAAO,EAAE,UAAYA,EAC7H,OAAON,EAAM,UAAU,EAAE,YAAY,EAAIC,EAAM,UAAU,EAAE,YAAY,EAAI,EAAI,EACjF,CAAC,CACL,EACA,sBAAuB7F,EAAOK,EAAS,CACrC,OAAO,OAAO,KAAKA,EAAQ,4BAA4B,EACpD,KAAK,CAAC8F,EAAWC,IAAc,CAC9B,IAAMR,EAAQvF,EAAQ,6BAA6B8F,CAAS,EAAE,aAAeA,EACvEN,EAAQxF,EAAQ,6BAA6B+F,CAAS,EAAE,aAAeA,EAC7E,OAAOR,EAAM,UAAU,EAAE,YAAY,EAAIC,EAAM,UAAU,EAAE,YAAY,EAAI,EAAI,EACjF,CAAC,CACL,EACA,kBAAmB7F,EAAOK,EAAS,CACjC,OACEA,EAAQ,sBAAsB,SAASL,EAAM,cAAc,GAAG,SAE5DK,EAAQ,kBACRA,EAAQ,sBAAsB,SAASL,EAAM,cAAc,GAAG,iBAGpE,EACA,GAAGqG,GACH,GAAGC,GACH,GAAGC,EACL,EAEOC,GAAQnG,GCzhBf,IAAMoG,GAAqG,CACzG,cAAeC,EAAOD,EAASE,EAAW,CACxC,OAAOD,EAAM,MAAM,IAAIE,GAAQ,CAC7B,IAAMC,EAAe,CAAE,GAAGD,EAAM,GAAGF,EAAM,OAAOE,EAAK,IAAI,CAAE,EAE3D,OAAIE,GAAID,CAAY,EAAIE,GACf,MACE,CAACF,EAAa,MAAQC,GAAID,CAAY,EAAIG,KAGnDH,EAAa,KAAO,IAEfA,EACT,CAAC,EAAE,OAAO,OAAO,CACnB,EAEA,0BAA2BH,EAAOD,EAASE,EAAW,CACpD,OAAOF,EAAQ,cAAc,OAAOG,GAAQA,EAAK,UAAYD,EAAU,cAAc,CACvF,EAGA,qBAAsBD,EAAOD,EAAS,CACpC,OAAOQ,GAAWR,EAAQ,cAAc,OAAOG,GAAQA,EAAK,UAAYK,CAAO,CACjF,EAEA,oCAAqCP,EAAOD,EAAS,CACnD,OAAOA,EAAQ,gCAAgC,MACjD,EAGA,gCAAiCC,EAAOD,EAASE,EAAW,CAC1D,OAAOF,EAAQ,0BAA0B,OAAOG,GAAQ,CAACA,EAAK,IAAI,CACpE,EAEA,wBAAyBF,EAAOD,EAAS,CACvC,OAAOA,EAAQ,qBAAqB,OAAOS,EAAK,CAClD,EAEA,yBAA0BR,EAAOD,EAAS,CACxC,OAAOA,EAAQ,qBAAqB,MACtC,EAGA,qBAAsBC,EAAOD,EAASE,EAAW,CAC/C,OAAOF,EAAQ,cAAc,OAAOG,GAAQ,CAACA,EAAK,SAAWA,EAAK,UAAYD,EAAU,cAAc,CACxG,EAEA,0BAA2BD,EAAOD,EAAS,CACzC,OAAOA,EAAQ,qBAAqB,OAAOU,EAAO,CACpD,EAEA,+BAAgCT,EAAOD,EAAS,CAC9C,OAAOA,EAAQ,qBAAqB,OAAOG,GAAQ,CAACA,EAAK,IAAI,EAAE,MACjE,EAEA,2BAA4BF,EAAOD,EAAS,CAC1C,OAAOA,EAAQ,qBAAqB,OAAOG,GAAQ,CAACA,EAAK,IAAI,CAC/D,EAEA,6BAA8BF,EAAOD,EAAS,CAC5C,OAAOA,EAAQ,cAAc,OAAOG,GAAQ,CAACA,EAAK,IAAI,EAAE,MAC1D,EAGA,gCAAiCF,EAAOD,EAAS,CAC/C,OAAQQ,GAAYR,EAAQ,4BAA4BQ,CAAO,EAAE,MACnE,EAEA,4BAA6BP,EAAOD,EAASE,EAAW,CACtD,OAAQM,GACNA,IAAYN,EAAU,eAClBF,EAAQ,gCACRA,EAAQ,cAAc,OAAOG,GAAQ,CAACA,EAAK,MAAQA,EAAK,UAAYK,CAAO,CAEnF,CACF,EAEOG,GAAQX,GC/Df,IAAOY,GAAS,CACd,eAAgBC,EAAgF,CAC9F,GAAM,CAAE,SAAAC,EAAU,MAAAC,EAAO,QAAAC,EAAS,QAAAC,CAAQ,EAAIJ,EACxCK,EAAaF,EAAQ,WAAW,EAChCG,EAASH,EAAQ,OAAO,EACxBI,EAAQJ,EAAQ,eAAe,EACjCK,EACAD,IACE,CAACE,EAAU,oBAAqBA,EAAU,qBAAqB,EAAE,SAASH,CAAM,EAClFE,EAASD,EAAM,OACNH,GAAWE,IAAWG,EAAU,WAAa,OAAO,SAASL,EAAQ,KAAK,GAAK,CAACK,EAAU,oBAAqBA,EAAU,qBAAqB,EAAE,SAASF,EAAMH,EAAQ,KAAK,EAAE,CAAC,CAAC,IACzLI,EAASD,EAAMH,EAAQ,KAAK,EAAE,CAAC,EAAE,SAGrC,IAAMM,EAAQC,EAAI,kBAAkB,EAChCC,EAAKC,EAET,GAAIV,EAAQ,kBAAkB,EAAG,CAC/B,IAAMW,EAAyBC,GAA6BL,EAAMP,EAAQ,WAAW,CAAC,EAAGA,EAAQ,kBAAkB,CAAC,EAChHW,IACFF,EAAM,GAAGI,EAAoC,GAAGF,CAAsB,GACtED,EAAeF,EAAI,oBAAoB,EAAE,sBAAsBG,CAAsB,EAEzF,CAEA,IAAMG,EAAgB,CACpB,QAASf,EAAM,KACf,SAAAD,EACA,OAAQO,GAAUF,EAClB,SAAUI,EAAM,UAAUL,CAAU,GAAG,MAAQA,EAC/C,OAAQH,EAAM,OAChB,EAEMgB,EAAU,CACd,GAAGD,EACH,GAAGE,GAAM,GAAG,EACZ,IAAAP,CACF,EAEMQ,EAAmB,CACvB,GAAGH,EACH,IAAKJ,CACP,EAEA,MAAO,CACL,MAAOQ,EAAE,gBAAgB,EACzB,KAAMT,EACFS,EAAE,4FAA6FH,CAAO,EACtGG,EAAE,yEAA0EH,CAAO,EACvF,cAAeN,EACXS,EAAE,oFAAqFD,CAAgB,EACvGC,EAAE,yEAA0ED,CAAgB,EAChG,KAAM,uBACN,MAAO,SACP,OAAQ,wEAAwE,mBAAmBlB,EAAM,OAAO,CAAC,GACjH,MAAO,KACT,CACF,EACA,QAASF,EAA+C,CACtD,MAAO,CACL,MAAOqB,EAAE,cAAc,EACvB,KAAMrB,EAAK,QACX,cAAeA,EAAK,QACpB,KAAM,MACN,MAAO,OACP,OAAQ,GACR,MAAO,KACT,CACF,EACA,QAASA,EAA+C,CACtD,MAAO,CACL,MAAOqB,EAAE,SAAS,EAClB,KAAMrB,EAAK,QACX,cAAeA,EAAK,QACpB,KAAM,uBACN,MAAO,SACP,OAAQ,GACR,MAAO,KACT,CACF,EACA,MAAOA,EAA+C,CACpD,MAAO,CACL,MAAOqB,EAAE,OAAO,EAChB,KAAMrB,EAAK,QACX,cAAeA,EAAK,QACpB,KAAM,uBACN,MAAO,SACP,OAAQ,wEAAwE,mBAAmBA,EAAK,OAAO,CAAC,GAChH,MAAO,KACT,CACF,EACA,sBAAuBA,EAAwB,CAC7C,MAAO,CACL,MAAOqB,EAAE,uBAAuB,EAChC,KAAMA,EAAE,iEAAkE,CACxE,KAAMrB,EAAK,KACX,GAAGmB,GAAM,QAAQ,CACnB,CAAC,EACD,cAAeE,EAAE,iEAAkE,CACjF,KAAMrB,EAAK,IACb,CAAC,EACD,KAAM,QACN,MAAO,OACP,OAAQ,YACR,MAAO,MACT,CACF,EACA,mBAAoBA,EAAmD,CACrE,MAAO,CACL,MAAOqB,EAAE,uBAAuB,EAChC,KAAMA,EAAE,2GAA4G,CAClH,OAAQ,KAAK,MAAMrB,EAAK,MAAM,CAChC,CAAC,EACD,cAAeqB,EAAE,2GAA4G,CAC3H,OAAQ,KAAK,MAAMrB,EAAK,MAAM,CAChC,CAAC,EACD,KAAM,QACN,MAAO,OACP,OAAQ,qCACR,MAAO,OACP,KAAM,CAAE,gBAAiBA,EAAK,eAAgB,CAChD,CACF,EACA,aAAcA,EAA6C,CACzD,IAAMsB,EAAYX,EAAI,kBAAkB,EAClCY,EAAgBZ,EAAI,oBAAoB,EAAE,sBAAsBX,EAAK,QAAQ,EAG7EwB,EAAmBD,IAAkBvB,EAAK,SAChD,MAAO,CACL,aAAcA,EAAK,SACnB,MAAOsB,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,cAAc,EACvE,KAAMA,EAAE,kEAAmE,CACzE,KAAM,GAAGL,EAAoC,GAAGhB,EAAK,QAAQ,GAC7D,GAAGmB,GAAM,QAAQ,CACnB,CAAC,EACD,cAAeK,EACXH,EAAE,kEAAmE,CACrE,KAAME,CACR,CAAC,EACCF,EAAE,qCAAqC,EAC3C,KAAM,YACN,MAAO,OACP,OAAQ,eAAeC,EAAUtB,EAAK,OAAO,GAAG,iBAAiB,GACjE,MAAO,QACP,QAASA,EAAK,OAChB,CACF,EACA,YAAaA,EAA6C,CACxD,IAAMsB,EAAYX,EAAI,kBAAkB,EAClCY,EAAgBZ,EAAI,oBAAoB,EAAE,sBAAsBX,EAAK,QAAQ,EAG7EwB,EAAmBD,IAAkBvB,EAAK,SAChD,MAAO,CACL,MAAOsB,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,cAAc,EACvE,aAAcrB,EAAK,SACnB,KAAMqB,EAAE,wFAAyF,CAC/F,KAAM,GAAGL,EAAoC,GAAGhB,EAAK,QAAQ,GAC7D,GAAGmB,GAAM,QAAQ,CACnB,CAAC,EACD,cAAeK,EACXH,EAAE,wFAAyF,CAC3F,KAAME,CACR,CAAC,EACCF,EAAE,oEAAqE,CACvE,KAAME,CACR,CAAC,EACH,KAAM,aACN,MAAO,SACP,OAAQ,iBACR,MAAO,QACP,QAASvB,EAAK,OAChB,CACF,EACA,eAAgBA,EAA6C,CAC3D,IAAMsB,EAAYX,EAAI,kBAAkB,EAClCY,EAAgBZ,EAAI,oBAAoB,EAAE,sBAAsBX,EAAK,QAAQ,EAC7EwB,EAAmBD,IAAkBvB,EAAK,SAGhD,MAAO,CACL,MAAOsB,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,cAAc,EACvE,aAAcrB,EAAK,SAEnB,KAAMqB,EAAE,gGAAiG,CACvG,KAAM,GAAGL,EAAoC,GAAGhB,EAAK,QAAQ,GAC7D,GAAGmB,GAAM,QAAQ,CACnB,CAAC,EACD,cAAeK,EACXH,EAAE,gGAAiG,CACnG,KAAME,CACR,CAAC,EACCF,EAAE,+EAA+E,EACrF,KAAM,aACN,MAAO,SACP,OAAQ,iBACR,MAAO,QACP,QAASrB,EAAK,OAChB,CACF,EACA,aAAcA,EAA8F,CAC1G,IAAMsB,EAAYX,EAAI,kBAAkB,EAClCc,EAAYzB,EAAK,YAAcW,EAAI,oBAAoB,EAAE,sBACzDe,EAAO,CACX,KAAM,GAAGV,EAAoC,GAAGhB,EAAK,SAAS,GAC9D,GAAGmB,GAAM,QAAQ,CACnB,EACMQ,EAAgB,CACpB,KAAMhB,EAAI,oBAAoB,EAAE,sBAAsBX,EAAK,SAAS,CACtE,EAEM4B,EAAkB,CACtB,WAAYH,EACRJ,EAAE,4CAA4C,EAC9CA,EAAE,4EAA6EK,CAAI,EACvF,eAAgBD,EACZJ,EAAE,2CAA2C,EAC7CA,EAAE,2EAA4EK,CAAI,EACtF,yBAA0BD,EACtBJ,EAAE,qDAAqD,EACvDA,EAAE,qFAAsFK,CAAI,EAChG,mBAAoBD,EAChBJ,EAAE,iDAAiD,EACnDA,EAAE,iFAAkFK,CAAI,EAC5F,cAAeD,EACXJ,EAAE,iDAAiD,EACnDA,EAAE,iFAAkFK,CAAI,EAC5F,QAASD,EACLJ,EAAE,yBAAyB,EAC3BA,EAAE,yDAA0DK,CAAI,CACtE,EAEMG,EAA2B,CAC/B,WAAYJ,EACRJ,EAAE,4CAA4C,EAC9CA,EAAE,4EAA6EM,CAAa,EAChG,eAAgBF,EACZJ,EAAE,2CAA2C,EAC7CA,EAAE,2EAA4EM,CAAa,EAC/F,yBAA0BF,EACtBJ,EAAE,qDAAqD,EACvDA,EAAE,qFAAsFM,CAAa,EACzG,mBAAoBF,EAChBJ,EAAE,iDAAiD,EACnDA,EAAE,iFAAkFM,CAAa,EACrG,cAAeF,EACXJ,EAAE,iDAAiD,EACnDA,EAAE,iFAAkFM,CAAa,EACrG,QAASF,EACLJ,EAAE,yBAAyB,EAC3BA,EAAE,yDAA0DM,CAAa,CAC/E,EAEMG,EAAU,CACd,WAAY,YACZ,eAAgB,cAChB,yBAA0B,YAC1B,mBAAoB,WACpB,cAAe,aACf,QAAS,oBACX,EAEA,MAAO,CACL,MAAOR,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,cAAc,EACvE,aAAcrB,EAAK,UACnB,KAAM4B,EAAgB5B,EAAK,OAAO,EAClC,cAAe6B,EAAyB7B,EAAK,OAAO,EACpD,UAAWA,EAAK,UAChB,KAAM8B,EAAQ9B,EAAK,OAAO,EAC1B,MAAO,OACP,QAASA,EAAK,QACd,MAAO,QACP,cAAe,CAAC,mCAAoC,CAClD,WAAYA,EAAK,QACjB,KAAM,CAAE,aAAcA,EAAK,YAAa,CAC1C,CAAC,CACH,CACF,EACA,kBAAmBA,EAAiE,CAClF,IAAMsB,EAAYX,EAAI,kBAAkB,EAClC,CAAE,aAAAoB,EAAc,aAAAC,CAAa,EAAIhC,EAAK,SAAS,KAC/CiC,EAAiB,CACrB,CAACC,EAAsB,EAAGb,EAAE,iBAAiB,EAC7C,CAACc,EAAsB,EAAGd,EAAE,gBAAgB,EAC5C,CAACe,EAA6B,EAAG,CAC/B,cAAef,EAAE,gBAAgB,EACjC,iBAAkBA,EAAE,0BAA0B,CAChD,EAAEU,EAAa,OAAO,EACtB,CAACM,EAAgC,EAAGhB,EAAE,oBAAoB,EAC1D,CAACiB,EAAgB,EAAGP,EAAa,IACnC,EAEA,MAAO,CACL,MAAOT,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,mBAAmB,EAC5E,aAAc,GACd,KAAMA,EAAE,oEAAqE,CAC3E,GAAGF,GAAM,GAAG,EACZ,cAAec,EAAeD,CAAY,CAC5C,CAAC,EACD,cAAeX,EAAE,oEAAqE,CACpF,cAAeY,EAAeD,CAAY,CAC5C,CAAC,EACD,MAAO,OACP,KAAM,uBACN,MAAO,QACP,KAAM,CAAE,WAAYhC,EAAK,UAAW,EACpC,cAAe,CAAC,mCAAoC,CAClD,WAAYA,EAAK,QACjB,KAAM,CAAE,aAAcA,EAAK,UAAW,CACxC,CAAC,CACH,CACF,EACA,gBAAiBA,EAAmE,CAClF,IAAMsB,EAAYX,EAAI,kBAAkB,EAClC,CAAE,UAAA4B,EAAW,OAAAC,EAAQ,KAAAC,EAAM,QAAAC,CAAQ,EAAIC,GAAmB3C,EAAK,QAAQ,EACvEyB,EAAYc,IAAc5B,EAAI,oBAAoB,EAAE,sBAEpDiC,EAAY,CAChB,CAACC,EAAa,EAAG,CAAE,KAAM,QAAS,MAAO,UAAW,WAAYxB,EAAE,UAAU,CAAE,EAC9E,CAACyB,EAAa,EAAG,CAAE,KAAM,QAAS,MAAO,SAAU,WAAYzB,EAAE,UAAU,CAAE,EAC7E,CAAC0B,EAAgB,EAAG,CAAE,KAAM,QAAS,MAAO,SAAU,WAAY1B,EAAE,WAAW,CAAE,EACjF,CAAC2B,EAAc,EAAG,CAAE,KAAM,QAAS,MAAO,SAAU,WAAY3B,EAAE,SAAS,CAAE,CAC/E,EACMK,EAAO,CACX,GAAGgB,EACH,GAAGvB,GAAM,QAAQ,EACjB,WAAYyB,EAAUJ,CAAM,EAAE,WAC9B,KAAOf,EAAoE,GAAxD,GAAGT,EAAoC,GAAGuB,CAAS,EACxE,EAEMZ,EAAgB,CACpB,GAAGe,EACH,WAAYE,EAAUJ,CAAM,EAAE,WAC9B,KAAOf,EAAyE,GAA7Dd,EAAI,oBAAoB,EAAE,sBAAsB4B,CAAS,CAC9E,EAEIG,EAAQ,WAGVhB,EAAK,OAAY,GAAGV,EAAoC,GAAG0B,EAAQ,QAAQ,GAC3Ef,EAAc,OAAYhB,EAAI,oBAAoB,EAAE,sBAAsB+B,EAAQ,QAAQ,GAG5F,IAAMd,EAAkB,CACtB,CAACM,EAAsB,EAAGT,EACtBJ,EAAE,iFAAkFK,CAAI,EACxFL,EAAE,uGAAwGK,CAAI,EAClH,CAACS,EAAsB,EAAGV,EACtBJ,EAAE,sFAAuFK,CAAI,EAC7FL,EAAE,4GAA6GK,CAAI,EACvH,CAACU,EAA6B,EAAGX,EAC7BJ,EAAE,2FAA6FK,CAAI,EACnGL,EAAE,iHAAkHK,CAAI,EAC5H,CAACW,EAAgC,EAAGZ,EAChCJ,EAAE,gFAAkFK,CAAI,EACxFL,EAAE,sGAAuGK,CAAI,EACjH,CAACY,EAAgB,EAAGb,EAChBJ,EAAE,8DAA+DK,CAAI,EACrEL,EAAE,oFAAuFK,CAAI,CACnG,EAEMG,EAA2B,CAC/B,CAACK,EAAsB,EAAGT,EACtBJ,EAAE,iFAAkFM,CAAa,EACjGN,EAAE,uGAAwGM,CAAa,EAC3H,CAACQ,EAAsB,EAAGV,EACtBJ,EAAE,sFAAuFM,CAAa,EACtGN,EAAE,4GAA6GM,CAAa,EAChI,CAACS,EAA6B,EAAGX,EAC7BJ,EAAE,2FAA6FM,CAAa,EAC5GN,EAAE,iHAAkHM,CAAa,EACrI,CAACU,EAAgC,EAAGZ,EAChCJ,EAAE,gFAAkFM,CAAa,EACjGN,EAAE,sGAAuGM,CAAa,EAC1H,CAACW,EAAgB,EAAGb,EAChBJ,EAAE,8DAA+DM,CAAa,EAC9EN,EAAE,oFAAuFM,CAAa,CAC5G,EAEA,MAAO,CACL,MAAOL,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,iBAAiB,EAC1E,aAAckB,EACd,KAAMX,EAAgBa,CAAI,EAC1B,cAAeZ,EAAyBY,CAAI,EAC5C,KAAMG,EAAUJ,CAAM,EAAE,KACxB,MAAOI,EAAUJ,CAAM,EAAE,MACzB,MAAO,QACP,cAAe,CAAC,mCAAoC,CAClD,WAAYxC,EAAK,QACjB,KAAM,CAAE,aAAcA,EAAK,YAAa,CAC1C,CAAC,CACH,CACF,EACA,iBAAkBA,EAAmF,CAEnG,MAAO,CACL,MAFgBW,EAAI,kBAAkB,EAErBX,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,kBAAkB,EAC3E,aAAcrB,EAAK,UACnB,KAAMqB,EAAE,yHAA0H,CAChI,KAAM,GAAGL,EAAoC,GAAGhB,EAAK,SAAS,GAC9D,OAAQA,EAAK,OACb,GAAGmB,GAAM,QAAQ,CACnB,CAAC,EACD,cAAeE,EAAE,yHAA0H,CACzI,KAAMV,EAAI,oBAAoB,EAAE,sBAAsBX,EAAK,SAAS,EACpE,OAAQA,EAAK,MACf,CAAC,EACD,UAAWA,EAAK,UAChB,KAAM,GACN,MAAO,OACP,OAAQ,oCAAoCA,EAAK,WAAW,GAC5D,MAAO,QACP,QAASA,EAAK,OAChB,CACF,EACA,sBAAuBA,EAAwF,CAE7G,MAAO,CACL,MAFgBW,EAAI,kBAAkB,EAErBX,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,yBAAyB,EAClF,aAAcrB,EAAK,aACnB,KAAMqB,EAAE,8FAA+F,CACrG,KAAM,GAAGL,EAAoC,GAAGhB,EAAK,YAAY,GACjE,GAAGmB,GAAM,QAAQ,CACnB,CAAC,EACD,cAAeE,EAAE,8FAA+F,CAC9G,KAAMV,EAAI,oBAAoB,EAAE,sBAAsBX,EAAK,YAAY,CACzE,CAAC,EACD,UAAWA,EAAK,aAChB,KAAM,GACN,MAAO,OACP,OAAQ,0CAA0CA,EAAK,YAAY,OAAOA,EAAK,UAAU,GACzF,MAAO,QACP,QAASA,EAAK,OAChB,CACF,EACA,gBAAiBA,EAAkG,CACjH,IAAMsB,EAAYX,EAAI,kBAAkB,EAClC,CAAE,kBAAAsC,CAAkB,EAAItC,EAAI,oBAAoB,EACtD,MAAO,CACL,MAAOW,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,iBAAiB,EAC1E,aAAcrB,EAAK,UACnB,KAAMqB,EAAE,uCAAwC,CAAE,OAAQ4B,EAAkBjD,EAAK,EAAE,CAAE,CAAC,EACtF,cAAeqB,EAAE,uCAAwC,CAAE,OAAQ4B,EAAkBjD,EAAK,EAAE,CAAE,CAAC,EAC/F,UAAWA,EAAK,UAChB,KAAM,cACN,MAAO,OACP,MAAO,QACP,cAAe,CAAC,2CAA4C,CAC1D,WAAYA,EAAK,QACjB,KAAM,CACJ,OAAQA,EAAK,GACb,WAAYA,EAAK,WACjB,UAAWA,EAAK,SAClB,CACF,CAAC,CACH,CACF,EACA,wBAAyBA,EAAkF,CACzG,IAAMsB,EAAYX,EAAI,kBAAkB,EAClC,CAAE,OAAAuC,EAAQ,UAAAX,EAAW,WAAAY,CAAW,EAAInD,EACpCoD,EAAgBC,GAAUH,EAAQ,CAAE,MAAO,QAAS,IAAK,UAAW,KAAM,SAAU,CAAC,EACrFI,EAAe,CAEnB,QAAWjC,EAAE,gFAAiF,CAAE,OAAQ+B,CAAc,CAAC,EACvH,SAAY/B,EAAE,4GAA6G,CAAE,OAAQ+B,CAAc,CAAC,CACtJ,EAEA,MAAO,CACL,MAAO9B,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,yBAAyB,EAClF,aAAckB,EACd,KAAMe,EAAaH,CAAU,EAC7B,cAAeG,EAAaH,CAAU,EACtC,MAAO,OACP,KAAM,QACN,OAAQA,IAAe,UAAY,YAAc,qCACjD,MAAO,QACP,KAAM,CAAE,OAAAD,CAAO,EACf,QAASlD,EAAK,OAChB,CACF,EACA,sBAAuBA,EAA2C,CAEhE,MAAO,CACL,MAFgBW,EAAI,kBAAkB,EAErBX,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,+BAA+B,EACxF,KAAMA,EAAE,4FAA4F,EACpG,cAAeA,EAAE,4FAA4F,EAC7G,MAAO,OACP,KAAM,QACN,OAAQ,YACR,MAAO,QACP,KAAArB,EACA,QAASA,EAAK,OAChB,CACF,EACA,gCACEA,EAKA,CACA,IAAMsB,EAAYX,EAAI,kBAAkB,EAClC,CAAE,KAAA4C,EAAM,MAAAC,CAAM,EAAIxD,EAAK,WACvByD,EAAQD,EAAM,OAAOE,GAAK,CAACH,EAAK,SAASG,CAAC,CAAC,EAC3CC,EAAUJ,EAAK,OAAOG,GAAK,CAACF,EAAM,SAASE,CAAC,CAAC,EAC7CE,EAAaH,EAAM,OACrBE,EAAQ,OACN,UACA,QACFA,EAAQ,OACN,UACA,KAEN,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,4EAA4E,EAG9F,IAAMC,EAAO,GAAG7C,EAAoC,GAAGhB,EAAK,SAAS,GAC/DuB,EAAgBZ,EAAI,oBAAoB,EAAE,sBAAsBX,EAAK,SAAS,EAC9E8D,EAA0BC,GAAY,CAC1C,IAAMC,EAAQD,EAAQ,CAAC,EACjBE,EAAMF,EAAQ,OACpB,OAAOA,EAAQ,OAAS,EACpB1C,EAAE,0BAA2B,CAAE,MAAA2C,EAAO,KAAMC,EAAM,CAAE,CAAC,EACrDD,CACN,EACME,EAAiB,CACrB,MAAO,IAAM7C,EAAE,oEAAqE,CAAE,KAAAwC,EAAM,MAAOC,EAAuBL,CAAK,EAAG,GAAGtC,GAAM,QAAQ,CAAE,CAAC,EACtJ,QAAS,IAAME,EAAE,wEAAyE,CAAE,KAAAwC,EAAM,QAASC,EAAuBH,CAAO,EAAG,GAAGxC,GAAM,QAAQ,CAAE,CAAC,EAChK,QAAS,IAAME,EAAE,oHAAqH,CACpI,KAAAwC,EACA,MAAOC,EAAuBL,CAAK,EACnC,QAASK,EAAuBH,CAAO,EACvC,GAAGxC,GAAM,QAAQ,CACnB,CAAC,CACH,EACMgD,EAA0B,CAC9B,MAAO,IAAM9C,EAAE,oEAAqE,CAAE,KAAME,EAAe,MAAOuC,EAAuBL,CAAK,CAAE,CAAC,EACjJ,QAAS,IAAMpC,EAAE,wEAAyE,CAAE,KAAME,EAAe,QAASuC,EAAuBH,CAAO,CAAE,CAAC,EAC3J,QAAS,IAAMtC,EAAE,oHAAqH,CACpI,KAAME,EACN,MAAOuC,EAAuBL,CAAK,EACnC,QAASK,EAAuBH,CAAO,CACzC,CAAC,CACH,EACA,MAAO,CACL,MAAOrC,EAAUtB,EAAK,OAAO,GAAG,UAAU,WAAaqB,EAAE,mCAAmC,EAC5F,KAAM6C,EAAeN,CAAU,EAAE,EACjC,cAAeO,EAAwBP,CAAU,EAAE,EACnD,MAAO,QACP,aAAc5D,EAAK,UACnB,MAAO,OACP,KAAM,YACN,OAAQ,iBACR,QAASA,EAAK,OAChB,CACF,CACF,ECnjBAoE,EAAI,yBAA0B,CAW5B,wBAAyBC,EAAcC,EAAwB,CAC7D,IAAMC,EAAiCC,GAAUH,CAAI,EAAEC,CAAI,EAE3D,GAAIC,EAAS,QAAU,SAAW,CAACD,EAAK,QACtC,MAAM,IAAI,UAAU,2DAA2D,EAIjF,IAAMG,EAAe,CACnB,GAAGF,EACH,KAAMG,GAAqB,CAAE,GAAGJ,EAAM,KAAAD,CAAK,CAAC,EAC5C,aAAcE,EAAS,cAAgBH,EAAI,oBAAoB,EAAE,sBAEjE,GAAIG,EAAS,QAAU,QAAU,CAAE,QAASD,EAAK,OAAQ,EAAI,CAAC,EAE9D,UAAW,IAAI,KAAKA,EAAK,YAAcA,EAAK,YAAcF,EAAI,eAAe,CAAC,EAAE,QAAQ,EACxF,KAAAC,CACF,EACMM,EAAYP,EAAI,oBAAoB,EAC1C,GAAIO,EAAU,cAAc,MAAM,KAAKC,GAAQA,EAAK,OAASH,EAAa,IAAI,EAE5E,OAAO,QAAQ,MAAM,qEAAsEA,EAAa,IAAI,EAE9G,IAAMI,EAAQF,EAAU,cAAc,MAAM,cAAcC,GAAQA,EAAK,UAAYH,EAAa,SAAS,EACzGE,EAAU,cAAc,MAAM,OAAO,KAAK,IAAI,EAAGE,CAAK,EAAG,EAAGJ,CAAY,EACxEL,EAAI,wBAAyBU,EAAuB,EACpDV,EAAI,+CAAgDK,CAAY,EAChEL,EAAI,wBAAyBW,GAAsBN,CAAY,CACjE,EACA,8BAA+BA,EAA4B,CACzDL,EAAI,oDAAqDK,EAAa,IAAI,CAC5E,EACA,iCAAkCO,EAAiB,CACjD,IAAML,EAAYP,EAAI,oBAAoB,EAC1C,GAAI,CAACO,EAAU,cAAe,OAC9B,IAAMM,EAASN,EAAU,cAAc,MAAM,OAAOC,GAC3C,CAACA,EAAK,OAAS,CAACI,GAAW,CAACJ,EAAK,SAAWA,EAAK,UAAYI,EACrE,EAAE,IAAIJ,GAAQA,EAAK,IAAI,EACxBR,EAAI,oDAAqDa,CAAM,CACjE,EACA,0BAA2BA,EAA2B,CAC/C,MAAM,QAAQA,CAAM,IAAGA,EAAS,CAACA,CAAM,GAC5C,IAAMN,EAAYP,EAAI,oBAAoB,EAC1C,GAAI,CAACO,EAAU,cAAe,OAC9B,IAAMO,EAAY,IAAI,IAAID,CAAM,EAChBN,EAAU,cAAc,MAAM,IAAI,CAACC,EAAMC,IACnDK,EAAU,IAAIN,EAAK,IAAI,GACzBM,EAAU,OAAON,EAAK,IAAI,EACnBC,GAEF,EACR,EAAE,OAAQM,GAAMA,IAAM,EAAK,EAAE,KAAK,EAAE,IAAI,CAACA,EAAG,IAAMA,EAAI,CAAC,EAChD,QAASN,GAAUF,EAAU,cAAc,MAAM,OAAOE,EAAO,CAAC,CAAC,EACzET,EAAI,wBAAyBgB,GAAsBH,CAAM,CAC3D,EACA,yCAA0CI,EAAQ,CAChD,IAAMV,EAAYP,EAAI,oBAAoB,EAC1CO,EAAU,cAAc,OAASU,EACjCjB,EAAI,wBAAyBU,EAAuB,EACpDV,EAAI,wBAAyBkB,GAA4BD,CAAM,CACjE,CACF,CAAC,EC5EM,IAAME,GAAoB,OAAO,OAAO,CAC7C,MAAO,QACP,SAAU,WACV,GAAI,KACJ,UAAW,YACX,KAAM,OACN,KAAM,OACN,IAAK,MACL,IAAK,MACL,MAAO,QACP,aAAc,cAChB,CAAC,EAEYC,GAAe,OAAO,OAAO,CACxC,IAAK,MACL,IAAK,MACL,MAAO,QACP,YAAa,cACb,UAAW,WACb,CAAC,EAEYC,GAAgB,OAAO,OAAO,CACzC,MAAO,QACP,GAAI,IACN,CAAC,EAEYC,GAA0B,OAAO,OAAO,CACnD,gBAAiB,kBACjB,mBAAoB,qBACpB,oBAAqB,sBACrB,uBAAwB,wBAC1B,CAAC,EAOKC,GAAiB,CACrB,gBAAiB,GACjB,YAAa,KACb,qBAAsB,IACtB,WAAY,GACZ,qBAAsB,IACtB,yBAA0B,GAC1B,kBAAmB,GAGnB,mBAAoB,GACpB,4BAA6B,EAC7B,QAAS,GACX,EAIaC,GAAe,eACfC,GAA8B,8BAC9BC,GAA6B,6BAC7BC,GAAgC,gCAChCC,GAAgC,gCAChCC,GAAgC,gCAsFtC,SAASC,GAAcC,EAAaC,EAAmB,CAAC,EAAiB,CAC9E,IAAMC,EAAuB,CAC3B,oBAAqBD,EAAQ,UAAY,CAAC,EAI1C,yBAA0B,EAC1B,QAAS,wCAAwC,KAAKD,CAAG,EAEzD,MAAO,GACP,UAAW,OAAO,OAAO,IAAI,EAC7B,gBAAiB,CAAE,GAAGG,GAAwB,GAAGF,EAAQ,eAAgB,EACzE,6BAA8B,OAC9B,QAAS,CAAE,GAAGT,GAAgB,GAAGS,CAAQ,EAEzC,uBAAwB,IAAI,IAC5B,yBAA0B,IAAI,IAC9B,cAAe,OACf,gBAAiB,GAGjB,OAAQ,KACR,gBAAiB,IAAI,IACrB,SAAU,IAAI,IACd,oBAAqB,OACrB,IAAKD,EAAI,QAAQ,QAAS,IAAI,EAC9B,GAAGI,EACL,EAQA,QAAWC,KAAQ,OAAO,KAAKC,EAA0B,EACvDJ,EAAO,UAAUG,CAAI,EAAKE,GAAU,CAClC,GAAI,CAEDD,GAA2BD,CAAI,EAAE,KAAgBH,EAAQK,CAAK,EAC/DL,EAAO,oBAAoBG,CAAI,GAAG,KAAKH,EAAQK,CAAK,CACtD,OAASC,EAAO,CAEdC,EAAI,wBAAyBhB,GAAcS,EAAQM,GAAO,OAAO,CACnE,CACF,EAGF,GAAI,OAAO,MAAS,UAAY,gBAAgB,YAC9C,QAAWH,KAAQK,GACjBC,GAAe,IAAIN,EAAMH,EAAO,UAAUG,CAAI,CAAC,EAGnD,OAAKH,EAAO,QAAQ,QAClBA,EAAO,QAAQ,EAEVA,CACT,CAEO,SAASU,GAAeC,EAAcC,EAAgBC,EAAuB,CAClF,IAAMC,EAAU,CAAE,GAAGD,EAAM,KAAAF,EAAM,KAAAC,CAAK,EAClCG,EACEC,EAAY,UAAY,CAC5B,OAAKD,IAAQA,EAAS,KAAK,UAAU,IAAI,GAClCA,CACT,EAEA,cAAO,iBAAiBD,EAAS,CAC/B,CAAC,OAAO,WAAW,EAAG,CACpB,MAAOE,CACT,CACF,CAAC,EACMF,CACT,CAMO,SAASG,GAAkBC,EAAmBC,EAAwB,CAC3E,OAAO,KAAK,UAAU,CAAE,KAAMC,GAAkB,IAAK,UAAAF,EAAW,KAAAC,CAAK,CAAC,CACxE,CAEO,SAASE,GAAeC,EAAuBH,EAA0B,CAE9E,OAAO,KAAK,UAAU,OAAO,OAAO,CAAE,KAAAG,CAAK,EAAGH,CAAI,CAAC,CACrD,CAGA,IAAMI,GAA6B,CAEjC,MAAOC,EAAmB,CACxB,IAAMC,EAAS,KAKf,GAHA,QAAQ,MAAM,wBAAyBD,EAAM,KAAMA,EAAM,MAAM,EAC/DC,EAAO,2BAEHA,EAAO,OAET,QAAWC,KAAQC,GACjBF,EAAO,OAAO,oBAAoBC,EAAMD,EAAO,UAAUC,CAAI,CAAC,EAGlED,EAAO,OAAS,KAChBA,EAAO,eAAe,EAiBlBA,EAAO,iBACTA,EAAO,gBAAgB,QAASP,GAAc,CAEvCO,EAAO,yBAAyB,IAAIP,CAAS,GAChDO,EAAO,uBAAuB,IAAIP,CAAS,CAE/C,CAAC,EAGHO,EAAO,gBAAgB,MAAM,EAC7BA,EAAO,yBAAyB,MAAM,EAElCA,EAAO,iBAAmBA,EAAO,QAAQ,2BACvCA,EAAO,yBAA2BA,EAAO,QAAQ,WACnDG,EAAI,wBAAyBC,GAA4BJ,CAAM,GAI3D,CAACK,GAAoB,GAAKL,EAAO,UACnCA,EAAO,0BAA0B,EAIzC,EAIA,MAAOD,EAAc,CACnB,IAAMC,EAAS,KAGf,QAAQ,KAAK,wBAAyBD,CAAK,EAC3C,aAAaC,EAAO,aAAa,CACnC,EAKA,QAASD,EAAqB,CAC5B,IAAMC,EAAS,KACT,CAAE,KAAAN,CAAK,EAAIK,EAEjB,GAAI,OAAOL,GAAS,SAClB,OAAAS,EAAI,wBAAyBG,GAAcN,EAAQ,CACjD,QAAS,oBAAoB,OAAON,CAAI,EAC1C,CAAC,EACMM,EAAO,QAAQ,EAExB,IAAIO,EAAe,CAAE,KAAM,EAAG,EAE9B,GAAI,CACFA,EAAMC,GAAcd,CAAI,CAC1B,OAASe,EAAO,CACd,OAAAN,EAAI,wBAAyBG,GAAcN,EAAQ,CACjD,QAAS,sBAAsBS,GAAO,OAAO,EAC/C,CAAC,EACMT,EAAO,QAAQ,CACxB,CACA,IAAMU,EAAUV,EAAO,gBAAgBO,EAAI,IAAI,EAE/C,GAAIG,EACFA,EAAQ,KAAKV,EAAQO,CAAG,MAExB,OAAM,IAAI,MAAM,2BAA2BA,EAAI,IAAI,EAAE,CAEzD,EAEA,SAAW,CACT,QAAQ,KAAK,yBAAyB,EACtC,IAAMP,EAAS,KAEfA,EAAO,eAAe,EAGtBA,EAAO,yBAA2B,EAClCA,EAAO,QAAQ,MAAM,CACvB,EAEA,QAAU,CACR,QAAQ,KAAK,wBAAwB,EACrC,IAAMA,EAAS,KAEXA,EAAO,QAAQ,mBAAqBA,EAAO,kBACxCA,EAAO,SACVA,EAAO,yBAA2B,EAClCA,EAAO,0BAA0B,GAGvC,EAGA,MAAQ,CACN,QAAQ,MAAM,sBAAsB,EACpC,IAAMA,EAAS,KACT,CAAE,QAAAW,CAAQ,EAAI,KAEpBX,EAAO,mBAAqB,OAC5BA,EAAO,eAAe,EACtBG,EAAI,wBAAyBS,GAA+BZ,CAAM,EAGlEA,EAAO,yBAA2B,GAClCA,EAAO,MAAQ,GAGXW,EAAQ,YAAc,GAAKA,EAAQ,YAAc,MACnDX,EAAO,cAAgB,WAAW,IAAM,CACtCA,EAAO,QAAQ,MAAM,CACvB,EAAGW,EAAQ,WAAW,GAGxBX,EAAO,uBAAuB,QAASP,GAAc,CACnD,IAAMoB,EAAW,KAAK,SAAS,IAAIpB,CAAS,EAE5CO,EAAO,QAAQ,KAAKJ,GAAckB,GAAa,IAAKD,EAAW,CAAE,UAAApB,EAAW,SAAAoB,CAAS,EAAI,CAAE,UAAApB,CAAU,CAAC,CAAC,CACzG,CAAC,CAEH,EAEA,wBAA0B,CACxB,QAAQ,KAAK,iCAAiC,CAChD,EAEA,0BAA4B,CAC1B,QAAQ,KAAK,oCAAoC,CACnD,EAEA,uBAAyB,CACvB,QAAQ,KAAK,8BAA8B,EAC5B,KAER,QAAQ,CACjB,EAEA,yBAA0BM,EAAoB,CAC5C,GAAM,CAAE,MAAAgB,EAAO,IAAAC,CAAI,EAAIjB,EAAM,OAC7B,QAAQ,KAAK,yCAAyCiB,CAAG,QAAQD,CAAK,KAAK,CAC7E,EAEA,yBAA0BhB,EAAoB,CAC5C,GAAM,CAAE,UAAAN,CAAU,EAAIM,EAAM,OAC5B,QAAQ,MAAM,kCAAkCN,CAAS,EAAE,CAC7D,CACF,EAGMwB,GAAyB,CAC7B,CAACtB,GAAkB,KAAK,EAAGY,EAAK,CAC9B,QAAQ,MAAM,2BAA4BA,CAAG,CAC/C,EAEA,CAACZ,GAAkB,IAAI,EAAG,CAAE,KAAAD,CAAK,EAAG,CAClC,IAAMM,EAAS,KAEXA,EAAO,QAAQ,iBACjB,QAAQ,MAAM,6BAA6B,KAAK,IAAI,EAAI,OAAON,CAAI,CAAC,KAAK,EAG3EM,EAAO,QAAQ,KAAKkB,GAAcvB,GAAkB,KAAMD,CAAI,CAAC,EAE/D,aAAaM,EAAO,aAAa,EACjCA,EAAO,cAAgB,WAAW,IAAM,CACtCA,EAAO,QAAQ,MAAM,CACvB,EAAGA,EAAO,QAAQ,WAAW,CAC/B,EAEA,CAACL,GAAkB,GAAG,EAAG,CAAE,UAAAF,EAAW,KAAAC,CAAK,EAAG,CAC5C,QAAQ,IAAI,uCAAuCD,CAAS,IAAKC,CAAI,CAEvE,EAEA,CAACC,GAAkB,EAAE,EAAG,CAAE,UAAAF,EAAW,IAAA0B,EAAK,KAAAzB,CAAK,EAAG,CAChD,QAAQ,IAAI,4CAA4CD,CAAS,IAAI0B,CAAG,IAAKzB,CAAI,CAEnF,EAEA,CAACC,GAAkB,GAAG,EAAGY,EAAK,CAC5B,QAAQ,MAAM,qBAAqBA,EAAI,IAAI,YAAaA,EAAI,IAAI,CAClE,EAEA,CAACZ,GAAkB,KAAK,EAAGY,EAAK,CAC9B,QAAQ,MAAM,qBAAqBA,EAAI,IAAI,YAAaA,EAAI,IAAI,CAClE,EAEA,CAACa,GAAc,KAAK,EAAG,CAAE,KAAA1B,CAAK,EAAG,CAC/B,GAAM,CAAE,KAAAG,EAAM,UAAAJ,EAAW,OAAA4B,CAAO,EAAI3B,EACpC,QAAQ,KAAK,wCAAwCG,CAAI,eAAeJ,CAAS,EAAE,EACnF,IAAMO,EAAS,KAEf,OAAQH,EAAM,CACZ,KAAKiB,GAAa,IAAK,CACrB,QAAQ,KAAK,mCAAmCrB,CAAS,KAAK4B,CAAM,EAAE,EACtErB,EAAO,uBAAuB,OAAOP,CAAS,EAC9C,KACF,CACA,KAAKqB,GAAa,MAAO,CACvB,QAAQ,KAAK,uCAAuCrB,CAAS,KAAK4B,CAAM,EAAE,EAC1ErB,EAAO,yBAAyB,OAAOP,CAAS,EAChD,KACF,CACA,KAAKqB,GAAa,YAAa,CAC7B,GAAM,CAAE,WAAAQ,EAAY,QAAAC,CAAQ,EAAI7B,EAChC,QAAQ,KAAK,yEAAyE4B,CAAU,gCAAgCC,CAAO,EAAE,EACzI,KACF,CACA,QACE,QAAQ,MAAM,qDAAqD1B,CAAI,EAAE,CAE7E,CACF,EAEA,CAACuB,GAAc,EAAE,EAAG,CAAE,KAAM,CAAE,KAAAvB,EAAM,UAAAJ,CAAU,CAAE,EAAG,CACjD,IAAMO,EAAS,KAEf,OAAQH,EAAM,CACZ,KAAKiB,GAAa,IAAK,CACrBd,EAAO,uBAAuB,OAAOP,CAAS,EAC9CO,EAAO,gBAAgB,IAAIP,CAAS,EACpCU,EAAI,wBAAyBqB,GAA+BxB,EAAQ,CAAE,UAAAP,CAAU,CAAC,EACjF,KACF,CACA,KAAKqB,GAAa,MAAO,CACvB,QAAQ,MAAM,8BAA8BrB,CAAS,EAAE,EACvDO,EAAO,yBAAyB,OAAOP,CAAS,EAChDO,EAAO,gBAAgB,OAAOP,CAAS,EACvCO,EAAO,SAAS,OAAOP,CAAS,EAChC,KACF,CACA,KAAKqB,GAAa,UAAW,CAC3B,QAAQ,MAAM,8BAA8BrB,CAAS,EAAE,EACvD,KACF,CACA,QACE,QAAQ,MAAM,qDAAqDI,CAAI,EAAE,CAE7E,CACF,CACF,EAEM4B,GAAmB,CAAC,UAAW,QAAQ,EACvCvB,GAAmB,CAAC,QAAS,QAAS,UAAW,MAAM,EACvDwB,GAAiB,IAAI,IAE3B,GAAI,OAAO,MAAS,UAAY,gBAAgB,YAI9C,QAAWzB,KAAQwB,GAAkB,CACnC,IAAMf,EAAWiB,GACLD,GAAe,IAAIzB,CAAI,IACtB0B,CAAE,EAEf,KAAK,iBAAiB1B,EAAMS,EAAS,EAAK,CAC5C,CAMF,IAAML,GAAsB,IAAM,OAAO,WAAc,UAAY,UAAU,SAAW,GAG3EG,GAAiBd,GAA0B,CACtD,IAAMa,EAAM,KAAK,MAAMb,CAAI,EAE3B,GAAI,OAAOa,GAAQ,UAAYA,IAAQ,KACrC,MAAM,IAAI,UAAU,kCAAkC,EAExD,GAAM,CAAE,KAAAV,CAAK,EAAIU,EAEjB,GAAI,OAAOV,GAAS,UAAYA,IAAS,GACvC,MAAM,IAAI,UAAU,yCAAyC,EAE/D,OAAOU,CACT,EAEMqB,GAAgB,CACpB,gBAAkB,CAChB,IAAM5B,EAAS,KAEf,aAAaA,EAAO,mBAAmB,EACvC,aAAaA,EAAO,4BAA4B,EAChD,aAAaA,EAAO,aAAa,EACjCA,EAAO,oBAAsB,OAC7BA,EAAO,6BAA+B,OACtCA,EAAO,cAAgB,MACzB,EAGA,SAAW,CACT,IAAMA,EAAS,KAEf,GAAIA,EAAO,SAAW,KACpB,MAAM,IAAI,MAAM,6DAA6D,EAE/E,GAAIA,EAAO,6BACT,MAAM,IAAI,MAAM,2DAA2D,EAE7E,GAAI,CAACA,EAAO,gBACV,MAAM,IAAI,MAAM,wDAAwD,EAgB1E,GAdAA,EAAO,OAAS,IAAI,UAAUA,EAAO,GAAG,EAKxCA,EAAO,OAAO,KAAO,SAAUN,EAAM,CAEnC,IAAMmC,EAAO,UAAU,UAAU,KAAK,KAAK,IAAI,EAC/C,OAAI,OAAOnC,GAAS,UAAY,OAAOA,EAAK,OAAO,WAAW,GAAM,WAC3DmC,EAAKnC,EAAK,OAAO,WAAW,EAAE,CAAC,EAEjCmC,EAAKnC,CAAI,CAClB,EAEIM,EAAO,QAAQ,QAAS,CAC1B,IAAM8B,EAAQ,YAAY,IAAI,EAC9B9B,EAAO,oBAAsB,WAAW,IAAM,CAC5CA,EAAO,oBAAsB,OACzBA,EAAO,QAAQ,qBACjBA,EAAO,mBAAqB,YAAY,IAAI,EAAI8B,GAElD9B,EAAO,QAAQ,MAAM,IAAM,SAAS,CACtC,EAAGA,EAAO,QAAQ,OAAO,CAC3B,CAEA,QAAWC,KAAQC,GACjBF,EAAO,OAAO,iBAAiBC,EAAMD,EAAO,UAAUC,CAAI,CAAC,CAE/D,EAUA,SAAW,CACT,IAAMD,EAAS,KASf,GAPAA,EAAO,eAAe,EAGtBA,EAAO,uBAAuB,MAAM,EACpCA,EAAO,yBAAyB,MAAM,EACtCA,EAAO,gBAAgB,MAAM,EAEzB,OAAO,MAAS,UAAY,gBAAgB,YAC9C,QAAWC,KAAQwB,GACjBC,GAAe,OAAOzB,CAAI,EAI9B,GAAID,EAAO,OAAQ,CACjB,QAAWC,KAAQC,GACjBF,EAAO,OAAO,oBAAoBC,EAAMD,EAAO,UAAUC,CAAI,CAAC,EAEhED,EAAO,OAAO,MAAM,CACtB,CACAA,EAAO,UAAY,CAAC,EACpBA,EAAO,OAAS,KAChBA,EAAO,gBAAkB,EAC3B,EAEA,oBAA8B,CAC5B,IAAMA,EAAS,KAET,CACJ,qBAAA+B,EACA,qBAAAC,EACA,4BAAAC,CACF,EAAIjC,EAAO,QAELkC,EAAWF,EAAuBC,GAA+BjC,EAAO,yBACxEmC,EAAWD,EAAWD,EACtBG,EAAqBpC,EAAO,mBAClC,OAAAA,EAAO,mBAAqB,OAErB,KAAK,IAGV,KAAK,IACHgC,EACAI,EAAqBL,EAAuBK,EAAqBL,CACnE,EACA,KAAK,MAAMG,KAAe,KAAK,QAAQ,GAAKC,EAAWD,EAAS,CAClE,CACF,EAIA,2BAA6B,CAC3B,IAAMlC,EAAS,KAEf,GAAI,CAACA,EAAO,gBACV,MAAM,IAAI,MAAM,4EAA4E,EAE9F,GAAIA,EAAO,6BACT,OAAO,QAAQ,KAAK,uDAAuD,EAE7E,IAAMe,EAAQf,EAAO,mBAAmB,EAClCgB,EAAMhB,EAAO,yBAA2B,EAE9CA,EAAO,6BAA+B,WAAW,IAAM,CACrDG,EAAI,wBAAyBkC,GAA6BrC,CAAM,EAChEA,EAAO,6BAA+B,OACtCA,EAAO,QAAQ,CACjB,EAAGe,CAAK,EACRZ,EAAI,wBAAyBmC,GAA+BtC,EAAQ,CAAE,MAAAe,EAAO,IAAAC,CAAI,CAAC,CACpF,EAIA,IAAKvB,EAAmBC,EAAgB,CAClC,KAAK,QAAQ,aAAe,UAAU,MACxC,KAAK,OAAO,KAAKF,GAAiBC,EAAWC,CAAI,CAAC,CAEtD,EAUA,IAAKD,EAAmB,CACtB,IAAMO,EAAS,KACT,CAAE,OAAAuC,CAAO,EAAI,KAEnB,GAAI,CAACvC,EAAO,uBAAuB,IAAIP,CAAS,IAC9CO,EAAO,uBAAuB,IAAIP,CAAS,EAC3CO,EAAO,yBAAyB,OAAOP,CAAS,EAE5C8C,GAAQ,aAAe,UAAU,MAAM,CACzC,IAAM1B,EAAWb,EAAO,SAAS,IAAIP,CAAS,EAC9C8C,EAAO,KAAK3C,GAAckB,GAAa,IAAKD,EAAW,CAAE,UAAApB,EAAW,SAAAoB,CAAS,EAAI,CAAE,UAAApB,CAAU,CAAC,CAAC,CACjG,CAEJ,EAKA,YAAaA,EAAmBoB,EAAqB,CACnD,IAAMb,EAAS,KACT,CAAE,OAAAuC,CAAO,EAAI,KAEf1B,EACFb,EAAO,SAAS,IAAIP,EAAWoB,CAAQ,EAEvCb,EAAO,SAAS,OAAOP,CAAS,EAG9BO,EAAO,gBAAgB,IAAIP,CAAS,GAClC8C,GAAQ,aAAe,UAAU,MAEnCA,EAAO,KAAK3C,GAAckB,GAAa,UAAWD,EAAW,CAAE,UAAApB,EAAW,SAAAoB,CAAS,EAAI,CAAE,UAAApB,CAAU,CAAC,CAAC,CAG3G,EAWA,MAAOA,EAAmB,CACxB,IAAMO,EAAS,KACT,CAAE,OAAAuC,CAAO,EAAI,KAEdvC,EAAO,yBAAyB,IAAIP,CAAS,IAChDO,EAAO,uBAAuB,OAAOP,CAAS,EAC9CO,EAAO,yBAAyB,IAAIP,CAAS,EAEzC8C,GAAQ,aAAe,UAAU,MACnCA,EAAO,KAAK3C,GAAckB,GAAa,MAAO,CAAE,UAAArB,CAAU,CAAC,CAAC,EAGlE,CACF,EAGA,QAAWQ,KAAQ,OAAO,KAAKH,EAA0B,GACnDG,IAAS,SAAW,CAACC,GAAiB,SAASD,CAAI,IACrDE,EAAI,sBAAuB,UAAUF,CAAI,GAAI,CAACuC,EAAQC,IAAoB,CACxE,IAAMd,EAAK,IAAI,YAAY1B,EAAM,CAAE,OAAAwC,CAAO,CAAC,EAC3CD,EAAO,UAAUvC,CAAI,EAAE,KAAKuC,EAAQb,CAAE,CACxC,CAAC,ECtvBL,IAAOe,GAASC,EAAI,yBAA0B,CAQ5C,wBAAyB,CAAC,CAAE,WAAAC,EAAY,IAAAC,EAAK,KAAAC,EAAM,WAAAC,EAAY,QAAAC,EAAS,kBAAAC,EAAoB,MAAO,eAAAC,EAAiB,KAAM,IACjHP,EAAI,2BAA4BC,EAAY,IAC1CD,EAAI,kBAAmBC,EAAYC,EAAKC,EAAM,CACnD,QAAAE,EACA,gBAAiBL,EAAI,uCAAwCC,EAAYK,CAAiB,EAC1F,aAAcN,EAAI,uCAAwCC,EAAYM,CAAc,EACpF,WAAAH,CACF,CAAC,CACF,CAEL,CAAC,EC9BD,IAAII,GAAE,0HAA8HC,GAAEC,GAAG,IAAI,eAAe,CAAC,KAAKC,EAAE,CAAC,GAAG,YAAY,OAAOD,CAAC,EAAEC,EAAE,QAAQD,EAAE,OAAO,MAAMA,EAAE,WAAWA,EAAE,WAAWA,EAAE,UAAU,CAAC,UAAUA,aAAa,YAAYC,EAAE,QAAQD,CAAC,MAAO,OAAM,IAAI,UAAU,8CAA8C,EAAEC,EAAE,MAAM,CAAC,CAAC,CAAC,EAAEC,GAAEH,GAAMI,GAAE,IAAI,YAAYC,GAAE,uCAAuCC,GAAE,qEAAqEC,GAAE,IAAI,CAAC,IAAIN,EAAE,IAAI,WAAW,EAAE,EAAE,OAAO,WAAW,OAAO,gBAAgBA,CAAC,EAAE,MAAM,KAAKA,CAAC,EAAE,IAAIO,GAAGF,GAAEE,EAAEF,GAAE,MAAM,CAAC,EAAE,KAAK,EAAE,CAAC,EAAEG,GAAE,CAAC,aAAa,EAAE,EAAE,eAAeC,GAAET,EAAEO,EAAEN,EAAE,CAAC,IAAIS,EAAEP,GAAE,OAAO;AAAA,IAC/rBH,CAAC,EAAE,EAAE,GAAG,MAAM,QAAQO,CAAC,GAAGA,EAAE,OAAO,EAAE,CAAC,MAAMN,EAAE,MAAM,MAAM,+BAA+B,CAAC,EAAE,MAAM,CAAC,IAAIU,EAAE,EAAE,cAAcC,KAAKL,EAAE,CAACI,IAAI,IAAIE,EAAEC,EAAE,GAAG,CAACF,EAAE,MAAMA,EAAE,MAAM,GAAGE,EAAEF,EAAE,QAAQ,IAAI,cAAc,EAAE,CAACE,EAAED,EAAEP,GAAE,EAAEQ,EAAE,8BAA8BD,CAAC,YAAY,CAACC,EAAE,WAAW,YAAY,GAAG,CAACV,GAAE,KAAKU,CAAC,EAAE,CAAC,MAAMb,EAAE,MAAM,MAAM,mCAAmCa,CAAC,CAAC,EAAE,MAAM,KAAK,CAAC,IAAIC,EAAED,EAAE,MAAMhB,EAAC,GAAG,CAACiB,GAAG,EAAEF,EAAEE,EAAE,CAAC,GAAGA,EAAE,CAAC,MAAMF,EAAEP,GAAE,EAAEQ,EAAEA,EAAE,QAAQV,GAAE,eAAeS,CAAC,GAAG,EAAE,CAAC,MAAMX,GAAEQ,CAAC,EAAE,OAAOT,EAAEO,EAAC,EAAE,MAAM,CAAC,IAAIO,EAAE,CAAC,EAAE,EAAE,GAAGD,EAAE,CAAC,IAAIE,EAAE,GAAGJ,EAAE,QAAQ,QAAQ,CAACK,EAAEC,IAAI,CAACA,IAAI,eAAeH,EAAE,KAAK,GAAGG,CAAC,KAAKD,CAAC,EAAE,GAAGD,EAAE,GAAGD,EAAE,KAAK,GAAGG,CAAC,KAAKJ,CAAC,EAAE,EAAE,CAAC,EAAEE,GAAGD,EAAE,KAAK,iBAAiBD,CAAC,EAAE,CAAC,MAAMF,EAAE,QAAQ,QAAQ,CAACI,EAAEC,IAAI,CAACF,EAAE,KAAK,GAAGE,CAAC,KAAKD,CAAC,EAAE,CAAC,CAAC,EAAEJ,EAAE,OAAO,CAACA,EAAE,KAAKG,EAAE,KAAK,EAAE,EAAEA,EAAE,KAAK,GAAG,EAAE,EAAE,IAAII,EAAEhB,GAAE,OAAOY,EAAE,KAAK;AAAA,CAC9uB,CAAC,EAAEA,EAAE,OAAO,EAAE,MAAMb,GAAEiB,CAAC,EAAE,OAAOlB,EAAEO,EAAC,EAAE,KAAK,CAAC,GAAGI,EAAE,KAAK,CAAC,GAAGA,EAAE,gBAAgB,aAAa,YAAY,OAAOA,EAAE,IAAI,EAAE,MAAMV,GAAEU,EAAE,IAAI,EAAE,OAAOX,EAAEO,EAAC,UAAUI,EAAE,gBAAgB,KAAK,MAAMA,EAAE,KAAK,OAAO,EAAE,OAAOX,EAAEO,EAAC,UAAUI,EAAE,gBAAgB,eAAe,MAAMA,EAAE,KAAK,OAAOX,EAAEO,EAAC,MAAM,CAAC,MAAMP,EAAE,MAAM,MAAM,mBAAmB,CAAC,EAAE,MAAM,CAAC,KAAK,SAASW,EAAE,MAAM,CAAC,GAAG,CAACC,EAAE,CAAC,MAAMZ,EAAE,MAAM,MAAM,4CAA4C,CAAC,EAAE,MAAM,CAAC,MAAMQ,GAAEI,EAAED,EAAE,MAAMX,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAACU,EAAE,CAAC,MAAMV,EAAE,MAAM,MAAM,+BAA+B,CAAC,EAAE,MAAM,CAAC,IAAImB,EAAEjB,GAAE,OAAO;AAAA,IAC5hBH,CAAC,IAAI,EAAE,MAAME,GAAEkB,CAAC,EAAE,OAAOnB,EAAEO,EAAC,CAAC,CAAC,IAAIa,GAAE,CAACrB,EAAEO,IAAI,CAAC,IAAIN,EAAE,IAAI,gBAAgBS,EAAED,GAAET,EAAEO,EAAEN,EAAE,QAAQ,EAAEU,EAAE,GAAGS,EAAEnB,EAAE,SAAS,UAAU,EAAE,OAAO,IAAI,eAAe,CAAC,MAAMY,EAAE,EAAE,SAAS,CAAC,OAAO,GAAG,CAAC,IAAIC,EAAE,MAAMM,EAAE,KAAK,EAAE,GAAGN,EAAE,KAAK,CAAC,IAAIC,EAAE,IAAI,WAAW,CAAC,GAAG,EAAE,CAAC,EAAEF,EAAE,QAAQE,EAAE,OAAO,MAAMA,EAAE,WAAWA,EAAE,WAAWA,EAAE,UAAU,CAAC,EAAEF,EAAE,MAAM,EAAE,MAAM,CAACA,EAAE,QAAQC,EAAE,KAAK,CAAC,OAAOA,EAAE,CAAC,QAAQ,MAAM,cAAcA,CAAC,EAAED,EAAE,MAAMC,CAAC,EAAE,MAAM,CAAC,GAAG,EAAE,MAAM,IAAI,CAAC,CAAC,CAAC,EAAE,MAAM,MAAM,CAAIH,IAAU,MAAMD,EAAE,KAAK,GAAG,OAAOC,EAAE,GAAG,MAAMV,EAAE,SAAS,MAAM,EAAE,CAAC,CAAC,CAAC,EAAEqB,GAAED,GCH9f,IAAIE,GAAE,MAAMC,EAAEC,EAAEC,EAAEC,IAAI,CAAC,IAAIC,EAAE,MAAM,WAAW,OAAO,OAAO,UAAU,MAAMH,EAAE,OAAO,GAAG,CAAC,YAAY,YAAY,CAAC,EAAEI,EAAE,MAAM,WAAW,OAAO,OAAO,UAAU,CAAC,KAAK,OAAO,KAAK,UAAU,KAAKL,EAAE,SAAS,KAAKE,CAAC,EAAEE,EAAEJ,EAAE,OAAO,GAAGG,CAAC,EAAEG,EAAE,MAAM,WAAW,OAAO,OAAO,WAAW,CAAC,KAAK,OAAO,KAAK,UAAU,KAAKN,EAAE,WAAW,KAAKE,CAAC,EAAEE,EAAEJ,EAAE,cAAc,CAAC,EAAE,MAAM,CAACK,EAAE,WAAW,CAAC,IAAIE,EAAE,IAAI,YAAYP,EAAE,YAAY,EAAEQ,EAAE,IAAI,SAASD,CAAC,EAAEE,EAAE,IAAI,WAAWF,CAAC,EAAEG,EAAE,IAAI,WAAWJ,CAAC,EAAEK,EAAE,WAAWC,GAAGZ,EAAE,cAAc,GAAG,EAAEa,EAAE,IAAI,MAAMD,CAAC,EAAE,KAAK,CAAC,EAAE,OAAO,CAAC,QAAQE,EAAE,EAAEA,GAAGH,EAAEG,IAAI,CAACN,EAAE,UAAUA,EAAE,WAAW,EAAEM,EAAE,EAAE,EAAE,IAAIC,EAAE,IAAI,WAAWf,EAAE,YAAY,EAAE,QAAQgB,EAAE,EAAEA,EAAED,EAAE,OAAOC,IAAID,EAAEC,CAAC,EAAEN,EAAEM,CAAC,EAAEP,EAAEO,CAAC,EAAE,MAAMD,CAAC,CAAC,QAAQD,EAAE,EAAEA,EAAEF,EAAEE,IAAI,CAAC,GAAGA,IAAIF,EAAE,GAAGC,EAAEC,CAAC,IAAIH,EAAE,MAAM,IAAI,WAAW,qCAAqC,EAAE,GAAGE,EAAEC,CAAC,GAAGD,EAAEC,CAAC,EAAE,IAAIH,EAAE,GAAGH,EAAE,UAAUA,EAAE,WAAW,GAAGM,EAAE,GAAGD,EAAEC,CAAC,EAAE,EAAE,EAAED,EAAEC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAEG,GAAElB,GAAMmB,GAAElB,GAAG,YAAY,OAAOA,CAAC,EAAE,IAAI,WAAWA,EAAE,MAAM,EAAE,SAASA,EAAE,WAAWA,EAAE,WAAWA,EAAE,UAAU,EAAE,IAAI,WAAWA,CAAC,EAAEmB,GAAED,GAAME,GAAE,CAAC,KAAK,CAAC,EAAE,WAAW,CAAC,EAAE,SAAS,CAAC,EAAE,MAAM,CAAC,EAAE,QAAQ,CAAC,EAAE,KAAK,CAAC,CAAC,EAAEC,GAAE,CAACrB,EAAEC,EAAEC,EAAEC,IAAI,CAAC,IAAIC,EAAE,IAAI,WAAW,EAAE,EAAEC,EAAEC,EAAEgB,EAAEf,EAAE,EAAEC,EAAE,EAAEC,EAAE,IAAI,WAAW,GAAG,EAAEC,EAAEU,GAAE,KAAKT,EAAE,IAAI,gBAAgB,CAAC,MAAM,IAAI,CAAC,EAAE,UAAU,MAAMC,EAAEC,IAAI,CAAC,IAAIC,EAAEK,GAAEP,CAAC,EAAEG,EAAE,EAAE,KAAKA,EAAEH,EAAE,YAAY,OAAOF,EAAE,CAAC,KAAKU,GAAE,KAAK,CAAC,IAAIJ,EAAEF,EAAE,SAASC,EAAEA,EAAEX,EAAE,WAAWI,CAAC,EAAE,GAAGJ,EAAE,IAAIY,EAAER,CAAC,EAAEA,GAAGQ,EAAE,WAAWD,GAAGC,EAAE,WAAWR,IAAIJ,EAAE,WAAW,CAACI,EAAE,EAAEE,EAAEU,GAAE,WAAW,QAAQ,CAAC,KAAK,CAAC,KAAKA,GAAE,WAAW,CAAC,IAAIJ,EAAEF,EAAE,SAASC,EAAEA,EAAE,EAAEP,CAAC,EAAEe,EAAE,IAAI,YAAY,CAAC,EAAEC,EAAE,IAAI,WAAWD,CAAC,EAAEE,EAAE,IAAI,SAASF,CAAC,EAAE,GAAGC,EAAE,IAAIR,EAAER,CAAC,EAAED,GAAGkB,EAAE,UAAU,EAAE,EAAE,EAAEjB,GAAGQ,EAAE,WAAWD,GAAGC,EAAE,WAAWR,IAAI,EAAE,CAAC,GAAGD,GAAGP,EAAE,WAAW,GAAGO,GAAGJ,GAAG,KAAK,WAAW,KAAK,IAAI,WAAWA,CAAC,GAAG,MAAM,IAAI,WAAW,wBAAwBI,CAAC,EAAEC,EAAE,EAAEE,EAAEU,GAAE,SAAS,QAAQ,CAAC,KAAK,CAAC,KAAKA,GAAE,SAAS,CAACX,EAAE,CAAC,EAAEK,EAAEC,GAAG,EAAEL,EAAEU,GAAE,MAAM,QAAQ,CAAC,KAAKA,GAAE,MAAM,CAAC,IAAIJ,EAAEF,EAAE,SAASC,EAAEA,EAAEN,EAAE,CAAC,EAAED,CAAC,EAAE,GAAGC,EAAE,IAAIO,EAAE,EAAER,CAAC,EAAEA,GAAGQ,EAAE,WAAWD,GAAGC,EAAE,WAAWR,IAAIC,EAAE,CAAC,EAAE,CAAC,IAAIc,EAAE,MAAMrB,EAAEO,EAAE,SAAS,EAAE,EAAEA,EAAE,CAAC,CAAC,CAAC,EAAEP,EAAE,OAAO,IAAIsB,EAAE,MAAMP,GAAEjB,EAAEuB,EAAEnB,EAAE,CAAC,SAAS,CAAC,EAAEE,EAAEkB,EAAE,CAAC,EAAEF,EAAEE,EAAE,CAAC,EAAEnB,EAAE,IAAI,WAAWE,CAAC,EAAEC,EAAE,EAAEE,EAAEU,GAAE,QAAQ,QAAQ,CAAC,KAAK,CAAC,KAAKA,GAAE,QAAQ,CAAC,IAAIJ,EAAEF,EAAE,SAASC,EAAEA,EAAER,EAAEC,CAAC,EAAE,GAAGH,EAAE,IAAIW,EAAER,CAAC,EAAEA,GAAGQ,EAAE,WAAWD,GAAGC,EAAE,WAAWR,IAAID,EAAE,CAAC,IAAIiB,EAAEF,EAAE,KAAK,EAAE,MAAMG,EAAEN,GAAE,MAAM,WAAW,OAAO,OAAO,QAAQ,CAAC,KAAKnB,EAAE,OAAO,KAAK,GAAGwB,EAAE,UAAUxB,EAAE,YAAY,CAAC,EAAEM,EAAED,EAAE,SAAS,EAAEG,CAAC,CAAC,CAAC,EAAEkB,EAAED,EAAE,WAAW,EAAE,KAAKC,EAAE,GAAGD,EAAEC,CAAC,IAAI,EAAEA,IAAI,CAAC,GAAGD,EAAEC,CAAC,IAAI,EAAE,CAAC,GAAGX,IAAIH,EAAE,WAAW,MAAM,IAAI,MAAM,uCAAuC,EAAEF,EAAEU,GAAE,IAAI,SAASK,EAAEC,CAAC,IAAI,EAAE,MAAM,IAAI,MAAM,2BAA2B,EAAEb,EAAE,QAAQY,EAAE,OAAO,MAAM,EAAEC,CAAC,CAAC,EAAED,EAAE,KAAK,CAAC,EAAEjB,EAAE,EAAE,QAAQ,CAAC,KAAK,CAAC,QAAQ,MAAM,IAAI,MAAM,eAAe,CAAC,CAAC,EAAE,MAAM,MAAMI,GAAG,CAAC,OAAOF,EAAE,CAAC,KAAKU,GAAE,KAAK,OAAO,KAAKA,GAAE,QAAQ,CAAC,GAAGZ,EAAE,EAAER,EAAE,WAAW,MAAM,IAAI,MAAM,wBAAwB,EAAE,IAAIc,EAAEQ,EAAE,KAAK,EAAE,MAAMP,EAAEI,GAAE,MAAM,WAAW,OAAO,OAAO,QAAQ,CAAC,KAAKnB,EAAE,OAAO,KAAK,GAAGc,EAAE,UAAUd,EAAE,YAAY,CAAC,EAAEM,EAAED,EAAE,SAAS,EAAEG,CAAC,CAAC,CAAC,EAAEQ,EAAED,EAAE,WAAW,EAAE,KAAKC,EAAE,GAAGD,EAAEC,CAAC,IAAI,EAAEA,IAAI,CAAC,GAAGD,EAAEC,CAAC,IAAI,EAAE,MAAM,IAAI,MAAM,2CAA2C,EAAEJ,EAAE,QAAQG,EAAE,OAAO,MAAM,EAAEC,CAAC,CAAC,EAAED,EAAE,KAAK,CAAC,EAAE,MAAM,CAAC,QAAQ,MAAM,IAAI,MAAM,eAAe,CAAC,CAAC,CAAC,CAAC,EAAE,OAAOd,EAAE,YAAYU,CAAC,EAAEA,EAAE,QAAQ,EAAEgB,GAAEN,GCAn/F,IAAqWO,GAAE,CAAC,OAAO,CAAC,KAAK,UAAU,OAAO,GAAG,EAAE,IAAI,UAAU,CAAC,OAAO,IAAI,WAAW,CAAC,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,YAAY,CAAC,OAAO,IAAI,WAAW,CAAC,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,WAAW,GAAG,WAAW,GAAG,aAAa,EAAE,ECApsB,IAAIC,GAAE,MAAM,EAAEC,EAAEC,EAAEC,IAAI,CAAC,IAAIC,EAAE,MAAM,WAAW,OAAO,OAAO,UAAU,MAAMH,EAAE,OAAO,GAAG,CAAC,YAAY,YAAY,CAAC,EAAEI,EAAE,MAAM,WAAW,OAAO,OAAO,UAAU,CAAC,KAAK,OAAO,KAAK,UAAU,KAAK,EAAE,SAAS,KAAKH,CAAC,EAAEE,EAAE,EAAE,OAAO,GAAGD,CAAC,EAAEG,EAAE,MAAM,WAAW,OAAO,OAAO,WAAW,CAAC,KAAK,OAAO,KAAK,UAAU,KAAK,EAAE,WAAW,KAAKJ,CAAC,EAAEE,EAAE,EAAE,cAAc,CAAC,EAAE,MAAM,CAACC,EAAE,WAAW,CAAC,IAAIE,EAAE,IAAI,YAAY,EAAE,YAAY,EAAEC,EAAE,IAAI,SAASD,CAAC,EAAEE,EAAE,IAAI,WAAWF,CAAC,EAAEG,EAAE,IAAI,WAAWJ,CAAC,EAAEK,EAAE,WAAWC,GAAG,EAAE,cAAc,GAAG,EAAEC,EAAE,IAAI,MAAMD,CAAC,EAAE,KAAK,CAAC,EAAE,OAAO,CAAC,QAAQE,EAAE,EAAEA,GAAGH,EAAEG,IAAI,CAACN,EAAE,UAAUA,EAAE,WAAW,EAAEM,EAAE,EAAE,EAAE,IAAIC,EAAE,IAAI,WAAW,EAAE,YAAY,EAAE,QAAQC,EAAE,EAAEA,EAAED,EAAE,OAAOC,IAAID,EAAEC,CAAC,EAAEN,EAAEM,CAAC,EAAEP,EAAEO,CAAC,EAAE,MAAMD,CAAC,CAAC,QAAQD,EAAE,EAAEA,EAAEF,EAAEE,IAAI,CAAC,GAAGA,IAAIF,EAAE,GAAGC,EAAEC,CAAC,IAAIH,EAAE,MAAM,IAAI,WAAW,qCAAqC,EAAE,GAAGE,EAAEC,CAAC,GAAGD,EAAEC,CAAC,EAAE,IAAIH,EAAE,GAAGH,EAAE,UAAUA,EAAE,WAAW,GAAGM,EAAE,GAAGD,EAAEC,CAAC,EAAE,EAAE,EAAED,EAAEC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAEG,GAAEjB,GAAMkB,GAAE,GAAG,YAAY,OAAO,CAAC,EAAE,IAAI,WAAW,EAAE,MAAM,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,EAAE,UAAU,EAAE,IAAI,WAAW,CAAC,EAAEC,GAAED,GAAME,GAAE,IAAI,CAAC,IAAI,EAAE,IAAI,WAAW,EAAE,EAAE,OAAO,WAAW,OAAO,gBAAgB,CAAC,EAAE,CAAC,EAAEC,GAAE,MAAM,EAAEpB,EAAEC,EAAEC,EAAEC,EAAEC,IAAI,CAAC,GAAGH,GAAG,EAAE,WAAW,GAAGA,EAAE,WAAW,MAAM,IAAI,WAAW,wBAAwBA,CAAC,EAAE,GAAGC,EAAE,WAAW,IAAI,MAAM,IAAI,WAAW,iBAAiB,EAAE,GAAGE,GAAGA,EAAE,aAAa,GAAG,MAAM,IAAI,WAAW,uBAAuBA,EAAE,UAAU,EAAE,IAAIC,EAAEJ,EAAE,EAAE,WAAW,EAAEoB,EAAEjB,EAAEc,GAAEd,CAAC,EAAEe,GAAE,EAAE,CAACb,EAAEC,CAAC,EAAE,MAAMS,GAAE,EAAEb,EAAEkB,EAAE,CAAC,SAAS,CAAC,EAAElB,EAAE,OAAO,IAAIK,EAAE,IAAI,WAAWH,CAAC,EAAEI,EAAE,EAAE,EAAE,IAAI,gBAAgB,CAAC,MAAME,GAAG,CAAC,IAAIC,EAAES,EAAE,WAAW,EAAE,EAAEnB,EAAE,WAAWW,EAAE,IAAI,YAAYD,CAAC,EAAE,IAAI,WAAWC,EAAE,EAAEQ,EAAE,UAAU,EAAE,IAAIA,CAAC,EAAE,IAAIN,EAAE,IAAI,SAASF,EAAEQ,EAAE,WAAW,CAAC,EAAEN,EAAE,UAAU,EAAEd,EAAE,EAAE,EAAEc,EAAE,SAAS,EAAEb,EAAE,UAAU,EAAE,IAAIoB,EAAE,IAAI,WAAWT,EAAEQ,EAAE,WAAW,EAAE,EAAEnB,EAAE,UAAU,EAAEqB,EAAEL,GAAEhB,CAAC,EAAEoB,EAAE,IAAIC,CAAC,EAAEZ,EAAE,QAAQE,CAAC,CAAC,EAAE,UAAU,MAAMF,EAAEC,IAAI,CAAC,IAAIC,EAAEK,GAAEP,CAAC,EAAEG,EAAE,EAAE,KAAKA,EAAEH,EAAE,YAAY,CAAC,IAAII,EAAEF,EAAE,SAASC,EAAEA,EAAET,EAAEI,CAAC,EAAE,GAAGD,EAAE,IAAIO,EAAEN,CAAC,EAAEA,GAAGM,EAAE,WAAWD,GAAGC,EAAE,WAAWN,IAAIJ,EAAE,CAAC,IAAIkB,EAAEhB,EAAE,KAAK,EAAE,MAAMiB,EAAE,IAAI,WAAWnB,EAAE,CAAC,EAAEmB,EAAE,IAAIhB,EAAE,SAAS,EAAEC,CAAC,CAAC,EAAEe,EAAEf,CAAC,EAAE,EAAE,IAAIgB,EAAE,MAAM,WAAW,OAAO,OAAO,QAAQ,CAAC,KAAK,EAAE,OAAO,KAAK,GAAGF,EAAE,UAAU,EAAE,YAAY,CAAC,EAAEjB,EAAEkB,CAAC,EAAEZ,EAAE,QAAQa,CAAC,EAAEhB,EAAE,CAAC,CAAC,CAAC,EAAE,MAAM,MAAME,GAAG,CAAC,IAAIE,EAAEN,EAAE,KAAK,EAAE,MAAMO,EAAE,IAAI,WAAWL,EAAE,CAAC,EAAEK,EAAE,IAAIN,EAAE,SAAS,EAAEC,CAAC,CAAC,EAAEK,EAAEL,CAAC,EAAE,EAAE,IAAIM,EAAE,MAAM,WAAW,OAAO,OAAO,QAAQ,CAAC,KAAK,EAAE,OAAO,KAAK,GAAGF,EAAE,UAAU,EAAE,YAAY,CAAC,EAAEP,EAAEQ,CAAC,EAAEH,EAAE,QAAQI,CAAC,EAAEP,EAAE,KAAK,CAAC,EAAEM,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,OAAOd,EAAE,YAAY,CAAC,EAAE,EAAE,QAAQ,EAAE0B,GAAEN,GCiBxxE,IAAIO,GAAyB,OAAO,QAAW,WAAa,IAAM,CAChE,IAAIC,EAAiB,GAEfC,EAAiB,IAAI,QAAQ,GAAI,CACrC,KAAM,IAAI,eACV,OAAQ,OACR,IAAI,QAAU,CACZ,OAAAD,EAAiB,GACV,MACT,CACF,CAAC,EAAE,QAAQ,IAAI,cAAc,EAE7B,OAAOA,GAAkB,CAACC,CAC5B,GAAG,EAEGC,GAAqB,MAAOC,GAAsB,CACtD,IAAMC,EAASD,EAAE,UAAU,EACrBE,EAAuB,CAAC,EAC1BC,EAAS,EACb,OAAS,CACP,IAAMC,EAAS,MAAMH,EAAO,KAAK,EACjC,GAAIG,EAAO,KAAM,MACjBF,EAAO,KAAKG,EAAOD,EAAO,KAAK,CAAC,EAEhCD,GAAUC,EAAO,MAAM,UACzB,CACA,IAAME,EAAO,IAAI,WAAWH,CAAM,EAClC,OAAAD,EAAO,OAAO,CAACK,EAAQC,KACrBF,EAAK,IAAIE,EAAOD,CAAM,EACfA,EAASC,EAAM,YACrB,CAAC,EACGF,CACT,EAIMG,GAAgC,eAAgBC,EAAuBV,EAAmB,CAiB9F,OAdIJ,KAA2B,IAC7B,MAAM,KAAK,OAAO,MAAM,GAAGc,CAAa,gBAAiB,CACvD,OAAQ,OACR,KAAM,IAAI,eAAe,CAAE,MAAOC,EAAG,CAAEA,EAAE,QAAQ,OAAO,KAAK,IAAI,CAAC,EAAGA,EAAE,MAAM,CAAE,CAAE,CAAC,EAClF,OAAQ,MACV,CAAC,EAAE,KAAM,GAAM,CACb,GAAI,CAAC,EAAE,GAAI,MAAM,IAAI,MAAM,qBAAqB,EAEhDf,GAAyB,CAC3B,CAAC,EAAE,MAAM,IAAM,CACb,QAAQ,KAAK,kEAAkE,EAC/EA,GAAyB,EAC3B,CAAC,EAEEA,GAIEI,EAAE,YAEP,IAAI,gBAEF,CACE,UAAWQ,EAAOI,EAAY,CAC5BA,EAAW,QAAQP,EAAOG,CAAK,CAAC,CAClC,CACF,CAAC,CACL,EAZS,MAAMT,GAAmBC,CAAC,CAarC,EAEMa,GAA2BC,GAA6B,CAC5D,IAAIX,EAAS,EACP,CAACY,EAAcC,CAAS,EAAIF,EAAS,IAAI,EACzCG,EAAgB,IAAI,QAAQ,CAACC,EAASC,IAAW,CAErDJ,EAAa,OAAO,IAAI,eAAe,CACrC,MAAOP,EAAO,CACZL,GAAUK,EAAM,UAClB,EACA,OAAS,CACPU,EAAQf,CAAM,CAChB,EACA,MAAOiB,EAAQ,CACbD,EAAOC,CAAM,CACf,CACF,CAAC,CAAC,CACJ,CAAC,EACKC,EAAaC,GAAoBN,EAAWO,GAAW,kBAAkB,EAC/E,OAAO,QAAQ,IAAI,CAACN,EAAeI,CAAU,CAAC,CAChD,EAEMG,GAAa,CAACC,EAAkBC,IAAqB,CAuCzD,IAAMC,EAtCgB,iBAAoB,CACxC,IAAIC,EAAW,EACf,QAAWpB,KAASkB,EAAS,OAAQ,CACnC,GACE,CAAC,MAAM,QAAQlB,CAAK,GACpB,OAAOA,EAAM,CAAC,GAAM,UACpB,OAAOA,EAAM,CAAC,GAAM,SAEpB,MAAM,IAAI,MAAM,0BAA0B,EAE5C,IAAMqB,EAAgB,MAAMJ,EAAS,OAAO,MAAM,GAAGA,EAAS,OAAO,aAAa,SAASjB,EAAM,CAAC,CAAC,GAAI,CACrG,OAAQ,MACR,OAAQiB,EAAS,gBAAgB,MACnC,CAAC,EACD,GAAI,CAACI,EAAc,GACjB,MAAM,IAAI,MAAM,6BAA6B,EAM/C,IAAMC,EAAc,MAAMD,EAAc,YAAY,EACpD,GAAIC,EAAY,aAAetB,EAAM,CAAC,EAAG,MAAM,IAAI,MAAM,uBAAuB,EAEhF,GADAoB,GAAYE,EAAY,WACpBF,EAAWF,EAAS,KAAM,MAAM,IAAI,MAAM,iCAAiC,EAC/E,GAAIK,GAAU1B,EAAOyB,CAAW,EAAGP,GAAW,kBAAkB,IAAMf,EAAM,CAAC,EAAG,MAAM,IAAI,MAAM,uBAAuB,EACvH,MAAMsB,CACR,CAQA,GAAIF,IAAaF,EAAS,KAAM,MAAM,IAAI,MAAM,iBAAiB,CACnE,EAEmC,EAEnC,OAAO,IAAI,eAAe,CACxB,MAAM,KAAMd,EAAY,CACtB,GAAI,CACF,IAAMJ,EAAQ,MAAMmB,EAAa,KAAK,EACtC,GAAInB,EAAM,KAAM,CACdI,EAAW,MAAM,EACjB,MACF,CACAA,EAAW,QAAQJ,EAAM,KAAK,CAChC,OAASwB,EAAG,CACVpB,EAAW,MAAMoB,CAAC,CACpB,CACF,CACF,CAAC,CACH,EAEaC,GAAyB,CACpC,OAAQ,CAACC,EAAmBC,IAA4B,CAItD,IAAMC,EAASD,EAAgB,eAAe,EAC1CE,EAAMD,GAAQ,IACZE,EAAaF,GAAQ,IAAM,MAC5BC,IACHA,EAAM,IAAI,WAAW,EAAE,EACvB,KAAK,OAAO,gBAAgBA,CAAG,GAkBjC,IAAME,EAAQC,GAAY,kBAAoBA,GAAYH,CAAG,CAAC,EAAE,MAAM,EAAE,EAClEI,EAAc,OAAO,KAAKF,CAAK,EACrC,MAAO,CACL,aAAc,CACZ,MAAAA,CACF,EACA,cAAe,MAAOG,GACb,MAAMC,GAAQX,GAAWU,EAAQJ,EAAYG,EAAaJ,CAAG,EAEtE,eAAgB,CACd,IAAK,OAAO,KAAKA,CAAG,EAAE,SAAS,QAAQ,EACvC,GAAIC,CACN,CACF,CACF,EACA,SAAU,CAACb,EAAkBmB,EAAwBlB,IAAqB,CACxE,IAAMmB,EAASD,EAAe,IAC9B,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,IAAMR,EAAM,OAAO,KAAKQ,EAAQ,QAAQ,EAClCN,EAAQC,GAAY,kBAAoBA,GAAYH,CAAG,CAAC,EAAE,MAAM,EAAE,EACxE,GAAI,CAACX,EAAS,eAAe,GAAK,CAACA,EAAS,eAAe,EAAE,MAC3D,MAAM,IAAI,MAAM,uBAAuB,EAEzC,GAAIa,IAAUb,EAAS,eAAe,EAAE,MACtC,MAAM,IAAI,MAAM,iBAAiB,EAEnC,IAAMoB,EAAgBF,EAAe,IAAM,GAAK,GAChD,MAAO,CACL,eAAgB,SAAY,CAC1B,IAAMG,EAAQ,MAAMhD,GAClBiD,GAAQhB,GAAWR,GAAWC,EAAUC,CAAQ,EAAIuB,GAAgB,CAClE,GAAI,OAAO,KAAKA,CAAW,EAAE,SAAS,IAAMV,EAC1C,MAAM,IAAI,MAAM,gBAAgB,EAElC,OAAOF,CACT,EAAGS,CAAa,CAClB,EACA,OAAO,IAAI,KAAK,CAACC,CAAK,EAAG,CAAE,KAAMrB,EAAS,MAAQ,0BAA2B,CAAC,CAChF,CACF,CACF,CACF,EAEawB,GAAoB,CAC/B,OAAQ,KACC,CACL,aAAc,OACd,cAAgBR,GACPA,EAET,eAAgB,MAClB,GAEF,SAAU,CAACjB,EAAkB0B,EAAyBzB,KAC7C,CACL,eAAgB,SAAY,CAC1B,IAAMqB,EAAQ,MAAMhD,GAAmByB,GAAWC,EAAUC,CAAQ,CAAC,EACrE,OAAO,IAAI,KAAK,CAACqB,CAAK,EAAG,CAAE,KAAMrB,EAAS,MAAQ,0BAA2B,CAAC,CAChF,CACF,EAEJ,EAGM0B,GAAiB,CACrB,UAAWnB,GACX,KAAMiB,EACR,EAEOG,GAASC,EAAI,yBAA0B,CAC5C,sBAAuB,eAAgBpD,EAAuBiC,EAAyB,CAAE,mBAAAoB,CAAmB,EAAoC,CAAC,EAAG,CAC7I,MAAM,QAAQrD,CAAM,IAAGA,EAAS,CAACA,CAAM,GAC5C,IAAMsD,EAAgD,CAAC,EACjDC,EAAgB,MAAML,GAAejB,EAAgB,MAAM,GAAG,SAAS,KAAMA,CAAe,EAClG,GAAI,CAACsB,EAAe,MAAM,IAAI,MAAM,oBAAoB,EACxD,IAAMC,EAAeD,EAAc,aAC7BE,EAAgB,MAAM,QAAQ,IAAIzD,EAAO,IAAI,MAAOM,EAAaoD,IAAM,CAC3E,IAAMlB,EAASlC,EAAM,OAAO,EACtBqD,EAAkB,MAAMJ,EAAc,cAAcf,CAAM,EAC1D,CAACpC,EAAMN,CAAC,EAAI6D,EAAgB,IAAI,EACtC,OAAAL,EAAiB,KAAK3C,GAAwBb,CAAC,CAAC,EACzC,CACL,QAAS,IAAI,QAAQ,CACnB,CAAC,sBAAuB,oBAAoB4D,CAAC,gBAAgBA,CAAC,GAAG,EACjE,CAAC,eAAgB,0BAA0B,CAC7C,CAAC,EACD,KAAAtD,CACF,CACF,CAAC,CAAC,EACFqD,EAAc,KAAK,CACjB,QAAS,IAAI,QAAQ,CACnB,CAAC,sBAAuB,sDAAsD,EAC9E,CAAC,eAAgB,sCAAsC,CACzD,CAAC,EACD,KAAM,IAAI,eAAe,CACvB,MAAM,MAAO/C,EAAY,CACvB,IAAMV,EAAS,MAAM,QAAQ,IAAIsD,CAAgB,EAC3C9B,EAAW,CACf,QAAS,QAIT,KAAMS,EAAgB,MAAQ,OAC9B,KAAMA,EAAgB,MAAQ,OAC9B,OAAQA,EAAgB,OACxB,gBAAiBuB,EACjB,KAAMxD,EAAO,OAAO,CAAC4D,EAAK,CAACC,CAAE,IAAMD,EAAMC,EAAI,CAAC,EAC9C,OAAA7D,EACA,WAAYiC,EAAgB,UAAU,GAAK,OAC3C,aAAcA,EAAgB,cAAgB,MAChD,EACAvB,EAAW,QAAQ,OAAO,KAAK,KAAK,UAAUc,CAAQ,CAAC,CAAC,EACxDd,EAAW,MAAM,CACnB,CACF,CAAC,CACH,CAAC,EAGD,IAAMoD,EAAW,OAAO,KAAK,QAAQ,YAAe,WAChD,KAAK,OAAO,WAAW,EAKvB,IAAI,MAAM,EAAE,EAAE,KAAK,EAAE,EAAE,IAAI,IAC3B,gCAAiC,KAAK,QAAQ,EAAI,GAAK,CAAC,CAAC,EAAE,KAAK,EAAE,EAChEtB,EAASuB,GAAuBD,EAAUL,CAAa,EAEvDO,EAAgB,gBAAkBC,GAAa,EAC/CC,EAAoB5B,GAAY0B,CAAa,EAE7CG,EAAiB,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,QAAS,CAClF,OAAQ,OACR,OAAQ,KAAK,gBAAgB,OAC7B,KAAM,MAAM5D,GAA8B,KAAK,KAAM,KAAK,OAAO,cAAeiC,CAAM,EACtF,QAAS,IAAI,QAAQ,CACnB,GAAIa,EAAqB,CAAC,CAAC,gBAAiBe,GAAgC,KAAK,KAAMf,CAAkB,CAAC,CAAC,EAAI,CAAC,EAChH,CAAC,eAAgB,iCAAiCS,CAAQ,EAAE,EAC5D,CAAC,gCAAiCI,CAAiB,CACrD,CAAC,EACD,OAAQ,MACV,CAAC,EAED,GAAI,CAACC,EAAe,GAAI,MAAM,IAAI,MAAM,sBAAsB,EAC9D,MAAO,CACL,SAAU,CACR,YAAa,MAAMA,EAAe,KAAK,EACvC,eAAgBZ,EAAc,cAChC,EACA,OAAQS,CACV,CACF,EACA,wBAAyB,eAAgBK,EAA0EC,EAAoE,CAErL,GAAM,CAAE,YAAAC,EAAa,eAAA7B,CAAe,EAAI2B,EAAgB,QAAQ,EAC1DG,EAAmB,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,SAASD,CAAW,GAAI,CACnG,OAAQ,MACR,OAAQ,KAAK,gBAAgB,MAC/B,CAAC,EACD,GAAI,CAACC,EAAiB,GACpB,MAAM,IAAI,MAAM,6BAA6B,EAE/C,IAAMC,EAAiB,MAAMD,EAAiB,YAAY,EAC1D,GAAI3C,GAAU1B,EAAOsE,CAAc,EAAGpD,GAAW,qBAAqB,IAAMkD,EAAa,MAAM,IAAI,MAAM,0BAA0B,EACnI,IAAM/C,EAAW,KAAK,MAAM,OAAO,KAAKiD,CAAc,EAAE,SAAS,CAAC,EAClE,GAAI,OAAOjD,GAAa,SAAU,MAAM,IAAI,MAAM,4BAA4B,EAC9E,GAAIA,EAAS,UAAY,QAAS,MAAM,IAAI,MAAM,8BAA8B,EAChF,GAAI,CAAC,MAAM,QAAQA,EAAS,MAAM,EAAG,MAAM,IAAI,MAAM,gCAAgC,EAErF,GAAI8C,GAEE,CADY,MAAMA,IAAkB9C,CAAQ,EAClC,MAAO,GAGvB,IAAM+B,EAAgB,MAAML,GAAe1B,EAAS,MAAM,GAAG,WAAW,KAAMkB,EAAgBlB,CAAQ,EACtG,GAAI,CAAC+B,EAAe,MAAM,IAAI,MAAM,oBAAoB,EAExD,OAAOA,EAAc,eAAe,CACtC,EACA,sBAAuB,eAAgBgB,EAAgCG,EAA0F,CAAC,EAAG,CACnK,GAAI,CAACH,EACH,MAAM,IAAI,UAAU,iCAAiC,EAEvD,OAAK,MAAM,QAAQA,CAAW,IAAGA,EAAc,CAACA,CAAW,GACpD,MAAM,QAAQ,WAAWA,EAAY,IAAI,MAAOI,GAAQ,CAC7D,IAAMC,EAAgBC,EAAIH,EAAaC,CAAG,EACpCG,EAAWD,EAAIH,EAAYC,CAAG,EAAG,OAAO,GAAKD,EAAYC,CAAG,EAAE,MAC9DI,EAAwBF,EAAIH,EAAYC,CAAG,EAAG,oBAAoB,GAAKD,EAAYC,CAAG,EAAE,mBAC9F,GAAI,CAACC,GAAiBE,IAAaC,EACjC,MAAM,IAAI,UAAU,iEAAiEJ,CAAG,EAAE,EAgB5F,GAAI,EAba,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,eAAeA,CAAG,GAAI,CACzF,OAAQ,OACR,OAAQ,KAAK,gBAAgB,OAC7B,QAAS,IAAI,QAAQ,CACnB,CAAC,gBACCG,EAEI,UAAWJ,EAAYC,CAAG,EAAE,MAAY,QAAQ,CAAC,GAGjDP,GAAgC,KAAK,KAAMM,EAAYC,CAAG,EAAE,kBAAkB,CAAC,CACvF,CAAC,CACH,CAAC,GACa,GACZ,MAAM,IAAI,MAAM,yBAAyBA,CAAG,EAAE,CAElD,CAAC,CAAC,CACJ,CACF,CAAC,EC5YD,IAAMK,GAAa,QAEbC,GAA4BC,GAAyB,CACzD,GAAKA,EAAI,WAAWF,EAAU,EAC9B,OAAOE,EAAI,MAAMF,GAAW,MAAM,CACpC,EACMG,GAAcC,GAA+B,GAAGJ,EAAU,GAAGI,CAAU,GA4C7EC,EAAI,uBAAwB,CAAC,kBAAmB,kBAAmB,oBAAoB,CAAC,EASxF,IAAMC,GACF,CACE,kBAAmB,SAAUC,EAAyD,CACpF,IAAMC,EAAKC,GAAyBF,CAAG,EACvC,GAAI,CAACC,EAAI,OAAO,QAAQ,QAAQ,EAChC,IAAME,EAAQL,EAAI,oBAAoB,EAAE,UAAUG,CAAE,EAC9CG,EAASD,GAAO,KAClB,KAAK,UAAU,CACf,KAAMA,EAAM,KACZ,OAAQA,EAAM,OACd,cAAeA,EAAM,aACvB,CAAC,EACC,OACJ,OAAO,QAAQ,QAAQC,CAAK,CAC9B,EACA,kBAAmB,UAAmC,CACpD,OAAO,QAAQ,QAAQ,CACzB,EACA,qBAAsB,UAA8B,CAAE,OAAO,QAAQ,QAAQ,EAAI,CAAE,CACrF,EAsBGC,GAAUP,EAAI,yBAA0B,CAC7C,GAAGC,GACH,2BAA4B,MAAOO,EAAoBC,IAAmB,CACxE,IAAMC,EAAgB,MAAMV,EAAI,kBAAmB,iBAAiBQ,CAAU,IAAIC,CAAM,EAAE,EAC1F,GAAKC,EAEL,OAAO,KAAK,MAAMA,CAAa,CACjC,EACA,2BAA4B,MAAOF,EAAoBC,EAAgBE,IAAsB,CAC3F,IAAMD,EAAgB,KAAK,UAAUC,CAAS,EAC9C,MAAMX,EAAI,kBAAmB,iBAAiBQ,CAAU,IAAIC,CAAM,GAAIC,CAAa,CACrF,EACA,6BAA8B,MAAOF,GAAiD,CACpF,IAAMI,EAAI,MAAMZ,EAAI,kBAAmBa,GAAWL,CAAU,CAAC,EAC7D,OAAOI,GAAK,KAAK,MAAMA,CAAC,CAC1B,EACA,mCAAqCJ,GAC5BR,EAAI,kBAAmBa,GAAWL,CAAU,EAAG,EAAE,EAE1D,uBAAwB,eAAgBM,EAAkC,CACxE,GAAI,CACF,IAAMR,EAAgB,MAAMN,EAAI,kBAAmBc,CAAI,EACvD,GAAI,CAACR,EAAO,MAAM,IAAI,MAAM,gBAAgBQ,CAAI,GAAG,EACnD,OAAOC,EAAU,YAAYT,EAAO,KAAK,oBAAqB,OAAW,KAAK,OAAO,wBAAwB,CAC/G,OAASU,EAAG,CACV,MAAM,IAAIC,GAAsB,GAAGD,EAAE,IAAI,qBAAqBA,EAAE,OAAO,EAAE,CAC3E,CACF,EACA,uBAAwB,SAAUE,EAAmC,CAGnE,OAAOlB,EAAI,kCAAmC,eAAekB,EAAM,WAAW,CAAC,GAAI,CACjF,+BAAgCA,CAClC,CAAC,CACH,EAEA,+BAAgC,eAAgBA,EAAmC,CACjF,GAAI,CACF,GAAM,CAAE,aAAcC,EAAmB,cAAeC,EAAoB,OAAQC,CAAY,EAAIH,EAAM,KAAK,EACzGV,EAAqBU,EAAM,WAAW,EAC5C,GAAI,MAAMlB,EAAI,kBAAmBkB,EAAM,KAAK,CAAC,EAC3C,eAAQ,KAAK,+BAA+BA,EAAM,KAAK,CAAC,EAAE,EACnDA,EAAM,KAAK,EAEpB,IAAMI,EAAW,MAAMtB,EAAI,6BAA8BQ,CAAU,EACnE,GAAKU,EAAM,eAAe,EAenB,CACL,GAAII,EACF,cAAQ,MAAM,mCAAmCH,CAAiB,sCAAsCX,CAAU,EAAE,EAC9G,IAAIe,GAA2B,qBAAqBJ,CAAiB,qCAAqCX,CAAU,EAAE,EACvH,GAAIa,IAAgB,EACzB,cAAQ,MAAM,6BAA6BA,CAAW,iCAAiCb,CAAU,EAAE,EAC7F,IAAIe,GAA2B,6BAA6BF,CAAW,iCAAiCb,CAAU,EAAE,CAE9H,KAvB6B,CAC3B,GAAI,CAACc,EACH,MAAM,IAAI,MAAM,sBAAsBd,CAAU,wDAAwDW,CAAiB,cAAcE,CAAW,EAAE,EAEtJ,GAAM,CAAE,KAAMG,EAAc,cAAeC,EAAuB,OAAQC,CAAe,EAAIJ,EAC7F,GAAIH,IAAsBK,EACxB,cAAQ,KAAK,mCAAmCL,CAAiB,eAAeK,CAAY,oBAAoBhB,CAAU,EAAE,EACtH,IAAIe,GAA2B,qBAAqBJ,CAAiB,cAAcK,CAAY,oBAAoBhB,CAAU,EAAE,EAChI,GAAIY,IAAuBK,EAChC,cAAQ,MAAM,oCAAoCL,CAAkB,eAAeK,CAAqB,oBAAoBjB,CAAU,EAAE,EAClI,IAAIe,GAA2B,sBAAsBH,CAAkB,cAAcK,CAAqB,oBAAoBjB,CAAU,EAAE,EAC3I,GAAI,CAAC,OAAO,cAAca,CAAW,GAAKA,IAAiBK,EAAiB,EACjF,cAAQ,MAAM,6BAA6BL,CAAW,eAAeK,EAAiB,CAAC,oBAAoBlB,CAAU,EAAE,EACjH,IAAIe,GAA2B,6BAA6BF,CAAW,eAAeK,EAAiB,CAAC,oBAAoBlB,CAAU,EAAE,CAElJ,CASA,aAAMR,EAAI,kBAAmBkB,EAAM,KAAK,EAAGA,EAAM,UAAU,CAAC,EAC5D,MAAMlB,EAAI,kBAAmBa,GAAWL,CAAU,EAAG,KAAK,UAAU,CAClE,KAAMU,EAAM,KAAK,EACjB,cAAeA,EAAM,QAAQ,EAAIA,EAAM,KAAK,EAAIA,EAAM,cAAc,EACpE,OAAQA,EAAM,OAAO,CACvB,CAAC,CAAC,EACF,QAAQ,MAAM,0BAA0BV,CAAU,eAAgBU,EAAM,KAAK,CAAC,EAC9E,MAAMlB,EAAI,2BAA4BQ,EAAYa,EAAa,CAE7D,KAAMH,EAAM,KAAK,EAEjB,KAAM,IAAI,KAAK,EAAE,YAAY,EAK7B,GAAIA,EAAM,QAAQ,GAAK,CAAE,QAAS,EAAK,CACzC,CAAC,EACMA,EAAM,KAAK,CACpB,OAASF,EAAG,CACV,MAAIA,EAAE,KAAK,SAAS,SAAS,EACrBA,EAEF,IAAIC,GAAsB,GAAGD,EAAE,IAAI,qBAAqBA,EAAE,OAAO,EAAE,CAC3E,CACF,EACA,wBAAyB,eAAgBR,EAAwC,CAC/E,GAAI,CACF,IAAMmB,EAAiB,MAAM3B,EAAI,6BAA8BQ,CAAU,EACzE,GAAI,CAACmB,EAAgB,MAAM,IAAI,MAAM,YAAYnB,CAAU,sBAAsB,EACjF,OAAOR,EAAI,uBAAwB2B,EAAe,IAAI,CACxD,OAASX,EAAG,CACV,MAAM,IAAIC,GAAsB,GAAGD,EAAE,IAAI,sBAAsBA,EAAE,OAAO,EAAE,CAC5E,CACF,CACF,CAAC,EC9LD,IAAMY,GAA6B,IAAI,QAEjCC,GAAa,SAAUC,EAAoBC,EAAoBC,EAAeC,EAAgB,CAClG,IAAMC,EAAeJ,EAAQ,aAAa,EACtCK,EAA6B,KAC3BC,EAAS,KAAK,OAEdC,EAAS,CACb,aAAAH,EACA,IAAI,mBAAqB,CACvB,OAAOI,GAAuBP,EAAYG,EAAcF,CAAK,CAC/D,EACA,IAAI,mBAAqB,CACvB,GAAIG,IAAsB,KAAM,CAC9B,IAAMI,EAAQT,EAAQ,QAAQ,EACxBU,EAAOJ,EAAO,yBAAyBG,CAAK,EAClD,OAAIC,GAAM,MAAQC,GAAaD,EAAK,IAAI,EACtCL,EAAqBK,EAAK,KAAW,aAErCL,EAAoB,OAEfA,CACT,CACF,EACA,IAAI,wBAA0B,CAC5B,OAAOG,GAAuBP,EAAYM,EAAO,kBAAmBL,CAAK,CAC3E,EACA,MAAAC,CACF,EAEA,OAAOI,CACT,EAEMK,GAAY,SAAUC,EAAyCC,EAAgBC,EAAiC,CAIpH,IAAMC,EAAOH,EAAM,IAAKI,GAAQ,CAC9B,IAAMP,EAAO,KAAK,OAAO,yBAAyBO,CAAG,EACrD,GAAKP,EACL,OAAIA,EAAK,kBACPA,EAAK,KAAK,SAAWA,EAAK,iBAEnBA,EAAK,IAChB,CAAC,EAAE,OAAO,OAAO,EAEXQ,EAAWC,GAAUH,CAAI,EAC/B,OAAO,OAAO,YAAYE,EAAS,IAAKD,GAAQ,CAE9C,GADAA,EAAI,iBAAmBH,EACnBC,IAAiBE,EAAI,EAAE,EAAG,CAC5B,GAAIF,EAAeE,EAAI,EAAE,EAAE,iBAAmB,KAC5C,MAAM,IAAIG,GAA0B,sCAAsCH,EAAI,EAAE,EAAE,EAOpFA,EAAI,iBAAmB,KAAK,IAAIH,EAAQC,EAAeE,EAAI,EAAE,EAAE,kBAAoB,CAAC,CACtF,MACEA,EAAI,iBAAmBH,EAEzB,cAAOG,EAAI,gBACJ,CAACA,EAAI,GAAIA,CAAG,CACrB,CAAC,CAAC,CACJ,EAEMI,GAAoB,CAACpB,EAAoBC,EAAeI,EAAgBgB,EAAwBC,EAA+BC,EAAwBC,EAA+CC,IAAoC,CAC9O,GAAI,CAACA,GAA2B,CAAC,MAAM,QAAQxB,EAAM,WAAW,KAAK,EAAG,OAExE,IAAMyB,EAAYC,EAAItB,EAAO,aAAa,EACpCuB,EAAW,OAAO,OAAO,IAAI,EAEnC3B,EAAM,UAAU,MAAM,QAAQ,CAAC,CAAC4B,EAAMC,CAAG,IAAM,CAC7C,GAAI,GAACT,EAAeQ,CAAI,GAAKD,EAASE,CAAG,IAAM,MAG/C,IAAI,CAACF,EAASE,CAAG,EAAG,CAClB,GAAI,CAACJ,EAAU,UAAUI,CAAG,GAAG,MAAQ,CAACC,GAAwBL,EAAUI,CAAG,EAAG,CAACE,EAAU,aAAa,EAAG,CAAC,KAAK,CAAC,EAAG,CACnHJ,EAASE,CAAG,EAAI,KAChB,MACF,CAEAF,EAASE,CAAG,EAAI,CAAC,CACnB,CAEAF,EAASE,CAAG,EAAE,KAAKD,CAAI,EACzB,CAAC,EAED,OAAO,QAASD,CAAiB,EAAE,QAAQ,CAAC,CAACE,EAAKG,CAAK,IAAM,CAC3D,GAAI,CAAC,MAAM,QAAQA,CAAK,GAAK,CAACA,EAAM,OAAQ,OAE5C,GAAM,CAACC,EAAkB/B,CAAY,EAAI8B,EAAM,IAAKJ,GAAS,CAC3D,IAAMM,EAAqBT,EAAUI,CAAG,GAAG,KAAK,iBAAiBT,EAAeQ,CAAI,EAAE,QAAQ,EAE9F,GAAI,CAACM,EAAoB,OAEzB,IAAMhC,EAAe4B,GAAwBL,EAAUI,CAAG,EAAGR,EAAqB,CAAC,KAAK,EAAGa,EAAmB,SAAS,EAEvH,GAAIhC,EACF,MAAO,CAAC,CAAC0B,EAAMM,EAAmB,IAAI,EAAGhC,EAAcuB,EAAUI,CAAG,EAAE,IAAI,eAAe3B,CAAY,EAAE,SAAS,CAIpH,CAAC,EAAE,OAAO,OAAO,EAAE,OAAO,CAACiC,EAAK,CAACP,EAAM1B,EAAckC,CAAS,KAE5DD,EAAI,CAAC,EAAE,KAAKP,CAAI,EACTQ,EAAYD,EAAI,CAAC,EAAI,CAACA,EAAI,CAAC,EAAGjC,EAAckC,CAAS,EAAID,GAC/D,CAAC,CAAC,EAAG,OAAW,OAAO,iBAAiB,CAAC,EAE5C,GAAI,CAACjC,EAAc,OAGnB,IAAMmC,EAAeZ,EAAU,UAAUI,CAAG,GAAG,KAE/CL,GAAyB,KAAK,IAAM,CAGlCE,EAAIJ,EAAgB,CAClB,WAAYO,EACZ,aAAAQ,EACA,KAAMJ,EAAiB,IAAIV,CAAY,EAAE,IAAKe,GACrCA,CACR,EACD,aAAApC,CACF,CAAC,EAAE,MAAOqC,GAAM,CACd,QAAQ,KAAK,kCAAkCjB,CAAc,UAAUvB,CAAU,OAAO8B,CAAG,KAAKU,GAAG,SAAWA,CAAC,EAAE,CACnH,CAAC,CACH,CAAC,CACH,CAAC,CACH,EAIOC,GAASd,EAAI,yBAA0B,CAE5C,yBAA0B,UAAY,CACpC,OAAO,KAAK,KACd,EACA,0BAA2B,SAAUe,EAAUC,EAAY,CAEzD,GAAI,KAAK,YAAcD,EAAU,CAC/B,QAAQ,KAAK,sFAAwF,CAAE,WAAAC,CAAW,CAAC,EACnH,MACF,CACA,GAAI,MAAM,QAAQA,CAAU,EAC1B,OAAOhB,EAAI,GAAGgB,CAAU,EACnB,GAAI,OAAOA,GAAe,WAC/B,OAAOA,EAAW,EAElB,MAAM,IAAI,UAAU,mFAAmF,OAAOA,CAAU,WAAW,CAEvI,EACA,8BAA+B,SAAUC,EAAWD,EAAY,CAC9D,OAAOhB,EAAI,kCAAmCiB,EAAW,CAAC,0BAA2B,KAAK,UAAWD,CAAU,CAAC,CAClH,EACA,2CAA4C,SAAUL,EAAsBO,EAAsBC,EAAkB,CAGlH,GAAI,CAACC,EAAID,EAAU,WAAW,GAAK,OAAOA,EAAS,UAAU,OAAU,UAAY,OAAOA,EAAS,UAAU,OAAU,SACrH,MAAM,IAAI,MAAM,mDAAmDD,CAAY,WAAWP,CAAY,GAAG,EAI3G,IAAMZ,EAAYC,EAAI,KAAK,OAAO,aAAa,EAC1CoB,EAAIrB,EAAW,qBAAqB,GACvC,KAAK,OAAO,YAAYA,EAAW,sBAAuB,OAAO,OAAO,IAAI,CAAC,EAS/E,IAAMsB,EAAwB,QAAQV,CAAY,GAE9CW,EAAqB,GACzB,GAAqEF,EAAIrB,EAAU,oBAAqBsB,CAAqB,EAAG,CAE9H,GADA,QAAQ,KAAK,sCAAsCH,CAAY,uBAAuB,EAClF,CAACE,EAAIrB,EAAU,oBAAoBsB,CAAqB,EAAGF,EAAS,UAAU,KAAK,EACrF,cAAQ,MAAM,qBAAqBD,CAAY,WAAWP,CAAY,4CAA4CQ,EAAS,UAAU,KAAK,iEAAkE,OAAO,KAAKpB,EAAU,oBAAoBsB,CAAqB,CAAC,CAAC,EACvQ,IAAI,MAAM,4CAA4CH,CAAY,WAAWP,CAAY,gDAAgDQ,EAAS,UAAU,KAAK,2DAA2D,EAEpO,IAAMI,EAAaxB,EAAU,oBAAoBsB,CAAqB,EAAEF,EAAS,UAAU,KAAK,EAChGK,GAAgBD,EAAYJ,EAAS,KAAOA,EAAS,KAAMA,EAAS,UAAU,KAAK,EACnF,QAAQ,KAAK,oDAAoDD,CAAY,WAAWP,CAAY,mCAAmCQ,EAAS,UAAU,KAAK,GAAG,EAClKG,EAAqB,EACvB,CAGA,IAAMG,EAAO,KAAK,MAAMN,EAAS,IAAI,EAGrC,GAAI,CAACG,EAAoB,CAEvB,GADA,QAAQ,KAAK,sCAAsCJ,CAAY,WAAWP,CAAY,sBAAsB,EACxG,CAACS,EAAIK,EAAM,aAAa,GAAK,CAAC,MAAM,QAAQA,EAAK,WAAW,EAC9D,MAAM,IAAI,MAAM,yBAAyBP,CAAY,WAAWP,CAAY,mDAAmD,EAEjI,IAAIe,EACJ,GAAI,CACFA,EAAsB,OAAO,YAAYD,EAAK,YAAY,IAAKE,GACtD,CACLC,GAAMD,CAAa,EACnBA,CACF,CACD,CAAC,CACJ,OAASd,EAAG,CACV,cAAQ,MAAM,qDAAqDK,CAAY,WAAWP,CAAY,IAAKE,CAAC,EACtGA,CACR,CACA,GAAI,CAACO,EAAIM,EAAqBP,EAAS,UAAU,KAAK,EACpD,MAAM,IAAI,MAAM,4CAA4CD,CAAY,WAAWP,CAAY,gDAAgDQ,EAAS,UAAU,KAAK,mDAAmD,EAE5NK,GAAgBE,EAAoBP,EAAS,UAAU,KAAK,EAAGA,EAAS,KAAOA,EAAS,KAAMA,EAAS,UAAU,KAAK,EACtH,QAAQ,KAAK,oDAAoDD,CAAY,WAAWP,CAAY,WAAWQ,EAAS,UAAU,KAAK,qEAAsE,OAAO,KAAKO,CAAmB,CAAC,EAC7OJ,EAAqB,GACrBvB,EAAU,oBAAoBsB,CAAqB,EAAIK,CACzD,CAIA,OAAOD,CACT,EACA,gCAAiC,eAAgBd,EAAsBO,EAAsB,CAC3F,GAAI,CAACP,GAAgB,OAAOA,GAAiB,SAC3C,MAAM,IAAI,MAAM,kCAAkC,EAEpD,GAAI,KAAK,mBAAmBO,CAAY,EAAG,CACzC,QAAQ,KAAK,sCAAuCA,CAAY,EAChE,MACF,CACA,IAAMW,EAAiB,MAAM7B,EAAI,6BAA8BkB,EAAc,CAAE,KAAMY,GAAW,yBAA0B,CAAC,EACrHX,EAAW,KAAK,MAAMU,CAAc,EACpCJ,EAAOzB,EAAI,2CAA4CW,EAAcO,EAAcC,CAAQ,EACjG,GAAIM,EAAK,OAASd,EAChB,MAAM,IAAI,MAAM,sCAAsCA,CAAY,YAAYc,EAAK,IAAI,EAAE,EAE3F,IAAMM,EAAgB,KAAK,OAAO,UAAU,SAAS,YAAcN,EAAK,cAAiBA,EAAK,SAC9F,QAAQ,KAAK,gCAAgCM,EAAa,IAAI,MAAMN,EAAK,OAAO,oBAAoBP,CAAY,EAAE,EAClH,IAAMc,EAAS,MAAMhC,EAAI,6BAA8B+B,EAAa,KAAM,CAAE,KAAMD,GAAW,qBAAsB,CAAC,EAC9GG,EAAc,CAACxB,EAAKG,KAAQH,EAAIG,CAAC,EAAI,GAAaH,GAClDyB,EAAc,CAAC,sBAAuB,0BAA2B,yBAAyB,EAC7F,OAAO,KAAK,OAAO,UAAU,SAAS,gBAAgB,EACtD,OAAOD,EAAa,CAAC,CAAC,EACnBE,EAAc,KAAK,OAAO,UAAU,SAAS,eAChD,OAAOF,EAAa,CAAC,CAAC,EACnBG,EAAc,CAACC,KAAqBC,IAAS,CACjD,IAAMC,EAASC,GAAmBH,CAAQ,EAI1C,GAHIA,EAAS,WAAW1B,EAAe,GAAG,IACxC0B,EAAW,GAAGnB,CAAY,IAAImB,CAAQ,IAEpCH,EAAYG,CAAQ,GAAKF,EAAYI,CAAM,EAC7C,OAAOvC,EAAIqC,EAAU,GAAGC,CAAI,EAE5B,cAAQ,MAAM,uCAAwC,CAAE,SAAAD,EAAU,YAAAH,EAAa,YAAAC,CAAY,CAAC,EACtF,IAAI,MAAM,0CAA0CE,CAAQ,GAAG,CAEzE,EAGMI,EAAsB,IAAI,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAc/BT,CAAM;AAAA;AAAA;AAAA;AAAA,KAIf,EAAE,EA6EH,GAzEA,KAAK,eAAiBI,EACtB,KAAK,oBAAsBlB,EAE3BuB,EAAU,CAGR,OAAQ,CAEN,gBAAkB7B,GAAM,WAAW,OAAO,gBAAgBA,CAAC,CAC7D,EACA,GAAI,OAAO,QAAW,UAAY,QAAU,CAC1C,MAAO,OAAO,MAAM,KAAK,MAAM,EAC/B,QAAS,OAAO,QAAQ,KAAK,MAAM,EACnC,OAAQ,OAAO,OAAO,KAAK,MAAM,CACnC,EACA,MACA,QACA,OACA,MACA,UACA,WACA,KACA,OACA,KACA,MAEA,OACA,QACA,OACA,OACA,OACA,UACA,WACA,WACA,WACA,YACA,YACA,aACA,aACA,YACA,KACA,OACA,WACA,SACA,QACA,SACA,IACA,QACA,GAAG,KAAK,OAAO,UAAU,SAAS,eAClC,QAAU8B,GACDA,IAAQ,WACXN,EACA,KAAK,OAAO,UAAU,SAAS,QAAQM,CAAG,EAEhD,IAAKN,EACL,gBAAiB,MAAOO,EAAqB,KAAS,CAMpD,GAAI,CACF,IAAMC,EAAW,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,QAAS,CAAE,OAAQ,KAAK,gBAAgB,MAAO,CAAC,EACrH,OAAOC,GAAkB,MAAM,EAAED,CAAQ,CAC3C,OAAS/B,EAAG,CAEV,GADA,QAAQ,KAAK,0BAA2BA,CAAC,EACrC8B,EACF,OAAO,IAAI,KAAK3C,EAAI,eAAe,CAAC,EAAE,YAAY,EAEpD,MAAM,IAAI8C,GAA+B,mEAAmE,CAC9G,CACF,CACF,CAAC,EACGnC,IAAiB,KAAK,YAAY,KACpC,MAAM,IAAI,MAAM,sCAAsCO,CAAY,cAAcP,CAAY,YAAY,KAAK,YAAY,IAAI,EAAE,EAEjI,KAAK,qBAAqB,QAAQoC,GAAK,CAAEb,EAAYa,CAAC,EAAI,EAAK,CAAC,EAChE,KAAK,mBAAmB7B,CAAY,EAAI,CACtC,KAAMa,IAAiBN,EAAK,aAC5B,KAAMM,EACN,SAAU,KAAK,WACjB,CACF,EAEA,qCAAsC,SAAU1D,EAAoB2E,EAAoD,CACtH,IAAM1E,EAAQ0B,EAAI,KAAK,OAAO,aAAa,EACrCW,EAAerC,EAAM,UAAUD,CAAU,GAAG,KAClD,GAAI,CAACsC,EAAc,CACjB,QAAQ,MAAM,0EAA2E,CAAE,WAAAtC,CAAW,CAAC,EACvG,MACF,CAEA,IAAM6C,EAAe,KAAK,OAAO,UAAU,UAAUP,CAAY,EACjE,GAAIO,EAAc,CAChB,IAAM+B,EAAa,GAAG/B,CAAY,IAAIP,CAAY,YAElD,GAAIX,EAAI,mBAAoBiD,CAAU,EAEpC,GAAI,CACFjD,EAAIiD,EAAY,CAAE,WAAA5E,EAAY,OAAQ,CAAC,CAAC2E,GAAQ,OAAQ,MAAO1E,EAAMD,CAAU,CAAE,CAAC,CACpF,OAASwC,EAAG,CACV,QAAQ,MAAM,gEAAgExC,CAAU,GAAIwC,CAAC,CAC/F,CAEJ,CAEImC,GAAQ,QAEV,OAAO,KAAK1E,EAAM,UAAUD,CAAU,CAAC,EACpC,OAAQ6E,GAAMA,IAAM,YAAY,EAChC,QAASA,GAAM,KAAK,OAAO,YAAY5E,EAAM,UAAUD,CAAU,EAAG6E,CAAC,CAAC,EAEzE,OAAO,KAAK5E,EAAMD,CAAU,CAAC,EAC1B,OAAQ6E,GAAMA,IAAM,WAAW,EAC/B,QAASA,GAAM,KAAK,OAAO,YAAY5E,EAAMD,CAAU,EAAG6E,CAAC,CAAC,EAC3D5E,EAAMD,CAAU,EAAE,WACpB,OAAO,KAAKC,EAAMD,CAAU,EAAE,SAAS,EACpC,OAAQ6E,GAAMA,IAAM,OAAO,EAC3B,QAASA,GAAM,KAAK,OAAO,YAAY5E,EAAMD,CAAU,EAAE,UAAW6E,CAAC,CAAC,IAG3E,OAAO,KAAK,wBAAwB7E,CAAU,EAC1C2E,GAAQ,UAGV,KAAK,OAAO,YAAY1E,EAAM,UAAWD,EAAY,IAAI,EAEzD,KAAK,OAAO,YAAYC,EAAM,UAAWD,CAAU,EAErD,KAAK,OAAO,YAAYC,EAAOD,CAAU,GAG3C,KAAK,gBAAgB,OAAOA,CAAU,EAEtC2B,EAAI,wBAAyBmD,GAAoB,MAAM,KAAK,KAAK,eAAe,EAAG,CACjF,MAAO,CAAC,EACR,QAAS,CAAC9E,CAAU,EACpB,UAAW2E,GAAQ,UACnB,OAAQA,GAAQ,MAClB,CAAC,CACH,EAEA,wBAAyB,UAAY,CAAC,EACtC,4BAA6B,SAAUI,EAAgCJ,EAA4D,CACjI,IAAMK,EAAY,OAAOD,GAAgB,SAAW,CAACA,CAAW,EAAIA,EAC9DE,EAAa,CAAC,CAACN,GAAQ,MAC7B,OAAO,QAAQ,IAAIK,EAAU,IAAIhF,GAG3B,CAACiF,GAAc,KAAK,gBAAgB,IAAIjF,CAAU,GAKhD,CAJc2B,EAAI,KAAK,OAAO,aAAa,EAIhC3B,CAAU,GAAG,WAAW,MAC9B2B,EAAI,8BAA+B3B,EAAY,CAAC,uBAAuB,CAAC,EAQ5E2B,EAAI,8BAA+B3B,EAAY,CACpD,mCAAoCA,EAAY2E,CAClD,CAAC,EAAE,MAAOO,GAAQ,CAChB,cAAQ,MAAM,6BAA6BlF,CAAU,IAAKkF,CAAG,EACvDA,CACR,CAAC,CACF,CAAC,CACJ,EACA,oCAAqC,SAAUC,EAAkB,CAAE,YAAAC,EAAc,EAAG,QAAAC,EAAS,mBAAAC,EAAoB,OAAAC,CAAO,EAAI,CAAC,EAAGC,EAAO,CACrI,IAAMxF,EAAamF,EAAM,WAAW,EAC9BM,EAAgBN,EAEtB,OAAOxD,EAAI,8BAA+B,WAAW3B,CAAU,GAAI,SAAY,CAC7E,IAAI0F,EAAU,EACVC,EAGJ,MAAMH,GAAO,aAAaL,CAAK,EAE/B,IAAMS,EAAoB,CAACC,EAAqB9F,IAAuB,CACjEoF,EAAM,KAAK,IAAMpF,EAAQ,KAAK,IAChC4B,EAAI,uBAAwBmE,GAAeF,CAAiB,EAC5DJ,EAAM,YAAYL,CAAK,EAE3B,EAQA,IANI,OAAOK,GAAO,aAAgB,YAChC7D,EAAI,sBAAuBmE,GAAeF,CAAiB,IAKhD,CAKXD,EAAsBR,EAAM,OAAO,EACnC,IAAMY,EAAW,MAAMpE,EAAI,8BAA+B3B,EAAY,SAAY,CAChF,IAAM0B,EAAYC,EAAI,KAAK,OAAO,aAAa,EACzC1B,EAAQyB,EAAU1B,CAAU,EAC5BgG,EAAiBb,EAAM,eAAe,EAE5C,GAAI,CAAClF,GAAS,CAAC+F,EAAgB,CAC7B,QAAQ,KAAK,sEAAsEb,EAAM,YAAY,CAAC,EAAE,EACxG,MACF,CAEA,GAAIK,GAAO,cACL,CAAC,MAAMA,EAAM,aAAaL,EAAOlF,CAAK,EAAG,CAC3C,QAAQ,KAAK,kFAAkFkF,EAAM,YAAY,CAAC,EAAE,EACpH,MACF,CAgDF,OATA,MAAMxD,EAAI,qCAAsCwD,EAAOjE,GAAUjB,GAAS,CAAC,CAAC,CAAC,EASxE+F,EAIEb,EAHEc,GAAcd,EAAOlF,EAAOyB,EAAU,UAAU1B,CAAU,CAAC,CAItE,CAAC,EAGD,GAAI,CAAC+F,EAAU,OAEf,MAAMP,GAAO,gBAAgBO,EAAUZ,CAAK,EAC5CA,EAAQY,EAER,IAAMG,EAAI,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,SAAU,CACtE,OAAQ,OACR,KAAMf,EAAM,UAAU,EACtB,QAAS,CACP,GAAGE,EACH,GAAGE,GAAU,CACX,cAAiB,UAAUA,CAAM,EACnC,EACA,GAAGD,GAAsB,CACvB,cAAiBa,GAAgC,KAAK,KAAMb,CAAkB,CAChF,EACA,eAAgB,YAClB,EACA,OAAQ,KAAK,gBAAgB,MAC/B,CAAC,EACD,GAAIY,EAAE,GACJ,aAAMV,GAAO,cAAcL,CAAK,EACzBA,EAET,GAAI,CACF,GAAIe,EAAE,SAAW,IAAK,CACpB,GAAIR,EAAU,EAAIN,EAChB,cAAQ,MAAM,gCAAgCD,EAAM,YAAY,CAAC,UAAUO,CAAO,YAAaP,CAAK,EAC9F,IAAI,MAAM,iBAAiBe,EAAE,MAAM,MAAMA,EAAE,UAAU,aAAaR,CAAO,EAAE,EAGnF,IAAMU,EAAYC,GAAmB,EAAG,IAAI,EAC5C,QAAQ,KAAK,8BAA8BX,CAAO,OAAON,CAAW,oBAAoBgB,CAAS,0BAA0BjB,EAAM,YAAY,CAAC,EAAE,EAChJO,GAAW,EACX,MAAMY,GAAMF,CAAS,EAKjB,CAACjB,EAAM,eAAe,GAAKA,EAAM,OAAO,IAAMQ,GAChD,MAAMhE,EAAI,4BAA6B3B,EAAY,CAAE,MAAO,EAAK,CAAC,CAEtE,KAAO,CACL,IAAMD,GAAW,MAAMmG,EAAE,KAAK,IAAI,QAClC,cAAQ,MAAM,uCAAuCf,EAAM,YAAY,CAAC,KAAKe,EAAE,MAAM,MAAMA,EAAE,UAAU,KAAKnG,CAAO,GAAIoF,CAAK,EACtH,IAAI,MAAM,iBAAiBe,EAAE,MAAM,MAAMA,EAAE,UAAU,KAAKnG,CAAO,EAAE,CAC3E,CACF,OAASyC,EAAG,CACV,MAAAb,EAAI,uBAAwBmE,GAAeF,CAAiB,EAEtDpD,CACR,CACF,CACF,CAAC,EAAE,KAAM2C,IACPxD,EAAI,wBAAyB4E,GAAiB,CAAE,WAAAvG,EAAY,QAASmF,EAAO,gBAAiBM,CAAc,CAAC,EACrGN,EACR,EAAE,MAAO3C,GAAM,CACd,MAAAb,EAAI,wBAAyB6E,GAAwB,CAAE,WAAAxG,EAAY,QAASmF,EAAO,gBAAiBM,EAAe,MAAOjD,CAAE,CAAC,EACvHA,CACR,CAAC,CACH,EACA,sCAAuC,SAAUxC,EAAoB,CACnE,OAAO,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,mBAAmBA,CAAU,GAAI,CACpF,MAAO,WACP,OAAQ,KAAK,gBAAgB,MAC/B,CAAC,EAAE,KAAKwE,GAAkB,MAAM,CAAC,CACnC,EACA,gCAAiC,SAAUxE,EAAYyG,EAAuBvD,EAAY,CAExF,IAAMwD,EADgB/E,EAAI,KAAK,OAAO,aAAa,EACjB3B,CAAU,EAEvC0G,IAEDD,GAAyB1D,EAAI0D,EAAuB,OAAO,IACxDC,EAAY,WAAW,KAAK,OAAO,YAAYA,EAAa,YAAa,OAAO,OAAO,IAAI,CAAC,EAC5FA,EAAY,UAAU,MAEhBA,EAAY,UAAU,QAAUD,EAAsB,OAC/DA,EAAsB,MAAM,QAASE,GAAW,CACzCD,EAAY,UAAU,MAAM,KAAME,GAC7BA,EAAO,CAAC,IAAMD,EAAO,CAAC,GAAOC,EAAO,CAAC,IAAMD,EAAO,CAAC,CAC5D,GACCD,EAAY,UAAU,MAAM,KAAKC,CAAM,CAE3C,CAAC,EARD,KAAK,OAAO,YAAYD,EAAY,UAAW,QAASD,EAAsB,KAAK,GAYlF,MAAM,QAAQC,EAAY,WAAW,kBAAkB,GAE5D,KAAK,OAAO,YACVA,EAAY,UAAW,qBACvBA,EAAY,UAAU,mBAAmB,OAAQG,GAC/CA,GAAK,OAAS3D,EAAW,IAC3B,CACF,EACF,EACA,qCAAsC,eAAgBnD,EAAoBE,EAAewB,EAAiCa,EAAuB,CAC/I,GAAM,CAACwE,EAAKC,CAAG,EAAIhH,EAAQ,GAAG,EACxBiH,EAAOjH,EAAQ,KAAK,EACpBc,EAASd,EAAQ,OAAO,EACxBC,EAAaD,EAAQ,WAAW,EAChC8C,EAAe9C,EAAQ,SAAS,EAChCI,EAAeJ,EAAQ,aAAa,EACpCkH,EAAYlH,EAAQ,UAAU,EAC9BM,EAAS,KAAK,OACd6G,EAAO,KACPC,EAAS,OAAO,QAAQnF,CAAS,EAAE,KAAK,CAAC,CAAC,CAAEoF,CAAC,IAAMA,IAAMN,CAAG,IAAI,CAAC,EAEvE,GADA,QAAQ,MAAM,qBAAsBK,EAAQ,KAAMnH,CAAU,EACxDC,GAAO,WAAW,MAAO,CAC3B,QAAQ,MAAM,6DAA8D,UAAWkH,EAAQ,YAAanH,CAAU,EACtH,MACF,CACKC,EAAM,MAAKA,EAAM,IAAM,OAAO,OAAO,IAAI,GAC9C,IAAMoH,EAAuD,CAe3D,MAAOrF,EAAU,SAAS,EAAGO,EAAe,CAC1C,QAAS+E,EAAI,EAAGA,EAAI/E,EAAE,OAAQ+E,IAAK,CACjC,IAAMC,EAAIhF,EAAE+E,CAAC,EACb,GAAI,CACF,GAAIC,EAAE,CAAC,IAAMvF,EAAU,UAAW,MAAM,IAAI,MAAM,uBAAuB,EACzE,GAAI,CAACwF,GAAuBzH,EAASM,EAAQJ,EAAOE,EAAcoH,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAC1E,MAAM,IAAI,MAAM,uDAAuD,EAEzE,MAAMF,EAAME,EAAE,CAAC,CAAC,EAAEA,EAAE,CAAC,CAAC,CACxB,OAASE,EAAI,CACX,IAAMjF,EAAKiF,EACX,GAAIjF,GAAK,OAAOA,GAAM,SAAU,CAC9B,GAAIA,EAAE,OAAS,iCAAkC,CAE/C,GADA,QAAQ,KAAK,gCAAgCA,EAAE,IAAI,2BAA2BzC,EAAQ,YAAY,CAAC,KAAKyC,EAAE,OAAO,GAAIA,EAAGzC,EAAQ,UAAU,CAAC,EACvIyC,EAAE,MAAO,CACX,IAAMkF,EAA0B7H,GAA2B,IAAIE,CAAO,EAClE2H,EACFA,EAAwB,IAAIlF,EAAE,KAAK,EAEnC3C,GAA2B,IAAIE,EAAS,IAAI,IAAI,CAACyC,EAAE,KAAK,CAAC,CAAC,CAE9D,CACA,QACF,MACEmF,GAAY5H,EAAS,iCAAiCyC,EAAE,IAAI,2BAA2BzC,EAAQ,YAAY,CAAC,KAAKyC,EAAE,SAAWA,CAAC,GAAIA,EAAGzC,EAAQ,UAAU,CAAC,EAG3J,GADA,QAAQ,KAAK,2CAA2CA,EAAQ,YAAY,CAAC,KAAKA,EAAQ,UAAU,CAAC,qCAAqC,EACtIM,EAAO,iBACT,MAAMmC,EAGR,GADAnC,EAAO,MAAM,eAAemC,EAAGzC,EAASD,GAAW,KAAKoH,EAAMnH,EAASC,EAAYC,CAAK,CAAC,EACrFuC,EAAE,OAAS,mBAAoB,QACrC,MACEmF,GAAY5H,EAAS,oDAAqDC,EAAYD,EAASuH,EAAG9E,CAAC,EAErG,MAAMA,CACR,CACF,CACF,EACA,CAACR,EAAU,WAAW,EAAGO,EAAiB,CACxCtC,EAAM,IAAI,KAAOsC,EAAE,KACnB,IAAMxB,EAAOJ,GAAU,KAAKuG,EAAM3E,EAAE,KAAM1B,CAAM,EAChDZ,EAAM,IAAI,eAAiBc,EAO3B6G,GAAqB,KAAKV,EAAMnH,EAASiH,EAAMzE,EAAE,KAAMtC,EAAOD,EAAYkD,EAAYzB,CAAuB,CAC/G,EACA,CAACO,EAAU,mBAAmB,EAAGO,EAAwB,CACvD,GAAIlC,EAAO,qBAAsB,CAC1BA,EAAO,wBACV,QAAQ,IAAI,gDAAgD,EAE9D,MACF,CACA,OAAOgH,EAAMrF,EAAU,qBAAqB,EAAEO,EAAE,QAAQ,CAAC,CAC3D,EACA,MAAOP,EAAU,qBAAqB,EAAGO,EAA0B,CACjE,GAAI,CAAClC,EAAO,qBAAsB,CAChC,IAAID,EACAM,GAAa6B,CAAC,IAChBnC,EAAqBmC,EAAQ,aAC7BA,EAAKA,EAAQ,QAAQ,GAGvB,GAAM,CAAE,KAAA9B,EAAM,KAAAoH,EAAM,OAAAC,CAAO,EAAKvF,EAEhC,GAAI,CAAClC,EAAO,YAAYyH,CAAM,EAC5B,MAAM,IAAI,MAAM,sCAAsCA,CAAM,GAAG,EAGjE,MAAMnG,EACJ,GAAGkB,CAAY,IAAIiF,CAAM,WACzB,CACE,KAAArH,EACA,KAAAoH,EACA,KAAAb,EACA,OAAAnG,EACA,WAAAb,EACA,UAAWD,EAAQ,UAAU,EAC7B,aAAAI,EACA,IAAI,mBAAqB,CACvB,OAAOI,GAAuBP,EAAYG,EAAcF,CAAK,CAC/D,EACA,kBAAAG,EACA,IAAI,wBAA0B,CAC5B,OAAOG,GAAuBP,EAAYI,EAAmBH,CAAK,CACpE,CACF,EACAA,CACF,CACF,CACF,EACA,CAAC+B,EAAU,YAAY,EAAG+F,EAAkB,CAG1C,IAAMtH,EAAOJ,EAAO,yBAAyB0H,CAAE,EAC/C,GAAI,CAACtH,EAAM,OACX,IAAM8B,EAAK9B,EAAK,KAEhB,QAAWO,KAAOuB,EAAE,KACdvB,EAAI,IAAMA,EAAI,MAAM,SAAS,UAC1B+B,EAAI9C,EAAM,IAAK,cAAc,IAAGA,EAAM,IAAI,aAAe,CAAC,GAC1DA,EAAM,IAAI,aAAa,KAAM+H,GAAOA,EAAG,KAAOhH,EAAI,EAAE,GAAGf,EAAM,IAAI,aAAa,KAAK,CAAE,GAAIe,EAAI,GAAI,WAAYuB,EAAE,WAAY,OAAA1B,EAAQ,eAAgB0B,EAAE,eAAgB,iBAAkBA,EAAE,gBAAiB,CAAC,GAmBhNQ,EAAIR,EAAG,gBAAgB,GAAKtC,EAAM,IAAI,eAAeE,CAAY,EAAE,MAAM,aAC3EF,EAAM,IAAI,eAAeE,CAAY,EAAE,KAAK,WAAW,UAAY6G,GAGrEvF,GAAyB,KAAK,SAAY,CACxC,OAAOyF,EAAK,mBAAmBlH,CAAU,IAAI,oBAAsBuC,EAAE,UAAU,EAE/E,IAAM0F,EAAgBtG,EAAIuF,EAAK,OAAO,aAAa,EAE7CR,EAAcuB,EAAc1F,EAAE,UAAU,EACxCmF,EAA0BO,EAAc,UAAU1F,EAAE,UAAU,GAAG,wBAEnE2F,GAA4B,OAAO,kBACvC,QAAWlH,MAAOuB,EAAE,KAClB,GAAIvB,GAAI,IAAMA,GAAI,MAAM,SAAS,QAAS,CAExC,IAAMmH,GAAYlB,IAAc,YAAcjG,GAAI,KAAK,QAAQ,UAC/D,GACE,CAACW,EAAI,yBAA0BX,GAAI,GAAI,CAACmH,EAAS,EAEjD,GAAI,CACF,IAAMC,GAAYpH,GAAI,KAAK,QAAQ,QAAQ,QAAQ,EACnDW,EAAI,2BAA4B,IAAI0G,GAAO,CAAC,CAC1C,IAAKC,GAAeF,EAAS,EAC7B,UAAAD,EACF,CAAC,CAAC,CAAC,EAICT,GAAyB,SAAS1G,GAAI,EAAE,EAC1CkH,GAA4B,OAAO,kBAInCxB,GAAa,KAAK,iBAAiB1F,GAAI,EAAE,GAAG,kBAAoB,MAC9D,MAAM,QAAQ0F,EAAY,IAAI,eAAe1F,GAAI,EAAE,EAAE,OAAO,GAC5D0F,EAAY,IAAI,eAAe1F,GAAI,EAAE,EAAE,QAAQ,SAAS,KAAK,IAE/DkH,GAA4B,KAAK,IAAIA,GAA2BxB,EAAY,IAAI,eAAe1F,GAAI,EAAE,EAAE,gBAAgB,EAE3H,OAASyG,GAAI,CACX,IAAMjF,GAAKiF,GACPjF,IAAG,OAAS,iCACd,QAAQ,KAAK,iBAAiBwE,CAAI,OAAOhH,CAAU,yBAAyBwC,GAAE,OAAO,GACnFA,EAAC,EAIH,QAAQ,MAAM,iBAAiBwE,CAAI,OAAOhH,CAAU,YAAYwC,GAAE,SAAWA,EAAC,KAC5EA,EAAC,CAEP,CAEJ,CAKF,IAAM+F,GAAgBL,GAA4BD,EAAc,UAAU1F,EAAE,UAAU,GAAG,OAEzF,GAAIgG,GAAY,CAId,GAHKxF,EAAI2D,EAAa,WAAW,GAAGrG,EAAO,YAAYqG,EAAa,YAAa,OAAO,OAAO,IAAI,CAAC,EACpGrG,EAAO,YAAYqG,EAAY,UAAW,QAAS,EAAI,EAEnD,CAAC,OAAO,KAAKA,CAAW,EAAE,KAAM7B,IAAMA,KAAM,WAAW,EAEzD,OAMF,IAAM2D,GAAU,OAAO,OAAO,IAAI,EAClC9B,EAAY,WAAW,OAAO,QAAQ,CAAC,CAAC+B,GAASzI,EAAU,IAAM,CAC/D,GAAI,CAACwI,GAAQC,EAAO,EAAG,CACrBD,GAAQC,EAAO,EAAI,CAACzI,EAAU,EAC9B,MACF,CACAwI,GAAQC,EAAO,EAAE,KAAKzI,EAAU,CAClC,CAAC,EAGD,IAAM0I,GAAsB,MAAM,KAAK,IAAI,IAAI,OAAO,QAAQF,EAAO,EAAE,QAAQ,CAAC,CAACC,GAAS1D,EAAW,IAAM,CACzG,IAAMxB,GAAQoF,GAAgBjC,EAAa+B,EAAO,EAClD,OAEElF,IAKAmD,EAAY,IAAI,eAAenD,EAAK,EAAE,QAAQ,SAAS,KAAK,GAG5DmD,EAAY,IAAI,eAAenD,EAAK,EAAE,kBAAoB2E,GAEnDnD,GAEF,CAAC,CACV,CAAC,CAAC,CAAC,EAaH,GAXA2D,GAAoB,QAAS1I,IAAe,CAC1C,IAAM0G,GAAcuB,EAAcjI,EAAU,EACvC0G,KACA3D,EAAI2D,GAAa,WAAW,GAAGrG,EAAO,YAAYqG,GAAa,YAAa,OAAO,OAAO,IAAI,CAAC,EACpGrG,EAAO,YAAYqG,GAAY,UAAW,QAAS,EAAI,EACzD,CAAC,EAMGQ,EAAK,gBAAgB,IAAI3E,EAAE,UAAU,EAAG,CAC1C,IAAMqG,GAASjH,EAAI,8BAA+BY,EAAE,WAAY,CAC9D,mCAAoCA,EAAE,UACxC,CAAC,EAAE,KAAK,IAAM,CAGZZ,EAAI,4BACF+G,GAAoB,OAAQ1I,IACnBkH,EAAK,gBAAgB,IAAIlH,EAAU,CAC3C,EACD,CAAE,MAAO,GAAM,OAAQ,EAAK,CAC9B,EAAE,MAAMwC,IAAK,CAGX,QAAQ,MAAM,sFAAuFA,EAAC,CACxG,CAAC,CACH,CAAC,EAAE,MAAOA,IAAM,CAId,GADA,QAAQ,MAAM,oCAAoCD,EAAE,UAAU,4BAA4BvC,CAAU,EAAE,EAClGuC,EAAE,aAAevC,EACnB,MAAMwC,EAEV,CAAC,EAIGD,EAAE,aAAevC,GACnB,MAAM4I,EAEV,CACF,CAEA,IAAMnC,GAAwBC,GAAa,UAC3C/E,EAAI,8BAA+BY,EAAE,WAAY,CAAC,gCAAiCA,EAAE,WAAYgG,GAAa9B,GAAwB,KAAMvD,CAAU,CAAC,EACpJ,KAAK,IAAM,CAKVvB,EAAI,8BAA+B3B,EAAY,IAAM,CACnD2B,EAAI,wBAAyBkH,GAA4B,CAAE,WAAYtG,EAAE,WAAY,qBAAsBvC,EAAY,aAAAG,EAAc,IAAI,gBAAkB,CAAE,OAAOF,EAAM,KAAK,iBAAiBE,CAAY,GAAG,IAAK,CAAE,CAAC,CACzN,CAAC,EAAE,MAAMqC,IAAK,CAGZ,QAAQ,MAAM,4EAA4ExC,CAAU,GAAIwC,EAAC,CAC3G,CAAC,CACH,CAAC,CACL,CAAC,CACH,EACA,CAACR,EAAU,cAAc,EAAG+F,EAAoB,CAC9C,IAAMtH,EAAOJ,EAAO,yBAAyB0H,CAAE,EAIzCxF,EAAI9B,GAAM,MAAQ,CAAE,WAAY,YAAa,UAAW,CAAE,QAAS,MAAU,EAAG,QAAS,GAAI,EAE7FqI,EAAwBvG,EAAE,WAEhC,GAAItC,EAAM,KAAK,UAAUE,CAAY,GAAG,UAAY,KAClD,GAAIF,EAAM,IAAI,QAAQE,CAAY,EAAE,SAAW,EACxC,EAAEF,EAAM,IAAI,QAAQE,CAAY,EAAE,UAAa,IAClDF,EAAM,IAAI,QAAQE,CAAY,EAAE,OAAS4I,GAAc,UAEpD,CACLpB,GAAY5H,EAAS,gEAAkE+I,CAAqB,EAC5G,MACF,CAGF,GAAI7I,EAAM,KAAK,UAAUE,CAAY,GAAG,SAAW,MAC7CF,EAAM,IAAI,QAAQE,CAAY,EAAE,QAAU,KAAK,IAAI,EAAG,CACxDwH,GAAY5H,EAAS,iDAAmDE,EAAM,IAAI,QAAQE,CAAY,EAAE,QAAU,KAAO2I,CAAqB,EAC9I,MACF,CAKF,GAAIzI,EAAO,sBAAwB4G,IAAc,WAC/C,OAIF,GAAI,CAAClE,EAAIR,EAAE,UAAW,SAAS,EAAG,CAChCoF,GAAY5H,EAAS,qEAAqE,EAC1F,MACF,CAEA,IAAMiJ,EAAUzG,EAAE,UAAU,QAE5B,GAAI9B,IAAS,CAAC,MAAM,QAAQuI,CAAO,GAAMA,EAAc,CAAC,IAAMF,GAAwB,CACpFnB,GAAY5H,EAAS,oEAAoE,EACzF,MACF,CAEA,GAAIwC,EAAE,UAAY,IAAK,CACrBoF,GAAY5H,EAAS,0EAA2EwC,EAAE,OAAO,EACzG,MACF,CAEKtC,EAAM,IAAI,mBAAkBA,EAAM,IAAI,iBAAmB,OAAO,OAAO,IAAI,GAEhFA,EAAM,IAAI,iBAAiBF,EAAQ,KAAK,CAAC,EAAIiJ,EACzC,CAGE,CAAC,CAACvI,GAAM,gBACRV,EAAQ,OAAO,EACfI,EACA6I,CACF,EACA,CACE,CAAC,CAACvI,GAAM,gBACRV,EAAQ,OAAO,EACfI,CACF,EAGAM,GACFgB,GAAyB,KAAK,IAAM,CAClCyF,EAAK,cAAclH,EAAY,2BAA6BD,EAAQ,WAAW,EAAG,CAAC,2CAA4CC,CAAU,CAAC,CAC5I,CAAC,CAEL,EACA,CAACgC,EAAU,mBAAmB,EAAG+F,EAAwB,CACvD,GAAI1H,EAAO,qBACT,OAIF,IAAMI,EAAOJ,EAAO,yBAAyB0H,CAAE,EAC/C,GAAI,CAACtH,EAAM,OACX,IAAM8B,EAAK9B,EAAK,KAEhB,GAAIR,EAAM,IAAI,kBAAoBsC,EAAE,kBAAkBtC,EAAM,IAAI,iBAAkB,CAChF,IAAM+G,EAAOzE,EAAE,eACT0G,EAAUhJ,EAAM,IAAI,iBAAiB+G,CAAI,EAE/C,GADA,OAAO/G,EAAM,IAAI,iBAAiB+G,CAAI,EAClCiC,EAAQ,SAAW,EAAG,OAG1B,IAAM1F,EAAQ0F,EAAQ,CAAC,EACjBH,GAAwBG,EAAQ,CAAC,EAAE,CAAC,EACtC,MAAM,QAAQhJ,EAAM,KAAK,UAAUsD,CAAK,GAAG,SAAS,GACtDtD,EAAM,KAAK,UAAUsD,CAAK,GAAG,UAAU,KAAKuF,EAAqB,EAG9D/F,EAAI9C,EAAM,IAAK,WAAW,IAAGA,EAAM,IAAI,UAAY,OAAO,OAAO,IAAI,GAE1E,IAAMiJ,GAAU3G,EAAE,QAElBtC,EAAM,IAAI,UAAU+G,CAAI,EAAI,CAC1B,WAAY8B,GACZ,OAAAjI,EACA,QAAAqI,GACA,GAAIA,IAAW,CACb,KAAM3G,EAAE,YACV,CACF,CACF,CACF,EACA,CAACP,EAAU,WAAW,EAAGmH,GACzB,CAACnH,EAAU,WAAW,EAAGO,EAAgB,CAClCtC,EAAM,IAAI,QAAOA,EAAM,IAAI,MAAQ,CAAC,GACzCA,EAAM,IAAI,MAAMsC,EAAE,GAAG,EAAIA,EAAE,KAC7B,EACA,CAACP,EAAU,UAAU,EAAGO,EAAe,CACrC,IAAMxB,EAAOJ,GAAU,KAAKuG,EAAM3E,EAAG1B,EAAQZ,EAAM,IAAI,cAAc,EACjD,OAAO,OAAOsC,CAAC,EACzB,QAASsC,GAAM,CACvB,GAAI9B,EAAI9C,EAAM,IAAI,eAAgB4E,EAAE,EAAE,GAAK5E,EAAM,IAAI,eAAe4E,EAAE,EAAE,EAAE,iBAAmB,KAC3F,MAAM,IAAIuE,GAAiB,mDAAqDvE,EAAE,EAAE,CAExF,CAAC,EACDwE,GAA0B,KAAKnC,EAAMlH,EAAYkD,EAAYjD,EAAOsC,CAAC,EACrEtC,EAAM,IAAI,eAAiB,CAAE,GAAGA,EAAM,IAAI,eAAgB,GAAGc,CAAK,EAClE6G,GAAqB,KAAKV,EAAMnH,EAASiH,EAAMzE,EAAGtC,EAAOD,EAAYkD,EAAYzB,CAAuB,CAC1G,EACA,CAACO,EAAU,UAAU,EAAGO,EAAe,CAChCtC,EAAM,IAAI,iBAAgBA,EAAM,IAAI,eAAiB,OAAO,OAAO,IAAI,GACvEA,EAAM,YAAWA,EAAM,UAAY,OAAO,OAAO,IAAI,GACrDA,EAAM,UAAU,wBAAuBA,EAAM,UAAU,sBAAwB,OAAO,OAAO,IAAI,GACtGqJ,GAA0B,KAAKpC,EAAMlH,EAAYkD,EAAYjD,EAAOsC,CAAC,EACrE,IAAMgH,EAAWhH,EAAE,IAAKsC,GAAM,CAC5B,IAAMpE,EAAOJ,EAAO,yBAAyBwE,CAAC,EAC9C,GAAKpE,EACL,OAAOA,EAAK,IACd,CAAC,EAAmB,OAAQ8C,GACtB,CAACA,GAAS,OAAOA,GAAU,SAAiB,GAC5C,CAACR,EAAI9C,EAAM,IAAI,eAAiBsD,CAAW,GAAKtD,EAAM,IAAI,eAAesD,CAAK,EAAE,iBAAmB,MACrG,QAAQ,KAAK,qDAAsD,CAAE,WAAAvD,EAAY,MAAAuD,CAAM,CAAC,EACjF,IAEF,EACR,EA2DD,GAzDAgG,EAAO,QAAShG,GAAU,CACxB,IAAMvC,EAAMf,EAAM,IAAI,eAAesD,CAAK,EAU1C,GATAtD,EAAM,IAAI,eAAesD,CAAK,EAAE,gBAAkB1C,EAE9CkC,EAAI9C,EAAM,UAAU,sBAAuBsD,CAAK,GAClD,OAAOtD,EAAM,UAAU,sBAAsBsD,CAAK,EAMhDvC,EAAI,WAAY,CAClB,IAAMwI,EAAQ,IAAI,IAAIxI,EAAI,UAAU,EAC9ByI,EAAkBD,EAAM,SACxBE,GAAiBF,EAAM,aAAa,IAAI,SAAS,EAEvD,GAAI,CAACC,GAAmB,CAACC,GAAgB,MAAM,IAAI,MAAM,mDAAmD,EAE5GjI,GAAyB,KAAK,IAAM,CAClCE,EAAI,8BAA+B8H,EAAiB,IAAM,CACxD,IAAM/H,GAAYC,EAAItB,EAAO,aAAa,EAC1C,GAAI,MAAM,QAAQqB,GAAU+H,CAAe,GAAG,WAAW,KAAK,EAAG,CAE/D,IAAME,GAAWjI,GAAU+H,CAAe,EAAE,UAAU,MACtD/H,GAAU+H,CAAe,EAAE,UAAU,MAAQE,GAAS,OAAO,CAAC,CAAC9H,GAAMC,EAAG,IAAMD,KAAS6H,IAAkB5H,KAAQ9B,CAAU,EACvH2J,GAAS,SAAWjI,GAAU+H,CAAe,EAAE,UAAU,MAAM,QAIjE9H,EAAI,4BAA6B8H,EAAiB,CAAE,IAAK,EAAK,CAAC,EAAE,MAAMjH,IAAK,CAG1E,QAAQ,MAAM,uGAAuGiH,CAAe,GAAIjH,EAAC,CAC3I,CAAC,CAEL,CACF,CAAC,EAAE,MAAOA,IAAM,CAGd,QAAQ,MAAM,oDAAqD,CAAE,WAAAxC,EAAY,gBAAAyJ,EAAiB,eAAAC,GAAgB,MAAAF,CAAM,EAAGhH,EAAC,CAC9H,CAAC,CACH,CAAC,EAED,IAAMoH,GAAe3J,EAAM,IAAI,eAAewJ,CAAe,EACzDG,KACF3J,EAAM,IAAI,aAAawJ,CAAe,EAAIG,GAAa,OAAO,CAAC,CAAC,CAAEC,EAAG,IAAMA,KAAQtG,CAAK,EAE5F,CAGIvC,EAAI,KAAK,WAAW,aAAa,GAAKf,EAAM,IAAI,QAAQe,EAAI,EAAE,IAChEf,EAAM,IAAI,QAAQe,EAAI,EAAE,EAAE,OAAS+H,GAAc,QAErD,CAAC,EAIG,MAAM,QAAQ9I,EAAM,WAAW,KAAK,EAAG,CACzC,IAAMoB,EAAiB,OAAO,OAAO,IAAI,EAEzCkI,EAAO,QAAShG,GAAU,CACxBlC,EAAepB,EAAM,IAAI,eAAesD,CAAK,EAAE,IAAI,EAAI,CACrD,KAAMtD,EAAM,IAAI,eAAesD,CAAK,EAAE,KACtC,SAAUA,CACZ,CACF,CAAC,EAEDnC,GAAkBpB,EAAYC,EAAOI,EAAQgB,EAAgB,CAACW,EAAU,UAAU,EAAG,sBAAwBH,GAASR,EAAeQ,EAAK,CAAC,CAAC,EAAE,SAAUJ,CAAuB,CACjL,CACF,EACA,CAACO,EAAU,aAAa,EAAGO,EAAkB,CACtCtC,EAAM,YAAWA,EAAM,UAAY,OAAO,OAAO,IAAI,GACrDA,EAAM,UAAU,wBAAuBA,EAAM,UAAU,sBAAwB,OAAO,OAAO,IAAI,GACtG,GAAM,CAAC6J,EAAaC,CAAU,EAAIC,GAA6B,KAAK9C,EAAMlH,EAAYkD,EAAYjD,EAAOsC,CAAC,EACpG0H,EAAiB,OAAO,OAAOF,CAAU,EAC/C,QAAWxG,KAAS0G,EACdlH,EAAI9C,EAAM,UAAU,sBAAuBsD,CAAK,GAClD,OAAOtD,EAAM,UAAU,sBAAsBsD,CAAK,EAGpDtD,EAAM,IAAI,eAAesD,CAAK,EAAE,gBAAkB1C,EAEpD,QAAWG,KAAO8I,EACX/G,EAAI9C,EAAM,IAAI,eAAgBe,EAAI,EAAE,IACvCA,EAAI,iBAAmBH,EACvBZ,EAAM,IAAI,eAAee,EAAI,EAAE,EAAIE,GAAUF,CAAG,GAOpD,GAJA4G,GAAqB,KAAKV,EAAMnH,EAASiH,EAAO8C,EAAmB7J,EAAOD,EAAYkD,EAAYzB,CAAuB,EAIrH,MAAM,QAAQxB,EAAM,WAAW,KAAK,EAAG,CACzC,IAAMoB,EAAiB,OAAO,OAAO,IAAI,EAEzCyI,EAAY,QAAS9I,GAAQ,CACvBA,EAAI,OACNK,EAAeL,EAAI,IAAI,EAAIE,GAAUF,CAAG,EACxCK,EAAeL,EAAI,IAAI,EAAE,SAAW+I,EAAW/I,EAAI,EAAE,EAEzD,CAAC,EAEDI,GAAkBpB,EAAYC,EAAOI,EAAQgB,EAAgB,CAACW,EAAU,aAAa,EAAG,yBAA2BH,IAAU,CAC3H,KAAMA,EAAK,CAAC,EACZ,SAAUR,EAAeQ,EAAK,CAAC,CAAC,EAAE,SAClC,GAAIR,EAAeQ,EAAK,CAAC,CAAC,EAAE,GAC5B,KAAMR,EAAeQ,EAAK,CAAC,CAAC,EAAE,IAChC,GAAIJ,CAAuB,CAC7B,CACF,EACA,CAACO,EAAU,mBAAmB,EAAGmH,EACnC,EACA,GAAI,CAAC,KAAK,OAAO,sBAAwB,CAAC,KAAK,mBAAmBtG,CAAY,EAAG,CAC/E,IAAMnB,EAAYC,EAAI,KAAK,OAAO,aAAa,EAW/C,GAPKW,IACHA,EAAeS,EAAIrB,EAAU,UAAW1B,CAAU,GAAK0B,EAAU,UAAU1B,CAAU,GAAK+C,EAAIrB,EAAU,UAAU1B,CAAU,EAAG,MAAM,EACjI0B,EAAU,UAAU1B,CAAU,EAAE,KAChC8G,IAAQ9E,EAAU,YACd+E,EAAyB,KAC3B,IAEJ,CAACzE,EACH,MAAM,IAAI,MAAM,wFAAwFtC,CAAU,8BAA8B6C,CAAY,GAAG,EAEjK,MAAMlB,EAAI,gCAAiCW,EAAcO,CAAY,CACvE,CACA,IAAIqH,EAAY,GACZ7J,EAAO,QACT6J,EAAY7J,EAAO,MAAMN,EAASE,CAAK,IAAM,IAASiK,GAGxD,IAAIhH,EAEJ,CAQE,IAAMiH,EAAqBrD,IAAQ9E,EAAU,aAAe,CAAC/B,GAAO,KAAK,eACrE,CACE,IAAK,CACH,eAAgBU,GAAU,KAAK,KAAQoG,EAAyB,KAAMlG,CAAM,CAC9E,CACF,EACAZ,EAIJ,GAAI,CAACuH,GAAuBzH,EAASM,EAAQ8J,EAAoBhK,EAAc2G,EAAKC,CAAG,EACrF,MAAM,IAAI,MAAM,qCAAqC,EAGvD7D,EAAaiH,EAAmB,IAAI,eAAehK,CAAY,CACjE,CAEIE,EAAO,SAASyG,CAAG,EAAE,IACvBoD,EAAY7J,EAAO,SAASyG,CAAG,EAAE,EAAE/G,EAASE,CAAK,IAAM,IAASiK,GAE9DA,IACF,MAAM7C,EAAMP,CAAG,EAAEC,CAAG,EACpB1G,EAAO,SAASN,EAASE,CAAK,EAC9BI,EAAO,UAAUyG,CAAG,EAAE,IAAI/G,EAASE,CAAK,EAE5C,EACA,yCAA0C,SAAUD,EAAoBoK,EAAe,CAIrF,OAAOzI,EAAI,8BAA+B3B,EAAY,SAAY,CAChE,MAAM2B,EAAI,kCAAmC3B,EAAYoK,CAAK,EAG9DzI,EAAI,sCAAuC3B,CAAU,CACvD,CAAC,CACH,EACA,mCAAoC,eAAgBA,EAAoB2E,EAAgD,CACtH,IAAM1E,EAAQ0B,EAAI,KAAK,OAAO,aAAa,EAC3C,GAAI1B,EAAM,UAAUD,CAAU,IAAM,KAClC,MAAM,IAAIqK,GAAsB,4CAA8CrK,CAAU,EAG1F,GAAI,CACF,KAAK,aAAaA,CAAU,EAAI,CAAE,UAAW,CAACC,EAAM,UAAUD,CAAU,GAAG,IAAK,EAChF2B,EAAI,wBAAyB2I,GAAqBtK,EAAY,EAAI,EAClE,IAAMuK,EAAuBtK,EAAMD,CAAU,GAAG,WAAa,OAAO,OAAO,IAAI,GAK3EuK,GAAsB,OAAS5F,GAAQ,UACzC,OAAO4F,EAAqB,MAC5BA,EAAqB,UAAY,GACjC5I,EAAI,qCAAsC3B,EAAY,CAAE,OAAQ,EAAK,CAAC,EACtE,KAAK,OAAO,YAAYC,EAAOD,EAAY,OAAO,OAAO,IAAI,CAAC,EAC9D,KAAK,OAAO,YAAYC,EAAMD,CAAU,EAAG,YAAauK,CAAoB,GAG9E,GAAM,CAAE,KAAMC,CAAW,EAAI,MAAM7I,EAAI,8BAA+B3B,CAAU,EAChF,QAAQ,MAAM,4BAA4BA,CAAU,mBAAmBwK,CAAU,EAAE,EAEnF,GAAM,CAAE,KAAMC,EAAY,OAAQC,CAAa,EAAIzK,EAAM,UAAUD,CAAU,GAAK,CAAC,EAC7E2K,EAAe,KAAK,gBAAgB,IAAI3K,CAAU,EAWxD,GAVK2K,GACW,KAAK,QAAQ,KAAMxF,GAAUA,GAAO,aAAenF,CAAU,GAIzE,KAAK,QAAQ,KAAK,CAAE,WAAAA,CAAW,CAAC,EAGpC,KAAK,mBAAmBA,CAAU,EAAI,KAAK,mBAAmBA,CAAU,GAAK,OAAO,OAAO,IAAI,EAE3FwK,IAAeC,EAAY,CAC7B,QAAQ,MAAM,qCAAqCzK,CAAU,oBAAoByK,GAAc,WAAW,sBAAsBD,CAAU,EAAE,EAE5I,IAAMI,EAAejJ,EAAI,2BAA4B3B,EAAY0K,GAAgB,EAAG,OAAWD,GAAczK,CAAU,EAKnH6K,EAAkB,GAChBC,EAAcF,EAAa,UAAU,EAE3C,QAASG,EAAOhI,EAAI9C,EAAM,UAAWD,CAAU,GAAK+C,EAAI9C,EAAM,UAAUD,CAAU,EAAG,MAAM,GAAK+K,EAAO,GAAO,CAC5G,GAAM,CAAE,KAAAC,EAAM,MAAOZ,CAAM,EAAI,MAAMU,EAAY,KAAK,EACtD,GAAIE,EAAM,CACR,GAAI,CAACH,EACH,MAAM,IAAII,GAAqB,iBAAiBT,CAAU,mCAAmCxK,CAAU,EAAE,EAE3G,KACF,CACK6K,IACHA,EAAkB7I,EAAU,gBAAgBoI,CAAK,EAAE,OAASI,GAE1D,CAAAO,GAEJ,MAAMpJ,EAAI,kCAAmC3B,EAAYoK,CAAK,CAChE,CACF,SAAYO,EASV,QAAQ,MAAM,uBAAuB3K,CAAU,2BAA2B,MATlD,CACxB,KAAK,gBAAgB,IAAIA,CAAU,EACnC2B,EAAI,wBAAyBmD,GAAoB,MAAM,KAAK,KAAK,eAAe,EAAG,CAAE,MAAO,CAAC9E,CAAU,EAAG,QAAS,CAAC,CAAE,CAAC,EACvH,IAAMkL,EAAa,KAAK,QAAQ,UAAW/F,GAAUA,GAAO,aAAenF,CAAU,EACjFkL,IAAe,IACjB,KAAK,QAAQ,OAAOA,EAAY,CAAC,EAEnC,QAAQ,MAAM,yCAAyClL,CAAU,sBAAsB,CACzF,CAMA2B,EAAI,sCAAuC3B,CAAU,CACvD,OAASwC,EAAG,CACV,cAAQ,MAAM,kCAAkCA,EAAE,SAAWA,CAAC,GAAIA,CAAC,EACnE,KAAK,OAAO,MAAM,oBAAoBA,EAAGxC,CAAU,EAC7CwC,CACR,QAAE,CACIvC,EAAMD,CAAU,GAAG,WAAW,WAChC,KAAK,OAAO,YAAYC,EAAMD,CAAU,EAAE,UAAW,WAAW,EAElE,OAAO,KAAK,aAAaA,CAAU,EACnC2B,EAAI,wBAAyB2I,GAAqBtK,EAAY,EAAK,CACrE,CACF,EACA,sCAAuC,SAAUA,EAAoB,CAC9D+C,EAAI,KAAK,mBAAoB/C,CAAU,GAG5C,OAAO,QAAQ,KAAK,mBAAmBA,CAAU,CAAC,EAAE,QAAQ,CAAC,CAACgB,EAAKmK,CAAE,IAAM,CAGzE,OAAO,KAAK,mBAAmBnL,CAAU,EAAEgB,CAAG,EAK9CW,EAAI,8BAA+B3B,EAAYmL,CAAE,EAAE,MAAO3I,GAAM,CAC9D,QAAQ,MAAM,2BAA2BxC,CAAU,UAAW,CAAE,WAAAA,EAAY,GAAAmL,EAAI,MAAO3I,CAAE,CAAC,CAC5F,CAAC,CACH,CAAC,CACH,EACA,oCAAqC,SAAU4I,EAA4B,CAEzE,IAAMC,EADQ1J,EAAI,KAAK,OAAO,aAAa,EACPyJ,CAAkB,EAEhDxB,EAAeyB,GAAuB,KAAK,aAEjD,GAAI,CAACzB,GAAgB,CAAC,OAAO,KAAKA,CAAY,EAAE,OAAQ,OAYxD,GAAI,CATwB,CAAC,CADV7H,GAAwBsJ,EAAuB,CAACrJ,EAAU,UAAU,EAAG,CAAC,KAAK,CAAC,EAUvE,CACxB,QAAQ,KAAK,kFAAmF,CAAE,mBAAAoJ,CAAmB,CAAC,EACtH,MACF,CAIA,OAAO,QAAQxB,CAAY,EAAE,QAAQ,CAAC,CAAC5J,EAAYe,CAAI,IAAM,CAC3D,GACE,CAAC,MAAM,QAAQA,CAAI,GAGnB,CAACA,EAAK,OAAO,CAACqB,EAAK,CAAC,CAAEkJ,CAAE,IACflJ,GAAOW,EAAIsI,EAAsB,IAAI,eAAgBC,CAAE,EAC7D,EAAK,EACR,CACA,QAAQ,KAAK,mFAAoF,CAC/F,mBAAAF,EACA,WAAApL,CACF,CAAC,EACD,MACF,CAEA2B,EAAI,8BAA+B3B,EAAY,CAAC,+CAAgDA,EAAYoL,CAAkB,CAAC,EAAE,MAAO5I,GAAM,CAC5I,QAAQ,MAAM,oDAAoDxC,CAAU,2BAA2BoL,CAAkB,GAAI5I,CAAC,CAChI,CAAC,CACH,CAAC,CACH,EACA,+CAAgD,eAAgBxC,EAAoBoL,EAA4B,CAC9G,IAAM1J,EAAYC,EAAI,KAAK,OAAO,aAAa,EACzC0J,EAAwB3J,EAAU0J,CAAkB,EACpDxB,EAAeyB,GAAuB,KAAK,eAAerL,CAAU,GAAG,OAAO,CAAC,EAKrF,GACE,CAAC,MAAM,QAAQ4J,CAAY,GAE3B,CAACA,EAAa,OAAO,CAACxH,EAAK,CAAC,CAAEkJ,CAAE,IACvBlJ,GACLW,EAAIsI,EAAsB,IAAI,eAAgBC,CAAE,GAChD3C,GAAgB0C,EAAuBA,EAAsB,IAAI,eAAeC,CAAE,EAAE,IAAI,GAAK,KAE9F,EAAK,EACR,CACA,QAAQ,KAAK,2FAA4F,CACvG,mBAAAF,EACA,WAAApL,CACF,CAAC,EACD,MACF,CAIK,KAAK,gBAAgB,IAAIA,CAAU,GACtC,MAAM2B,EAAI,mCAAoC3B,CAAU,EAG1D,IAAMuL,EAAgB7J,EAAU1B,CAAU,EACpCiK,EAAe,CAAC,EAChBuB,EAAe,CAAC,EAEtB5B,EAAa,QAAQ,CAAC,CAACnB,EAASgD,CAAU,IAAM,CAG9C,IAAMlI,EAAQoF,GAAgB4C,EAAe9C,CAAO,EACpD,GAAKlF,EAGMA,IAAUkI,GAGnBD,EAAa,KAAKC,CAAU,MANlB,CACVxB,EAAa,KAAKwB,CAAU,EAC5B,MACF,CAQKF,EAAc,WAGZA,EAAc,UAAU,OAAO,KAAK,OAAO,YAAYA,EAAc,UAAW,QAAS,CAAC,CAAC9C,EAAS2C,CAAkB,CAAC,CAAC,EACzH,MAAM,QAAQG,EAAc,UAAU,KAAK,GAAK,CAACA,EAAc,UAAU,MAAM,KAAMhJ,GAAMA,EAAE,CAAC,IAAMkG,GAAWlG,EAAE,CAAC,IAAM6I,CAAkB,GAAGG,EAAc,UAAU,MAAM,KAAK,CAAC9C,EAAS2C,CAAkB,CAAC,GAHjN,KAAK,OAAO,YAAYG,EAAe,YAAa,OAAO,OAAO,KAAM,CAAE,MAAO,CAAE,MAAO,CAAC,CAAC9C,EAAS2C,CAAkB,CAAC,EAAG,aAAc,GAAM,WAAY,GAAM,SAAU,EAAK,CAAE,CAAC,CAAC,CAKxL,CAAC,GAIGnB,EAAa,QAAUuB,EAAa,UACjCH,EAAsB,WACzB,KAAK,OAAO,YAAYA,EAAuB,YAAa,OAAO,OAAO,IAAI,CAAC,EAE5EA,EAAsB,UAAU,uBACnC,KAAK,OAAO,YAAYA,EAAsB,UAAW,wBAAyB,OAAO,OAAO,IAAI,CAAC,EAEvGpB,EAAa,QAASqB,GAAO,KAAK,OAAO,YAAYD,EAAsB,UAAU,sBAAuBC,EAAI,KAAK,CAAC,EACtHE,EAAa,QAASF,GAAO,KAAK,OAAO,YAAYD,EAAsB,UAAU,sBAAuBC,EAAI,EAAI,CAAC,EAErH3J,EAAI,8BAA+ByJ,EAAoB,CAAC,6CAA8CA,CAAkB,CAAC,EAAE,MAAO5I,GAAM,CACtI,QAAQ,MAAM,qDAAqDxC,CAAU,2BAA2BoL,CAAkB,GAAI5I,CAAC,CACjI,CAAC,EAEL,EAcA,6CAA8C,SAAUxC,EAAoB,CAC1E,IAAM0B,EAAYC,EAAI,KAAK,OAAO,aAAa,EACzC4J,EAAgB7J,EAAU1B,CAAU,EACpC0L,EAAwBH,GAAe,WAAW,sBAExD,GAAI,CAACG,GAAyB,OAAO,KAAKA,CAAqB,EAAE,SAAW,EAAG,OAG/E,IAAMF,EAAyB,OAAO,QAAQE,CAAqB,EAAE,OAAO,CAAC,CAAC,CAAEnJ,CAAC,IAAMA,IAAM,EAAI,EAAE,IAAI,CAAC,CAAC+I,CAAE,IAAMA,CAAE,EAG7G,CAAC,CAAEK,EAAuBC,CAAa,EAAIJ,EAAa,OAAO,CAACpJ,EAAKmB,IAAU,CACnF,IAAMvC,EAAMuK,EAAc,KAAK,iBAAiBhI,CAAK,EACrD,GAAI,CAACvC,GAAO,CAACA,EAAI,WAAY,OAAOoB,EACpC,IAAMyJ,EAAa,OAAO7K,EAAI,UAAU,EAClCwI,EAAQ,IAAI,IAAIqC,CAAU,EAC1BC,EAAoBtC,EAAM,SAC1BE,EAAiBF,EAAM,aAAa,IAAI,SAAS,EACvD,GAAI,CAACE,EAAgB,MAAM,IAAI,MAAM,0BAA0B,EAC/D,IAAMqC,EAAerK,EAAUoK,CAAiB,EAChD,GAAI,CAACC,EAAc,OAAO3J,EAC1B,IAAM4J,EAASrD,GAAgBoD,EAAcrC,CAAc,EAC3D,GAAI,CAACsC,EAEH,OAAIN,EAAsBnI,CAAK,IAAM,IACnC,KAAK,OAAO,YAAYmI,EAAuBnI,EAAO,KAAK,EAEtDnB,EAGT,GAAM,CAAC6J,EAAkBC,EAAqBC,CAAc,EAAI/J,EAC1DC,EAAY,KAAK,IAAI4J,EAAkBjL,EAAI,WAAa,OAAO,iBAAiB,EACtF,GAAIqB,GAAa4J,EACf,OAACE,EAAqB,KAAK,CACzB,KAAMnL,EAAI,KACV,SAAUuC,EACV,GAAIyI,EACJ,KAAMD,EAAa,IAAI,eAAeC,CAAM,EAAE,IAChD,CAAC,EACM,CAACC,EAAkBC,EAAqBC,CAAc,EACxD,GAAI,OAAO,SAAS9J,CAAS,EAAG,CACrC,IAAMlC,EAAe4B,GAAwBwJ,EAAe,CAACvJ,EAAU,aAAa,EAAG,CAAC,KAAK,EAAGK,CAAS,EACzG,GAAIlC,EACF,OAACgM,EAAqB,KAAK,CACzB,KAAMnL,EAAI,KACV,SAAUuC,EACV,GAAIyI,EACJ,KAAMD,EAAa,IAAI,eAAeC,CAAM,EAAE,IAChD,CAAC,EACM,CAAC3J,EAAWlC,EAAcgM,CAAc,CAEnD,CACA,OAAO/J,CACT,EAAG,CAAC,OAAO,kBAAmB,GAAI,CAAC,CAAC,CAAC,EAErC,GAAIwJ,EAAc,SAAW,EAAG,CAC9B,IAAMtJ,EAAeiJ,EAAc,IAAI,KAIvC5J,EAAI,yBAA0B,CAAE,WAAA3B,EAAY,aAAAsC,EAAc,KAAMsJ,EAAe,aAAcD,CAAsB,CAAC,EAAE,MAAMnJ,GAAK,CAC/H,QAAQ,MAAM,gFAAgFxC,CAAU,GAAIwC,EAAE,OAAO,CACvH,CAAC,CACH,CAGA,IAAMyH,EAAe,OAAO,QAAQyB,CAAqB,EAAE,OAAO,CAAC,CAAC,CAAEnJ,CAAC,IAAMA,IAAM,KAAK,EAAE,IAAI,CAAC,CAAC+I,CAAE,IAAMA,CAAE,EAGpG,CAAC,CAAEc,EAAoBC,CAAc,EAAIpC,EAAa,OAAO,CAAC7H,EAAKmB,IAAU,CACjF,GAAM,CAAC0I,EAAkBC,EAAqBI,CAAa,EAAIlK,EACzDC,EAAY,KAAK,IAAI4J,EAAkBV,EAAc,KAAK,iBAAiBhI,CAAK,GAAG,WAAa,OAAO,iBAAiB,EAC9H,GAAIlB,GAAa4J,EACf,OAACK,EAAoB,KAAK/I,CAAK,EACxB,CAAC0I,EAAkBC,EAAqBI,CAAa,EACvD,GAAI,OAAO,SAASjK,CAAS,EAAG,CACrC,IAAMlC,EAAe4B,GAAwBwJ,EAAe,CAACvJ,EAAU,UAAU,EAAG,CAAC,KAAK,EAAGK,CAAS,EACtG,GAAIlC,EACF,OAACmM,EAAoB,KAAK/I,CAAK,EACxB,CAAClB,EAAWlC,EAAcmM,CAAa,CAElD,CACA,OAAOlK,CACT,EAAG,CAAC,OAAO,kBAAmB,GAAI,CAAC,CAAC,CAAC,EAErC,GAAIiK,EAAe,SAAW,EAAG,CAC/B,IAAM/J,EAAeiJ,EAAc,IAAI,KAIvC5J,EAAI,sBAAuB,CAAE,WAAA3B,EAAY,aAAAsC,EAAc,KAAM+J,EAAgB,aAAcD,CAAmB,CAAC,EAAE,MAAM5J,GAAK,CAC1H,QAAQ,MAAM,qEAAqExC,CAAU,GAAIwC,EAAE,OAAO,CAC5G,CAAC,CACH,CACF,EACA,2CAA4C,SAAUxC,EAAoB,CAExE,IAAMuL,EADQ5J,EAAI,KAAK,OAAO,aAAa,EACf3B,CAAU,GAAK,CAAC,EAEtCiJ,EAAUsC,GAAe,KAAK,iBACpC,GAAI,CAACtC,EAAS,OAEd,IAAM9I,EAAe4B,GAAwBwJ,EAAe,CAACvJ,EAAU,UAAWA,EAAU,oBAAqBA,EAAU,YAAY,EAAG,CAAC,KAAK,CAAC,EAEjJ,GAAI,CAAC7B,EAAc,CACjB,QAAQ,IAAI,8GAA8G,EAC1H,MACF,CAEA,OAAO,QAAQ8I,CAAO,EAAE,IAAI,CAAC,CAACjC,EAAM7B,CAAK,IAAM,CAC7C,GAAI,CAAC,MAAM,QAAQA,CAAK,GAAKA,EAAM,SAAW,EAC5C,OAGF,GAAM,CAAC,CAAC,CAAC,CAAE,CAAC2D,CAAqB,CAAC,EAAM3D,EAExC,OAAOxD,EAAI,8BAA+BmH,EAAuB,CAAC,uCAAwC9I,EAAYG,EAAc6G,CAAI,CAAC,EAAE,MAAOxE,GAAM,CACtJ,QAAQ,MAAM,4DAA4DwE,CAAI,SAAS8B,CAAqB,OAAO9I,CAAU,GAAIwC,CAAC,CACpI,CAAC,CACH,CAAC,CACH,EACA,uCAAwC,eAAgBxC,EAAoBG,EAAsB6G,EAAc,CAC9G,IAAM/G,EAAQ0B,EAAI,KAAK,OAAO,aAAa,EACrC4J,EAAgBtL,EAAMD,CAAU,EAChCmF,EAAQoG,GAAe,KAAK,mBAAmBvE,CAAI,EACnDtE,EAAW,KAAK,UAEtB,GAAI,CAAC,MAAM,QAAQyC,CAAK,GAAKA,EAAM,SAAW,EAC5C,OAGF,GAAM,CAACoH,EAAoB1L,EAAQ,CAAE,CAACiI,EAAuB0D,EAAIC,EAA2BC,CAAQ,CAAC,EAAMvH,EAC3GA,EAAM,IAAI,EAEV,IAAMwH,EAAgB,CAAC,CAACpB,EAAc,IAAI,iBAAiBpL,CAAY,GAAG,SAK1E,GADA,MAAMwB,EAAI,mCAAoCmH,CAAqB,EAC/DpG,IAAa,KAAK,UAAW,OAEjC,IAAMkK,EAAmB3M,EAAM6I,CAAqB,EAC9CxG,EAAerC,EAAM,UAAUD,CAAU,EAAE,KAC3C6M,EAA0BD,EAAiB,IAAI,KAE/CrK,EAAIuK,GAAmBhE,EAAuB8D,EAAkBJ,EAAIC,EAA2BC,CAAQ,EAAE,QAAQ,EAGjH,CAAE,gBAAAK,CAAgB,EAAIxK,EAEtByK,EAAcC,GAAsBjN,EAAYuL,EAAehJ,EAAE,YAAa1B,EAAQ,KAAK,oBAAqB6L,CAAQ,EAAE,QAAQ,EAElIQ,EAA0B5E,GAAe0E,CAAW,EACpDG,EAAgB5J,GAAM2J,CAAuB,EAInD,QAAQ,QAAQ,EAAE,KAAK,IAAM,CAC3B,GAAIxK,IAAa,KAAK,UAAW,OACjC,GAAI,CAACK,EAAI6J,EAAiB,IAAI,eAAgBO,CAAa,GAAKP,EAAiB,IAAI,eAAeO,CAAa,EAAE,iBAAmB,KACpI,MAAM,IAAI,MAAM,wCAAwCrE,CAAqB,SAASqE,CAAa,gBAAgB,EAKrHxL,EAAI,2BAA4B,IAAI0G,GAAO,CACzC,CAAE,IAAK6E,CAAwB,CACjC,CAAC,CAAC,EAEF,IAAMnM,EAAOqM,GACXnN,EAAM,WACN,OAAO,QAAQsL,EAAc,IAAI,cAAc,EAC5C,OAAO,CAAC,CAAC,CAAEvK,EAAG,IAAM,CAAC,CAAEA,GAAU,MAAM,SAAS,SAAS,EACzD,IAAI,CAAC,CAAC6I,EAAG,IAAMA,EAAG,CACvB,EAEA,GAAI,CAAC9I,GAAQ,OAAO,KAAKA,CAAI,EAAE,SAAW,EAAG,CAC3C,QAAQ,KAAK,4CAA6C,CAAE,WAAAf,EAAY,sBAAA8I,CAAsB,CAAC,EAC/F,MACF,CAEA,IAAMuE,EAAkB,CACtB,WAAYrN,EACZ,KAAM,OAAO,QAAQe,CAAI,EAAE,IAAI,CAAC,CAACwC,GAAOvC,EAAG,KAAwB,CACjE,GAAIuC,GACJ,KAAM,CACJ,QAAS,CACP,QAAS+J,GAAsBxE,EAAuBiE,EAAiB/L,EAAG,EAC1E,UAAW,EACb,CACF,CACF,EAAE,EACF,eAAgBgG,EAChB,iBAAkBnG,CACpB,EAGA,GAAK0K,GAAe,KAAK,mBAAmBvE,CAAI,EAKhD,OAAOqG,CACT,CAAC,EAAE,KAAMA,GAAoB,CAC3B,GAAI,EAAA3K,IAAa,KAAK,WAAa,CAAC2K,GAEpC,OAAO1L,EAAI,wBAAyB,CAClC,WAAYmH,EACZ,aAAc+D,EACd,KAAMN,EACFe,GACAxE,EACAyE,GAAyBX,EAAkB,CAAC5K,EAAU,YAAY,EAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,GACtFqL,CACF,EACEA,EACJ,aAAcF,CAChB,CAAC,EAAE,KAAMK,GAAQ,CACf,GAAI9K,IAAa,KAAK,UAAW,OAGjC,IAAM+K,GAAU,CAAE,eAAgBzG,EAAM,aAAcwG,EAAI,KAAK,EAAG,QAAS,EAAK,EAC1EE,GAAuB,CAC3B,WAAY5E,EACZ,KAAM,CACJ,CACE,GAAIqE,EACJ,KAAM,CACJ,QAAS,CACP,QAASG,GAAsBtN,EAAYuN,GAAyBhC,EAAe,CAACvJ,EAAU,mBAAmB,EAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,GAAIgL,CAAW,EACpJ,UAAW,EACb,CACF,CACF,CACF,CACF,EAIArL,EAAI,sBAAuB,CACzB,WAAA3B,EACA,aAAAsC,EACA,aAAAnC,EACA,KAAM,CACJ,CACE,kCACA,CACE,KACAwM,EACIW,GACAtN,EACAuN,GAAyBhC,EAAe,CAACvJ,EAAU,mBAAmB,EAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,GAC1FyL,EACF,EACEA,EACN,CACF,EACA,CAGE,wBACA,CACE,KAAMlB,EACFe,GACAtN,EACAuN,GAAyBhC,EAAe,CAACvJ,EAAU,YAAY,EAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,GACnF0L,EACF,EACEA,EACN,CACF,CACF,CACF,CAAC,EAAE,MAAOlL,IAAM,CACd,QAAQ,MAAM,gEAAiEA,EAAC,CAClF,CAAC,CACH,CAAC,CACH,CAAC,EAAE,MAAOA,GAAM,CACd,QAAQ,MAAM,+BAAgCA,CAAC,EAC/C,IAAMiL,EAAU,CAAE,eAAgBzG,EAAM,QAAS,EAAM,EAGlDuE,GAAe,KAAK,mBAAmBvE,CAAI,GAOhDrF,EAAI,kCAAmC,CACrC,WAAA3B,EACA,aAAAsC,EACA,aAAAnC,EACA,KAAMwM,EACFW,GAAsBtN,EAAYuN,GAAyBhC,EAAe,CAACvJ,EAAU,mBAAmB,EAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,GAAIyL,CAAO,EACvIA,CACN,CAAC,EAAE,MAAOjL,IAAM,CACd,QAAQ,MAAM,iFAAkFA,EAAC,CACnG,CAAC,CACH,CAAC,CACH,EACA,kCAAmC,eAAgBxC,EAAoB2N,EAAoB,CACzF,IAAM1N,EAAQ0B,EAAI,KAAK,OAAO,aAAa,EACrC,CAAE,eAAAiM,EAAgB,gBAAAC,EAAiB,iBAAAC,CAAiB,EAAI,KAAK,OAAO,MACtEC,EAAoB,GACpBhO,EAGJ,GAAI,CAEF,GAAI,CAAC,KAAK,OAAO,mBAAqB,CAAC,KAAK,QAAQ,KAAMoF,GAAUA,GAAO,aAAenF,CAAU,GAAK,CAAC,KAAK,gBAAgB,IAAIA,CAAU,EAAG,CAC9I,QAAQ,KAAK,kDAAkDA,CAAU,IAAK2N,CAAU,EACxF,MACF,CAWA,IAAMK,EAAoB/N,EAAMD,CAAU,EAAIkB,GAAUjB,EAAMD,CAAU,CAAC,EAAI,OAAO,OAAO,IAAI,EAoB/F,GADAD,EAAUiC,EAAU,YAAY2L,EAAY,KAAK,oBAAqBK,EAAmB,KAAK,OAAO,wBAAwB,EACzHjO,EAAQ,WAAW,IAAMC,EAC3B,MAAM,IAAI,MAAM,0CAA0CA,CAAU,YAAYD,EAAQ,WAAW,CAAC,EAAE,EAExG,GAAI,CAACA,EAAQ,eAAe,IAAM,CAACgD,EAAI9C,EAAM,UAAWD,CAAU,GAAK,CAAC+C,EAAI9C,EAAOD,CAAU,GAC3F,MAAM,IAAIiO,GAAuB,wEAAwE,EAQ3G,GANAL,IAAiB7N,CAAO,EAKRmO,GAAY,qBAAqB,KAAK,KAAMnO,CAAO,IACnD,GAAO,OAQvB,GAAIE,EAAMD,CAAU,GAAG,WAAW,MAAO,CACvC,QAAQ,KAAK,+BAA+BD,EAAQ,YAAY,CAAC,qCAAqC,EACtG,MACF,CAEA,IAAM0B,EAA2B,KAAK,OAAO,gBAAuB,OAAL,CAAC,EAOhE5B,GAA2B,OAAOE,CAAO,EACzC,GAAI,CACF,MAAMmO,GAAY,gBAAgB,KAAK,KAAMnO,EAASiO,EAAmBvM,CAAuB,CAClG,OAASgG,EAAI,CACX,IAAMjF,EAAKiF,EACX,GAAIjF,GAAG,OAAS,kCAEd,GADA,QAAQ,KAAK,oBAAoBA,EAAE,IAAI,4BAA4BzC,EAAQ,YAAY,CAAC,KAAKyC,EAAE,OAAO,GAAIA,EAAGzC,EAAQ,UAAU,CAAC,EAC5HyC,EAAE,MAAO,CACX,IAAMkF,EAA0B7H,GAA2B,IAAIE,CAAO,EAClE2H,EACFA,EAAwB,IAAIlF,EAAE,KAAK,EAEnC3C,GAA2B,IAAIE,EAAS,IAAI,IAAI,CAACyC,EAAE,KAAK,CAAC,CAAC,CAE9D,OAEA,QAAQ,MAAM,qBAAqBA,EAAE,IAAI,4BAA4BzC,EAAQ,YAAY,CAAC,KAAKyC,EAAE,SAAWA,CAAC,GAAIA,EAAGzC,EAAQ,UAAU,CAAC,EAUzI,GAPA,QAAQ,KAAK,+BAA+BA,EAAQ,YAAY,CAAC,KAAKA,EAAQ,UAAU,CAAC,qCAAqC,EAC1H,KAAK,OAAO,mBAGhBgO,EAAoBvL,GAAG,OAAS,mBAChC,KAAK,OAAO,MAAM,eAAeA,EAAGzC,EAASD,GAAW,KAAK,KAAMC,EAASC,EAAYgO,CAAiB,CAAC,EAGxGxL,EAAE,OAAS,0BACXA,EAAE,OAAS,wBACXzC,EAAQ,eAAe,GAEvB,MAAMyC,CAEV,CAGKuL,IAEC,MAAM,QAAQtM,CAAuB,GAAKA,EAAwB,OAAS,GAC7E,MAAM,QAAQ,IAAIA,EAAwB,IAAI0M,GAAM,QAAQ,QAAQA,EAAG,CAAE,MAAOH,EAAmB,QAAAjO,CAAQ,CAAC,CAAC,EAAE,MAAO0H,GAAO,CAC3H,IAAMjF,EAAKiF,EACX,QAAQ,MAAM,qBAAqBjF,EAAE,IAAI,iCAAiCzC,EAAQ,YAAY,CAAC,KAAKyC,EAAE,OAAO,GAAIA,EAAG,CAAE,QAASzC,EAAQ,UAAU,CAAE,CAAC,CACtJ,CAAC,CAAC,CAAC,EAGD,CAAC,KAAK,OAAO,sBAAwB,CAAC,KAAK,OAAO,iBACpD,MAAMmO,GAAY,mBAAmB,KAAK,KAAMnO,EAASiO,CAAiB,GAAG,MAAOvG,GAAO,CACzF,IAAMjF,EAAKiF,EACX,QAAQ,MAAM,qBAAqBjF,EAAE,IAAI,uBAAuBzC,EAAQ,YAAY,CAAC,KAAKyC,EAAE,OAAO,GAAIA,EAAG,CAAE,QAASzC,EAAQ,UAAU,CAAE,CAAC,EAG1I,KAAK,OAAO,MAAM,kBAAkByC,EAAGzC,CAAO,CAChD,CAAC,GAaL,GAAI,CACF,IAAME,EAAQ0B,EAAI,KAAK,OAAO,aAAa,EAC3C,MAAMuM,GAAY,mBAAmB,KAAK,KAAM,CAAE,QAAAnO,EAAS,MAAAE,EAAO,cAAe+N,EAAmB,kBAAAD,EAAmB,gBAAAF,CAAgB,CAAC,CAC1I,OAASpG,EAAI,CACX,IAAMjF,EAAKiF,EACX,QAAQ,MAAM,qBAAqBjF,EAAE,IAAI,SAASzC,EAAQ,YAAY,CAAC,oCAAoCyC,EAAE,OAAO,GAAIA,EAAG,CAAE,QAASzC,EAAQ,UAAU,CAAE,CAAC,CAC7J,CACF,OAAS0H,EAAI,CACX,IAAMjF,EAAKiF,EACX,QAAQ,MAAM,oCAAoCjF,EAAE,SAAWA,CAAC,GAAIA,CAAC,EACrE,GAAI,CACFsL,IAAmBtL,EAAGzC,CAAO,CAC/B,OAASqO,EAAI,CACX,QAAQ,MAAM,2DAA4DA,CAAE,CAC9E,CACA,MAAM5L,CACR,QAAE,CACIzC,GACFF,GAA2B,OAAOE,CAAO,CAE7C,CACF,CACF,CAAC,EAEKsO,GAAmB,CAAC,EACpBC,GAAqBC,GAAUvO,GAAe2B,EAAI,4BAA6B3B,EAAY,CAAE,MAAO,EAAK,CAAC,EAAE,MAAOwC,GAAM,CAC7H,QAAQ,MAAM,8CAA8CxC,CAAU,GAAIwC,CAAC,CAC7E,CAAC,EAAG,GAAI,EAEF0L,GAAc,CAClB,qBAAsBnO,EAAoB,CACxC,IAAMC,EAAaD,EAAQ,WAAW,EAChCiH,EAAOjH,EAAQ,KAAK,EACpBc,EAASd,EAAQ,OAAO,EAOxByO,EANQ7M,EAAI,KAAK,OAAO,aAAa,EAMP,UAAU3B,CAAU,GAAG,OAC3D,GAAI,CAAC,OAAO,cAAca,CAAM,EAC9B,MAAM,IAAI4N,GAA2B,WAAWzH,CAAI,gBAAgBhH,CAAU,yBAAyB,EAGzG,GACED,EAAQ,eAAe,EAEnByO,GAAyB,KAGzB,EAAEA,EAAwB3N,GAC9B,CAIA,GAAI,CAAC,KAAK,OAAO,eACf,MAAO,GAET,MAAM,IAAI6N,GAA0B,WAAW1H,CAAI,gBAAgBnG,CAAM,gBAAgBb,CAAU,gDAAgDwO,CAAqB,GAAG,CAC7K,CAEA,GAAKA,EAAwB,EAAK3N,EAAQ,CACxC,GAAI,KAAK,OAAO,eACd,MAAM,IAAI4N,GAA2B,sBAAsBzH,CAAI,gBAAgBnG,CAAM,gBAAgBb,CAAU,yCAAyCwO,CAAqB,GAAG,EAIlL,GAAIH,GAAiB,OAAS,IAC5B,MAAM,IAAIJ,GAAuB,iDAAiD,EAEpF,GAAKI,GAAiB,SAASrH,CAAI,EAMjC,cAAQ,MAAM,kDAAkDjH,EAAQ,YAAY,CAAC,2BAA2B,EAC1G,IAAI0O,GAA2B,iCAAiCzH,CAAI,EAAE,EAN5E,eAAQ,KAAK,wCAAwCjH,EAAQ,YAAY,CAAC,wDAAwD,EAClIsO,GAAiB,KAAKrH,CAAI,EAC1BsH,GAAmBtO,CAAU,EACtB,EAKX,CACA,IAAM2O,EAAeN,GAAiB,QAAQrH,CAAI,EAC9C2H,IAAiB,KACnB,QAAQ,KAAK,4CAA4C5O,EAAQ,YAAY,CAAC,EAAE,EAChFsO,GAAiB,OAAOM,EAAc,CAAC,EAE3C,EACA,MAAM,gBAAiB5O,EAAoBE,EAAewB,EAAiC,CACzF,IAAMzB,EAAaD,EAAQ,WAAW,EACtC,GAAIA,EAAQ,eAAe,GAGrB,OAAO,KAAKE,CAAK,EAAE,KAAK4E,GAAKA,IAAM,WAAW,EAChD,MAAM,IAAIoJ,GAAuB,aAAajO,CAAU,iBAAiB,EAG7E,MAAM2B,EAAI,qCAAsC5B,EAASE,EAAOwB,CAAuB,CACzF,EACA,mBAAoB1B,EAAoBE,EAAe,CACrD,IAAM6G,EAAM/G,EAAQ,OAAO,EAC3B,GAAI,CAAC,CAACiC,EAAU,UAAWA,EAAU,oBAAqBA,EAAU,qBAAqB,EAAE,SAAS8E,CAAG,EACrG,OAGF,IAAM9G,EAAaD,EAAQ,WAAW,EAChC8C,EAAe9C,EAAQ,SAAS,EAChCiH,EAAOjH,EAAQ,KAAK,EACpBc,EAASd,EAAQ,OAAO,EACxBI,EAAeJ,EAAQ,aAAa,EAEpC6O,EAAiB,MAAOC,GAAU,CACtC,IAAM9G,EAAK,KAAK,OAAO,yBAAyB8G,CAAK,EACrD,GAAI,CAAC9G,EAAI,OACT,IAAIxF,EAAIwF,EAAG,KACP3H,EACAM,GAAa6B,CAAC,IAChBnC,EAAqBmC,EAAQ,aAC7BA,EAAKA,EAAQ,QAAQ,GAGvB,GAAM,CAAE,OAAAuF,EAAQ,KAAArH,EAAM,KAAAoH,CAAK,EAAKtF,EAC1BuM,EAAW,CACf,KAAArO,EACA,KAAAoH,EACA,KAAAb,EACA,OAAAnG,EACA,WAAAb,EACA,YAAaD,EAAQ,YAAY,EACjC,UAAWA,EAAQ,UAAU,EAC7B,aAAAI,EACA,IAAI,mBAAqB,CACvB,OAAOI,GAAuBP,EAAYG,EAAcF,CAAK,CAC/D,EACA,kBAAAG,EACA,IAAI,wBAA0B,CAC5B,OAAOG,GAAuBP,EAAYI,EAAmBH,CAAK,CACpE,CACF,EACA,OAAO,MAAM0B,EAAI,GAAGkB,CAAY,IAAIiF,CAAM,cAAegH,EAAU7O,CAAK,CAC1E,EACMuN,EAAM,OAAOzN,EAAQ,QAAQ,CAAC,EAEpC,GAAI+G,IAAQ9E,EAAU,UACpB,OAAO4M,EAAepB,CAAG,EAG3B,IAAMuB,EAAU,CAAC3M,EAAK,CAAC0E,EAAKC,CAAG,KACzB,CAAC/E,EAAU,oBAAqBA,EAAU,qBAAqB,EAAE,SAAS8E,CAAG,GAC/E1E,EAAI,KAAK,OAAO2E,CAAG,CAAC,EAEf3E,GAGH4M,EAAexB,EAAuB,OAAOuB,EAAS,CAAC,CAAC,EAE9D,OAAO,QAAQ,WAAWC,EAAW,IAAKlH,GAAW8G,EAAe9G,CAAM,CAAC,CAAC,EAAE,KAAMmH,GAAY,CAC9F,IAAMC,EAASD,EAAQ,OAAQ/I,GAAMA,EAAE,SAAW,UAAU,EAAE,IAAKA,GAAOA,EAAQ,MAAM,EACxF,GAAIgJ,EAAO,OAAS,EAClB,cAAQ,MAAM,qBAAsBlP,EAAYkP,CAAM,EAEhD,IAAI,eAAeA,EAAQ,6BAA6BlP,CAAU,EAAE,CAE9E,CAAC,CACH,EACA,MAAM,mBAAoB,CAAE,QAAAD,EAAS,MAAAE,EAAO,cAAAsL,EAAe,kBAAAwC,EAAmB,gBAAAF,CAAgB,EAAyH,CACrN,IAAM7N,EAAaD,EAAQ,WAAW,EAChCiH,EAAOjH,EAAQ,KAAK,EACpBc,EAASd,EAAQ,OAAO,EAG9B,GADA,MAAM4B,EAAI,uBAAwB5B,CAAO,EACrC,CAACgO,EAAmB,CAStB,KAAK,OAAO,YAAY9N,EAAOD,EAAYuL,CAAa,EAExD,GAAI,CACFsC,IAAkB9N,CAAO,CAC3B,OAASyC,EAAG,CACV,QAAQ,MAAM,qBAAqBA,EAAE,IAAI,SAASzC,EAAQ,YAAY,CAAC,4BAA4ByC,EAAE,OAAO,GAAIA,EAAG,CAAE,QAASzC,EAAQ,UAAU,CAAE,CAAC,CACrJ,CACF,CAGA,GAAIA,EAAQ,eAAe,EAAG,CAC5B,GAAM,CAAE,KAAAoP,CAAK,EAAMpP,EAAQ,QAAQ,EAC9BgD,EAAI9C,EAAM,UAAWD,CAAU,GAClC,KAAK,OAAO,YAAYC,EAAM,UAAWD,EAAY,OAAO,OAAO,IAAI,CAAC,EAE1E,KAAK,OAAO,YAAYC,EAAM,UAAUD,CAAU,EAAG,OAAQmP,CAAI,EACjE,QAAQ,MAAM,YAAYA,CAAI,mBAAmBnP,CAAU,EAAE,CAC/D,CACID,EAAQ,QAAQ,GAClB,KAAK,OAAO,YAAYE,EAAM,UAAUD,CAAU,EAAG,gBAAiBgH,CAAI,EAE5E,KAAK,OAAO,YAAY/G,EAAM,UAAUD,CAAU,EAAG,OAAQgH,CAAI,EACjE,KAAK,OAAO,YAAY/G,EAAM,UAAUD,CAAU,EAAG,SAAUa,CAAM,EAQrE,IAAMuO,EAAoCvP,GAA2B,IAAIE,CAAO,EAChF,GAAIqP,EAAmC,CACrC,IAAI1H,EAA0BzH,EAAM,UAAUD,CAAU,EAAE,wBACrD0H,IACHA,EAA0B,CAAC,EAC3B,KAAK,OAAO,YAAYzH,EAAM,UAAUD,CAAU,EAAG,0BAA2B0H,CAAuB,GAEzG0H,EAAkC,QAAQ7L,GAAS,CAC7CmE,EAAwB,SAASnE,CAAK,GAC1CmE,EAAwB,KAAKnE,CAAK,CACpC,CAAC,CACH,CAEA,GAAI,CAAC,KAAK,gBAAgB,IAAIvD,CAAU,EAAG,CACzC,IAAMmF,EAAQ,KAAK,QAAQ,KAAMA,GAAUA,GAAO,aAAenF,CAAU,EAE3E,GAAImF,EAAO,CACT,IAAMjF,EAAQ,KAAK,QAAQ,QAAQiF,CAAK,EACpCjF,IAAU,IACZ,KAAK,QAAQ,OAAOA,EAAO,CAAC,CAEhC,CACA,KAAK,gBAAgB,IAAIF,CAAU,EACnC2B,EAAI,wBAAyBmD,GAAoB,MAAM,KAAK,KAAK,eAAe,EAAG,CAAE,MAAO,CAAC9E,CAAU,EAAG,QAAS,CAAC,CAAE,CAAC,CACzH,CAEK+N,IACHpM,EAAI,wBAAyBqF,EAAMhH,EAAYD,CAAO,EACtD4B,EAAI,wBAAyBmE,GAAe9F,EAAYD,CAAO,EAEnE,CACF,EAEMoJ,GAAkB5G,GAAM,CAC5B,MAAM,IAAI,MAAM,+CAA+C,KAAK,UAAUA,CAAC,CAAC,GAAG,CACrF,EC3rEA,IAAI8M,GAAW,KAAK,IAAI,EAGpBC,GAAgB,YAAY,IAAI,EAGhCC,GACAC,GAEEC,GAAiB,gBAAkB,CAEvC,IAAMC,EAAY,YAAY,IAAI,EAE5BC,EAAO,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,QAAS,CAAE,OAAQ,KAAK,gBAAgB,MAAO,CAAC,EAC3GC,EAAqB,YAAY,IAAI,EAC3C,GAAIA,EAAqBF,EAAY,IACnC,MAAM,IAAI,MAAM,mDAAmD,EAGrE,GAAI,CAACC,EAAK,GAAI,MAAM,IAAI,MAAM,4BAA4B,EAC1D,IAAME,EAAc,IAAI,KAAK,MAAMF,EAAK,KAAK,CAAC,EAAG,QAAQ,EAEzD,GAAI,OAAO,MAAME,CAAU,EAAG,MAAM,IAAI,MAAM,6BAA6B,EAI3E,IAAMC,EAAmB,YAAY,IAAI,EACzCT,GACEQ,GACCD,EAAqBF,GAAa,GAGlCI,EAAmBF,GACtBN,GAAgBQ,CAClB,EAEOC,GAASC,EAAI,yBAA0B,CAC5C,kCAAmC,UAAY,CAC7C,GAAIT,KAAkB,OACpB,MAAM,IAAI,MAAM,yDAAyD,EAG3E,IAAMU,EAAS,CAACC,EAAgB,MAAW,CAEzC,GAAIX,KAAkB,KAAM,OAC5B,IAAMY,EAAU,WAAW,IAAM,CAE/BV,GAAe,KAAK,IAAI,EAAE,KAAK,IAAM,CAE/BF,KAAkBY,IAASZ,GAAgB,MAE/CU,EAAO,CACT,CAAC,EAAE,MAAMG,GAAK,CAERb,KAAkBY,GAEpBZ,GAAgB,KAChB,QAAQ,MAAM,sDAAuDa,CAAC,EAEtE,WAAW,IAAMH,EAAO,CAAC,EAAG,GAAI,GAGhC,QAAQ,MAAM,+DAAgEG,CAAC,CAEnF,CAAC,CACH,EAAGF,CAAK,EACRX,GAAgBY,CAClB,EAEIE,EAAW,KAAK,IAAI,EACpBC,EAAgB,YAAY,IAAI,EAKpCd,GAAW,YAAY,IAAM,CAC3B,IAAMe,EAAU,KAAK,IAAI,EACnBC,EAAe,YAAY,IAAI,EAClB,KAAK,IAAI,KAAK,IAAKD,EAAUF,CAAS,EAAI,KAAK,IAAKG,EAAeF,CAAc,CAAC,EAEpF,KACXf,IAAiB,MAAM,aAAaA,EAAa,EACrDA,GAAgB,KAChBU,EAAO,CAAC,GAEVI,EAAWE,EACXD,EAAgBE,CAClB,EAAG,GAAK,EAGRjB,GAAgB,KAChBU,EAAO,CAAC,CACV,EACA,iCAAkC,IAAM,CAClCV,KAAkB,SAChBC,IAAY,MAAM,cAAcA,EAAQ,EACxCD,IAAiB,MAAM,aAAaA,EAAa,EACrDC,GAAW,OACXD,GAAgB,OAEpB,EAKA,gBAAiB,UAAoB,CACnC,IAAMiB,EAAe,YAAY,IAAI,EAC/BD,EAAUlB,GAAWC,GAAgBkB,EAC3C,OAAO,KAAK,MAAMD,CAAO,CAC3B,CACF,CAAC,ECiEM,IAAME,GAAuB,iDAS7BC,GAASC,EAAI,yBAA0B,CAG5C,iBAAkB,UAAY,CAC5B,KAAK,OAAS,CAEZ,IAAI,eAAiB,CAAE,MAAM,IAAI,MAAM,oDAAoD,CAAE,EAE7F,IAAI,cAAeC,EAAO,CAAE,OAAO,eAAe,KAAM,gBAAiB,CAAE,MAAAA,EAAO,SAAU,EAAK,CAAC,CAAE,EACpG,cAAe,yBACf,UAAW,CACT,SAAU,CACR,QAAS,CAAC,EACV,eAAgB,CAAC,EACjB,eAAgB,CAAC,EACjB,iBAAkB,CAAC,EACnB,WAAY,EACd,EACA,UAAW,CAAC,EACZ,UAAW,CAAC,CACd,EACA,YAAcC,GAA4B,CAAC,CAAC,KAAK,mBAAmBA,CAAM,EAC1E,YAAa,CAACC,EAAKC,EAAKH,KAAYE,EAAIC,CAAG,EAAIH,EAAcA,GAC7D,MAAO,IAAII,IAAS,MAAM,GAAGA,CAAI,EACjC,YAAa,CAACF,EAAKC,IAAQ,CAAE,OAAOD,EAAIC,CAAG,CAAE,EAG7C,kBAAmB,GACnB,qBAAsB,GACtB,uBAAwB,GACxB,gBAAiB,GAIjB,iBAAkB,GAIlB,eAAgB,GAChB,kBAAmB,CACjB,WAAY,IACZ,mBAAoB,EACtB,EACA,MAAO,CACL,eAAgB,KAChB,gBAAiB,KACjB,aAAc,KACd,gBAAiB,KACjB,iBAAkB,KAClB,kBAAmB,KACnB,YAAa,IACf,EACA,yBAAAE,EACF,EAEA,KAAK,UAAY,OAAO,OAAO,IAAI,EACnC,KAAK,gBAAkB,IAAI,gBAC3B,KAAK,MAAQ,CACX,UAAW,CAAC,EACZ,QAAS,CAAC,CACZ,EACA,KAAK,mBAAqB,CAAC,EAC3B,KAAK,mBAAqB,CAAC,EAC3B,KAAK,aAAe,OAAO,OAAO,IAAI,EACtC,KAAK,mBAAqB,OAAO,OAAO,IAAI,EAC5C,KAAK,iBAAmB,OAAO,OAAO,IAAI,EAC1C,KAAK,gBAAmBC,GAAiC,CACvD,IAAIC,EAAQ,KAAK,iBAAiBD,CAAU,EAC5C,OAAKC,IACH,KAAK,iBAAiBD,CAAU,EAAIC,EAAQ,CAAC,GAExCA,CACT,EAWA,KAAK,cAAgB,CAACD,EAAoBH,EAAaK,IAAiB,CACtE,KAAK,mBAAmBF,CAAU,EAAI,KAAK,mBAAmBA,CAAU,GAAK,OAAO,OAAO,IAAI,EAC/F,KAAK,mBAAmBA,CAAU,EAAEH,CAAG,EAAIK,CAC7C,EACA,IAAMC,EAAkB,CAACC,EAAGC,IAAM,CAChC,GAAIC,EAAIF,EAAGC,CAAC,EAAG,OAAOD,EAAEC,CAAC,EACzB,IAAME,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC/C,GAAIc,GAAW,YAAcD,EAAIC,EAAU,WAAYF,CAAC,EAAG,CACzD,IAAMR,EAAMW,GAAeD,EAAU,WAAWF,CAAC,CAAC,EAClD,OAAAD,EAAEC,CAAC,EAAIR,EACAA,CACT,CACF,EACMY,EAAiBL,GAAM,CAC3B,IAAMG,EAAYd,EAAI,KAAK,OAAO,aAAa,EACzCiB,EAAY,OAAO,KAAKH,GAAW,YAAc,CAAC,CAAC,EACzD,OAAO,MAAM,KAAK,IAAI,IAAI,CAAC,GAAG,OAAO,KAAKH,CAAC,EAAG,GAAGM,CAAS,CAAC,CAAC,CAC9D,EACA,KAAK,oBAAsB,IAAI,MAAM,OAAO,OAAO,IAAI,EAAG,CACxD,IAAKP,EACL,QAASM,CACX,CAAC,EACD,KAAK,wBAA0B,OAAO,OAAO,IAAI,EAmBjD,KAAK,gBAAkB,IAAI,IAI3B,KAAK,QAAU,CAAC,CAClB,EACA,kBAAmB,UAAY,CAC7B,MAAO,CACL,GAAGE,GAAU,KAAK,MAAM,EACxB,MAAO,KAAK,OAAO,MACnB,YAAa,KAAK,OAAO,YACzB,YAAa,KAAK,OAAO,WAC3B,CACF,EACA,qBAAsB,eAAgBC,EAAgB,CAMpD,GALAC,GAAM,KAAK,OAAQD,CAAM,EAGzB,OAAO,OAAO,KAAK,OAAO,MAAOA,EAAO,OAAS,CAAC,CAAC,EAE/CA,EAAO,UAAW,CACpB,OAAO,OAAO,KAAK,OAAO,UAAU,SAAUA,EAAO,UAAU,UAAY,CAAC,CAAC,EAC7E,IAAME,EAAY,KAAK,OAAO,UAAU,UACxC,QAAQ,MAAM,mCAAoC,OAAO,KAAKA,CAAS,CAAC,EACxE,QAAWC,KAAgBD,EACzB,MAAMrB,EAAI,gCAAiCsB,EAAcD,EAAUC,CAAY,CAAC,CAEpF,CACIT,EAAIM,EAAQ,wBAAwB,IAClCA,EAAO,uBACT,KAAK,OAAO,yBAA4BI,GAAS,CAC/C,GAAI,CAACC,GAAgBD,CAAI,EACvB,MAAO,CACL,gBAAiB,KAAM,KAAAA,CACzB,CAEJ,EAEA,KAAK,OAAO,yBAA2BjB,GAG7C,EACA,iBAAkB,eAAgBmB,EAAUC,EAAe,CAErD,OAAOD,GAAa,YAAc,OAAOC,EAAkB,MAC7DA,EAAgBD,EAChBA,EAAW,QAET,KAAK,QACPzB,EAAI,gCAAgC,EAGtC,OAAO,KAAK,KAAK,kBAAkB,EAAE,QAAQ2B,GAAO,CAClD3B,EAAI,sCAAuC2B,CAAG,CAChD,CAAC,EACD,MAAM3B,EAAI,+BAA+B,EACzC,MAAMA,EAAI,wBAAwB,EAGlC,OAAO,KAAK,KAAK,kBAAkB,EAAE,QAAQ2B,GAAO,CAClD3B,EAAI,sCAAuC2B,CAAG,CAChD,CAAC,EACD,MAAM3B,EAAI,+BAA+B,EACzC,MAAMA,EAAI,wBAAwB,EAClC,IAAM4B,EAAS,MAAMF,IAAgB,EAE/BZ,EAAYd,EAAI,KAAK,OAAO,aAAa,EAE/C,KAAK,UAAY,OAAO,OAAO,IAAI,EACnC,KAAK,gBAAgB,MAAM,EAC3B,KAAK,gBAAkB,IAAI,gBAE3B6B,GAAoBf,EAAW,KAAK,OAAO,WAAW,EACtD,KAAK,OAAO,YAAYA,EAAW,YAAa,OAAO,OAAO,IAAI,CAAC,EACnEgB,GAAY,KAAK,uBAAuB,EACxC,KAAK,QAAQ,OAAO,CAAC,EACrBA,GAAY,KAAK,YAAY,EAC7BA,GAAY,KAAK,kBAAkB,EACnCA,GAAY,KAAK,gBAAgB,EACjC,IAAMC,EAAqB,MAAM,KAAK,KAAK,eAAe,EAC1D,YAAK,gBAAgB,MAAM,EAC3B/B,EAAI,mCAAmC,EACvCA,EAAI,wBAAyBgC,EAAc,EAC3ChC,EAAI,wBAAyBiC,GAAoB,MAAM,KAAK,KAAK,eAAe,EAAG,CAAE,MAAO,CAAC,EAAG,QAASF,CAAmB,CAAC,EACzH,KAAK,QACP/B,EAAI,iCAAiC,EAEnCyB,GACF,OAAO,QAAQA,CAAQ,EAAE,QAAQ,CAAC,CAACrB,EAAKH,CAAK,IAAM,CACjD,KAAK,OAAO,YAAYa,EAAWV,EAAKH,CAAK,CAC/C,CAAC,EAEI2B,CACT,EACA,2BAA4B,SAAUM,EAA2D,CAC/F,IAAMpB,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC1Cc,EAAU,YAAY,KAAK,OAAO,YAAYA,EAAW,aAAc,OAAO,OAAO,IAAI,CAAC,EAC/F,IAAIqB,EAAOD,EAAM,QAAQ,EACpBC,IACA,MAAM,QAAQA,CAAI,IAAGA,EAAO,CAACA,CAAI,GACtCA,EAAK,QAAQ,CAAC,CAAE,IAAA/B,EAAK,UAAAgC,CAAU,IAAM,CACnC,GAAI,CAAChC,EAAK,OACN,OAAOA,GAAQ,WACjBA,EAAMW,GAAeX,CAAG,GAE1B,IAAMiC,EAAKC,GAAMlC,CAAG,EAEfS,EAAI,KAAK,oBAAqBwB,CAAE,IACnC,KAAK,oBAAoBA,CAAE,EAAIjC,GAE7B,CAAAgC,IAECvB,EAAIC,EAAU,WAAYuB,CAAE,GAC/B,KAAK,OAAO,YAAYvB,EAAU,WAAYuB,EAAIE,GAAanC,EAAK,EAAI,CAAC,EAE7E,CAAC,EACH,EACA,oCAAqC,SAAUoC,EAAgB,CACzD,MAAM,QAAQA,CAAG,EACnBA,EAAI,QAASH,GAAO,CAClB,OAAO,KAAK,oBAAoBA,CAAE,CACpC,CAAC,EAED,OAAO,KAAK,KAAK,mBAAmB,EAAE,QAASA,GAAO,CACpD,OAAO,KAAK,oBAAoBA,CAAE,CACpC,CAAC,CAEL,EACA,yBAA0B,SAAUC,EAAeG,EAAsB,CACvE,GAAI,CAACA,GAAc5B,EAAI,KAAK,oBAAqByB,CAAK,EAAG,MAAO,GAChE,IAAMxB,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC/C,MAAO,CAAC,CAACc,GAAW,YAAcD,EAAIC,EAAU,WAAYwB,CAAK,CACnE,EACA,gCAAiC,SAAUI,EAAoC,CAC7E,OAAI,OAAOA,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAE1C,CAAC,CAACA,GAAmB,WAAW,OAAS,CAAC,CAACA,GAAmB,WAAW,SAClF,EACA,+CAAgD,SAAUA,EAAqCC,EAA+BC,EAA6B,CACzJ,OAAI,OAAOF,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAElC,OAAO,OAAOA,GAAmB,IAAI,gBAAkB,CAAC,CAAC,EAAE,KAAMG,GAEvEA,GAAG,MAAM,YAAY,WAAaA,EAAE,KAAK,WAAW,aAAeF,IAA0B,CAACC,GAAaC,EAAE,KAAK,WAAW,YAAcD,EACnJ,CAGH,EACA,yCAA0C,SAAUF,EAAoCI,EAA+BF,EAAqC,CACtJ,OAAOF,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAEjD,IAAMd,EAASc,EAAkB,WAAW,oBACxC,OAAQG,GACDA,IAAM,CAACC,GAAwBD,EAAE,aAAeC,KAA0B,CAACF,GAAaC,EAAE,YAAcD,EAChH,GACC,IAAI,CAAC,CAAE,KAAAG,CAAK,IAAMA,CAAI,EAE1B,OAAKnB,GAAQ,OACNA,EADqB,IAE9B,EACA,oDAAqD,SAAUc,EAAoCI,EAA+B,CAC5H,OAAOJ,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAEjD,IAAMM,EAAY,OAAO,OAAON,EAAkB,IAAI,WAAa,CAAC,CAAC,EACrE,GAAI,CAACM,GAAW,OAAQ,OACxB,IAAMpB,EAAS,OAAO,OAAO,IAAI,EAEjC,OAAAoB,EAAU,QAASC,GAA+E,CAC3FA,EAAG,UACJH,GAAwBG,EAAG,aAAeH,IACzClB,EAAOqB,EAAG,UAAU,IAAGrB,EAAOqB,EAAG,UAAU,EAAI,CAAC,GACrDrB,EAAOqB,EAAG,UAAU,EAAE,KAAK,CAAE,OAAQA,EAAG,OAAQ,KAAMA,EAAG,IAAK,CAAC,GACjE,CAAC,EACD,OAAO,KAAKrB,CAAM,EAAE,QAAQD,GAAO,CACjCC,EAAOD,CAAG,EAAE,KAAK,CAACuB,EAAGC,IACZA,EAAE,OAASD,EAAE,MACrB,CACH,CAAC,EACMtB,CACT,EACA,8CAA+C,SAAUc,EAAoCU,EAAmB,CAC9G,OAAI,OAAOV,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAG1C,CAAC,CAACW,GAAwBX,EADrBU,IAAc,IAAO,CAACA,CAAS,EAAIA,EACS,CAAC,KAAK,CAAC,CACjE,EAGA,mDAAoD,SAAUE,EAA0CZ,EAAoCU,EAAmB,CAC7J,IAAMtC,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC3C,OAAOsD,GAA4B,WACrCA,EAA0BxC,EAAUwC,CAAuB,GAEzD,OAAOZ,GAAsB,WAC/BA,EAAoB5B,EAAU4B,CAAiB,GAGjD,IAAMJ,EAAQe,GAAwBX,EAD1BU,IAAc,IAAO,CAACA,CAAS,EAAIA,EACc,CAAC,KAAK,CAAC,EAEpE,OAAOE,GAAyB,KAAK,cAAc,KAAMC,GAAOA,EAAG,KAAOjB,CAAK,CACjF,EACA,uCAAwC,SAAUI,EAAoCK,EAAcS,EAA4B,CAC1H,OAAOd,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAEjD,IAAMe,EAAeC,GAAgBhB,EAAmBK,CAAI,EAC5D,GAAI,EAAAS,GAAoB,CAACxD,EAAI,yBAA0ByD,CAAY,GAGnE,OAAOA,CACT,EACA,4CAA6C,SAAUf,EAAoCiB,EAA2B,CACpH,OAAI,OAAOjB,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAE1CkB,GAA4BlB,EAAmBiB,CAAiB,CACzE,EACA,2CAA4C,SAAUjB,EAAoCK,EAAc,CAClG,OAAOL,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAEjD,IAAMe,EAAeC,GAAgBhB,EAAmBK,CAAI,EACtDc,EAAgBC,GAAwBpB,EAAmBK,CAAI,EACrE,OAAOU,EAAe,CAACA,EAAc,GAAGI,CAAa,EAAIA,CAC3D,EACA,uCAAwC,SAAUnB,EAAoCqB,EAAaC,EAAUC,EAAWC,EAAgB,CACtI,OAAI,OAAOxB,GAAsB,WAE/BA,EADkB1C,EAAI,KAAK,OAAO,aAAa,EACjB0C,CAAiB,GAEnCW,GAAwBX,EAAmBqB,EAAaC,EAAUC,EAAWC,CAAc,CAE3G,EACA,4CAA6C,SAAU3D,EAAoB4D,EAAiB,CAE1F,IAAMC,EADYpE,EAAI,KAAK,OAAO,aAAa,EACvBO,CAAU,EAE7B6D,EAAM,WAAW,KAAK,OAAO,YAAYA,EAAO,YAAa,OAAO,OAAO,IAAI,CAAC,EAChFA,EAAM,UAAU,uBAAuB,KAAK,OAAO,YAAYA,EAAM,UAAW,wBAAyB,OAAO,OAAO,IAAI,CAAC,EAEjI,QAAWrB,KAAQoB,EAAO,CACxB,IAAM7B,EAAQoB,GAAgBU,EAAOrB,CAAI,EACrCT,EACF,KAAK,OAAO,YAAY8B,EAAM,UAAU,sBAAuB9B,EAAO,EAAI,EAE1E,QAAQ,KAAK,0DAA2D,CAAE,WAAA/B,EAAY,KAAAwC,CAAK,CAAC,CAEhG,CACF,EACA,sCAAuCxC,EAAoB,CACzD,OAAO8D,GAAgC,KAAK,KAAM9D,CAAU,CAC9D,EAMA,wBAA0B+D,GACjBhC,GAAMgC,EAAM,QAAQ,CAAC,EAG9B,mBAAoB,SAAUC,EAAU,CAAC,EAAW,CAClD,GAAI,CAAC,KAAK,OAAO,cAAe,MAAM,IAAI,MAAM,8BAA8B,EAC9E,GAAI,CAAC,KAAK,OAAO,kBAAmB,MAAM,IAAI,MAAM,kCAAkC,EAClF,KAAK,QACP,KAAK,OAAO,QAAQ,EAEtB,IAAIC,EAAY,KAAK,OAAO,cAM5B,OAAI,KAAK,QACPxE,EAAI,gCAAgC,EAEtCA,EAAI,iCAAiC,EACrC,KAAK,OAASyE,GAAaD,EAAW,CACpC,GAAG,KAAK,OAAO,kBACf,SAAU,CACR,GAAGD,EAAQ,SAGX,yBAA0B,SAAUG,EAAO,CACzC,GAAM,CAAE,UAAAC,CAAU,EAAID,EAAM,OAIxB,KAAK,gBAAgB,IAAIC,CAAS,GAKpC3E,EAAI,4BAA6B2E,EAAW,CAAE,MAAO,EAAK,CAAC,EAAE,MAAMC,GAAO,CACxE,QAAQ,KAAK,+BAA+BD,CAAS,YAAYC,EAAI,OAAO,EAAE,CAChF,CAAC,EAEHL,EAAQ,WAAW,wBAAwB,GAAG,KAAK,KAAMG,CAAK,CAChE,CACF,EAEA,gBAAiB,CACf,GAAI,OAAO,YACT,OAAO,QAAQH,EAAQ,iBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,CAACM,EAAGC,CAAC,IAAM,CAC5D,OAAQD,EAAG,CACT,KAAKE,GAAkB,IACrB,MAAO,CAACF,EAAIG,GAAQ,CAClB,GAAI,CAACA,EAAI,UAAW,CAClB,QAAQ,KAAK,mDAAmD,EAChE,MACF,CACA,GAAI,CAAC,KAAK,gBAAgB,IAAIA,EAAI,SAAS,EAAG,CAC5C,QAAQ,KAAK,uCAAuCA,EAAI,SAAS,kDAAkD,EACnH,MACF,CACAhF,EAAI,2BAA4BgF,EAAI,UAAW,IAAM,CAClDF,EAAa,KAAK,KAAK,OAAQG,GAAmC,KAAM,CACvE,WAAYD,EAAI,UAChB,eAAgBA,EAAI,IACtB,CAAC,CAAC,CACJ,CAAC,EAAE,MAAME,GAAK,CACZ,QAAQ,MAAM,6CAA6CF,EAAI,SAAS,GAAIE,CAAC,CAC/E,CAAC,CACH,CAAC,EACH,KAAKH,GAAkB,GACrB,MAAO,CAACF,EAAIG,GAAQ,CAClB,GAAI,CAACA,EAAI,WAAa,CAACA,EAAI,IAAK,CAC9B,QAAQ,KAAK,yDAAyD,EACtE,MACF,CACA,GAAI,CAAC,KAAK,gBAAgB,IAAIA,EAAI,SAAS,EAAG,CAC5C,QAAQ,KAAK,sCAAsCA,EAAI,SAAS,kDAAkD,EAClH,MACF,CACAhF,EAAI,2BAA4BgF,EAAI,UAAW,IAAM,CAClDF,EAAa,KAAK,KAAK,OAAQ,CAACE,EAAI,IAAKC,GAAmC,KAAM,CACjF,WAAYD,EAAI,UAChB,KAAMA,EAAI,IACV,eAAgB,KAAK,MAAM,OAAO,KAAKA,EAAI,IAAI,EAAE,SAAS,CAAC,CAC7D,CAAC,CAAC,CAAC,CACL,CAAC,EAAE,MAAME,GAAK,CACZ,QAAQ,MAAM,4CAA4CF,EAAI,SAAS,YAAYA,EAAI,GAAG,GAAIA,EAAKE,CAAC,CACtG,CAAC,CACH,CAAC,EACH,KAAKH,GAAkB,SACrB,MAAO,CAACF,EAAIG,GAASF,EAAa,KAAK,KAAK,OAAQE,EAAI,IAAI,CAAC,EAC/D,QACE,MAAO,CAACH,EAAGC,CAAC,CAChB,CACF,CAAC,CACH,EACA,CAACC,GAAkB,KAAK,EAAGC,EAAK,CAK9B,GAAM,CAAE,WAAAzE,CAAW,EAAI4E,EAAU,gBAAgBH,EAAI,IAAI,EACzDhF,EAAI,yCAA0CO,EAAYyE,EAAI,IAAI,CACpE,CACF,CACF,CAAC,EACI,KAAK,4BAER,KAAK,0BAA4B,IAAMhF,EAAI,wBAAwB,EACnEA,EAAI,sBAAuBiC,GAAoB,KAAK,yBAAyB,GAExE,KAAK,MACd,EAKA,uBAAwB,eAAgByC,EAAe,CACrD,GAAM,CAAE,WAAAnE,CAAW,EAAI4E,EAAU,gBAAgBT,CAAK,EACtD,OAAO,MAAM1E,EAAI,yCAA0CO,EAAYmE,CAAK,CAC9E,EACA,0BAA2B,SAAUU,EAAkB,CACrD,GAAI,CAACtF,GAAa,KAAKsF,EAAS,IAAI,EAAG,MAAM,IAAI,MAAM,sBAAsBA,EAAS,IAAI,EAAE,EACvFA,EAAS,WAAUA,EAAS,SAAW,CAAE,UAAY,CAAC,EAAG,OAAQ,KAAO,CAAC,EAAG,GAC5EA,EAAS,UAASA,EAAS,QAAU,CAAC,GAC3CA,EAAS,MAAS7E,GAAeP,EAAI,KAAK,OAAO,aAAa,EAAEO,CAAU,EAC1E6E,EAAS,SAAW,KAAK,oBACzBA,EAAS,IAAM,KAAK,eACpB,KAAK,qBAAuB,CAAC,EAC7B,KAAK,YAAcA,EACnB,KAAK,qBAAqB,KAAK,GAAGpF,EAAI,yBAA0B,CAE9D,CAAC,GAAGoF,EAAS,QAAQ,IAAIA,EAAS,IAAI,UAAU,EAAG,IAAMA,EAAS,QAGlE,CAAC,GAAGA,EAAS,QAAQ,IAAIA,EAAS,IAAI,iBAAiB,EAAG,CAAC7E,EAAoB8E,IAA2B,CAGxG,GAAM,CAACC,CAAG,EAAID,EACVC,EAAI,WAAWF,EAAS,KAAO,GAAG,IACpCC,EAAa,CAAC,EAAI,GAAGD,EAAS,QAAQ,IAAIE,CAAG,IAE/C,KAAK,gBAAgB/E,CAAU,EAAE,KAAK8E,CAAY,CACpD,CACF,CAAC,CAAC,EACF,QAAWnF,KAAUkF,EAAS,QAC5BG,GAAuBrF,CAAM,EAC7B,KAAK,mBAAmBA,CAAM,EAAI,GAOlC,KAAK,qBAAqB,KAAK,GAAGF,EAAI,yBAA0B,CAC9D,CAAC,GAAGoF,EAAS,QAAQ,IAAIlF,CAAM,UAAU,EAAG,MAAOsF,EAAiBpB,IAAkB,CACpF,GAAM,CAAE,KAAAqB,EAAM,KAAAlE,EAAM,WAAAhB,CAAW,EAAIiF,EAKnCpB,EAAQA,GAASgB,EAAS,MAAM7E,CAAU,EAC1C,IAAMmF,EAASC,GAAavB,EAAOgB,EAAS,OAAO,EAOnD,MAAMA,EAAS,SAAS,SAASK,EAAM,CAAE,MAAArB,EAAO,GAAGsB,EAAQ,WAAAnF,CAAW,CAAC,EAEvE,MAAM6E,EAAS,QAAQlF,CAAM,EAAE,SAASqB,EAAM,CAAE,MAAA6C,EAAO,GAAGsB,EAAQ,KAAAD,EAAM,QAAAD,EAAS,WAAAjF,CAAW,CAAC,EAG7F,KAAK,iBAAiBA,CAAU,EAAI,CAAC,EACrC,MAAM6E,EAAS,QAAQlF,CAAM,EAAE,QAAQsF,EAAS,CAAE,MAAApB,EAAO,GAAGsB,CAAO,CAAC,CACtE,EAEA,CAAC,GAAGN,EAAS,QAAQ,IAAIlF,CAAM,aAAa,EAAG,MAAO0F,EAAkBxB,IAAmB,CACzF,GAAIgB,EAAS,QAAQlF,CAAM,EAAE,WAAY,CAEvC,GADAkE,EAAQA,GAASgB,EAAS,MAAMQ,EAAS,UAAU,EAC/C,CAACxB,EAAO,CACV,QAAQ,KAAK,IAAIgB,EAAS,QAAQ,IAAIlF,CAAM,oFAAoF0F,EAAS,UAAU,EAAE,EACrJ,MACF,CAIA,IAAMC,EAAY3E,GAAUkD,CAAK,EAC3BsB,EAASC,GAAaE,EAAWT,EAAS,OAAO,EACvD,MAAMA,EAAS,QAAQlF,CAAM,EAAE,WAAW0F,EAAU,CAAE,MAAOC,EAAW,GAAGH,CAAO,CAAC,CACrF,CAGA,IAAMI,EAAc,KAAK,gBAAgBF,EAAS,UAAU,EAC5D,KAAOE,EAAY,OAAS,GAAG,CAC7B,IAAMC,EAAaD,EAAY,MAAM,EACrC,GAAI,CACF,MAAMV,EAAS,IAAI,GAAGW,CAAU,CAClC,OAASC,EAAI,CACX,IAAMd,EAAKc,EACX,cAAQ,MAAM,sBAAsBd,EAAE,IAAI,KAAKA,EAAE,OAAO,8BAA8BU,EAAS,WAAW,IAAKG,CAAU,EACzH,KAAK,iBAAiBH,EAAS,UAAU,EAAI,CAAC,EACxCV,CACR,CACF,CACF,CACF,CAAC,CAAC,EAEJ,QAAWe,KAAUb,EAAS,QAC5B,KAAK,qBAAqB,KAAK,GAAGpF,EAAI,yBAA0B,CAC9D,CAAC,GAAGoF,EAAS,QAAQ,IAAIa,CAAM,EAAE,EAAGb,EAAS,QAAQa,CAAM,CAC7D,CAAC,CAAC,EAEJjG,EAAI,wBAAyBkG,GAAqBd,CAAQ,CAC5D,EACA,2BAA4B,CAAC7E,EAAY4F,IA6BhCnG,EAAI,8BAA+BO,EAAY,CAAC,uBAAuB,CAAC,EAAE,KAAK,IAAMP,EAAI,8BAA+B,UAAYO,EAAY4F,CAAa,CAAC,EAEvK,iBAAkB,SAAUC,IAAgB,CAC1C,QAAWC,KAAcD,EACvB,MAAMpG,EAAI,GAAGqG,CAAU,CAE3B,EAGA,yBAA0B,UAAY,CACpC,IAAMC,EAAS,KAAK,OACdC,EAAgB,CAAC,GAAGD,EAAO,eAAe,EAC1CE,EAAa,MAAM,KAAK,KAAK,eAAe,EAC5CC,EAAkBC,GAAaH,EAAeC,CAAU,EACxDG,EAAgBC,GAAWL,EAAeE,CAAe,EACzDI,EAAcD,GAAWJ,EAAYC,CAAe,EAE1D,GAAI,CACF,QAAWlG,KAAcoG,EACvBL,EAAO,MAAM/F,CAAU,EAEzB,QAAWA,KAAcsG,EACvBP,EAAO,IAAI/F,CAAU,CAEzB,OAAS2E,EAAG,CACV,QAAQ,MAAM,mCAAmCA,EAAE,IAAI,KAAKA,EAAE,OAAO,GAAI,CAAE,cAAAyB,EAAe,YAAAE,CAAY,EAAG3B,CAAC,EAC1G,KAAK,OAAO,MAAM,cAAcA,EAAGoB,CAAM,CAC3C,CACF,EAEA,yBAA0B,SAAUQ,EAA6C,CAC/E,IAAMC,EAAYD,EACb,OAAOA,GAAgB,SAAW,CAACA,CAAW,EAAIA,EACnD,OAAO,KAAK9G,EAAI,KAAK,OAAO,aAAa,EAAE,SAAS,EACxD,OAAO,QAAQ,IAAI+G,EAAU,QAAQpF,GAC5B3B,EAAI,2BAA4B2B,EAAK,CAAC,uBAAuB,CAAC,CACtE,CAAC,CACJ,EAEA,gCAAiC,SAAUmF,EAA6C,CACtF,IAAMC,EAAYD,EACb,OAAOA,GAAgB,SAAW,CAACA,CAAW,EAAIA,EACnD,OAAO,KAAK9G,EAAI,KAAK,OAAO,aAAa,EAAE,SAAS,EACxD,OAAO,QAAQ,IAAI+G,EAAU,QAAQpF,GAC5B3B,EAAI,8BAA+B,WAAW2B,CAAG,GAAI,CAAC,uBAAuB,CAAC,CACtF,CAAC,CACJ,EAIA,yBAA0B,eAAgBmF,EAAgCE,EAA2C,CAKnH,IAAMD,EAAY,OAAOD,GAAgB,SAAW,CAACA,CAAW,EAAIA,EAEpE,OAAAC,EAAU,QAAS1E,GAAO,CACxB,GAAI4E,GAA2B,KAAK,KAAM5E,CAAE,EAI1C,cAAQ,MAAM,mDAAqDA,CAAE,EAC/D,IAAI,MAAM,sCAAsC,CAE1D,CAAC,EAGMrC,EAAI,4BAA6B+G,EAAW,CAAE,GAAGC,EAAQ,MAAO,EAAK,CAAC,CAC/E,EACA,8BAA+B,SAAUzG,EAAoB,CAAE,UAAA2G,EAAY,EAAM,EAAI,CAAC,EAAY,CAChG,IAAMC,EAAY,CAAC,CAAC,KAAK,aAAa5G,CAAU,EAChD,OAAO2G,EACHC,GAAa,KAAK,aAAa5G,CAAU,EAAE,UAC3C4G,CACN,EACA,iCAAkC,UAAY,CAC5C,OAAO,OAAO,KAAK,KAAK,YAAY,CACtC,EAMA,2BAA4B,SAC1BL,EACA,CAAE,uBAAAM,EAAwB,UAAAC,CAAU,EAGhC,CAAC,EACO,CACZ,IAAMvG,EAAYd,EAAI,KAAK,OAAO,aAAa,EACzC+G,EAAY,OAAOD,GAAgB,SAAW,CAACA,CAAW,EAAIA,EACpE,OAAO,QAAQ,IAAIC,EAAU,IAAIxG,GAAc,CAC7C,GAAKO,GAAW,YAAYP,CAAU,EAItC,OAAOP,EAAI,8BAA+BO,EAAY,IAAM,CAM1D,GAAI6G,GAA0B,CAACA,EAAuB7G,CAAU,EAC9D,OAEF,IAAMO,EAAYd,EAAI,KAAK,OAAO,aAAa,EACzCsH,EAAgB,MAAM,KAAK,IAAI,IAAI,OAAO,OAAOxG,EAAUP,CAAU,GAAG,KAAK,gBAAkB,CAAC,CAAC,EAAE,OAAQsE,GACxG,CAAC,CAAEA,EAAQ,UACnB,EAAE,IAAKA,GAAM,CACZ,GAAI,CAEF,OADc,IAAI,IAAKA,EAAQ,UAAU,EAC5B,QACf,MAAQ,CACN,MACF,CACF,CAAC,EAAE,OAAO,OAAO,CAAC,CAAC,EAEnB7E,EAAI,qCAAsCO,EAAY,CAAE,UAAA8G,CAAU,CAAC,EAE/DC,EAAc,QAGhBtH,EAAI,4BAA6BsH,EAAe,CAAE,IAAK,EAAK,CAAC,EAAE,MAAOpC,GAAM,CAC1E,QAAQ,MAAM,+DAAgEA,CAAC,CACjF,CAAC,CAEL,CAAC,CACH,CAAC,CAAC,CACJ,EACA,2BAA4B,eAAgB4B,EAAgCE,EAA6C,CACvH,IAAMD,EAAY,OAAOD,GAAgB,SAAW,CAACA,CAAW,EAAIA,EAC9DhG,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC/C,GAAI+G,EAAU,SAAW,EAAG,OAAO,QAAQ,QAAQ,EACnD,IAAMQ,EAAkBlF,GAAO,CAE7B,GAAIvB,EAAU,UAAUuB,CAAE,IAAM,KAC9B,cAAQ,MAAM,6EAA8EA,CAAE,EACxF,IAAImF,GAAsB,iDAAmDnF,CAAE,CAEzF,EACA,OAAK2E,GAAQ,UASXD,EAAU,QAAS1E,GAAO,CACxBkF,EAAelF,CAAE,EACZxB,EAAI,KAAK,wBAAyBwB,CAAE,EAGvC,KAAK,wBAAwBA,CAAE,EAAI,KAAK,wBAAwBA,CAAE,EAAI,EAFtE,KAAK,wBAAwBA,CAAE,EAAI,CAIvC,CAAC,EAfD0E,EAAU,QAAS1E,GAAO,CACxBkF,EAAelF,CAAE,EACZxB,EAAIC,EAAU,UAAWuB,CAAE,GAC9B,KAAK,OAAO,YAAYvB,EAAU,UAAWuB,EAAI,OAAO,OAAO,IAAI,CAAC,EAEtE,KAAK,OAAO,YAAYvB,EAAU,UAAUuB,CAAE,EAAG,cAAevB,EAAU,UAAUuB,CAAE,EAAE,YAAc,GAAK,CAAC,CAC9G,CAAC,EAWI,MAAMrC,EAAI,4BAA6B+G,CAAS,CACzD,EAOA,4BAA6B,eAAgBD,EAAgCE,EAA6D,CACxI,IAAMD,EAAY,OAAOD,GAAgB,SAAW,CAACA,CAAW,EAAIA,EAC9DhG,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC1CgH,GAAQ,MACNA,GAAQ,UAgCXD,EAAU,QAAS1E,GAAO,CAExB,GAAIvB,EAAU,UAAUuB,CAAE,IAAM,KAAM,CACpC,QAAQ,KAAK,mGAAoGA,CAAE,EACnH,MACF,CACA,GAAIxB,EAAI,KAAK,wBAAyBwB,CAAE,EAAG,CACzC,IAAMoF,EAAU,KAAK,wBAAwBpF,CAAE,GAAK,EAChDoF,GAAW,EACb,OAAO,KAAK,wBAAwBpF,CAAE,EAEtC,KAAK,wBAAwBA,CAAE,EAAIoF,EAAU,CAEjD,KACE,eAAQ,MAAM,6EAA8EpF,CAAE,EAKxF,IAAI,MAAM,4CAA4C,CAEhE,CAAC,EApDD0E,EAAU,QAAS1E,GAAO,CAExB,GAAIvB,EAAU,UAAUuB,CAAE,IAAM,KAAM,CACpC,QAAQ,KAAK,mGAAoGA,CAAE,EACnH,MACF,CACA,GAAIxB,EAAIC,EAAU,UAAWuB,CAAE,GAAKxB,EAAIC,EAAU,UAAUuB,CAAE,EAAG,YAAY,EAAG,CAC9E,IAAMoF,EAAU3G,EAAU,UAAUuB,CAAE,EAAE,WACxC,GAAIoF,IAAY,EACd,cAAQ,MAAM,mEAAoEpF,CAAE,EAK9E,IAAI,MAAM,kCAAkC,EAEhDoF,GAAW,EACb,KAAK,OAAO,YAAY3G,EAAU,UAAUuB,CAAE,EAAG,YAAY,EAE7D,KAAK,OAAO,YAAYvB,EAAU,UAAUuB,CAAE,EAAG,aAAcoF,EAAU,CAAC,CAE9E,KACE,eAAQ,MAAM,mEAAoEpF,CAAE,EAK9E,IAAI,MAAM,kCAAkC,CAEtD,CAAC,GA8BL,IAAMqF,EAAkCT,GAA2B,KAAK,IAAI,EACtEU,EAAcZ,EAAU,OAAOW,CAA+B,EACpE,OAAOC,EAAY,OAAS,MAAM3H,EAAI,2BAA4B2H,EAAa,CAAE,uBAAwBD,CAAgC,CAAC,EAAI,MAChJ,EACA,+BAAgC,eAAgBnH,EAAYqH,EAAwB,CAElF,IAAMC,EADQ7H,EAAI,KAAK,OAAO,aAAa,EACfO,CAAU,EAEhCuH,EAAS,OAAO,OAAOD,EAAc,IAAI,cAAc,EAAE,OAAQhD,GAE9DA,EAAE,iBAAmB,MAAQA,EAAE,MAAM,YAAY,aAAe+C,CACxE,EAAE,IAAI/C,GAAMA,EAAQ,EAAE,EAEvB,GAAKiD,EAAO,OAEZ,OAAO,MAAM9H,EAAI,sBAAuB,CACtC,WAAAO,EACA,aAAcsH,EAAc,IAAI,KAChC,KAAMC,EACN,aAAczE,GAAwBwE,EAAe,CAAC1C,EAAU,UAAU,EAAG,CAAC,KAAK,CAAC,CACtF,CAAC,CACH,EACA,6BAA8B,SAAU4C,EAAyC3D,EAAe,CAC9F,IAAMyB,EAAY3E,GAAUkD,CAAK,EAC3BoB,EAAU,OAAOuC,GAAwB,SAAW5C,EAAU,YAAY4C,EAAqB,KAAK,oBAAqBlC,EAAW,KAAK,OAAO,wBAAwB,EAAIkC,EAClL,OAAO/H,EAAI,qCAAsCwF,EAASK,CAAS,EAAE,KAAK,IAAMA,CAAS,EAAE,MAAOX,IAChG,QAAQ,KAAK,kDAAkDM,EAAQ,YAAY,CAAC,KAAKA,EAAQ,UAAU,CAAC,GAAIN,CAAC,EAC1Gd,EACR,CACH,EACA,6BAA8B,eAAgB4D,EAAa,CAAE,KAAAC,CAAK,EAAuB,CAAC,EAAG,CAC3F,IAAMC,EAAYC,GAASH,CAAG,EAC9B,GAAIC,GAAQ,MACNC,EAAU,OAASD,EACrB,MAAM,IAAI,MAAM,sCAAsCA,CAAI,SAASC,EAAU,IAAI,EAAE,EAKvF,IAAME,EAAQ,MAAMpI,EAAI,kBAAmBgI,CAAG,EAE9C,GAAII,GAAS,KAAM,OAAOA,EAC1B,IAAMC,EAAM,GAAG,KAAK,OAAO,aAAa,SAASL,CAAG,GAC9CzG,EAAO,MAAM,KAAK,OAAO,MAAM8G,EAAK,CAAE,OAAQ,KAAK,gBAAgB,MAAO,CAAC,EAAE,KAAKC,GAAkB,MAAM,CAAC,EAC3GC,EAAUC,GAAUjH,EAAM2G,EAAU,IAAI,EAC9C,GAAIK,IAAYP,EACd,MAAM,IAAI,MAAM,iBAAiBA,CAAG,UAAUO,CAAO,EAAE,EAEzD,aAAMvI,EAAI,kBAAmBgI,EAAKzG,CAAI,EAC/BA,CACT,EACA,8BAA+B,SAAUhB,EAAoB,CAC3D,OAAO,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,mBAAmBA,CAAU,GAAI,CACpF,MAAO,WACP,OAAQ,KAAK,gBAAgB,MAC/B,CAAC,EAAE,KAAK+H,GAAkB,MAAM,CAAC,CACnC,EACA,2BAA4BG,GAC5B,4BAA6B,SAAUlI,EAAoBmI,EAAsBC,EAAepE,EAAS,CACnGoE,GAAS,GACX,QAAQ,MAAM,uEAAuE,EAEvF,IAAMC,EAAS,KAAK,IAAI,EAAGF,EAAeC,EAAQ,CAAC,EAC7CE,EAAmB,KAAK,IAAIH,EAAe,EAAGC,CAAK,EACzD,OAAO3I,EAAI,2BAA4BO,EAAYqI,EAAQC,EAAkB,OAAWtE,CAAO,CACjG,EACA,6BAA8B,SAAUhE,EAAoBuI,EAAmBC,EAAmBH,EAAiB,EAAG,CAAE,OAAAI,CAAO,EAAI,CAAE,OAAQ,EAAK,EAAG,CACnJ,GAAIJ,EAAS,EAAG,CACd,QAAQ,MAAM,gFAAgF,EAC9F,MACF,CACA,IAAIK,EACE,EAAI,IAAI,eAAe,CAC3B,MAAO,MAAOC,GAAe,CAC3B,IAAMC,EAAQ,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,SAASL,CAAS,GAAI,CAAE,OAAQ,KAAK,gBAAgB,MAAO,CAAC,EAAE,KAAKR,GAAkB,MAAM,CAAC,EACzJc,EAAmBjE,EAAU,gBAAgBgE,CAAK,EACxD,GAAIC,EAAiB,aAAe7I,EAAY,CAC9C2I,EAAW,MAAM,IAAI,MAAM,oDAAoD,CAAC,EAChF,MACF,CACA,IAAMG,EAAc,KAAK,IAAI,EAAGD,EAAiB,KAAK,OAASR,CAAM,EAC/DD,EAAQI,EAAYM,EAAc,EACxC,GAAIV,EAAQ,EAAG,CACbO,EAAW,MAAM,EACjB,MACF,CACAD,EAASjJ,EAAI,2BAA4BO,EAAY8I,EAAaV,CAAK,EAAE,UAAU,CACrF,EACA,MAAM,KAAMO,EAAY,CACtB,GAAM,CAAE,KAAAI,EAAM,MAAArJ,CAAM,EAAI,MAAMgJ,EAAO,KAAK,EACtCK,EACFJ,EAAW,MAAM,EAEjBA,EAAW,QAAQjJ,CAAK,CAE5B,CACF,CAAC,EAED,OAAI+I,EAAe,EAEZO,GAAmB,CAAC,CAC7B,EACA,qBAAsB,UAAY,CAAE,OAAOvJ,EAAI,KAAK,OAAO,aAAa,CAAE,EAC1E,+BAAgC,eAAgBO,EAAoBgE,EAAU,CAAE,UAAW,EAAM,EAAG,CAClG,IAAMzD,EAAYd,EAAI,KAAK,OAAO,aAAa,EAG/C,GAAIc,EAAU,UAAUP,CAAU,IAAM,KACtC,MAAM,IAAIiH,GAAsB,gCAAkCjH,CAAU,EAE9E,GAAI,CAACgE,EAAQ,WAAazD,EAAUP,CAAU,GAAK,OAAO,KAAKO,EAAUP,CAAU,CAAC,EAAE,KAAMiJ,GAAMA,IAAM,WAAW,EACjH,OAAOtI,GAAUJ,EAAUP,CAAU,CAAC,EAExC,IAAI6D,EAAQ,OAAO,OAAO,IAAI,EAC1B9C,EAAeR,EAAU,UAAUP,CAAU,GAAG,KAE9CkJ,EADezJ,EAAI,2BAA4BO,EAAY,EAAG,OAAWA,CAAU,EACjD,UAAU,EAElD,IADIO,EAAUP,CAAU,IAAG6D,EAAM,UAAYtD,EAAUP,CAAU,EAAE,aAC1D,CACP,GAAM,CAAE,MAAOmE,EAAO,KAAA4E,CAAK,EAAI,MAAMG,EAAmB,KAAK,EAC7D,GAAIH,EAAM,OAAOlF,EACjB,IAAMyB,EAAY3E,GAAUkD,CAAK,EACjC,GAAI,CACF,MAAMpE,EAAI,qCAAsCmF,EAAU,YAAYT,EAAO,KAAK,oBAAqBN,EAAO,KAAK,OAAO,wBAAwB,EAAGA,EAAO,OAAW9C,CAAY,EAC/K,CAACA,GAAgB8C,EAAM,MACzB9C,EAAe8C,EAAM,IAAI,KAE7B,OAASc,EAAG,CAEV,GADA,QAAQ,KAAK,oCAAoCA,EAAE,IAAI,MAAMA,EAAE,OAAO,eAAgBR,EAAOQ,EAAE,KAAK,EAChGA,aAAawE,GAAwB,MAAMxE,EAC/Cd,EAAQyB,CACV,CACF,CACF,EACA,0BAA2B,SAAUtF,EAAoBoJ,EAAiB,CACxE,IAAMvF,EAAQpE,EAAI,KAAK,OAAO,aAAa,EAAEO,CAAU,EACjDsF,EAAYzB,GAASlD,GAAUkD,CAAK,EAC1C,OAAIyB,GAAW,KAAO8D,GAAU,MAE9B,OAAO,KAAK9D,EAAU,IAAI,cAAc,EAAE,QAAQvD,GAAS,CACrDuD,EAAU,IAAI,eAAevD,CAAK,EAAE,iBAAmBqH,GACzD,OAAO9D,EAAU,IAAI,eAAevD,CAAK,CAE7C,CAAC,EAEIuD,CACT,EACA,8BAA+B,SAAUtF,EAA+B,CACtE,IAAMO,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC/C,OAAI,MAAM,QAAQO,CAAU,EACnB,OAAO,YAAYA,EAAW,IAAIA,GAChC,CACLA,EACA,CACE,cAAeO,EAAUP,CAAU,EACnC,cAAeO,EAAU,UAAUP,CAAU,CAC/C,CACF,CACD,CAAC,EAEG,CACL,cAAeO,EAAUP,CAAU,EACnC,cAAeO,EAAU,UAAUP,CAAU,CAC/C,CACF,EAEA,gCAAiC,eAAgByG,EAAuB,CACtE,GAAM,CAAE,aAAA1F,EAAc,KAAAa,EAAM,MAAAyH,EAAO,eAAAC,EAAgB,aAAAC,EAAc,mBAAAC,EAAoB,sBAAAC,CAAsB,EAAIhD,EACzGiD,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAEjE,GAAI,CADiB,KAAK,mBAAmB2I,CAAY,EACtC,MAAM,IAAI,MAAM,yBAAyB3I,CAAY,EAAE,EAC1E,IAAM4I,EAAa,KAAK,oBAAoBJ,CAAY,EACxD,GAAI,CAACI,EAAY,MAAM,IAAI,MAAM,eAAeJ,CAAY,iBAAiB,EAC7E,IAAMK,EAAW,CACf,KAAM7I,EACN,KAAMa,CACR,EACMiI,EAAcjF,EAAU,WAAW,CACvC,WAAY,KACZ,OAAQ,EACR,GAAI,CACFA,EAAU,YACVkF,GAA6BH,EAAYC,CAAO,CAClD,EACA,SAAUF,CACZ,CAAC,EACK1J,EAAa6J,EAAY,KAAK,EACpC,aAAMpK,EAAI,oCAAqCoK,EAAcpD,EAAO,sBAChE,CACE,GAAG6C,EACH,QAAS,CACP,GAAGA,GAAgB,QACnB,iCAAkC7C,EAAO,qBAC3C,CACF,EACA6C,EAAiBD,GAAS,CAC5B,WAAYA,EAAM,mBAClB,YAAaA,EAAM,mBACrB,CAAC,EACD,MAAM5J,EAAI,4BAA6BO,CAAU,EACrC,MAAMP,EAAIgK,EAClB,+BACA,iCAAkC,CACpC,OAAQ1I,EACR,WAAAf,EACA,KAAMyG,EAAO,KACb,aAAc+C,GAAsBD,EACpC,gBAAiBE,EACjB,MAAAJ,EACA,eAAAC,CACF,CAAC,CAEH,EACA,4BAA6B,eAAgBtJ,EAAoB,CAC/D,GAAI,CAACA,EACH,MAAM,IAAI,UAAU,gCAAgC,EAGtD,IAAM+J,EAAW,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,gBAAiB,CACpF,OAAQ,MACR,OAAQ,KAAK,gBAAgB,OAC7B,QAAS,IAAI,QAAQ,CACnB,CACE,gBACAjG,GAAgC,KAAK,KAAM9D,CAAU,CACvD,CACF,CAAC,CACH,CAAC,EACD,GAAI,CAAC+J,EAAS,GACZ,cAAQ,MAAM,gCAAiC/J,EAAY+J,EAAS,MAAM,EACpE,IAAI,MAAM,qCAAqC/J,CAAU,KAAK+J,EAAS,MAAM,EAAE,EAGvF,OAAOA,EAAS,KAAK,CACvB,EACA,8BAA+B,eAC7B/J,EACAgK,EAEI,CAAC,EACL,CACA,GAAI,CAAChK,EACH,MAAM,IAAI,UAAU,gCAAgC,EAEtD,OAAK,MAAM,QAAQA,CAAU,IAAGA,EAAa,CAACA,CAAU,GACjD,MAAM,QAAQ,WAAWA,EAAW,IAAI,MAAOyH,GAAQ,CAC5D,IAAMwC,EAAgB3J,EAAI0J,EAAavC,CAAG,EACpCyC,EAAW5J,EAAI0J,EAAYvC,CAAG,EAAG,OAAO,GAAKuC,EAAYvC,CAAG,EAAE,MAC9D0C,EAAwB7J,EAAI0J,EAAYvC,CAAG,EAAG,oBAAoB,GAAKuC,EAAYvC,CAAG,EAAE,mBAC9F,GAAI,CAACwC,GAAiBC,IAAaC,EACjC,MAAM,IAAI,UAAU,iEAAiE1C,CAAG,EAAE,EAG5F,IAAMsC,EAAW,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,mBAAmBtC,CAAG,GAAI,CAC7F,OAAQ,OACR,OAAQ,KAAK,gBAAgB,OAC7B,QAAS,IAAI,QAAQ,CACnB,CAAC,gBACCyC,EAEI,UAAWF,EAAYvC,CAAG,EAAE,MAAY,QAAQ,CAAC,GAGjD3D,GAAgC,KAAK,KAAMkG,EAAYvC,CAAG,EAAE,kBAAkB,CAAC,CACvF,CAAC,CACH,CAAC,EACD,GAAI,CAACsC,EAAS,GAAI,CAChB,GAAIA,EAAS,SAAW,KAAOA,EAAS,SAAW,IAAK,CACtD,QAAQ,KAAK,gDAAiDtC,EAAKsC,EAAS,MAAM,EAClF,MACF,CACA,cAAQ,MAAM,4BAA6BtC,EAAKsC,EAAS,MAAM,EACzD,IAAI,MAAM,6BAA6BtC,CAAG,KAAKsC,EAAS,MAAM,EAAE,CACxE,CACF,CAAC,CAAC,CACJ,EAGA,+BAAgC,SAAUtD,EAA8C,CACtF,OAAO2D,GAAgC,KAAK,KAAMxF,EAAU,oBAAqB6B,CAAM,CACzF,EACA,iCAAkC,SAAUA,EAA8C,CACxF,OAAO2D,GAAgC,KAAK,KAAMxF,EAAU,sBAAuB6B,CAAM,CAC3F,EACA,wBAAyB,eAAgBA,EAAgD,CACvF,GAAM,CAAE,OAAA4D,EAAQ,wBAAAC,EAAyB,sBAAAC,EAAuB,aAAAxJ,EAAc,WAAAf,EAAY,KAAAgB,EAAM,MAAAqI,EAAO,eAAAC,CAAe,EAAI7C,EACpH+D,EAA0B,KAAK,OAAO,UAAU,UAAUF,CAAuB,EACjFG,EAA0B,KAAK,OAAO,UAAU,UAAU1J,CAAY,EACtE2J,EAAsBH,EAAwB,KAAK,mBAAmBC,CAAuB,GAAG,SAAW,OAC3GG,EAAsB,KAAK,mBAAmBF,CAAuB,GAAG,SAE9E,GAAKF,GAAyB,CAACG,GAAwB,CAACC,EACtD,MAAM,IAAI,MAAM,yBAAyB,EAG3C,IAAMf,EAAW5I,EAEjB,GAAI,CAACyF,EAAO,cAAgB,CAACA,EAAO,WAClC,MAAM,IAAI,UAAU,qDAAqD,EAG3E,IAAIhC,EAAMG,EAAU,WAAW,CAC7B,WAAA5E,EACA,GAAI,CACF4E,EAAU,aACV6B,EAAO,aACHmE,GAAmB5K,EAAYyG,EAAO,aAAcmD,EAAS,KAAK,mBAAmB,EAErFE,GAA6BrD,EAAO,WAAYmD,CAAO,CAC7D,EACA,SAAUa,CACZ,CAAC,EACD,OAAKJ,IACH5F,EAAM,MAAMhF,EAAI,oCAAqCgF,EAAK6E,EAAgBD,CAAK,GAE1E5E,CACT,EACA,sBAAuB,eAAgBgC,EAAqD,CAG1F,GAAM,CAAE,OAAA4D,EAAQ,WAAArK,EAAY,aAAAe,EAAc,KAAAC,EAAM,MAAAqI,EAAO,eAAAC,CAAe,EAAI7C,EACpEiD,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAC3D8D,EAAW,KAAK,mBAAmB6E,CAAY,GAAG,SACxD,GAAI,CAAC7E,EACH,MAAM,IAAI,MAAM,yBAAyB,EAE3C,IAAMhB,EAAQgB,EAAS,MAAM7E,CAAU,EAEjC4J,EAAW5I,EAAkB,OAAQ6J,GAAO,CAChD,IAAMvG,EAAOrD,GAAgB4J,CAAE,EAAIA,EAAG,QAAQ,EAAIA,EAClD,MAAI,EAAAvK,EAAIuD,EAAM,IAAI,eAAgBS,EAAE,EAAE,GAChCT,EAAM,IAAI,eAAeS,EAAE,EAAE,EAAE,iBAAmB,KAO1D,CAAC,EACD,GAAIsF,EAAQ,SAAW,EAAG,OAC1B,IAAInF,EAAMG,EAAU,WAAW,CAC7B,WAAA5E,EACA,GAAI,CACF4E,EAAU,WACVgG,GAAmB5K,EAAYyG,EAAO,aAAcmD,EAAS,KAAK,mBAAmB,CACvF,EACA,SAAUF,CACZ,CAAC,EACD,OAAKW,IACH5F,EAAM,MAAMhF,EAAI,oCAAqCgF,EAAK6E,EAAgBD,CAAK,GAE1E5E,CACT,EACA,sBAAuB,eAAgBgC,EAA8C,CACnF,GAAM,CAAE,OAAA4D,EAAQ,WAAArK,EAAY,aAAAe,EAAc,KAAAC,EAAM,MAAAqI,EAAO,eAAAC,CAAe,EAAI7C,EACpEiD,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAC3D8D,EAAW,KAAK,mBAAmB6E,CAAY,GAAG,SACxD,GAAI,CAAC7E,EACH,MAAM,IAAI,MAAM,yBAAyB,EAE3C,IAAMhB,EAAQgB,EAAS,MAAM7E,CAAU,EACjC4J,EAAW5I,EAAkB,IAAKe,GAAU,CAChD,GAAId,GAAgBc,CAAK,EAAG,OAAOA,EAEnC,GAAI,GAACzB,EAAIuD,EAAM,IAAI,eAAgB9B,CAAK,GAAK8B,EAAM,IAAI,eAAe9B,CAAK,EAAE,iBAAmB,MAChG,OAAI8B,EAAM,IAAI,eAAe9B,CAAK,EAAE,SAC3B+I,GAAsB9K,EAAY6D,EAAM,IAAI,eAAe9B,CAAK,EAAE,SAAUA,CAAK,EAEjFA,CAEX,CAAC,EAAE,OAAO,OAAO,EACb0C,EAAMG,EAAU,WAAW,CAC7B,WAAA5E,EACA,GAAI,CACF4E,EAAU,WACVgG,GAAmB5K,EAAYyG,EAAO,aAAemD,EAAe,KAAK,mBAAmB,CAC9F,EACA,SAAUF,CACZ,CAAC,EACD,OAAKW,IACH5F,EAAM,MAAMhF,EAAI,oCAAqCgF,EAAK6E,EAAgBD,CAAK,GAE1E5E,CACT,EACA,yBAA0B,eAAgBgC,EAAiD,CACzF,GAAM,CAAE,OAAA4D,EAAQ,WAAArK,EAAY,aAAAe,EAAc,KAAAC,EAAM,MAAAqI,EAAO,eAAAC,CAAe,EAAI7C,EACpEiD,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAC3D8D,EAAW,KAAK,mBAAmB6E,CAAY,GAAG,SACxD,GAAI,CAAC7E,EACH,MAAM,IAAI,MAAM,yBAAyB,EAE3C,IAAMhB,EAAQgB,EAAS,MAAM7E,CAAU,EACjC4J,EAAW5I,EAAqB,IAAKnB,GAAQ,CACjD,GAAIoB,GAAgBpB,CAAG,EAAG,OAAOA,EAEjC,GAAM,CAAE,SAAAkL,CAAS,EAAIlL,EACrB,OAAIgE,EAAM,IAAI,eAAekH,CAAQ,EAAE,SAC9BD,GAAsB9K,EAAY6D,EAAM,IAAI,eAAekH,CAAQ,EAAE,SAAUlL,CAAG,EAElFA,CAEX,CAAC,EACG4E,EAAMG,EAAU,WAAW,CAC7B,WAAA5E,EACA,GAAI,CACF4E,EAAU,cACVgG,GAAmB5K,EAAYyG,EAAO,aAAemD,EAAe,KAAK,mBAAmB,CAC9F,EACA,SAAUF,CACZ,CAAC,EACD,OAAKW,IACH5F,EAAM,MAAMhF,EAAI,oCAAqCgF,EAAK6E,EAAgBD,CAAK,GAE1E5E,CACT,EACA,0BAA2B,eAAgBgC,EAAmD,CAC5F,GAAM,CAAE,sBAAA8D,EAAuB,wBAAAD,EAAyB,WAAAtK,EAAY,aAAAe,EAAc,MAAAsI,EAAO,eAAAC,EAAgB,kBAAA0B,EAAmB,gBAAAC,EAAiB,qBAAAC,EAAsB,0BAAAC,EAA2B,UAAA9I,CAAU,EAAIoE,EAKtMiD,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAC3DyJ,EAA0B,KAAK,OAAO,UAAU,UAAUF,CAAuB,EACjFzF,EAAW,KAAK,mBAAmB6E,CAAY,GAAG,SAClDgB,EAAsB,KAAK,mBAAmBF,CAAuB,GAAG,SAC9E,GAAI,CAAC3F,EACH,MAAM,IAAI,MAAM,yBAAyB,EAE3C,IAAMtE,EAAYd,EAAI,KAAK,OAAO,aAAa,EAC/C,GAAI,CACF,MAAMA,EAAI,2BAA4BO,EAAY,CAAE,UAAW,EAAK,CAAC,EACrE,IAAM6D,EAAQgB,EAAS,MAAM7E,CAAU,EACjCoL,EAAmBV,EAAoB,MAAMH,CAAqB,EAQxE,GAN8B,OAAO,OAAOa,EAAiB,IAAI,cAAc,EAAE,UAAW9G,IAEnFA,GAAE,iBAAmB,MAAQA,GAAE,MAAM,YAAY,aAAetE,GAAc6D,GAAO,WAAW,oBAAoB,KAAKwH,IAAOA,GAAI,OAAS/G,GAAE,IAAI,CAC3J,IAAM,GAIL,OAGF,IAAMgH,EAAqBC,GAAOC,EAAuB,EACnDC,EAAuB1J,GAAMuJ,CAAkB,EAC/CI,EAAsB1J,GAAasJ,EAAoB,EAAK,EAC5DK,EAAsB3J,GAAasJ,EAAoB,EAAI,EAE3D/B,GAAezG,GAAwBsI,EAAkB,CAACxG,EAAU,UAAU,EAAG,CAAC,KAAK,CAAC,EAC9F,GAAI,CAAC2E,GACH,MAAMqC,GAAoB,4GAA4G5L,CAAU,0BAA0BuK,CAAqB,EAAE,EAEnM,IAAMsB,GAAW,IAAMpM,EAAI,sBAAuB,CAChD,WAAY8K,EACZ,aAAcD,EACd,KAAM,CAAC,CACL,GAAImB,EACJ,KAAM,SAAWA,EACjB,QAAS,CAAC,KAAK,EACf,UAAW,OAAO,iBAClB,YAAahF,EAAO,cAAgB,IAChC,IACA,MAAM,QAAQA,EAAO,WAAW,EAC9B,CAAC,GAAGA,EAAO,YAAa7B,EAAU,YAAY,EAC9C,CAACA,EAAU,YAAY,EAC7B,eAAgB6B,EAAO,eACvB,KAAM,CACJ,QAAS,CACP,QAASqE,GAAsBP,EAAuBU,EAAiBU,CAAmB,EAC1F,UAAW,EACb,EACA,WAAY,CACV,GAAItJ,GAAa,CAAE,UAAW8I,EAA4BL,GAAsBP,EAAuBU,EAAiB5I,CAAS,EAAIA,CAAU,EAC/I,WAAY8I,EAA4BL,GAAsBP,EAAuBU,EAAiBjL,CAAU,EAAIA,CACtH,CACF,EACA,KAAM0L,CACR,CAAC,EACD,aAAAnC,EACF,CAAC,EAAE,MAAM5E,IAAK,CACZ,cAAQ,MAAM,2CAA2C4F,CAAqB,0BAA0BvK,CAAU,GAAI2E,EAAC,EACjHA,EACR,CAAC,EACKiF,GAAW,CACf,WAAYW,EACZ,OAAQhK,EAAU,UAAUgK,CAAqB,EAAE,OACnD,UAAWK,GAAmBL,EAAuBS,EAAmB,CACtE,gBAAAC,EACA,YAAaH,GAAsB9K,EAAYkL,EAAsBS,CAAmB,CAC1F,EAAG,KAAK,mBAAmB,EAC3B,QAAS,GACX,EACIlH,GAAMG,EAAU,WAAW,CAC7B,WAAA5E,EACA,GAAI,CACF4E,EAAU,eACVgG,GAAmB5K,EAAYyG,EAAO,aACpC0E,EACKL,GAAsB9K,EAAYkL,EAAsBtB,EAAO,EAChEA,GAAS,KAAK,mBACpB,CACF,EACA,SAAUF,CACZ,CAAC,EACD,OAAAjF,GAAM,MAAMhF,EAAI,oCAAqCgF,GAAK6E,EAAgB,CACxE,GAAGD,EAEH,WAAY,IAAIvJ,KACP+L,GAAS,EAAE,KAAK,IAAMxC,GAAO,aAAa,GAAGvJ,EAAI,CAAC,CAE7D,CAAC,EACM2E,EACT,QAAE,CACA,MAAMhF,EAAI,4BAA6BO,EAAY,CAAE,UAAW,EAAK,CAAC,CACxE,CACF,EACA,kCAAmC,eAAgByG,EAA0D,CAC3G,GAAM,CAAE,OAAA4D,EAAQ,WAAArK,EAAY,aAAAe,EAAc,KAAAC,EAAM,MAAAqI,EAAO,eAAAC,CAAe,EAAI7C,EACpEiD,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAEjE,GAAI,CADa,KAAK,mBAAmB2I,CAAY,GAAG,SAEtD,MAAM,IAAI,MAAM,yBAAyB,EAE3C,IAAME,EAAW5I,EACbiE,EAAUL,EAAU,WAAW,CACjC,WAAA5E,EACA,GAAI,CACF4E,EAAU,oBACVgG,GAAmB5K,EAAYyG,EAAO,aAAcmD,EAAS,KAAK,mBAAmB,CACvF,EACA,SAAUF,CACZ,CAAC,EACD,OAAKW,IACHpF,EAAU,MAAMxF,EAAI,oCAAqCwF,EAASqE,EAAgBD,CAAK,GAElFpE,CACT,EACA,sBAAuB,eAAgBwB,EAA8C,CACnF,GAAM,CAAE,WAAAzG,EAAY,aAAAe,EAAc,KAAAC,EAAM,MAAAqI,EAAO,eAAAC,CAAe,EAAI7C,EAC5DiD,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAEjE,GAAI,CADa,KAAK,mBAAmB2I,CAAY,GAAG,SAEtD,MAAM,IAAI,MAAM,yBAAyB,EAE3C,IAAME,GAAW,MAAM,QAAQ,IAAI5I,EAAK,IAAI,CAAC,CAAC8K,EAAUC,CAAQ,IAAM,CACpE,GAAI,CAAC,CAAC,+BAAgC,iCAAkC,sBAAuB,sBAAuB,yBAA0B,kCAAmC,uBAAuB,EAAE,SAASD,CAAQ,EAC3N,MAAM,IAAI,MAAM,sCAAwCA,CAAQ,EAElE,OAAOrM,EAAIqM,EAAU,CAAE,GAAGC,EAAU,GAAGtF,EAAQ,KAAMsF,EAAS,KAAM,OAAQ,EAAK,CAAC,CACpF,CAAC,CAAC,GAAG,KAAK,EAAE,OAAO,OAAO,EAAE,IAAKtH,GACxB,CAACA,EAAI,OAAO,EAAGA,EAAI,QAAQ,CAAC,CACpC,EACGA,EAAMG,EAAU,WAAW,CAC7B,WAAA5E,EACA,GAAI,CACF4E,EAAU,UACVgG,GAAmB5K,EAAYyG,EAAO,aAAemD,EAAe,KAAK,mBAAmB,CAC9F,EACA,SAAUF,CACZ,CAAC,EACD,OAAAjF,EAAM,MAAMhF,EAAI,oCAAqCgF,EAAK6E,EAAgBD,CAAK,EACxE5E,CACT,EACA,+BAAgC,gBAAkB,CAElD,EACA,uBAAwB,gBAAkB,CAE1C,EACA,uBAAwB,gBAAkB,CAE1C,EACA,gDAAiD,SAAU,CACzD,WAAAzE,EACA,kBAAAgL,EACA,gBAAAC,EACA,aAAA1B,EACA,KAAAvI,CACF,EAMG,CACD,IAAMgL,EAAiBC,GAAoC,KAAK,KAAM,CACpE,WAAAjM,EACA,kBAAAgL,EACA,gBAAAC,EACA,aAAA1B,EACA,KAAAvI,CACF,CAAC,EACD,KAAK,OAAO,IAAIhB,EAAYgM,CAAc,CAC5C,EAWA,kBAAmB,eAAgBhM,EAAoBH,EAAamB,EAAgB,CAClF,QAAAkL,EACA,kBAAAlB,EACA,gBAAAC,EACA,aAAA1B,EACA,YAAA4C,EACA,WAAAC,CACF,EAOG,CACDD,EAAcA,GAAe,EAC7B,IAAMrE,EAAM,GAAG,KAAK,OAAO,aAAa,OAAO,mBAAmB9H,CAAU,CAAC,IAAI,mBAAmBH,CAAG,CAAC,GAClGwM,EAAgB,OAAOD,GAAe,WAExCrC,EAKEuC,EAAc,SAAY,CAC9B,IAAIC,EAQJ,GAAIxC,EAAS,IAAMA,EAAS,SAAW,KAAOA,EAAS,SAAW,IAAK,CACrE,IAAMyC,EAAqB,MAAMzC,EAAS,KAAK,EAO/CwC,EAAeC,EACX9H,GAAmC,KAAM,CACzC,WAAA1E,EACA,eAAgB,KAAK,MAAMwM,CAAkB,EAC7C,KAAM3M,CACR,CAAC,EACC,MAGN,SAAWkK,EAAS,SAAW,KAAOA,EAAS,SAAW,IACxD,MAAM,IAAI0C,GAAoC,mCAAqC1C,EAAS,MAAM,EAEpG,IAAM1I,EAAS,MAAO+K,EAAsB,CAC1C,WAAApM,EACA,IAAAH,EACA,WAAYmB,EACZ,OAAQ+I,EAAS,OAKjB,KAAMA,EAAS,QAAQ,IAAI,OAAO,GAAKA,EAAS,QAAQ,IAAI,MAAM,EAClE,IAAI,aAAe,CACjB,OAAOwC,GAAc,IACvB,EACA,aAAAA,CACF,CAAC,EACD,OAAKlL,GAELL,EAAOK,EAAO,CAAC,EACf6K,EAAU7K,EAAO,CAAC,EACX,IAJa,EAKtB,EAEA,OAAS,CACP,GAAIL,IAAS,OAAW,CACtB,IAAMgL,EAAiBC,GAAoC,KAAK,KAAM,CACpE,WAAAjM,EACA,kBAAAgL,EACA,gBAAAC,EACA,aAAA1B,EACA,KAAAvI,EACA,KAAMnB,CACR,CAAC,EACDkK,EAAW,MAAM,KAAK,OAAO,MAAMjC,EAAK,CACtC,QAAS,IAAI,QAAQ,CAAC,CACpB,gBAAiBhE,GAAgC,KAAK,KAAM9D,CAAU,CACxE,EAAG,CACD,WAAYkM,GAAW,IACzB,CACA,CAAC,EACD,OAAQ,OACR,KAAM,KAAK,UAAUF,CAAc,EACnC,OAAQ,KAAK,gBAAgB,MAC/B,CAAC,CACH,KAAO,CACL,GAAI,CAACK,EACH,MAAM,UAAU,qCAAqC,EAcvD,GATAtC,EAAW,MAAM,KAAK,OAAO,MAAMjC,EAAK,CACtC,QAAS,IAAI,QAAQ,CAAC,CACpB,gBAAiBhE,GAAgC,KAAK,KAAM9D,CAAU,CACxE,CAAC,CAAC,EACF,OAAQ,KAAK,gBAAgB,MAC/B,CAAC,EAIG,MAAMsM,EAAY,EACpB,SAEA,KAEJ,CACA,GAAI,CAACvC,EAAS,GAAI,CAEhB,GAAIA,EAAS,SAAW,KAAOA,EAAS,SAAW,IAAK,CACtD,GAAI,EAAEoC,GAAe,EACnB,MAAM,IAAI,MAAM,kCAAkC,EAIpD,GADA,MAAMO,GAAMC,GAAmB,EAAG,IAAI,CAAC,EACnCN,EAAe,CACjB,GAAI,MAAMC,EAAY,EACpB,SAEA,KAEJ,KAEE,OAAM,IAAI,MAAM,6BAA6BvC,EAAS,MAAM,yCAAyC,CAEzG,CACA,MAAM,IAAI0C,GAAoC,mCAAqC1C,EAAS,MAAM,CACpG,CACA,KACF,CACF,EACA,kBAAmB,eAAgB/J,EAAoBH,EAAa,CAClE,IAAMkK,EAAW,MAAM,KAAK,OAAO,MAAM,GAAG,KAAK,OAAO,aAAa,OAAO,mBAAmB/J,CAAU,CAAC,IAAI,mBAAmBH,CAAG,CAAC,GAAI,CACvI,QAAS,IAAI,QAAQ,CAAC,CACpB,gBAAiBiE,GAAgC,KAAK,KAAM9D,CAAU,CACxE,CAAC,CAAC,EACF,OAAQ,KAAK,gBAAgB,MAC/B,CAAC,EACD,GAAI+J,EAAS,SAAW,IACtB,OAAO,KAET,GAAI,CAACA,EAAS,GACZ,MAAM,IAAI,MAAM,4BAA8BA,EAAS,MAAM,EAE/D,IAAM/I,EAAO,MAAM+I,EAAS,KAAK,EACjC,OAAOrF,GAAmC,KAAM,CAC9C,WAAA1E,EACA,eAAgBgB,EAChB,KAAMnB,CACR,CAAC,CACH,EASA,wBAAyB,SAAUG,EAAoB4M,EAAmB,CACxE,KAAK,OAAO,YAAY5M,EAAY4M,CAAM,CAC5C,EACA,sDAAuD,SAAU,CAAE,WAAA5M,EAAY,eAAAgM,EAAgB,KAAA9G,CAAK,EAAmE,CACrK,OAAOR,GAAmC,KAAM,CAC9C,WAAA1E,EACA,eAAAgM,EACA,KAAA9G,CACF,CAAC,CACH,CACF,CAAC,EAED,SAASF,GAAwBrF,EAAwB,CAEvD,IAAMoB,EADcxB,GAAa,KAAKI,CAAM,IACT,CAAC,EACpC,GAAI,CAACoB,EAAc,MAAM,IAAI,MAAM,wBAAwBpB,CAAM,2BAA2B,EAC5F,OAAOoB,CACT,CAEA,SAASkL,GAAqC,CAC5C,WAAAjM,EACA,kBAAAgL,EACA,gBAAAC,EACA,aAAA1B,EACA,KAAAvI,EACA,KAAAkE,CACF,EAOG,CACD,IAAMrB,EAAQpE,EAAI,KAAK,OAAO,aAAa,EAAEO,CAAU,EACjD6M,EAAgB7B,EACjBnH,EAAM,IAAI,eAAemH,CAAiB,GAAKnH,EAAM,IAAI,eAAemH,CAAiB,GAAG,iBAAmB,KAC5GJ,GAAmB5K,EAAYgL,EAAoBhK,EAAY,KAAK,mBAAmB,EACvF8I,GAA6B,KAAK,oBAAoBkB,CAAiB,EAAIhK,CAAU,EACzFA,EACE4I,EAAWqB,EAEbH,GAAsB9K,EAAYiL,EAAiB4B,CAAa,EADhEA,EAEE5H,EAAU2F,GAAmB5K,EAAYuJ,EAAeK,EAAe,KAAK,mBAAmB,EAC/FrJ,EAAYd,EAAI,KAAK,OAAO,aAAa,EACzC2J,EAAS,OAAO7I,EAAU,UAAUP,CAAU,EAAE,MAAM,EAE5D,MADuB,CAAE,GAAGiF,EAAQ,WAAWC,GAAQ,IAAMkE,CAAM,EAAG,OAAAA,CAAO,CAE/E,CAEA,SAAS1E,GAAoCoI,EAAK,CAChD,WAAA9M,EACA,eAAAgM,EACA,KAAA9G,CACF,EAIG,CACD,GAAI,CAAC8G,EACH,MAAM,IAAI,UAAU,2EAA2E,EAEjG,IAAMnI,EAAQpE,EAAIqN,EAAI,OAAO,aAAa,EAAE9M,CAAU,EAChD+M,EAAgB,SAASf,EAAe,MAAM,EAE9CgB,EADYvN,EAAIqN,EAAI,OAAO,aAAa,EACd,UAAU9M,CAAU,EAAE,OACtD,GAAI,EAAE+M,GAAiB,IAAM,EAAEA,GAAiBC,GAC9C,MAAM,IAAI,MAAM,iEAAiEhB,EAAe,MAAM,8BAA8BgB,CAAa,EAAE,EAIrJ,IAAMC,GAAO/H,GAAQ,IAAM8G,EAAe,OAEpCzH,EAAI2I,GAAmBlN,EAAY6D,EAAOmI,EAAgBe,EAAeE,EAAMhI,GAC5EkI,GAA2BnN,EAAY6D,EAAOoB,EAAS8H,EAAeD,EAAI,oBAAqBG,EAAK,MAAS,CACrH,EAGGhC,EACAD,EAMEoC,GAAU,IAAM,CACpB,IAAI/L,EAEJ,MAAO,IAAM,CACX,GAAI,CAACA,EACH,GAAI,CACF,IAAIgM,EAEJA,EAAY9I,EAAE,QAAQ,EAElBtD,GAAgBoM,CAAS,GAC3BpC,EAAkBoC,EAAU,gBAC5BA,EAAYA,EAAU,QAAQ,EAI1BC,GAAaD,CAAS,GACxBrC,EAAoBqC,EAAU,aAC9BA,EAAYA,EAAU,QAAQ,GAE9BrC,EAAoB,OAGtBC,EAAkB,KAClBD,EAAoB,MAEtB3J,EAAS,CAACgM,CAAS,CACrB,OAAS1I,EAAG,CACVtD,EAAS,CAAC,OAAWsD,CAAC,CACxB,CAGF,GAAItD,EAAO,SAAW,EACpB,MAAMA,EAAO,CAAC,EAEhB,OAAOA,EAAO,CAAC,CACjB,CACF,GAAG,EAEGA,EAAS,CACb,IAAI,YAAc,CAChB,OAAOrB,CACT,EACA,IAAI,mBAAqB,CACvB,GAAIgL,IAAsB,OACxB,GAAI,CACFoC,EAAO,CACT,MAAQ,CAGR,CAEF,OAAOpC,CACT,EACA,IAAI,iBAAmB,CACrB,GAAIC,IAAoB,OACtB,GAAI,CACFmC,EAAO,CACT,MAAQ,CAGR,CAEF,OAAOnC,CACT,EACA,IAAI,cAAgB,CAClB,OAAO1G,EAAE,YACX,EACA,IAAI,MAAQ,CACV,OAAO6I,EAAO,CAChB,EACA,IAAI,mBAAqB,CACvB,OAAOG,GAAuBvN,EAAYqB,EAAO,aAAcwC,CAAK,CACtE,EACA,IAAI,wBAA0B,CAC5B,OAAO0J,GAAuBvN,EAAYqB,EAAO,kBAAmBwC,CAAK,CAC3E,CACF,EAEA,OAAOxC,CACT,CAEA,eAAe+I,GACboD,EACA/G,EACA,CACA,GAAM,CAAE,OAAA4D,EAAQ,OAAA1K,EAAQ,WAAAK,EAAY,KAAAgB,EAAM,MAAAqI,EAAO,eAAAC,CAAe,EAAI7C,EAC9D1F,EAAeiE,GAAuBrF,CAAM,EAC5C+J,EAAe,KAAK,OAAO,UAAU,UAAU3I,CAAY,EAC3D,CAAE,SAAA8D,CAAS,EAAI,KAAK,mBAAmB6E,CAAY,EACnD7F,EAAQgB,EAAS,MAAM7E,CAAU,EACjCkF,EAAO,MAAML,EAAS,SAAS,OAAO,EACtC4I,EAAgB,CAAE,OAAA9N,EAAQ,KAAAqB,EAAM,KAAAkE,CAAK,EACrC2H,EAAgBpG,EAAO,kBACxB5C,EAAM,IAAI,eAAe4C,EAAO,iBAAiB,GAAK5C,EAAM,IAAI,eAAe4C,EAAO,iBAAiB,GAAG,iBAAmB,KAC1HmE,GAAmB5K,EAAYyG,EAAO,kBAAoBgH,EAAoB,KAAK,mBAAmB,EACtG3D,GAA6B,KAAK,oBAAoBrD,EAAO,iBAAiB,EAAIgH,CAAkB,EACxGA,EACJ,GAAID,IAAW5I,EAAU,qBAAuB,CAAC6B,EAAO,gBACtD,MAAM,IAAI,MAAM,4DAA4D,EAE9E,GAAIA,EAAO,eACLA,EAAO,kBAAoB1E,GAAM0E,EAAO,aAAa,EACvD,MAAM,IAAI,MAAM,uEAAuE,EAI3F,IAAMmD,EAAU4D,IAAW5I,EAAU,sBACjCiI,EACApG,EAAO,cACLiH,GAAkCjH,EAAO,cAA2BoG,CAAa,EACjF/B,GAAsB9K,EAAcyG,EAAO,gBAAgCoG,CAAa,EAC1F5H,EAAUL,EAAU,WAAW,CACjC,WAAA5E,EACA,GAAI,CACFwN,EACA5C,GAAmB5K,EAAYyG,EAAO,aAAemD,EAAe,KAAK,mBAAmB,CAC9F,EACA,SAAUF,CACZ,CAAC,EACD,OAAKW,IACHpF,EAAU,MAAMxF,EAAI,oCAAqCwF,EAASqE,EAAgBD,CAAK,GAElFpE,CACT,CAkBA,SAASG,GAAcvB,EAAe8J,EAAiB,CACrD,IAAMC,EAAe,IAAI,MAAM,CAAC,EAAG,CACjC,IAAKC,EAASC,EAAM,CAClB,OAAOH,EAAQG,CAAI,EAAEjK,EAAO+J,CAAY,CAC1C,CACF,CAAC,EACD,MAAO,CAAE,QAASA,CAAa,CACjC,CAEAnO,EAAI,mBAAoB,CAAC,UAAU,CAAC,EC1hE7B,IAAMsO,GAAkB,mBCA/B,IAAAC,GAAA,CACE,UAAa,CACX,wBAAyB,2DACzB,qBAAsB,2DACtB,wBAAyB,0DAC3B,CACF,ECUA,IAAMC,GAAwB,MAAOC,GAAuB,CAC1D,GAAM,CAAE,cAAAC,EAAe,cAAAC,CAAc,EAAIC,EAAI,8BAA+BH,CAAU,EACtF,GAAI,CAACC,EAAe,OAEpB,MAAME,EAAI,2BAA4BH,EAAY,CAAE,UAAW,EAAK,CAAC,EAErE,IAAMI,EAAOH,EAAc,MAAM,QAAQ,mBAAoB,aAAa,EACpEI,EAAUD,GAAQD,EAAI,mBAAoB,GAAGC,CAAI,aAAa,EAE9DE,EAAuBH,EAAI,oBAAoB,EAAE,qBAIvD,GAAIG,EAAqB,iBAAkB,CAEzC,IAAMC,EAAe,OAAO,QAAQD,EAAqB,gBAAgB,EAAE,OAAO,CAAC,CAAC,CAAE,CAAE,mBAAAE,CAAmB,CAAC,IACnGA,IAAuBR,CAC/B,EAAE,IAAI,CAAC,CAACS,CAAG,IAAMA,CAAG,EACrB,MAAMN,EAAI,kCAAmC,CAC3C,aAAAI,EACA,OAAQ,CACN,kBAAmB,EACrB,CACF,CAAC,EAAE,MAAMG,GAAK,CACZ,QAAQ,MAAM,2EAA4EV,EAAYU,CAAC,CACzG,CAAC,CACH,CASI,OAAOL,GAAY,WACrB,MAAMA,EAAQL,EAAYE,CAAa,EAAE,MAAMQ,GAAK,CAClD,QAAQ,MAAM,8DAA+DV,EAAYU,CAAC,CAC5F,CAAC,EAED,QAAQ,KAAK,mHAAoHV,EAAYC,EAAc,IAAI,CAEnK,EAOMU,GAAgB,SAAwB,CAiC5C,MAAMR,EAAI,sBAAuBS,EAAsB,EAAE,KAAK,MAAOX,GAAkB,CACrF,GAAI,CAACA,EAAe,OACpB,IAAMY,EAAqB,MAAMV,EAAI,sBAAuBW,EAAoB,EAC3ED,IACL,MAAMV,EAAI,iBAAkBF,CAAa,EAErC,OAAO,mBAAsB,YAC/B,MAAME,EAAI,sBAAuBU,CAAkB,EAEvD,CAAC,EAGD,IAAME,EAAoB,CAACC,EAAkBC,EAAcC,EAAoBC,IAAqB,CAClGhB,EAAI,wBAAyB,iBAAkB,CAAE,YAAa,IAAI,KAAK,EAAE,YAAY,EAAG,SAAAa,EAAU,MAAAC,EAAO,QAAAC,EAAS,QAAAC,CAAQ,CAAC,EAE3HhB,EAAI,cAAc,EAAE,MAAMO,GAAK,CAC7B,QAAQ,MAAM,8CAA+CA,CAAC,CAChE,CAAC,CACH,EAEIU,EAAmB,GACjBC,EAAe,IAAMlB,EAAI,kCAAmCS,GAAwB,IAAM,CAC9F,GAAI,CAAAQ,EACJ,OAAOjB,EAAI,sBAAuBS,GAAwBT,EAAI,oBAAoB,CAAC,CACrF,CAAC,EACKmB,EAAwBC,GAASF,EAAc,GAAG,EAIxD,MAAMlB,EAAI,qBAAsB,CAC9B,cAAeA,EAAI,qBAAsB,SAAS,EAMlD,YAAa,CAAC,EAAWqB,EAAWC,IAAc,CAC5C,EAAED,CAAC,IAAMC,IACX,EAAED,CAAC,EAAIC,EACPH,EAAsB,EAE1B,EACA,YAAa,CAAC,EAAWE,IAAc,CACjCE,EAAI,EAAGF,CAAC,IACV,OAAO,EAAEA,CAAC,EACVF,EAAsB,EAE1B,EACA,UAAW,CACT,GAAGK,GACH,SAAU,CACR,QAAS,CAAE,oBAAqBC,EAAO,EACvC,iBAAkB,CAChB,mBAAoB,yBAIpB,mBAAoB,sBAAuB,oBAAqB,qBAChE,qBAAsB,0BAA2B,yBAA0B,8BAA+B,2BAA4B,2BAA4B,4BAA6B,oBAC/L,uCAAwC,uCACxC,4CACA,4CACA,2BAA4B,wBAC5B,2BAA4B,yBAC5B,8BACA,yCACA,oDACA,mCAAoC,sCAAuC,+CAAgD,+BAC3H,wBAAyB,gCACzB,8CAA+C,iCAC/C,6BACA,wBACA,4BAA6B,gCAAiC,mCAAoC,kCAClG,sBACA,+BACA,kCACA,2BAA4B,4BAC5B,8CACA,oDAAqD,sDACrD,8CACA,kDAAmD,oDACrD,EACA,eAAgB,CAAC,iBAAkB,mBAAoB,uBAAwB,QAAS,cAAc,EACtG,WAAY,GACZ,eAAgB,CAGd,aAAc,KAAK,YACrB,CACF,CACF,EACA,MAAO,CACL,kBAAmB,CAAClB,EAAGV,IAAe,CAC/BU,IACDA,EAAE,OAAS,0BACb,QAAQ,KAAK,mCAAqCV,EAAa,mBAAmB,EAClFD,GAAsBC,CAAU,EAAE,MAAMU,GAAK,CAC3C,QAAQ,MAAM,uDAAwDA,CAAC,CACzE,CAAC,GAEC,CAAC,yBAA0B,sBAAsB,EAAE,SAASA,EAAE,IAAI,GACpEP,EAAI,wBAAyB0B,GAAenB,EAAG,CAAE,WAAAV,CAAW,CAAC,EAEjE,EACA,iBAAkB,CAACU,EAAUQ,IAAuB,CAClD,GAAI,CAAC,yBAA0B,sBAAsB,EAAE,SAASR,GAAG,IAAI,EAAG,CACxE,IAAMV,EAAakB,EAAQ,WAAW,EACtCf,EAAI,wBAAyB0B,GAAenB,EAAG,CAAE,WAAAV,EAAY,QAAAkB,CAAQ,CAAC,CACxE,CACIf,EAAI,qBAAsB,iBAAiB,IAAMe,EAAQ,KAAK,GAEhEH,EAAkB,cAAeL,EAAGQ,CAAO,CAE/C,EACA,aAAc,CAACR,EAAUQ,EAAoBC,IAA4I,CAOvL,GANIT,EAAE,OAAS,uBACbP,EAAI,kCAAmCe,EAAQ,WAAW,EAAG,CAC3D,+BAAgCA,EAASR,EAAGS,CAC9C,CAAC,EAGCT,EAAE,OAAS,iCAIf,IAAIQ,EAAQ,UAAU,IAAM,WAAY,CACtC,QAAQ,KAAK,qCAAsCA,EAASR,CAAC,EAC7D,MACF,CACAK,EAAkB,UAAWL,EAAGQ,EAASC,CAAO,EAClD,EACA,gBAAiB,CAACT,EAAUQ,IAAuB,CACjD,IAAMlB,EAAakB,EAAQ,WAAW,EACtCf,EAAI,wBAAyB0B,GAAenB,EAAG,CAAE,WAAAV,EAAY,QAAAkB,CAAQ,CAAC,EACtEf,EAAI,qBAAsB,kBAAmBe,EAAQ,KAAK,CAAC,EAC3DH,EAAkB,aAAcL,EAAGQ,CAAO,CAC5C,CACF,CACF,CAAC,EAEDf,EAAI,sBAAuB2B,GAAgB,IAAM,CAE/C,GAAI,CADU3B,EAAI,oBAAoB,EAC3B,SAAU,CACnB,QAAQ,KAAK,mEAAmE,EAChF,MACF,CAEAA,EAAI,6BAA6B,EAAE,MAAMO,GAAK,CAC5C,QAAQ,MAAM,yDAA0DA,CAAC,CAC3E,CAAC,EAEDW,EAAa,EAAE,MAAMX,GAAK,CACxB,QAAQ,MAAM,sDAAuDA,CAAC,CACxE,CAAC,CACH,CAAC,EAEDP,EAAI,sBAAuB4B,GAAyB,IAAM,CACxDV,EAAa,EAAE,MAAMX,GAAK,CACxB,QAAQ,MAAM,+DAAgEA,CAAC,CACjF,CAAC,CACH,CAAC,EAEDP,EAAI,sBAAuB6B,GAAa,IAAM,CAC5CZ,EAAmB,EACrB,CAAC,EAEDjB,EAAI,sBAAuB8B,GAAQ,IAAM,CAEvCX,EAAsB,MAAM,EAC5B,QAAQ,IAAI,CACVnB,EAAI,gBAAgB,EACpBA,EAAI,wBAAyBS,EAAsB,CACrD,CAAC,EAAE,MAAMF,GAAK,CACZ,QAAQ,MAAM,+CAAgDA,CAAC,CACjE,CAAC,EAAE,QAAQ,IAAM,CACfU,EAAmB,EACrB,CAAC,CACH,CAAC,EAEDjB,EAAI,sBAAuB+B,GAAoB,CAACC,EAAG,CAAE,MAAAC,CAAM,IAAM,CAE/D,GAAI,CAACA,EAAM,OAAQ,OACnB,IAAMC,EAAYlC,EAAI,oBAAoB,EAC1CiC,EAAM,QAASE,GAAQ,CACrB,OAAQD,EAAU,UAAUC,CAAG,GAAG,KAAM,CACtC,IAAK,wBACH,GAAIA,IAAQD,EAAU,UAAU,mBAAoB,CAClDlC,EAAI,wBAAyBmC,EAAK,CAACC,GAAQ,gBAAiBA,GAAQ,YAAaA,GAAQ,aAAa,CAAC,EACvG,MACF,CAEA,MACF,IAAK,qBACHpC,EAAI,wBAAyBmC,EAAK,CAACC,GAAQ,cAAc,CAAC,EAC1D,MACJ,CACApC,EAAI,wBAAyBmC,EAAK,CAAC,CAAC,CACtC,CAAC,CACH,CAAC,EAGDnC,EAAI,qBAAsBqC,GAAiBrC,EAAI,mBAAoB,CACjE,gBAAiB,CACf,CAACsC,GAAkB,YAAY,EAAGC,EAAK,CACrC,IAAMC,EAAa,QACbC,EAAeF,EAAI,KAAK,WAExBG,EAAsB,QACtBC,EAAwBJ,EAAI,KAAK,kBAEjCK,EAAwBF,IAAwBC,EAChDE,EAAkBL,IAAeC,EAIvC,QAAQ,KAAK,yBAA0B,CACrC,WAAAD,EACA,aAAAC,EACA,oBAAAC,EACA,sBAAAC,CACF,CAAC,GACGC,GAAyBC,IAC3B7C,EAAI,wBAAyBsC,GAAkB,aAAcC,EAAI,IAAI,CAEzE,EACA,CAACO,GAAa,WAAW,EAAGP,EAAK,CAC/BvC,EAAI,wBAAyB8C,GAAa,YAAa,CAAE,KAAMP,EAAI,IAAK,CAAC,CAC3E,EACA,CAACD,GAAkB,GAAG,EAAGC,EAAK,CAC5B,GAAM,CAAE,WAAA1C,EAAY,uBAAAkD,EAAwB,KAAAC,CAAK,EAAIT,EAErD,OAAQS,EAAK,CAAC,EAAG,CACf,IAAK,0CAA2C,CAC9ChD,EAAI,wBAAyBiD,GAAsB,CAAE,WAAApD,EAAY,uBAAAkD,CAAuB,CAAC,EACzF,KACF,CACA,IAAK,+CAAgD,CACnD/C,EAAI,wBAAyBkD,GAA2B,CAAE,WAAArD,EAAY,uBAAAkD,CAAuB,CAAC,EAC9F,KACF,CACA,QACE,QAAQ,IAAI,uCAAuClD,CAAU,IAAKmD,CAAI,CAE1E,CACF,EACA,CAACV,GAAkB,EAAE,EAAG,CAACa,EAAKC,CAAK,EAAG,CACpC,GAAM,CAAE,WAAAvD,EAAY,KAAAmD,CAAK,EAAII,EACxBJ,GAELhD,EAAI,wBAAyBqD,GAAU,CAAE,WAAAxD,EAAY,IAAAsD,EAAK,KAAAH,CAAK,CAAC,CAClE,EACA,CAACV,GAAkB,QAAQ,EAAGzC,EAAY,CACxC,QAAQ,KAAK,gCAAkCA,EAAa,mBAAmB,EAC/ED,GAAsBC,CAAU,EAAE,MAAMU,GAAK,CAC3C,QAAQ,MAAM,oDAAqDA,CAAC,CACtE,CAAC,CACH,CACF,EACA,SAAU,CACR,SAAW,CACTP,EAAI,wBAAyBsD,EAAO,CACtC,EACA,QAAU,CACRtD,EAAI,wBAAyBuD,EAAM,EACnC,QAAQ,KAAK,cAAc,CAC7B,EACA,wBAA0B,CACxBvD,EAAI,wBAAyBwD,EAAY,CAC3C,EACA,uBAAyB,CACvBxD,EAAI,wBAAyByD,EAAmB,CAClD,EACA,0BAA4B,CAC1BzD,EAAI,wBAAyBuD,EAAM,EACnC,QAAQ,KAAK,wBAAwB,CACvC,CACF,CACF,CAAC,CAAC,EAMFvD,EAAI,sBAAuBW,EAAoB,EAAE,KAAK,MAAOD,GAAuB,CAElF,IAAMZ,EAAgB,MAAME,EAAI,oBAAoB,EAChD,CAACF,GAAiB,CAACY,GACnBZ,EAAc,UAAU,qBAAuBY,GAGnD,MAAMV,EAAI,yBAA0BU,CAAkB,EAAE,KAAK,SAAY,CACvE,IAAMgD,EAAcC,GAAqB7D,EAAc,SAAS,EAChE,MAAM8D,GAAqBF,CAAW,CACxC,CAAC,EAAE,MAAMnD,GAAK,CACZ,QAAQ,MAAM,6DAA8DA,CAAC,CAC/E,CAAC,CACH,CAAC,CACH,EAMOsD,IAAU,IAAM,CACrB,IAAMC,EAAc,KACbC,IACHA,EAAUvD,GAAc,EAAE,MAAOD,GAAM,CACrC,cAAQ,MAAM,8CAA+CA,CAAC,EAC9DwD,EAAU,OACJxD,CACR,CAAC,GAEIwD,GAELA,EAKJ,OAAA/D,EAAI,sBAAuBgE,GAAc,IAAM,CACxCD,IACLA,EAAU,OACV,WAAW,IAAMD,EAAY,EAAE,MAAOvD,GAAM,CAC1C,QAAQ,MAAM,mDAAoDA,CAAC,CACrE,CAAC,EAAG,GAAG,EACT,CAAC,EAEMuD,CACT,GAAG,EC7ZH,IAAMG,GAAiBC,GACjB,OAAOA,GAAM,UACfA,EAAI,OAAO,KAETA,EAAE,QAAQ,KAAM,GAAG,EAAE,QAAQ,KAAM,GAAG,EAAI,IAAI,QAAQ,EAAIA,EAAE,OAAS,GAAK,CAAC,EAC3E,QACF,EACOA,GAEF,IAAI,WAAWA,CAAC,EAGnBC,GAAW,CAACC,EAA8BC,IAAiC,CAE/E,GAAID,GAAK,MAAQC,GAAK,KAAM,OAAOD,GAAKC,EAExC,IAAMC,EAAKL,GAAcG,CAAC,EACpBG,EAAKN,GAAcI,CAAC,EAE1B,GAAIC,EAAG,aAAeC,EAAG,WAAY,MAAO,GAE5C,QAASC,EAAIF,EAAG,WAAa,EAAGE,GAAK,EAAGA,IACtC,GAAIF,EAAGE,CAAC,IAAMD,EAAGC,CAAC,EAAG,MAAO,GAG9B,MAAO,EACT,EAEOC,GAASC,EAAI,yBAA0B,CAC5C,+BAAgC,IAAM,CACpC,IAAIC,EAEJ,OAAAD,EAAI,sBAAuBE,GAAa,YAAa,CAAC,CAAE,KAAAC,CAAK,IAAM,CACjE,GAAIA,EAAK,OAASC,GAAwB,gBAAiB,OAC3D,IAAMC,EAASJ,IAAyB,CAAC,EAAE,qBAC3CA,EAAyB,CAAC,YAAY,IAAI,EAAG,CAC3C,gBAAiB,GACjB,qBAAsBE,EAAK,IAC7B,CAAC,EACGE,IAAWF,EAAK,OACnB,SAAY,CACX,IAAMG,EAAe,MAAM,KAAK,aAAa,YAAY,gBAAgB,EAWzE,GAVI,CAACA,GACDb,GAASa,EAAa,QAAQ,qBAAsBH,EAAK,IAAI,IACjE,QAAQ,KAAK,oFAAqF,CAChG,8BAA+BG,EAAa,QAAQ,sBAAwB,OAAO,KAAKA,EAAa,QAAQ,oBAAoB,EAAE,SAAS,QAAQ,EACpJ,8BAA+BH,EAAK,IACtC,CAAC,EAGD,MAAMG,EAAa,YAAY,EAE3B,CAACN,EAAI,oBAAoB,EAAE,UAAYA,EAAI,wBAAyBO,GAAgB,qBAAqB,GAAG,OAChH,IAAMC,EAAkB,MAAM,KAAK,aAAa,YAAY,UAAUP,EAAuB,CAAC,CAAC,EAC/F,MAAMD,EAAI,kCAAmCQ,GAAiB,OAAO,EAAGA,GAAiB,QAAQ,oBAAoB,CACvH,GAAG,CACL,CAAC,EAEM,IAEHP,GAGC,YAAY,IAAI,EAAIA,EAAuB,CAAC,EAAK,KAE3C,QAAQ,QAAQA,EAAuB,CAAC,CAAC,EAG3C,IAAI,QAAQ,CAACQ,EAASC,IAAW,CACtC,IAAMC,EAAU,CAAC,CAAE,KAAAR,CAAK,IAAM,CACxBA,EAAK,OAASC,GAAwB,kBAC1CJ,EAAI,uBAAwBE,GAAa,YAAaS,CAAO,EAC7D,aAAaC,CAAS,EAEtBH,EAAQR,EAAuB,CAAC,CAAC,EACnC,EACMY,EAASb,EAAI,qBAAsBc,EAAe,EACnDD,GAAQH,EAAO,IAAI,MAAM,yBAAyB,CAAC,EAErCG,EAAO,QAAQ,aACf,UAAU,MAC3BH,EAAO,IAAI,MAAM,kCAAkC,CAAC,EAGtDV,EAAI,sBAAuBE,GAAa,YAAaS,CAAO,EAC5D,IAAMC,EAAY,WAAW,IAAM,CACjCZ,EAAI,uBAAwBE,GAAa,YAAaS,CAAO,EAC7DD,EAAO,IAAI,MAAM,gCAAgC,CAAC,CACpD,EAAG,GAAI,EAEPG,EAAO,OAAO,KAAKE,GACjBb,GAAa,YACb,CAAE,OAAQE,GAAwB,eAAgB,CACpD,CAAC,CACH,CAAC,CAEL,GAAG,EAaH,mCAAoC,IAAM,CACxC,IAAMY,EAA+B,IAAI,QACzC,eAAeC,EAAUX,EAAc,CACrC,GAAI,CACF,OAAO,MAAMY,GAAkBZ,CAAY,CAC7C,OAASa,EAAG,CACV,MAAO,QAAQA,EAAE,OAAO,EAC1B,CACF,CAEA,MAAO,OAAOC,EAA2BC,IAAuC,CAC9E,IAAMR,EAASb,EAAI,qBAAsBc,EAAe,EACxD,GAAI,CAACD,EAAQ,MAAM,IAAI,MAAM,yBAAyB,EAGtD,GADmBA,EAAO,QAAQ,aACf,UAAU,KAC3B,MAAM,IAAI,MAAM,kCAAkC,EAGpD,IAAMS,EAAST,EAAO,OAChBU,EAAWP,EAA6B,IAAIM,CAAM,EAExD,GADAN,EAA6B,IAAIM,EAAQF,CAAgB,EACrDA,GAAkB,UACpB,GAAI,CAACG,GAAYH,EAAiB,WAAaG,EAAS,SAAU,CAChE,IAAMC,EAAQ,MAAMP,EAASG,CAAgB,EACvCK,EAAO,IAAI,IAAIL,EAAiB,QAAQ,EAAE,KAChD,QAAQ,KAAK,2CAA2CI,CAAK,KAAMC,CAAI,EAEvEZ,EAAO,OAAO,KAAKE,GACjBb,GAAa,YACb,CACE,OAAQE,GAAwB,mBAChC,QAAS,CACP,qBAAsBiB,EAClB,OAAO,KAAKA,CAAoB,EAAE,SAAS,QAAQ,EACnD,KACJ,SAAU,CACR,kBAAmB,GAAK,GAAK,GAAK,GACpC,EACA,iBAAAD,CACF,CACF,CACF,CAAC,CACH,UACSG,EAAU,CACnB,IAAMC,EAAQ,MAAMP,EAASM,CAAQ,EAC/BE,EAAO,IAAI,IAAIF,EAAS,QAAQ,EAAE,KACxC,QAAQ,KAAK,uDAAuDC,CAAK,KAAMC,CAAI,EAEnFZ,EAAO,OAAO,KAAKE,GACjBb,GAAa,YACb,CAAE,OAAQE,GAAwB,oBAAqB,QAAS,IAAK,CACvE,CAAC,CACH,CACF,CACF,GAAG,CACL,CAAC,EAEG,KAAK,cAAc,cACpB,IAAM,CACL,IAAIsB,EAAa,GACjB1B,EAAI,sBAAuB2B,GAA+B,SAAY,CAEpE,GADID,GACA,CAAC1B,EAAI,oBAAoB,EAAE,SAAU,OACzC0B,EAAa,GACb,IAAME,EAAuB5B,EAAI,wBAAyBO,GAAgB,qBAAqB,EAE/F,GADA,QAAQ,KAAK,4CAA6CqB,CAAoB,EAC1E,CAACA,EACH,GAAI,CACF,IAAMtB,EAAe,MAAM,KAAK,aAAa,YAAY,gBAAgB,EACzE,MAAMN,EAAI,kCAAmCM,GAAc,OAAO,EAAGA,GAAc,QAAQ,oBAAoB,CACjH,OAASa,EAAG,CACV,QAAQ,MAAM,+CAAgDA,CAAC,CACjE,CAEFO,EAAa,EACf,CAAC,CACH,GAAG,EAGL,KAAK,iBAAiB,OAAQ,SAAUG,EAAO,CAE7C,GAAI,CAACA,EAAM,KAAM,OACjB,IAAI1B,EACJ,GAAI,CACFA,EAAO0B,EAAM,KAAK,KAAK,CACzB,OAASV,EAAG,CACV,QAAQ,MAAM,6BAA8BA,CAAC,EAC7C,MACF,CACIhB,EAAK,OAAS2B,GAAkB,MAClCD,EAAM,UAAUE,GAAc,EAAE,KAAK,IAE/B5B,EAAK,KAAaH,EAAI,uBAAwBG,EAAK,IAAI,EAGpDH,EAAI,yBAA0BG,EAAK,UAAU,EAAE,MAAMgB,GAAK,CAC/D,QAAQ,MAAM,6BAA8BhB,EAAK,WAAYgB,CAAC,CAChE,CAAC,CACF,EAAE,MAAOA,GAAM,CAEd,GADA,QAAQ,MAAM,8BAA+BA,CAAC,EAC1ChB,EAAK,eAAiB,wBACxB,OAAO6B,GAAiB,CACtB,MAAOC,EAAE,mBAAmB,EAC5B,KAAMA,EAAE,sEAAsE,CAChF,CAAC,EACI,GAAI9B,EAAK,eAAiB,qBAC/B,OAAO6B,GAAiB,CACtB,MAAOC,EAAE,gBAAgB,EACzB,KAAMA,EAAE,oEAAoE,CAC9E,CAAC,CAEL,CAAC,CAAC,EACO9B,EAAK,OAAS,aACvB0B,EAAM,UACJ7B,EAAI,+BAA+B,CACrC,CAEJ,EAAG,EAAK,EAER,KAAK,iBAAiB,yBAA0B,SAAU6B,EAAO,CAG/DA,EAAM,WAAW,SAAY,CAC3B,GAAI,CACF,IAAIvB,EAAe,KACfuB,EAAM,kBACRvB,EAAe,MAAM,KAAK,aAAa,YAAY,UAAUuB,EAAM,gBAAgB,OAAO,GAE5F,MAAM7B,EAAI,kCAAmCM,GAAc,OAAO,EAAGA,GAAc,QAAQ,oBAAoB,CACjH,OAASa,EAAG,CACV,QAAQ,MAAM,gDAAiDA,CAAC,CAClE,CACF,GAAG,CAAC,CACN,EAAG,EAAK,EAER,KAAK,iBAAiB,eAAiBU,GAAU,CAC3CA,EAAM,MAAQ,0BAChBA,EAAM,UACJ7B,EAAI,+BAA+B,CACrC,CAEJ,CAAC,EClQDkC,EAAI,yBAA0B,CAC5B,yBAA2BC,GACXD,EAAI,oBAAoB,EAAE,mBAEzBC,CAAI,GAAK,KAE1B,gCAAkCC,GAClBF,EAAI,oBAAoB,EAAE,0BACzBE,CAAE,GAAK,KAExB,mBAAoB,CAACD,EAAc,CAAE,UAAAE,CAAU,EAA4B,CAAE,UAAW,EAAM,IAAM,CAClG,GAAI,CAACA,EAAW,CACd,IAAMC,EAASJ,EAAI,yBAA0BC,CAAI,EACjD,GAAIG,EAIF,OAAO,QAAQ,QAAQA,CAAM,CAEjC,CACA,OAAO,MAAM,GAAGJ,EAAI,qBAAsB,SAAS,CAAC,SAAS,mBAAmBC,CAAI,CAAC,EAAE,EAAE,KAAM,GAAc,CAC3G,GAAI,CAAC,EAAE,GAAI,CAET,GADA,QAAQ,KAAK,qBAAqB,EAAE,MAAM,QAAQA,CAAI,EAAE,EACpD,EAAE,SAAW,IACf,MAAM,IAAI,MAAM,GAAG,EAAE,MAAM,KAAK,EAAE,UAAU,EAAE,EAEhD,OAAO,IACT,CACA,OAAO,EAAE,KAAQ,CACnB,CAAC,EAAE,KAAKI,GAAS,CACf,GAAIA,IAAU,KAAM,CAClB,IAAMC,EAAcN,EAAI,iBAAiB,EAAE,YACrCO,EAAYP,EAAI,oBAAoB,EACrCO,EAAU,kBAAkBD,EAAYC,EAAW,mBAAoB,OAAO,OAAO,IAAI,CAAC,EAC1FA,EAAU,yBAAyBD,EAAYC,EAAW,0BAA2B,OAAO,OAAO,IAAI,CAAC,EAC7G,IAAMC,EAAQD,EAAU,iBAClBE,EAAeF,EAAU,wBAC/BD,EAAYE,EAAOP,EAAMI,CAAK,EAC9BC,EAAYG,EAAcJ,EAAOJ,CAAI,EACrCD,EAAI,wBAAyBU,GAAwB,CAAE,KAAAT,EAAM,MAAAI,CAAM,CAAC,CACtE,KAAO,CACL,IAAME,EAAYP,EAAI,oBAAoB,EACpCQ,EAAQD,EAAU,iBAClBI,EAAeH,IAAQP,CAAI,EACjC,GAAIU,EAAc,CAChB,IAAMC,EAAcZ,EAAI,iBAAiB,EAAE,YACrCS,EAAeF,EAAU,wBAE/BK,EAAYJ,EAAOP,CAAI,EACnBQ,EAAaE,CAAY,IAAMV,GACjCW,EAAYJ,EAAOG,CAAY,EAEjCX,EAAI,wBAAyBU,GAAwB,CAAE,KAAAT,EAAM,aAAcU,CAAa,CAAC,CAC3F,CACF,CACA,OAAON,CACT,CAAC,CACH,CACF,CAAC,ECzBD,QAAQ,KAAK,cAAe,OAAsB,EAClD,QAAQ,KAAK,kBAAmB,QAA0B,EAC1D,QAAQ,KAAK,qBAAsB,OAA6B,EAChE,QAAQ,KAAK,sBAAuB,MAA8B,EAClE,QAAQ,KAAK,YAAa,YAAoB,EAY9CQ,GAAa,SAASC,CAAS,EAC/BD,GAAa,SAASE,EAAM,EAS5B,IAAMC,GAAU,CAACC,EAAGC,KAAQD,EAAEC,CAAC,EAAI,GAAaD,GAE1CE,GAAkB,CACtB,MACA,gBACF,EAAE,OAAOH,GAAS,CAAC,CAAC,EAEdI,GAAoB,CACxB,kBACA,kBACA,qBACA,yBACA,sCACA,0BACA,mBACA,qBACA,sBACA,sBACA,iBACF,EAAE,OAAOJ,GAAS,CAAC,CAAC,EACpBK,EAAI,yBAA0B,CAACC,EAAQC,EAAUC,IAAS,CACpDL,GAAgBG,CAAM,GAAKF,GAAkBG,CAAQ,GACzD,QAAQ,MAAM,SAASA,CAAQ,GAAIC,CAAI,CACzC,CAAC,EAID,IAAMC,GAAiB,IAAM,CAC3B,IAAMC,EAAYL,EAAI,oBAAoB,EAErCK,EAAU,WAAUA,EAAU,SAAW,OAAO,OAAO,IAAI,GAC3DA,EAAU,SAAS,2BAA0BA,EAAU,SAAS,yBAA2B,OAAO,OAAO,IAAI,GAC7GA,EAAU,SAAS,yBAAwBA,EAAU,SAAS,uBAAyB,OAAO,OAAO,IAAI,GACzGA,EAAU,SAAS,iBAAgBA,EAAU,SAAS,eAAiB,OAAO,OAAO,IAAI,GAEzFA,EAAU,eAAcA,EAAU,aAAe,OAAO,OAAO,IAAI,GAEnEA,EAAU,gBAAeA,EAAU,cAAgB,OAAO,OAAO,IAAI,GACrEA,EAAU,cAAc,QAAOA,EAAU,cAAc,MAAQ,CAAC,GAChEA,EAAU,cAAc,SAAQA,EAAU,cAAc,OAAS,OAAO,OAAO,IAAI,GAEnFA,EAAU,sCACbA,EAAU,oCAAsC,CAC9C,aAAc,OAAO,OAAO,IAAI,EAChC,QAAS,OAAO,OAAO,IAAI,CAC7B,GAGGA,EAAU,mBAAkBA,EAAU,iBAAmB,OAAO,OAAO,IAAI,GAC3EA,EAAU,0BAAyBA,EAAU,wBAA0B,OAAO,OAAO,IAAI,GAEzFA,EAAU,iBAAgBA,EAAU,eAAiB,OAAO,OAAO,IAAI,EAC9E,EAEAL,EAAI,sBAAuBM,GAAgBF,EAAc,EAEzD,IAAMG,GAAmB,IAAIC,IAAS,CACpC,KAAK,QAAQ,SAAS,EACnB,KAAMC,GAEE,QAAQ,IAAIA,EAAW,IAAI,MAAOC,GAChCA,EAAO,YAAY,GAAGF,CAAI,CAClC,CAAC,EAAE,MAAMG,GAAK,CACb,QAAQ,MAAM,2BAA4BH,EAAMG,CAAC,CACnD,CAAC,CACF,CACL,EAGC,CACCL,GAAgBM,GAAoBC,GACpCC,GAA6CC,GAC7CC,GAAeC,GAAOC,GAAaC,GAAQC,GAAaC,GACxDC,GAA2BC,GAAsBC,GACjDC,GAAeC,GAAYC,GAAiBC,GAAcC,GAC1DC,GAAkB,aAClBC,GAAiBC,GAAcC,GAAwBC,GACvDC,GAAiBC,GAAqBC,GACtCC,GAAsBC,GAA4BC,GAASC,GAC3DC,GAAcC,GAAqBC,GAAmBC,GAAeC,EACvE,EAAE,QAAQC,GAAM,CACd/C,EAAI,sBAAuB+C,EAAI,IAAIvC,IAAS,CAC1C,GAAM,CAAE,KAAAL,EAAM,cAAA6C,CAAc,EAAIC,GAAWzC,CAAI,EAM/CD,GALgB,CACd,KAAM,QACN,QAASwC,EACT,KAAA5C,CACF,EAC0B6C,CAAa,CACzC,CAAC,CACH,CAAC,EAEDhD,EAAI,sBAAuBkD,GAAsBC,GAAa,CAG5D,IAAMC,EAAW,CACf,SAAUD,EAAS,SACnB,KAAMA,EAAS,IACjB,EACM,CAAE,KAAAhD,EAAM,cAAA6C,CAAc,EAAIC,GAAW,CAACG,CAAQ,CAAC,EAMrD7C,GALgB,CACd,KAAM,QACN,QAAS2C,GACT,KAAA/C,CACF,EAC0B6C,CAAa,CACzC,CAAC,EAKDhD,EAAI,sBAAuBqD,GAA+B7C,GAAS,CAEjE,IAAM4C,EAAW,CAAE,GAAG5C,EAAM,KAAM,IAAK,EACjC,CAAE,KAAAL,EAAM,cAAA6C,CAAc,EAAIC,GAAW,CAACG,CAAQ,CAAC,EAMrD7C,GALgB,CACd,KAAM,QACN,QAAS8C,GACT,KAAAlD,CACF,EAC0B6C,CAAa,CACzC,CAAC,EACDhD,EAAI,sBAAuBsD,GAAqC9C,GAAS,CAEvE,IAAM4C,EAAW,CAAE,GAAG5C,EAAM,KAAM,IAAK,EACjC,CAAE,KAAAL,EAAM,cAAA6C,CAAc,EAAIC,GAAW,CAACG,CAAQ,CAAC,EAMrD7C,GALgB,CACd,KAAM,QACN,QAAS+C,GACT,KAAAnD,CACF,EAC0B6C,CAAa,CACzC,CAAC,EAIDhD,EAAI,sBAAuBuD,GAAe,IAAI/C,IAAS,CACrD,GAAM,CAAE,KAAAL,EAAM,cAAA6C,CAAc,EAAIC,GAAWzC,CAAI,EAK/CD,GAJgB,CACd,KAAMgD,GACN,KAAApD,CACF,EAC0B6C,CAAa,CACzC,CAAC,EAEDhD,EAAI,yBAA0B,CAC5B,mBAAoB,IAAMA,EAAI,oBAAoB,EAClD,sBAAuB,IAAM,CAE3B,IAAIwD,EAEJ,MAAO,KACAA,IACHA,EAAkB,OAAO,OAAO,IAAI,EACpC,OAAO,iBAAiBA,EAAiB,OAAO,YAAY,OAAO,QAAQC,EAAO,EAAE,IAAI,CAAC,CAACC,EAAQC,CAAE,IAC3F,CAACD,EAAQ,CACd,IAAK,UAAY,CACf,IAAME,EAAQ5D,EAAI,oBAAoB,EAStC,OAAO2D,EAAGC,EAAO,IAAI,CACvB,CACF,CAAC,CACF,CAAC,CAAC,EACH,OAAO,iBAAiBJ,EAAiB,OAAO,YAAY,OAAO,QAAQC,EAAe,EAAE,IAAI,CAAC,CAACC,EAAQC,CAAE,IACnG,CAACD,EAAQ,CACd,IAAK,UAAY,CACf,IAAME,EAAQ5D,EAAI,oBAAoB,EAKtC,OAAO2D,EAAGC,EAAM,UAAY,CAAC,EAAG,KAAMA,CAAK,CAC7C,CACF,CAAC,CACF,CAAC,CAAC,EACH,OAAO,iBAAiBJ,EAAiB,OAAO,YAAY,OAAO,QAAQC,EAAmB,EAAE,IAAI,CAAC,CAACC,EAAQC,CAAE,IACvG,CAACD,EAAQ,CACd,IAAK,UAAY,CACf,IAAME,EAAQ5D,EAAI,oBAAoB,EAKtC,OAAO2D,EAAGC,EAAM,eAAiB,CAAC,EAAG,KAAMA,CAAK,CAClD,CACF,CAAC,CACF,CAAC,CAAC,EACH,OAAO,eAAeJ,EAAiB,+BAAgC,CACrE,IAAK,UAAY,CACf,OAAQI,GAAU,KAAK,6BAA6BA,EAAO,IAAI,IAAM,CACvE,CACF,CAAC,GAGIJ,EAEX,GAAG,CACL,CAAC,EAED,IAAMK,GAAc,IAAI,IAAI,KAAK,QAAQ,EAEzC7D,EAAI,yBAA0B,CAC5B,oBAAqB,KACZ,CAAE,QAAS,CAAE,KAAM6D,GAAY,aAAa,IAAI,YAAY,CAAE,CAAE,EAE3E,CAAC,EAED7D,EAAI,yBAA0B,CAC5B,eAAgB,IAAMA,EAAI,aAAa,CACzC,CAAC,EAEDA,EAAI,yBAA0B,CAC5B,aAAc,KACL,CACL,WAAY,QACZ,eAAgB,SAChB,kBAAmB,QACnB,mBAAoB,OACpB,SAAU,YACZ,GAEF,wBAAyB,CAAC8D,EAAKC,IAAU,CACvC,IAAMC,EAAchE,EAAI,iBAAiB,EAAE,YACrCK,EAAYL,EAAI,oBAAoB,EAC1CgE,EAAY3D,EAAU,eAAgByD,EAAKC,CAAK,CAClD,EACA,wBAA0BD,GACjB9D,EAAI,oBAAoB,EAAE,eAAe8D,CAAG,CAEvD,CAAC,EAED9D,EAAI,+CAAgDiE,EAA2B,EAK/EjE,EAAI,sBAAuBM,GAAgB,IAAM,CAC/CN,EAAI,mDAAmD,EACvDA,EAAI,+BAA+B,CACrC,CAAC,EAED,IAAIkE,GACJlE,EAAI,sBAAuB8B,GAAkB,aAAeqC,GAAgB,CAC1ED,GAAqBC,CACvB,CAAC,EAEDnE,EAAI,qBAAsB,UAAW,KAAK,SAAS,MAAM,EACzDI,GAAe,EACf,IAAMgE,GAAeC,GAAc,EAEnC,KAAK,iBAAiB,UAAW,SAAUC,EAAO,CAChD,QAAQ,MAAM,cAAc,EAI5BA,EAAM,UAAUF,GAAa,KAAK,IAAM,KAAK,YAAY,CAAC,CAAC,CAC7D,CAAC,EAED,KAAK,iBAAiB,WAAY,SAAUE,EAAO,CACjD,QAAQ,MAAM,eAAe,EAG7BA,EAAM,UAAU,KAAK,QAAQ,MAAM,CAAC,CACtC,CAAC,EAED,KAAK,iBAAiB,QAAS,SAAUA,EAAO,CAC9C,QAAQ,MAAM,gBAAgBA,EAAM,QAAQ,MAAM,MAAMA,EAAM,QAAQ,GAAG,EAAE,CAC7E,CAAC,EAmBD,KAAK,iBAAiB,UAAW,SAAUA,EAAO,CAIhD,GAHA,QAAQ,MAAM,qBAAqBA,EAAM,OAAO,EAAE,YAAYA,EAAM,MAAM,IAAI,GAAG,EAG7E,OAAOA,EAAM,MAAS,UAAYA,EAAM,KAAK,KAE/C,OADA,QAAQ,MAAM,uBAAwBA,EAAM,IAAI,EACxCA,EAAM,KAAK,KAAM,CACvB,IAAK,MAAO,CAGV,IAAMC,EAAOD,EAAM,KAAK,MACtB,SAAY,MAAMtE,EAAI,GAAGR,GAAa8E,EAAM,KAAK,IAAI,CAAC,GAAG,EAAE,KAAM,GAAM,CACvE,GAAM,CAAE,KAAAnE,EAAM,cAAA6C,CAAc,EAAIC,GAAW,CAAC,EAC5CsB,EAAK,YAAY,CAAC,GAAMpE,CAAI,EAAG6C,CAAa,CAC9C,CAAC,EAAE,MAAOrC,GAAM,CACd,GAAM,CAAE,KAAAR,EAAM,cAAA6C,CAAc,EAAIC,GAAWtC,CAAC,EAC5C4D,EAAK,YAAY,CAAC,GAAOpE,CAAI,EAAG6C,CAAa,CAC/C,CAAC,EAAE,QAAQ,IAAM,CACfuB,EAAK,MAAM,CACb,CAAC,EACD,KACF,CACA,IAAK,OACHD,EAAM,OAAO,YAAY,CAAE,KAAM,MAAO,CAAC,EACzC,MACF,IAAK,WACH,KAAK,aAAa,WAAW,EAC1B,KAAK,UAAY,CAChB,OAAO,KAAK,QAAQ,SAAS,CAC/B,CAAC,EACA,KAAK,SAAUE,EAAS,CAGvBA,EAAQ,QAAQ9D,GAAUA,EAAO,SAASA,EAAO,GAAG,CAAC,CACvD,CAAC,EACH,MACF,IAAK,eACH,KAAK,YAAY,EACjB,MACF,IAAK,QACHV,EAAI,wBAAyBsE,EAAM,KAAK,QAAS,GAAG9E,GAAa8E,EAAM,KAAK,IAAI,CAAC,EACjF,MACF,IAAK,QAAS,CAGZ,IAAMC,EAAOD,EAAM,KAAK,KACxB,QAAQ,KAAK,CACXD,GAAc,EACd,IAAI,QAAQ,CAACI,EAASC,IAAW,CAC/B,WAAW,IAAM,CACfA,EAAO,IAAI,MAAM,+BAA+B,CAAC,CACnD,EAAG,GAAI,CACT,CAAC,CACH,CAAC,EAAE,KAAK,IAAM,CACZH,EAAK,YAAY,CACf,KAAM,QACN,aAAcvE,EAAI,gCAAgC,EAClD,WAAY,OACd,CAAC,CACH,EAAIW,GAAM,CACR4D,EAAK,YAAY,CAAE,KAAM,QAAS,MAAO5D,CAAE,CAAC,CAC9C,CAAC,EAAE,QAAQ,IAAM,CACf4D,EAAK,MAAM,CACb,CAAC,EAQCL,IACAI,EAAM,QACNA,EAAM,KAAK,aAAeJ,GAAmB,YAE7CI,EAAM,OAAO,YAAY,CACvB,KAAM,QACN,QAASxC,GAAkB,aAC3B,KAAM,CAACoC,EAAkB,CAC3B,CAAC,EAEH,KACF,CACA,QACE,QAAQ,MAAM,6BAA8BI,EAAM,IAAI,EACtD,KACJ,MAEA,QAAQ,MAAM,wBAAyBA,EAAM,IAAI,CAErD,CAAC,EAGD,KAAK,iBAAiB,oBAAqBA,GAAS,CAClD,QAAQ,MAAM,6BAA8BA,EAAM,YAAY,EAC9DA,EAAM,aAAa,MAAM,EAEzBA,EAAM,UACJ,KAAK,QAAQ,SAAS,CAAE,KAAM,QAAS,CAAC,EAAE,KAAM7D,GAAe,CAiB7D,GAhBAA,EAAW,KAAK,CAACkE,EAAGC,IAAM,CACxB,GAAID,EAAE,UAAYC,EAAE,QAClB,OAAOD,EAAE,QAAU,GAAK,EAE1B,GAAIA,EAAE,kBAAoBC,EAAE,gBAAiB,CAE3C,GAAID,EAAE,kBAAoB,UAAW,MAAO,GAE5C,GADIC,EAAE,kBAAoB,WACtBD,EAAE,kBAAoB,SAAU,MAAO,GAC3C,GAAIC,EAAE,kBAAoB,SAAU,MAAO,EAC7C,CAEA,MAAO,EACT,CAAC,EAGG,CAACnE,EAAW,OACd,OAAO,KAAK,QAAQ,WAAW,GAAGT,EAAI,mBAAmB,EAAE,QAAQ,IAAI,GAAGsE,EAAM,aAAa,KAAK,MAAQ,GAAG,EAAE,EAAE,KAAM5D,GAAW,CAChI,GAAI4D,EAAM,aAAa,MAAM,cAAe,CAC1C,GAAM,CAAE,KAAAnE,CAAK,EAAI8C,GAAWqB,EAAM,aAAa,KAAK,aAAa,EACjE5D,EAAO,YAAY,CACjB,KAAM,MACN,KAAAP,CACF,CAAC,CACH,MAAWmE,EAAM,aAAa,MAAM,SAClC5D,EAAO,YAAY,CACjB,KAAM,MACN,KAAM,CAAC,oBAAqB,oBAAqB,CAAE,WAAY4D,EAAM,aAAa,KAAK,OAAQ,CAAC,CAClG,CAAC,EAGH,OAAO5D,CACT,CAAC,EAGH,IAAMA,EAASD,EAAW,CAAC,EAC3B,GAAI6D,EAAM,aAAa,MAAM,cAAe,CAC1C,GAAM,CAAE,KAAAnE,CAAK,EAAI8C,GAAWqB,EAAM,aAAa,KAAK,aAAa,EACjE5D,EAAO,YAAY,CACjB,KAAM,MACN,KAAAP,CACF,CAAC,CACH,MAAWmE,EAAM,aAAa,MAAM,MAClC5D,EAAO,YAAY,CACjB,KAAM,WACN,QAAS4D,EAAM,aAAa,KAAK,QACjC,KAAMA,EAAM,aAAa,KAAK,IAChC,CAAC,EAEH,GAAI,CAAC5D,EAAO,QAAS,OAAOA,EAAO,MAAM,CAC3C,CAAC,CAAC,CACN,CAAC,EAEDV,EAAI,sBAAuB6B,GAAU,CAAC,CAAE,WAAAgD,EAAY,IAAAf,EAAK,KAAA3D,CAAK,IAAM,CAClE,IAAME,EAAYL,EAAI,oBAAoB,EACpC8E,EAAwBzE,EAAU,UAAU,mBAClD,GAAIwE,IAAeC,EAGnB,QAAQhB,EAAK,CACX,KAAKiB,GAAQ,eAAgB,CAC3B1E,EAAU,aAAawE,CAAU,EAAI1E,EACrC,KACF,CACA,KAAK4E,GAAQ,gBAAiB,CAC5B1E,EAAU,SAAS,eAAiBF,EACpC,KACF,CACA,KAAK4E,GAAQ,YAAa,CACxB1E,EAAU,YAAcF,EACxB,KACF,CACA,KAAK4E,GAAQ,cAAe,CAC1B1E,EAAU,cAAc,OAASF,EACjC,KACF,CACA,QACE,MACJ,CACAH,EAAI,wBAAyBgF,EAAuB,EACtD,CAAC,EAEDhF,EAAI,sBAAuBqD,GAA8B,CAAC,CAAE,WAAA4B,EAAY,YAAAC,CAAY,IAAM,CACxF,IAAM7E,EAAYL,EAAI,oBAAoB,EACtCkF,EACF7E,EAAU,SAAS,uBAAuB4E,CAAU,EAAIC,EAExD,OAAO7E,EAAU,SAAS,uBAAuB4E,CAAU,EAE7DjF,EAAI,wBAAyBgF,EAAuB,CACtD,CAAC,EAEDhF,EAAI,sBAAuBqC,GAAuB8C,GAAiB,CACjE,IAAM9E,EAAYL,EAAI,kBAAkB,EAClCoF,EAAcpF,EAAI,oBAAoB,EACtCqF,EAAOF,EAAa,cAAgBC,EAAY,uBAAuBD,EAAa,YAAY,GAAG,QACrGC,EAAY,uBAAuBD,EAAa,YAAY,EAAE,QAC7DA,EAAa,SAAW9E,EAAU8E,EAAa,OAAO,EACnDC,EAAY,sBAAsB/E,EAAU8E,EAAa,OAAO,CAAC,EAAE,aACnE,OAERG,GAAiB,CACf,KAAMD,GAAQ,OACd,MAAOF,EAAa,MACpB,KAAMA,EAAa,cACnB,QAASA,EAAa,QACtB,KAAMA,EAAa,OACnB,cAAeA,EAAa,aAC9B,CAAC,EAAE,MAAMxE,GAAK,CACZ,QAAQ,MAAM,uCAAwCA,CAAC,CACzD,CAAC,CACH,CAAC,EAIDX,EAAI,sBAAuBkC,GAAoB,CAAC,CAAC2C,EAAY1E,CAAI,IAAM,CACrE,IAAME,EAAYL,EAAI,kBAAkB,EACxCK,EAAU,aAAawE,CAAU,EAAI1E,CACvC,CAAC,EACDH,EAAI,sBAAuBmC,GAAkBoD,GAAgB,CAC3D,IAAMlF,EAAYL,EAAI,kBAAkB,EACxCK,EAAU,YAAckF,CAC1B,CAAC,EACDvF,EAAI,sBAAuBoC,GAAsBoD,GAAkC,CACjF,IAAMnF,EAAYL,EAAI,kBAAkB,EACxCK,EAAU,SAAS,eAAiBmF,CACtC,CAAC,EACDxF,EAAI,sBAAuBsD,GAAoC,CAAC,CAAE,WAAA2B,EAAY,SAAAQ,CAAS,IAAM,CAC3F,IAAMpF,EAAYL,EAAI,oBAAoB,EAC1C,GAAIiF,EAAY,CACT5E,EAAU,SAAS,yBAAyB4E,CAAU,IACzD5E,EAAU,SAAS,yBAAyB4E,CAAU,EAAI,CAAC,GAE7D,QAAWnB,KAAO2B,EAChBpF,EAAU,SAAS,yBAAyB4E,CAAU,EAAEnB,CAAG,EAAI2B,EAAS3B,CAAG,CAE/E,CACF,CAAC",
  "names": ["require_util", "__commonJSMin", "exports", "module", "ERROR_MSG_INPUT", "normalizeInput", "input", "ret", "toHex", "bytes", "n", "uint32ToHex", "val", "debugPrint", "label", "arr", "size", "msg", "i", "testSpeed", "hashFn", "N", "M", "startMs", "genMs", "hashHex", "hashMs", "ms", "require_blake2b", "__commonJSMin", "exports", "module", "util", "ADD64AA", "v", "a", "b", "o0", "o1", "ADD64AC", "b0", "b1", "B2B_GET32", "arr", "i", "B2B_G", "c", "d", "ix", "iy", "x0", "m", "x1", "y0", "y1", "xor0", "xor1", "BLAKE2B_IV32", "SIGMA8", "SIGMA82", "x", "blake2bCompress", "ctx", "last", "parameterBlock", "blake2bInit", "outlen", "key", "salt", "personal", "blake2bUpdate", "input", "blake2bFinal", "out", "blake2b", "blake2bHex", "output", "require_blake2s", "__commonJSMin", "exports", "module", "util", "B2S_GET32", "v", "i", "B2S_G", "a", "b", "c", "d", "x", "y", "ROTR32", "BLAKE2S_IV", "SIGMA", "m", "blake2sCompress", "ctx", "last", "blake2sInit", "outlen", "key", "keylen", "blake2sUpdate", "input", "blake2sFinal", "out", "blake2s", "blake2sHex", "output", "require_blakejs", "__commonJSMin", "exports", "module", "b2b", "b2s", "require_base64_js", "__commonJSMin", "exports", "byteLength", "toByteArray", "fromByteArray", "lookup", "revLookup", "Arr", "code", "i", "len", "getLens", "b64", "validLen", "placeHoldersLen", "lens", "_byteLength", "tmp", "arr", "curByte", "tripletToBase64", "num", "encodeChunk", "uint8", "start", "end", "output", "extraBytes", "parts", "maxChunkLength", "len2", "require_ieee754", "__commonJSMin", "exports", "buffer", "offset", "isLE", "mLen", "nBytes", "e", "m", "eLen", "eMax", "eBias", "nBits", "i", "d", "s", "value", "c", "rt", "require_buffer", "__commonJSMin", "exports", "base64", "ieee754", "customInspectSymbol", "Buffer", "SlowBuffer", "K_MAX_LENGTH", "typedArraySupport", "arr", "proto", "createBuffer", "length", "buf", "arg", "encodingOrOffset", "allocUnsafe", "from", "value", "fromString", "fromArrayView", "isInstance", "fromArrayBuffer", "valueOf", "b", "fromObject", "assertSize", "size", "alloc", "fill", "encoding", "checked", "string", "byteLength", "actual", "fromArrayLike", "array", "i", "arrayView", "copy", "byteOffset", "obj", "len", "numberIsNaN", "a", "x", "y", "list", "buffer", "pos", "mustMatch", "loweredCase", "utf8ToBytes", "base64ToBytes", "slowToString", "start", "end", "hexSlice", "utf8Slice", "asciiSlice", "latin1Slice", "base64Slice", "utf16leSlice", "swap", "n", "m", "str", "max", "target", "thisStart", "thisEnd", "thisCopy", "targetCopy", "bidirectionalIndexOf", "val", "dir", "arrayIndexOf", "indexSize", "arrLength", "valLength", "read", "foundIndex", "found", "j", "hexWrite", "offset", "remaining", "strLen", "parsed", "utf8Write", "blitBuffer", "asciiWrite", "asciiToBytes", "base64Write", "ucs2Write", "utf16leToBytes", "res", "firstByte", "codePoint", "bytesPerSequence", "secondByte", "thirdByte", "fourthByte", "tempCodePoint", "decodeCodePointsArray", "MAX_ARGUMENTS_LENGTH", "codePoints", "ret", "out", "hexSliceLookupTable", "bytes", "newBuf", "checkOffset", "ext", "noAssert", "mul", "defineBigIntMethod", "validateNumber", "first", "last", "boundsError", "lo", "hi", "checkInt", "min", "maxBytes", "wrtBigUInt64LE", "checkIntBI", "wrtBigUInt64BE", "limit", "sub", "checkIEEE754", "writeFloat", "littleEndian", "writeDouble", "targetStart", "code", "errors", "E", "sym", "getMessage", "Base", "name", "range", "input", "msg", "received", "addNumericalSeparator", "checkBounds", "type", "INVALID_BASE64_RE", "base64clean", "units", "leadSurrogate", "byteArray", "c", "src", "dst", "alphabet", "table", "i16", "fn", "BufferBigIntNotDefined", "require_scrypt_async", "__commonJSMin", "exports", "module", "scrypt", "password", "salt", "logN", "r", "dkLen", "interruptStep", "callback", "encoding", "SHA256", "m", "K", "h0", "h1", "h2", "h3", "h4", "h5", "h6", "h7", "w", "blocks", "p", "off", "len", "a", "b", "c", "d", "e", "f", "g", "h", "u", "i", "j", "t1", "t2", "bytesLeft", "bitLenHi", "bitLenLo", "numZeros", "PBKDF2_HMAC_SHA256_OneIter", "innerLen", "inner", "outerKey", "dk", "incrementCounter", "salsaXOR", "tmp", "B", "bin", "bout", "j0", "j1", "j2", "j3", "j4", "j5", "j6", "j7", "j8", "j9", "j10", "j11", "j12", "j13", "j14", "j15", "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8", "x9", "x10", "x11", "x12", "x13", "x14", "x15", "blockCopy", "dst", "di", "src", "si", "blockXOR", "blockMix", "integerify", "bi", "stringToUTF8Bytes", "s", "arr", "bytesToHex", "enc", "bytesToBase64", "t", "MAX_UINT", "opts", "N", "XY", "V", "xi", "yi", "smixStart", "pos", "smixStep1", "start", "end", "smixStep2", "smixFinish", "nextTick", "interruptedFor", "step", "fn", "donefn", "performStep", "getResult", "result", "calculateSync", "calculateAsync", "require_nacl_fast", "__commonJSMin", "exports", "module", "nacl", "gf", "init", "i", "r", "randombytes", "_0", "_9", "gf0", "gf1", "_121665", "D", "D2", "X", "Y", "I", "ts64", "x", "h", "vn", "xi", "yi", "n", "d", "crypto_verify_16", "crypto_verify_32", "core_salsa20", "o", "p", "k", "c", "j0", "j1", "j2", "j3", "j4", "j5", "j6", "j7", "j8", "j9", "j10", "j11", "j12", "j13", "j14", "j15", "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8", "x9", "x10", "x11", "x12", "x13", "x14", "x15", "u", "core_hsalsa20", "crypto_core_salsa20", "out", "inp", "crypto_core_hsalsa20", "sigma", "crypto_stream_salsa20_xor", "cpos", "m", "mpos", "z", "crypto_stream_salsa20", "b", "crypto_stream", "s", "sn", "crypto_stream_xor", "poly1305", "key", "t0", "t1", "t2", "t3", "t4", "t5", "t6", "t7", "bytes", "hibit", "d0", "d1", "d2", "d3", "d4", "d5", "d6", "d7", "d8", "d9", "h0", "h1", "h2", "h3", "h4", "h5", "h6", "h7", "h8", "h9", "r0", "r1", "r2", "r3", "r4", "r5", "r6", "r7", "r8", "r9", "mac", "macpos", "g", "mask", "f", "want", "crypto_onetimeauth", "outpos", "crypto_onetimeauth_verify", "hpos", "crypto_secretbox", "crypto_secretbox_open", "set25519", "a", "car25519", "v", "sel25519", "q", "t", "pack25519", "j", "neq25519", "par25519", "unpack25519", "A", "Z", "M", "t8", "t9", "t10", "t11", "t12", "t13", "t14", "t15", "t16", "t17", "t18", "t19", "t20", "t21", "t22", "t23", "t24", "t25", "t26", "t27", "t28", "t29", "t30", "b0", "b1", "b2", "b3", "b4", "b5", "b6", "b7", "b8", "b9", "b10", "b11", "b12", "b13", "b14", "b15", "S", "inv25519", "pow2523", "crypto_scalarmult", "e", "x32", "x16", "crypto_scalarmult_base", "crypto_box_keypair", "y", "crypto_box_beforenm", "crypto_box_afternm", "crypto_box_open_afternm", "crypto_box", "crypto_box_open", "K", "crypto_hashblocks_hl", "hh", "hl", "wh", "wl", "bh0", "bh1", "bh2", "bh3", "bh4", "bh5", "bh6", "bh7", "bl0", "bl1", "bl2", "bl3", "bl4", "bl5", "bl6", "bl7", "th", "tl", "l", "ah0", "ah1", "ah2", "ah3", "ah4", "ah5", "ah6", "ah7", "al0", "al1", "al2", "al3", "al4", "al5", "al6", "al7", "pos", "crypto_hash", "add", "cswap", "pack", "tx", "ty", "zi", "scalarmult", "scalarbase", "crypto_sign_keypair", "pk", "sk", "seeded", "L", "modL", "carry", "reduce", "crypto_sign", "sm", "smlen", "unpackneg", "chk", "num", "den", "den2", "den4", "den6", "crypto_sign_open", "crypto_secretbox_KEYBYTES", "crypto_secretbox_NONCEBYTES", "crypto_secretbox_ZEROBYTES", "crypto_secretbox_BOXZEROBYTES", "crypto_scalarmult_BYTES", "crypto_scalarmult_SCALARBYTES", "crypto_box_PUBLICKEYBYTES", "crypto_box_SECRETKEYBYTES", "crypto_box_BEFORENMBYTES", "crypto_box_NONCEBYTES", "crypto_box_ZEROBYTES", "crypto_box_BOXZEROBYTES", "crypto_sign_BYTES", "crypto_sign_PUBLICKEYBYTES", "crypto_sign_SECRETKEYBYTES", "crypto_sign_SEEDBYTES", "crypto_hash_BYTES", "checkLengths", "checkBoxLengths", "checkArrayTypes", "cleanup", "arr", "msg", "nonce", "box", "publicKey", "secretKey", "signedMsg", "tmp", "mlen", "sig", "seed", "fn", "crypto", "QUOTA", "__require", "serdesTagSymbol", "serdesSerializeSymbol", "serdesDeserializeSymbol", "rawResult", "rawResultSet", "obj", "serializer", "data", "verbatim", "transferables", "revokables", "_key", "value", "pos", "mc", "ev", "result", "deserializer", "e", "proto", "deserializerTable", "mp", "args", "resolve", "reject", "ctor", "INVITE_INITIAL_CREATOR", "PROFILE_STATUS", "PROPOSAL_RESULT", "PROPOSAL_INVITE_MEMBER", "PROPOSAL_REMOVE_MEMBER", "PROPOSAL_GROUP_SETTING_CHANGE", "PROPOSAL_PROPOSAL_SETTING_CHANGE", "PROPOSAL_GENERIC", "PROPOSAL_ARCHIVED", "MAX_SAVED_PERIODS", "MAX_GROUP_MEMBER_COUNT", "STATUS_OPEN", "STATUS_PASSED", "STATUS_FAILED", "STATUS_EXPIRING", "STATUS_EXPIRED", "STATUS_CANCELLED", "GROUP_PERMISSIONS", "GP", "GROUP_PERMISSIONS_PRESET", "CHATROOM_MEMBER_MENTION_SPECIAL_CHAR", "CHATROOM_CHANNEL_MENTION_SPECIAL_CHAR", "MESSAGE_RECEIVE_RAW", "MESSAGE_RECEIVE", "MESSAGE_SEND", "CHATROOM_TYPES", "CHATROOM_PRIVACY_LEVEL", "MESSAGE_TYPES", "INVITE_EXPIRES_IN_DAYS", "MESSAGE_NOTIFY_SETTINGS", "common_exports", "__export", "errors_exports", "GIErrorIgnoreAndBan", "GIErrorMissingSigningKeyError", "GIErrorUIRuntimeError", "L", "LError", "LTags", "selectors", "domains", "globalFilters", "domainFilters", "selectorFilters", "unsafeSelectors", "DOMAIN_REGEX", "sbp", "selector", "data", "domain", "domainFromSelector", "starSelector", "selExists", "sel", "filters", "filter", "domainLookup", "SBP_BASE_SELECTORS", "sels", "registered", "domainName", "fn", "_a", "domainNames", "name", "esm_default", "nargs", "template", "string", "args", "firstArg", "replacementsByKey", "match", "capture", "index", "maybeReplacement", "defaultLanguage", "defaultLanguageCode", "defaultTranslationTable", "currentLanguage", "currentLanguageCode", "currentTranslationTable", "translations_default", "esm_default", "language", "languageCode", "error", "LTags", "tags", "o", "tag", "L", "key", "args", "template", "LError", "toGithub", "url", "errors_exports", "__export", "GIErrorIgnoreAndBan", "GIErrorMissingSigningKeyError", "GIErrorUIRuntimeError", "ChelErrorGenerator", "name", "base", "params", "ChelErrorWarning", "ChelErrorAlreadyProcessed", "ChelErrorDBBadPreviousHEAD", "ChelErrorDBConnection", "ChelErrorUnexpected", "ChelErrorKeyAlreadyExists", "ChelErrorUnrecoverable", "ChelErrorForkedChain", "ChelErrorDecryptionError", "ChelErrorDecryptionKeyNotFound", "ChelErrorSignatureError", "ChelErrorSignatureKeyUnauthorized", "ChelErrorSignatureKeyNotFound", "ChelErrorFetchServerTimeFailed", "ChelErrorUnexpectedHttpResponseCode", "ChelErrorResourceGone", "GIErrorIgnoreAndBan", "ChelErrorGenerator", "GIErrorUIRuntimeError", "GIErrorMissingSigningKeyError", "MINS_MILLIS", "HOURS_MILLIS", "DAYS_MILLIS", "MONTHS_MILLIS", "YEARS_MILLIS", "plusOnePeriodLength", "timestamp", "periodLength", "dateToPeriodStamp", "addTimeToDate", "minusOnePeriodLength", "periodStampsForDate", "date", "knownSortedStamps", "guess", "isIsoString", "previous", "current", "next", "latest", "earliest", "periodStampGivenDate", "i", "dateToPeriodStamp", "date", "dateFromPeriodStamp", "daystamp", "periodStampGivenDate", "recentDate", "periodStart", "periodLength", "periodStartDate", "nextPeriod", "addTimeToDate", "curDate", "curPeriod", "dateIsWithinPeriod", "dateObj", "start", "timeMillis", "d", "comparePeriodStamps", "periodA", "periodB", "dateFromPeriodStamp", "getLocale", "fallback", "humanDate", "date", "options", "dateObj", "locale", "isIsoString", "arg", "EMPTY_VALUE", "isEmpty", "v", "isNil", "isUndef", "isBoolean", "isNumber", "isString", "isObject", "isFunction", "getType", "typeFn", "_options", "isFunction", "TypeValidatorError", "_TypeValidatorError", "message", "expectedType", "valueType", "value", "typeName", "typeScope", "errMessage", "fileName", "validatorError", "scope", "literalOf", "primitive", "literal", "value", "_scope", "isEmpty", "validatorError", "isBoolean", "object", "value", "isEmpty", "isObject", "validatorError", "objectOf", "typeObj", "_scope", "object2", "typeAttrs", "unknownAttr", "attr", "undefAttr", "property", "getType", "reducer", "acc", "key", "typeFn", "undef", "value", "_scope", "isEmpty", "isUndef", "validatorError", "number", "value", "_scope", "isEmpty", "isNumber", "validatorError", "string", "value", "_scope", "isEmpty", "isString", "validatorError", "unionOf_", "typeFuncs", "union", "value", "_scope", "typeFn", "validatorError", "fn", "getType", "unionOf", "shortestDelay", "PERIODIC_NOTIFICATION_TYPE", "ephemeralNotificationState", "typeToDelayMap", "MINS_MILLIS", "validateNotificationData", "objectOf", "value", "string", "isFunction", "runNotificationListRecursive", "rootState", "esm_default", "rootGetters", "firedMap", "lastRunMap", "callWithStates", "func", "stateKey", "aborted", "abort", "queue", "invocations", "entry", "lastRun", "delay", "e", "timeoutId", "clearTimeoutObject", "entries", "keySet", "type", "notificationData", "MAX_AGE_READ", "DAYS_MILLIS", "MAX_AGE_UNREAD", "empty", "equals", "aa", "bb", "ii", "coerce", "o", "base", "ALPHABET", "name", "BASE_MAP", "j", "i", "x", "xc", "BASE", "LEADER", "FACTOR", "iFACTOR", "encode", "source", "zeroes", "length", "pbegin", "pend", "size", "b58", "carry", "it1", "it2", "str", "decodeUnsafe", "psz", "b256", "it3", "it4", "vch", "decode", "string", "buffer", "src", "_brrp__multiformats_scope_baseX", "base_x_default", "Encoder", "name", "prefix", "baseEncode", "bytes", "Decoder", "baseDecode", "text", "decoder", "or", "ComposedDecoder", "decoders", "input", "left", "right", "_a", "_b", "Codec", "from", "encode", "decode", "baseX", "alphabet", "base_x_default", "coerce", "string", "bitsPerChar", "codes", "i", "end", "out", "bits", "buffer", "written", "value", "data", "pad", "mask", "rfc4648", "base58btc", "baseX", "base58flickr", "import_blakejs", "encode_1", "encode", "MSB", "REST", "MSBALL", "INT", "num", "out", "offset", "oldOffset", "decode", "read", "MSB$1", "REST$1", "buf", "res", "shift", "counter", "b", "l", "N1", "N2", "N3", "N4", "N5", "N6", "N7", "N8", "N9", "length", "value", "varint", "_brrp_varint", "varint_default", "decode", "data", "offset", "varint_default", "encodeTo", "int", "target", "encodingLength", "create", "code", "digest", "size", "sizeOffset", "encodingLength", "digestOffset", "bytes", "encodeTo", "Digest", "decode", "multihash", "coerce", "equals", "a", "b", "data", "from", "name", "code", "encode", "Hasher", "input", "result", "create", "digest", "blake2b", "blakejs", "blake2b8", "from", "input", "coerce", "blake2b16", "blake2b24", "blake2b32", "blake2b40", "blake2b48", "blake2b56", "blake2b64", "blake2b72", "blake2b80", "blake2b88", "blake2b96", "blake2b104", "blake2b112", "blake2b120", "blake2b128", "blake2b136", "blake2b144", "blake2b152", "blake2b160", "blake2b168", "blake2b176", "blake2b184", "blake2b192", "blake2b200", "blake2b208", "blake2b216", "blake2b224", "blake2b232", "blake2b240", "blake2b248", "blake2b256", "blake2b264", "blake2b272", "blake2b280", "blake2b288", "blake2b296", "blake2b304", "blake2b312", "blake2b320", "blake2b328", "blake2b336", "blake2b344", "blake2b352", "blake2b360", "blake2b368", "blake2b376", "blake2b384", "blake2b392", "blake2b400", "blake2b408", "blake2b416", "blake2b424", "blake2b432", "blake2b440", "blake2b448", "blake2b456", "blake2b464", "blake2b472", "blake2b480", "blake2b488", "blake2b496", "blake2b504", "blake2b512", "import_blakejs", "__awaiter", "thisArg", "_arguments", "P", "generator", "adopt", "value", "resolve", "reject", "fulfilled", "step", "e", "rejected", "result", "blake2b", "blake2bInit", "blake2bUpdate", "blake2bFinal", "blakejs", "blake2b256stream", "from", "input", "ctx", "reader", "coerce", "base32", "rfc4648", "base32upper", "base32pad", "base32padupper", "base32hex", "base32hexupper", "base32hexpad", "base32hexpadupper", "base32z", "_a", "format", "link", "base", "bytes", "version", "toStringV0", "baseCache", "base58btc", "toStringV1", "base32", "cache", "baseCache", "cid", "CID", "_CID", "version", "code", "multihash", "bytes", "_a", "DAG_PB_CODE", "SHA_256_CODE", "digest", "create", "other", "self", "unknown", "equals", "base", "format", "input", "value", "encodeCID", "cidSymbol", "decode", "remainder", "specs", "prefixSize", "multihashBytes", "coerce", "digestBytes", "Digest", "initialBytes", "offset", "next", "i", "length", "codec", "multihashCode", "digestSize", "size", "multihashSize", "source", "prefix", "parseCIDtoBytes", "decoder", "base58btc", "base32", "toStringV0", "toStringV1", "codeOffset", "encodingLength", "hashOffset", "encodeTo", "import_buffer", "pick", "o", "props", "x", "k", "has", "omit", "o", "props", "x", "k", "cloneDeep", "obj", "isMergeableObject", "val", "merge", "src", "res", "key", "clone", "has", "delay", "msec", "resolve", "randomIntFromRange", "min", "max", "uniq", "array", "union", "arrays", "intersection", "a1", "v1", "v2", "difference", "a2", "v", "hashableRepresentation", "unsorted", "v", "acc", "curKey", "debounce", "func", "wait", "immediate", "timeout", "args", "context", "timestamp", "result", "later", "last", "debounced", "args_", "callNow", "throttle", "delay", "prev", "now", "has", "multicodes", "parseCID", "cid", "parsed", "CID", "base58btc", "blake2b256", "has", "createCIDfromStream", "data", "multicode", "multicodes", "uint8array", "digest", "blake2b256stream", "CID", "base58btc", "createCID", "blake2b256", "blake32Hash", "b64ToBuf", "b64", "b64ToStr", "getSubscriptionId", "subscriptionInfo", "textEncoder", "endpoint", "p256dh", "auth", "canonicalForm", "canonicalFormU8", "canonicalFormDV", "offset", "digest", "id", "p", "NEW_STATUS_DURATION", "HOURS_MILLIS", "age", "notification", "isExpired", "notification", "age", "maxAge", "isNew", "NEW_STATUS_DURATION", "isOlder", "MAX_AGE_READ", "MAX_AGE_UNREAD", "makeNotificationHash", "blake32Hash", "hashableRepresentation", "extractProposalData", "proposal", "extraFields", "myNotificationHas", "checkFunc", "groupId", "esm_default", "item", "periodicNotificationEntries", "PERIODIC_NOTIFICATION_TYPE", "rootState", "rootGetters", "groupIds", "gId", "currentPeriod", "nextPeriod", "now", "dateToPeriodStamp", "comparison", "comparePeriodStamps", "DAYS_MILLIS", "groupID", "period", "groupedNotifications", "acc", "profile", "creatorID", "incomeDetailsType", "group", "contractID", "expiredProposalIds", "expiringProposals", "groupNotificationItems", "groupProposals", "proposalId", "proposal", "STATUS_OPEN", "extractProposalData", "entry", "PROPOSAL_GENERIC", "e", "active", "mainPeriodicNotificationEntries_default", "handler", "throttle", "status", "granted", "notificationEnabled", "esm_default", "e", "makeNotification", "title", "body", "icon", "path", "groupID", "sbpInvocation", "cachedArrayBuffer", "esm_default", "e", "notification", "event", "registration", "clientList", "client", "LOGIN", "LOGIN_ERROR", "LOGIN_COMPLETE", "LOGGING_OUT", "LOGOUT", "ONLINE", "OFFLINE", "RECONNECTING", "RECONNECTION_FAILED", "KV_EVENT", "ACCEPTED_GROUP", "SWITCH_GROUP", "JOINED_GROUP", "LEFT_GROUP", "ERROR_GROUP_GENERAL_CHATROOM_DOES_NOT_EXIST", "JOINED_CHATROOM", "LEFT_CHATROOM", "DELETED_CHATROOM", "ERROR_JOINING_CHATROOM", "CAPTURED_LOGS", "SET_APP_LOGS_FILTER", "CHATROOM_USER_TYPING", "CHATROOM_USER_STOP_TYPING", "NAMESPACE_REGISTRATION", "KV_QUEUE", "CHELONIA_STATE_MODIFIED", "NOTIFICATION_EMITTED", "NOTIFICATION_REMOVED", "NOTIFICATION_STATUS_LOADED", "NEW_CHATROOM_UNREAD_POSITION", "NEW_LAST_LOGGED_IN", "NEW_UNREAD_MESSAGES", "NEW_PREFERENCES", "NEW_CHATROOM_NOTIFICATION_SETTINGS", "SERIOUS_ERROR", "KV_KEYS", "MAX_LOG_ENTRIES", "LAST_LOGGED_IN_THROTTLE_WINDOW", "DEVICE_SETTINGS", "CircularList", "#buffer", "#capacity", "#defaultValue", "#isFull", "#offset", "capacity", "defaultValue", "entry", "offset", "entries", "buffer", "loggingLevels", "originalConsole", "noop", "args", "createLogger", "config", "getItem", "removeItem", "setItem", "entries", "CircularList", "methods", "name", "captureLogEntry", "logger", "appLogsFilter", "consoleProxy", "o", "p", "r", "error", "filter", "level", "previousEntries", "stored", "type", "source", "entry", "arg", "seen", "_", "v", "e", "esm_default", "CAPTURED_LOGS", "_store", "module_default", "esm_default", "key", "data", "array", "aLen", "filtered", "v", "fn", "listenKey", "evt", "esm_default", "event", "e", "handler", "cbWithOff", "args", "data", "_a", "listener", "errorHandler", "logServer_default", "console", "config", "MAX_LOG_ENTRIES", "originalConsole", "logger", "identityContractID", "getItem", "key", "esm_default", "removeItem", "setItem", "value", "captureLogsStart", "userLogged", "createLogger", "SET_APP_LOGS_FILTER", "captureLogsPause", "wipeOut", "clearLogs", "CAPTURED_LOGS", "debounce", "logServer_default", "swCaptureLogs_default", "userID", "savedID", "isEventQueueSbpEvent", "esm_default", "name", "_a", "_b", "events", "event", "invocation", "accept", "promise", "resolve", "thisEvent", "import_scrypt_async", "import_tweetnacl", "strToBuf", "str", "blake32Hash", "data", "uint8array", "digest", "blake2b256", "base58btc", "b64ToBuf", "b", "EDWARDS25519SHA512BATCH", "CURVE25519XSALSA20POLY1305", "XSALSA20POLY1305", "EXTERNALKM32", "bytesOrObjectToB64", "ary", "c", "keygen", "type", "key", "nacl", "res", "generateSalt", "serializeKey", "key", "saveSecretKey", "EDWARDS25519SHA512BATCH", "CURVE25519XSALSA20POLY1305", "bytesOrObjectToB64", "XSALSA20POLY1305", "deserializeKey", "data", "keyData", "nacl", "b64ToBuf", "res", "keygenOfSameType", "inKey", "keygen", "keyId", "serializedKey", "blake32Hash", "sign", "messageUint8", "strToBuf", "signature", "verifySignature", "decodedSignature", "encrypt", "ad", "nonce", "encryptionNonce", "adHash", "len", "i", "box", "fullMessage", "ephemeralKey", "decrypt", "messageWithNonceAsUint8Array", "message", "decrypted", "ephemeralPublicKey", "rootStateFn", "esm_default", "proto", "wrapper", "o", "isSignedData", "signData", "stateOrContractID", "sKeyId", "data", "extraFields", "additionalKeys", "additionalData", "state", "ChelErrorSignatureError", "designatedKey", "ChelErrorSignatureKeyNotFound", "name", "newKeyId", "v", "key", "deserializedKey", "deserializeKey", "serializedData", "_", "has", "payloadToSign", "blake32Hash", "keyId", "sign", "verifySignatureData", "height", "isRawSignedData", "serializedMessage", "signature", "ChelErrorSignatureKeyUnauthorized", "verifySignature", "message", "e", "signedOutgoingData", "boundStringValueFn", "serializefn", "k", "signedOutgoingDataWithRawKey", "serializeKey", "signedIncomingData", "contractID", "mapperFn", "stringValueFn", "verifySignedValue", "verifySignedValueFn", "signedDataKeyId", "rawSignedIncomingData", "rootStateFn", "esm_default", "proto", "wrapper", "o", "isEncryptedData", "encryptData", "stateOrContractID", "eKeyId", "data", "additionalData", "state", "designatedKey", "name", "newKeyId", "v", "key", "deserializedKey", "deserializeKey", "keyId", "encrypt", "_", "has", "decryptData", "height", "additionalKeys", "validatorFn", "ChelErrorDecryptionError", "isRawEncryptedData", "message", "ChelErrorDecryptionKeyNotFound", "ChelErrorUnexpected", "result", "decrypt", "e", "encryptedOutgoingData", "boundStringValueFn", "encryptedOutgoingDataWithRawKey", "serializeKey", "encryptedIncomingData", "contractID", "decryptedValue", "decryptedValueFn", "rootState", "isRawSignedData", "signedIncomingData", "encryptedDataKeyId", "encryptedIncomingForeignData", "_0", "_1", "encryptedIncomingDataWithRawKey", "unwrapMaybeEncryptedData", "maybeEncryptedIncomingData", "decryptedAndVerifiedDeserializedMessage", "head", "headJSON", "contractID", "parsedMessage", "additionalKeys", "state", "op", "height", "message", "SPMessage", "encryptedIncomingData", "key", "maybeEncryptedIncomingData", "value", "computedKeyId", "keyId", "decryptionFn", "decryptionContract", "encryptedIncomingForeignData", "msg", "signedIncomingData", "isRawSignedData", "opT", "opV", "_SPMessage", "previousHEAD", "previousKeyOp", "manifest", "messageToParams", "targetHead", "targetOp", "sources", "unwrapMaybeEncryptedDataFn", "unwrapMaybeEncryptedData", "parsedValue", "createCID", "multicodes", "rawSignedIncomingData", "authorizedKeys", "wk", "k", "signedMessageData", "hash", "result", "params", "type", "atomicTopLevel", "validate", "t", "m", "validated", "data", "isSignedData", "desc", "e", "keyOps", "serdesTagSymbol", "serdesSerializeSymbol", "serdesDeserializeSymbol", "serialized", "direction", "decryptedValue", "innerSigningKeyId", "mapping", "has", "messageJSON", "wm", "Secret", "serdesDeserializeSymbol", "secret", "serdesSerializeSymbol", "serdesTagSymbol", "value", "INVITE_STATUS", "CHELONIA_RESET", "CONTRACT_IS_SYNCING", "CONTRACTS_MODIFIED", "EVENT_HANDLED", "EVENT_PUBLISHED", "EVENT_PUBLISHING_ERROR", "CONTRACT_REGISTERED", "CONTRACT_IS_PENDING_KEY_REQUESTS", "CONTRACT_HAS_RECEIVED_KEYS", "MAX_EVENTS_AFTER", "findKeyIdByName", "state", "name", "k", "findForeignKeysByContractID", "contractID", "findRevokedKeyIdsByName", "findSuitableSecretKeyId", "permissions", "purposes", "ringLevel", "allowedActions", "esm_default", "acc", "permission", "purpose", "action", "a", "b", "findContractIDByForeignKeyId", "keyId", "fk", "findSuitablePublicKeyIds", "validateActionPermissions", "msg", "signingKey", "opT", "opV", "data", "isSignedData", "logEvtError", "innerSigningKey", "validateKeyPermissions", "config", "signingKeyId", "SPMessage", "validateKeyAddPermissions", "v", "skipPrivateCheck", "signingKeyPermissions", "signingKeyAllowedActions", "localSigningKey", "wk", "cv", "validateKeyDelPermissions", "wid", "id", "validateKeyUpdatePermissions", "updatedMap", "keys", "wuk", "uk", "existingKey", "ChelErrorWarning", "updatedKey", "omit", "keyAdditionProcessor", "_msg", "hash", "_signingKey", "internalSideEffectStack", "decryptedKeys", "keysToPersist", "storeSecretKey", "key", "decryptedKey", "decryptedDeserializedKey", "deserializeKey", "transient", "Secret", "wkey", "decryptedKeyResult", "inviteSecret", "has", "serializeKey", "INVITE_STATUS", "keyRequestContractID", "reference", "rootState", "originatingContractState", "targetState", "pkr", "CONTRACT_IS_PENDING_KEY_REQUESTS", "e", "subscribeToForeignKeyContracts", "foreignKey", "fkUrl", "foreignContract", "foreignKeyName", "n", "recreateEvent", "entry", "contractsState", "previousHEAD", "previousHeight", "previousKeyOp", "head", "rawOpV", "newRawOpV", "recreateOperationInternal", "newOpV", "kId", "oKId", "t", "i", "newOp", "getContractIDfromKeyId", "eventsAfter", "sinceHeight", "limit", "sinceHash", "stream", "lastUrl", "fetchEventsStreamReader", "requestLimit", "remainingEvents", "eventsResponse", "signal", "ChelErrorResourceGone", "ChelErrorUnexpectedHttpResponseCode", "latestHeight", "requestCount", "eventsStreamReader", "count", "buffer", "currentEvent", "s", "controller", "done", "value", "nextIdx", "enqueued", "eventValue", "b64ToStr", "height", "ChelErrorForkedChain", "deserialized", "e2", "collectEventStream", "buildShelterAuthorizationHeader", "SAKid", "SAK", "deserializedSAK", "nonceBytes", "sign", "clearObject", "o", "k", "reactiveClearObject", "fn", "checkCanBeGarbageCollected", "id", "rootState", "esm_default", "has", "cID", "collectEventStream", "s", "reader", "done", "value", "logEvtError", "msg", "args", "enqueueDeferredPromise", "queue", "finished", "onFinishPromise", "resolve", "esm_default", "encryptedAction", "action", "humanError", "handler", "encryptionKeyName", "signingKeyName", "innerSigningKeyName", "sendMessageFactory", "outerParams", "signingKeyId", "innerSigningKeyId", "encryptionKeyId", "originatingContractID", "innerParams", "params", "invocation", "contractID", "retainFailed", "e", "state", "rootState", "signingContractID", "innerSigningContractID", "findKeyIdByName", "GIErrorMissingSigningKeyError", "sm", "userFacingErrStr", "LError", "GIErrorUIRuntimeError", "encryptedNotification", "actionReplaced", "createInvite", "quantity", "creatorID", "expires", "invitee", "findSuitableSecretKeyId", "CEKid", "CSKid", "inviteKey", "keygen", "EDWARDS25519SHA512BATCH", "inviteKeyId", "keyId", "inviteKeyP", "serializeKey", "inviteKeyS", "encryptedOutgoingData", "SPMessage", "DAYS_MILLIS", "groupContractsByType", "contracts", "contractIDs", "id", "value", "references", "type", "syncContractsInOrder", "groupedContractIDs", "contractSyncPriorityList", "getContractSyncPriority", "key", "index", "failedSyncs", "sortedContractTypes", "a", "b", "err", "paymentHashesFromPaymentPeriod", "periodPayments", "hashes", "paymentsFrom", "fromMemberID", "toMemberID", "createPaymentInfo", "paymentHash", "payment", "getProposalDetails", "proposal", "creatorID", "status", "proposalType", "proposalData", "settingsTranslationMap", "L", "options", "PROPOSAL_PROPOSAL_SETTING_CHANGE", "PROPOSAL_GROUP_SETTING_CHANGE", "PROPOSAL_GENERIC", "PROPOSAL_INVITE_MEMBER", "PROPOSAL_REMOVE_MEMBER", "proposedValue", "humanDate", "makeMentionFromUserID", "userID", "CHATROOM_MEMBER_MENTION_SPECIAL_CHAR", "makeChannelMention", "str", "withId", "CHATROOM_CHANNEL_MENTION_SPECIAL_CHAR", "getIdFromChannelMention", "swapMentionIDForDisplayname", "text", "options", "getChatroomNameById", "usernameFromID", "userDisplayNameFromID", "esm_default", "reverseNamespaceLookups", "possibleMentions", "u", "makeMentionFromUserID", "v", "escaped", "forChat", "regEx", "swap", "t", "CHATROOM_MEMBER_MENTION_SPECIAL_CHAR", "userID", "prefix", "body", "channelID", "messageReceivePostEffect", "contractID", "messageHash", "height", "text", "isDMOrMention", "messageType", "memberID", "chatRoomName", "rootGetters", "esm_default", "rootState", "identityContractID", "isDM", "shouldAddToUnreadMessages", "MESSAGE_TYPES", "e", "title", "icon", "members", "membersList", "isDMToMyself", "partnersList", "p1", "p2", "p1JoinedDate", "p2JoinedDate", "lastJoinedPartner", "cID", "path", "privacyLevelPrivate", "CHATROOM_PRIVACY_LEVEL", "chatNotificationSettings", "messageNotification", "messageSound", "shouldNotifyMessage", "MESSAGE_NOTIFY_SETTINGS", "shouldSoundMessage", "makeNotification", "swapMentionIDForDisplayname", "L", "MESSAGE_RECEIVE", "messageReceivePostEffect_default", "esm_default", "MESSAGE_RECEIVE_RAW", "contractID", "data", "innerSigningContractID", "newMessage", "state", "rootState", "getters", "mentions", "makeMentionFromUserID", "msgData", "isMentionedMe", "MESSAGE_TYPES", "isAlreadyAdded", "m", "e", "messageReceivePostEffect_default", "CHATROOM_TYPES", "chatroom_default", "params", "billableContractID", "userID", "cskOpts", "cekOpts", "CEK", "keygen", "CURVE25519XSALSA20POLY1305", "CEKid", "keyId", "CEKp", "serializeKey", "CEKs", "encryptedOutgoingDataWithRawKey", "deserializeKey", "CSK", "EDWARDS25519SHA512BATCH", "CSKid", "CSKp", "CSKs", "Secret", "key", "SAK", "SAKid", "SAKp", "SAKs", "chatroom", "omit", "SPMessage", "GIErrorUIRuntimeError", "L", "newKeys", "mainCEKid", "originatingContractID", "pContractID", "encryptedOutgoingData", "newKey", "newId", "keys", "rootGetters", "identityState", "identityContractID", "cIDs", "cID", "groupState", "encryptedNotification", "encryptedAction", "sendMessage", "signingKeyId", "userIDs", "memberID", "has", "userCSKids", "cskID", "keyIds", "VOTE_AGAINST", "VOTE_INDIFFERENT", "VOTE_UNDECIDED", "VOTE_FOR", "RULE_PERCENTAGE", "RULE_DISAGREEMENT", "RULE_MULTI_CHOICE", "getPopulation", "state", "p", "PROFILE_STATUS", "rules", "proposalType", "votes", "population", "PROPOSAL_REMOVE_MEMBER", "defaultThreshold", "threshold", "getThresholdAdjusted", "totalIndifferent", "x", "totalFor", "totalAgainst", "turnout", "absent", "neededToPass", "minimumMax", "thresholdOriginal", "rules_default", "ruleType", "unionOf", "k", "literalOf", "voteType", "v", "rule", "groupSize", "groupSizeVoting", "minThreshold", "notifyAndArchiveProposal", "state", "proposalHash", "proposal", "contractID", "meta", "height", "esm_default", "proposalSettingsType", "objectOf", "ruleType", "number", "RULE_PERCENTAGE", "RULE_DISAGREEMENT", "oneVoteToCloseWith", "expectedResult", "votes", "currentResult", "rules_default", "newResult", "oneVoteToPass", "VOTE_FOR", "oneVoteToFail", "VOTE_AGAINST", "voteAgainst", "data", "STATUS_FAILED", "PROPOSAL_RESULT", "proposalDefaults", "DAYS_MILLIS", "proposals", "PROPOSAL_INVITE_MEMBER", "message", "STATUS_PASSED", "forMessage", "PROPOSAL_REMOVE_MEMBER", "passPayload", "messageData", "PROPOSAL_GROUP_SETTING_CHANGE", "setting", "proposedValue", "PROPOSAL_PROPOSAL_SETTING_CHANGE", "PROPOSAL_GENERIC", "proposals_default", "proposalType", "unionOf", "k", "literalOf", "objectURLtoBlob", "url", "r", "imageUpload", "imageFile", "params", "file", "download", "esm_default", "esm_default", "LEFT_GROUP", "identityContractID", "groupContractID", "rootState", "notificationHashes", "item", "JOINED_FAILED_KEY", "reattemptTimeoutId", "CHELONIA_RESET", "group_default", "name", "picture", "sharedValues", "mincomeAmount", "mincomeCurrency", "ruleName", "ruleThreshold", "distributionDate", "publishOptions", "finalPicture", "userID", "imageUpload", "e", "GIErrorUIRuntimeError", "L", "CSK", "keygen", "EDWARDS25519SHA512BATCH", "CEK", "CURVE25519XSALSA20POLY1305", "inviteKey", "SAK", "CSKid", "keyId", "CEKid", "inviteKeyId", "SAKid", "CSKp", "serializeKey", "CEKp", "inviteKeyP", "SAKp", "CSKs", "encryptedOutgoingDataWithRawKey", "CEKs", "inviteKeyS", "SAKs", "proposalSettings", "dateToPeriodStamp", "addTimeToDate", "DAYS_MILLIS", "Secret", "key", "message", "SPMessage", "MAX_GROUP_MEMBER_COUNT", "INVITE_EXPIRES_IN_DAYS", "INVITE_INITIAL_CREATOR", "PROPOSAL_GROUP_SETTING_CHANGE", "merge", "proposals_default", "PROPOSAL_INVITE_MEMBER", "PROPOSAL_REMOVE_MEMBER", "PROPOSAL_PROPOSAL_SETTING_CHANGE", "PROPOSAL_GENERIC", "contractID", "i", "resolve", "reject", "LError", "params", "loggedIn", "retainedContracts", "hasKeyShareBeenRespondedBy", "state", "hasSecretKeys", "sendKeyRequest", "pendingKeyShares", "eventHandler", "sharedWithContractID", "signingKeyName", "removeEventHandler", "removeLogoutHandler", "LOGOUT", "CONTRACT_HAS_RECEIVED_KEYS", "omit", "PROFILE_STATUS", "PEKid", "userCSKid", "userCSKdata", "existingForeignKeys", "encryptedOutgoingData", "JOINED_GROUP", "map", "scheduleReattempt", "groupId", "secret", "ourGroups", "results", "result", "newKeys", "mainCEKid", "_", "p", "pContractID", "newKey", "newId", "keys", "encryptedAction", "sendMessage", "contractState", "contractId", "cskId", "csk", "cekId", "cek", "privateChatroom", "CHATROOM_PRIVACY_LEVEL", "memberID", "chatRoomID", "switchChannelAfterJoined", "JOINED_CHATROOM", "EVENT_HANDLED", "signingKeyId", "error", "msgMeta", "attempt", "randomIntFromRange", "groupID", "username", "proposalHash", "proposal", "hash", "prop", "STATUS_OPEN", "VOTE_FOR", "randDelay", "generalChatRoomId", "MESSAGE_TYPES", "proposals", "STATUS_EXPIRING", "joinedHeight", "response", "ACCEPTED_GROUP", "proposalId", "proposalToSend", "extractProposalData", "data", "type", "willBePassed", "oneVoteToPass", "willBeFailed", "oneVoteToFail", "isVoteFor", "isVoteAgainst", "passPayload", "createInvite", "STATUS_PASSED", "STATUS_FAILED", "STATUS_CANCELLED", "STATUS_EXPIRED", "rootGetters", "currentIdentityState", "esm_default", "ONLINE", "group_kv_default", "cheloniaState", "identityContractID", "contractID", "state", "kvData", "KV_KEYS", "KV_QUEUE", "data", "NEW_LAST_LOGGED_IN", "e", "throttle", "now", "lastLoggedInRawValue", "lastLoggedIn", "LAST_LOGGED_IN_THROTTLE_WINDOW", "nowString", "constructUpdatedLastLoggedIn", "etag", "currentData", "_instances", "localforage", "lazyInitDb", "name", "storeName", "promise", "resolve", "reject", "openDB", "version", "request", "event", "db", "error", "e", "key", "value", "generateEncryptionParams", "stateKeyEncryptionKeyFn", "stateEncryptionKey", "keygen", "CURVE25519XSALSA20POLY1305", "stateEncryptionKeyId", "keyId", "stateEncryptionKeyS", "serializeKey", "stateEncryptionKeyP", "salt", "generateSalt", "stateKeyEncryptionKey", "encryptedStateEncryptionKey", "encrypt", "appSettings", "EmptyValue", "SETTING_CURRENT_USER", "SETTING_CHELONIA_STATE", "esm_default", "encryptionParams", "encryptedState", "encryptedValue", "data", "x", "decrypt", "stateEncryptionKeyIdActual", "filesCache", "maxFileEntries", "cacheKey", "blob", "keys", "v", "idx", "last", "file", "archive", "logs", "handleFetchResult", "type", "r", "msg", "ChelErrorResourceGone", "ChelErrorUnexpectedHttpResponseCode", "decryptOldIekList", "contractID", "IEK", "encryptedData", "parsedData", "decryptedData", "encryptedIncomingDataWithRawKey", "error", "processOldIekList", "identityContractID", "oldKeysAnchorCid", "result", "esm_default", "handleFetchResult", "oldKeys", "data", "rawSignedIncomingData", "head", "SPMessage", "op", "keys", "key", "decryptedKeys", "secretKeys", "deserializeKey", "Secret", "appendToIekList", "oldIEK", "keysSet", "serializedOldIEK", "serializeKey", "encryptedOutgoingDataWithRawKey", "EVENT_HANDLED", "message", "e", "identity_default", "wIPK", "wIEK", "publishOptions", "username", "email", "picture", "token", "finalPicture", "IPK", "deletionToken", "generateSalt", "deletionTokenHash", "blake32Hash", "CSK", "keygen", "EDWARDS25519SHA512BATCH", "CEK", "CURVE25519XSALSA20POLY1305", "PEK", "SAK", "IPKid", "keyId", "IEKid", "CSKid", "CEKid", "PEKid", "SAKid", "IPKp", "IEKp", "CSKp", "CEKp", "PEKp", "SAKp", "CSKs", "CEKs", "PEKs", "SAKs", "encryptedDeletionToken", "userID", "imageUpload", "GIErrorUIRuntimeError", "L", "LError", "encryptionParams", "cheloniaState", "state", "transientSecretKeys", "k", "SETTING_CURRENT_USER", "LOGIN", "contractIDs", "groupContractsByType", "syncContractsInOrder", "groupIds", "groupId", "has", "PROFILE_STATUS", "humanErr", "hasLeft", "cId", "LOGGING_OUT", "KV_QUEUE", "SETTING_CHELONIA_STATE", "cloneDeep", "LOGOUT", "foreignContractID", "keyName", "foreignContractState", "encryptedOutgoingData", "newKeys", "rootState", "groupID", "newKey", "newId", "_", "encryptedAction", "sendMessage", "params", "rootGetters", "partnerIDs", "memberID", "currentGroupId", "CHATROOM_PRIVACY_LEVEL", "CHATROOM_TYPES", "omit", "switchChannelAfterJoined", "JOINED_CHATROOM", "index", "hooks", "attachments", "billableContractID", "attachmentsData", "attachment", "url", "compressedBlob", "attachmentBlob", "objectURLtoBlob", "response", "downloadData", "tokensByManifestCid", "deleteData", "attributes", "err", "manifestCids", "option", "shouldDeleteFile", "shouldDeleteToken", "throwIfMissingToken", "deleteResult", "toDelete", "currentIdentityState", "credentials", "cid", "credential", "i", "r", "oldIPK", "updateToken", "oldIPKid", "oldIEKid", "oldKeysData", "findKeyIdByName", "transientSecretKeysEntries", "encryptedIncomingData", "ourDirectMessages", "ourGroups", "ourIdentityContractId", "initNotificationStatus", "data", "esm_default", "ONLINE", "identity_kv_default", "identityContractID", "KV_KEYS", "onconflict", "KV_QUEUE", "currentChatRoomUnreadMessages", "NEW_UNREAD_MESSAGES", "contractID", "messageHash", "createdHeight", "getUpdatedUnreadMessages", "currentData", "etag", "forceUpdate", "unreadMessages", "msg", "existingReadUntil", "index", "preferences", "NEW_PREFERENCES", "hidden", "getUpdatedPreferences", "currentPreferences", "hideDistributionBanner", "applyStorageRules", "notificationStatus", "acc", "hash", "isExpired", "updatedOnConflict", "args", "result", "status", "notification", "timestamp", "getUpdatedNotificationStatus", "hashes", "notifications", "isUpdated", "existing", "n", "isUnRead", "isDifferent", "esm_default", "contractID", "contractName", "subjectContractID", "keyIds", "returnInvocation", "contractState", "state", "CEKid", "findKeyIdByName", "signingKeyId", "findSuitableSecretKeyId", "SPMessage", "secretKeys", "keysToShare", "pick", "key", "id", "payload", "keyId", "encryptedOutgoingData", "invocation", "keysToRotate", "addtionalOperationsSelector", "ringLevel", "newKeys", "data", "has", "newKey", "keygenOfSameType", "encryptedDataKeyId", "updatedKeys", "newId", "eKID", "encryptionKeyName", "isRotatedEncryptionKey", "encryptionKey", "serializeKey", "encryptedOutgoingDataWithRawKey", "additionalOperations", "preSendCheck", "msg", "getters", "state", "rootState", "MESSAGE_NOTIFY_SETTINGS", "groupID", "currentGroupDirectMessages", "chatRoomID", "chatRoomState", "directMessageSettings", "myIdentityId", "members", "isDMToMyself", "partners", "memberID", "p1", "p2", "p1JoinedDate", "p2JoinedDate", "hasActiveMember", "lastJoinedPartner", "lastMsgTimeStamp", "cID", "shouldFindDMToMyself", "chatRoomSettings", "cPartners", "partner", "union", "chatroomID", "isGroupDirectMessage", "isGroupChatroom", "sum", "n", "cId", "chatRoomsInDetail", "merge", "contractID", "chatRoom", "name", "privacyLevel", "details", "CHATROOM_PRIVACY_LEVEL", "found", "member", "getters_default", "commaToDots", "value", "isNumeric", "nr", "isInDecimalsLimit", "decimalsMax", "decimals", "validateMincome", "decimalsOrInt", "num", "saferFloat", "makeCurrency", "options", "symbol", "symbolWithCode", "decimalsMax", "formatCurrency", "n", "decimalsOrInt", "validateMincome", "currencies", "amount", "currencies_default", "mincomeProportional", "haveNeeds", "totalHave", "totalNeed", "havers", "needers", "haveNeed", "totalPercent", "payments", "haver", "distributionAmount", "needer", "belowPercentage", "minimizeTotalPaymentsCount", "distribution", "neederTotalReceived", "haverTotalHave", "haversSorted", "needersSorted", "minimizedDistribution", "todo", "memberID", "a", "b", "mostHaver", "mostNeeder", "diff", "tinyNum", "unadjustedDistribution", "haveNeeds", "minimize", "distribution", "mincomeProportional", "minimizeTotalPaymentsCount", "adjustedDistribution", "payments", "dueOn", "cloneDeep", "todo", "subtractDistributions", "saferFloat", "reduceDistribution", "i", "paymentA", "j", "paymentB", "addDistributions", "paymentsA", "paymentsB", "p", "PAYMENT_PENDING", "PAYMENT_CANCELLED", "PAYMENT_ERROR", "PAYMENT_NOT_RECEIVED", "PAYMENT_COMPLETED", "paymentStatusType", "unionOf", "k", "literalOf", "PAYMENT_TYPE_MANUAL", "PAYMENT_TYPE_BITCOIN", "PAYMENT_TYPE_PAYPAL", "paymentType", "chatroom_default", "state", "getters", "a", "b", "group_default", "state", "getters", "member", "PROFILE_STATUS", "profiles", "profile", "distributionDate", "distributionPeriodLength", "keys", "MAX_SAVED_PERIODS", "dateToPeriodStamp", "addTimeToDate", "date", "periods", "periodStampsForDate", "groupState", "periodStamp", "periodPayments", "paymentHashesFromPaymentPeriod", "invites", "vmInvites", "pendingMembers", "inviteKeyId", "INVITE_STATUS", "INVITE_INITIAL_CREATOR", "currentDate", "proposalType", "PROPOSAL_GENERIC", "mincomeCurrency", "currencies_default", "currentPeriod", "groupProfiles", "haveNeeds", "memberID", "incomeDetailsType", "joinedDate", "amount", "haveNeed", "when", "dateFromPeriodStamp", "dateIsWithinPeriod", "hashes", "events", "payments", "paymentHash", "payment", "PAYMENT_COMPLETED", "createPaymentInfo", "identity_default", "state", "getters", "checkedUsername", "state", "username", "userID", "anyoneCanJoinInviteId", "invites", "getters", "invite", "INVITE_INITIAL_CREATOR", "INVITE_STATUS", "identityContractID", "gId", "groupProfiles", "ourIdentityContractId", "ourGroupProfile", "doWeNeedIncome", "distribution", "nonMonetaryContributionsOf", "memberID", "who", "whoIds", "total", "p", "acc", "payment", "needed", "listWho", "listWhat", "contr", "displayName", "what", "contributionIndex", "c", "contributions", "profile", "periodPayments", "pPeriod", "pPayments", "todo", "unadjustedDistribution", "paymentInfo", "period", "adjustedDistribution", "payments", "thisPeriodPayments", "paymentsFrom", "allPayments", "toMemberID", "paymentHash", "data", "meta", "height", "paymentA", "paymentB", "fromMemberID", "cPeriod", "currentSent", "previousSent", "currentReceived", "previousReceived", "isNeeder", "isOurPayment", "sumUpAmountReducer", "ourAdjustedPayments", "receivedOrSent", "markedAsNotReceived", "PAYMENT_NOT_RECEIVED", "markedAsNotReceivedTotal", "paymentsTotal", "nonLateAdjusted", "paymentsDone", "hasPartials", "amountDone", "amountLeft", "amountTotal", "inviteId", "expires", "groups", "hasLeft", "contractID", "L", "PROFILE_STATUS", "groupID", "profiles", "member", "weJoinedHeight", "isNewMember", "memberProfile", "memberJoinedHeight", "memberJoinedMs", "groupMembersPending", "userA", "userB", "nameA", "nameB", "attributes", "currentGroupProfileIds", "filtered", "userIdA", "userIdB", "usernameA", "usernameB", "chatroom_default", "group_default", "identity_default", "getters_default", "getters", "state", "rootState", "item", "notification", "age", "MAX_AGE_UNREAD", "MAX_AGE_READ", "groupID", "isNew", "isOlder", "getters_default", "templates_default", "data", "activity", "error", "message", "msgMeta", "contractID", "opType", "value", "action", "SPMessage", "state", "esm_default", "who", "plaintextWho", "innerSigningContractID", "findContractIDByForeignKeyId", "CHATROOM_MEMBER_MENTION_SPECIAL_CHAR", "LcommonParams", "Lparams", "LTags", "LplaintextParams", "L", "rootState", "plaintextName", "hasPlaintextName", "isCreator", "args", "plaintextArgs", "bodyTemplateMap", "plaintextBodyTemplateMap", "iconMap", "proposalData", "proposalType", "typeToTitleMap", "PROPOSAL_INVITE_MEMBER", "PROPOSAL_REMOVE_MEMBER", "PROPOSAL_GROUP_SETTING_CHANGE", "PROPOSAL_PROPOSAL_SETTING_CHANGE", "PROPOSAL_GENERIC", "creatorID", "status", "type", "options", "getProposalDetails", "statusMap", "STATUS_PASSED", "STATUS_FAILED", "STATUS_CANCELLED", "STATUS_EXPIRED", "withGroupCurrency", "period", "memberType", "periodDisplay", "humanDate", "bodyTemplate", "prev", "after", "added", "v", "removed", "updateType", "name", "contributionsFormatted", "entries", "first", "len", "bodyContentMap", "plaintextBodyContentMap", "esm_default", "type", "data", "template", "templates_default", "notification", "makeNotificationHash", "rootState", "item", "index", "CHELONIA_STATE_MODIFIED", "NOTIFICATION_EMITTED", "groupID", "hashes", "hashesSet", "v", "NOTIFICATION_REMOVED", "status", "NOTIFICATION_STATUS_LOADED", "NOTIFICATION_TYPE", "REQUEST_TYPE", "RESPONSE_TYPE", "PUSH_SERVER_ACTION_TYPE", "defaultOptions", "PUBSUB_ERROR", "PUBSUB_RECONNECTION_ATTEMPT", "PUBSUB_RECONNECTION_FAILED", "PUBSUB_RECONNECTION_SCHEDULED", "PUBSUB_RECONNECTION_SUCCEEDED", "PUBSUB_SUBSCRIPTION_SUCCEEDED", "createClient", "url", "options", "client", "defaultMessageHandlers", "publicMethods", "name", "defaultClientEventHandlers", "event", "error", "esm_default", "globalEventNames", "globalEventMap", "createMessage", "type", "data", "meta", "message", "string", "stringify", "createPubMessage", "channelID", "data", "NOTIFICATION_TYPE", "createRequest", "type", "defaultClientEventHandlers", "event", "client", "name", "socketEventNames", "esm_default", "PUBSUB_RECONNECTION_FAILED", "isDefinetelyOffline", "PUBSUB_ERROR", "msg", "messageParser", "error", "handler", "options", "PUBSUB_RECONNECTION_SUCCEEDED", "kvFilter", "REQUEST_TYPE", "delay", "nth", "defaultMessageHandlers", "createMessage", "key", "RESPONSE_TYPE", "reason", "actionType", "message", "PUBSUB_SUBSCRIPTION_SUCCEEDED", "globalEventNames", "globalEventMap", "ev", "publicMethods", "send", "start", "maxReconnectionDelay", "minReconnectionDelay", "reconnectionDelayGrowFactor", "minDelay", "maxDelay", "connectionTimeUsed", "PUBSUB_RECONNECTION_ATTEMPT", "PUBSUB_RECONNECTION_SCHEDULED", "socket", "target", "detail", "chelonia_utils_default", "esm_default", "contractID", "key", "data", "onconflict", "ifMatch", "encryptionKeyName", "signingKeyName", "m", "M", "n", "e", "u", "b", "T", "h", "A", "s", "i", "g", "l", "d", "r", "o", "t", "a", "y", "f", "c", "B", "p", "w", "x", "v", "n", "T", "w", "L", "u", "d", "A", "s", "e", "y", "i", "b", "f", "l", "a", "t", "r", "I", "B", "m", "o", "R", "E", "g", "h", "c", "p", "S", "e", "R", "b", "f", "i", "A", "y", "u", "L", "c", "h", "a", "g", "o", "s", "t", "n", "r", "E", "B", "w", "N", "U", "l", "d", "m", "p", "T", "K", "supportsRequestStreams", "duplexAccessed", "hasContentType", "streamToUint8Array", "s", "reader", "chunks", "length", "result", "coerce", "body", "offset", "chunk", "ArrayBufferToUint8ArrayStream", "connectionURL", "c", "controller", "computeChunkDescriptors", "inStream", "lengthStream", "cidStream", "lengthPromise", "resolve", "reject", "reason", "cidPromise", "createCIDfromStream", "multicodes", "fileStream", "chelonia", "manifest", "dataIterator", "readSize", "chunkResponse", "chunkBinary", "createCID", "e", "aes256gcmHandlers", "_chelonia", "manifestOptions", "params", "IKM", "recordSize", "keyId", "blake32Hash", "binaryKeyId", "stream", "K", "downloadParams", "IKMb64", "maxRecordSize", "bytes", "S", "actualKeyId", "noneHandlers", "_downloadParams", "cipherHandlers", "files_default", "esm_default", "billableContractID", "chunkDescriptors", "cipherHandler", "cipherParams", "transferParts", "i", "encryptedStream", "acc", "cv", "boundary", "x", "deletionToken", "generateSalt", "deletionTokenHash", "uploadResponse", "buildShelterAuthorizationHeader", "downloadOptions", "manifestChecker", "manifestCid", "manifestResponse", "manifestBinary", "credentials", "cid", "hasCredential", "has", "hasToken", "hasBillableContractID", "headPrefix", "getContractIdFromLogHead", "key", "getLogHead", "contractID", "esm_default", "dbPrimitiveSelectors", "key", "id", "getContractIdFromLogHead", "state", "value", "db_default", "contractID", "height", "entryMetaJson", "entryMeta", "r", "getLogHead", "hash", "SPMessage", "e", "ChelErrorDBConnection", "entry", "entryPreviousHEAD", "entryPreviousKeyOp", "entryHeight", "HEADinfo", "ChelErrorDBBadPreviousHEAD", "contractHEAD", "contractPreviousKeyOp", "contractHeight", "latestHEADinfo", "missingDecryptionKeyIdsMap", "getMsgMeta", "message", "contractID", "state", "index", "signingKeyId", "innerSigningKeyId", "config", "result", "getContractIDfromKeyId", "value", "data", "isSignedData", "keysToMap", "keys_", "height", "authorizedKeys", "keys", "key", "keysCopy", "cloneDeep", "ChelErrorKeyAlreadyExists", "keyRotationHelper", "updatedKeysMap", "requiredPermissions", "outputSelector", "outputMapper", "internalSideEffectStack", "rootState", "esm_default", "watchMap", "name", "cID", "findSuitableSecretKeyId", "SPMessage", "names", "keyNamesToUpdate", "foreignContractKey", "acc", "ringLevel", "contractName", "v", "e", "internals_default", "instance", "invocation", "queueName", "manifestHash", "manifest", "has", "contractNameLookupKey", "signatureValidated", "signingKey", "verifySignature", "body", "contractSigningKeys", "serializedKey", "keyId", "manifestSource", "multicodes", "contractInfo", "source", "reduceAllow", "allowedSels", "allowedDoms", "contractSBP", "selector", "args", "domain", "domainFromSelector", "saferEval", "dep", "fallback", "response", "handleFetchResult", "ChelErrorFetchServerTimeFailed", "s", "params", "destructor", "k", "CONTRACTS_MODIFIED", "contractIDs", "listOfIds", "forcedSync", "err", "entry", "maxAttempts", "headers", "billableContractID", "bearer", "hooks", "originalEntry", "attempt", "lastAttemptedHeight", "onreceivedHandler", "_contractID", "EVENT_HANDLED", "newEntry", "isFirstMessage", "recreateEvent", "r", "buildShelterAuthorizationHeader", "randDelay", "randomIntFromRange", "delay", "EVENT_PUBLISHED", "EVENT_PUBLISHING_ERROR", "previousVolatileState", "targetState", "pWatch", "tWatch", "pkr", "opT", "opV", "hash", "direction", "self", "opName", "y", "opFns", "i", "u", "validateKeyPermissions", "e_", "missingDecryptionKeyIds", "logEvtError", "keyAdditionProcessor", "meta", "action", "wv", "sK", "cheloniaState", "newestEncryptionKeyHeight", "transient", "decrypted", "Secret", "deserializeKey", "mustResync", "keyDict", "keyName", "contractIdsToUpdate", "findKeyIdByName", "resync", "CONTRACT_HAS_RECEIVED_KEYS", "originatingContractID", "INVITE_STATUS", "context", "pending", "success", "notImplemented", "ChelErrorWarning", "validateKeyAddPermissions", "validateKeyDelPermissions", "keyIds", "fkUrl", "foreignContract", "foreignKeyName", "oldWatch", "pendingWatch", "kId", "updatedKeys", "updatedMap", "validateKeyUpdatePermissions", "keysToDelete", "processOp", "stateForValidation", "event", "ChelErrorResourceGone", "CONTRACT_IS_SYNCING", "currentVolatileState", "latestHEAD", "recentHEAD", "recentHeight", "isSubscribed", "eventsStream", "latestHashFound", "eventReader", "skip", "done", "ChelErrorForkedChain", "entryIndex", "op", "externalContractID", "externalContractState", "id", "contractState", "keysToUpdate", "externalId", "pendingKeyRevocations", "keyUpdateSigningKeyId", "keyUpdateArgs", "foreignKey", "foreignContractID", "foreignState", "fKeyId", "currentRingLevel", "currentSigningKeyId", "currentKeyArgs", "keyDelSigningKeyId", "keyIdsToDelete", "currentKeyIds", "keyShareEncryption", "rv", "originatingContractHeight", "headJSON", "krsEncryption", "originatingState", "originatingContractName", "signedIncomingData", "encryptionKeyId", "responseKey", "encryptedIncomingData", "deserializedResponseKey", "responseKeyId", "pick", "keySharePayload", "encryptedOutgoingData", "findSuitablePublicKeyIds", "msg", "payload", "connectionKeyPayload", "rawMessage", "preHandleEvent", "postHandleEvent", "handleEventError", "processingErrored", "contractStateCopy", "ChelErrorUnrecoverable", "handleEvent", "fn", "e2", "eventsToReingest", "reprocessDebounced", "debounce", "latestProcessedHeight", "ChelErrorDBBadPreviousHEAD", "ChelErrorAlreadyProcessed", "reprocessIdx", "callSideEffect", "field", "mutation", "reducer", "actionsOpV", "results", "errors", "type", "missingDecryptionKeyIdsForMessage", "wallBase", "monotonicBase", "resyncTimeout", "watchdog", "syncServerTime", "startTime", "time", "requestTimeElapsed", "serverTime", "newMonotonicBase", "time_sync_default", "esm_default", "resync", "delay", "timeout", "e", "wallLast", "monotonicLast", "wallNow", "monotonicNow", "ACTION_REGEX", "chelonia_default", "esm_default", "value", "action", "obj", "key", "args", "unwrapMaybeEncryptedData", "contractID", "stack", "op", "secretKeyGetter", "o", "p", "has", "rootState", "deserializeKey", "secretKeyList", "stateKeys", "cloneDeep", "config", "merge", "manifests", "contractName", "data", "isEncryptedData", "newState", "postCleanupFn", "cID", "result", "reactiveClearObject", "clearObject", "removedContractIDs", "CHELONIA_RESET", "CONTRACTS_MODIFIED", "wkeys", "keys", "transient", "id", "keyId", "serializeKey", "ids", "persistent", "contractIDOrState", "requestedToContractID", "reference", "r", "requestingContractID", "name", "keyShares", "kS", "a", "b", "operation", "findSuitableSecretKeyId", "sourceContractIDOrState", "sK", "requireSecretKey", "currentKeyId", "findKeyIdByName", "foreignContractID", "findForeignKeysByContractID", "revokedKeyIds", "findRevokedKeyIdsByName", "permissions", "purposes", "ringLevel", "allowedActions", "names", "state", "buildShelterAuthorizationHeader", "inKey", "options", "pubsubURL", "createClient", "event", "channelID", "err", "k", "v", "NOTIFICATION_TYPE", "msg", "parseEncryptedOrUnencryptedMessage", "e", "SPMessage", "contract", "asyncSbpCall", "sel", "contractNameFromAction", "message", "meta", "gProxy", "gettersProxy", "mutation", "stateCopy", "sideEffects", "sideEffect", "e_", "method", "CONTRACT_REGISTERED", "sbpInvocation", "invocations", "invocation", "client", "subscribedIDs", "currentIDs", "leaveSubscribed", "intersection", "toUnsubscribe", "difference", "toSubscribe", "contractIDs", "listOfIds", "params", "checkCanBeGarbageCollected", "firstSync", "isSyncing", "confirmRemovalCallback", "permanent", "fkContractIDs", "checkIfDeleted", "ChelErrorResourceGone", "current", "boundCheckCanBeGarbageCollected", "idsToRemove", "contractIDToDisconnect", "contractState", "keyIds", "messageOrRawMessage", "cid", "code", "parsedCID", "parseCID", "local", "url", "handleFetchResult", "ourHash", "createCID", "eventsAfter", "beforeHeight", "limit", "offset", "eventsAfterLimit", "startHash", "endHeight", "stream", "reader", "controller", "first", "deserializedHEAD", "startOffset", "done", "collectEventStream", "x", "eventsStreamReader", "ChelErrorUnrecoverable", "height", "hooks", "publishOptions", "signingKeyId", "actionSigningKeyId", "actionEncryptionKeyId", "manifestHash", "signingKey", "payload", "contractMsg", "signedOutgoingDataWithRawKey", "response", "credentials", "hasCredential", "hasToken", "hasBillableContractID", "outEncryptedOrUnencryptedAction", "atomic", "originatingContractName", "originatingContractID", "originatingManifestHash", "destinationManifestHash", "originatingContract", "destinationContract", "signedOutgoingData", "wk", "encryptedOutgoingData", "oldKeyId", "innerSigningKeyId", "encryptionKeyId", "innerEncryptionKeyId", "encryptKeyRequestMetadata", "originatingState", "pkr", "keyRequestReplyKey", "keygen", "EDWARDS25519SHA512BATCH", "keyRequestReplyKeyId", "keyRequestReplyKeyP", "keyRequestReplyKeyS", "ChelErrorUnexpected", "keyAddOp", "selector", "opParams", "serializedData", "outputEncryptedOrUnencryptedMessage", "ifMatch", "maxAttempts", "onconflict", "hasOnconflict", "resolveData", "currentValue", "serializedDataText", "ChelErrorUnexpectedHttpResponseCode", "delay", "randomIntFromRange", "filter", "signedMessage", "ctx", "numericHeight", "currentHeight", "aad", "signedIncomingData", "maybeEncryptedIncomingData", "unwrap", "unwrapped", "isSignedData", "getContractIDfromKeyId", "opType", "unencMessage", "encryptedOutgoingDataWithRawKey", "getters", "proxyGetters", "_target", "prop", "PUBSUB_INSTANCE", "manifests_default", "handleDeletedContract", "contractID", "cheloniaState", "contractState", "esm_default", "type", "handler", "currentIdentityState", "manifestCids", "billableContractID", "cid", "e", "setupChelonia", "SETTING_CHELONIA_STATE", "identityContractID", "SETTING_CURRENT_USER", "errorNotification", "activity", "error", "message", "msgMeta", "logoutInProgress", "saveChelonia", "saveCheloniaDebounced", "debounce", "k", "v", "has", "manifests_default", "common_exports", "SERIOUS_ERROR", "LOGIN_COMPLETE", "CHELONIA_STATE_MODIFIED", "LOGGING_OUT", "LOGOUT", "CONTRACTS_MODIFIED", "_", "added", "rootState", "cID", "KV_KEYS", "PUBSUB_INSTANCE", "NOTIFICATION_TYPE", "msg", "ourVersion", "theirVersion", "ourContractsVersion", "theirContractsVersion", "isContractVersionDiff", "isGIVersionDiff", "REQUEST_TYPE", "innerSigningContractID", "data", "CHATROOM_USER_TYPING", "CHATROOM_USER_STOP_TYPING", "key", "value", "KV_EVENT", "OFFLINE", "ONLINE", "RECONNECTING", "RECONNECTION_FAILED", "contractIDs", "groupContractsByType", "syncContractsInOrder", "setupChelonia_default", "singletonFn", "promise", "PUBSUB_ERROR", "strOrBufToBuf", "v", "bufferEq", "a", "b", "ab", "bb", "i", "push_default", "esm_default", "cachedVapidInformation", "REQUEST_TYPE", "data", "PUSH_SERVER_ACTION_TYPE", "oldKey", "subscription", "DEVICE_SETTINGS", "newSubscription", "resolve", "reject", "handler", "timeoutId", "pubsub", "PUBSUB_INSTANCE", "createMessage", "reportedSubscriptionBySocket", "getSubID", "getSubscriptionId", "e", "subscriptionInfo", "applicationServerKey", "socket", "reported", "subID", "host", "inProgress", "PUBSUB_RECONNECTION_SUCCEEDED", "disableNotifications", "event", "NOTIFICATION_TYPE", "setupChelonia_default", "makeNotification", "L", "esm_default", "name", "id", "skipCache", "cached", "value", "reactiveSet", "rootState", "cache", "reverseCache", "NAMESPACE_REGISTRATION", "currentValue", "reactiveDel", "deserializer", "SPMessage", "Secret", "reducer", "o", "v", "domainBlacklist", "selectorBlacklist", "esm_default", "domain", "selector", "data", "setupRootState", "rootState", "CHELONIA_RESET", "broadcastMessage", "args", "clientList", "client", "e", "CONTRACTS_MODIFIED", "CONTRACT_IS_SYNCING", "ERROR_GROUP_GENERAL_CHATROOM_DOES_NOT_EXIST", "ERROR_JOINING_CHATROOM", "EVENT_HANDLED", "LOGIN", "LOGIN_ERROR", "LOGOUT", "LOGGING_OUT", "ACCEPTED_GROUP", "CHATROOM_USER_STOP_TYPING", "CHATROOM_USER_TYPING", "DELETED_CHATROOM", "LEFT_CHATROOM", "LEFT_GROUP", "JOINED_CHATROOM", "JOINED_GROUP", "KV_EVENT", "NOTIFICATION_TYPE", "MESSAGE_RECEIVE", "MESSAGE_SEND", "NAMESPACE_REGISTRATION", "NEW_LAST_LOGGED_IN", "NEW_PREFERENCES", "NEW_UNREAD_MESSAGES", "NOTIFICATION_EMITTED", "NOTIFICATION_REMOVED", "NOTIFICATION_STATUS_LOADED", "OFFLINE", "ONLINE", "RECONNECTING", "RECONNECTION_FAILED", "PROPOSAL_ARCHIVED", "SERIOUS_ERROR", "SWITCH_GROUP", "et", "transferables", "serializer", "CONTRACT_REGISTERED", "contract", "argsCopy", "NEW_CHATROOM_UNREAD_POSITION", "NEW_CHATROOM_NOTIFICATION_SETTINGS", "CAPTURED_LOGS", "computedGetters", "getters_default", "getter", "fn", "state", "ourLocation", "key", "value", "reactiveSet", "mainPeriodicNotificationEntries_default", "currentVersionInfo", "versionInfo", "setupPromise", "setupChelonia_default", "event", "port", "clients", "resolve", "reject", "a", "b", "contractID", "ourIdentityContractID", "KV_KEYS", "CHELONIA_STATE_MODIFIED", "chatRoomID", "messageHash", "notification", "rootGetters", "icon", "makeNotification", "preferences", "currentChatRoomUnreadMessages", "settings"]
}
