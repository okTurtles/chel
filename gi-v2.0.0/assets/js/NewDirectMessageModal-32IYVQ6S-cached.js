import{a as T}from"./chunk-M7PD3C7C-cached.js";import{e as D}from"./chunk-WIK6L7P3-cached.js";import{a as I}from"./chunk-ALM2LSB6-cached.js";import{a as x}from"./chunk-ZWHVW34C-cached.js";import"./chunk-KRTYB7RO-cached.js";import{a as b}from"./chunk-WYFJ56Q7-cached.js";import"./chunk-GWRDICTQ-cached.js";import{a as M}from"./chunk-CJC5SPHT-cached.js";import"./chunk-YGZ33QYP-cached.js";import"./chunk-QD6O46IB-cached.js";import"./chunk-WMVHT3GJ-cached.js";import{l as y}from"./chunk-VUYUNB2W-cached.js";import"./chunk-SZPI64OI-cached.js";import"./chunk-SVSS5DEP-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import{v as _}from"./chunk-M3EDVPDK-cached.js";import{a as v,b as h}from"./chunk-33M5GGRR-cached.js";import{a as g}from"./chunk-OMOH7TRL-cached.js";import{d as C}from"./chunk-WBBXU2FL-cached.js";import"./chunk-XMZXE55N-cached.js";var R={name:"NewDirectMessageModal",mixins:[x],components:{ModalBaseTemplate:M,UsersSelector:T,ProfileCard:I,AvatarUser:b},data(){return{searchText:"",selections:[]}},computed:{...C(["userDisplayNameFromID","usernameFromID","ourUsername","ourContactProfilesById","ourIdentityContractId","currentGroupContactProfilesById"]),ourNewDMContacts(){return Object.keys(this.currentGroupContactProfilesById).filter(s=>{let t=this.ourGroupDirectMessageFromUserIds(s);return!t||!this.ourGroupDirectMessages[t].visible}).map(s=>this.currentGroupContactProfilesById[s])},ourRecentConversations(){return Object.keys(this.ourGroupDirectMessages).filter(e=>this.ourGroupDirectMessages[e].visible).map(e=>{let{title:s,partners:t,lastJoinedPartner:n,picture:i,lastMsgTimeStamp:c,isDMToMyself:r}=this.ourGroupDirectMessages[e];return{chatRoomID:e,title:s,partners:t,lastJoinedPartner:n,picture:i,lastMsgTimeStamp:c,isDMToMyself:r}}).sort((e,s)=>{let t=e.lastMsgTimeStamp-s.lastMsgTimeStamp;return t>0?-1:t<0||e.title>s.title?1:-1})},filteredRecents(){return!this.searchText&&!this.selections.length?this.ourRecentConversations:this.ourRecentConversations.filter(({title:e,partners:s,isDMToMyself:t})=>{let n=s.map(c=>c.contractID),i=String(this.searchText).toUpperCase().normalize();return!t&&!y(n,this.selections).length?!1:String(e).toUpperCase().normalize().includes(i)?!0:i.replace(/\s/g,"").split(",").reduce((r,d,l,m)=>{let a=l===m.length-1,u=!1;return a?u=s.findIndex(o=>o.username.toUpperCase().normalize().includes(d)||o.displayName.toUpperCase().normalize().includes(d))>=0:u=s.findIndex(o=>o.username.toUpperCase().normalize()===d||o.displayName.toUpperCase().normalize()===d)>=0,r&&u},!0)}).sort((e,s)=>e.partners.length>s.partners.length?1:-1)},hasDMToMyself(){return!!this.filteredRecents.length&&this.filteredRecents.some(e=>e.isDMToMyself)},filteredOthers(){return D(this.ourNewDMContacts,this.searchText,["username","displayName"]).filter(e=>!this.selections.includes(e.contractID))},searchCount(){return Object.keys(this.filteredOthers).length+Object.keys(this.filteredRecents).length},resultsCopy(){let e={searchCount:`<strong>${this.searchCount}</strong>`,searchTerm:`<strong>${this.searchText}</strong>`,...v("strong")};return this.searchCount===1?h('Showing {strong_}1 result{_strong} for "{searchTerm}"',e):h('Showing {searchCount} {strong_}results{_strong} for "{searchTerm}"',e)}},methods:{localizedName(e,s){let t=s||`@${e}`;return e===this.ourUsername?h("{name} (you)",{name:t}):t},onChangeKeyword(e){this.searchText=e},onAddSelection(e){typeof e=="string"&&(e=[e]);for(let s of e)this.selections.includes(s)||this.selections.push(s)},onRecentConvoSelection(e){let{isDMToMyself:s,partners:t}=e;if(s){let n=this.ourGroupDirectMessageFromUserIds(this.ourIdentityContractId);this.redirect(n)}else this.onAddSelection(t.map(n=>n.contractID))},onRemoveSelection(e){this.selections=this.selections.filter(s=>s!==e)},async onSubmit(){if(this.selections.length){let s=this.selections.length===1&&this.selections[0]===this.ourIdentityContractId?this.selections:this.selections.filter(n=>n!==this.ourIdentityContractId),t=this.ourGroupDirectMessageFromUserIds(s);t?this.redirect(t):await this.createDirectMessage(s)}else this.searchText&&(this.filteredRecents.length?this.redirect(this.filteredRecents[0].chatRoomID):this.filteredOthers.length&&await this.createDirectMessage(this.filteredOthers[0].contractID));this.closeModal()},closeModal(){g("okTurtles.events/emit",_)}}},w=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("modal-base-template",{staticClass:"has-background",attrs:{fullscreen:!0,a11yTitle:e.L("New Direct Message"),autofocus:!1}},[t("div",{staticClass:"c-container"},[t("div",{staticClass:"c-header"},[t("i18n",{staticClass:"is-title-2 c-title",attrs:{tag:"h2"}},[e._v("Direct Messages")])],1),t("div",{staticClass:"card c-card"},[t("users-selector",{attrs:{label:e.L("Search"),userIDs:e.selections,autofocus:!0},on:{change:e.onChangeKeyword,remove:e.onRemoveSelection,submit:e.onSubmit}}),e.searchText&&e.searchCount>0?t("div",{directives:[{name:"safe-html",rawName:"v-safe-html",value:e.resultsCopy,expression:"resultsCopy"}],staticClass:"c-member-count has-text-1",attrs:{"data-test":"memberSearchCount"}}):e._e(),e.searchText&&e.searchCount===0?t("i18n",{staticClass:"c-member-count has-text-1",attrs:{tag:"div",args:{searchTerm:"<strong>"+e.searchText+"</strong>"}}},[e._v(`Sorry, we couldn't find anyone called "{searchTerm}"`)]):e._e(),t("div",{staticClass:"is-subtitle"},[t("i18n",{attrs:{tag:"h3",args:{nbMembers:e.filteredRecents.length}}},[e._v("Recent Conversations ({nbMembers})")])],1),t("transition-group",{attrs:{name:"slide-list","data-test":"recentConversations",tag:"ul"}},e._l(e.filteredRecents,function(n,i){var c=n.chatRoomID,r=n.partners,d=n.members,l=n.lastJoinedPartner,m=n.title,a=n.picture,u=n.isDMToMyself;return t("li",{key:c,staticClass:"c-search-member",on:{click:function(o){return e.onRecentConvoSelection(e.filteredRecents[i])}}},[t("profile-card",{attrs:{contractID:l,deactivated:"deactivated",direction:"top-left"}},[t("div",{staticClass:"c-identity"},[t("div",{staticClass:"picture-wrapper"},[t("avatar-user",{attrs:{contractID:l,size:"sm"}}),r.length>1?t("div",{staticClass:"c-badge"},[e._v(e._s(r.length))]):e._e()],1),t("div",{staticClass:"c-name",attrs:{"data-test":"lastJoinedPartner"}},[t("span",[t("strong",[e._v(e._s(m))]),u?t("i18n",{staticClass:"c-display-name",attrs:{"data-test":"profileName"}},[e._v("(you)")]):m!==l?t("div",{staticClass:"c-display-name",attrs:{"data-test":"profileName"}},[e._v("@"+e._s(r.map(function(o){return o.username}).join(", @")))]):e._e()],1)])])])],1)}),0),t("div",{staticClass:"is-subtitle"},[t("i18n",{attrs:{tag:"h3",args:{nbMembers:e.filteredOthers.length}}},[e._v("Others ({nbMembers})")])],1),t("transition-group",{attrs:{name:"slide-list","data-test":"others",tag:"ul"}},e._l(e.filteredOthers,function(n){var i=n.contractID,c=n.username,r=n.displayName;return t("li",{key:c,staticClass:"c-search-member",on:{click:function(d){return e.onAddSelection(i)}}},[t("profile-card",{attrs:{contractID:i,deactivated:"deactivated",direction:"top-left"}},[t("div",{staticClass:"c-identity"},[t("avatar-user",{attrs:{contractID:i,size:"sm"}}),t("div",{staticClass:"c-name",attrs:{"data-test":"username"}},[t("span",[t("strong",[e._v(e._s(e.localizedName(c,r)))]),r?t("div",{staticClass:"c-display-name",attrs:{"data-test":"profileName"}},[e._v("@"+e._s(c))]):e._e()])])],1)])],1)}),0)],1)])])},N=[],k=function(e){e&&e("data-v-4ed8907e_0",{source:".c-container[data-v-4ed8907e]{height:100%;width:100%;background-color:var(--general_2)}@media screen and (min-width:769px),print{.c-container[data-v-4ed8907e],.c-header[data-v-4ed8907e]{width:50rem;max-width:100%}}.c-header[data-v-4ed8907e]{display:flex;height:4.75rem;justify-content:center;align-items:center;padding-top:0;background-color:var(--background_0);margin:0 -1rem}@media screen and (min-width:769px),print{.c-header[data-v-4ed8907e]{padding-top:2rem;justify-content:flex-start;background-color:transparent;margin:0}}.c-card[data-v-4ed8907e]{margin-top:1.5rem}.c-member-count[data-v-4ed8907e]{margin-top:.5rem;margin-bottom:1.5rem}.c-identity[data-v-4ed8907e]{display:flex;align-items:center;flex-grow:1}.c-name[data-v-4ed8907e]{margin:0 .5rem 0 1.5rem;width:100%;display:flex;align-items:center;justify-content:space-between}.c-display-name[data-v-4ed8907e]{display:block;color:var(--text_1)}.c-search-member .c-twrapper[data-v-4ed8907e]{display:flex;height:4.5rem;padding:0 .5rem;justify-content:space-between;align-items:center;border-bottom:1px solid var(--general_0);transition:opacity ease-in .25s,height ease-in .25s}.c-search-member .c-twrapper[data-v-4ed8907e]:last-child{border-bottom:0}.c-search-member .c-twrapper[data-v-4ed8907e]:hover{background-color:var(--general_1);cursor:pointer}.slide-list-enter[data-v-4ed8907e],.slide-list-leave-to[data-v-4ed8907e]{height:0;opacity:0}.slide-list-leave-active[data-v-4ed8907e]{overflow:hidden;border-bottom:0}.c-actions-buttons[data-v-4ed8907e]{display:none;margin-top:0}.c-actions-buttons i[data-v-4ed8907e]{margin-right:.5rem}@media screen and (min-width:769px),print{.c-actions-buttons[data-v-4ed8907e]{display:block}}@media screen and (min-width:769px),print{.c-action-menu[data-v-4ed8907e]{display:none}}.is-subtitle[data-v-4ed8907e]{display:flex;margin-top:1.875rem;margin-bottom:.5rem}.picture-wrapper[data-v-4ed8907e]{position:relative;min-width:2rem;margin-right:.5rem}.c-badge[data-v-4ed8907e]{position:absolute;bottom:-.25rem;right:0;border-radius:.5rem;background-color:var(--general_0);color:var(--text_0);width:1rem;height:1rem;font-size:.75rem;text-align:center}",map:void 0,media:void 0})},U="data-v-4ed8907e",O=void 0,j=!1;function G(e,s,t,n,i,c,r,d,l,m){let a=(typeof t=="function"?t.options:t)||{};a.__file=`style>
`,a.render||(a.render=e.render,a.staticRenderFns=e.staticRenderFns,a._compiled=!0,i&&(a.functional=!0)),a._scopeId=n;{let u;if(s&&(u=r?function(o){s.call(this,m(o,this.$root.$options.shadowRoot))}:function(o){s.call(this,d(o))}),u!==void 0)if(a.functional){let o=a.render;a.render=function(S,f){return u.call(f),o(S,f)}}else{let o=a.beforeCreate;a.beforeCreate=o?[].concat(o,u):[u]}}return a}function p(){let e=p.styles||(p.styles={}),s=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,i){if(document.querySelector('style[data-vue-ssr-id~="'+n+'"]'))return;let c=s?i.media||"default":n,r=e[c]||(e[c]={ids:[],parts:[],element:void 0});if(!r.ids.includes(n)){let d=i.source,l=r.ids.length;if(r.ids.push(n),i.map&&(d+=`
/*# sourceURL=`+i.map.sources[0]+" */",d+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(i.map))))+" */"),s&&(r.element=r.element||document.querySelector("style[data-group="+c+"]")),!r.element){let m=document.head||document.getElementsByTagName("head")[0],a=r.element=document.createElement("style");a.type="text/css",i.media&&a.setAttribute("media",i.media),s&&(a.setAttribute("data-group",c),a.setAttribute("data-next-index","0")),m.appendChild(a)}if(s&&(l=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",l+1)),r.element.styleSheet)r.parts.push(d),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let m=document.createTextNode(d),a=r.element.childNodes;a[l]&&r.element.removeChild(a[l]),a.length?r.element.insertBefore(m,a[l]):r.element.appendChild(m)}}}}var z=G({render:w,staticRenderFns:N},k,R,U,j,O,!1,p,void 0,void 0),W=z;export{W as default};
//# sourceMappingURL=NewDirectMessageModal-32IYVQ6S-cached.js.map
