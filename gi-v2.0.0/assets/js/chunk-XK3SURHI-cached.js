import{a as l}from"./chunk-OMOH7TRL-cached.js";function b(n){let[t,e]=n.split(","),[o]=/image\/[^;]+/.exec(t)||[""],i=atob(e),c=new ArrayBuffer(i.length),a=new Uint8Array(c);for(let r=0;r<i.length;r++)a[r]=i.charCodeAt(r);return new Blob([c],{type:o})}var y=async(n,t)=>{let e=n;console.debug("will upload a picture of type:",e.type);let{download:o}=await l("chelonia/fileUpload",n,{type:e.type,cipher:"aes256gcm"},t);return o};function u(){let n="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t=new Image;return new Promise(e=>{t.onload=()=>{e(t.height>0)},t.onerror=o=>{e(!1)},t.src=n})}function h(n){let t=new Image;return new Promise(e=>{t.onload=()=>{e(t)},t.src=n})}function A({sourceImage:n,resizingFactor:t,quality:e,compressToType:o}){let{naturalWidth:i,naturalHeight:c}=n,a=document.createElement("canvas"),r=a.getContext("2d");return a.width=i*t,a.height=c*t,r.drawImage(n,0,0,a.width,a.height),new Promise(s=>{a.toBlob(g=>{s(g)},o,e)})}function w(n){let t={width:2048,height:1536},{naturalWidth:e,naturalHeight:o}=n;return e>t.width||o>t.height?Math.min(t.width/e,t.height/o):1}async function I(n,t){let e=await u()?"image/webp":"image/jpeg",o=await h(n),i=["image/jpeg","image/webp"].includes(t)?.8:.9,c=w(o);for(;;){let a=await A({sourceImage:o,resizingFactor:c,quality:i,compressToType:e}),r=a.size-409600;if(r<=0||i<=.3)return a;{let s=r>100*1024?.1:.05;i-=s}}}export{b as a,y as b,I as c};
//# sourceMappingURL=chunk-XK3SURHI-cached.js.map
