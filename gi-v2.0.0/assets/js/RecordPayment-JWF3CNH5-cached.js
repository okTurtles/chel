import{a as S}from"./chunk-CI7HF2OD-cached.js";import"./chunk-WH7WRYFK-cached.js";import{a as R,c as h,d as _,e as M}from"./chunk-GEXW5JDJ-cached.js";import"./chunk-OYX4NVDU-cached.js";import"./chunk-MMWHE4QG-cached.js";import{j as w}from"./chunk-3V7YD6RE-cached.js";import{a as x,c as A}from"./chunk-AZT5ZK4I-cached.js";import"./chunk-ALM2LSB6-cached.js";import"./chunk-ZWHVW34C-cached.js";import"./chunk-KRTYB7RO-cached.js";import"./chunk-WYFJ56Q7-cached.js";import"./chunk-GWRDICTQ-cached.js";import{a as N}from"./chunk-CJC5SPHT-cached.js";import"./chunk-YGZ33QYP-cached.js";import"./chunk-QD6O46IB-cached.js";import{a as T}from"./chunk-WMVHT3GJ-cached.js";import{a as I,c as k}from"./chunk-6P74MMKF-cached.js";import"./chunk-SZPI64OI-cached.js";import{a as $}from"./chunk-FTWBMR5D-cached.js";import"./chunk-SVSS5DEP-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import{G as v}from"./chunk-M3EDVPDK-cached.js";import{b as f}from"./chunk-33M5GGRR-cached.js";import{a as u}from"./chunk-OMOH7TRL-cached.js";import{b,d as C}from"./chunk-WBBXU2FL-cached.js";import{e as L}from"./chunk-XMZXE55N-cached.js";var P=L($());var E={render:function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("svg",{staticClass:"svg-success",attrs:{width:"81",height:"81",viewBox:"0 0 81 81",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M28.0625 42.9623C30.1102 45.7683 32.0518 48.7317 33.642 51.8214C34.5968 53.6765 34.4403 53.7972 35.2605 51.864C39.4018 42.1022 46.3523 33.5764 56.4286 29.5459",stroke:"var(--primary_0)","stroke-width":"6","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"40.5",cy:"40.5",r:"37.5",stroke:"var(--primary_1)","stroke-width":"6"}})])}};A();var j={name:"RecordPayment",mixins:[P.validationMixin],components:{ModalBaseTemplate:N,RecordPaymentsList:S,SvgSuccess:E,BannerScoped:k,BannerSimple:I,ButtonSubmit:T},props:{todoItems:{type:Array}},data(){return{form:{paymentsToRecord:[],memo:""},ephemeral:{displayMemo:!1},donePayment:!1}},created(){this.form.paymentsToRecord=this.paymentsList.map((t,r)=>({...t,index:r,checked:!1}))},computed:{...b(["currentGroupId"]),...C(["groupSettings","groupMincomeCurrency","thisPeriodPaymentInfo","ourPayments","userDisplayNameFromID"]),paymentsList(){return this.todoItems.map(t=>t.data&&t.data.status===h?{hash:t.hash,data:t.data,meta:t.meta,toMemberID:t.data.toMemberID,displayName:this.userDisplayNameFromID(t.data.toMemberID),date:t.meta.createdDate,monthstamp:w(t.meta.createdDate),amount:t.data.amount}:t)},recordNumber(){return this.form.paymentsToRecord.filter(t=>t.checked).length},registerPaymentCopy(){return this.recordNumber===1?f("Record 1 payment"):f("Record {number} payments",{number:this.recordNumber})}},methods:{closeModal(){this.$refs.modal.close()},updateRecord({index:t,...r}){x.set(this.form.paymentsToRecord,t,{...this.form.paymentsToRecord[t],...r})},async submit(){let t=this.groupMincomeCurrency,r=this.form.paymentsToRecord.filter(s=>s.checked),e=!1;this.$refs.formMsg.clean();for(let s of r){let o=this.paymentsList[s.index],c=o.data&&o.data.status===h;s.amount>o.amount;try{let a=this.form.memo,i={toMemberID:o.toMemberID,amount:+s.amount,total:o.amount,isLate:o.isLate,partial:o.partial||s.amount-o.amount>0,monthstamp:o.monthstamp,currencyFromTo:["USD",t],exchangeRate:1,txid:""+Math.random(),status:R,paymentType:M,...a?{memo:a}:{}};if(c)await u("gi.actions/group/paymentUpdate",{contractID:this.currentGroupId,data:{paymentHash:o.hash,updatedProperties:{...i,status:_}}});else{let m=await u("gi.actions/group/payment",{contractID:this.currentGroupId,data:i});await u("gi.actions/group/paymentUpdate",{contractID:this.currentGroupId,data:{paymentHash:m.hash(),updatedProperties:{status:_}}})}}catch(a){e=!0,console.error("RecordPayment submit() error:",a),this.$refs.formMsg.danger(a)}}e||(this.donePayment=!0,u("okTurtles.events/emit",v,{hashes:r.map(s=>s.hash)}))}}},U=function(){var t=this,r=t.$createElement,e=t._self._c||r;return t.paymentsList?e("modal-base-template",{ref:"modal",staticClass:"has-background",attrs:{fullscreen:!0,a11yTitle:t.L("Record payments")}},[e("div",{staticClass:"c-header",class:{"hide-desktop":t.donePayment}},[e("i18n",{staticClass:"is-title-2 c-title",attrs:{tag:"h2"}},[t._v("Record payments")])],1),t.donePayment?e("div",{staticClass:"c-payment-success"},[e("svg-success"),e("i18n",{staticClass:"is-title-2 c-title",attrs:{tag:"h2"}},[t._v("Your payments were recorded")]),e("banner-simple",{attrs:{severity:"info"}},[e("i18n",{attrs:{args:{r1:'<a class="link" href="https://donorbox.org/okturtles-donation" target="_blank">',r2:"</a>"}}},[t._v("Please support the development of Group Income by {r1}sending a donation{r2}!")])],1),e("i18n",{staticClass:"is-outlined",attrs:{tag:"button","data-test":"successClose"},on:{click:t.closeModal}},[t._v("Close")])],1):e("div",{staticClass:"c-payment-form"},[e("div",{staticClass:"c-content"},[e("form",{staticClass:"card c-card",attrs:{novalidate:"true"},on:{submit:function(s){s.preventDefault()}}},[e("i18n",{staticClass:"has-text-bold c-title",attrs:{tag:"h3"}},[t._v("Who did you send money to?")]),e("record-payments-list",{attrs:{paymentsList:t.form.paymentsToRecord},on:{update:t.updateRecord}}),e("div",{staticClass:"c-footer"},[e("div",{staticClass:"c-footer-info"},[e("i18n",{staticClass:"has-text-bold",attrs:{tag:"h4",args:{span_:'<span class="has-text-small has-text-1 has-text-normal">',_span:"</span>"}}},[t._v("Add a note {span_}(optional){_span}")]),e("i18n",{staticClass:"has-text-small has-text-1",attrs:{tag:"p"}},[t._v("Leave a message to the group members selected above.")])],1),e("div",{staticClass:"c-footer-action"},[e("input",{staticClass:"switch",attrs:{id:"showComment",type:"checkbox",name:"displayComment"},on:{change:function(s){t.ephemeral.displayMemo=!t.ephemeral.displayMemo}}}),e("i18n",{staticClass:"sr-only",attrs:{tag:"label",for:"displayComment"}},[t._v("Toggle comment box")])],1)]),e("transition",{attrs:{name:"slidedown"}},[t.ephemeral.displayMemo?e("label",{staticClass:"field"},[e("i18n",{staticClass:"sr-only label"},[t._v("Leave a message")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.memo,expression:"form.memo"}],staticClass:"textarea c-comment",attrs:{rows:"4"},domProps:{value:t.form.memo},on:{input:function(s){s.target.composing||t.$set(t.form,"memo",s.target.value)}}})],1):t._e()]),e("banner-scoped",{ref:"formMsg",attrs:{"data-test":"formMsg"}}),e("div",{staticClass:"buttons c-buttons"},[e("i18n",{staticClass:"is-outlined",attrs:{tag:"button",type:"button"},on:{click:t.closeModal}},[t._v("Cancel")]),e("button-submit",{staticClass:"is-success",attrs:{disabled:this.recordNumber===0},on:{click:t.submit}},[t._v(t._s(t.registerPaymentCopy))])],1)],1)])])]):t._e()},B=[],F=function(t){t&&t("data-v-d7914944_0",{source:".c-header[data-v-d7914944]{background:var(--background_0);padding:1.5rem 0 1.125rem 2rem;position:absolute;left:0;right:0}@media screen and (min-width:769px),print{.c-header[data-v-d7914944]{text-align:center;padding:2rem 0 1.625rem 0}}@media screen and (min-width:1200px){.c-header[data-v-d7914944]{max-width:33rem;width:100%;background:0 0;text-align:left;position:relative;padding-top:2.5rem;padding-bottom:1rem}}.c-payment-form[data-v-d7914944]{width:100%}@media screen and (min-width:769px),print{.c-payment-form[data-v-d7914944]{max-width:33rem}}.c-content[data-v-d7914944]{padding-top:6.125rem}@media screen and (min-width:769px),print{.c-content[data-v-d7914944]{padding-top:7.25rem}}@media screen and (min-width:1200px){.c-content[data-v-d7914944]{padding-top:0}}.c-content .c-title[data-v-d7914944]{margin-bottom:.5rem;font-size:.875rem}@media screen and (min-width:769px),print{.c-content .c-title[data-v-d7914944]{margin-bottom:1rem}}.c-footer[data-v-d7914944]{padding-top:1.5rem;display:flex;justify-content:space-between}@media screen and (min-width:769px),print{.c-footer[data-v-d7914944]{padding-top:1.5rem}}@media screen and (min-width:1200px){.c-footer[data-v-d7914944]{padding-top:1.5rem}}.c-comment[data-v-d7914944]{margin-top:1rem}@media screen and (max-width:768px){.c-buttons[data-v-d7914944]{flex-direction:column-reverse}.c-buttons button[data-v-d7914944]:first-child{margin-top:1rem;margin-right:0}.c-buttons button[data-v-d7914944]{width:100%}}.c-payment-success[data-v-d7914944]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding-top:9rem}@media screen and (min-width:769px),print{.c-payment-success[data-v-d7914944]{padding-top:10rem}}@media screen and (min-width:1200px){.c-payment-success[data-v-d7914944]{padding-top:8rem}}.c-payment-success .c-title[data-v-d7914944]{margin:2rem}.c-payment-success .c-message[data-v-d7914944]{max-width:24.5rem}.c-payment-success button[data-v-d7914944]{margin-top:2rem}",map:void 0,media:void 0})},G="data-v-d7914944",O=void 0,Y=!1;function V(t,r,e,s,o,c,a,i,m,p){let n=(typeof e=="function"?e.options:e)||{};n.__file=`style>
`,n.render||(n.render=t.render,n.staticRenderFns=t.staticRenderFns,n._compiled=!0,o&&(n.functional=!0)),n._scopeId=s;{let l;if(r&&(l=a?function(d){r.call(this,p(d,this.$root.$options.shadowRoot))}:function(d){r.call(this,i(d))}),l!==void 0)if(n.functional){let d=n.render;n.render=function(D,g){return l.call(g),d(D,g)}}else{let d=n.beforeCreate;n.beforeCreate=d?[].concat(d,l):[l]}}return n}function y(){let t=y.styles||(y.styles={}),r=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(s,o){if(document.querySelector('style[data-vue-ssr-id~="'+s+'"]'))return;let c=r?o.media||"default":s,a=t[c]||(t[c]={ids:[],parts:[],element:void 0});if(!a.ids.includes(s)){let i=o.source,m=a.ids.length;if(a.ids.push(s),o.map&&(i+=`
/*# sourceURL=`+o.map.sources[0]+" */",i+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(o.map))))+" */"),r&&(a.element=a.element||document.querySelector("style[data-group="+c+"]")),!a.element){let p=document.head||document.getElementsByTagName("head")[0],n=a.element=document.createElement("style");n.type="text/css",o.media&&n.setAttribute("media",o.media),r&&(n.setAttribute("data-group",c),n.setAttribute("data-next-index","0")),p.appendChild(n)}if(r&&(m=parseInt(a.element.getAttribute("data-next-index")),a.element.setAttribute("data-next-index",m+1)),a.element.styleSheet)a.parts.push(i),a.element.styleSheet.cssText=a.parts.filter(Boolean).join(`
`);else{let p=document.createTextNode(i),n=a.element.childNodes;n[m]&&a.element.removeChild(n[m]),n.length?a.element.insertBefore(p,n[m]):a.element.appendChild(p)}}}}var q=V({render:U,staticRenderFns:B},F,j,G,Y,O,!1,y,void 0,void 0),it=q;export{it as default};
//# sourceMappingURL=RecordPayment-JWF3CNH5-cached.js.map
