import{a as v}from"./chunk-NGBII4BC-cached.js";import"./chunk-GB4D3I4D-cached.js";import"./chunk-Q5WT7Z5S-cached.js";import"./chunk-MMWHE4QG-cached.js";import{c as _,f as g,i as b,m as c}from"./chunk-3V7YD6RE-cached.js";import"./chunk-LIW6QCF4-cached.js";import"./chunk-WMVHT3GJ-cached.js";import{c as D}from"./chunk-6P74MMKF-cached.js";import{b as I}from"./chunk-B4L7IMS4-cached.js";import{l as u}from"./chunk-SZPI64OI-cached.js";import"./chunk-R4DRX7L2-cached.js";import{a as x}from"./chunk-FTWBMR5D-cached.js";import"./chunk-BZWIYGWR-cached.js";import"./chunk-SVSS5DEP-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import"./chunk-M3EDVPDK-cached.js";import{b as m}from"./chunk-33M5GGRR-cached.js";import{a as d}from"./chunk-OMOH7TRL-cached.js";import{b as f,d as h}from"./chunk-WBBXU2FL-cached.js";import{e as p}from"./chunk-XMZXE55N-cached.js";var S=p(x()),y=p(I());var C={name:"DistributionDateProposal",components:{ProposalTemplate:v,BannerScoped:D},mixins:[S.validationMixin],data(){return{form:{distributionDate:null},ephemeral:{distributionDayRange:[],errorMsg:null,currentStep:0},config:{steps:["GroupDistributionDate"]}}},watch:{"ephemeral.currentStep":function(t){t===1&&!this.skipToProposeDistributionDate&&this.validateDistributionDate()}},validations:{form:{distributionDate:{required:y.required}},steps:{GroupDistributionDate:["form.distributionDate"]}},computed:{...f(["currentGroupId"]),...h(["groupDistributionStarted","ourIdentityContractId","groupShouldPropose","groupSettings","currentGroupOwnerID","groupMembersCount"]),currentDistributionDate(){return c(this.groupSettings.distributionDate,{month:"long",day:"numeric"})},distributionStarted(){return this.groupDistributionStarted(new Date().toISOString())},shouldImmediateChangeDistributionDate(){return!this.distributionStarted&&this.ourIdentityContractId===this.currentGroupOwnerID}},beforeMount(){for(let t=1;t<=30;t++)this.ephemeral.distributionDayRange.push(g(b(new Date().setUTCHours(0,0,0,0),t*_)))},mounted(){this.$refs.distributionDate.focus()},methods:{humanDate:c,validateDistributionDate(){return this.form.distributionDate===this.groupSettings.distributionDate?(this.$refs.formMsg.danger(m("The new distribution date should be different from the current one.")),this.ephemeral.currentStep=0,!1):(this.$refs.formMsg.clean(),!0)},async submit(t){if(!this.validateDistributionDate())return;let{distributionDate:s}=this.form;if(this.shouldImmediateChangeDistributionDate){try{await d("gi.actions/group/updateSettings",{contractID:this.currentGroupId,data:{distributionDate:s}}),this.$refs.proposal.close()}catch(e){console.error("DistributionDate.vue submit() error:",e),this.$refs.formMsg.danger(e.message)}return}try{await d("gi.actions/group/proposal",{contractID:this.currentGroupId,data:{proposalType:u,proposalData:{setting:"distributionDate",proposedValue:s,currentValue:this.groupSettings.distributionDate,reason:t.reason},votingRule:this.groupSettings.proposals[u].rule,expires_date_ms:Date.now()+this.groupSettings.proposals[u].expires_ms}}),this.ephemeral.currentStep+=1}catch(e){console.error("DistributionDate.vue submit() error:",e),this.$refs.formMsg.danger(e.message),this.ephemeral.currentStep=0}}}},$=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("proposal-template",{ref:"proposal",attrs:{title:t.L("Change distribution date"),disabled:t.$v.form.$invalid||t.distributionStarted,maxSteps:t.config.steps.length,currentStep:t.ephemeral.currentStep,shouldImmediateChange:t.shouldImmediateChangeDistributionDate},on:{"update:currentStep":function(r){return t.$set(t.ephemeral,"currentStep",r)},"update:current-step":function(r){return t.$set(t.ephemeral,"currentStep",r)},submit:t.submit},scopedSlots:t._u([t.shouldImmediateChangeDistributionDate?{key:"shouldImmediateChangeFooter",fn:function(){return[e("i18n",{attrs:{args:t.LTags("strong")}},[t._v("The first distribution period is not started yet, so {strong_}this change will be immediate{_strong} (no voting required).")])]},proxy:!0}:null],null,!0)},[t.ephemeral.currentStep===0?e("label",{key:"0",staticClass:"field"},[e("i18n",{staticClass:"label"},[t._v("New distribution date")]),e("div",{directives:[{name:"error",rawName:"v-error:distributionDate",arg:"distributionDate"}],staticClass:"inputgroup selectbox",class:{error:t.$v.form.distributionDate.$error}},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.$v.form.distributionDate.$model,expression:"$v.form.distributionDate.$model"}],ref:"distributionDate",staticClass:"select",attrs:{"aria-label":t.L("Choose your group's distribution date"),name:"distributionDate",required:"required"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(n){return n.selected}).map(function(n){var l="_value"in n?n._value:n.value;return l});t.$set(t.$v.form.distributionDate,"$model",r.target.multiple?o:o[0])}}},[e("i18n",{attrs:{tag:"option",disabled:"disabled",value:""}},[t._v("Choose your group's distribution date")]),t._l(t.ephemeral.distributionDayRange,function(r,o){return e("option",{key:o,domProps:{value:r}},[t._v(t._s(t.humanDate(r,{month:"long",year:"numeric",day:"numeric"})))])})],2)]),e("i18n",{staticClass:"helper",attrs:{args:{currentDistributionDate:t.currentDistributionDate}}},[t._v("Current distribution date is on {currentDistributionDate}.")])],1):t._e(),e("banner-scoped",{ref:"formMsg",attrs:{"data-test":"proposalError"}})],1)},w=[],R=void 0,T="data-v-3f2a411e",k=void 0,M=!1;function G(t,s,e,r,o,n,l,j,E,O){let i=(typeof e=="function"?e.options:e)||{};return i.__file=`style>
`,i.render||(i.render=t.render,i.staticRenderFns=t.staticRenderFns,i._compiled=!0,o&&(i.functional=!0)),i._scopeId=r,i}var P=G({render:$,staticRenderFns:w},R,C,T,M,k,!1,void 0,void 0,void 0),W=P;export{W as default};
//# sourceMappingURL=DistributionDate-QTJ2TN3F-cached.js.map
