import{a as N}from"./chunk-NGBII4BC-cached.js";import{a as E,c as I}from"./chunk-4NG7WZRG-cached.js";import{c as C,d as g}from"./chunk-GB4D3I4D-cached.js";import"./chunk-SXKMOEKE-cached.js";import"./chunk-Q5WT7Z5S-cached.js";import"./chunk-MMWHE4QG-cached.js";import"./chunk-3V7YD6RE-cached.js";import"./chunk-LIW6QCF4-cached.js";import"./chunk-WMVHT3GJ-cached.js";import{c as x}from"./chunk-6P74MMKF-cached.js";import{m as f}from"./chunk-SZPI64OI-cached.js";import"./chunk-BZWIYGWR-cached.js";import"./chunk-SVSS5DEP-cached.js";import"./chunk-MEHASGB7-cached.js";import"./chunk-Z7X5SDSD-cached.js";import{v as y,x as b}from"./chunk-M3EDVPDK-cached.js";import{a as v,b as l}from"./chunk-33M5GGRR-cached.js";import{a as m}from"./chunk-OMOH7TRL-cached.js";import{b as R,d as T}from"./chunk-WBBXU2FL-cached.js";import"./chunk-XMZXE55N-cached.js";var $={name:"ChangeVotingRules",components:{BannerScoped:x,ProposalTemplate:N,VotingRulesInput:I},data(){return{RULE_DISAGREEMENT:g,config:{steps:["VotingSystem"],rule:null},form:{threshold:null},ephemeral:{errorMsg:null,currentStep:0}}},created(){let e=this.$route.query.rule;e?(m("okTurtles.events/emit",b,"ChangeVotingRules",{rule:e}),this.config.rule=e,this.form.threshold=e===this.proposalSettings.rule?this.currentThreshold:E.ruleSettings[e].threshold):(console.warn('RemoveMember: Missing valid query "rule".'),m("okTurtles.events/emit",y))},watch:{"ephemeral.currentStep":function(e){this.groupShouldPropose&&e===1&&this.validateThreshold()}},computed:{...R(["currentGroupId"]),...T(["groupShouldPropose","groupProposalSettings","groupSettings"]),proposalSettings(){return this.groupProposalSettings()},currentThreshold(){return this.changeSystem?null:this.proposalSettings.ruleSettings[this.config.rule].threshold},title(){return this.proposalSettings.rule===this.config.rule?l("Change voting rules"):l("Change voting system")},changeSystem(){if(this.proposalSettings.rule===this.config.rule)return"";let e={[g]:l("disagreement number"),[C]:l("percentage based")};return l("Change from a {b_}{oldSystem}{_b} voting system to a {b_}{newSystem}{_b} voting system.",{...v("b"),oldSystem:e[this.proposalSettings.rule],newSystem:e[this.config.rule]})}},methods:{setThreshold(e){this.form.threshold=e},validateThreshold(){return+this.form.threshold===this.currentThreshold?(this.ephemeral.currentStep=0,this.$refs.formMsg.danger(l("You are proposing to keep the same value as the actual.")),!1):(this.$refs.formMsg.clean(),!0)},async submit(e){if(this.validateThreshold())if(this.groupShouldPropose){let{reason:s}=e;try{await m("gi.actions/group/proposal",{contractID:this.currentGroupId,data:{proposalType:f,proposalData:{current:{ruleName:this.proposalSettings.rule,ruleThreshold:this.currentThreshold},ruleName:this.config.rule,ruleThreshold:+this.form.threshold,reason:s},votingRule:this.groupSettings.proposals[f].rule,expires_date_ms:Date.now()+this.groupSettings.proposals[f].expires_ms}}),this.ephemeral.currentStep+=1}catch(o){console.error("ChangeVotingRules.vue failed:",o),this.$refs.formMsg.danger(o.message),this.ephemeral.currentStep=0}}else try{await m("gi.actions/group/updateAllVotingRules",{contractID:this.currentGroupId,data:{ruleName:this.config.rule,ruleThreshold:+this.form.threshold}}),this.$refs.proposal.close()}catch(s){console.error("ChangeVotingRules.vue failed:",s),this.$refs.formMsg.danger(s.message)}}},validations:{form:{},steps:{VotingSystem:["form.threshold"]}}},L=function(){var e=this,s=e.$createElement,o=e._self._c||s;return o("proposal-template",{ref:"proposal",attrs:{title:e.title,disabled:!1,maxSteps:e.config.steps.length,currentStep:e.ephemeral.currentStep},on:{"update:currentStep":function(n){return e.$set(e.ephemeral,"currentStep",n)},"update:current-step":function(n){return e.$set(e.ephemeral,"currentStep",n)},submit:e.submit}},[e.ephemeral.currentStep===0?o("div",{key:"0",staticClass:"c-step"},[e.changeSystem?o("p",{directives:[{name:"safe-html",rawName:"v-safe-html",value:e.changeSystem,expression:"changeSystem"}],staticClass:"has-text-1 c-desc",attrs:{"data-test":"changeSystem"}}):e._e(),e.config.rule?o("voting-rules-input",{staticClass:"c-input",attrs:{rule:e.config.rule,value:e.form.threshold},on:{update:e.setThreshold}}):e._e(),e.config.rule===e.RULE_DISAGREEMENT?[e.form.threshold>1?o("i18n",{staticClass:"has-text-1",attrs:{args:{nr:e.form.threshold}}},[e._v("Future proposals would be accepted if {nr} or fewer members disagree.")]):o("i18n",{staticClass:"has-text-1",attrs:{args:e.LTags("b")}},[e._v("Future proposals would be accepted if {b_}no one{_b} disagrees.")])]:e._e()],2):e._e(),o("banner-scoped",{ref:"formMsg",attrs:{"data-test":"proposalError"}})],1)},M=[],w=function(e){e&&e("data-v-a98b0b54_0",{source:".c-desc[data-v-a98b0b54],.c-step[data-v-a98b0b54]{margin-bottom:2rem}.c-input[data-v-a98b0b54]{margin-bottom:1rem}",map:void 0,media:void 0})},O="data-v-a98b0b54",P=void 0,V=!1;function D(e,s,o,n,i,p,r,u,d,c){let t=(typeof o=="function"?o.options:o)||{};t.__file=`style>
`,t.render||(t.render=e.render,t.staticRenderFns=e.staticRenderFns,t._compiled=!0,i&&(t.functional=!0)),t._scopeId=n;{let h;if(s&&(h=r?function(a){s.call(this,c(a,this.$root.$options.shadowRoot))}:function(a){s.call(this,u(a))}),h!==void 0)if(t.functional){let a=t.render;t.render=function(A,S){return h.call(S),a(A,S)}}else{let a=t.beforeCreate;t.beforeCreate=a?[].concat(a,h):[h]}}return t}function _(){let e=_.styles||(_.styles={}),s=typeof navigator<"u"&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,i){if(document.querySelector('style[data-vue-ssr-id~="'+n+'"]'))return;let p=s?i.media||"default":n,r=e[p]||(e[p]={ids:[],parts:[],element:void 0});if(!r.ids.includes(n)){let u=i.source,d=r.ids.length;if(r.ids.push(n),i.map&&(u+=`
/*# sourceURL=`+i.map.sources[0]+" */",u+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(i.map))))+" */"),s&&(r.element=r.element||document.querySelector("style[data-group="+p+"]")),!r.element){let c=document.head||document.getElementsByTagName("head")[0],t=r.element=document.createElement("style");t.type="text/css",i.media&&t.setAttribute("media",i.media),s&&(t.setAttribute("data-group",p),t.setAttribute("data-next-index","0")),c.appendChild(t)}if(s&&(d=parseInt(r.element.getAttribute("data-next-index")),r.element.setAttribute("data-next-index",d+1)),r.element.styleSheet)r.parts.push(u),r.element.styleSheet.cssText=r.parts.filter(Boolean).join(`
`);else{let c=document.createTextNode(u),t=r.element.childNodes;t[d]&&r.element.removeChild(t[d]),t.length?r.element.insertBefore(c,t[d]):r.element.appendChild(c)}}}}var G=D({render:L,staticRenderFns:M},w,$,O,V,P,!1,_,void 0,void 0),W=G;export{W as default};
//# sourceMappingURL=ChangeVotingRules-3GIZ4GRV-cached.js.map
